- en: Chapter 7. Maintenance of VCM
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章. VCM的维护
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下食谱：
- en: Upgrading VCM from a previous version - in place
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从先前版本升级VCM - 就地
- en: Upgrading VCM from a previous version - parallel
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从先前版本升级VCM - 并行
- en: Migrating VCM from another domain
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从另一个域迁移VCM
- en: Applying a new license key
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用新许可证密钥
- en: Upgrading VCM agents
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 升级VCM代理
- en: Changing service account passwords
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改服务帐户密码
- en: Managing users
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户管理
- en: Decommissioning VMs - manual VM purge
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 弃用虚拟机 - 手动虚拟机清除
- en: Decommissioning VMs - scheduled VM record purge
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 弃用虚拟机 - 定期虚拟机记录清除
- en: Introduction
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: After installation and configuration, another extremely important aspect we
    need to look at is the lifecycle management of VCM. VMware will keep on improving
    VCM, and to have those improvements implemented, we also need to invest our time
    to maintain the infrastructure we have built.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 安装和配置完成后，另一个极为重要的方面是我们需要关注VCM的生命周期管理。VMware会不断改进VCM，为了实施这些改进，我们也需要投入时间来维护我们已构建的基础设施。
- en: This is not just limited to VMware updates and upgrades but also to our own
    infrastructure changes; for example, relocating a datacenter might need us to
    change IP or we might have decided to change our Active Directory domain and we
    need to migrate our management servers to the newly created domain. All this falls
    under maintenance, and we will have a look what we can do for VCM.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 这不仅仅限于VMware的更新和升级，还包括我们自己基础设施的变动；例如，搬迁数据中心可能需要我们更改IP，或者我们可能决定更改我们的Active Directory域，并且需要将管理服务器迁移到新创建的域。这一切都属于维护范畴，我们将看看可以为VCM做些什么。
- en: Apart from this, we are managing our infrastructure, and it has its own lifecycle
    to manage; for example, once the server is decommissioned, we need to remove it
    from VCM, and after upgrading VCM, we need to upgrade VCM agents on the managed
    servers.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 除此之外，我们还在管理我们的基础设施，它有自己的生命周期需要管理；例如，一旦服务器被弃用，我们需要将其从VCM中移除，升级VCM后，我们还需要在托管服务器上升级VCM代理。
- en: To manage VCM, we will have a support team; everyone does not need to have admin
    access on the server. In order to adhere to the security principle of least privilege,
    we need to create some groups and give them proper access to VCM.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 为了管理VCM，我们将有一个支持团队；并不是每个人都需要在服务器上拥有管理员权限。为了遵循最小权限的安全原则，我们需要创建一些组，并给予他们适当的VCM访问权限。
- en: We will have a look at those points in this chapter to make sure we have a maintained
    VCM infrastructure so that it can manage our infrastructure better.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章中查看这些要点，以确保我们拥有一个维护良好的VCM基础设施，从而更好地管理我们的基础设施。
- en: Upgrading VCM from a previous version – in place
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从先前版本升级VCM - 就地
- en: In this recipe, we will upgrade VCM in place, meaning we will do a regular upgrade
    without changing the OS underneath. If you want to change the OS underneath, have
    a look at the following recipe.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将进行VCM就地升级，意味着我们将进行常规升级，而不会更改底层的操作系统。如果你想更改底层操作系统，可以参考以下食谱。
- en: Getting ready
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To start with this activity, you must have all the user accounts in place, and
    they must have permissions as described in the *Service accounts* subsection under
    the *Understanding the requirements of VCM* recipe in [Chapter 1](ch01.html "Chapter 1. Installing
    VCM"), *Installing VCM*. You must have a user apart from the service account,
    which may be your own account, with admin privilege on the VCM Collector server.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始此活动，你必须确保所有用户帐户都已就位，并且他们拥有[第1章](ch01.html "第1章. 安装VCM")中“理解VCM的要求”食谱下的*服务帐户*小节中所描述的权限。你必须拥有除服务帐户之外的一个用户帐户，这个帐户可以是你自己的，并且在VCM收集器服务器上具有管理员权限。
- en: If you are using a physical server, then take a backup of the server with the
    tool you are using in your infrastructure; otherwise, if that Collector server
    is a virtual machine, take a snapshot of the VM.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是物理服务器，那么使用你在基础设施中使用的工具对服务器进行备份；否则，如果该收集器服务器是虚拟机，则对虚拟机进行快照。
- en: Take a backup of the databases (`Excel VCM_Raw`) so that if something goes wrong,
    you can get back to where you were before the upgrade. If you don't know how,
    you can get help from your SQL admin to take a backup of the databases.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 对数据库（`Excel VCM_Raw`）进行备份，这样如果出现问题，你可以恢复到升级前的状态。如果你不知道如何操作，可以寻求SQL管理员的帮助进行数据库备份。
- en: You must have access to [https://my.vmware.com](https://my.vmware.com) to download
    the latest VCM installation ISO files.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 你必须能够访问[https://my.vmware.com](https://my.vmware.com)以下载最新的VCM安装ISO文件。
- en: How to do it...
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行...
- en: 'In the following example, we will perform an in-place upgrade of a two-tier
    VCM deployment:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例中，我们将执行一个两层 VCM 部署的就地升级：
- en: Note
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that you should not use a VCM service account to upgrade VCM. Use any domain
    account that is an admin on the VCM server. You can use your own account to log
    in to the VCM Collector server if you have those privileges; if not, assign them
    to your account for the time being.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，您不应使用 VCM 服务账户来升级 VCM。使用任何在 VCM 服务器上具有管理员权限的域账户。如果您有权限，可以使用您自己的账户登录到 VCM
    Collector 服务器；如果没有，请暂时为您的账户分配这些权限。
- en: Mount the ISO downloaded from the Internet on your VCM Collector VM.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将从互联网下载的 ISO 文件挂载到您的 VCM Collector 虚拟机上。
- en: Log in to the Collector OS with a [user right/role].
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 [用户权限/角色] 登录到 Collector 操作系统。
- en: Open an Explorer window and navigate to the CD-ROM drive just mounted.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开资源管理器窗口，导航到刚挂载的光驱。
- en: Right-click on `setup.exe` and select **Run as Administrator**.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击 `setup.exe` 并选择 **以管理员身份运行**。
- en: Select **Upgrade** and click on **Next**:![How to do it...](img/image_07_001.jpg)
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 **升级** 并点击 **下一步**：![如何操作...](img/image_07_001.jpg)
- en: Accept the license agreement, and click on **Next**.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受许可协议，然后点击 **下一步**。
- en: Confirm the components to be upgraded, and click on **Next****:**![How to do
    it...](img/image_07_002.jpg)
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认需要升级的组件，并点击 **下一步**：![如何操作...](img/image_07_002.jpg)
- en: Wait until the checks are completed and click on **Next** once they are successful;
    if not, check what needs a fix, resolve any issues, and then perform a recheck.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待检查完成，检查成功后点击 **下一步**；如果失败，检查需要修复的内容，解决问题后重新检查。
- en: Note
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that while performing the upgrade, the details asked in the wizard should
    be automatically filled in. If not, fill in the appropriate details; if you want
    to make any changes, then this is the time to make those changes, such as changing
    service accounts.
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，在执行升级时，向导中要求的详细信息应该会自动填充。如果没有，填写适当的详细信息；如果您想进行任何更改，现在是进行更改的时机，例如更改服务账户。
- en: If you want to change the Tomcat service account, provide the details; otherwise,
    go with the default value and click on **Next**.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您想更改 Tomcat 服务账户，提供详细信息；否则，使用默认值并点击 **下一步**。
- en: Enter the SQL reporting service details and credentials here, and click on **Validate**;
    when validated, click on **Next**:![How to do it...](img/image_07_003.jpg)
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此输入 SQL 报告服务详细信息和凭据，并点击 **验证**；验证后，点击 **下一步**：![如何操作...](img/image_07_003.jpg)
- en: Enter the Collector service account (if required) and click on **Next**.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 Collector 服务账户（如果需要），然后点击 **下一步**。
- en: If not populated automatically, enter the default network authority account
    and click on **Next**.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果未自动填写，输入默认的网络权限账户并点击 **下一步**。
- en: The certificates should be selected automatically already. If not, select your
    certificates by clicking on **Select**, and once done, click on **Next**.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 证书应该已自动选择。如果没有，点击 **选择** 选择您的证书，选择完毕后，点击 **下一步**。
- en: If not populated automatically, enter your remote virtual directory details
    and click on **Next**.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果未自动填写，输入您的远程虚拟目录详细信息并点击 **下一步**。
- en: If not populated automatically, enter your virtualization client plugin details
    and click on **Next**.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果未自动填写，输入您的虚拟化客户端插件详细信息并点击 **下一步**。
- en: If not populated automatically, enter the installation directory, and click
    on **Next**.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果未自动填写，输入安装目录，并点击 **下一步**。
- en: There is no option for you to change this path for the local packages cache
    location; click on **Next**.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您无法更改本地软件包缓存位置的路径；点击 **下一步**。
- en: The option for the path for the software repository is preselected and can't
    be changed; click on **Next**.
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 软件仓库路径选项已预选，无法更改；点击 **下一步**。
- en: Enter the Package Studio folder location and click on **Next**.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 Package Studio 文件夹位置并点击 **下一步**。
- en: Confirm the details and click on **Upgrade**:![How to do it...](img/image_07_004.jpg)
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认详细信息并点击 **升级**：![如何操作...](img/image_07_004.jpg)
- en: The process of upgrading all components can take half an hour or more.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 升级所有组件的过程可能需要半小时或更长时间。
- en: Check whether the upgrade was successful by checking the version of VCM.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过检查 VCM 的版本来验证升级是否成功。
- en: Once the installation is complete, log in to VCM and check the version; it should be
    **5.8.2.160**, as in the following screenshot, or the version you downloaded from
    [http://www.vmware.com/](http://www.vmware.com/):![How to do it...](img/image_07_005.jpg)
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，登录 VCM 并检查版本；它应该是 **5.8.2.160**，如以下截图所示，或者是您从 [http://www.vmware.com/](http://www.vmware.com/)
    下载的版本：![如何操作...](img/image_07_005.jpg)
- en: How it works...
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: We installed the latest version of VCM on the same server, using the old data
    collected for our infrastructure.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在同一服务器上安装了最新版本的VCM，并使用我们基础设施收集的旧数据。
- en: 'Here are the upgrade options to upgrade the version:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是升级选项，用于升级版本：
- en: Upgrade directly from VCM 5.6 or later by running VCM 5.8.x Installation Manager
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直接从VCM 5.6或更高版本升级，通过运行VCM 5.8.x安装管理器
- en: Upgrade VCM versions earlier than 5.6 to VCM 5.6 and then upgrade from VCM 5.6
    to VCM 5.8.x
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将VCM版本低于5.6的版本升级到VCM 5.6，然后再从VCM 5.6升级到VCM 5.8.x。
- en: Earlier versions include VMware VCM 5.5.x, 5.4, 5.3, 5.2.1, EMC Ionix SCM 5.0
    or later, or Configuresoft ECM 4.11.1 or later.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 较早的版本包括VMware VCM 5.5.x、5.4、5.3、5.2.1，EMC Ionix SCM 5.0或更高版本，或Configuresoft
    ECM 4.11.1或更高版本。
- en: Aftercare
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 后续照料
- en: 'After upgrading VCM, we need to upgrade the agents to the latest versions;
    have a look at the *Upgrading VCM agents* recipes in this chapter to do that:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 升级VCM后，我们需要将代理升级到最新版本；请查看本章中的*升级VCM代理*食谱以进行操作：
- en: There is a small bug with the agent upgrade to version 5.8.1 (resolved in 5.8.2)
    from an older version; have a look at the *Troubleshooting agent upgrade* issues
    recipe and the one after that in [Chapter 9](ch09.html "Chapter 9. Troubleshooting
    VCM"), *Troubleshooting VCM* for how to solve it
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从旧版本升级到5.8.1版本的代理存在一个小bug（已在5.8.2中解决）；请查看[第9章](ch09.html "第9章. 故障排除 VCM")中的*故障排除代理升级*问题食谱及其后面的内容，了解如何解决该问题。
- en: Once the upgrade is complete, roam through the VCM console to have a look at
    whether all the servers that were managed earlier, such as vCenter, vCloud, and
    VCNS, are visible
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 升级完成后，浏览VCM控制台，检查是否所有以前管理的服务器（如vCenter、vCloud和VCNS）都能看到。
- en: There's more...
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: 'If you have designated a managing agent in your infrastructure, then after
    an upgrade, there is a chance that the trust between the managing agent and the
    VCM Collector will be broken. To fix this issue, follow these steps:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在基础设施中指定了管理代理，那么在升级后，管理代理和VCM Collector之间的信任可能会被破坏。为了解决这个问题，请按照以下步骤操作：
- en: Follow the steps of the *Issue 1 - mutual authentication failure* subsection
    of the *Troubleshooting agent communication issues* recipe in [Chapter 9](ch09.html
    "Chapter 9. Troubleshooting VCM"), *Troubleshooting VCM*.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 按照[第9章](ch09.html "第9章. 故障排除 VCM")中*故障排除代理通信问题*一节的*问题1 - 相互认证失败*子节的步骤操作，*故障排除
    VCM*。
- en: 'To re-enable the server as a managing agent, we need VCM Collector to trust
    the server again; for this, log in to VCM console and follow these steps:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 要重新启用服务器作为管理代理，我们需要VCM Collector再次信任该服务器；为此，登录到VCM控制台并按照以下步骤操作：
- en: Go to **Administration**| **Certificate** and select the managing agent server.
    Click on **Change Trust Status** at the top.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**管理**|**证书**，选择管理代理服务器。点击顶部的**更改信任状态**。
- en: In the wizard, select the managing agent machine and tick the **Check to trust
    and uncheck to untrust the selected machine** option.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在向导中，选择管理代理机器，并勾选**选中以信任，取消选中以不信任所选机器**选项。
- en: You should see a handshake sign in front of managing agent server.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该能看到管理代理服务器前的握手标志。
- en: Now, we need to re-enable the old managing agent to do its job again as was
    done in the *Configuring a managing agent machine for virtual environment management*
    recipe in [Chapter 2](ch02.html "Chapter 2. Configuring VCM to Manage Your Infrastructure"),
    *Configuring  VCM to Manage Your Infrastructure*.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要重新启用旧的管理代理，让它像在[第2章](ch02.html "第2章. 配置VCM以管理基础设施")中*配置用于虚拟环境管理的管理代理机器*一节那样继续工作。
- en: Upgrading VCM from a previous version – parallel
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从以前的版本升级VCM——并行升级
- en: If you want to upgrade not only VCM but also the OS underneath it, this is the
    recipe to look at. VCM 5.8.2 now supports Windows Server 2012 R2, and it's a good
    chance to perform an upgrade.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不仅想升级VCM，还想升级其底层的操作系统，那么这就是你需要参考的食谱。VCM 5.8.2现在支持Windows Server 2012 R2，这是进行升级的好机会。
- en: Getting ready
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To start with this activity, you must have all the user accounts in place and
    they must have permissions as described in the first chapter. You must have a
    user apart from the service account, which may be your own account, with admin
    privileges on the VCM Collector server to perform the installation.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始这项工作，你必须确保所有用户账户已经配置好，并且具有第一章中描述的权限。你需要有一个除了服务账户外的用户账户，这个账户可以是你自己的账户，且需要有VCM
    Collector服务器上的管理员权限来执行安装。
- en: If you are using a physical server, then take a backup of the server with the
    tool you are using in your infrastructure; if that Collector server is a virtual
    machine, take a snapshot of the VM.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用的是物理服务器，请使用您在基础设施中使用的工具备份服务器；如果该收集器服务器是虚拟机，请为该虚拟机创建快照。
- en: Take a backup of the databases so that if something goes wrong, you can get
    back to where you were before the upgrade. If you are not aware, you can get help
    from your SQL admin to take a backup of the databases.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 备份数据库，以便在出现问题时能够恢复到升级前的状态。如果您不清楚如何操作，可以向您的 SQL 管理员寻求帮助，以备份数据库。
- en: You must have access to [https://my.vmware.com](https://my.vmware.com) to download
    the latest VCM installation ISO files.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须访问[https://my.vmware.com](https://my.vmware.com)才能下载最新的 VCM 安装 ISO 文件。
- en: Deploy another server with the latest supported OS available with you, that
    is, Windows Server 2008 R2, Windows Server 2012, or Windows Server 2012 R2\. Check
    the VCM requirements in the *Software requirements* subsection under the *Understanding
    the requirements of VCM* recipe in [Chapter 1](ch01.html "Chapter 1. Installing
    VCM"), *Installing VCM*.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 部署另一台最新支持的操作系统服务器，即 Windows Server 2008 R2、Windows Server 2012 或 Windows Server
    2012 R2。请在[第 1 章](ch01.html "第 1 章. 安装 VCM")的*理解 VCM 的要求*部分下查阅 VCM 的要求，*安装 VCM*。
- en: How to do it...
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行此操作...
- en: In the following example, we will perform a parallel upgrade of a two-tier VCM
    deployment.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例中，我们将执行一个两层 VCM 部署的并行升级。
- en: This recipe splits into multiple sections.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱分为多个部分。
- en: Migrating the VCM certificate
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 迁移 VCM 证书
- en: First, we will export the VCM Enterprise certificate and then we will start
    installing VCM.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将导出 VCM 企业证书，然后开始安装 VCM。
- en: 'So, let''s log in to the old VCM server and follow these steps to export the
    certificate:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，让我们登录到旧的 VCM 服务器，并按照以下步骤导出证书：
- en: Launch `mmc.exe` and add a snap-in for **Certificates (Local Computer)**.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动`mmc.exe`并添加**证书（本地计算机）**的管理单元。
- en: Go to **Trusted Root Certification Authority** | **Certificates**; select **VMWare
    VCM Enterprise Certificate...** and right-click on the certificate under **All
    Tasks** | **Export...**:![Migrating the VCM certificate](img/image_07_006.jpg)
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**受信任的根证书颁发机构** | **证书**；选择**VMWare VCM 企业证书...**，然后右键点击证书，选择**所有任务** | **导出...**:![迁移
    VCM 证书](img/image_07_006.jpg)
- en: This will launch the wizard; export the private key.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将启动向导；导出私钥。
- en: 'For the file format, select **Personal Information Exchange** and do the following:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于文件格式，选择**个人信息交换**并执行以下操作：
- en: Include all certificates in the certification path if possible.
  id: totrans-89
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果可能的话，包含证书链中的所有证书。
- en: Export all extended properties.
  id: totrans-90
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导出所有扩展属性。
- en: Type and confirm the password; copy it to a safe place–we will need it later.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入并确认密码；将其保存在安全的位置——我们稍后会用到它。
- en: Provide a name and path to save the file to, and you are done with the certificate
    export.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供一个名称和路径来保存文件，证书导出就完成了。
- en: Follow the same process for the Collector certificate, under **Personal** | **Certificate**.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于证书收集器，在**个人** | **证书**下执行相同的过程。
- en: Copy the certificates to the new VCM server and then import them to the respective
    folders from where they were exported. Use the same password given earlier while
    importing both the certificates.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将证书复制到新的 VCM 服务器，然后从导出的原文件夹中导入它们。导入这两个证书时，请使用之前设置的相同密码。
- en: '*Shut down* the old VCM server after *disabling and stopping VCM services*
    on the server.'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在*禁用并停止 VCM 服务*后，*关闭*旧的 VCM 服务器。
- en: Migrating VCM to the new server
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将 VCM 迁移到新服务器
- en: 'Once the certificate is available, we can start deploying a new VCM instance
    by following these steps:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦证书可用，我们可以通过以下步骤开始部署新的 VCM 实例：
- en: Log in to the newly created VCM server and mount the VCM installer ISO downloaded
    from [https://my.vmware.com/](https://my.vmware.com/).
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到新创建的 VCM 服务器并挂载从[https://my.vmware.com/](https://my.vmware.com/)下载的 VCM 安装
    ISO。
- en: Navigate to the mounted ISO, right-click on `setup.exe`, and select **Run as
    Administrator**.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到挂载的 ISO，右键点击`setup.exe`，选择**以管理员身份运行**。
- en: Choose **Advanced Installation**.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**高级安装**。
- en: Click on **Next** for the introduction page.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**下一步**进入介绍页面。
- en: Click on **Next** for the patent information page.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**下一步**以进入专利信息页面。
- en: Read and accept the license agreement and select **I am an authorized agent
    and/or representative of the customer/end user** and **I have read the terms and
    conditions stated above**.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 阅读并接受许可协议，选择**我为客户/最终用户的授权代理人和/或代表**和**我已阅读上述条款和条件**。
- en: 'Under **Select Installation Type**, select the following:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择安装类型**下，选择以下选项：
- en: '**VMware vRealize Configuration Manager**'
  id: totrans-105
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VMware vRealize配置管理器**'
- en: '**VCM Web Console**'
  id: totrans-106
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM Web控制台**'
- en: '**VCM Collector Components**'
  id: totrans-107
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM收集器组件**'
- en: '**Tools**'
  id: totrans-108
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**工具**'
- en: '**Import Export Utility**'
  id: totrans-109
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导入导出工具**'
- en: '**Foundation Checker**'
  id: totrans-110
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基础检查器**'
- en: '**VMware VCM package manager for Windows**'
  id: totrans-111
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VMware VCM包管理器（Windows版）**'
- en: '**VMware VCM package Studio**'
  id: totrans-112
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VMware VCM包工作室**'
- en: The installer will perform a prerequisite check and present the results on successful
    checks. Click on **Next**; if there are failures, click on **View Results**, remedy
    any errors and warnings, and perform a recheck.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装程序将执行先决条件检查，并在检查成功时显示结果。点击**下一步**；如果有失败，请点击**查看结果**，解决任何错误和警告，然后重新检查。
- en: Tip
  id: totrans-114
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Do not proceed further until there are zero errors.
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在没有错误之前不要继续。
- en: On the next page, enter the serial key.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，输入序列号。
- en: On the **Configure Components** page, provide the hostname of the SQL server
    that was used with the earlier VCM instance and VCM as the database name (if you
    have named the VCM database with a different name, then provide that name) and
    click on **Validate**:![Migrating VCM to the new server](img/image_07_007.jpg)
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**配置组件**页面，提供与早期VCM实例一起使用的SQL服务器的主机名和VCM作为数据库名称（如果你将VCM数据库命名为其他名称，请提供该名称），然后点击**验证**：![迁移VCM到新服务器](img/image_07_007.jpg)
- en: On the next page, provide the Tomcat service account and its password.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，提供Tomcat服务账户及其密码。
- en: On the next page, provide the details in **WebService URL** (this is the path
    to the SQL server–the same as the old VCM deployment). Provide the path to install
    the web console. Check out the following screenshot for more details:![Migrating
    VCM to the new server](img/image_07_008.jpg)
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，提供**WebService URL**中的详细信息（这是SQL服务器的路径——与旧VCM部署相同）。提供安装Web控制台的路径。以下截图提供更多详情：![迁移VCM到新服务器](img/image_07_008.jpg)
- en: Provide a URL to the application; the default is fine.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供应用程序的URL，默认即可。
- en: We can provide an SMTP address; the default is the Collector server's. If you
    don't know it right now, this can be configured in the VCM console later.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以提供SMTP地址；默认是收集器服务器的。如果你现在不知道，也可以稍后在VCM控制台中配置。
- en: Provide the path for installing the Collector component and accept the SSL3
    warning.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供安装收集器组件的路径并接受SSL3警告。
- en: Provide the path to store staging data; this is the path where data is temporarily
    stored before adding it to the database.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供用于存储暂存数据的路径；这是在将数据添加到数据库之前暂时存储数据的路径。
- en: Provide the details of the Collector service account; this account will be given
    rights to log in as a service; accept the prompt.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供收集器服务账户的详细信息；该账户将被授予作为服务登录的权限；接受提示。
- en: Provide details of the network authority account; we can add as many accounts
    as we want later. We need at least one for the time being. More details about
    this account can be found under the *Service accounts* section in [Chapter 1](ch01.html
    "Chapter 1. Installing VCM"), *Installing VCM*.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供网络权限账户的详细信息；我们可以稍后添加任意多个账户。目前我们至少需要一个。关于此账户的更多信息可以在[第1章](ch01.html "第1章 安装VCM")的*服务账户*部分中找到，*安装VCM*。
- en: The next page is for the certificate; here, we need to reuse the certificate
    exported from the old VCM server.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一页是证书页面；在这里，我们需要重用从旧的VCM服务器导出的证书。
- en: Click on **Select** and provide the Collector and Enterprise certificates:![Migrating
    VCM to the new server](img/image_07_009.jpg)
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**选择**并提供收集器和企业证书：![迁移VCM到新服务器](img/image_07_009.jpg)
- en: Provide details about Virtual Directory and the credentials to access it.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供虚拟目录的详细信息以及访问它的凭证。
- en: Provide the credentials for the Virtualization Client plugin.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供虚拟化客户端插件的凭证。
- en: On the next page, provide the path to install the package manager components
    to.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，提供安装包管理器组件的路径。
- en: On the next page, provide the path to the local package cache.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，提供本地包缓存的路径。
- en: On the next page, provide the path for the software repository and local cache.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，提供软件库和本地缓存的路径。
- en: Provide a Virtual Directory name.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供虚拟目录名称。
- en: Provide the path for the Package Studio components.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供包工作室组件的路径。
- en: Finally, you will reach the summary page. Check the options and click on **Install**:![Migrating
    VCM to the new server](img/image_07_010.jpg)
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '最后，你将进入总结页面。检查选项并点击**安装**: ![迁移VCM到新服务器](img/image_07_010.jpg)'
- en: Once VCM is installed successfully, log in to the console with the account you
    used to install VCM. Check whether all the managed machines are available and
    all the virtual infrastructure elements you configured are present.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦VCM成功安装，使用安装VCM时所用的账户登录控制台。检查所有受管机器是否可用，以及你配置的所有虚拟基础设施元素是否存在。
- en: Also check the version–it should be **5.8.2.160**, as in the following screenshot:![Migrating
    VCM to the new server](img/image_07_011.jpg)
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 还要检查版本—它应该是**5.8.2.160**，如下截图所示：![迁移VCM到新服务器](img/image_07_011.jpg)
- en: Perform a collection of any managed VMs available on the console.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对控制台上任何可用的受管虚拟机进行采集。
- en: How it works...
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: We went to the latest Windows OS and then migrated the VCM installation to give
    us the edge, that is, if you are on an older version of the OS that is not supported
    by Microsoft or not supported as a *base* OS for VCM, then you can migrate retaining
    all the old data. You can perform a hardware refresh if your old server was on
    a physical server.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 我们升级到了最新的Windows操作系统，然后将VCM安装迁移，以获得优势。也就是说，如果你使用的是微软不再支持的旧版本操作系统，或者该操作系统不被支持作为VCM的*基础*操作系统，那么你可以在保留所有旧数据的情况下进行迁移。如果你的旧服务器是物理服务器，还可以进行硬件刷新。
- en: When we perform a parallel upgrade, we migrate from the old operating system
    but still using the old database. As we keep the old database, all the data collected
    is retained after the upgrade. We have all the agents and all the already configured
    vCenter servers. This helps in keeping our old configuration with the latest build
    of VCM and the latest supported base OS.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们执行并行升级时，我们从旧操作系统迁移，但仍然使用旧数据库。由于保留了旧数据库，因此所有采集的数据在升级后都会保留下来。我们保留了所有代理和所有已经配置的vCenter服务器。这有助于我们将旧配置与VCM的最新版本和最新支持的基础操作系统保持一致。
- en: Selecting the right certificate is the key to success here. As you know, the
    certificate is used by agents when we install them. If we regenerate or use the
    wrong certificate, the agent-server communication will break and we will be forced
    to install a new agent with the latest certificate from the server.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 选择正确的证书是成功的关键。如你所知，安装代理时会使用证书。如果我们重新生成或使用错误的证书，代理与服务器之间的通信将中断，届时我们将不得不安装一个新的代理，并从服务器获取最新的证书。
- en: Aftercare
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 后续操作
- en: Refer to the corresponding section of the previous recipe for aftercare instructions.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考前一个食谱中相应部分的后续操作说明。
- en: There's more...
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Refer to the corresponding section of the previous recipe. The same steps need
    to be followed.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考前一个食谱中的相应部分。需要按照相同的步骤进行。
- en: Migrating VCM from another domain
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将VCM从一个域迁移到另一个域
- en: There are scenarios in which we need to migrate from one domain to another and
    can't afford to lose all the historical data of our managed machines. In this
    recipe, we will look at how to migrate the VCM server from an old domain to a
    new domain.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，我们需要从一个域迁移到另一个域，并且不能丢失我们管理的机器的所有历史数据。在本食谱中，我们将查看如何将VCM服务器从旧域迁移到新域。
- en: Getting ready
  id: totrans-149
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Make sure that the network and DNS (forward and reverse) is correct for the
    VCM Collector server. Add the VCM Collector to the new domain and create or identify
    the domain account that you want to use, as described in *Service accounts* subsection
    under the *Understanding the requirements of VCM* recipe in [Chapter 1](ch01.html
    "Chapter 1. Installing VCM"), *Installing VCM*.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 确保VCM收集器服务器的网络和DNS（正向和反向）配置正确。将VCM收集器添加到新域中，并根据[第1章](ch01.html "第1章. 安装VCM")中*理解VCM的要求*小节下的*服务账户*部分的描述，创建或识别你要使用的域账户。
- en: How to do it...
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To change VCM service accounts to run under a different domain account, follow
    these steps:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 要将VCM服务账户更改为使用不同的域账户运行，请按照以下步骤操作：
- en: 'On the VCM database server, run the following SQL update queries against the
    core VCM database. Make the appropriate name substitutions:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在VCM数据库服务器上，运行以下SQL更新查询，针对核心VCM数据库进行操作。根据需要替换适当的名称：
- en: '[PRE0]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Select and stop the following services:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择并停止以下服务：
- en: '**VCM Collector**'
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM收集器**'
- en: '**VCM Database Service**'
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM数据库服务**'
- en: '**VCM Patch Management**'
  id: totrans-158
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM补丁管理**'
- en: Right-click on each service, select **Properties**, and select the **Log On**
    tab.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击每个服务，选择**属性**，然后选择**登录**选项卡。
- en: Change the account credentials to the new account, and click on **OK**.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将账户凭据更改为新账户，并点击 **确定**。
- en: Go to **Start** | **Administrative Tools** | **Component Services**.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **开始** | **管理工具** | **组件服务**。
- en: On the left, go to **Console Root** | **Component Services** | **Computers**
    | **My Computer** | **DCOM Config** | **LicenseDcom**.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧，进入 **控制台根** | **组件服务** | **计算机** | **我的电脑** | **DCOM 配置** | **LicenseDcom**。
- en: Right-click, select **Properties**, and select the **Identity** tab.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击，选择 **属性**，然后选择 **身份** 标签。
- en: Select **This** user, enter the new domain account credentials, and click on
    **OK**.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 **此** 用户，输入新域账户凭据，并点击 **确定**。
- en: From **Start** | **Administrative Tools** | **Services**, restart the services
    you stopped.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 **开始** | **管理工具** | **服务**，重新启动你停止的服务。
- en: Go to **Start** | **Administrative Tools** | **Server Manager**.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **开始** | **管理工具** | **服务器管理器**。
- en: On the left, navigate to **Server Manager** (hostname) | **Configuration** | **Local
    Users and Groups**.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧，导航到 **服务器管理器**（主机名） | **配置** | **本地用户和组**。
- en: Double-click on **Groups**.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击 **组**。
- en: Select `VCM_LDP_GROUP`, right-click, and select **Properties**.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 `VCM_LDP_GROUP`，右键点击并选择 **属性**。
- en: Remove the old account and add the new one.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除旧账户并添加新账户。
- en: Navigate to **Server Manager** (hostname) | **Configuration** | **Services**,
    double-click on **Groups**, select `CSI_COMM_PROXY_SVC`, and repeat the process
    for replacing the account.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 **服务器管理器**（主机名） | **配置** | **服务**，双击 **组**，选择 `CSI_COMM_PROXY_SVC`，并重复此过程来更换账户。
- en: Note
  id: totrans-172
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that if you run the **Repair** option of the VCM installer, account changes
    revert to what you specified during installation.
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意，如果你运行 VCM 安装程序的 **修复** 选项，账户更改会恢复为安装时所指定的账户。
- en: Note that if you run the VCM installer to upgrade to a newer version of VCM,
    account changes default to what you specified during the older installation. Enter
    the account changes that you want during the upgrade process.
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意，如果你运行 VCM 安装程序来升级到 VCM 的新版本，账户更改将默认为你在旧版本安装时所指定的账户。升级过程中请输入你想要的账户更改。
- en: Add the new domain to the network authority in VCM.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将新域添加到 VCM 的网络权限中。
- en: Add any new users required for the new domain.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加新域所需的任何新用户。
- en: How it works...
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: VCM runs its services under accounts that you specify during installation. After
    installing VCM, the conditions at your site might require that you change from
    running under the initial domain account to a different domain account.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 在安装时使用你指定的账户运行服务。安装完 VCM 后，你的站点条件可能需要你将服务的运行账户从最初的域账户更改为其他域账户。
- en: This procedure also applies when you need to change from running under a built-in
    Windows account to a domain account. To change from domain accounts to built-in
    accounts, refer to the next recipe, where we provide new credentials to run services
    in the new domain and retain historical data in VCM.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 此过程同样适用于你需要将服务从内置 Windows 账户更改为域账户的情况。要从域账户更改为内置账户，请参阅下一个操作步骤，我们将在那里提供新的凭据来运行新域中的服务，并在
    VCM 中保留历史数据。
- en: Applying a new license key
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 应用新许可证密钥
- en: You might have had a temporary license key when you installed VCM or the infrastructure
    might have grown more than you expected and you now need to provide new licenses
    to manage the infrastructure. This is where you need to provide new keys, and
    entering a new serial key is not a straightforward console option; there is a
    command-line utility called **jlicense.cmd** available to do this.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在你安装 VCM 时，你可能使用了临时许可证密钥，或者基础设施的规模可能比预期增长，现在你需要提供新的许可证来管理基础设施。此时，你需要提供新密钥，输入新的序列密钥并不是一个简单的控制台选项；这里有一个名为
    **jlicense.cmd** 的命令行工具可以帮助你完成此操作。
- en: Getting ready
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: Get the new key to be used. You must have VCM admin access on the VCM console.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 获取要使用的新密钥。你必须在 VCM 控制台上拥有管理员权限。
- en: How to do it...
  id: totrans-184
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Log in to the VCM server with VCM admin privileges, and follow these steps:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 VCM 管理员权限登录到 VCM 服务器，并按照以下步骤操作：
- en: Launch CMD with administrative privileges and go to `X:\Program Files (x86)\VMware\VCM\Tools`
    (*X* is the drive where VCM is installed).
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以管理员权限启动 CMD，并进入 `X:\Program Files (x86)\VMware\VCM\Tools`（*X* 是 VCM 安装所在的驱动器）。
- en: 'Run `jlicense.cmd -k xxxxx-xxxxx-xxxxx-xxxxx-xxxxx` (this is the new key you
    want to add to VCM), as shown in the following screenshot:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 `jlicense.cmd -k xxxxx-xxxxx-xxxxx-xxxxx-xxxxx`（这是你要添加到 VCM 的新密钥），如以下截图所示：
- en: '![How to do it...](img/image_07_012.jpg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/image_07_012.jpg)'
- en: How it works...
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: It will append to the already available capacity of VCM, that is, the number
    of machines we can manage and the expiration date of the key.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 它将附加到VCM的现有容量上，也就是说，它将增加我们可以管理的机器数量以及密钥的过期日期。
- en: 'Using the **jlicense.cmd** utility, you can:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**jlicense.cmd**工具，您可以：
- en: Update a single license key for servers
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新单个服务器的许可证密钥
- en: Update a single license key for workstations
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新单个工作站的许可证密钥
- en: Enter two keys for servers and workstations
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输入服务器和工作站的两个密钥
- en: Enter a single license key for servers or workstations or enter two license
    keys for both servers and workstations
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输入单个服务器或工作站的许可证密钥，或者输入两个用于服务器和工作站的许可证密钥。
- en: 'Here''s how to use the JLicense tool:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是如何使用JLicense工具：
- en: 'To display the JLicense help information, run this command: `jlicense -h`'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 若要显示JLicense帮助信息，请运行以下命令：`jlicense -h`
- en: 'To evaluate the license key but not to install it, run this command:'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 若要评估许可证密钥但不安装它，请运行以下命令：
- en: '[PRE1]'
  id: totrans-199
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Here, `xxxxx-xxxxx-xxxxx-xxxxx-xxxxx` is the license key
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此，`xxxxx-xxxxx-xxxxx-xxxxx-xxxxx`是许可证密钥
- en: 'To change a license, run this command:'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要更改许可证，请运行以下命令：
- en: '[PRE2]'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Here, `xxxxx-xxxxx-xxxxx-xxxxx-xxxxx` is the license key
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此，`xxxxx-xxxxx-xxxxx-xxxxx-xxxxx`是许可证密钥
- en: Upgrading VCM agents
  id: totrans-204
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 升级VCM代理
- en: After an upgrade of the VCM server, you need to upgrade the VCM agent. This
    recipe deals with the Windows and Linux VCM agent upgrades from their previous
    versions.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在VCM服务器升级后，您需要升级VCM代理。本篇内容涉及Windows和Linux的VCM代理从先前版本的升级。
- en: Getting ready
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You must have some old agents to be upgraded to the latest version and they
    should be communicating with VCM server.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须拥有一些旧版代理，以便将它们升级到最新版本，并且它们应该与VCM服务器进行通信。
- en: How to do it...
  id: totrans-208
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行...
- en: There are two ways to upgrade the agent in the case of Windows. From the console,
    you can choose **Upgrade** as an option, or you can choose Install and in the
    wizard choose **Remove Current Agent** from the machine. Both the processes do
    the same thing–upgrading the agent to the latest build–but **Install with Remove
    Current** version takes more time. Both the options retain all the old collected
    data.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows的情况下，有两种方式来升级代理。从控制台中，您可以选择**升级**作为选项，或者选择安装并在向导中选择**移除当前代理**。这两个过程都完成同一任务——将代理升级到最新版本——但**安装并移除当前版本**需要更多时间。两种选项都保留所有以前收集的数据。
- en: We will use the **Upgrade** method in this recipe.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本篇中使用**升级**方法。
- en: Windows
  id: totrans-211
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Windows
- en: 'This is the way to do it in Windows:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 这是在Windows中执行的方法：
- en: Log in to VCM with administrative privileges.
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用管理员权限登录VCM。
- en: Navigate to **Administration** | **Machines Manager** | **Licensed Machines**
    | **Licensed Windows Machines**.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**管理** | **机器管理器** | **授权机器** | **授权Windows机器**。
- en: Right-click on the machine and select **Upgrade Agent**:![Windows](img/image_07_013.jpg)
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击机器并选择**升级代理**:![Windows](img/image_07_013.jpg)
- en: On the **Machines** page, select the Windows machines to upgrade and click on
    the arrow to move the machines to the selected pane. Click on **Next**.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**机器**页面，选择要升级的Windows机器，并点击箭头将机器移至选定面板。点击**下一步**。
- en: On the installation options page, select or verify the option for the agent
    installation, and click on **Next**.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装选项页面，选择或验证代理安装选项，并点击**下一步**。
- en: On the **Schedule** page, schedule the operation and click on **Next**.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**计划**页面，安排操作并点击**下一步**。
- en: On the **Important** page, verify the summary and click on **Finish**.
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**重要**页面，验证摘要并点击**完成**。
- en: Click on the **Jobs** button and see whether the job is completed successfully.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**作业**按钮，查看作业是否已成功完成。
- en: Once the job is finished, check the console for the agent version. It should be
    the latest one, as in the following screenshot:![Windows](img/image_07_014.jpg)
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作业完成后，检查控制台以查看代理版本。它应该是最新版本，如下图所示：![Windows](img/image_07_014.jpg)
- en: Linux
  id: totrans-222
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Linux
- en: 'Here''s how to do it in Linux:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在Linux中执行的方法：
- en: Log in to VCM with administrative privileges.
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用管理员权限登录VCM。
- en: Click on **Console** and go to **UNIX Remote Commands** | **UNIX Agent Upgrade**.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**控制台**，并进入**UNIX远程命令** | **UNIX代理升级**。
- en: In the **UNIX Agent Upgrade** data grid, click on the appropriate remote upgrade
    package for the operating system and the version of the machines to upgrade:![Linux](img/image_07_015.jpg)
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**UNIX代理升级**数据网格中，点击适合操作系统和机器版本的远程升级包：![Linux](img/image_07_015.jpg)
- en: Click on **Run** and follow the wizard to send the remote command and upgrade
    packages on the agents on the selected machines.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**运行**，并按照向导将远程命令和升级包发送到所选机器上的代理。
- en: The agents will execute the package upgrade.
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 代理将执行包升级。
- en: Select the managed machine whose agent you want to upgrade.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择你想要升级代理的管理机器。
- en: On the **Schedule** page, select **Run Remote Command Now** or schedule the
    operation for later and click on **Next**.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**计划**页面，选择**立即运行远程命令**或安排稍后操作，然后点击**下一步**。
- en: On the **Important** page, verify the summary and click on **Finish**.
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**重要**页面，验证总结并点击**完成**。
- en: Verify that the job completes successfully.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证任务是否成功完成。
- en: Perform a collection on the managed machine.
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在管理机器上执行一次收集。
- en: Check the status of the agent on the console of VCM; it should look something
    like the following screenshot:![Linux](img/image_07_016.jpg)
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在VCM控制台上检查代理的状态；它应该看起来像下面的截图：![Linux](img/image_07_016.jpg)
- en: How it works...
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We push the latest installer from the VCM console, it gets copied to the managed
    machine, starts upgrading the old agent files, and finally creates a VCM service
    on the managed machines and comes back with a status of success.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从VCM控制台推送最新的安装程序，它被复制到管理机器上，开始升级旧的代理文件，最终在管理机器上创建一个VCM服务，并返回成功状态。
- en: You can perform a collection after the agent is installed to be sure nothing
    was broken during the upgrade.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 代理安装完成后，你可以执行一次收集，以确保升级过程中没有出现任何问题。
- en: In case of a Linux upgrade, the process copies the latest agent installer from
    the VCM console along with the remote command to run on the Linux/Unix machine.
    Then, it executes the script to install the agent.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux升级的情况下，过程将从VCM控制台复制最新的代理安装程序，并附带在Linux/Unix机器上运行的远程命令。然后，执行脚本来安装代理。
- en: There's more...
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: It is observed that after most of the agent or server upgrades, we need to perform
    the steps as described in the *Issue 1 - mutual authentication failure* subsection
    of the *Troubleshooting agent communication issues* recipe in [Chapter 9](ch09.html
    "Chapter 9. Troubleshooting VCM"), *Troubleshooting VCM*, as the trust between
    the upgraded agent and VCM Collector is broken.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 观察到在大多数代理或服务器升级后，我们需要按照*问题 1 - 互认证失败*小节中的步骤操作，*故障排除代理通信问题*配方，见[第9章](ch09.html
    "第9章。故障排除VCM")，*故障排除VCM*，因为升级后的代理与VCM收集器之间的信任被破坏。
- en: You will see the error message described in the previous recipe, so simply follow
    the steps to resolve it.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到前面配方中描述的错误消息，因此只需按照步骤解决即可。
- en: See also
  id: totrans-242
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: There is a small bug with the agent upgrade to version 5.8.1 (resolved in 5.8.2)
    from an older version; have a look at the *Troubleshooting agent upgrade* issues
    recipe in [Chapter 9](ch09.html "Chapter 9. Troubleshooting VCM"), *Troubleshooting
    VCM*
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在从旧版本升级到5.8.1版本的代理时，有一个小bug（在5.8.2中已解决）；请查看[第9章](ch09.html "第9章。故障排除VCM")中的*故障排除代理升级*问题配方，*故障排除VCM*。
- en: Changing service account passwords
  id: totrans-244
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更改服务账户密码
- en: There are occasions when we need to change passwords for service accounts; in
    this recipe, we will learn how to.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 有时我们需要更改服务账户的密码；在这个配方中，我们将学习如何操作。
- en: Getting ready
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: You must have new passwords available to be replaced.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 你必须有新的密码可供替换。
- en: How to do it...
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: We'll look at the various service accounts used by VCM that we can change if
    we want to.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将查看VCM使用的各种服务账户，如果需要，我们可以更改它们。
- en: To update a password for VCM service accounts, follow these steps.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 要更新VCM服务账户的密码，请按以下步骤操作。
- en: Collector service accounts
  id: totrans-251
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 收集器服务账户
- en: On the Collector, go to **Start |** **Administrative Tools** | **Services**.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在收集器上，转到**开始** | **管理工具** | **服务**。
- en: 'Select and stop the following services:'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择并停止以下服务：
- en: '**VCM Collector**'
  id: totrans-254
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM 收集器**'
- en: '**VCM Database Service**'
  id: totrans-255
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM 数据库服务**'
- en: '**VCM Patch Management**'
  id: totrans-256
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VCM 补丁管理**'
- en: Right-click on each service, select **Properties**, and select the **Log On**
    tab.
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击每个服务，选择**属性**，然后选择**登录**标签。
- en: Update the account password and click on **OK**.
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更新账户密码并点击**确定**。
- en: Go to **Start** | **Administrative Tools** | **Component Services**.
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**开始** | **管理工具** | **组件服务**。
- en: On the left, go to **Console Root** | **Component Services** | **Computers**
    | **My Computer** | **DCOM Config** | **LicenseDcom**.
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧，转到**控制台根目录** | **组件服务** | **计算机** | **我的计算机** | **DCOM 配置** | **LicenseDcom**。
- en: Right-click, select **Properties**, and select the **Identity** tab.
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击，选择**属性**，然后选择**身份**标签。
- en: Under **This** user, update the password and click on **OK**.
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**此**用户下，更新密码并点击**确定**。
- en: VCM remote service accounts
  id: totrans-263
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: VCM远程服务账户
- en: We provided details about the VCM remote user when we performed the installation.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在安装过程中提供了VCM远程用户的详细信息。
- en: 'The VCM remote service account is used by the VCM remote client for anonymous
    access to the VCM remote virtual directory on the web server. Follow these steps:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: VCM远程服务帐户由VCM远程客户端用于匿名访问Web服务器上的VCM远程虚拟目录。请按照以下步骤操作：
- en: On the web server, go to **Start** | **Administrative Tools** |** IIS Manager**.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Web服务器上，进入**开始** | **管理工具** | **IIS管理器**。
- en: On the left, navigate to **{web-server-hostname}** | **Sites** | **Default Web
    Site** | **ECMRemoteHTTP**.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧，导航到**{web-server-hostname}** | **站点** | **默认网站** | **ECMRemoteHTTP**。
- en: Double-click on **Authentication**.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击**身份验证**。
- en: Select **Anonymous Authentication**.
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**匿名身份验证**。
- en: In the **Actions** pane on the right, select **Edit**.
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在右侧的**操作**窗格中，选择**编辑**。
- en: Click on **Set**.
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**设置**。
- en: Enter the existing domain/username, then the new password, and click on **OK**.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入现有的域名/用户名，然后输入新密码，点击**确定**。
- en: Navigate to **{web-server-hostname}** | **Sites** | **Default Web Site** | **VCMRemote**,
    and repeat the steps to change the password.
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**{web-server-hostname}** | **站点** | **默认网站** | **VCMRemote**，并重复这些步骤来更改密码。
- en: '**Network authority accounts**'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络权限帐户**'
- en: 'Follow these steps for a network authority account:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 请按照以下步骤为网络权限帐户操作：
- en: In VCM, click on **Administration** and go to **Settings** | **Network Authority**
    | **Available Accounts.**
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在VCM中，点击**管理**，进入**设置** | **网络权限** | **可用帐户**。
- en: Click on **Edit Password**.
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**编辑密码**。
- en: '**SSRS**'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSRS**'
- en: For an SSRS account, run the `RSConfig` command to change the embedded account
    information.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 对于SSRS帐户，请运行`RSConfig`命令以更改嵌入的帐户信息。
- en: How it works...
  id: totrans-280
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: VCM runs its services under accounts that you specify during installation. After
    installing VCM, conditions at your site might require that passwords on the accounts
    be changed, making it necessary to update the passwords in VCM as well.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: VCM在安装过程中运行在您指定的帐户下。安装VCM后，您所在位置的条件可能要求更改帐户的密码，这时也需要在VCM中更新密码。
- en: We can make those changes using the steps we just went through.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用刚才讲解的步骤进行这些更改。
- en: Managing users
  id: totrans-283
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理用户
- en: You need to manage VCM logins and assign roles to users who have access to VCM.
    Roles determine the level of access for each user and can be adjusted for access
    to specific machine groups and VCM functionality.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要管理VCM登录并分配角色给有访问权限的用户。角色决定每个用户的访问级别，可以针对特定机器组和VCM功能进行调整。
- en: Getting ready
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: If you are planning to create custom roles, they must be ready before starting
    this recipe.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您计划创建自定义角色，它们必须在开始本步骤之前准备好。
- en: How to do it...
  id: totrans-287
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to add new users and groups and give them appropriate permissions:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤添加新用户和组，并授予他们适当的权限：
- en: Navigate to **Administration** | **User Manager** | **VCM Logins**.
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**管理** | **用户管理器** | **VCM登录**。
- en: Click on **Add Users**.
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加用户**。
- en: Note
  id: totrans-291
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that you cannot add the Collector service account as a VCM login.
  id: totrans-292
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，您不能将Collector服务帐户添加为VCM登录。
- en: Select **Enter Domain Account** and click on **Next**.
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**输入域帐户**并点击**下一步**。
- en: Note
  id: totrans-294
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that individual Active Directory accounts can also be added. Adding a group
    ensures that role-based access is governed by Active Directory.
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，也可以添加单个Active Directory帐户。添加组确保通过Active Directory进行基于角色的访问控制。
- en: Enter the security group in the `DOMAIN\Group` format and click on **Next**.
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`DOMAIN\Group`格式的安全组并点击**下一步**。
- en: Double-click on **Admin** (or a lesser role for general access) and click on
    **Next**.
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击**管理员**（或用于一般访问的较低角色），点击**下一步**。
- en: Click on **Finish**.
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**。
- en: How it works...
  id: totrans-299
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When VCM is installed, the user who installs it gets administrative access on
    the console. We need to add users or groups to give them access. By following
    this recipe, we can add users who need access.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 当VCM安装时，安装者会在控制台上获得管理员权限。我们需要添加用户或组来授予他们访问权限。通过遵循这个步骤，我们可以为需要访问的用户添加权限。
- en: Note
  id: totrans-301
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that when a user starts VCM, if more than one role is assigned to their
    login, a drop-down list appears and allows the user to select the desired role.
    To automatically log in to VCM using a particular role, users can check the ****Automatically**
    log in using this role** option. To switch roles or not log in automatically,
    users can select a different role or uncheck this option.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，当用户启动 VCM 时，如果分配了多个角色到他们的登录账户，会出现一个下拉列表，允许用户选择所需的角色。要使用特定角色自动登录 VCM，用户可以勾选
    **自动使用此角色登录** 选项。要切换角色或不自动登录，用户可以选择不同的角色或取消勾选此选项。
- en: Default roles
  id: totrans-303
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 默认角色
- en: 'This is the list of default roles available with VCM and a short description
    of each of them:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 VCM 默认角色列表及每个角色的简短描述：
- en: '| **Sr. no.** | **Name** | **Description** |'
  id: totrans-305
  prefs: []
  type: TYPE_TB
  zh: '| **序号** | **名称** | **描述** |'
- en: '| **1** | Admin | Top-level role. Admin has rights to everything in the database.
    |'
  id: totrans-306
  prefs: []
  type: TYPE_TB
  zh: '| **1** | 管理员 | 顶级角色。管理员对数据库中的所有内容都有权限。 |'
- en: '| **2** | Domain Controller Manager | Role with full access to the Domain Controllers
    dynamic machine group. |'
  id: totrans-307
  prefs: []
  type: TYPE_TB
  zh: '| **2** | 域控制器管理员 | 对域控制器动态机器组具有完全访问权限的角色。 |'
- en: '| **3** | Read-Only | Role with read access to all machines and data. |'
  id: totrans-308
  prefs: []
  type: TYPE_TB
  zh: '| **3** | 只读 | 仅对所有机器和数据具有读取权限的角色。 |'
- en: '| **4** | Help Desk | Only allows password changes on domain controllers. |'
  id: totrans-309
  prefs: []
  type: TYPE_TB
  zh: '| **4** | 帮助台 | 仅允许更改域控制器的密码。 |'
- en: '| **5** | IIS Admins | Role with full access to the Microsoft Internet Information
    Servers dynamic machine group. |'
  id: totrans-310
  prefs: []
  type: TYPE_TB
  zh: '| **5** | IIS 管理员 | 对 Microsoft Internet Information Servers 动态机器组具有完全访问权限的角色。
    |'
- en: '| **6** | Server Managers | Role with full access to the Servers dynamic machine
    group. |'
  id: totrans-311
  prefs: []
  type: TYPE_TB
  zh: '| **6** | 服务器管理者 | 对服务器动态机器组具有完全访问权限的角色。 |'
- en: '| **7** | SQL Server Admins | Role with full access to the Microsoft SQL Servers
    dynamic machine group. |'
  id: totrans-312
  prefs: []
  type: TYPE_TB
  zh: '| **7** | SQL Server 管理员 | 对 Microsoft SQL Server 动态机器组具有完全访问权限的角色。 |'
- en: '| **8** | Workstation Managers | Role with full access to the Workstation dynamic
    machine group. |'
  id: totrans-313
  prefs: []
  type: TYPE_TB
  zh: '| **8** | 工作站管理员 | 对工作站动态机器组具有完全访问权限的角色。 |'
- en: '| **9** | VCM Auditor | Role with read access to License Manager. |'
  id: totrans-314
  prefs: []
  type: TYPE_TB
  zh: '| **9** | VCM 审计员 | 具有对许可证管理器的读取权限的角色。 |'
- en: '| **10** | `AD_Admin` | Built in role with access to AD data and Administration
    for AD. |'
  id: totrans-315
  prefs: []
  type: TYPE_TB
  zh: '| **10** | `AD_Admin` | 内置角色，具有访问 AD 数据和 AD 管理的权限。 |'
- en: '| **11** | `AD_User` | Built in role with access to AD data only. |'
  id: totrans-316
  prefs: []
  type: TYPE_TB
  zh: '| **11** | `AD_User` | 内置角色，仅具有访问 AD 数据的权限。 |'
- en: '| **12** | Change Restricted | VCM **Change Restricted** role.With this role,
    users can discover machines, collect data from them, assess them, display bulletin
    and template details, check for updates, and view history. Users can add, edit,
    and delete reports, compliance rules and rule groups, and compliance and patch
    assessment templates. Users with the **Change Restricted** role can also install
    the VCM agent, upgrade VCM, and uninstall it. |'
  id: totrans-317
  prefs: []
  type: TYPE_TB
  zh: '| **12** | 变更受限 | VCM **变更受限** 角色。拥有此角色的用户可以发现机器，从中收集数据，评估它们，显示公告和模板详情，检查更新并查看历史记录。用户可以添加、编辑和删除报告、合规性规则和规则组，以及合规性和补丁评估模板。拥有
    **变更受限** 角色的用户还可以安装 VCM 代理、升级 VCM 或卸载它。 |'
- en: There's more...
  id: totrans-318
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: When creating a role, we need to understand access rules as they define the
    areas of VCM that users can access and the actions that they can perform.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建角色时，我们需要了解访问规则，因为它们定义了用户可以访问的 VCM 区域以及他们可以执行的操作。
- en: VCM roles and access rules go hand in hand; roles define which areas can be
    accessed by whom while rules define what kind of access is provided to the user,
    such as **None**, **Read Only**, **Full Access,** or **Custom**. When you select
    **Custom**, it goes to a very granular level and you can select a single privilege,
    such as only **Add Automatic Deployment** or **Run a Report**.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 角色和访问规则是相辅相成的；角色定义了谁可以访问哪些区域，而规则定义了用户可以获得的访问权限类型，如 **无权限**、**只读**、**完全访问**
    或 **自定义**。当您选择 **自定义** 时，它将细化到非常具体的权限，您可以选择单个特权，如仅 **添加自动部署** 或 **运行报告**。
- en: 'You can either use the 14 default access rules or you can create new ones as
    per your requirement:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用 14 个默认访问规则，或根据您的需求创建新的规则：
- en: To create a new access rule, log in to the VCM console, go to **Administration **| **User
    Manager** | **VCM Access** | **Access Rules**, and click on **Add Rule**.
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建新的访问规则，请登录 VCM 控制台，进入 **管理** | **用户管理** | **VCM 访问** | **访问规则**，然后点击 **添加规则**。
- en: Provide a nice name and description.
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供一个友好的名称和描述。
- en: Under **Rule Type**, select **Basic Rule** (this defines data types and areas
    of VCM to access) or **Admin Access Rule** (to access administrative areas of
    VCM).
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **规则类型** 下，选择 **基础规则**（这定义了要访问的 VCM 数据类型和区域）或 **管理员访问规则**（访问 VCM 管理区域）。
- en: For **Basic Rule**, under **Data Type**, include what type of data, that is,
    machine data or Active Directory data, and then define access to the VCM console,
    except the **Administration** tab.
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于 **基本规则**，在 **数据类型** 下，包括数据类型，即机器数据或 Active Directory 数据，然后定义对 VCM 控制台的访问，除了
    **管理** 标签。
- en: '**Admin Access Rule** defines what type of access is defined in the **Administration**
    tab, such as **None**, **Read Only**, **Full Control**, or going granular with
    **Custom**.'
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**管理员访问规则** 定义了在 **管理** 标签中定义的访问类型，如 **无**、**只读**、**完全控制**，或者使用 **自定义** 进行详细设置。'
- en: Lastly, click on **Finish** on the **Important** page of the wizard to close
    and create this new access rule.
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，在向导的 **重要** 页面上点击 **完成**，关闭并创建这条新的访问规则。
- en: 'As seen previously, there are 12 default roles created, but if you still have
    a use case that requires a different role, then you can create your own role.
    Follow these steps:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，已创建了 12 个默认角色，但如果您仍有需要其他角色的用例，则可以创建自己的角色。请按照以下步骤操作：
- en: Log in to the VCM console and go to **Administration **| **User Manager** | **VCM
    Access** | **Roles**.
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 VCM 控制台，转到 **管理 **| **用户管理器** | **VCM 访问** | **角色**。
- en: Click on the **Add Role** button and follow the wizard.
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **添加角色** 按钮并按照向导操作。
- en: When creating a role, you will need some information. To start with, provide
    a name and description for the newly created role.
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建角色时，您将需要一些信息。首先，为新创建的角色提供名称和描述。
- en: For **Role Access**, we can select either **Machine Data** (access to data based
    on the selected machine groups), **Active Directory** (access to Active Directory
    objects based on the AD structure), or **Admin** (access to administrative functions)
    access.
  id: totrans-332
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于 **角色访问**，我们可以选择 **机器数据**（根据所选机器组访问数据）、**Active Directory**（根据 AD 结构访问 Active
    Directory 对象）或 **管理员**（访问管理功能）访问。
- en: On the next page, under **Machine Data Access**, you can filter which machine
    group this new role user can access.
  id: totrans-333
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页中，您可以根据 **机器数据访问** 过滤此新角色用户可以访问的机器组。
- en: On the **Active Directory** page, under **Enterprise**, select the **Access
    Rule** that will be applied at the root of AD, if you have configured any.
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Active Directory** 页面下，选择应用于 AD 根目录的 **访问规则**，如果已配置。
- en: For **Admin Access**, select a proper rule to provide access.
  id: totrans-335
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于 **管理员访问**，选择适当的规则以提供访问权限。
- en: Under **Logins**, select any logins to assign this role to and, after reviewing
    it under **Important**, close the wizard to finish it.
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **登录** 下，选择要分配此角色的任何登录名，并在 **重要** 下查看后，关闭向导以完成。
- en: Decommissioning VMs – manual VM purge
  id: totrans-337
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 停用 VMs – 手动 VM 清除
- en: As a part of the lifecycle management of a managed machine, we need to remove
    the details of the managed machine from the VCM console.
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 作为受管理机器的生命周期管理的一部分，我们需要从 VCM 控制台中删除受管理机器的详细信息。
- en: Getting ready
  id: totrans-339
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You must have the name of the machine that you want to remove from VCM.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须提供要从 VCM 中移除的机器名称。
- en: How to do it...
  id: totrans-341
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'It''s a two-step process: First, free up a license and keep the data. Next,
    purge everything and remove the managed machine from the VCM database.'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个两步过程：首先释放许可证并保留数据。接下来，清除所有内容并从 VCM 数据库中移除受管理机器。
- en: Unlicense a managed machine
  id: totrans-343
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 取消许可受管理机器
- en: Log in to VCM with administrative privileges.
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用管理员特权登录 VCM。
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Windows Machines** or **Licensed UNIX Machines**.
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到 **管理** | **机器管理** | **已许可的机器** | **已许可的 Windows 机器** 或 **已许可的 UNIX 机器**。
- en: Right-click on the name of the machine you want to remove from the display.
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键单击要从显示中移除的机器名称。
- en: Select the **Unlicense** option and follow the prompts.
  id: totrans-347
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 **取消许可** 选项并按照提示操作。
- en: Note
  id: totrans-348
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that this returns the machine to the **Available Machines** list and frees
    up the machine's license for reuse.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，这将将机器返回到 **可用机器** 列表，并释放机器的许可证以便重用。
- en: Purge the machine
  id: totrans-350
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 清除该机器
- en: Log in to VCM with administrative privileges.
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用管理员特权登录 VCM。
- en: Go to **Administration **| **Machines Manager** | **Available Machine**.
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到 **管理 **| **机器管理** | **可用机器**。
- en: From here, if required, we can license the machine and move it to **Licensed
    Windows Machines** or **Licensed UNIX Machines** or remove it from the VCM database.
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，如果需要，我们可以为机器授权并将其移到 **已许可的 Windows 机器** 或 **已许可的 UNIX 机器**，或从 VCM 数据库中移除。
- en: Select the machine and click on **Purge** in the top menu.
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择机器，然后在顶部菜单中点击 **清除**。
- en: Follow the wizard; it will remove the machine completely from the VCM database.
  id: totrans-355
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照向导操作；它将完全从 VCM 数据库中移除该机器。
- en: How it works...
  id: totrans-356
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The process will obtain records as well as collected data from the VCM database
    and help us clean the clutter in the VCM, as the machines we want to delete have
    already been decommissioned. If those machines are not deleted from VCM, we could
    have an incorrect compliance score. We will always have machines that will fail
    patch installation and we will never reach the score we want.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 该过程将从VCM数据库中获取记录和收集的数据，帮助我们清理VCM中的杂乱数据，因为我们想删除的机器已经被停用。如果这些机器没有从VCM中删除，我们可能会得到不正确的合规评分。我们总会有一些机器无法安装补丁，并且永远无法达到预期的评分。
- en: There's more...
  id: totrans-358
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: If you are good with vRealize Orchestrator, VMware had released a package for
    VCM (which is available for download at [https://my.vmware.com](https://my.vmware.com)).
    With the help of this package, you can create a workflow to remove/purge managed
    machines.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您熟悉vRealize Orchestrator，VMware已经发布了一个VCM的包（可以在[https://my.vmware.com](https://my.vmware.com)下载）。借助这个包，您可以创建一个工作流来移除/清除托管机器。
- en: Decommissioning VMs – scheduled VM record purge
  id: totrans-360
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 停用虚拟机 – 计划虚拟机记录清除
- en: In the era of the cloud, we would like VM decommissioning to be done automatically
    so that our operations team can do more creative stuff than cleaning up the VCM
    database.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 在云时代，我们希望虚拟机停用能够自动完成，这样我们的运维团队可以做更多创意性工作，而不是清理VCM数据库。
- en: Getting ready
  id: totrans-362
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You must have access to the SQL server where the VCM database is hosted. You
    must know the basics of SQL Management Studio.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须有权限访问托管VCM数据库的SQL服务器，并且需要了解SQL管理工作室的基本操作。
- en: How to do it...
  id: totrans-364
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The following stored procedure can be implemented on the VCM database (`VCM`)
    as a scheduled task. This will purge the records of the VMs that haven't been
    contacted in the last 3 weeks.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 以下存储过程可以在VCM数据库（`VCM`）中作为计划任务实现。该任务将清除过去3周未联系的虚拟机记录。
- en: 'Change the value of `@expire int = xx` (the number of days for which the machine
    has not been contacted) in the script:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 在脚本中修改`@expire int = xx`（机器未联系的天数）值：
- en: '[PRE3]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Schedule a job in SQL
  id: totrans-368
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在SQL中计划任务
- en: Expand the **SQL Server Agent** node, right-click on the **Jobs** node in **SQL
    Server Agent**, and select **New Job**:![Schedule a job in SQL](img/image_07_017.jpg)
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开**SQL Server代理**节点，在**SQL Server代理**的**作业**节点上右键点击，并选择**新建作业**：![在SQL中计划任务](img/image_07_017.jpg)
- en: In the **New Job** window, enter the name of the job and a description in the
    **General** tab:![Schedule a job in SQL](img/image_07_018.jpg)
  id: totrans-370
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**新建任务**窗口中，在**常规**标签页中输入任务名称和描述：![在SQL中计划任务](img/image_07_018.jpg)
- en: Select **Steps** on the left-hand side of the window and click on **New** at
    the bottom.
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在窗口的左侧选择**步骤**，然后点击底部的**新建**。
- en: In the **Steps** window, enter a step name and select the database you want
    the query to run against:![Schedule a job in SQL](img/image_07_019.jpg)
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**步骤**窗口中，输入步骤名称并选择您希望查询运行的数据库：![在SQL中计划任务](img/image_07_019.jpg)
- en: Paste in the `T-SQL` command you want to run in the command window, and click
    on **OK**.
  id: totrans-373
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将您想要运行的`T-SQL`命令粘贴到命令窗口中，然后点击**确定**。
- en: Click on the **Schedule** menu to the left of the **New Job** window and enter
    the schedule information (for example, daily and a time).
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**新建任务**窗口左侧的**计划**菜单，并输入计划信息（例如，设置为每天并指定时间）。
- en: Click on **OK**, and that should be it.
  id: totrans-375
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**确定**，就完成了。
- en: How it works...
  id: totrans-376
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The job will run on the schedule provided by you and clean the managed machines
    that have not been communicating for the last 21 days; if this seems too much,
    then the number can be changed in the script to a suitable number as per your
    requirements.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 该任务将按照您提供的时间表运行，并清理过去21天没有通信的托管机器；如果这个时间段看起来太长，您可以根据需求在脚本中修改为适当的天数。
