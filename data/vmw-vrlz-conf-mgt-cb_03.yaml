- en: Chapter 3. Linux Patching
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 3 章：Linux 补丁管理
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将涵盖以下内容：
- en: Installing SCR prerequisites
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 SCR 所需的先决条件
- en: Installing the SCR Tool
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 SCR 工具
- en: Setting up the SCR configuration file
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 SCR 配置文件
- en: Scheduling content downloads
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安排内容下载
- en: Configuring Apache
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 Apache
- en: Configuring patching repository options in VCM
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 VCM 中配置补丁仓库选项
- en: Configuring staging options in VCM
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 VCM 中的暂存选项
- en: Configuring the SCR Tool base path for the patching repository
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 SCR 工具的补丁库基础路径
- en: Creating a patch assessment template
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建补丁评估模板
- en: Deploying patches on Linux machines - on demand
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Linux 机器上部署补丁 - 按需
- en: Deploying patches on Linux machines - scheduled
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Linux 机器上部署补丁 - 定时
- en: Introduction
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: Before patching Linux/Unix or Macintosh, we need to configure a repository into
    which we can download the patches in vendor-provided format. Once they've been
    downloaded, we need to make them available for the machines we plan to patch.
    This is where the VMware **Software Content Repository** (**SCR**) tool comes
    into picture. SCR is a Java-based tool that is installed on a separate RHEL 7
    VM. SCR downloads the patch signature files and OS vendor patch content from the
    **content distribution network** (**CDN**) and downloads subscription-only content
    from the OS vendor content websites.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行 Linux/Unix 或 Macintosh 补丁管理之前，我们需要配置一个可以下载供应商提供格式的补丁的仓库。一旦补丁下载完成，我们需要确保它们可以被我们计划补丁的机器访问。这时，VMware
    的 **软件内容仓库**（**SCR**）工具就派上用场了。SCR 是一个基于 Java 的工具，安装在一个独立的 RHEL 7 虚拟机上。SCR 从 **内容分发网络**（**CDN**）下载补丁签名文件和操作系统供应商补丁内容，并从操作系统供应商的网站下载仅限订阅的内容。
- en: Since the release of SCR 6.1, which was shipped with VCM 5.7.3, VMware supports
    the installation only on RHEL 7.x (refer to the VCM 7.5.3 release notes).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 自 SCR 6.1 版本发布以来（该版本与 VCM 5.7.3 一起发布），VMware 仅支持在 RHEL 7.x 上安装（请参阅 VCM 7.5.3
    发布说明）。
- en: Note
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that you must have a basic understanding of RHEL 7 or basic Linux commands
    to work through this chapter.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，您必须具备基本的 RHEL 7 或基本的 Linux 命令知识，才能顺利完成本章内容。
- en: Note that if you need to patch your RHEL 7 target machines, then you must have
    the new SCR Tool 6.1 version based on RHEL 7 Server (64-bit). However, VCM continues
    to support SCR Tool on RHEL 6 Server (64-bit) for patching earlier Linux platforms.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，如果您需要为 RHEL 7 目标机器打补丁，您必须使用基于 RHEL 7 Server（64 位）的新 SCR 工具 6.1 版本。然而，VCM
    仍然支持在 RHEL 6 Server（64 位）上使用 SCR 工具进行早期 Linux 平台的补丁管理。
- en: SCR is not involved in patch management, configuration, or deployment. It just
    acts as a repository that will be accessed by various methods such as HTTP, HTTPS,
    FTP, and NFS by the clients that need those patches. As a VCM administrator, we
    need to define the way in which the managed machines will access the content,
    such as downloading via HTTP, HTTPS, or NFS. We need to make the necessary changes
    on the SCR server, such as installing a web server to make patches available over
    HTTP, add proper certificates so that they can be accessed over HTTPS, and so
    on.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: SCR 不涉及补丁管理、配置或部署。它仅充当一个仓库，供需要补丁的客户端通过 HTTP、HTTPS、FTP 和 NFS 等多种方式访问。作为 VCM 管理员，我们需要定义受管机器访问内容的方式，例如通过
    HTTP、HTTPS 或 NFS 下载。我们需要在 SCR 服务器上进行必要的更改，如安装 Web 服务器以通过 HTTP 提供补丁，添加适当的证书以便通过
    HTTPS 访问等。
- en: How Linux patching works
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Linux 补丁管理工作原理
- en: 'The following figure from the VMware documentation depicts how VCM works with
    SCR:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是来自 VMware 文档的图示，展示了 VCM 如何与 SCR 配合工作：
- en: '![How Linux patching works](img/image_03_001.jpg)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![Linux 补丁管理工作原理](img/image_03_001.jpg)'
- en: 'The following is the procedure of getting Linux patching working according
    to the previous figure:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是根据前述图示使 Linux 补丁管理正常工作的步骤：
- en: We configure the SCR Tool on an RHEL machine (the biggest blue box); we can
    have several of them for load balancing.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们在 RHEL 机器上配置 SCR 工具（最大的蓝色框）；我们可以为负载均衡配置多个此类工具。
- en: Patches are downloaded either via a CDN or from the vendor into respective configured
    folders on the SCR server.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 补丁通过 CDN 或供应商下载到 SCR 服务器上配置的相应文件夹中。
- en: Meanwhile, VCM server (the biggest green box) checks the patch status of the
    managed Linux machines (the smaller green boxes). The VCM admin then decides which
    patches to install. VCM downloads patch bulletins from [http://www.vmware.com/](http://www.vmware.com/)
    to get the latest information about the patches.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同时，VCM 服务器（最大的绿色框）检查已管理的 Linux 机器（较小的绿色框）的补丁状态。然后，VCM 管理员决定安装哪些补丁。VCM 从 [http://www.vmware.com/](http://www.vmware.com/)
    下载补丁通告，以获取有关补丁的最新信息。
- en: Once the VCM administrator decides which patches to install, all the Unix/Linux
    machines reach the SCR server to get those patches.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦VCM管理员决定要安装哪些补丁，所有的Unix/Linux机器都会访问SCR服务器以获取这些补丁。
- en: Managed machines install the patches and inform the VCM server about the latest
    status; based on this, if required, the VCM admin can take further action, for
    instance, troubleshooting and getting a patch installed if it failed to.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 管理的机器安装补丁并将最新状态通知VCM服务器；基于此，如果需要，VCM管理员可以采取进一步措施，例如故障排除或安装未成功的补丁。
- en: SCR VM requirements
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SCR虚拟机要求
- en: Let's look at some values you should consider to plan for the SCR VM.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看您应该考虑的一些值，以便为SCR虚拟机进行规划。
- en: Estimated required SCR storage by platform
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 各平台所需SCR存储空间估算
- en: '| **Supported platform** | **Minimum storage required****for patch content
    files and payload** |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| **支持的平台** | **补丁内容文件和负载所需的最小存储空间** |'
- en: '| AIX | 130 GB |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| AIX | 130 GB |'
- en: '| CentOS | 80 GB |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| CentOS | 80 GB |'
- en: '| HP-UX | 15 GB |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| HP-UX | 15 GB |'
- en: '| Mac OS X | 210 GB |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| Mac OS X | 210 GB |'
- en: '| Oracle Enterprise Linux (OEL) | 80 GB |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| Oracle 企业版 Linux (OEL) | 80 GB |'
- en: '| RedHat | 80 GB |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| RedHat | 80 GB |'
- en: '| Solaris | 325 GB |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| Solaris | 325 GB |'
- en: '| SUSE | 60 GB |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| SUSE | 60 GB |'
- en: SCR VM hardware requirements
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: SCR虚拟机硬件要求
- en: 'Here are the base hardware requirements for deploying SCR:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是部署SCR所需的基本硬件要求：
- en: '| **Hardware** | **Specification** |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| **硬件** | **规格** |'
- en: '| **OS** | RHEL 7.x x86_64 |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| **操作系统** | RHEL 7.x x86_64 |'
- en: '| **HDD** | 20 GB base OS + extra disk as per the previous table.This needs
    to be mounted at `/opt/vcmpatches` on the server.Follow the [http://www.techotopia.com/index.php/Adding_a_New_Disk_Drive_to_an_RHEL_6_System](http://www.techotopia.com/index.php/Adding_a_New_Disk_Drive_to_an_RHEL_6_System)
    this is for RHEL 6 blog. This is for RHEL 6 but works well with RHEL 7. |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| **硬盘** | 20 GB基础操作系统 + 按前表所列的额外磁盘。此磁盘需要挂载在服务器的`/opt/vcmpatches`目录下。请按照[http://www.techotopia.com/index.php/Adding_a_New_Disk_Drive_to_an_RHEL_6_System](http://www.techotopia.com/index.php/Adding_a_New_Disk_Drive_to_an_RHEL_6_System)中的步骤，这适用于RHEL
    6，但在RHEL 7上也能很好地工作。 |'
- en: '| **Processor** | 2 vCPUs if going for virtual |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| **处理器** | 如果是虚拟机，需2个vCPU |'
- en: '| **RAM** | 4 GB |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| **RAM** | 4 GB |'
- en: '| **NIC** | 1 GBps with Internet access |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| **网卡** | 1 GBps，具有互联网访问 |'
- en: List of patch sites for SCR
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: SCR的补丁网站列表
- en: 'This is the list of websites we need access to for downloading patches for
    the respective OSes:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们需要访问的用于下载相应操作系统补丁的网站列表：
- en: '| **Platform** | **Download URL** |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| **平台** | **下载网址** |'
- en: '| **All platforms** | [http://configuresoft.cdn.lumension.com/configuresoft](http://configuresoft.cdn.lumension.com/configuresoft)[http://novell.cdn.lumension.com/](http://novell.cdn.lumension.com/)[https://a248.e.akamai.net/f/60/59258/2d/](https://a248.e.akamai.net/f/60/59258/2d/)[http://vmware.cdn.lumension.com/](http://vmware.cdn.lumension.com/)
    |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| **所有平台** | [http://configuresoft.cdn.lumension.com/configuresoft](http://configuresoft.cdn.lumension.com/configuresoft)[http://novell.cdn.lumension.com/](http://novell.cdn.lumension.com/)[https://a248.e.akamai.net/f/60/59258/2d/](https://a248.e.akamai.net/f/60/59258/2d/)[http://vmware.cdn.lumension.com/](http://vmware.cdn.lumension.com/)
    |'
- en: '| **CentOS** | [http://vault.centos.org](http://vault.centos.org)You can also
    use the mirrors returned from the Web service:[http://mirrorlist.centos.org](http://mirrorlist.centos.org)
    |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| **CentOS** | [http://vault.centos.org](http://vault.centos.org) 你也可以使用Web服务返回的镜像：[http://mirrorlist.centos.org](http://mirrorlist.centos.org)
    |'
- en: '| **RedHat** | [http://xmlrpc.rhn.redhat.com/XMLRPC](http://xmlrpc.rhn.redhat.com/XMLRPC)
    |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| **RedHat** | [http://xmlrpc.rhn.redhat.com/XMLRPC](http://xmlrpc.rhn.redhat.com/XMLRPC)
    |'
- en: '| **SUSE** | [https://you.novell.com/update/](https://you.novell.com/update/)[https://nu.novell.com/repo/$RCE/](https://nu.novell.com/repo/$RCE/)
    |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| **SUSE** | [https://you.novell.com/update/](https://you.novell.com/update/)[https://nu.novell.com/repo/$RCE/](https://nu.novell.com/repo/$RCE/)
    |'
- en: Note
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Check [http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf](http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf)
    for details of more OSes supported by SCR.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 查看[http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf](http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf)获取更多SCR支持的操作系统详细信息。
- en: Installing SCR prerequisites
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装SCR先决条件
- en: As mentioned earlier, SCR is a Java-based tool, so it has some prerequisites,
    such as the latest JRE and JDK versions installed on the base OS. We will now
    check all the requirements that we need to get SCR going.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，SCR是一个基于Java的工具，因此它有一些先决条件，比如在基础操作系统上安装最新版本的JRE和JDK。现在我们将检查启动SCR所需的所有要求。
- en: Getting ready
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Before we start, we must have an RHEL 7 server deployed, the minimum install
    option of the RHEL installer installs the necessary features we need to start
    with. We will need to install Apache and a few other utilities, but those we can
    install later. The latest JRE and JDK RPMs can be downloaded from Oracle.com.
    We also need root credentials to install the patches.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，我们必须部署一个 RHEL 7 服务器，RHEL 安装程序的最低安装选项会安装我们启动时所需的必要功能。我们将需要安装 Apache 和一些其他工具，但这些可以稍后安装。最新的
    JRE 和 JDK RPM 文件可以从 Oracle.com 下载。我们还需要 root 凭据来安装补丁。
- en: How to do it...
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Log in to the RHEL server with an SSH tool such as **PuTTY** and go to the
    folder where the installers have been copied. Then, follow these steps:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 SSH 工具（如 **PuTTY**）登录到 RHEL 服务器，进入已复制安装程序的文件夹。然后，按照以下步骤操作：
- en: '**Downloading**:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**下载中**：'
- en: Visit [http://www.oracle.com/index.html](http://www.oracle.com/index.html) and
    download the latest RPMs for JRE and JDK for RHEL 7 x64.
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 访问 [http://www.oracle.com/index.html](http://www.oracle.com/index.html)，下载适用于
    RHEL 7 x64 的最新 JRE 和 JDK RPM 文件。
- en: Once the RPMs have been downloaded, you can use a tool such as **winscp** to
    copy the installer to the SCR server.
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一旦 RPM 文件下载完成，您可以使用 **winscp** 等工具将安装程序复制到 SCR 服务器。
- en: '**Installing JDK using RPM**:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**使用 RPM 安装 JDK**：'
- en: 'Use the `cd` command to go to the folder where you have copied both the installers
    and run this command:'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 `cd` 命令进入您复制了安装程序的文件夹，然后运行此命令：
- en: '[PRE0]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**Installing JRE**:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**安装 JRE**：'
- en: 'Continue from where you left off earlier and run this command to install JRE:'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 继续之前的操作，运行此命令以安装 JRE：
- en: '[PRE1]'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '**Verify the Java Cryptography Extension (JCE)**:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**验证 Java 加密扩展（JCE）**：'
- en: By default, when you install the Java tool that comes with JCE, you don't need
    to separately install it again.
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 默认情况下，当您安装包含 JCE 的 Java 工具时，无需单独再次安装 JCE。
- en: 'Run the following command to validate whether JCE has been installed:'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行以下命令验证 JCE 是否已安装：
- en: '[PRE2]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![How to do it...](img/image_03_002.jpg)'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_002.jpg)'
- en: How it works...
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: As SCR is a Java-based tool, we need the latest JRE installed to make the tool
    work.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 SCR 是一个基于 Java 的工具，因此我们需要安装最新的 JRE 来使工具正常工作。
- en: The minimum Java version you can safely install without worrying about breaking
    the application is JRE 8u72, which is what we will use in this book. The JCE is
    required for AIX, HP-UX, RedHat, Solaris, and SUSE. It encrypts passwords when
    we use third-party credentials in the properties files used to download patch
    content.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以安全安装的最低 Java 版本是 JRE 8u72，这是我们在本书中使用的版本。AIX、HP-UX、RedHat、Solaris 和 SUSE 需要
    JCE。它在我们使用第三方凭据的属性文件中加密密码，这些属性文件用于下载补丁内容。
- en: VCM downloads the metadata about the patches from [http://www.vmware.com/](http://www.vmware.com/).
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 从 [http://www.vmware.com/](http://www.vmware.com/) 下载关于补丁的元数据。
- en: VCM is not at all aware what patches are available on the SCR server; it gets
    its data from [http://www.vmware.com/](http://www.vmware.com/), and SCR gets its
    updates from other locations.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 完全不了解 SCR 服务器上有哪些补丁可用；它从 [http://www.vmware.com/](http://www.vmware.com/)
    获取数据，而 SCR 从其他位置获取更新。
- en: There is no synchronization between what is available on SCR and what is required
    on VCM, so it is recommended that you synchronize your SCR server overnight to
    make sure all the patches are downloaded and then start pushing the patches from
    VCM.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: SCR 和 VCM 之间没有同步，因此建议您将 SCR 服务器在夜间同步，以确保所有补丁都已下载，然后从 VCM 开始推送补丁。
- en: Installing the SCR Tool
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 SCR 工具
- en: In this recipe, we will install the SCR Tool on the RHEL VM we prepared earlier.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将在之前准备的 RHEL 虚拟机上安装 SCR 工具。
- en: Getting ready
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You should have made sure that all the prerequisites form the previous recipes
    have been met.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该已经确认满足了前面教程中提到的所有先决条件。
- en: Download the latest version of SCR from [http://www.vmware.com/](http://www.vmware.com/),
    at the time of writing, it was SCR 6.1.21\. Copy the ZIP file to the `/tmp` directory
    of the SCR VM.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 从 [http://www.vmware.com/](http://www.vmware.com/) 下载最新版本的 SCR，本文撰写时为 SCR 6.1.21。将
    ZIP 文件复制到 SCR 虚拟机的 `/tmp` 目录中。
- en: We also need login credentials for vendors such as RHEL and SUSE so that we
    can encrypt the password for later use in the configuration files.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要 RHEL 和 SUSE 等供应商的登录凭据，以便加密密码以便稍后在配置文件中使用。
- en: How to do it...
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Log in to the SCR VM with root credentials and follow these steps to install
    and perform base configuration of SCR.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 root 凭据登录到 SCR 虚拟机，并按照以下步骤安装并进行 SCR 的基本配置。
- en: Installing SCR
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装 SCR
- en: 'Create the  `/opt/SCR` folder with this command:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令创建 `/opt/SCR` 文件夹：
- en: '[PRE3]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: From now on, we will refer to this location as `scr_root`
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从现在开始，我们将此位置称为 `scr_root`
- en: 'Unzip the SCR installation files:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解压 SCR 安装文件：
- en: '[PRE4]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Encrypting the password for the content repository
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 加密内容仓库的密码
- en: 'Continue from where we left off at step 2, and start the process of encrypting
    the password with the following commands:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 从我们在第 2 步停下的地方继续，并开始使用以下命令加密密码：
- en: 'Go to `/opt/SCR/bin` using this command:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令进入 `/opt/SCR/bin` 目录：
- en: '[PRE5]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Run the script that will encrypt the password:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行加密密码的脚本：
- en: '[PRE6]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Provide the password (and confirm it).
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供密码（并确认密码）。
- en: Copy the encrypted password string and keep it handy for the upcoming configuration
    steps in the following recipe.![Encrypting the password for the content repository](img/image_03_003.jpg)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制加密的密码字符串，并保留它以备后续配置步骤使用。![加密内容仓库的密码](img/image_03_003.jpg)
- en: Not only the vendor connection password, but also the proxy password, if required,
    needs to be encrypted in this way.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 不仅供应商连接密码，如果需要，代理密码也需要以这种方式加密。
- en: Note
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that if you provide a non-encrypted password, SCR assumes it is encrypted
    and will fail to connect and download patches.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，如果你提供的是未加密的密码，SCR 会假设它已加密，因此无法连接并下载补丁。
- en: How it works...
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: We are now getting ready by unzipping the installer and encrypting all the required
    passwords, such as the RedHat network access password, the password required to
    download content from SUSE, or the password required to get past our proxy.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在正在准备解压安装程序并加密所有必需的密码，例如 RedHat 网络访问密码、用于从 SUSE 下载内容的密码或用于通过代理的密码。
- en: We need to enter the password in the plaintext properties file used by SCR as
    configuration input when it starts downloading patches. If we enter our password
    unencrypted, then anyone with access to the file can read it. To avoid this situation,
    there is a script that encrypts the password, and we can provided this encrypted
    password in the configuration file.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要在 SCR 使用的明文属性文件中输入密码作为配置输入，以便在开始下载补丁时使用。如果我们输入的是未加密的密码，任何有权限访问该文件的人都能读取它。为避免这种情况，有一个脚本可以加密密码，我们可以在配置文件中提供这个加密后的密码。
- en: These passwords can be set in a plaintext configuration file for further processing
    of SCR.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 这些密码可以在明文配置文件中设置，以便 SCR 进一步处理。
- en: 'The SCR server must have execute permission for all of the repository application
    files in order to access and update the properties files. To provide those privileges,
    follow these steps:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: SCR 服务器必须对所有的仓库应用程序文件拥有执行权限，才能访问和更新属性文件。要提供这些权限，请按照以下步骤操作：
- en: On the SCR server, change to the `scr_root` directory.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 SCR 服务器上，切换到 `scr_root` 目录。
- en: To change the mode, run the `chmod -R a+x **/*` command.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要更改权限模式，运行 `chmod -R a+x **/*` 命令。
- en: Setting up the SCR configuration file
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 SCR 配置文件
- en: The meat of SCR is its configuration file; if we make a mistake here, we will
    never have those patches downloaded, and we can't have our SCR instance ready.
    Pay attention to what you choose; if a channel is not required, don't mention
    it the configuration file.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: SCR 的核心是它的配置文件；如果我们在这里犯错，就无法下载补丁，也无法让我们的 SCR 实例准备好。请注意你所选择的内容；如果某个通道不需要，就不要在配置文件中提到它。
- en: In this recipe, we will have a look at the various configuration options we
    have, what they mean, and how to configure them.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将查看各种配置选项，它们的含义以及如何配置它们。
- en: Getting ready
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Follow the *Installing SCR* recipe to install SCR and prepare the encrypted
    passwords.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 按照 *安装 SCR* 配方安装 SCR，并准备加密密码。
- en: Consult your OS support teams about which Linux/Unix OSes will be patched by
    VCM so that you can download those patches beforehand.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 请咨询你的操作系统支持团队，了解哪些 Linux/Unix 操作系统将由 VCM 打补丁，这样你可以提前下载这些补丁。
- en: How to do it...
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: In this recipe, we will prepare for RedHat Linux patching; however, the same
    principle applies for all Linux operating systems.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将为 RedHat Linux 打补丁做准备；然而，同样的原则适用于所有 Linux 操作系统。
- en: The example properties files are available in the `scr_root/conf/`  directory.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 示例属性文件位于 `scr_root/conf/` 目录中。
- en: If you have been following along properly so far, then the RHEL properties file
    will be at `/opt/SCR/redhat-rt.properties`.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你到目前为止一直按正确步骤操作，那么 RHEL 属性文件将位于 `/opt/SCR/redhat-rt.properties`。
- en: As stated earlier, we want to configure a properties file that will be used
    by the SCR Tool to obtain configuration details and act accordingly.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，我们需要配置一个属性文件，SCR工具将使用该文件来获取配置详细信息并据此执行操作。
- en: To configure the file, open it with your favorite Linux editor.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置文件，请使用你喜欢的Linux编辑器打开它。
- en: The options that we will keep at their default values are not discussed here.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将保持默认值的选项在这里没有讨论。
- en: 'Here are the options to configure:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是需要配置的选项：
- en: '`platform`'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`platform`'
- en: The `platform` parameter specifies the type of patch content to download.
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`platform`参数指定要下载的补丁内容类型。'
- en: '[PRE7]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '`arch`'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`arch`'
- en: The `arch` parameter specifies valid architecture strings for the specified
    platform.
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`arch`参数指定指定平台的有效架构字符串。'
- en: '[PRE8]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '`dist`'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dist`'
- en: The `dist` parameter specifies the distribution of Linux. Multiple values must
    be comma separated without spaces.
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`dist`参数指定Linux的发行版。多个值必须用逗号分隔，且不能有空格。'
- en: '[PRE9]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '`folder`'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`folder`'
- en: The `folder` parameter specifies the **root folder** where the SCR Tool output
    is stored. By default, this `folder` is  `/tmp/SCR/download`.
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`folder`参数指定存储SCR工具输出的**根文件夹**。默认情况下，此`folder`为`/tmp/SCR/download`。'
- en: Change it to `folder=/opt/vcmpatches` (we have mounted our second HDD under
    this folder; if you don't understand this, consult your Linux admin)
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将其更改为`folder=/opt/vcmpatches`（我们已将第二个硬盘挂载到此文件夹下；如果你不理解这一点，请咨询你的Linux管理员）。
- en: The SCR Tool creates the subdirectory tree under the root output folder.
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: SCR工具会在根输出文件夹下创建子目录树。
- en: '`thirdparty`'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`thirdparty`'
- en: Set the value to `true` to support third-party downloads for CentOS, Oracle
    Linux, RedHat, Solaris, and SUSE.
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将值设置为`true`以支持CentOS、Oracle Linux、RedHat、Solaris和SUSE的第三方下载。
- en: '[PRE10]'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '`user`'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`user`'
- en: The `user` parameter specifies the user ID for third-party vendor downloads,
    such as SUSE or RHEL.
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`user`参数指定第三方供应商下载的用户ID，例如SUSE或RHEL。'
- en: '[PRE11]'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '`pwd`'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`pwd`'
- en: The `pwd` parameter specifies an encrypted password for the user id specified
    by the `user` parameter. Check the *Installing SCR recipe* for more details.
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`pwd`参数为`user`参数指定的用户ID指定一个加密密码。更多详细信息请参见*安装SCR配方*。'
- en: '[PRE12]'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '`configlog`'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`configlog`'
- en: This parameter specifies an output file, which contains a list of parameters
    and values. These values reflect the parameter configuration used during the previous
    or current execution of the SCR Tool and can be used to troubleshoot problems.
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此参数指定输出文件，包含参数和值的列表。这些值反映了SCR工具在之前或当前执行过程中使用的参数配置，并可以用于排查问题。
- en: '[PRE13]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '`checkPayload`'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`checkPayload`'
- en: '[PRE14]'
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Set this to `true`.
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将此设置为`true`。
- en: '`dependencyCheck`'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dependencyCheck`'
- en: This turns off dependent RPM downloads for Linux platforms.
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这会关闭Linux平台的依赖RPM下载。
- en: '[PRE15]'
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: VMware recommends using `TRANSITIVE`, as this will download all the dependent
    patches.
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: VMware建议使用`TRANSITIVE`，因为这将下载所有相关的补丁。
- en: '`channels`'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`channels`'
- en: Channels are basically versions of the Linux/Unix operating system; for example,
    in the case of RHEL, we either have `client-x`, `server-x`, or `workstation-x`.
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 渠道基本上是Linux/Unix操作系统的版本；例如，在RHEL的情况下，我们有`client-x`、`server-x`或`workstation-x`。
- en: 'An example for RedHat:'
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这是一个针对RedHat的示例：
- en: '[PRE16]'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: If you want to download patches only for RHEL 7, then select `server-7`. SCR
    will then download patches for any other version.
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果你只想下载RHEL 7的补丁，请选择`server-7`。SCR将只下载此版本的补丁。
- en: This is where you need to consult your Linux team about which OS versions they
    support to add only those as channels and avoid unnecessary patch download.
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这是你需要与Linux团队咨询的地方，了解他们支持哪些操作系统版本，以便仅将这些版本作为渠道并避免不必要的补丁下载。
- en: '`downloadPayload`'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`downloadPayload`'
- en: If the value is `true`, all patches are downloaded. If the value is `false`,
    only the patches with UIDs that are included in the cache request folder are downloaded.
    If the value is `false` and there is no cache request XML, the content is processed
    but no patches are downloaded.
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果值为`true`，则下载所有补丁。如果值为`false`，则只下载包含在缓存请求文件夹中的补丁。如果值为`false`并且没有缓存请求XML文件，则内容会被处理，但不会下载补丁。
- en: '[PRE17]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: It is recommended to keep this `true`.
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 建议将此项保持为`true`。
- en: '`cacheRequestFolder`'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cacheRequestFolder`'
- en: '[PRE18]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The cache request XML file is used to limit the downloaded patches to only those
    for which you obtain UIDs from the `ecm_sysdat_patch_pls` table in the VCM database.
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 缓存请求XML文件用于限制下载的补丁，仅限于那些你从VCM数据库中的`ecm_sysdat_patch_pls`表中获取到UID的补丁。
- en: Even if you are not using this, don't hash out this option; or else, the patch
    download will fail.
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 即使你没有使用这个选项，也不要取消它，否则补丁下载将失败。
- en: '`proxyServer`'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`proxyServer`'
- en: This specifies the proxy server IP address in your infrastructure for internet
    access.
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这指定了您的基础设施中用于互联网访问的代理服务器IP地址。
- en: '[PRE19]'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '`proxyPort`'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`proxyPort`'
- en: This specifies the proxy server port in your infrastructure for internet access.
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这指定了您的基础设施中用于互联网访问的代理服务器端口。
- en: '[PRE20]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '`proxyUser`'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`proxyUser`'
- en: This specifies the user ID for proxy server authentication, if applicable.
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这指定了代理服务器身份验证的用户ID（如果适用）。
- en: '`proxyPwd`'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`proxyPwd`'
- en: This specifies the encrypted password for the proxy server if you need a proxy
    user. This password is generated using the `lumension_encryptor_tool.sh` script,
    as explained in the earlier recipe.
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这指定了代理服务器的加密密码（如果您需要代理用户）。此密码是使用`lumension_encryptor_tool.sh`脚本生成的，正如前面配方中所解释的那样。
- en: '[PRE21]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '`Certificate`'
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`证书`'
- en: Point this to the file containing your RedHat entitlement certificate. This
    file is created in `/etc/pki/entitlement` by the subscription manager when you
    attach a subscription to your registered RedHat system. The filename of the certificate
    varies but is always in the form `XXXXXXXXXXXXXXXXXXX.pem`, where `X` is a decimal
    digit.
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将其指向包含您的RedHat授权证书的文件。此文件由订阅管理器在您将订阅附加到已注册的RedHat系统时创建，路径为`/etc/pki/entitlement`。证书的文件名各不相同，但始终采用`XXXXXXXXXXXXXXXXXXX.pem`的形式，其中`X`是十进制数字。
- en: 'If you attempt to download RedHat 7 RPMs without setting a certificate, the
    following error message appears:'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您在没有设置证书的情况下尝试下载RedHat 7 RPM文件，将出现以下错误信息：
- en: '[PRE22]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Example values for this parameter:'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此参数的示例值：
- en: '[PRE23]'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'The following command is used to register RHEL 7 with RedHat Subscription Management:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令用于将RHEL 7与RedHat订阅管理进行注册：
- en: '[PRE24]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: This is the reason we can't use any other version of Linux as the SCR server.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们无法使用任何其他版本的Linux作为SCR服务器的原因。
- en: Note
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Most of these details have been taken from [http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf](http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf).
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 大部分细节都来自[http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf](http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf)。
- en: Save the properties file.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 保存属性文件。
- en: There is another problem with this file; we need to copy the working `redhat-rt.properties`
    file to the `REDHAT-rt.properties` file, as it has been observed in error logs
    that VCM tries to find the file with uppercase `REDHAT` and it fails, and in Linux,
    `REDHAT-rt.properties` and `redhat-rt.properties` are two different files.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件还有另一个问题；我们需要将工作中的`redhat-rt.properties`文件复制到`REDHAT-rt.properties`文件中，因为在错误日志中观察到VCM尝试查找大写的`REDHAT`文件时失败，而且在Linux中，`REDHAT-rt.properties`和`redhat-rt.properties`是两个不同的文件。
- en: 'Once configured, the file looks something like this:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 配置完成后，文件应如下所示：
- en: '![How to do it...](img/image_03_004.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_004.jpg)'
- en: 'Once the file has been saved, go to `/opt/SCR/bin` and run the following command:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 文件保存后，转到`/opt/SCR/bin`并运行以下命令：
- en: '[PRE25]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Then, check the logfiles and the download folder; if there are no error logs
    in the logfile, then SCR will start synchronizing the patches.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，检查日志文件和下载文件夹；如果日志文件中没有错误日志，则SCR将开始同步补丁。
- en: How it works...
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When we start downloading patches with the SCR Tool, it uses the information
    provided in the configuration file and then acts on it; for example, it will use
    the proxy provided in the configuration file and the credentials configured to
    authenticate.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们使用SCR工具开始下载补丁时，它会使用配置文件中提供的信息然后执行操作；例如，它将使用配置文件中提供的代理和配置的凭据进行身份验证。
- en: It will use the folder path to download the patches and the credentials shared
    to authenticate with the OS vendor.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 它将使用文件夹路径下载补丁，并使用共享的凭据与操作系统供应商进行身份验证。
- en: It will download only patches for the OS versions mentioned in the channel configuration;
    it might not download any patch if we configure the file like that, and we might
    get failures while performing the deployment with VCM.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 它将只下载在通道配置中提到的操作系统版本的补丁；如果我们按照这种方式配置文件，它可能不会下载任何补丁，并且在使用VCM进行部署时可能会遇到失败。
- en: The SCR Tool first attempts to download the payload from the CDN. If the patch
    is not found in the CDN, the SCR Tool downloads it from the vendor's website,
    such as RedHat, SUSE, or Solaris, using the credentials provided in the user and
    password parameters.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: SCR工具首先尝试从CDN下载有效负载。如果在CDN中未找到补丁，SCR工具则从供应商的网站（例如RedHat、SUSE或Solaris）下载，使用在用户和密码参数中提供的凭据。
- en: If something like that happens now, you know where to look first. The logfile
    location mentioned here comes in handy, assuming you have configured everything
    correctly. If SCR is not downloading the patches, have a look at the logfile generated
    at the location mentioned in the configuration file.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 如果现在发生类似情况，您知道该从哪里开始查看。这里提到的日志文件位置非常有用，前提是您已正确配置了所有内容。如果 SCR 无法下载补丁，可以查看配置文件中提到的日志文件。
- en: If you are new to Linux, then use a tool called winscp; this allows you to browse
    the Linux filesystem and manipulate files.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您是 Linux 新手，可以使用一个叫做 winscp 的工具；它允许您浏览 Linux 文件系统并操作文件。
- en: 'Open the logfile in winscp and look for something that tells you the system
    is getting registered to RHN in order to make sure everything is going well:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在 winscp 中打开日志文件，查找某些信息，确认系统正在注册到 RHN，以确保一切正常：
- en: '![How it works...](img/image_03_005.jpg)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![工作原理...](img/image_03_005.jpg)'
- en: We will look at a recipe on troubleshooting SCR download issues in [Chapter
    9](ch09.html "Chapter 9. Troubleshooting VCM"), *Troubleshooting VCM*.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[第9章](ch09.html "第9章. 排查 VCM 问题")中查看关于排查 SCR 下载问题的食谱，*排查 VCM*。
- en: Scheduling content downloads
  id: totrans-215
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安排内容下载
- en: OS vendors keep generating patches. We can't just log in to SCR and synchronize
    them manually; we can set a schedule and let SCR take care of downloading all
    the required patches.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统厂商持续发布补丁。我们不能仅仅登录 SCR 手动同步补丁；我们可以设置一个计划任务，让 SCR 自动处理所有所需补丁的下载。
- en: Getting ready
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: The SCR VM must have access to the Internet and be configured as per the previous
    two recipes.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: SCR 虚拟机必须能够访问互联网，并按前两个步骤配置。
- en: Configure the `redhat-rt.properties` file with the correct settings, such as
    user details for RHN and proxy details, and save it.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 配置`redhat-rt.properties`文件，设置正确的配置，例如 RHN 用户详情和代理设置，并保存文件。
- en: How to do it...
  id: totrans-220
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: To set up the scheduling, we need to a create scripts that then can be run automatically.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置定时任务，我们需要创建可以自动运行的脚本。
- en: Follow these steps to create the script and schedule it.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤创建脚本并安排其执行。
- en: Once logged in to the SCR server, go to the location where SCR is installed
    (for us, it is `/opt/SCR`)
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录 SCR 服务器后，进入 SCR 安装位置（对我们来说是 `/opt/SCR`）。
- en: '**Copy the following content into the file**:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**将以下内容复制到文件中**：'
- en: '[PRE26]'
  id: totrans-225
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: press *i*
  id: totrans-226
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 按 *i* 进入编辑模式
- en: 'Enter or copy the following content:'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输入或复制以下内容：
- en: '[PRE27]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Remove the `#` in front of the RedHat entry as we want to synchronize the patches
    for it, and if you have another version of Linux, do the same for that.
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 删除 RedHat 条目前面的 `#`，因为我们需要同步该条目的补丁，如果您有其他版本的 Linux，也请对它进行相同操作。
- en: After you finished press [*ESC*] and then *:wq* to write the content and exit
    vi
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 完成后，按[*ESC*]键，然后输入 *:wq* 保存内容并退出 vi。
- en: '**Assign executable permissions to the created file:**'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**为创建的文件分配可执行权限：**'
- en: '[PRE28]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Once the script is ready, we need to schedule it.
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一旦脚本准备好，我们需要安排它执行。
- en: '**Schedule a cron job to download it daily**:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**安排定时任务每天下载补丁：**'
- en: '[PRE29]'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Tip
  id: totrans-236
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Note that the following script runs daily and synchronizes your patch content:'
  id: totrans-237
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，以下脚本每天运行并同步您的补丁内容：
- en: '`vim /etc/cron.daily/SCR`'
  id: totrans-238
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`vim /etc/cron.daily/SCR`'
- en: '**Add the following code to the file**:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**将以下代码添加到文件中**：'
- en: '[PRE30]'
  id: totrans-240
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The host machine must have execute permission for all of the repository application
    files in order to access and update the properties files. To grant this permission,
    you run a command on the host machine.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 主机必须对所有的仓库应用文件赋予执行权限，才能访问并更新配置文件。要授予此权限，请在主机上运行以下命令。
- en: Change directory to the SCR root directory (`/opt/SCR`).
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 切换到 SCR 根目录（`/opt/SCR`）。
- en: Tip
  id: totrans-243
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Note that execute the following command in the `/opt/SCR` directory: `**cd
    /opt/SCR**` `**chmod -R a+x **/***`'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在 `/opt/SCR` 目录中执行以下命令：`**cd /opt/SCR**` `**chmod -R a+x **/***`
- en: 'Run the SCR file to create the directory structure:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 运行 SCR 文件以创建目录结构：
- en: Change directory to `/etc/cron.daily`.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到 `/etc/cron.daily` 目录。
- en: '[PRE31]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Run the SCR file to create the directory structure and download the content:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 SCR 文件以创建目录结构并下载内容：
- en: '[PRE32]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Monitor the size for a while by running this:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过运行以下命令来监视文件大小：
- en: '[PRE33]'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: How it works...
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: We create a daily schedule that will run at 12:00 am and will then use the configuration
    settings provided in the properties file and download the patches to the SCR server.
    The patches can then be used to deploy using VCM. Before starting to deploy patches
    with VCM, you must download them to the SCR server, as VCM will not know which
    patches are available and which are not.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 我们创建一个每日调度任务，它将在凌晨 12:00 执行，然后使用属性文件中提供的配置设置，下载补丁到 SCR 服务器。补丁随后可以用于通过 VCM 部署。在开始使用
    VCM 部署补丁之前，必须将其下载到 SCR 服务器，因为 VCM 不知道哪些补丁是可用的，哪些是不可用的。
- en: Configuring Apache
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 Apache
- en: By now, we will have all the patches downloaded to the SCR server; now, we need
    a mechanism to make them available to the managed machines when they need them
    for installation.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经将所有补丁下载到 SCR 服务器；接下来，我们需要一个机制，使它们在被管理的机器需要安装时能够获取。
- en: We can configure a web server to distribute the patches from the SCR repository.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以配置一个 Web 服务器来分发来自 SCR 仓库的补丁。
- en: As discussed in the introduction, we can distribute the patches over HTTP/HTTPS;
    we will configure the Apache web server such that the folder containing patches
    (`/opt/vcmpatches`) will be available over HTTP. We will make the necessary changes
    in the VCM server to instruct the Linux/Unix machines to download patches according
    to our web server configuration.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前面所述，我们可以通过 HTTP/HTTPS 分发补丁；我们将配置 Apache Web 服务器，使包含补丁的文件夹（`/opt/vcmpatches`）可以通过
    HTTP 访问。然后，我们将在 VCM 服务器中进行必要的修改，指示 Linux/Unix 机器根据我们的 Web 服务器配置下载补丁。
- en: Getting ready
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: As you have already registered your SCR server with the RedHat network, which
    is a prerequisite for downloading RHEL 7 patches, you have a repository ready
    to install Apache.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 由于你已经将 SCR 服务器注册到 RedHat 网络，这是下载 RHEL 7 补丁的前提条件，因此你已经拥有一个仓库，准备安装 Apache。
- en: '**Security-Enhanced Linux** **(** **SELinux)** should be disabled or configured
    such that we can connect on port `80` or `443`.'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '**安全增强 Linux**（**SELinux**）应禁用或配置为允许我们在端口 `80` 或 `443` 上连接。'
- en: 'If you are not aware how this can be achieved, have a look at the following
    article:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不清楚如何实现此操作，可以查看以下文章：
- en: '[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/chap-Managing_Confined_Services-The_Apache_HTTP_Server.html#sect-Managing_Confined_Services-The_Apache_HTTP_Server-The_Apache_HTTP_Server_and_SELinux](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/chap-Managing_Confined_Services-The_Apache_HTTP_Server.html#sect-Managing_Confined_Services-The_Apache_HTTP_Server-The_Apache_HTTP_Server_and_SELinux)'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/chap-Managing_Confined_Services-The_Apache_HTTP_Server.html#sect-Managing_Confined_Services-The_Apache_HTTP_Server-The_Apache_HTTP_Server_and_SELinux](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/chap-Managing_Confined_Services-The_Apache_HTTP_Server.html#sect-Managing_Confined_Services-The_Apache_HTTP_Server-The_Apache_HTTP_Server_and_SELinux)'
- en: The firewall should be disabled or configured so that we can access patches
    over port `80`/`443`.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙应禁用或配置为允许我们通过端口`80`/`443`访问补丁。
- en: 'Have a look at this article for details on how to work with the RHEL firewall:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 查看这篇文章，了解如何操作 RHEL 防火墙：
- en: '[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html)'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html)'
- en: 'You could also use the following article for port 80 and make the necessary
    changes for port `443`:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用以下文章来配置端口 80，并对端口`443`做必要的修改：
- en: '[https://linuxconfig.org/how-to-open-http-port-80-on-redhat-7-linux-using-firewall-cmd](https://linuxconfig.org/how-to-open-http-port-80-on-redhat-7-linux-using-firewall-cmd)'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://linuxconfig.org/how-to-open-http-port-80-on-redhat-7-linux-using-firewall-cmd](https://linuxconfig.org/how-to-open-http-port-80-on-redhat-7-linux-using-firewall-cmd)'
- en: How to do it...
  id: totrans-268
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'This is a pretty long recipe, and we will break it into multiple sections,
    as follows:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个比较长的操作步骤，我们将其分成多个部分，如下所示：
- en: I*nstalling Apache*
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*安装 Apache*'
- en: '*Configuring httpd.conf for Apache*'
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*配置 httpd.conf 以设置 Apache*'
- en: '*Configuring the .htaccess file*'
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*配置 .htaccess 文件*'
- en: '*Configuring HTTPS in Apache*'
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*在 Apache 中配置 HTTPS*'
- en: Installing Apache
  id: totrans-274
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装 Apache
- en: To make the patches available in our infrastructure, we can make the SCR server
    act as a web server and then configure it in VCM such that the managed machines
    access the patches over port `80` or `443` from the SCR server.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使补丁在我们的基础设施中可用，我们可以将 SCR 服务器作为 Web 服务器来使用，并在 VCM 中进行配置，使受管理的机器通过端口 `80` 或
    `443` 从 SCR 服务器访问这些补丁。
- en: 'We will achieve this by following these steps:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过以下步骤来实现：
- en: Log in to SCR server with the root account.
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 root 账户登录到 SCR 服务器。
- en: 'Install Apache:'
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 Apache：
- en: '[PRE34]'
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Make sure that httpd starts with the OS boot:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保 httpd 在操作系统启动时自动启动：
- en: '[PRE35]'
  id: totrans-281
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Start the httpd service now:'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在启动 httpd 服务：
- en: '[PRE36]'
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Now, we need to configure the `httpd.conf` file, located in `/etc/https/conf`,
    to make Apache work as per our requirements.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要配置位于 `/etc/https/conf` 的 `httpd.conf` 文件，以使 Apache 按照我们的需求运行。
- en: Configuring httpd.conf for Apache
  id: totrans-285
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置 Apache 的 httpd.conf
- en: The Apache configuration is stored in the `httpd.conf` file, located in `/etc/https/conf`.
    Continue with the following steps to make the necessary changes in the configuration
    file.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: Apache 的配置存储在 `httpd.conf` 文件中，位于 `/etc/https/conf`。继续执行以下步骤以在配置文件中做必要的更改。
- en: Before making changes to `httpd.conf`, we need to add a symbolic link between
    the folder we used to download the patches (`/opt/vcmpatches`) and the folder
    exposed under `httpd.conf` (`/var/www/html`).
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在对 `httpd.conf` 进行更改之前，我们需要在我们用来下载补丁的文件夹（`/opt/vcmpatches`）和 `httpd.conf` 中暴露的文件夹（`/var/www/html`）之间创建一个符号链接。
- en: Log in to the SCR server with the root account.
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 root 账户登录到 SCR 服务器。
- en: Go to `/var/www/html` using `cd /var/www/html`.
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `cd /var/www/html` 命令进入 `/var/www/html`。
- en: Run the `ln -s /opt/vcmpatchs vcmpatches` command.
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 `ln -s /opt/vcmpatchs vcmpatches` 命令。
- en: 'Edit `httpd.conf`:'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑 `httpd.conf`：
- en: '[PRE37]'
  id: totrans-292
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Enter *I* to go into edit mode, and add the following line under the `AccessFileName`
    section:'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 *I* 进入编辑模式，并在 `AccessFileName` 部分下方添加以下行：
- en: '[PRE38]'
  id: totrans-294
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Note
  id: totrans-295
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that we will be creating this `.httaccess` file in the next section of
    this recipe.
  id: totrans-296
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，我们将在本教程的下一部分创建这个 `.httaccess` 文件。
- en: Configuring the .htaccess file
  id: totrans-297
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置 .htaccess 文件
- en: To make this secure, we can add a `.htaccess` file so that only configured users
    can access the patches.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保安全，我们可以添加一个 `.htaccess` 文件，以便只有配置过的用户可以访问补丁。
- en: 'Create and edit the `.htaccess` file at `/opt/vcmpatches`:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `/opt/vcmpatches` 创建并编辑 `.htaccess` 文件：
- en: '[PRE39]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Add the following lines to the file:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 将以下行添加到文件中：
- en: '[PRE40]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Now, create an encrypted password for the `httpuser` user:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为 `httpuser` 用户创建一个加密的密码：
- en: '[PRE41]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: It will prompt you for a password; type the password you want to set.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 它会提示你输入密码；请输入你想要设置的密码。
- en: 'This creates another file at the same location called `.htpasswd`, and it stores
    the encrypted password, which you can see using the following command:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 这将在相同位置创建另一个文件 `.htpasswd`，并存储加密的密码，你可以通过以下命令查看它：
- en: '[PRE42]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Configuring HTTPS in Apache
  id: totrans-308
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置 Apache 中的 HTTPS
- en: 'The default installation of Apache will give us an HTTP connection to the patch
    repository. We need to create and configure a certificate in Apache so that our
    managed VMs can securely download the patches from the SCR server. To configure
    HTTPS, we follow these steps:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: Apache 的默认安装将为我们提供一个 HTTP 连接到补丁库。我们需要在 Apache 中创建并配置证书，以便我们的受管虚拟机可以从 SCR 服务器安全地下载补丁。要配置
    HTTPS，我们需要按照以下步骤操作：
- en: '**Install Mod SSL**'
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**安装 Mod SSL**'
- en: 'In order to set up the self-signed certificate, we first have to be sure that
    Apache and Mod SSL are installed. You can install both with one command:'
  id: totrans-311
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了设置自签名证书，我们首先需要确保 Apache 和 Mod SSL 已经安装。你可以通过一个命令同时安装这两者：
- en: '[PRE43]'
  id: totrans-312
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '**Create a new directory**'
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**创建一个新目录**'
- en: 'Next, we need to create a new directory, where we will store the server key
    and certificate:'
  id: totrans-314
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 接下来，我们需要创建一个新目录，用于存储服务器密钥和证书：
- en: '[PRE44]'
  id: totrans-315
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '**Create a self-signed certificate**'
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**创建一个自签名证书**'
- en: 'When we request a new certificate, we can specify how long it should remain
    valid by changing the `1000` parameter to the number of days we prefer:'
  id: totrans-317
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当我们请求新的证书时，可以通过修改 `1000` 参数为我们希望的天数，来指定证书的有效期：
- en: '[PRE45]'
  id: totrans-318
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: With this command, we will both be creating the self-signed SSL certificate
    and the server key that protects it and placing both of them into the new directory.
    This command will prompt the terminal to display a list of fields that need to
    be filled in. The most important line is **Common Name.** Enter your official
    domain name here or, if you don't have one yet, use your site's IP address.
  id: totrans-319
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用此命令，我们将同时创建自签名的 SSL 证书和保护它的服务器密钥，并将它们放入新目录中。此命令会提示终端显示需要填写的字段列表。最重要的一行是 **Common
    Name**。在这里输入你的官方域名，或者如果你还没有域名，可以使用你网站的 IP 地址。
- en: You will be asked to enter information that will be incorporated into your certificate
    request.
  id: totrans-320
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您将被要求输入信息，这些信息将被纳入您的证书请求中。
- en: 'Provide the following details:'
  id: totrans-321
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 提供以下详细信息：
- en: '**Country Name (two-letter code)**: `IN`'
  id: totrans-322
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**国家名称（两字母代码）**：`IN`'
- en: '**State or province name (full name)**: `Maharashtra`'
  id: totrans-323
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**州或省的全名**：`Maharashtra`'
- en: '**Locality name (for example, a city)**: `Pune`'
  id: totrans-324
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**地方名称（例如，城市）**：`Pune`'
- en: '**Organization name (such as a company)**: `VCM_Cookbook`'
  id: totrans-325
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织名称（如公司名称）**：`VCM_Cookbook`'
- en: '**Organizational unit name (for example, a section)**:  `Information Technology`'
  id: totrans-326
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织单位名称（例如，部门名称）**：`信息技术`'
- en: '**Common name (for example, a server FQDN or your name)**: `VCMCookbook.com`'
  id: totrans-327
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**通用名称（例如，服务器的完全限定域名或您的名字）**：`VCMCookbook.com`'
- en: '**Email address**: `Abhijeet@vcmcookbook.com`'
  id: totrans-328
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**电子邮件地址**：`Abhijeet@vcmcookbook.com`'
- en: Note
  id: totrans-329
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that the example values need to be changed as per your infrastructure.
  id: totrans-330
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，示例值需要根据您的基础设施进行更改。
- en: '**Set up the certificate**:'
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**设置证书**：'
- en: We now have all of the required components of the finished certificate. The
    next thing to do is to set up the virtual hosts to display the new certificate.
  id: totrans-332
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们现在已经具备了完整证书所需的所有组件。接下来的工作是设置虚拟主机以显示新的证书。
- en: 'Open up the SSL config file:'
  id: totrans-333
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 打开 SSL 配置文件：
- en: '[PRE46]'
  id: totrans-334
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Now, add the following block of code to the file:'
  id: totrans-335
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在，将以下代码块添加到文件中：
- en: '[PRE47]'
  id: totrans-336
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: '**Restart Apache**:'
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**重启 Apache**：'
- en: You are done. Restarting the Apache server will reload it with all of your changes
    in place.
  id: totrans-338
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您完成了。重启 Apache 服务器将重新加载它，并应用所有更改。
- en: '[PRE48]'
  id: totrans-339
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: After this, you should access the VCM patches folder over the network via a
    browser, and it should look something like the following screenshot.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此步骤后，您应通过浏览器访问 VCM 补丁文件夹，网络上应该会显示如下截图。
- en: When you access the link, it will ask for authentication. Use the `httpuser`
    user and password created in the earlier step.
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 当您访问该链接时，它会要求进行身份验证。请使用在之前步骤中创建的 `httpuser` 用户和密码。
- en: '![Configuring HTTPS in Apache](img/image_03_006.jpg)'
  id: totrans-342
  prefs: []
  type: TYPE_IMG
  zh: '![在 Apache 中配置 HTTPS](img/image_03_006.jpg)'
- en: How it works...
  id: totrans-343
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Linux and Unix managed machines can use HTTP/HTTPS to retrieve patches directly
    from the RedHat Linux patching repository machine.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: Linux 和 Unix 管理的机器可以使用 HTTP/HTTPS 直接从 RedHat Linux 补丁仓库机器获取补丁。
- en: The VCM Collector orchestrates and coordinates the tasks required to download,
    stage, and deploy the patches and the custom predeployment, postdeployment, and
    reboot actions using the VCM agent installed on the patching repository machine
    and the VCM agent on the target managed machines.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: VCM Collector 协调并组织所需的任务，以使用安装在补丁仓库机器上的 VCM 代理和目标受管机器上的 VCM 代理，下载、存放和部署补丁以及执行自定义的预部署、后部署和重启操作。
- en: '![How it works...](img/image_03_007-1.jpg)'
  id: totrans-346
  prefs: []
  type: TYPE_IMG
  zh: '![它是如何工作的...](img/image_03_007-1.jpg)'
- en: The patches are available on the SCR server, and with the help of the Apache
    server, we created a web server that will present the patches to the managed machines.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 补丁可在 SCR 服务器上获取，在 Apache 服务器的帮助下，我们创建了一个 Web 服务器，将补丁提供给受管机器。
- en: There's more...
  id: totrans-348
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Once this has been configured, we need to make the necessary configuration changes
    in the VCM console and add the staging option as HTTP and redirect the managed
    machines to the `/opt/vcmpatches` folder to download patches. We will do this
    in the following recipes, *Configuring patching repository options in VCM* and
    *Configuring staging options*.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 配置完成后，我们需要在 VCM 控制台中进行必要的配置更改，并将暂存选项设置为 HTTP，同时将受管机器重定向到 `/opt/vcmpatches` 文件夹以下载补丁。我们将在接下来的配方中执行此操作，*在
    VCM 中配置补丁仓库选项* 和 *配置暂存选项*。
- en: Configuring patching repository options in VCM
  id: totrans-350
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 VCM 中配置补丁仓库选项
- en: Once everything is configured and ready on the SCR front, we should start configuring
    the repository in VCM. This is where we set the machine (SCR server) that will
    act as the repository.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦 SCR 方面的一切配置好并准备就绪，我们应当开始配置 VCM 中的仓库。这是我们设置作为仓库的机器（SCR 服务器）的位置。
- en: Getting ready
  id: totrans-352
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: We should have finished all the previous recipes before we start this, as this
    is dependent on all of them. Install the VCM agent as described in [Chapter 2](ch02.html
    "Chapter 2. Configuring VCM to Manage Your Infrastructure"), *Configuring VCM
    to Manage * *Your Infrastructure*, in the *Installing an agent on Linux servers*
    recipe, and perform an initial data collection for the SCR machine.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，我们应该完成所有之前的配置步骤，因为这些步骤是相互依赖的。按照 [第 2 章](ch02.html "第 2 章 配置 VCM 管理您的基础设施")
    *配置 VCM 以管理您的基础设施* 章节中的 *在 Linux 服务器上安装代理* 配方描述，安装 VCM 代理，并为 SCR 机器执行初步数据收集。
- en: How to do it...
  id: totrans-354
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To set up a patch repository in VCM, log in to the VCM console and follow these
    steps:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 要在VCM中设置补丁仓库，请登录到VCM控制台并按照以下步骤操作：
- en: Go to **Administration** | **Certificate** and select the SCR server. Click
    on **Change Trust Status** at the top of the screen.![How to do it...](img/image_03_008.jpg)
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**管理** | **证书**并选择SCR服务器。点击屏幕顶部的**更改信任状态**。[如何操作...](img/image_03_008.jpg)
- en: In the wizard, select the SCR machine and tick the **Check to trust and uncheck
    to untrust the selected machine** option.
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在向导中，选择SCR机器并勾选**勾选以信任，取消勾选以不信任所选机器**选项。
- en: You should see a handshake sign in front of the SCR server.
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该能在SCR服务器前看到一个握手标志。
- en: Now, keep the SCR machine selected and click on **Patching Repository** at the
    top of the screen.
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，保持选中SCR机器并点击屏幕顶部的**补丁仓库**。
- en: Make sure the SCR server is selected and choose **Enable - Allow the selected
    machine to be** ****used** as Patch Repository**. Click on **Next**.
  id: totrans-360
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保选中SCR服务器，然后选择**启用 - 允许将选定的机器作为补丁仓库**。点击**下一步**。
- en: Click on **Finish** to close the wizard.
  id: totrans-361
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**以关闭向导。
- en: The end result should look something like this:![How to do it...](img/image_03_009.jpg)
  id: totrans-362
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最终结果应该类似于这样：[如何操作...](img/image_03_009.jpg)
- en: How it works...
  id: totrans-363
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We set the patching repository as the designated patch repository for all the
    Linux/Unix machines we will be managing. Now, VCM knows where to redirect the
    machines if they want to be patched; we need to perform further configuration
    changes such as setting the path from where the machines can download the patches,
    but that is for the next recipe.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将补丁仓库设置为我们将管理的所有Linux/Unix机器的指定补丁仓库。现在，VCM知道如果机器需要补丁时，应该重定向到哪里；我们需要进行进一步的配置更改，比如设置机器可以从哪里下载补丁，但这些将会在下一个配方中进行。
- en: Configuring staging options in VCM
  id: totrans-365
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置VCM中的阶段选项
- en: Staging options are where we set VCM to exactly redirect the VM to `https://<SCR
    Server>/<Patch location>`. So far, we have downloaded the patches and added a
    server as the repository, and now, we will set the name of the folder and configure
    machine group mappings to the staging options.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 阶段选项是我们设置VCM将虚拟机精确地重定向到`https://<SCR Server>/<Patch location>`的地方。目前，我们已经下载了补丁并添加了一个服务器作为仓库，现在，我们将设置文件夹的名称并配置机器组映射到阶段选项。
- en: Getting ready
  id: totrans-367
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: We are building on previous recipes, so before we go ahead with this recipe,
    we should have finished all of them. If there are any special machine groups required,
    then they should be ready before we start with this recipe.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 我们是在前面的配方基础上构建的，所以在继续这个配方之前，我们应该已经完成了所有的配方。如果需要任何特殊的机器组，它们应该在我们开始这个配方之前就准备好。
- en: How to do it...
  id: totrans-369
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Log in to the VCM server console and follow these steps to configure patch
    staging:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到VCM服务器控制台并按照以下步骤配置补丁阶段：
- en: Login as a VCM administrator in VCM console.
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以VCM管理员身份登录到VCM控制台。
- en: Navigate to **Administration** | **Settings** | **General Settings** | **Patching**
    | **UNIX** | **Patch Staging**. Click on **Add**.
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**管理** | **设置** | **常规设置** | **补丁** | **UNIX** | **补丁阶段**。点击**添加**。
- en: Give a name and add a description.
  id: totrans-373
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给一个名称并添加描述。
- en: 'Under **Repository Type**, select **Obtain patches from the patching repository
    : <Name of SCR server>**.'
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**仓库类型**下，选择**从补丁仓库获取补丁：<SCR服务器名称>**。
- en: 'On the next page, provide details as follows:'
  id: totrans-375
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页中，提供以下详细信息：
- en: '**Repository Path: **`/vcmpatches` (this is the relative path to which we have
    downloaded the patches)'
  id: totrans-376
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**仓库路径：**`/vcmpatches`（这是我们下载补丁的相对路径）'
- en: '**Protocol:** Choose **HTTPS**'
  id: totrans-377
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议：**选择**HTTPS**'
- en: '**Port:** Type `443` unless you have made some changes in `httpd.conf` and
    are using some other port'
  id: totrans-378
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**端口：**输入`443`，除非你已经在`httpd.conf`中做了更改并使用了其他端口。'
- en: Select credentials required
  id: totrans-379
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择所需的凭证
- en: '**Username :**`httpuser` (or any user set in the `.htaccess` file)'
  id: totrans-380
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户名：**`httpuser`（或在`.htaccess`文件中设置的任何用户）'
- en: '**Password :** A plaintext password (don''t use an encrypted password here)'
  id: totrans-381
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**密码：**明文密码（不要在这里使用加密密码）'
- en: Click on **Finish**.
  id: totrans-382
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**。
- en: Now that we have set a staging option, we need to assign it to the machine groups
    so that the machines will know where to download the patches from.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经设置了阶段选项，我们需要将其分配给机器组，这样机器就知道从哪里下载补丁了。
- en: Navigate to **Administration** | **Settings** | **General ****Settings** | **Patching**
    |**UNIX** | **Machine Group Mapping**.
  id: totrans-384
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**管理** | **设置** | **常规设置** | **补丁** | **UNIX** | **机器组映射**。
- en: Select the **Machine Group** and click on **Edit**.
  id: totrans-385
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**机器组**并点击**编辑**。
- en: Set the patch path value to **Standard Deployment and Source** for staged patches
    to **SCR-HTTP.**
  id: totrans-386
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将补丁路径值设置为**标准部署和源**，用于分阶段补丁到**SCR-HTTP**。
- en: 'The protocol and path will populate automatically, that is, if you have not
    created the certificate, then it will assign port 80, and if you have secured
    your Apache setup by creating a self-signed certificate, then it will look like
    one of these:'
  id: totrans-387
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 协议和路径将自动填充，即，如果您没有创建证书，它将分配端口80，如果您通过创建自签名证书来确保您的Apache设置，那么它将像这样：
- en: '`HTTP://scr:80/vcmpatches`'
  id: totrans-388
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`HTTP://scr:80/vcmpatches`'
- en: '`HTTPS://scr:443/vcmpatches`'
  id: totrans-389
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`HTTPS://scr:443/vcmpatches`'
- en: Click on **Next** and **Finish** to save the settings.
  id: totrans-390
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**并点击**完成**以保存设置。
- en: Do this for all the machine groups that have Linux/Unix machines and will be
    patched with VCM.
  id: totrans-391
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对所有包含Linux/Unix机器并将使用VCM进行打补丁的机器组执行此操作。
- en: How it works...
  id: totrans-392
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: If we don't set staging options, then machine patching will fail as the machines
    won't know from where to get the installers. As a best practice, use HTTPS.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们没有设置暂存选项，则机器打补丁将失败，因为机器不知道从哪里获取安装程序。作为最佳实践，请使用HTTPS。
- en: Configuring the SCR Tool base path for the patching repository
  id: totrans-394
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置SCR工具基路径以进行打补丁仓库
- en: The setting for the SCR Tool base path in VCM must point to the location where
    you installed the SCR Tool on the patching repository machine.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: VCM中SCR工具基路径的设置必须指向您在打补丁仓库机器上安装SCR工具的位置。
- en: The base path directory contains directories for the SCR binary files, configuration
    files, and logs.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 基路径目录包含SCR二进制文件、配置文件和日志的目录。
- en: Getting ready
  id: totrans-397
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'As usual, we are building a patching mechanism, so all previous recipes are
    important to continue with subsequent ones. The same is applicable for this recipe:
    complete all the previous recipes before starting this one.'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 如同以往，我们正在构建一个打补丁机制，因此所有之前的操作步骤对于继续进行后续步骤至关重要。这一点对于本食谱同样适用：在开始本食谱之前，完成所有前面的食谱。
- en: How to do it...
  id: totrans-399
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In this recipe, we will make a few changes to the VCM configuration; just follow
    these steps:'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将对VCM配置进行一些更改；只需按照以下步骤操作：
- en: Navigate to **Administration** | **Settings** | **General ****Settings** | **Patching**
    |**UNIX** | **Additional Settings**.
  id: totrans-401
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**管理** | **设置** | **常规设置** | **打补丁** | **UNIX** | **附加设置**。
- en: Select **Default Machine Group Mapping for Temporary files during patching**
    and change it to a folder you know will have enough space to download the patches
    before installation.
  id: totrans-402
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**打补丁期间临时文件的默认机器组映射**，并将其更改为一个您知道有足够空间下载补丁的文件夹，供安装前使用。
- en: How much space is enough will depend on how many patches are getting deployed.
  id: totrans-403
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 足够的空间取决于部署的补丁数量。
- en: If you have standard partitions across the entire Linux/Unix server, select
    a path where you will have enough space.
  id: totrans-404
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果整个Linux/Unix服务器具有标准分区，请选择一个有足够空间的路径。
- en: 'In our case, it is `/var/tmp`, as shown here:'
  id: totrans-405
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在我们的案例中，它是`/var/tmp`，如图所示：
- en: '![How to do it...](img/image_03_010.jpg)'
  id: totrans-406
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_010.jpg)'
- en: Click on **Next** (not visible in the screenshot) and **Finish** to close and
    save the setting.
  id: totrans-407
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**（截图中不可见）并点击**完成**以关闭并保存设置。
- en: Next in the list is **Default UNIX>Linux package Repository path**.
  id: totrans-408
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列表中的下一个是**默认UNIX>Linux包仓库路径**。
- en: This is the path to which we are *downloading the patches*; in our case, it
    is `/opt/vcmpatches`.![How to do it...](img/image_03_011.jpg)
  id: totrans-409
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是我们*下载补丁*的路径；在我们的案例中，它是`/opt/vcmpatches`。![如何操作...](img/image_03_011.jpg)
- en: Click on **Next** (not visible in the screenshot) and **Finish** to close and
    save the setting.
  id: totrans-410
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**（截图中不可见）并点击**完成**以关闭并保存设置。
- en: The final setting in the list is **Default UNIX/Linux package repository SCR
    base path**.
  id: totrans-411
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列表中的最后一个设置是**默认UNIX/Linux包仓库SCR基路径**。
- en: This is the location to which we *untarred or installed the SCR files* downloaded
    from [http://www.vmware.com](http://www.vmware.com).
  id: totrans-412
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这是我们从[http://www.vmware.com](http://www.vmware.com)下载并*解压或安装SCR文件*的目录。
- en: In our case, it is `/opt/SCR`.![How to do it...](img/image_03_012.jpg)
  id: totrans-413
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们的案例中，它是`/opt/SCR`。![如何操作...](img/image_03_012.jpg)
- en: Click on **Next** (not visible in the screenshot) and **Finish** to close and
    save the setting.
  id: totrans-414
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**（截图中不可见）并点击**完成**以关闭并保存设置。
- en: How it works...
  id: totrans-415
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The details of each setting are explained there only; this basically makes sure
    of the location of the SCR file to locate the `properties` file which is in the `/opt/SCR/conf`
    folder.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 每个设置的详细信息仅在此处解释；这基本上是确保SCR文件的位置，以便找到位于`/opt/SCR/conf`文件夹中的`properties`文件。
- en: To check the `manifest.pkl` file, which is available under the `/opt/vcmpatches`
    folder, this has all the RPMs listed.
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查`manifest.pkl`文件，该文件位于`/opt/vcmpatches`文件夹下，其中列出了所有的RPM包。
- en: Creating a patch assessment template
  id: totrans-418
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建补丁评估模板
- en: A patch assessment template is basically list of patches that will be installed
    on managed machines or will be used to check patch compliance against.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 补丁评估模板基本上是将要安装在受管机器上的补丁列表，或者用于检查补丁合规性的。
- en: Getting ready
  id: totrans-420
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: We need internet access on the Collector server to download patch metadata.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要在Collector服务器上有互联网访问权限，以便下载补丁元数据。
- en: How to do it...
  id: totrans-422
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Log in to the VCM console and follow these steps to create the required assessment
    template:'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到VCM控制台并按照以下步骤创建所需的评估模板：
- en: Navigate to **Patching** | **All UNIX/Linux Platforms** | **Assessment ****Templates**
    and click on **Add**.
  id: totrans-424
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**打补丁** | **所有UNIX/Linux平台** | **评估模板**，然后点击**添加**。
- en: Templates can be created under individual Unix/Linux platforms as well.
  id: totrans-425
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 模板也可以在各个Unix/Linux平台上创建。
- en: Give the template a descriptive name and add a description.
  id: totrans-426
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给模板起一个描述性的名称并添加描述。
- en: 'Select **Static** as the type of template. Here is the difference between a
    static and dynamic template:'
  id: totrans-427
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**静态**作为模板类型。静态模板和动态模板的区别如下：
- en: '**Static template:** With this, we can choose which patches are to be included
    in the template.'
  id: totrans-428
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**静态模板：** 使用此模板，我们可以选择哪些补丁要包含在模板中。'
- en: '**Dynamic template:** With this, VCM selects patches depending upon the query
    we set.'
  id: totrans-429
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**动态模板：** 使用此模板，VCM会根据我们设置的查询选择补丁。'
- en: '![How to do it...](img/image_03_013.jpg)'
  id: totrans-430
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_013.jpg)'
- en: If we selected a dynamic template, we have options to formulate queries, such
    as **OS Name**, **OS Version**, and **Severity**, and we can create multiple queries
    and select the **and**/**or **operator.
  id: totrans-431
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们选择了动态模板，我们可以设置查询条件，如**操作系统名称**、**操作系统版本**和**严重性**，并且可以创建多个查询并选择**与**/**或**操作符。
- en: Note
  id: totrans-432
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that you can have only one **and**/**or **operator for all queries.
  id: totrans-433
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，所有查询只能使用一个**与**/**或**操作符。
- en: '![How to do it...](img/image_03_014.jpg)'
  id: totrans-434
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_014.jpg)'
- en: If we select **S****tatic**, we are free to choose all the patches we want.
  id: totrans-435
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们选择**静态**模板，我们可以自由选择所有想要的补丁。
- en: There is a temporary filter we can apply to limit the number of patches to select
    from.
  id: totrans-436
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以应用一个临时筛选器来限制选择的补丁数量。
- en: Note
  id: totrans-437
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that multiple product bulletins can be wrapped up in this way. VCM will
    only attempt to patch an affected product, that is, if a VM is running RedHat
    6, then VCM will not attempt to apply RedHat 7 bulletins.
  id: totrans-438
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，多个产品公告可以通过这种方式打包。VCM只会尝试修补受影响的产品，也就是说，如果虚拟机运行的是RedHat 6，那么VCM不会尝试应用RedHat
    7的公告。
- en: '![How to do it...](img/image_03_015.jpg)'
  id: totrans-439
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_015.jpg)'
- en: Click on **Next** once all the required patches have been selected.
  id: totrans-440
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择所有需要的补丁后，点击**下一步**。
- en: Close the wizard by clicking on **Finish.**
  id: totrans-441
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**来关闭向导。
- en: How it works...
  id: totrans-442
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: We cannot deploy patches without creating assessment templates; these will be
    used for assessing the status of the machines, checking missing patches, and then
    deploying them.
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不能在没有创建评估模板的情况下部署补丁；这些模板将用于评估机器的状态，检查缺失的补丁，然后进行部署。
- en: We cannot make sure whether the patch we are selecting in the template will
    be there on the SCR server, so to avoid failures, we should always download all
    the patches to the SCR server.
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 我们无法确保在模板中选择的补丁是否存在于SCR服务器上，因此为了避免失败，我们应该始终将所有补丁下载到SCR服务器上。
- en: See also
  id: totrans-445
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: This patch assessment template will be used in *Deploying patches on Linux machines
    – on demand* and *Deploying patches on Linux machines – scheduled* recipes.
  id: totrans-446
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此补丁评估模板将用于*按需部署Linux机器上的补丁*和*按计划部署Linux机器上的补丁*配方。
- en: Deploying patches on Linux machines – on demand
  id: totrans-447
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Linux机器上部署补丁 – 按需部署
- en: 'This is what we''re executing all these recipes for: patching servers. By this
    time, we will be ready to install the patches on the managed machines. We can
    either schedule the patch to be installed or we can install them on demand. In
    this recipe, we will install the missing patches directly from the console.'
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是我们执行所有这些配方的目的：为服务器打补丁。到此时，我们已经准备好在受管机器上安装补丁。我们可以选择按计划安装补丁，也可以按需安装。在本配方中，我们将直接从控制台安装缺失的补丁。
- en: Getting ready
  id: totrans-449
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: Make sure the VM you want to patch is trusted in VCM; if it isn't, follow the
    same steps we followed to trust the SCR server in the *Configuring patching repository
    options in VCM* recipe.
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你想要修补的虚拟机在VCM中是受信任的；如果不是，请按照我们为SCR服务器建立信任时所遵循的步骤，在*配置VCM中的修补存储库选项*中操作。
- en: We must have DNS resolution to and from the Linux machine to be patched and
    the SCR and VCM servers.
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须确保Linux机器与待修补机器以及SCR和VCM服务器之间可以进行DNS解析。
- en: The managed machine must reach the VCM and SCR server on their IPs.
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 受管机器必须能通过其IP与VCM和SCR服务器连接。
- en: We should have performed a collection with the **Patching - Unix Assessment
    Result** as the **Filter Set** option, as explained in the *Collecting data from
    managed machines* recipe in [Chapter 2](ch02.html "Chapter 2. Configuring VCM
    to Manage Your Infrastructure"), *Configuring VCM to Manage * *Your Infrastructure*.
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该执行一个集合，使用**修补 - Unix评估结果**作为**过滤集**选项，如在[第2章](ch02.html "第2章 配置VCM以管理你的基础设施")中的*从受管机器收集数据*食谱所解释的那样，*配置VCM以管理你的基础设施*。
- en: How to do it...
  id: totrans-454
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Log in to the VCM console with admin privileges and start installing patches
    by following these steps:'
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 使用管理员权限登录VCM控制台并按照以下步骤开始安装补丁：
- en: Go to **Patching** | **Red****Hat** | **Assessment****Templates** and select
    the assessment template you have created.
  id: totrans-456
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**修补** | **RedHat** | **评估模板**并选择你创建的评估模板。
- en: Click on **View Report** in the top corner.
  id: totrans-457
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击右上角的**查看报告**。
- en: Once you see the report, drag **Recommended Action** to the **Filter** bar;
    now, the default view changes and you can see that it is arranged depending upon
    the **Recommended Action**.
  id: totrans-458
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦看到报告，将**推荐操作**拖动到**过滤器**栏；现在，默认视图会发生变化，你可以看到它根据**推荐操作**进行排序。
- en: Click on the small arrow in front of **Install Path**, select the patch and
    hit **Deploy** from the topmost menu.![How to do it...](img/image_03_016.jpg)
  id: totrans-459
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**安装路径**前的小箭头，选择补丁并从顶部菜单点击**部署**。[如何操作...](img/image_03_016.jpg)
- en: Select the items and click on **include prerequisite patches**.
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择项目并点击**包括前提补丁**。
- en: Validate the patches.
  id: totrans-461
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证补丁。
- en: Click on **advanced** and check whether this interests you or your Linux admin.
  id: totrans-462
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**高级**，并查看是否对你或你的Linux管理员有兴趣。
- en: Confirm the patch deployment and select the staging option.
  id: totrans-463
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认补丁部署并选择阶段选项。
- en: Note
  id: totrans-464
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Note that if the machine you want to patch belongs to a machine group that
    you did not assign a staging option to, you will see only one option enabled for
    you, that is, **None: Stage patches manually**.'
  id: totrans-465
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，如果你想修补的机器属于一个没有分配阶段选项的机器组，你将只看到一个选项，即**无：手动阶段补丁**。
- en: '![How to do it...](img/image_03_017.jpg)'
  id: totrans-466
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_017.jpg)'
- en: On the next page, choose whether you want to reboot the server.
  id: totrans-467
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页，选择是否要重启服务器。
- en: Click on **Finish** to close the wizard.
  id: totrans-468
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**以关闭向导。
- en: 'VCM will start installing the patch and you can check the status of the jobs
    it runs: all the three jobs–**Download**, **Stage**, and **Deployment–**should
    end with a **Succeeded** result.'
  id: totrans-469
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: VCM将开始安装补丁，你可以查看它运行的作业状态：所有三个作业——**下载**、**阶段**和**部署**——应该以**成功**的结果结束。
- en: If you chose to reboot the server, then after a reboot, check the status like
    we did in steps 3 and 4 of the recipe; it should say **Success** and list the
    name of the path we just installed.
  id: totrans-470
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果你选择重启服务器，那么在重启后，像我们在食谱的第3步和第4步中所做的那样检查状态；它应该显示**成功**并列出我们刚刚安装的路径名称。
- en: 'This is how it will look in the job history under **Administration** | **Job**
    | **Manager** | **Other jobs** | **Past 24 Hours**:'
  id: totrans-471
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在**管理** | **作业** | **经理** | **其他作业** | **过去24小时**的作业历史中，它将呈现如下：
- en: '![How to do it...](img/image_03_018.jpg)'
  id: totrans-472
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_03_018.jpg)'
- en: You can check the status of the patch in the VCM console and it will show you
    that the patch has been installed. To check the status, go to **Patching** | **RedHat**
    | **Assessment Template** | "Template name ":![How to do it...](img/image_03_019.jpg)
  id: totrans-473
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以在VCM控制台中检查补丁的状态，它会显示补丁已安装。要检查状态，请前往**修补** | **RedHat** | **评估模板** | "模板名称"
    :![如何操作...](img/image_03_019.jpg)
- en: How it works...
  id: totrans-474
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When we push the patch from the VCM console, it first assesses the machine to
    check whether the patch has been installed since the last assessment. If it is
    still required, then the patch that was staged at the location configured in the
    staging option gets installed, and then the VCM agent checks whether the patch
    was installed properly.
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们从VCM控制台推送补丁时，它首先评估机器，检查自上次评估以来是否已经安装了补丁。如果仍然需要补丁，那么在配置的暂存位置中准备好的补丁将被安装，随后VCM代理会检查补丁是否正确安装。
- en: If we schedule a reboot after that, then another job is configured in VCM and
    it starts, depending upon the configuration we select when deploying the patch.
    If the patch installation takes more time than the scheduled fixed reboot time,
    then the reboot job fails.
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们在此之后安排重启，那么VCM中将配置另一个作业并开始，具体取决于我们在部署补丁时选择的配置。如果补丁安装花费的时间超过了计划中的固定重启时间，则重启作业将失败。
- en: Deploying patches on Linux machines – scheduled
  id: totrans-477
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Linux机器上部署补丁 - 计划任务
- en: When we performed on-demand patching, we made sure the infrastructure we set
    up for patching Linux or Unix machines was working fine. Now, we need to take
    this to the next level by performing all the stuff automatically. In this recipe,
    we will configure all the required jobs so that VCM will perform patching of Linux/Unix
    machines on schedule.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们执行按需补丁时，我们确保为Linux或Unix机器设置的补丁基础设施正常工作。现在，我们需要将其提升到一个新的层次，通过自动执行所有操作。在这个教程中，我们将配置所有必需的作业，以便VCM能够按计划对Linux/Unix机器进行补丁。
- en: Getting ready
  id: totrans-479
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Preparation will be the same as earlier. Make sure the VM you want to patch
    is trusted in VCM; if it isn't, take the same steps we followed to trust the SCR
    server in the *Configuring patching repository options in VCM* recipe.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 准备工作与之前相同。确保你要打补丁的虚拟机在VCM中是受信任的；如果不是，请按照我们在*配置VCM中的补丁库选项*教程中所做的步骤，信任SCR服务器。
- en: We should have DNS resolution to and from the Linux machine to be patched and
    the SCR and VCM server.
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该确保Linux机器和待打补丁的SCR及VCM服务器之间能够进行DNS解析。
- en: The machine group where the VMs belong should have proper staging configured.
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机所在的机器组应配置适当的暂存。
- en: How to do it...
  id: totrans-483
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We now know patching Linux is a three-step process:'
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在知道，补丁Linux是一个三步过程：
- en: Collecting the latest data with **Patching - Unix Assessment Result** as the
    **Filter Se**t option
  id: totrans-485
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**补丁 - Unix评估结果**作为**筛选集**选项来收集最新数据。
- en: Performing the actual patching
  id: totrans-486
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行实际的补丁操作
- en: Again collecting the data (this is kind of optional as VCM also collects the
    data–it's just a precaution)
  id: totrans-487
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 再次收集数据（这算是可选的，因为VCM也会收集数据——这只是一个预防措施）。
- en: 'So, let''s begin by scheduling the required tasks in VCM so that our machines
    will get patched automatically:'
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，让我们从在VCM中安排所需任务开始，以便我们的机器能够自动打补丁：
- en: '| **Sr. No.** | **Name** | **Schedule** | **Reason** |'
  id: totrans-489
  prefs: []
  type: TYPE_TB
  zh: '| **序号** | **名称** | **计划** | **原因** |'
- en: '| **1** | Initial collection | First Sunday 08:00 am | 12 hours before the
    actual patch |'
  id: totrans-490
  prefs: []
  type: TYPE_TB
  zh: '| **1** | 初步收集 | 第一个星期天上午08:00 | 实际补丁前12小时 |'
- en: '| **2** | Deploying the patch | First Sunday 08:00 pm | Scheduled patch maintenance
    window |'
  id: totrans-491
  prefs: []
  type: TYPE_TB
  zh: '| **2** | 部署补丁 | 第一个星期天晚上08:00 | 计划补丁维护窗口 |'
- en: '| **3** | Final assessment | First Sunday 11:00 pm | 3 hours after patching
    to give time for automated collection (happens after 30 minutes of patching and
    reboot) |'
  id: totrans-492
  prefs: []
  type: TYPE_TB
  zh: '| **3** | 最终评估 | 第一个星期天晚上11:00 | 补丁后3小时，给自动收集留出时间（发生在补丁安装和重启后的30分钟） |'
- en: Step 1 – the initial collection
  id: totrans-493
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 步骤1 – 初步收集
- en: Log in to the VCM console and go to **Administration** | **Job****Manager**
    | **Scheduled**.
  id: totrans-494
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到VCM控制台并进入**管理** | **作业管理器** | **计划任务**。
- en: Click on **Add**, select **Collection** once the wizard starts, and click on
    **Next**.
  id: totrans-495
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加**，在向导启动后选择**收集**，然后点击**下一步**。
- en: Provide a proper name and description.
  id: totrans-496
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供一个合适的名称和描述。
- en: Select **Patching - Unix Assessment Result** as the **Filter Set** option.
  id: totrans-497
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**补丁 - Unix评估结果**作为**筛选集**选项。
- en: Select the machine group you want to patch in this schedule.
  id: totrans-498
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择要在此计划中打补丁的机器组。
- en: Select a schedule, preferably one upto 24 hours before the actual patching.
  id: totrans-499
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个计划，最好是实际补丁前最多24小时。
- en: Click on **Next** and finally, after validating there are no conflicts, click
    on **Finish**.
  id: totrans-500
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**，并最终在验证没有冲突后，点击**完成**。
- en: This completes our first phase. The next is the actual patching schedule.
  id: totrans-501
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这完成了我们的第一阶段。接下来是实际的补丁计划。
- en: Step 2 – deploying the patch
  id: totrans-502
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 步骤2 – 部署补丁
- en: 'To schedule patching, follow these steps:'
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 要安排补丁操作，请按照以下步骤进行：
- en: Go to **Patching** | **All****Unix/Linux Platforms** | **Automatic Deployment**
  id: totrans-504
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **Patching** | **所有** **Unix/Linux 平台** | **自动部署**
- en: Give the deployment a name and add a description.
  id: totrans-505
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给部署指定一个名称并添加描述。
- en: Select the **Machine Group** we want to patch and whose data was collected in
    the earlier initial collection step.
  id: totrans-506
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择我们要打补丁的 **机器组**，并且该机器组的数据在之前的初始采集步骤中已经被收集。
- en: Select the **Assessment Template** to deploy the patches with.
  id: totrans-507
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择用于部署补丁的 **评估模板**。
- en: 'On the next page, select the following:'
  id: totrans-508
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页中，选择以下内容：
- en: '**Scheduled Automatic Deployment Run**'
  id: totrans-509
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**计划的自动部署运行**'
- en: Depending upon the organization's policy, select whether you want to reboot
    or not.
  id: totrans-510
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据组织的政策，选择是否需要重启。
- en: '**Threshold Data Age**: `2` days should be fine as we are performing the data
    collection for the past 24 hours. If the data is older than the number of configured
    days, the server will not be patched.'
  id: totrans-511
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**阈值数据年龄**：`2` 天应该没问题，因为我们正在对过去 24 小时的数据进行采集。如果数据比配置的天数更旧，则服务器将不会被打补丁。'
- en: '![Step 2 – deploying the patch](img/image_03_020.jpg)'
  id: totrans-512
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![步骤 2 – 部署补丁](img/image_03_020.jpg)'
- en: Select the schedule and click on **Finish** on the last page to save the scheduled
    patching.
  id: totrans-513
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择计划并在最后一页点击 **完成** 以保存计划的补丁。
- en: Step 3 – final assessment
  id: totrans-514
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第 3 步 – 最终评估
- en: Once patching is done, VCM performs a collection with **Patching - Unix Assessment
    Result** as the **Filter Set** option. Still, we can schedule one more task to
    collect the details.
  id: totrans-515
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 补丁安装完成后，VCM 执行一次采集，选择 **Patching - Unix 评估结果** 作为 **过滤集** 选项。仍然，我们可以再安排一个任务来收集详细信息。
- en: Follow the same steps we did for configuring prepatch data collection, but this
    time, change the name and the collection schedule so that this collection will
    start a few hours after the patching has finished.
  id: totrans-516
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按照我们为配置预补丁数据收集时的相同步骤操作，但这次需要更改名称和采集时间表，使得此次采集会在补丁安装完成后几小时开始。
- en: How it works...
  id: totrans-517
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Basically, we are scheduling the things we were doing manually to save us some
    time and to not be awake at midnight to patch the server. VCM starts the scheduled
    jobs on time, collects the data, checks which patches are missing, installs them,
    and finally collects post-patch data so that when we run patch reports, we will
    have the latest status of the managed machine.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，我们正在将之前手动执行的任务进行计划安排，这样可以节省时间，并且不需要在午夜时分醒来为服务器打补丁。VCM 会按时启动计划的任务，收集数据，检查缺少哪些补丁，安装这些补丁，最后收集补丁后的数据，以便我们在运行补丁报告时，能够看到托管机器的最新状态。
- en: To check the reports, have a look at the *Patching Reports* recipe in [Chapter
    4](ch04.html "Chapter 4. Windows Patching"), *Windows Patching*. The only difference
    we can expect there is that the name is different; we need to replace Windows
    with Unix.
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看报告，可以查看 [第 4 章](ch04.html "第 4 章。Windows 补丁") 中的 *补丁报告* 配方，*Windows 补丁*。我们在这里唯一可以期待的不同之处是名称不同；我们需要将
    Windows 替换为 Unix。
