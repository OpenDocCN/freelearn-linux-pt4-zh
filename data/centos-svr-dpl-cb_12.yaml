- en: Chapter 12. Virtualization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 12 章：虚拟化
- en: 'This chapter contains the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包含以下配方：
- en: Creating a new virtual machine
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建新的虚拟机
- en: Cloning a virtual machine
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 克隆虚拟机
- en: Adding storage to a virtual machine
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向虚拟机添加存储
- en: Connecting USB peripherals to a guest system
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接 USB 外部设备到来宾系统
- en: Configuring a guest's network interface
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置来宾的网络接口
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: The recipes in this chapter focus on running a second operating system as a
    guest using virtualization on your CentOS system. You'll learn how to setup the
    virtual machine to install a guest operating system, properly create a copy of
    the machine through cloning, and add additional storage resources. You'll also
    learn how to share access to USB peripherals attached to the host system and configure
    the guest's virtual network interface to access the network.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的配方重点介绍如何在 CentOS 系统上使用虚拟化运行第二个操作系统作为来宾操作系统。你将学习如何设置虚拟机来安装来宾操作系统，如何通过克隆正确创建虚拟机的副本，并添加额外的存储资源。你还将学习如何共享对连接到宿主系统的
    USB 外设的访问权限，并配置来宾的虚拟网络接口来访问网络。
- en: Creating a new virtual machine
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建新的虚拟机
- en: This recipe teaches you how to install the KVM virtualization software and create
    a new virtual machine. Virtualization allows us to take advantage of the hardware
    resources available to us by running multiple operating systems on the same physical
    system. The primary operating system is installed "bare-metal" and is known as
    the host OS. Then, special software is installed that allows the host to provide
    emulation or direct access to hardware resources. The resources are partitioned
    as virtual machines and several guest operating systems can then be installed
    and run on top of the host, each in their own virtual machine.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本章节将教你如何安装 KVM 虚拟化软件并创建一个新的虚拟机。虚拟化使我们能够通过在同一物理系统上运行多个操作系统来利用可用的硬件资源。主操作系统是裸金属安装的，称为宿主操作系统（Host
    OS）。然后，安装特殊软件，使宿主操作系统能够提供硬件资源的仿真或直接访问。这些资源被分配为虚拟机，并且可以在宿主操作系统上安装并运行多个来宾操作系统，每个操作系统在其自己的虚拟机中运行。
- en: Getting ready
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection and a
    graphical user interface installed (refer to the *Installing the GNOME desktop*
    and *Installing the KDE Plasma desktop* recipes in [Chapter 1](ch01.html "Chapter 1. Getting
    Started with CentOS"), *Getting Started with CentOS*). Administrative privileges
    are also required, either by logging in with the `root` account or through the
    use of `sudo`.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方需要一个具有工作网络连接和已安装图形用户界面的 CentOS 系统（请参阅 [第 1 章](ch01.html "第 1 章：CentOS 入门")中的
    *安装 GNOME 桌面* 和 *安装 KDE Plasma 桌面* 配方）。还需要管理员权限，可以通过登录 `root` 账户或使用 `sudo` 获得。
- en: How to do it...
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to install a guest operating system:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤安装来宾操作系统：
- en: 'Install the necessary virtualization packages using package groups:'
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用软件包组安装必要的虚拟化包：
- en: '[PRE0]'
  id: totrans-16
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Launch the Virtual Machine Manager application:'
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机管理器应用程序：
- en: '[PRE1]'
  id: totrans-18
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Create a new virtual machine by selecting **New Virtual Machine** from the **File**
    menu. This opens the **New VM** wizard.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过从 **文件** 菜单选择 **新建虚拟机** 来创建新的虚拟机。这将打开 **新虚拟机** 向导。
- en: Select the desired installation method and click on **Forward**. For this recipe,
    we'll choose the **Local install media** option:![How to do it...](img/image_12_001.jpg)
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择所需的安装方法并点击 **下一步**。对于本配方，我们将选择 **本地安装媒体** 选项：![如何操作...](img/image_12_001.jpg)
- en: The New VM wizard collects the necessary details to create a new machine
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 新虚拟机向导收集创建新机器所需的详细信息
- en: Select the media source. If the media is a CD or DVD, select the **Use CDROM
    or DVD** option. If the media is an ISO file, select the **Use ISO image** option
    and specify the path to the image file. Then, click on **Forward**:![How to do
    it...](img/image_12_002.jpg)
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择媒体源。如果媒体是 CD 或 DVD，选择 **使用 CDROM 或 DVD** 选项。如果媒体是 ISO 文件，选择 **使用 ISO 镜像**
    选项并指定镜像文件的路径。然后，点击 **下一步**：![如何操作...](img/image_12_002.jpg)
- en: The new machine will use an ISO file as its installation media
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 新机器将使用 ISO 文件作为其安装媒体
- en: Set the amount of RAM and the number of CPUs that you want to allocate to the
    virtual machine and then click on **Forward**:![How to do it...](img/image_12_003.jpg)
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置你想要分配给虚拟机的 RAM 大小和 CPU 数量，然后点击 **下一步**：![如何操作...](img/image_12_003.jpg)
- en: 1 GB of RAM and 1 CPU are allocated to the virtual machine
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 1 GB 的 RAM 和 1 个 CPU 分配给虚拟机
- en: Specify the storage capacity that will be allocated to the machine and then
    click on **Forward**:![How to do it...](img/image_12_004.jpg)
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定分配给机器的存储容量，然后点击**下一步**:![如何操作...](img/image_12_004.jpg)
- en: The machine is set up with 8 GB of storage
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 该机器设置了8 GB的存储空间
- en: Provide a name to identify the virtual machine and click on **Finish**:![How
    to do it...](img/image_12_005.jpg)
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供一个名称以标识虚拟机，然后点击**完成**:![如何操作...](img/image_12_005.jpg)
- en: The wizard is ready to create the virtual machine and boot the installation
    media
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 向导已准备好创建虚拟机并启动安装介质
- en: The virtual machine will automatically start and boot from the specified installation
    media. You can now proceed with installing your guest operating system in the
    machine as if it were a physical system:![How to do it...](img/image_12_006.jpg)
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 虚拟机将自动启动并从指定的安装介质启动。现在，您可以像在物理系统上一样在机器上继续安装您的客户操作系统:![如何操作...](img/image_12_006.jpg)
- en: An operating system can be installed on the virtual machine the same way as
    a physical system
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 可以像在物理系统上安装操作系统一样，在虚拟机上安装操作系统
- en: How it works...
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The necessary software is installed by installing three package groups; the
    `Virtualization Platform` group installs the base virtualization libraries, the
    `Virtualization Client` package installs client programs for creating and managing
    virtual machines, and the `Virtualization Tools` package installs utilities for
    maintaining the machines:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 必要的软件通过安装三个软件包组来完成；`虚拟化平台`组安装基础虚拟化库，`虚拟化客户端`包安装用于创建和管理虚拟机的客户端程序，`虚拟化工具`包安装用于维护机器的工具：
- en: '[PRE2]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'After installing the software, we used the Virtual Machine Manager to create
    a machine. The machine defines a virtual system, specifying what resources are
    available to the guest and how the guest may access them. Under the GNOME desktop
    environment, the manager is launched from the **System Tools** category of the
    **Applications** menu. In KDE, it''s found via the Kickoff Application Launcher
    under **Applications** | **System Tools**. The manager can also be launched from
    the command line with `virt-manager`:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 安装软件后，我们使用虚拟机管理器创建了一台机器。虚拟机定义了一个虚拟系统，指定了可供客户使用的资源以及客户如何访问这些资源。在GNOME桌面环境下，管理器可以从**系统工具**类别的**应用程序**菜单启动。在KDE中，可以通过Kickoff应用程序启动器在**应用程序**|**系统工具**下找到。管理器也可以通过命令行使用`virt-manager`启动：
- en: '[PRE3]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Note
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A new virtual machine can be created on the command line as well, using `virt-install`
    and specifying the resource allocations as arguments. This is especially useful
    if you want to script the process of spinning up new guests.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以通过命令行创建新的虚拟机，使用`virt-install`并指定资源分配作为参数。这对于希望通过脚本化方式快速创建新客户机的用户特别有用。
- en: The manager's new VM makes it easy to create a new virtual machine definition
    by prompting us for the necessary resource allocations. For instance, we're asked
    to provide the amount of RAM, the number of CPUs, and the amount of storage space
    to make available to the guest. After we provide the values, it creates the machine
    and starts it, booting from the specified installation media to install the guest
    operating system. From there, installing the operating system is the same as if
    you were installing it on a physical system.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 管理器的新虚拟机使得创建新的虚拟机定义变得容易，它会提示我们输入必要的资源分配。例如，我们需要提供内存大小、CPU数量以及可供客户使用的存储空间。提供完这些值后，管理器会创建并启动虚拟机，从指定的安装介质启动并安装客户操作系统。从那时起，安装操作系统就像在物理系统上安装一样。
- en: To boot a virtual machine, select the desired machine from the available list
    so that it's highlighted and then click on the play arrow icon in the manager's
    tool bar. Alternatively, right-click on the list entry and select **Run** from
    the context menu. This powers on the machine and its status changes to *Running*.
    When you're finished, you can power the machine off by clicking on the power switch
    icon in the tool bar or on one of the **Shut Down** options from the context menu.
    The machine's status changes to *Shut off*. To interact with the guest while it's
    running, double-click on the entry or highlight it and then click on the Open
    icon in the manager's tool bar.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动虚拟机，从可用的虚拟机列表中选择目标虚拟机，使其高亮显示，然后点击管理工具栏上的播放箭头图标。或者，右键点击列表条目，并从上下文菜单中选择**运行**。这样虚拟机将启动，状态变为*运行中*。完成后，可以通过点击工具栏上的电源图标或在上下文菜单中选择**关机**选项来关闭虚拟机。虚拟机状态将变为*已关闭*。要在虚拟机运行时与其交互，可以双击条目，或者高亮条目后点击工具栏上的打开图标。
- en: Note
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Scrollbars will appear on the side and bottom of the window if the guest's display
    is too large to show in its entirety. Scaling it to fit within the window can
    improve your experience. To adjust the display's presentation, select **Display**
    from **View**.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 如果客户机的显示内容过大，无法完全显示，窗口的侧边和底部会出现滚动条。调整显示以适应窗口可以改善体验。要调整显示设置，可以在**查看**菜单中选择**显示**。
- en: See also
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Refer to the following resources for more information on working with virtual
    machines:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下资源获取更多关于虚拟机操作的信息：
- en: The `virt-install` manual page (`man 1 virt-install`)
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`virt-install` 手册页面 (`man 1 virt-install`)'
- en: The KVM website ([http://www.linux-kvm.org/page/Main_Page](http://www.linux-kvm.org/page/Main_Page))
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: KVM 官方网站 ([http://www.linux-kvm.org/page/Main_Page](http://www.linux-kvm.org/page/Main_Page))
- en: RHEL 7 Virtualization Deployment and Administration Guide ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/))
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7 虚拟化部署与管理指南 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/))
- en: Best practices for KVM ([http://www.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatbpkickoff.htm](http://www.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatbpkickoff.htm))
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: KVM 最佳实践 ([http://www.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatbpkickoff.htm](http://www.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatbpkickoff.htm))
- en: Cloning a virtual machine
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 克隆虚拟机
- en: Since a virtual machine is ultimately nothing more than data files, these can
    easily be copied and shared. This is useful because you can set up a gold server
    exactly how you want it and then make copies that are used for different purposes.
    However, using the `cp` command isn't the way to go about it. This recipe shows
    you the correct way to duplicate a machine with a process called cloning.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 由于虚拟机本质上只是数据文件，因此可以轻松复制和共享。这很有用，因为你可以根据自己的需求设置一个金牌服务器，然后制作多个副本用于不同的目的。然而，使用`cp`命令并不是实现克隆的正确方式。本教程将展示如何通过克隆这一过程来正确地复制一台虚拟机。
- en: Getting ready
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a virtual machine set up as described in the previous recipe.
    While the cloning process doesn't require administrative privileges per se, privileges
    may be needed to access the machine's files depending on where they are located.
    By default, the files are stored at `/var/lib/libvirt/images`, which requires
    administrative access.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程要求先按照前一个教程中的说明设置好虚拟机。虽然克隆过程本身不需要管理员权限，但根据文件存放位置，访问虚拟机文件时可能需要管理员权限。默认情况下，文件存放在`/var/lib/libvirt/images`，这需要管理员访问权限。
- en: How to do it...
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to clone a virtual machine:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤克隆虚拟机：
- en: Make sure the machine you want to clone is not running.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请确保你想要克隆的虚拟机没有在运行。
- en: In Virtual Machine Manager, right-click on the desired machine in the list of
    available machines and select **Clone** from the context menu. This opens the
    **Clone Virtual Machine** dialog:![How to do it...](img/image_12_007.jpg)
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在虚拟机管理器中，右键点击列表中的目标虚拟机，并从上下文菜单中选择**克隆**。这将打开**克隆虚拟机**对话框：![如何操作...](img/image_12_007.jpg)
- en: The Clone Virtual Machine dialog makes it easy to clone a machine image
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**克隆虚拟机**对话框使克隆虚拟机镜像变得容易'
- en: Specify a unique name for the new image and click on the **Clone** button. This
    will create a standalone copy of the virtual machine and selected storage.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为新镜像指定一个唯一名称，然后点击**克隆**按钮。这将创建一个虚拟机及其选定存储的独立副本。
- en: How it works...
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: This recipe used Virtual Machine Manager to create a copy of a machine known
    as a clone. The machine should be cloned in this manner instead of simply copying
    the underlying files, because the cloning process also updates various identifiers
    that should be unique between machines, such as the MAC address of the network
    interface.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程使用虚拟机管理器创建了一个机器副本，称为克隆。机器应以这种方式克隆，而不是仅仅复制底层文件，因为克隆过程还会更新应在机器之间唯一的各种标识符，例如网络接口的MAC地址。
- en: Note
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The `virt-clone` command can be used to clone a guest on the command-line. For
    more information, refer to the program's man page using `man 1 virt-clone`.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '`virt-clone`命令可用于通过命令行克隆客户机。有关更多信息，请通过`man 1 virt-clone`查看该程序的手册页。'
- en: 'If you want to update various aspects of the cloned machine before booting
    it, you can use tools such as `virt-sysprep` and `virt-configure`. These programs
    mount the machine''s disk image in a chrooted environment, perform the requested
    modifications, and then unmount the image. `virt-sysprep` is installed via `libguestfs-tools-c`:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望在启动克隆机器之前更新其各个方面，可以使用诸如`virt-sysprep`和`virt-configure`之类的工具。这些程序将在一个chroot环境中挂载机器的磁盘镜像，执行所请求的修改，然后卸载镜像。`virt-sysprep`通过`libguestfs-tools-c`安装：
- en: '[PRE4]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'To view a list of the available maintenance actions `virt-sysprep` can perform,
    invoke the program using `--list-operations`. Each option will be displayed along
    with a brief description of what it does. To perform an operation, use the `--operation`
    argument followed by one or more of the operation labels, separated by commas.
    For example, the following command clears the bash history for any accounts on
    the system and deletes any files that may be in `/tmp`. The `-a` argument provides
    the path to the machine''s disk image:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看`virt-sysprep`可以执行的可用维护操作列表，可以使用`--list-operations`命令启动程序。每个选项将显示并附带简短的描述，说明它的功能。要执行某项操作，请使用`--operation`参数，后跟一个或多个操作标签，标签之间用逗号分隔。例如，以下命令会清除系统中所有账户的bash历史记录，并删除可能位于`/tmp`中的任何文件。`-a`参数提供机器磁盘镜像的路径：
- en: '[PRE5]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Depending on what the original machine image was used for, you may find the
    following cleanup operations useful as well:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 根据原始机器镜像的用途，您可能还会发现以下清理操作有用：
- en: '`ca-certificates`: This deletes any CA certificates'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ca-certificates`：此命令删除任何CA证书'
- en: '`logfiles`: This deletes log files'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`logfiles`：此命令用于删除日志文件'
- en: '`ssh-hostkeys`: This deletes the SSH host keys'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ssh-hostkeys`：此命令用于删除SSH主机密钥'
- en: '`ssh-userdir`: This deletes the users'' `.ssh` directories'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ssh-userdir`：此命令用于删除用户的`.ssh`目录'
- en: '`user-account`: This deletes all user accounts except for root'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`user-account`：此命令删除所有用户账户，除root外'
- en: There is some overlap in the functionality of `virt-sysprep` and `virt-customize`;
    however, `virt-customize` performs more general customization operations, while
    virt-sysprep's actions focus more on cleaning up an image. `virt-customize` can
    do things like move and set the system's hostname, reset passwords, and install
    and uninstall packages.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '`virt-sysprep`和`virt-customize`的功能有所重叠；然而，`virt-customize`执行更多的一般性定制操作，而`virt-sysprep`则侧重于清理镜像。`virt-customize`可以执行诸如移动和设置系统主机名、重置密码、安装和卸载包等操作。'
- en: 'To reset the system''s hostname, use the `--hostname` argument and provide
    the desired name:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 要重置系统的主机名，请使用`--hostname`参数并提供所需的名称：
- en: '[PRE6]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The `--install` and `--uninstall` arguments add and remove packages and specify
    one or more package names separated by commas:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '`--install`和`--uninstall`参数用于添加或删除包，并指定一个或多个包名称，包名称之间用逗号分隔：'
- en: '[PRE7]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Some arguments you may find useful for `virt-customize` are as follows:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些您可能会在`virt-customize`中找到有用的参数：
- en: '`--chmod`: This changes file permissions'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--chmod`：此命令用于更改文件权限'
- en: '`--copy`: This creates a copy of a file or directory'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--copy`：此命令用于创建文件或目录的副本'
- en: '`--delete`: This removes a file or directory'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--delete`：此命令用于删除文件或目录'
- en: '`--mkdir`: This creates a new directory'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--mkdir`：此命令用于创建一个新的目录'
- en: '`--move`: This moves a file or directory to a new destination'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--move`：此命令将文件或目录移动到新位置'
- en: '`--password`: This updates a user''s password'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--password`：此命令用于更新用户的密码'
- en: '`--run-command`: This runs a command on the image'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--run-command`：此命令在镜像上运行命令'
- en: See also
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: 'Refer to the following resources for more information on cloning and customizing
    virtual machines:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下资源，获取有关克隆和定制虚拟机的更多信息：
- en: The `virt-clone` manual page (`man 1 virt-clone`)
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`virt-clone`手册页（`man 1 virt-clone`）'
- en: The `virt-configure` manual page (`man 1 virt-configure`)
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`virt-configure`手册页（`man 1 virt-configure`）'
- en: The `virt-sysprep` manual page (`man 1 virt-sysprep`)
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`virt-sysprep`手册页（`man 1 virt-sysprep`）'
- en: How to clone a KVM virtual machine and reset the VM ([http://www.unixarena.com/2015/12/how-to-clone-a-kvm-virtual-machines-and-reset-the-vm.html](http://www.unixarena.com/2015/12/how-to-clone-a-kvm-virtual-machines-and-reset-the-vm.html))
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何克隆KVM虚拟机并重置虚拟机（[http://www.unixarena.com/2015/12/how-to-clone-a-kvm-virtual-machines-and-reset-the-vm.html](http://www.unixarena.com/2015/12/how-to-clone-a-kvm-virtual-machines-and-reset-the-vm.html)）
- en: Adding storage to a virtual machine
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向虚拟机添加存储
- en: Even if you're not a data hoarder, the time will probably come when you need
    to add additional storage to a guest system. No worries! This is easy to do! This
    recipe teaches you how to add and modify the virtual hardware attached to a machine.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 即使你不是数据囤积者，可能也会遇到需要为来宾系统添加额外存储的情况。别担心！这很简单！本配方教你如何添加和修改附加到机器上的虚拟硬件。
- en: Getting ready
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a virtual machine set up as described in the previous recipes.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 该配方需要按照前面的配方描述设置虚拟机。
- en: How to do it...
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to add storage to a virtual machine:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤为虚拟机添加存储：
- en: Make sure the virtual machine you want to modify is not running.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保你想要修改的虚拟机没有在运行。
- en: Open the virtual machine by double-clicking on the desired entry in the list
    of available machines.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过双击可用机器列表中的目标条目来打开虚拟机。
- en: Either click on the lightbulb icon in the menu bar or select **Details** from
    **View** to show the virtual machine's hardware details:![How to do it...](img/image_12_008.jpg)
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可以点击菜单栏中的灯泡图标或从**视图**中选择**详情**来显示虚拟机的硬件详细信息：![如何操作...](img/image_12_008.jpg)
- en: The machine's virtual hardware is displayed and resources can be added, modified,
    and removed
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 机器的虚拟硬件会显示出来，资源可以添加、修改或移除。
- en: Click on the **Add Hardware** button in the bottom-left corner of the window
    to open the **Add New Virtual Hardware** window.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击窗口左下角的**添加硬件**按钮，打开**添加新虚拟硬件**窗口。
- en: Select **Storage** from the list of possible resources. Specify the desired
    storage space to allocate for the new disk and click on **Finish**:![How to do
    it...](img/image_12_009.jpg)
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从可用资源列表中选择**存储**。指定要分配给新磁盘的存储空间，并点击**完成**：![如何操作...](img/image_12_009.jpg)
- en: A virtual 8 GB storage drive is added to the machine
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 向机器添加了一个虚拟的8GB存储驱动器
- en: Leave the hardware view by either clicking on the computer icon in the menu
    bar or selecting **Console** from **View**.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击菜单栏中的计算机图标或从**视图**中选择**控制台**来离开硬件视图。
- en: How it works...
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何运作...
- en: This recipe showed you where to configure the virtual hardware definitions associated
    with a machine. To increase the storage available to a guest operating system,
    we navigated to this view and added a new virtual drive. The storage device can
    be created through the interface, as shown in the recipe, or an existing drive
    file can be selected and attached to the system.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方展示了如何配置与机器相关的虚拟硬件定义。为了增加给来宾操作系统可用的存储空间，我们导航到该视图并添加了一个新的虚拟硬盘。可以通过界面创建存储设备，如配方所示，或者选择一个现有的硬盘文件并将其附加到系统中。
- en: Note
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you are creating a new disk, you will want to partition, format, and mount
    the storage so it can be used. You may find the recipes discussed in [Chapter
    5](ch05.html "Chapter 5. Managing Filesystems and Storage"), *Managing Filesystems and
    Storage *helpful.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你要创建一个新磁盘，你需要对存储进行分区、格式化和挂载，这样它才能使用。你可能会发现[第5章](ch05.html "第5章 管理文件系统和存储")，*管理文件系统和存储*对你有所帮助。
- en: Other hardware can be managed via the hardware view as well. Most notably, you
    can add and configure new network interfaces and allocate additional RAM and CPU
    resources. Increasing the RAM/CPU might be done to run resource-intensive processes
    on the system—it's better to allocate a smaller amount first and then increase
    the resources when the need arises.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 其他硬件也可以通过硬件视图进行管理。最显著的是，你可以添加和配置新的网络接口，并分配额外的RAM和CPU资源。增加RAM/CPU的目的是在系统上运行资源密集型进程——最好先分配少量资源，然后在需要时增加资源。
- en: Another useful configuration is to change the display server. By default, the
    display is configured to use SPICE, a more robust protocol than VNC. A SPICE server
    is built into the virtualization platform so that you can connect to the virtual
    machine using a SPICE client to access its display, even if the guest is only
    running a console display (refer to [https://www.spice-space.org/](https://www.spice-space.org/)
    to find a SPICE client). If you want to connect using VNC instead, select the
    **Display Spice** entry in the hardware list and set its **Type** to **VNC server**.
    Change the **Address** value to **All interfaces** to accept connections from
    outside the localhost, specify a connection password, and then click on the **Apply**
    button.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 另一项有用的配置是更改显示服务器。默认情况下，显示配置为使用SPICE协议，这是一种比VNC更强大的协议。SPICE服务器内置于虚拟化平台中，因此即使客户机仅运行控制台显示，你也可以使用SPICE客户端连接虚拟机并访问其显示（参阅[https://www.spice-space.org/](https://www.spice-space.org/)以获取SPICE客户端）。如果你想改用VNC连接，请在硬件列表中选择**显示SPICE**项，并将其**类型**设置为**VNC服务器**。将**地址**值更改为**所有接口**，以接受来自本地主机以外的连接，指定连接密码，然后点击**应用**按钮。
- en: 'The display''s label in the hardware list will change to **Display VNC**:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 硬件列表中的显示标签将更改为**显示VNC**：
- en: '![How it works...](img/image_12_010.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![它是如何工作的...](img/image_12_010.jpg)'
- en: Users can connect to a virtual system's display using a SPICE or VNC client
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可以使用SPICE或VNC客户端连接到虚拟系统的显示
- en: See also
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: 'Refer to the following resources for more information on working with virtual
    hardware:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下资源，了解更多关于虚拟硬件操作的信息：
- en: 'RHEL 7 Virtualization Deployment and Administration Guide: Storage Pools  
    ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Storage_pools.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Storage_pools.html))'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7 虚拟化部署与管理指南：存储池   ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Storage_pools.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Storage_pools.html))
- en: Storage management ([http://libvirt.org/storage.html](http://libvirt.org/storage.html))
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储管理 ([http://libvirt.org/storage.html](http://libvirt.org/storage.html))
- en: Connecting USB peripherals to a guest system
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将USB外设连接到客户系统
- en: This recipe teaches you how to share the USB devices that are connected to the
    host system with a virtual machine. This means you can use your USB printers,
    webcams, and storage devices from your guest operating system.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方教你如何将连接到主机系统的USB设备共享给虚拟机。这意味着你可以从客户操作系统中使用USB打印机、网络摄像头和存储设备。
- en: Getting ready
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a virtual machine set up as described in the previous recipes.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方要求按照之前的配方设置虚拟机。
- en: How to do it...
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to connect USB peripherals to a guest system:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤将USB外设连接到客户系统：
- en: Make sure the virtual machine you want to modify is not running.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保你想要修改的虚拟机未运行。
- en: Attach the USB device to the physical system.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将USB设备连接到物理系统。
- en: Open the virtual machine by double-clicking on the desired entry in the list
    of available machines.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过双击可用机器列表中的目标条目打开虚拟机。
- en: Show the virtual machine's hardware details by clicking on the lightbulb icon
    in the menu bar or selecting **Details** from **View**.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击菜单栏中的灯泡图标或从**视图**中选择**详细信息**来显示虚拟机的硬件详细信息。
- en: Click on the **Add Hardware** button to open the **Add New Virtual Hardware**
    window.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加硬件**按钮以打开**添加新虚拟硬件**窗口。
- en: Select **USB HOST Device** from the list of resources.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从资源列表中选择**USB HOST设备**。
- en: Select the desired USB device and then click on the **Finish** button:![How
    to do it...](img/image_12_011.jpg)
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择所需的USB设备，然后点击**完成**按钮：![如何操作...](img/image_12_011.jpg)
- en: USB devices attached to the host system can be assigned to the virtual machines
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 附加到主机系统的USB设备可以分配给虚拟机
- en: Leave the hardware view by either clicking on the computer icon in the menu
    bar or selecting **Console** from **View**.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击菜单栏中的计算机图标或从**视图**中选择**控制台**来离开硬件视图。
- en: Start the virtual machine and verify that the USB device is available.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机并验证USB设备是否可用。
- en: How it works...
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: USB devices attached to the host system can be allocated to a virtual machine
    through the hardware details. We selected the **USB Host Device** category, which
    displayed all of the devices currently registered with the host from which we
    can make our selection. There are a couple of items to be aware of when using
    USB devices in your guest system. First, only the USB 1.1 protocol is supported.
    This isn't an issue for most peripherals, such as webcams, printers, and USB microphones,
    where transfer speed isn't much of a concern. It may be a concern if you intend
    to attach a USB storage device and transfer large amounts of data. Second, the
    device must be plugged in and accessible by the host before starting the virtual
    machine. This is because the virtualization platform running on the host is responsible
    for provisioning access to the guest.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 连接到主机系统的 USB 设备可以通过硬件详情分配给虚拟机。我们选择了**USB 主机设备**类别，显示了所有当前已注册在主机上的设备，我们可以从中进行选择。使用
    USB 设备时有几个需要注意的事项。首先，只支持 USB 1.1 协议。对于大多数外设（如网络摄像头、打印机和 USB 麦克风），传输速度并不是问题。然而，如果你打算连接一个
    USB 存储设备并传输大量数据，则可能会成为一个问题。其次，设备必须在启动虚拟机之前插入并由主机可访问。这是因为运行在主机上的虚拟化平台负责提供对虚拟机的访问。
- en: Note
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This recipe showed you how to assign a USB device connected to the host system
    to a guest. If you're accessing your virtual machine remotely with a SPICE client,
    you can plug in USB devices to your local machine and redirect them to the remote
    guest using USB redirection. More information can be found in the RHEL 7 Virtualization
    Deployment and Administration Guide.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程展示了如何将连接到主机系统的 USB 设备分配给虚拟机。如果你是通过 SPICE 客户端远程访问虚拟机，你可以将 USB 设备插入本地计算机并通过
    USB 重定向将其重定向到远程虚拟机。更多信息请参见 RHEL 7 虚拟化部署与管理指南。
- en: See also
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Refer to the following resources for more information on sharing USB devices:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 参阅以下资源以获取有关共享 USB 设备的更多信息：
- en: 'RHEL 7 Virtualization Deployment and Administration Guide: USB Devices    
    ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Guest_virtual_machine_device_configuration-USB_devices.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Guest_virtual_machine_device_configuration-USB_devices.html))'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7 虚拟化部署与管理指南：USB 设备 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Guest_virtual_machine_device_configuration-USB_devices.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Guest_virtual_machine_device_configuration-USB_devices.html))
- en: USB pass-through with libvirt and KVM ([https://david.wragg.org/blog/2009/03/usb-pass-through-with-libvirt-and-kvm.html](https://david.wragg.org/blog/2009/03/usb-pass-through-with-libvirt-and-kvm.html))
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 libvirt 和 KVM 进行 USB 直通 ([https://david.wragg.org/blog/2009/03/usb-pass-through-with-libvirt-and-kvm.html](https://david.wragg.org/blog/2009/03/usb-pass-through-with-libvirt-and-kvm.html))
- en: Configuring a guest's network interface
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置虚拟机的网络接口
- en: This recipe teaches you how to configure the virtual network interface's behavior.
    By changing the interface's behavior, you can provide the guest direct access
    or filtered access to the network, and even set up a local network visible only
    to the host system and other guests.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程教你如何配置虚拟网络接口的行为。通过更改接口的行为，你可以为虚拟机提供直接访问或过滤访问网络的方式，甚至可以设置一个仅对主机系统和其他虚拟机可见的本地网络。
- en: Getting ready
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection. It also
    requires a virtual machine set up as described in the previous recipes.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程需要一个具有有效网络连接的 CentOS 系统，还需要按照前面教程的描述设置好虚拟机。
- en: How to do it...
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to configure a guest''s network interface:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤配置虚拟机的网络接口：
- en: Make sure that the virtual machine you want to modify is not running.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保你要修改的虚拟机未在运行。
- en: Open the virtual machine by double-clicking on the desired entry in the list
    of available machines.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击列表中所需的虚拟机条目以打开虚拟机。
- en: View the virtual machine's hardware details by clicking on the lightbulb icon
    in the menu bar or selecting **Details** from **View**.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击菜单栏中的灯泡图标或从**视图**中选择**详细信息**来查看虚拟机的硬件详情。
- en: Specify the desired **Network source** (NAT or Host device).
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定所需的**网络源**（NAT 或主机设备）。
- en: If selecting a host device, specify the desired mode (Bridged, VEPA, Private,
    or Passthrough):![How to do it...](img/image_12_012.jpg)
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果选择主机设备，请指定所需的模式（桥接、VEPA、私有或直通）：![如何操作...](img/image_12_012.jpg)
- en: The virtual network interface can be configured to handle the guest's traffic
    in different ways
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 虚拟网络接口可以配置为以不同方式处理来宾的流量。
- en: Click on the **Apply** button to save your configuration.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**应用**按钮保存配置。
- en: Leave the hardware view by either clicking on the computer icon in the menu
    bar or selecting **Console** from **View**.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击菜单栏中的计算机图标或从**视图**中选择**控制台**，离开硬件视图。
- en: Start the virtual machine and proceed to configuring the guest's networking
    as necessary.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机，并根据需要进行来宾网络配置。
- en: How it works...
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Managing a guest's network connectivity is a matter of specifying the behavior
    of the virtual machine's network adaptor. To do this correctly, we need to first
    understand what the behaviors are from the options that are available to us.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 管理来宾的网络连接性是指定虚拟机网络适配器行为的问题。为了正确操作，我们首先需要了解可用选项的行为。
- en: The first option is **Network Address Translation** (**NAT**) and that is the
    default for new virtual machines. The virtualization platform provides a virtual
    network interface to the guest and handles all of its traffic. The platform marshals
    the traffic through the host's physical interface, acting very much like a router
    between the guest and host.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个选项是**网络地址转换**（**NAT**），这是新虚拟机的默认设置。虚拟化平台为来宾提供一个虚拟网络接口，并处理其所有流量。平台通过主机的物理接口转发流量，表现得像是来宾与主机之间的路由器。
- en: 'The second option is to tie the virtual interface directly to the host''s physical
    interface. There are four sharing modes, which are as follows:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个选项是将虚拟接口直接绑定到主机的物理接口。共有四种共享模式，具体如下：
- en: '**Bridged**: The virtualization platform connects the guest and host interfaces,
    giving the guest direct access to the Internet. The guest needs to obtain its
    own IP address and has full access to the network.'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**桥接**：虚拟化平台连接来宾和主机的接口，使来宾可以直接访问互联网。来宾需要获取自己的IP地址，并可以完全访问网络。'
- en: '**VEPA**: This is for use with VEPA-capable network devices (special hardware
    requirements must be met).'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VEPA**：此选项适用于支持VEPA的网络设备（必须满足特殊硬件要求）。'
- en: '**Private**: The platform creates private network, routing packets so that
    virtual machines on the same host can communicate with one another and the external
    network, but connections coming in from the network can''t reach the virtual machines.'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**私有**：平台创建一个私有网络，路由数据包使得同一主机上的虚拟机能够相互通信以及与外部网络通信，但来自网络的连接无法到达虚拟机。'
- en: '**Passthrough**: The host''s interface is shared directly (additional technical
    requirements must be met).'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**直通**：主机的接口直接共享（必须满足额外的技术要求）。'
- en: The documentation and terminology are quite technical, given the nature of the
    subject. Moreover, many people who are not networking experts often have trouble
    deciding the correct configuration. In my experience, there're two common scenarios
    in which non-networkers use virtualization-local virtualization to provide an
    alternate environment and virtualization to provision multiple server systems.
    If you're using your virtual machine as a typical desktop system where users need
    Internet access to read e-mail and surf the Web, use NAT networking and configure
    the guest to use DHCP. If you're running the machines as servers, share the host's
    adaptor in the Bridged mode and configure the guest with a static IP address.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 由于主题的技术性，文档和术语相当专业。而且，许多非网络专家的人在决定正确的配置时常常遇到困难。根据我的经验，非网络专业人员使用虚拟化的两种常见场景是：本地虚拟化用于提供备用环境，以及虚拟化用于提供多个服务器系统。如果你将虚拟机作为典型的桌面系统使用，用户需要通过互联网访问电子邮件和浏览网页，则使用NAT网络，并配置来宾使用DHCP。如果你将这些机器用作服务器，则在桥接模式下共享主机适配器，并为来宾配置静态IP地址。
- en: See also
  id: totrans-167
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: 'Refer to the following resources for more information on configuring the virtual
    network interface:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下资源，获取更多关于配置虚拟网络接口的信息：
- en: 'libvirt Virtualization API: Networking ([http://wiki.libvirt.org/page/Networking](http://wiki.libvirt.org/page/Networking))'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'libvirt 虚拟化 API: 网络配置 ([http://wiki.libvirt.org/page/Networking](http://wiki.libvirt.org/page/Networking))'
- en: 'RHEL 7 Virtualization Deployment and Administration Guide: Network Configuration
    ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Network_configuration.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Network_configuration.html))'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7 虚拟化部署与管理指南：网络配置 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Network_configuration.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Network_configuration.html))
