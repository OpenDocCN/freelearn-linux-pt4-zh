- en: Chapter 9. Troubleshooting VCM
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第9章。故障排除VCM
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下方法：
- en: Troubleshooting tools - EcmDebugEventViewer
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除工具 - EcmDebugEventViewer
- en: Troubleshooting tools - Job Manager | History
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除工具 - 作业管理器 | 历史记录
- en: Troubleshooting tools - Machine Collection Status
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除工具 - 机器收集状态
- en: Troubleshooting agent communication issues
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除代理通信问题
- en: Troubleshooting agent upgrade issues
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除代理升级问题
- en: Troubleshooting SCR download issues
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除SCR下载问题
- en: Troubleshooting VCM console login failure
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除VCM控制台登录失败
- en: Troubleshooting vCenter and vCloud data collection issues
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除vCenter和vCloud数据收集问题
- en: 'Troubleshooting the Recommended Action: Investigate Issue Linux server patch
    error'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除推荐操作：调查Linux服务器补丁错误
- en: Troubleshooting not being able to see any jobs on the console
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除无法在控制台上看到任何任务
- en: Troubleshooting not being able to see the Monthly option on the Schedule Job
    page
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除在调度作业页面看不到每月选项
- en: Introduction
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: 'Troubleshooting is the process of identifying the source of a problem and eliminating
    it. To start troubleshooting, you start with the most obvious possible problem
    and then pinpoint the exact issue. Doing this requires two things: experience
    of the entity you are troubleshooting and good tools to look at details such as
    logs and error codes.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 故障排除是识别问题来源并消除它的过程。开始故障排除时，你从最明显的可能问题入手，然后确定具体问题。做到这一点需要两样东西：故障排除对象的经验和能够查看详细信息（如日志和错误代码）的好工具。
- en: In this chapter, we will talk about both. In the first three recipes, you will
    be introduced to the tools, as they are necessary to gain some expertise in VCM
    troubleshooting, and then, we will look at some general issues and their solutions.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将讨论这两个问题。在前三个方法中，你将学习到这些工具，因为它们是VCM故障排除中必要的基础，然后我们将讨论一些常见问题及其解决方案。
- en: The troubleshooting tools we will cover include **EcmDebugEventViewer.exe**,
    **VCM logs**, **Job Manager | History**, and the **SQL log viewer**. If you are
    good with SQL, you can try SQL trace as well.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将介绍的故障排除工具包括**EcmDebugEventViewer.exe**、**VCM日志**、**作业管理器 | 历史记录**和**SQL日志查看器**。如果你熟悉SQL，你也可以尝试SQL跟踪。
- en: The general issues include issues with data collection, issues faced during
    patching, and issues with agent communication.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 常见问题包括数据收集问题、补丁安装问题以及代理通信问题。
- en: Agent communication messages are too cryptic; they say **Pingfailed** for every
    issue, You need to check what exactly went wrong.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 代理通信消息过于晦涩；它们对每个问题都显示**Pingfailed**，你需要检查到底发生了什么问题。
- en: So, let's get started with troubleshooting VCM.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，让我们开始故障排除VCM吧。
- en: Troubleshooting tools – EcmDebugEventViewer
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除工具 - EcmDebugEventViewer
- en: You can use the EcmDebugEventViewer tool to have a closer look at all the events
    that are stored in the VCM database. This will help you find event errors for
    your environment.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用EcmDebugEventViewer工具，深入查看存储在VCM数据库中的所有事件。这将帮助你查找环境中的事件错误。
- en: Getting ready
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: We need access to the VCM OS with admin rights.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要以管理员权限访问VCM操作系统。
- en: The tool is called EcmDebugEventViewer.exe. It is a standalone executable available
    in `C:\Program Files (x86)\VMware\VCM\Tools` (if you installed VCM with defaults).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具名为EcmDebugEventViewer.exe。它是一个独立的可执行文件，位于`C:\Program Files (x86)\VMware\VCM\Tools`（如果你按默认设置安装了VCM）。
- en: How to do it...
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'This recipe splits is in two parts: starting and filtering.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 这个方法分为两个部分：启动和过滤。
- en: Accessing events
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 访问事件
- en: 'The tool can be launched from its own location, or you can copy the `.exe` file
    anywhere and start. Follow these steps:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具可以从其所在位置启动，或者你可以将`.exe`文件复制到任何位置并启动。按照以下步骤操作：
- en: Connect to your VCM OS with administrator rights.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以管理员权限连接到你的VCM操作系统。
- en: Open an Explorer window and browse to `X:\Program Files (x86)\VMware\VCM\Tools`
    (*X* is the drive where you installed VCM).
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开资源管理器窗口并浏览到`X:\Program Files (x86)\VMware\VCM\Tools`（*X*是安装VCM的驱动器）。
- en: Right-click on **EcmDebugEventViewer.exe** and select **Run as Administrator**.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击**EcmDebugEventViewer.exe**并选择**以管理员身份运行**。
- en: 'You are now presented with a blank screen. You can choose from three possibilities:
    **Database**, **Collector DB**, or **Open File** to open a saved `.dbe` file.
    For this example, select **Database**.'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你会看到一个空白的屏幕。你可以从三种选项中选择：**数据库**、**收集器数据库**或**打开文件**以打开保存的`.dbe`文件。在本示例中，选择**数据库**。
- en: Press *F5*; it will fetch the content of the logs from the database.![Accessing
    events](img/image_09_001.jpg)
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按下*F5*，它将从数据库中获取日志内容。![访问事件](img/image_09_001.jpg)
- en: Double-click on a line to open more details. The following screenshot shows
    an error message that the VCM server is unable to resolve the mail server.![Accessing
    events](img/image_09_002.jpg)
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击某一行以打开更多细节。以下截图显示了一个错误消息，表示VCM服务器无法解析邮件服务器。![访问事件](img/image_09_002.jpg)
- en: You can use the **Up** and **Down** buttons on the details windows to see other
    log entries.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以使用详情窗口中的**上**和**下**按钮查看其他日志条目。
- en: Click on **Close** to close the event details.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**关闭**以关闭事件详情。
- en: Filtering events
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 过滤事件
- en: 'As there are lots of entries, you might want to reduce the amount by deploying
    a filer. Continue with these steps:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 由于条目很多，您可能想通过部署过滤器来减少数量。继续按照以下步骤操作：
- en: Click on **Filter settings** and then define a filtering criteria, such as the
    source or type of the message, as shown in the following screenshot:![Filtering
    events](img/image_09_003.jpg)
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**筛选设置**，然后定义筛选条件，例如消息的来源或类型，如下图所示：![过滤事件](img/image_09_003.jpg)
- en: You can also select the specific timeframes that should be shown. Click on **Date/Time**
    in the top menu and modify the duration, as shown in the following screenshot.![Filtering
    events](img/image_09_004.jpg)
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您还可以选择应显示的特定时间段。点击顶部菜单中的**日期/时间**并修改持续时间，如下图所示。![过滤事件](img/image_09_004.jpg)
- en: You can export the selected logs by going to **File | Save As dbe**. This will
    save all the lines.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以通过转到**文件 | 另存为 dbe**来导出选定的日志。这将保存所有的行。
- en: To save only selected lines, select the lines and then go to **File | Save Selected
    As dbe.**
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要仅保存选定的行，选择这些行，然后转到**文件 | 另存为 dbe**。
- en: This concludes our overview of the EcmDebugEventViewer tool.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 这就总结了我们对EcmDebugEventViewer工具的概述。
- en: How it works
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理
- en: You can open the main `VCM` database as well as the `VCM_Coll` database or any
    saved files.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以打开主`VCM`数据库以及`VCM_Coll`数据库或任何已保存的文件。
- en: When you are troubleshooting VCM issues, this is the first place to start. Always
    select the main VCM database as it contains the collected system data from the
    VCM agents along with all the processes it is performing.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 当您排查VCM问题时，这是开始的第一步。始终选择主要的VCM数据库，因为它包含来自VCM代理的系统数据以及所有正在执行的进程。
- en: 'Let''s take an example:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们举个例子：
- en: You are trying to patch a Linux machine and it is failing, and it is giving
    you the PingFailed error code. You check and find that you are able to ping the
    managed Linux machine and you can Telnet to the port-everything with regards to
    communication with the Linux machine is working fine. The small catch here is
    that VCM first tries to communicate with the SCR server on port `26542`, and if
    that is not accessible for any reason, it just gives you a cryptic PingFailed
    error. Now, if you start the ECMDebug tool, and you have already enabled the debug
    log level to info, you can see that it is trying to communicate with the SCR server
    and failing there.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 您正在尝试为一台Linux机器打补丁，但失败了，并且返回了PingFailed错误代码。您检查后发现，您可以成功ping通该受管Linux机器，并且可以Telnet到该端口——关于与Linux机器的通信一切正常。这里的小问题是，VCM首先尝试通过端口`26542`与SCR服务器通信，如果由于某种原因无法访问该端口，它会返回一个含糊的PingFailed错误。现在，如果您启动ECMDebug工具，并且已将调试日志级别设置为info，您可以看到它正在尝试与SCR服务器进行通信，但失败了。
- en: On further troubleshooting, you find that the agent was not communicating for
    some reason. After restarting it, you can proceed with patching.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 进一步排查时，您发现代理由于某种原因没有进行通信。重新启动后，您可以继续进行修补操作。
- en: The next option is the VCM collection database. The `VCM_Coll` database contains
    information about the UI, such as Collector settings and options. To be frank,
    I have hardly used it, so I don't really have a use case.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个选项是VCM收集数据库。`VCM_Coll`数据库包含有关UI的信息，例如收集器设置和选项。坦白说，我几乎没有使用过它，因此没有实际的用例。
- en: The last option is opening a DBE file. The VCM agent also saves its own logs
    in the `.dbe` file format, so to troubleshoot agent issues, you can copy the file
    from an agent to the server and read it, or someone can send you a saved `.dbe`
    file from their VCM installation, and after going through the file, you can provide
    suggestions. When you work with VMware, they will ask you to generate this `.dbe`
    file and send it to them so that they can review it and get back with some solution.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个选项是打开一个DBE文件。VCM代理也将其日志保存在`.dbe`文件格式中，因此在排查代理问题时，您可以将该文件从代理复制到服务器并读取，或者有人可以从他们的VCM安装中将已保存的`.dbe`文件发送给您，您可以查看该文件并提供建议。当您与VMware合作时，他们会要求您生成这个`.dbe`文件并将其发送给他们，以便他们可以进行审查并提供解决方案。
- en: Troubleshooting tools – Job Manager | History
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除工具 – 作业管理器 | 历史
- en: The History tool is built in to VCM. With this tool, you can look at the status
    of the jobs completed earlier, and it gives you the logs to further troubleshoot.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 历史工具内置到 VCM 中。使用此工具，您可以查看之前完成的作业的状态，并提供日志以进一步进行故障排除。
- en: Getting ready
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need access to the VCM console and basic understanding of VCM to roam
    around the console.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 需要访问 VCM 控制台并具备基本的 VCM 理解才能在控制台中漫游。
- en: How to do it...
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: To look at details about the jobs completed earlier, launch the VCM console
    and go to **Administration **| **Job Manager** | **History**.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看之前完成的作业的详细信息，请启动 VCM 控制台，然后转到**管理 | 作业管理器 | 历史**。
- en: 'You have four options here: **Instant Collections**, **Scheduled Collections**,
    **Other Jobs**, and **VCM remote**. If you are not troubleshooting collection
    issues, then you most probably need to go to **Other jobs** and select the job
    in the top-left pane, and the details will be visible in the bottom pane.'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 这里您有四个选项：**即时收集**、**计划收集**、**其他作业**和**VCM 远程**。如果您不是在解决收集问题，则最有可能需要转到**其他作业**并在左上窗格中选择作业，然后在底部窗格中查看详细信息。
- en: Select **Job History** and click on **View Details**. If the job had multiple
    machines, you will get an option to choose either of them, and then you can see
    what went wrong.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 选择**作业历史**，然后点击**查看详细信息**。如果作业涉及多台机器，您将可以选择其中之一，然后查看出了什么问题。
- en: In the following screenshot, when we hover over **Status**, we can see that
    there is something wrong with **Mutual authentication**.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下屏幕截图中，当我们悬停在**状态**上时，我们可以看到**双向认证**存在问题。
- en: We can use the M**enu** option at the top to copy the data, and it can then
    can be used to search on the Internet or provide an exact log to VMware for further
    troubleshooting.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用顶部的**菜单**选项复制数据，然后可以用于在互联网上搜索或向 VMware 提供精确的日志以进一步进行故障排除。
- en: '![How to do it...](img/image_09_005.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/image_09_005.jpg)'
- en: VCM Job Manager | History
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 作业管理器 | 历史
- en: How it works
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何工作
- en: Every time VCM performs a scheduled or on-demand job, it is captured at this
    location; you can have a look at them and see whether they failed or were successful.
    If they fail, it will give you errors, which you can use for further troubleshooting.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 每次 VCM 执行计划或按需作业时，都会在此位置记录；您可以查看它们，并查看它们是失败还是成功。如果它们失败，它将提供错误信息，供进一步故障排除使用。
- en: When you click on a job and select **View Details**, it will give you a popup
    to either have a look at the selected machine or all machines. You have an option
    to resubmit the job from here.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 当您点击作业并选择**查看详细信息**时，将会弹出一个窗口，您可以选择查看选定的机器或所有机器。您可以从这里重新提交作业。
- en: Let's have a look at a real-life experience. We were not able to patch a Linux
    server. We had configured the SCR server and VCM as expected, but it was still
    failing. After checking the logs here, we found that VCM is looking for a file
    called `REDHAT-rt.ptoperties`, while as per the documentation, we had configured
    file called `redhat-rt.properties`. After correcting the name of the file (to
    capital letters), we were able to patch the server.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看一个实际的经验。我们无法为 Linux 服务器打补丁。我们已按预期配置了 SCR 服务器和 VCM，但仍然失败。在这里检查日志后，我们发现 VCM
    正在寻找一个名为`REDHAT-rt.ptoperties`的文件，而根据文档，我们已配置了一个名为`redhat-rt.properties`的文件。在更正文件名称（改为大写字母）后，我们成功地为服务器打了补丁。
- en: Troubleshooting tools – Machine Collection Status
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除工具 – 机器集合状态
- en: '**Machine Collection Status** in the VCM console is where you can see what
    data is collected from which server and whether it is a full collection or a delta.
    This can come in handy when you are troubleshooting data collection issues.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在 VCM 控制台中的**机器集合状态**，您可以查看从哪个服务器收集了哪些数据，以及它是完整集合还是增量集合。在解决数据收集问题时，这可能会派上用场。
- en: Getting ready
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need access to the VCM console and basic understanding of VCM to roam
    around the console.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 需要访问 VCM 控制台并具备基本的 VCM 理解才能在控制台中漫游。
- en: How to do it...
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Go to **Administration **| **Machines Manager | Machine Collection Status**.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 转到**管理 | 机器管理器 | 机器集合状态**。
- en: As mentioned, we can have a look at what data was collected, which filter set
    was used, and which filters were successful in obtaining the data.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 正如提到的，我们可以查看收集了哪些数据，使用了哪个过滤器集以及哪些过滤器成功获取了数据。
- en: Let's assume you are creating a machine group with a specific dynamic rule and
    the machines are not getting populated, perhaps because the datatype you are using
    for filtering was not collected.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您正在创建一个带有特定动态规则的机器组，并且机器没有被填充，可能是因为您用于筛选的数据类型没有被收集。
- en: You are running a report for compliance and see **Data not Available** for performing
    the compliance test; as stated, perhaps the data was not collected.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 您正在运行合规性报告，发现进行合规性测试时显示**数据不可用**；如前所述，可能是数据未被收集。
- en: You can see the details by applying lots of filters in the console, as this
    will be a large table to look at if you have a big infrastructure.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过在控制台应用多个筛选器来查看详细信息，如果您的基础设施很大，这将是一个很大的表格。
- en: '![How to do it...](img/image_09_006.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/image_09_006.jpg)'
- en: Machine collection logs in VCM under Administration
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 下的机器收集日志位于管理部分
- en: How it works
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理
- en: When we collect data from managed machines, what we collect and when we made
    the collection is logged there.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们从受管机器收集数据时，我们收集的数据以及收集时间都会被记录。
- en: We were working with an RHEL 7 machine to collect the data. The job was successful,
    but when we tried patching the server, it did not show the status, that is, whether
    the patch is required or not. When we checked in the Machine Collection Status
    tool, we did not find our machine, which means that details were not getting captured.
    After checking the logs, we concluded that the VCM collector was not able to capture
    details. After resolving the issue with the machine, we performed another collect
    operation and found that the details are available and the machine is listed in
    Machine Collection Status.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们正在与一台 RHEL 7 机器一起收集数据。作业成功，但当我们尝试修补服务器时，它没有显示状态，即是否需要修补。当我们在机器收集状态工具中检查时，未找到我们的机器，这意味着详细信息没有被捕获。检查日志后，我们得出结论：VCM
    收集器无法捕获详细信息。在解决机器问题后，我们进行了另一次收集操作，发现详细信息可用，并且机器出现在机器收集状态中。
- en: Troubleshooting agent communication issues
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排查代理通信问题
- en: Now, we will have a look at multiple issues faced with agent communication and
    how they can be resolved.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将查看代理通信中遇到的多个问题及其解决方法。
- en: Getting ready
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'In this recipe, we will have a look at the following issues:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在本指南中，我们将查看以下问题：
- en: '*Issue 01: Mutual Authentication failed*'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*问题 01：相互认证失败*'
- en: '*Issue 02: Rethrown certificate issue*'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*问题 02：重新抛出的证书问题*'
- en: '*Issue 03: PingFailed*'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*问题 03：Ping 失败*'
- en: '*Issue 04: CredentialsFailed*'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*问题 04：凭证失败*'
- en: 'Issue 01: Mutual Authentication failed'
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 问题 01：相互认证失败
- en: 'Mutual authentication failure may happen after an upgrade. When you try to
    collect data, it fails with the error, as shown in the following screenshot:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 升级后可能会发生相互认证失败的情况。当您尝试收集数据时，它会失败，并显示如下截图中的错误：
- en: '![Issue 01: Mutual Authentication failed](img/image_09_007.jpg)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![问题 01：相互认证失败](img/image_09_007.jpg)'
- en: 'VCM agent communication issue : **Mutual Authentication Failed**'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 代理通信问题：**相互认证失败**
- en: You can see the error under **Administration **| **Job Manager **| **Instant
    Collection**.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在**管理**|**作业管理器**|**即时收集**下看到错误。
- en: Then, select the appropriate subsection. After that, select the **Job** in the
    top-left pane, and you'll be able to see the details in the bottom-left pane.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，选择适当的子部分。之后，选择左上角的**作业**，您将在左下角的窗格中看到详细信息。
- en: How to do it...
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To resolve the issue, follow these steps:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 要解决此问题，请按照以下步骤操作：
- en: Select the machine for which you are not able to collect data.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择无法收集数据的机器。
- en: Click on **Re-establish Mutual Authentication** (the handshake symbol on the
    menu bar).
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**重新建立相互认证**（菜单栏中的握手符号）。
- en: Select the machine or machines that are facing the issue.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择遇到问题的机器。
- en: Click on **Finish** to close the wizard.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**关闭向导。
- en: Confirm that the issue was resolved by performing the collection again.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过再次执行收集操作来确认问题是否已解决。
- en: 'Issue 02: Rethrown certificate issue'
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 问题 02：重新抛出的证书问题
- en: 'Agent-server communication is based on the certificate we use while installing
    the agent; if the certificate on the agent does not match the certificate on the
    server, then you will get the following error message:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 代理-服务器通信基于我们在安装代理时使用的证书；如果代理上的证书与服务器上的证书不匹配，则会出现以下错误信息：
- en: '![Issue 02: Rethrown certificate issue](img/image_09_008.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![问题 02：重新抛出的证书问题](img/image_09_008.jpg)'
- en: 'VCM agent communication: the rethrown certificate issue'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 代理通信：重新抛出的证书问题
- en: How to do it...
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To resolve the issue, do the following:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 要解决此问题，请执行以下操作：
- en: Reinstall the agent with the correct certificate and perform the collection
    again.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用正确的证书重新安装代理，并重新执行数据收集。
- en: In the case of a Linux server, use the installer from the correct VCM server,
    as the certificate is embedded in the installer.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果是 Linux 服务器，使用来自正确 VCM 服务器的安装程序，因为证书是嵌入在安装程序中的。
- en: 'Issue 03: PingFailed'
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '问题 03: PingFailed'
- en: 'This issue could be because of many things:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 这个问题可能由多种原因引起：
- en: DNS resolution for the managed machine is not working
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理的机器无法进行 DNS 解析
- en: The firewall is blocking port 26542 (either on the agent or between the server
    and agent)
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防火墙正在阻止端口 26542（可能是代理上，或者是服务器和代理之间的防火墙）
- en: The service is not running
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务未运行
- en: The agent is not installed
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代理未安装
- en: The machine is powered off
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 机器已关闭
- en: There are issues in routing; hence, the machine IP is not reachable
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在路由问题，因此机器 IP 无法访问
- en: '![Issue 03: PingFailed](img/image_09_009.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![问题 03: PingFailed](img/image_09_009.jpg)'
- en: 'VCM agent communication issue: PingFailed'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 代理通信问题：PingFailed
- en: How to do it...
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To resolve the issue, follow these steps:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 要解决此问题，请按以下步骤操作：
- en: Make sure the managed machine is powered on.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保管理机器已开机。
- en: Ping the managed machine with the hostname or FQDN and see whether the IP is
    resolved.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用主机名或 FQDN ping 管理机器，检查是否能解析出 IP 地址。
- en: 'Use the following commands:'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用以下命令：
- en: '[PRE0]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Make sure the latter two hostnames resolve the same IP, and the first command
    gives the correct hostname. It has been observed that sometimes the name resolution
    does not work as intended and needs corrections.
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 确保后两个主机名解析到相同的 IP 地址，并且第一个命令返回正确的主机名。已经观察到有时名称解析未按预期工作，需要进行修正。
- en: Trace the IP from the VCM server to check whether the machine can be reached
    from the VCM server and there are no routing issues; if there are any, add the
    required routes.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 跟踪从 VCM 服务器到目标 IP，检查是否可以从 VCM 服务器访问目标机器，且没有路由问题；如果有，添加所需的路由。
- en: 'Use the following command to do this:'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用以下命令执行此操作：
- en: '[PRE1]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'From the managed server, run this command:'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从管理服务器上运行以下命令：
- en: '[PRE2]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You must be able to reach from both the sides.
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您必须能从两端进行访问。
- en: Check the Telnet port 26542 from the VCM server; if it isn't working, check
    the local firewall on the managed machine. If that is disabled as well, check
    with the networking and security teams whether there is a firewall between the
    managed machine and VCM server and whether it has port 26542 open.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 VCM 服务器检查 Telnet 端口 26542；如果不可用，检查管理机器上的本地防火墙。如果防火墙已关闭，也请与网络和安全团队确认，是否存在防火墙在管理机器与
    VCM 服务器之间，且是否已打开端口 26542。
- en: 'From the VCM server, try following command:'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从 VCM 服务器，尝试执行以下命令：
- en: '[PRE3]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: For more on the required ports, have a look at the *Understanding the requirements
    of VCM* section of [Chapter 1](ch01.html "Chapter 1. Installing VCM"), *Installing
    VCM*.
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 有关所需端口的详细信息，请查看 [第 1 章](ch01.html "第 1 章. 安装 VCM")，*安装 VCM* 部分的 *理解 VCM 的要求*。
- en: Check the firewall on the local server.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查本地服务器上的防火墙。
- en: This should either be disabled or should have the required ports open.
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这应该被禁用或确保相关端口已打开。
- en: 'The procedure is different for Windows and Linux. Have a look at the following
    articles:'
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Windows 和 Linux 的处理方法不同。请查看以下文章：
- en: '**For Windows**: [https://technet.microsoft.com/en-us/library/cc753558.aspx](https://technet.microsoft.com/en-us/library/cc753558.aspx)'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**对于 Windows**：[https://technet.microsoft.com/en-us/library/cc753558.aspx](https://technet.microsoft.com/en-us/library/cc753558.aspx)'
- en: '**For RedHat**: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-Firewalls-Common_IPTables_Filtering.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-Firewalls-Common_IPTables_Filtering.html)'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**对于 RedHat**：[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-Firewalls-Common_IPTables_Filtering.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-Firewalls-Common_IPTables_Filtering.html)'
- en: 'Check whether CMAgent is installed. This can be done in multiple ways:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查是否已安装 CMAgent。可以通过多种方式进行检查：
- en: '**For Windows**:'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**对于 Windows**：'
- en: Check whether the CMagnet service is available.
  id: totrans-146
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 CMagnet 服务是否可用。
- en: Check whether the `C:\Windows\CMAgent` folder is present and is not empty.
  id: totrans-147
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 `C:\Windows\CMAgent` 文件夹是否存在且不为空。
- en: Check whether CMAgent is listed in **Add/Remove Programs**.
  id: totrans-148
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 CMAgent 是否出现在 **添加/删除程序** 中。
- en: '**For Linux**:'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**对于 Linux**：'
- en: Run `netstat -an | grep 26542`.
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行 `netstat -an | grep 26542`。
- en: Make sure the service is listening on port `26542`.
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 确保服务正在监听端口 `26542`。
- en: 'Check whether the service is running by executing this command:'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行以下命令检查服务是否正在运行：
- en: '[PRE4]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The command should return `tcp 0 0 :csi-agent *: LISTEN`.'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '该命令应返回 `tcp 0 0 :csi-agent *: LISTEN`。'
- en: 'Monitor processes with the top utility. If the top utility is installed and
    available, you can use it to monitor processes. Here''s how:'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 top 实用程序监控进程。如果已安装并可用，你可以使用它来监控进程。操作方法如下：
- en: Start the top utility.
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 top 实用程序。
- en: Type `u`.
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`u`。
- en: At the **Which User (Blank for All):** prompt, type the user account that the
    agent is installed as ( `csi_acct` ).
  id: totrans-158
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**用户（空白表示所有用户）：**提示符下，输入代理安装时使用的用户账户（`csi_acct`）。
- en: Type `s`.
  id: totrans-159
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`s`。
- en: At the D**elay between updates:** prompt, type `1`.
  id: totrans-160
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**更新之间的延迟：**提示符下，输入`1`。
- en: Check whether the CMAgent service is running.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 CMAgent 服务是否正在运行。
- en: Follow the OS-specific actions to check the status.
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 根据操作系统的特定操作检查状态。
- en: '**For Windows**:'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**对于 Windows**：'
- en: Run `services.msc` and make sure the **CM Socket Listener** service has been
    started.
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行 `services.msc` 并确保 **CM Socket Listener** 服务已启动。
- en: '**For Linux**:'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**对于 Linux**：'
- en: Log in to the managed server with root privileges.
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 root 权限登录到被管理服务器。
- en: Go to `/etc/init.d`.
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 进入 `/etc/init.d`。
- en: Execute `./csi-service status` and make sure it is running.
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行`./csi-service status`并确保它正在运行。
- en: 'Issue 04: CredentialsFailed'
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 问题 04：CredentialsFailed
- en: As shown in the following screenshot, you might get an error called **CredentialsFailed**.
    This happens when the network authority account configured for the managed machine
    does not have rights on the managed machine.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，你可能会遇到一个名为 **CredentialsFailed** 的错误。这发生在为被管理机器配置的网络权限账户没有在该机器上具有足够权限时。
- en: Chances are, the machine you are managing is either from another domain or in
    a workgroup, and you did not add the required credentials as the network authority
    account.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能，你正在管理的机器来自另一个域或处于工作组中，且你没有将所需的凭据作为网络权限账户添加。
- en: '![Issue 04: CredentialsFailed](img/image_09_010.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![问题 04：CredentialsFailed](img/image_09_010.jpg)'
- en: 'VCM agent communication issue: **CredentialsFailed**'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 代理通信问题：**CredentialsFailed**
- en: How to do it...
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Have a look at the *Patching machines in multi-domain environments and workgroups*
    recipe in [Chapter 4](ch04.html "Chapter 4. Windows Patching"), *Windows Patching*,
    and the *Adding a network authority account to manage machines in multiple domains *recipe
    in  [Chapter 2](ch02.html "Chapter 2. Configuring VCM to Manage Your Infrastructure"), *Configuring 
    VCM to Manage Your Infrastructur*e, then add the appropriate network authority
    account for the managed machine and try collection again.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 [第 4 章](ch04.html "第 4 章. Windows 补丁管理")中*在多域环境和工作组中修补机器*的配方、*Windows 补丁管理*，以及
    [第 2 章](ch02.html "第 2 章. 配置 VCM 管理你的基础设施")中的*添加网络权限账户以管理多个域中的机器*的配方，*配置 VCM 来管理你的基础设施*，然后为被管理的机器添加适当的网络权限账户，再尝试重新收集。
- en: How it works
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作
- en: 'We discussed multiple issues here: VCM must communicate with the agents if
    we want to manage them. VCM agent communication is based on the certificate on
    the server; if that is not as expected, then the server won''t communicate, and
    we need to replace that by reinstalling the agent with the correct certificate.'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里讨论了多个问题：如果我们想要管理代理，VCM 必须与代理进行通信。VCM 与代理的通信基于服务器上的证书；如果证书不符合预期，则服务器无法通信，我们需要通过重新安装代理并使用正确的证书来替换它。
- en: We need to make sure that we can resolve the hostname of the managed machine
    and connect on port 26542, so open firewall ports in between.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要确保可以解析被管理机器的主机名并连接到 26542 端口，因此需要开放中间的防火墙端口。
- en: Troubleshooting agent upgrade issues
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除代理升级问题
- en: After upgrading VCM to version 5.8.1, you might face some issues while upgrading
    the agent to the latest version. The upgrade fails, but if you choose **Install **
    **with Remove Current version** from the VCM console, then the agent gets installed/upgraded
    to the latest version.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在将 VCM 升级到版本 5.8.1 后，你可能在将代理升级到最新版本时遇到一些问题。升级失败，但如果你从 VCM 控制台选择**安装并移除当前版本**，代理就会安装/升级到最新版本。
- en: Note
  id: totrans-181
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that this issue has been resolved in the latest version of VCM at the time
    of writing this book, that is, VCM 5.8.2\. This is applicable only if you are
    upgrading to VCM 5.8.1.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在撰写本书时，这个问题已经在 VCM 的最新版本（VCM 5.8.2）中得到解决。仅在你升级到 VCM 5.8.1 时适用。
- en: Getting ready
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: When you select a machine on the VCM console, choose the Upgrade option, and
    run the job, it should fail while creating the service on the managed machines
    and throw an error as per the following code, which is present in `C:\Windows\CMAgent`.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 当您在VCM控制台选择一台机器，选择升级选项并运行任务时，在为托管机器创建服务时应该会失败，并根据以下代码抛出错误，该代码位于`C:\Windows\CMAgent`。
- en: '[PRE5]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: How to do it...
  id: totrans-186
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: In the 5.8.1 release, VMware promoted the HTTP listener module, which stops
    the listener service before upgrading while the Collector is waiting for it. The
    Collector contacts the agent for the upgrade status when the listener is being
    upgraded. As a result, the collector receives a ping failed response, and it signals
    the collector to FAIL the upgrade job.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在5.8.1版本中，VMware推行了HTTP监听器模块，它在升级前会停止监听器服务，同时采集器会等待它。在监听器升级时，采集器会联系代理以获取升级状态。因此，采集器会收到ping失败的响应，并将信号发送给采集器以使升级任务失败。
- en: 'The following setting allows the collector to fall back to DCOM when the HTTP
    connection fails:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 以下设置允许在HTTP连接失败时，采集器回退到DCOM：
- en: 'Run the following query in the SQL management server while selecting VCM as
    the database:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在选择VCM作为数据库时，在SQL管理服务器中运行以下查询：
- en: '[PRE6]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Also, correct the module filename of `ECMSocketListenerService` using this
    query:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同时，使用此查询修正`ECMSocketListenerService`模块的文件名：
- en: '[PRE7]'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Restart the SSRS and VCM collector service.
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启SSRS和VCM采集器服务。
- en: After that, you can upgrade the agent from the console.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，您可以从控制台升级代理。
- en: Troubleshooting SCR download issues
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排查SCR下载问题
- en: As you know, SCR is a tool that is used to synchronize patches for Linux/Unix
    operating systems from vendor sites to local repositories. Sometimes, the synchronization
    fails and can't download content from vendor sites.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您所知道的，SCR是一个工具，用于将Linux/Unix操作系统的补丁从供应商网站同步到本地仓库。有时，同步失败，无法从供应商网站下载内容。
- en: Getting ready
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: 'We are able to log in to the RedHat portal with the same account, but the patch
    download fails with an error. When we try to synchronize patches with vendors
    (in this case, RedHat) from SCR, it throws an error, as shown in the following
    code:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 我们能够使用相同的账户登录RedHat门户，但补丁下载失败并出现错误。当我们尝试从SCR与供应商（此处为RedHat）同步补丁时，抛出如下错误，代码如下：
- en: '[PRE8]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: As it indicates an issue with login, the first suspect is, as always, the account
    used to synchronize the repository with RHN. We can log in with the same account
    on RHN, and if we try changing to another account, the problem still persists.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这表示登录问题，首先怀疑的，和往常一样，是用于与RHN同步仓库的账户。我们可以用相同的账户登录RHN，并且如果更换为其他账户，问题依然存在。
- en: How to do it...
  id: totrans-201
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The resolution for this is as follows:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方法如下：
- en: Resynchronize the SCR Tool with the RedHat repository.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新同步SCR工具与RedHat仓库。
- en: 'Select the SCR Tool output folder and delete all of the `SystemId*.xml` files:'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择SCR工具输出文件夹并删除所有`SystemId*.xml`文件：
- en: '[PRE9]'
  id: totrans-205
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Take a backup of the files by running the following command for each file:'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对每个文件运行以下命令备份文件：
- en: '[PRE10]'
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The path to the `unix` folder is located in the `properties` file and is defined
    using the `folder=value` parameter.
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`unix`文件夹的路径位于`properties`文件中，并通过`folder=value`参数定义。'
- en: For example, `folder=/PatchRepo/Repos`.
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 例如，`folder=/PatchRepo/Repos`。
- en: 'Run the replication process manually or allow it to run on schedule:'
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 手动运行复制过程或允许其按计划运行：
- en: '[PRE11]'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The XML files will be created at the earlier location (`/PatchRepo/Repos`)
    and the synchronization will also start:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: XML文件将在之前的位置（`/PatchRepo/Repos`）创建，并且同步将开始：
- en: '[PRE12]'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: How it works
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的
- en: The real problem was that the source machine information was changed or deleted
    on the **Red Hat Network** (**RHN**).
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 真正的问题是源机器信息在**Red Hat Network**（**RHN**）上被更改或删除。
- en: When we delete the XML files and restart the synchronization, the machine information
    is updated again and we are allowed to download patches from RHN.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们删除XML文件并重新启动同步时，机器信息会再次更新，并且我们可以从RHN下载补丁。
- en: Troubleshooting VCM console login failure
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排查VCM控制台登录失败问题
- en: 'You are trying to log in to VCM and it throws an error: **Your ID is disabled**.'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 您尝试登录VCM时，系统抛出错误：**您的ID已禁用**。
- en: Getting ready
  id: totrans-219
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: You will need access to SQL server to resolve the issue.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 您将需要访问SQL服务器来解决此问题。
- en: '![Getting ready](img/image_09_011.jpg)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![准备中](img/image_09_011.jpg)'
- en: 'Consider this: you do not have anyone who can help you enable the ID or, even
    worse, you were setting up the VCM and still haven''t added anyone, so yours is
    the only account that can log in and make the necessary settings.'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 请考虑以下情况：你没有任何人可以帮助你启用该 ID，或者更糟的是，你正在设置 VCM，却还没有添加任何人，因此你是唯一可以登录并进行必要设置的帐户。
- en: No worries; we have a solution.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 不用担心，我们有解决方案。
- en: You will need SQL Managemnt Studio and access to your SQL server that holds
    the VCM DB.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要 SQL Management Studio 和对存放 VCM 数据库的 SQL 服务器的访问权限。
- en: How to do it...
  id: totrans-225
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Follow these steps to unlock the user:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤解锁用户：
- en: Log in to the VCM SQL server and launch SQL Management Studio.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 VCM SQL 服务器并启动 SQL Management Studio。
- en: 'Select VCM as the database and run the first query:'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 选择 VCM 作为数据库并运行第一个查询：
- en: '[PRE13]'
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This will show all the users with their login IDs.
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将显示所有用户及其登录 ID。
- en: 'Note the login ID for the user you were trying and run the following query:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请记下你尝试的用户的登录 ID，并运行以下查询：
- en: '[PRE14]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '`X` is the login ID of the user you noted earlier.'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`X` 是你之前记录的用户登录 ID。'
- en: The login is now enabled. Try logging in to the VCM console, and if you were
    the only administrator, start adding others.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 现在已经启用登录。尝试登录到 VCM 控制台，如果你是唯一的管理员，开始添加其他管理员。
- en: How it works
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的
- en: VCM stores all the information about everything it does in the SQL database.
    In this case, we found that the account we were trying to log in to was locked
    and needed a reset.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: VCM 将它所执行的所有操作信息存储在 SQL 数据库中。在此案例中，我们发现我们尝试登录的帐户被锁定，需要重置。
- en: After running the first SQL query, we checked the status of the account in the
    database, and as it was locked (that is, `login_active = 0`), we ran another query
    and enabled the account, that is, `login_active = 1`.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 运行第一个 SQL 查询后，我们检查了数据库中帐户的状态，发现它被锁定（即 `login_active = 0`），于是我们运行了另一个查询并启用了该帐户（即
    `login_active = 1`）。
- en: After that, we can log in to the VCM console.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们可以登录到 VCM 控制台。
- en: It is recommended to have an AD group added to the VCM for administration purposes
    as described in the *Managing users* recipe in [Chapter 7](ch07.html "Chapter 7. Maintenance
    of VCM"), *Maintenance of  VCM*.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 建议将一个 AD 组添加到 VCM 中以便进行管理，具体内容请参考[第 7 章](ch07.html "第 7 章：VCM 维护")中的*用户管理*部分，*VCM
    维护*。
- en: Troubleshooting vCenter and vCloud data collection issues
  id: totrans-240
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排查 vCenter 和 vCloud 数据采集问题
- en: 'The issue: when trying to collect data from vCenter and vCloud Director, the
    operation fails.'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 问题：尝试从 vCenter 和 vCloud Director 收集数据时，操作失败。
- en: Getting ready
  id: totrans-242
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 正在准备中
- en: 'You should have the following problem: when you try to collect data from either
    vCenter or vCloud Director, it either fails or you are not able to see any details
    in the VCM console, under **Console **| **Virtual Environments**.'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能遇到的问题是：当你尝试从 vCenter 或 vCloud Director 收集数据时，它要么失败，要么你无法在 VCM 控制台的**控制台 |
    虚拟环境**下看到任何详细信息。
- en: How to do it...
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: There could be few reasons for this.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 可能有几个原因导致此问题。
- en: 'The details of the error or failure can be seen with the **EcmDebugEventViewer**
    tool or in **Job manager | History**; based on the error codes, you can try any
    or all of the following solutions:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用 **EcmDebugEventViewer** 工具或在 **作业管理器 | 历史记录** 中查看错误或失败的详细信息；根据错误代码，你可以尝试以下任何或所有解决方案：
- en: The credentials set while configuring vCenter and/or vCloud may not be right;
    try changing them.
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 vCenter 和/或 vCloud 时设置的凭证可能不正确，请尝试更改它们。
- en: The certificate thumbprint set while configuring vCenter and/or vCloud may not
    be correct.
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 vCenter 和/或 vCloud 时设置的证书指纹可能不正确。
- en: If this is the case, then under **Job manager | History**, VCM will show the
    configured thumbprint and expected thumbprint; you can copy the expected thumbprint.
    Make sure it's correct, and then, change the wrong certificate thumbprint.
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果是这种情况，那么在**作业管理器 | 历史记录**中，VCM 会显示配置的指纹和预期的指纹；你可以复制预期的指纹。确保它是正确的，然后更改错误的证书指纹。
- en: As you know, we have filter sets, and most of the time, we choose the default
    filter set for performing collection. Validate the default filter set and see
    whether it has all the vCenter and/or vCloud-related filters present; if not,
    add them and perform a collection.
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如你所知，我们有过滤器集，大多数情况下，我们选择默认的过滤器集来执行数据采集。验证默认的过滤器集是否包含所有 vCenter 和/或 vCloud 相关的过滤器；如果没有，添加它们并进行数据采集。
- en: The setting is available under **Administration**|**Collection Filters**| **Filter
    Sets**. Select **Default Filter**, click on **Edit**, and add any missing vCenter
    and/or vCloud filters, as shown in the following screenshot.
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 设置位于**管理**|**收集过滤器**|**过滤器集**下。选择**默认过滤器**，点击**编辑**，并添加任何缺失的vCenter和/或vCloud过滤器，如下图所示。
- en: 'You can define a filter to limit the filters with criteria like in the screenshot:'
  id: totrans-252
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以定义一个过滤器，使用类似于截图中的条件来限制过滤器：
- en: '![How to do it...](img/image_09_012.jpg)'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_09_012.jpg)'
- en: This will limit the filters to only vCenter, vCloud, and vShield. Make sure
    these are part of the default filter set; if not, then use the down arrow to add
    all of them to the default filter, and click on **Next**. Complete the wizard
    and then perform a collection for vCenter, vCloud, and/or vShield. It will work.
  id: totrans-254
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将限制过滤器仅应用于vCenter、vCloud和vShield。确保这些已经是默认过滤器集的一部分；如果没有，使用下拉箭头将它们添加到默认过滤器中，然后点击**下一步**。完成向导后，执行vCenter、vCloud和/或vShield的收集操作。它会生效。
- en: '![How to do it...](img/image_09_013.jpg)'
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/image_09_013.jpg)'
- en: Modifying the default filter set
  id: totrans-256
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 修改默认过滤器集
- en: How it works
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理
- en: VCM uses filter sets, and those include filters to collect data from various
    managed objects. Filters define what data needs to be collected, such as operating
    system name, some registry value, or file permissions. There are thousands of
    filters available, and not all filters are used in one filter set. We have a default
    filter set, which includes filters for all the managed machine types, such as
    vCenter, vCloud Director, Windows, and Linux. Sometimes, certain required filters
    go missing from the filter set. We then need to add them back so that the next
    time we use them to collect details, VCM will know what data needs to be collected.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: VCM使用过滤器集，这些过滤器集包含用于从各种托管对象收集数据的过滤器。过滤器定义了需要收集的数据，例如操作系统名称、某些注册表值或文件权限。有成千上万的过滤器可用，并非所有过滤器都在同一个过滤器集中使用。我们有一个默认的过滤器集，其中包括适用于所有托管机器类型的过滤器，如vCenter、vCloud
    Director、Windows和Linux。有时，某些必需的过滤器会从过滤器集中丢失。我们需要将它们添加回来，以便下次使用时，VCM知道需要收集哪些数据。
- en: In this troubleshooting recipe, we did the same thing and added missing filters
    to the default filter set.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个故障排除步骤中，我们做了同样的事情，并将缺失的过滤器添加到默认过滤器集中。
- en: 'Troubleshooting the Recommended Action: Investigate Issue Linux server patch
    error'
  id: totrans-260
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除：推荐操作“调查问题”导致的Linux服务器补丁错误
- en: 'When trying to patch a Linux server, you might get a message saying **Recommended
    Action: Investigate Issue** and hence are not able to patch the server.'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 在尝试为Linux服务器安装补丁时，您可能会收到一条消息，显示**建议操作：调查问题**，因此无法为服务器安装补丁。
- en: Getting ready
  id: totrans-262
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'The error will look like the following screenshot. The recommended action is
    **Investigate Issue**:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 错误将类似于以下截图。推荐的操作是**调查问题**：
- en: '![Getting ready](img/B05400_09_15.jpg)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![准备就绪](img/B05400_09_15.jpg)'
- en: How to do it...
  id: totrans-265
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To resolve the issue, follow these steps on the VCM database:'
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要解决此问题，请在VCM数据库上按照以下步骤操作：
- en: 'Run this SQL query to know the `machine_id` for which it shows **Investigate
    Issue**:'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行此SQL查询以了解显示**调查问题**的`machine_id`：
- en: '[PRE15]'
  id: totrans-268
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The machine name is the name of the service creating issues.
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 机器名称是导致问题的服务的名称。
- en: 'Update the timestamp for that `machine_id` value using the following query:'
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下查询更新`machine_id`值的时间戳：
- en: '[PRE16]'
  id: totrans-271
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Carry out another assessment on that machine, and it will tell you that patches
    are required.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对该机器进行另一次评估，它会告诉您需要安装补丁。
- en: Troubleshooting not being able to see any jobs on the console
  id: totrans-273
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排除无法在控制台中查看任何任务的故障排除
- en: 'The issue: VCM is not running or showing any jobs. When jobs are started manually,
    they are not being executed, rendering VCM close to useless.'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 问题：VCM没有运行或显示任何任务。当手动启动任务时，它们无法执行，这使得VCM几乎变得毫无用处。
- en: Getting ready
  id: totrans-275
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: When we run any job such as data collection, patching, or compliance checks,
    they might not start and be absent from the **Jobs** window. Because of this,
    there is no update in the VCM database, you can't patch a managed machine, and
    compliance checks can't be executed.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们运行任何任务，如数据收集、补丁安装或合规性检查时，它们可能无法启动，并且在**任务**窗口中无法显示。因此，VCM数据库没有更新，您无法为托管机器安装补丁，也无法执行合规性检查。
- en: We need access to the SQL server hosting the VCM database.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要访问托管VCM数据库的SQL服务器。
- en: How to do it...
  id: totrans-278
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Here is the resolution. To determine whether the SQL Server Service Broker
    is enabled, run the following script in SQL Server using SQL Server Management
    Studio:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 这是解决方案。要确定是否启用了 SQL Server 服务代理，请在 SQL Server Management Studio 中运行以下脚本：
- en: Launch SQL Server Management Studio and create a new query, as follows.
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 SQL Server Management Studio 并创建一个新的查询，如下所示。
- en: '[PRE17]'
  id: totrans-281
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Check whether the value of `is_broker_enabled` is `0` (zero) for the VCM database,
    and re-enable the SQL Server Service Broker by running the following script in
    SQL Server:'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 VCM 数据库中 `is_broker_enabled` 的值是否为 `0`（零），并通过在 SQL Server 中运行以下脚本重新启用 SQL
    Server 服务代理：
- en: '[PRE18]'
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Here, `db-name` is the name of your VCM database. The database name is VCM by
    default.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`db-name` 是你的 VCM 数据库的名称。默认情况下，数据库名称是 VCM。
- en: How it works
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的
- en: With Service Broker, a feature in Microsoft SQL Server, internal or external
    processes can send and receive guaranteed, asynchronous messages. Messages can
    be sent to a queue in the same database as the sender, to another database in
    the same SQL Server instance, or to another SQL Server instance either on the
    same server or on a remote server. We fixed the broken broker service on the VCM
    database so that it can function again.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Microsoft SQL Server 中的服务代理功能，内部或外部进程可以发送和接收保证的异步消息。消息可以发送到与发送者相同数据库中的队列、同一
    SQL Server 实例中的另一个数据库，或另一个 SQL Server 实例，无论是在同一服务器上还是远程服务器上。我们修复了 VCM 数据库中损坏的代理服务，使其能够重新运行。
- en: Troubleshooting not being able to see the Monthly option on the Schedule Job
    page
  id: totrans-287
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 无法在调度作业页面看到月度选项的故障排除
- en: Sometimes, it may happen that when we are trying to schedule something in VCM,
    when we are about to complete the wizard, on the schedule page, the **Monthly**
    option is disabled (grayed out), and we can't set a monthly schedule.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，当我们尝试在 VCM 中安排任务时，快要完成向导时，在调度页面上，**月度**选项会被禁用（灰色显示），我们无法设置月度调度。
- en: Getting ready
  id: totrans-289
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: The **Monthly** scheduling option is disabled, as shown here**:**
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 如下所示，**月度**调度选项被禁用：
- en: '![Getting ready](img/image_09_015.jpg)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
  zh: '![准备中](img/image_09_015.jpg)'
- en: How to do it...
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The monthly scheduling option is **disabled** if the time zone setting of the
    VCM user launching the console is different from the VCM database's time zone
    setting.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 如果启动控制台的 VCM 用户的时区设置与 VCM 数据库的时区设置不同，则**月度**调度选项将被禁用。
- en: Make sure the time zone of the machine that is used to connect to the VCM server
    is the same as the VCM database server's.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 确保用于连接到 VCM 服务器的机器的时区与 VCM 数据库服务器的时区相同。
