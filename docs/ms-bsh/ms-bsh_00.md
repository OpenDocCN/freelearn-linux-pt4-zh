# 前言

Bash 是一个常见的日常任务工具，几乎每个 Linux 用户都依赖它。无论你想做什么，都需要登录到 shell，大多数时候，使用的就是 Bash。本书旨在解释如何使用这个工具，充分发挥它的作用，无论是编写插件、网络客户端，还是简单地解释为什么双点表示它的意思，我们都将比平时更深入探讨，帮助你完全掌握 shell。从基础开始，但换个角度看待，我们将一步一步向上攀升，专注于我们环境中的编程部分，探索如何防止在设置重复任务时出现问题，并确保一切顺利运行。做到一次，花点时间，调试、改进，然后“一劳永逸”；正如老一套 Linux 格言所说，“如果它能工作，为什么要改变？”既然我们谈到了格言，那么我们还可以遵循其他两个基石：“KISS：保持简单，傻瓜” 和 “只做一件事，但做得好。” 这三个原则是 Linux 的核心：做某件事，而不是所有事，做到简单、可靠，并花时间让它运行得好，这样你就不需要频繁修改它。当某件事专注且简单时，它就容易理解，易于维护，且安全。这就是我们的理念，因为 Bash 不仅是一个工具，还是我们花费大量时间的环境，所以理解它、充分利用它、保持一切干净整洁应该是我们的日常目标。

# 本书内容简介

第一章，*让我们开始编程*，是我们首次接触 Bash 的魔力。我们将使用基本的 shell 编程语法编写简单代码，预见到更高级脚本带来的所有好处。

第二章，*操作符*，是在这一章中我们执行一些简单的操作，例如检查某个数值是否大于、等于或小于另一个数值，以及如何加、减、处理数字。这是对脚本中处理事件时施加条件的第一步。

第三章，*测试*，解释了检查某些内容是否符合边界和特定条件是否满足的基本原则，这对于让我们的脚本能够根据系统或其他程序的实时指示做出反应并决定该做什么至关重要。

第四章，*引用与转义*，告诉你 shell 有自己的保留字，这些字在不完全了解它们的作用时不能使用。此外，变量保存的值必须在操作过程中保持不变。在这一章中，我们将学会如何小心地处理我们要编写的内容。

第五章，*菜单、数组与函数*，探讨了如何让脚本与用户进行交互，例如，给用户机会回答一些问题并处理突出显示的选项。这涉及到为程序本身创建命令行界面的能力，以及如何存储数据，使其容易提取。这正是数组的用途所在*。*

第六章，*迭代*，解释了迭代在遍历数据、根据某些条件提取和处理数据时的重要性。例如，当数据存在时，或者我们使用某些值作为计数器时。我们将学习如何使用 while 和 for 循环。

第七章，*连接到真实世界*，介绍了最著名的开源监控系统之一，Nagios，它完全依赖于插件。你可以用任何语言编写复杂的程序，对你的站点和应用程序进行所需的检查。但我使用过的一些最棘手的插件是用 Bash 编写的，除此之外没有任何其他工具。

第八章，*我们想聊一聊*，是关于 Slack 的，Slack 目前是最广泛使用的消息系统之一。为什么不编写一小段代码，通过 Slack 渠道发送我们的想法，也许可以做成一个通讯插件，使其他脚本能够通过该消息系统发送消息呢？

第九章，*子 shell、信号与作业控制*，讨论了有时单个进程不足以满足需求的情况。我们的脚本必须同时做很多事，使用一种原始的并行处理方式来达到预期的结果。那么，是时候看看我们如何在 shell 中创建子进程，如何控制作业，以及如何发送信号了。

第十章，*让我们创建一个进程聊天*，探讨了进程之间如何相互交流，互相传递数据并共享数据处理的负担。管道、重定向、进程替换和一些 netcat——这可能会打开新的场景，我们将看看如何实现。

第十一章，*作为守护进程存在*，解释了有时仅仅将脚本发送到后台是不够的。它不能长时间存活，但你可以使用一些技巧，如双重派生、setsid 和 disown 来让它变得有点狡猾，并在进程终止之前存活下来。将它做成守护进程，让它等待你的命令。

第十二章，*通过 SSH 进行远程连接*，介绍了脚本如何可以在本地运行，但它们也可以为你做更多的事。脚本可以通过安全通道远程登录，并代表你发出命令，无需你输入进一步的指令。一切都存储在一个密钥中，解锁了大量的新可能性。

第十三章，*该为定时器设定时间了*，讨论了如何完全自动化常规任务。我们必须有一种方法来根据某些条件运行脚本。最常见的基于时间，例如每小时、每天、每周或每月的重复。只需想象一个简单的日志轮换，它在特定条件下触发，最常见的是在每天的安排中。

第十四章，*安全时刻*，解释了为什么安全在工作环境中至关重要。脚本通常意味着访问远程服务器并与之交互，因此，学习一些技巧来提高服务器的安全性，将帮助你防止入侵，确保你的工作免受外界的干扰。

# 本书所需内容

本书假设读者具有较高水平的 Linux 操作系统经验，并且对 Bash shell 有一定的中级知识，同时，由于某些章节涉及 Nagios 监控和 Slack 消息传递，因此需要具备基本的网络概念。

需要一个简单的 Linux 安装，规格要求非常低，因为即使是 Nagios 插件也可以在无需实际安装监控系统的情况下进行测试。所以，这是最低的配置要求：

+   CPU：单核

+   内存：2 GB

+   硬盘空间：20 GB

本书需要以下软件：

+   Linux 操作系统：Debian 8

+   Nagios Core 3.5.1

+   OpenSSH 6.7p1

+   rssh 2.3.4

需要互联网连接以安装必要的服务包，并尝试一些示例。

# 本书适合的读者

本书面向从事复杂日常任务的高级用户。书中从基础开始，旨在作为一本参考手册，帮助读者找到便捷的解决方案和建议，使他们的脚本更加灵活和强大。

# 约定

在本书中，你将看到许多不同的文本样式，用于区分不同类型的信息。以下是这些样式的一些示例及其含义解释。

文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 用户名如下所示：“这里有趣的是，`real`的值在两个命令之间略有不同。”

一块代码区块如下所示：

```
#!/bin/bash 
set -x
echo "The total disk allocation for this system is: "
echo -e "\n" 
df -h 
echo -e "\n" 
set +x 
df -h | grep /dm-0 | awk '{print "Space left on root partition: " $4}'

```

任何命令行输入或输出如下所示：

```
gzarrelli:~$ time echo $0
/bin/bash
real 0m0.000s
user 0m0.000s
sys 0m0.000s gzarrelli:~$

```

**新术语**和**重要词汇**以粗体显示。

警告或重要说明会以框的形式显示，如下所示。

提示和技巧如下所示。

# 读者反馈

我们始终欢迎读者的反馈。告诉我们你对本书的看法——你喜欢什么或不喜欢什么。读者反馈对我们非常重要，它帮助我们开发出你真正能受益的书籍。

若要向我们提供一般反馈，只需发送电子邮件至`feedback@packtpub.com`，并在邮件主题中提及书名。

如果你在某个领域具有专业知识，并且有兴趣撰写或参与编写书籍，请参考我们的作者指南：[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在，你是一本 Packt 书籍的骄傲拥有者，我们为你提供了许多资源，帮助你充分利用这次购买。

# 下载示例代码

你可以从你的账户中下载本书的示例代码文件，网址为[`www.packtpub.com`](http://www.packtpub.com)。如果你是在其他地方购买的本书，可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)，注册后将示例文件通过电子邮件直接发送给你。

你可以按照以下步骤下载代码文件：

1.  使用你的电子邮件地址和密码登录或注册我们的网站。

1.  将鼠标指针悬停在顶部的 SUPPORT 标签上。

1.  点击代码下载和勘误。

1.  在搜索框中输入书名。

1.  选择你想下载代码文件的书籍。

1.  从下拉菜单中选择你购买此书的地方。

1.  点击代码下载。

文件下载完成后，请确保使用最新版本的工具解压或提取文件夹：

+   WinRAR / 7-Zip 适用于 Windows

+   Zipeg / iZip / UnRarX 适用于 Mac

+   7-Zip / PeaZip 适用于 Linux

本书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Mastering-Bash`](https://github.com/PacktPublishing/Mastering-Bash)。我们还提供了其他书籍和视频的代码包，您可以在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。快去看看吧！

# 下载本书的彩色图像

我们还为你提供了一个 PDF 文件，包含本书中使用的截图/图表的彩色图像。这些彩色图像将帮助你更好地理解输出结果的变化。你可以从[`www.packtpub.com/sites/default/files/downloads/MasteringBash_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/MasteringBash_ColorImages.pdf)下载此文件。

# 勘误

尽管我们已尽一切努力确保内容的准确性，但错误仍然会发生。如果您在我们的书籍中发现错误——可能是文本或代码中的错误——我们将非常感激您向我们报告。通过这样做，您可以帮助其他读者避免困扰，并帮助我们改进后续版本。如果您发现任何勘误，请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)进行报告，选择您的书籍，点击勘误提交表格链接，并填写勘误详情。一旦您的勘误经过验证，您的提交将被接受，勘误将上传到我们的网站，或添加到该书籍的勘误列表中。

要查看之前提交的勘误，请访问[`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索框中输入书名。所需信息将显示在勘误部分。

# 盗版

互联网上的版权盗版问题在所有媒体中普遍存在。我们在 Packt 公司非常重视保护我们的版权和许可证。如果您在网上发现任何形式的非法复制我们的作品，请立即提供相关地址或网站名称，以便我们采取相应的措施。

请通过`copyright@packtpub.com`联系我们，并提供涉嫌盗版材料的链接。

我们感谢您在保护我们的作者及我们为您提供有价值内容的能力方面的帮助。

# 问题

如果您对本书的任何方面有疑问，可以通过`questions@packtpub.com`联系我们，我们将尽力解决问题。
