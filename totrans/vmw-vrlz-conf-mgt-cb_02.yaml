- en: Chapter 2. Configuring VCM to Manage Your Infrastructure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  prefs: []
  type: TYPE_NORMAL
- en: Adding a vCenter Server instance
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adding a vCloud Director and vShield instance
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Collecting data from managed machines
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adding a discovery rule
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adding a network authority account to manage machines in multiple domains
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring a managing agent machine for virtual environment management
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing an agent on Windows servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing an agent on Linux servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating machine groups
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once VCM has been installed, we need to configure it to make it work for our
    environment; the default configurations need to be changed for environment-specific
    changes. To manage our infrastructure, we need to install agents on the Windows
    and Linux servers. This can be achieved in many ways, such as installing via scripts
    or, if we are using automation to deploy the machines, we could use that itself
    or push it to the servers identified by VCM.
  prefs: []
  type: TYPE_NORMAL
- en: We need to add vCenter, vCloud, and vShield server instances to VCM so that
    we can start utilizing the details available in those systems, such as machines
    and vApps deployed, which can be used to create various reports. Also, the captured
    details include the virtual machines deployed in the infrastructure, which can
    be used by VCM to deploy agents and bring them under management.
  prefs: []
  type: TYPE_NORMAL
- en: We need to create various machine groups; a machine group is basically a collection
    of machines that can be grouped into a single entity for various purposes, such
    as patching, reporting, and checking compliance.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we will start configuring VCM so that it is ready for day-to-day
    operations.
  prefs: []
  type: TYPE_NORMAL
- en: Let's begin.
  prefs: []
  type: TYPE_NORMAL
- en: Adding a vCenter Server instance
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before we start managing our virtual infrastructure, we need to add the components
    to VCM. We will start adding them in the following recipes, starting with vCenter.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will need a user with administrative access to the vCenter instance that
    we want to add to VCM as well as its **fully qualified domain name** (**FQDN**)
    or IP address.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To add the vCenter instance to VCM, log in to the VCM server UI and follow
    these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to VCM with an administrative account.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Virtual Environments**.![How to do it...](img/5400_02_pg-2.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Add Machines**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Basic** on the first page of the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the hostname (not FQDN here) for the machine name, select **Domain** from
    the dropdown which the machine belongs to, select **DNS** for **Type**, and **vCenter
    Windows** for **Machine Type**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Add**, and then click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: With these steps, we added the vCenter instance to VCM, but we still need to
    configure it so that we can collect the details.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now, select the vCenter instance we just added and click on **Configure Settings**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In this wizard, select the vCenter instance.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Provide the following information:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Managing Agent**: Your Collector server'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Port**: `443`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**User ID**: A user with administrative access to vCenter'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Password**: The password for the user; enter it twice to confirm'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ignore untrusted SSL Certificate**: **Yes**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Click on **Next** once all the details have been filled in.![How to do it...](img/image_02_002.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Note**: The user must have a vCenter Server administrative role or a read-only
    role. However, you cannot run actions with a read-only role.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click on **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There should be a green circle in front of the vCenter instance's name on the
    VCM console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We are adding vCenter to VCM so that we can collect information about all the
    ESXi hosts in the instance, all the virtual machines, and so on, and based on
    this information, we can create compliance checks for our virtual infrastructure,
    discover the virtual machines as managed machines in VCM so that we can install
    agents, and collect information about them as well.
  prefs: []
  type: TYPE_NORMAL
- en: 'VCM collects the following information from vCenter:'
  prefs: []
  type: TYPE_NORMAL
- en: vCenter Summary
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Custom Information
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Guests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Hosts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Host Profiles
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Inventory
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Networking
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Settings
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Resource Pools
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCenter Roles
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adding a vCloud Director and vShield instance
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'There are three virtual elements that can be managed by VCM: vCenter, vShield,
    and vCloud. In the previous recipe, we added vCenter. In this one, we will continue
    with **vShield** and **vCloud Director** (**vCD**).'
  prefs: []
  type: TYPE_NORMAL
- en: VMware vShield is a suite of virtual security appliances built for VMware vCenter
    Server integration. A vShield security group is a logical trust zone that you
    create and assign resources to for vShield protection.
  prefs: []
  type: TYPE_NORMAL
- en: By adding vCloud to VCM, you can use the vCloud Director properties to create
    machine groups and so on.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will need the IP address of the vShield Manager and vCloud Director instances
    and a user account with administrative privileges.
  prefs: []
  type: TYPE_NORMAL
- en: Before adding vShield, you must collect data for your vCenter instance, as described
    in the next recipe.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will split this recipe into two sections, as follows.
  prefs: []
  type: TYPE_NORMAL
- en: '*Adding a vShield instance*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Adding a vCloud Director instance*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adding a vShield instance
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This is a bit different than adding vCenter. After adding a vCenter instance
    and collecting data from it, VCM identifies the vShield VM and it makes it available
    on the VCM console for configuration, so we don''t need to perform any additional
    steps as we did for vCenter; we just need to configure it, which we will do as
    follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Virtual Environments**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the vShield device identified by VCM, and click on **Configure Settings**.![Adding
    a vShield instance](img/image_02_003.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure the vShield instance is selected in the wizard launched.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Provide information as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Managing Agent**: Your Collector server'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Port**: `443`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**User ID**: A user with administrative access to vShield'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Password**: The password for the user; enter it twice to confirm it'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ignore untrusted SSL Certificate**: **Yes**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Provide the name of the vCenter Server instance this vShield instance is responsible
    for
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Adding a vShield instance](img/image_02_004.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Note**: The user must have a vShield Manager administrative role or an unrestricted
    read-only role.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click on **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once again, you should see a green circle in front of the vShield instance you
    just configured.
  prefs: []
  type: TYPE_NORMAL
- en: If there isn't one, make sure you have provided the correct username and password.
  prefs: []
  type: TYPE_NORMAL
- en: Adding a vCloud Director instance
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Log in to VCM server and follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Virtual Environments**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Add Machines**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Basic** from the first page of the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter your hostname in **Machine Name**, select **Domain** from the dropdown
    that the machine belongs to, select **DNS** as **Type** and **vCloud Director**
    as **Machine Type**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Add**, and then click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Finish** to end the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: With these steps, we added the vCloud instance to VCM, but we still need to
    configure it so that we can collect the details.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now, select the vCloud Director instance we just added and click on **Configure
    Settings**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In this wizard, select the vCloud Director machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Provide information as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Managing Agent**: Your Collector server'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Port**: `443`'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**User ID**: A user with administrative access to vCloud Director'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Local user in the format `user@System`
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Password**: The password for the user; enter it again to confirm it'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Ignore untrusted SSL Certificate**: **Yes**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Adding a vCloud Director instance](img/image_02_005.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Click on **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There should be a green circle in front of the vCloud Director instance's name
    on the VCM console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We make information available in the vShield instance, that is, security groups
    and its members exposed to VCM. The details are stored in the VCM database as
    well and can be used when required.
  prefs: []
  type: TYPE_NORMAL
- en: 'After adding and performing a collection, we have the following information
    from the vCloud Director database in the VCM console:'
  prefs: []
  type: TYPE_NORMAL
- en: vCloud Director Organizations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCloud Director virtual machines and vApps
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCloud Director organization catalogs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCloud Director Virtual datacenters (vDCs) and networks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCloud Director Organizations Users
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCloud Director Organizations Groups
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: vCloud Director Organizations Settings
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This information can be used to create machine groups based on vCloud organizations
    in order to manage them accordingly.
  prefs: []
  type: TYPE_NORMAL
- en: Collecting data from managed machines
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once we are done adding and configuring virtual environments, we can start collecting
    data, which can be further used to check compliance, create necessary machine
    groups, export reports, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: We need to collect data from virtual environments as well as from all the machines
    that we plan to manage, that is, Windows or Linux servers.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: All the servers we want to manage should be added to the VCM console, either
    by following earlier recipes for virtual infrastructures or by installing agents
    by following the recipes in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We will split this recipe into two sections:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Collecting data from virtual infrastructures*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Collecting data from managed machines*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Collecting data from virtual infrastructures
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To collect all data off a vCenter, vShield Manager, or vCD instance, follow
    these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to VCM and follow the steps to collect virtual infrastructure data.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can be anywhere in the VCM console; make sure the machine group is **All
    Machines** (to understand more about machine groups, have a look at the *Creating
    machine groups* recipe), and click on **Collect** in the top-left corner.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This will launch a wizard; select **Machine Data** under **Collection Type**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the machines you want to collect data from, in this case, any or all
    of vCenter, vShield, and vCloud servers. Select them and make sure they are on
    the right-hand side, and then click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Select Data Types** to collect from these machines.![Collecting data
    from virtual infrastructures](img/image_02_006.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Data Types**, tick each checkbox underneath **Virtualization**:![Collecting
    data from virtual infrastructures](img/image_02_007.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure there are no conflicts, and click on **Finish**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Jobs** in the left-hand corner of the VCM console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure the job to collect the data has completed successfully.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Collecting data from managed machines
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'In this subsection, we will collect data from managed machines, such as Windows
    and Linux servers. Follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to VCM and follow the steps to collect virtual infrastructure data.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can be anywhere in the VCM console; make sure the machine group is **All
    Machines** (to understand more about machine groups, have a look at the *Creating
    machine groups* recipe) and click on **Collect** in the top-left corner.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This will launch a wizard; select **Machine Data** under **Collection Type**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next page, select the machine/machines whose data you want to collect.
    The machines must be on the right-hand side.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You have two options for deciding how data will be collected: based on the
    data type or based on the collection filter set.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Note**: If you select data type then you are presented with options to select
    from various entities of the OS such as accounts, account policies, disk space,
    device drives, and so on that are relevant to the OS of the machine we selected.
    If you select filter sets, VCM has precreated sets of filters, which can be used
    to collect data from the managed machine. The filter sets can be created manually,
    while installing VCM, or when you import any compliance template.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Collecting data from managed machines](img/image_02_008.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Depending upon what you select, the next page will differ.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For the **Data Types** window, select individual data types or select all of
    them.![Collecting data from managed machines](img/image_02_009.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For the **Filter Sets** window, select the appropriate filter set to collect
    the data.![Collecting data from managed machines](img/image_02_010.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure there are no conflicts, and close the wizard. It will start a collection
    job, and VCM will go to the specified machines and collect details either according
    to data types or selected filter sets.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the previous recipes, we added vCenter, vCD, and vShield Manager; now, we
    need the data to import into all those elements. By performing a collection, we
    are adding the details available on those systems to VCM so that we can have a
    single interface where we can see all the details.
  prefs: []
  type: TYPE_NORMAL
- en: The details fetched from those systems have been mentioned in the earlier recipes.
    When VCM performs a collection operation, it goes into each application's database,
    pulls all the relevant information, and then places it in its own database. For
    example, when we perform a vCenter collection, it collects details about all the
    VMs, ESXi hosts, their versions, snapshot details for VMs, VM configuration, and
    so on. All the data is presented in the VCM console under **Console** | **Virtual
    Environments**.
  prefs: []
  type: TYPE_NORMAL
- en: In case of vCD, VCM fetches information about the vApps, VMs, catalogs, local
    users, groups, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: This information can then be exported via reports, used for compliance checks.
    This can also be used in creating dynamic filters for creating machine groups.
  prefs: []
  type: TYPE_NORMAL
- en: Details captured from managed machines such as Windows and Linux servers will
    be used in analyzing their current compliance and patch status.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Have a look at the following article by VMware if you want details about filter
    sets:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminSettingsCollFltr.htm](https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminSettingsCollFltr.htm)'
  prefs: []
  type: TYPE_NORMAL
- en: Adding a discovery rule
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: VCM must discover machines in your environment before you can collect data from
    them. You can create a **discovery rule** to discover all machines, or you can
    apply a filter to limit the machines that VCM discovers. Discovery rules are used
    to discover managed machines automatically.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must have configured and collected data from vCenter and vCloud to add a
    database discovery rule.
  prefs: []
  type: TYPE_NORMAL
- en: You must license the virtual environments and Windows, Unix, and Linux machines
    to use for data collection. When you license these virtual or physical machines,
    they appear in the **Licensed Machines** list.
  prefs: []
  type: TYPE_NORMAL
- en: VCM can discover machines from Active Directory, browse lists, domain controllers,
    databases, or by IP address.
  prefs: []
  type: TYPE_NORMAL
- en: We will perform database discovery in this recipe; you can check remaining options
    in your lab.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We will configure VCM to discover vCenter VMs by following these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to VCM as an administrative user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Administrator** | **Machines Manager** | **Discovery Rule**; click on
    the green plus button to add a new discovery rule.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This will launch a wizard; provide a name and description.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **By DB Discovery:** checkbox.![How to do it...](img/image_02_011.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **vCenter Guest Systems** under **Discovery Query**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The other two options are using vCloud Director or directly from the host.![How
    to do it...](img/image_02_012.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On the next page, select/fill in options according to this table:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '| **Option** | **Description** |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Machine Name Format** | The format for VCM to display guest machines. You
    can select the **NetBIOS**, **DNS**, or **VM/vCenter** name format. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Domain Name** | The domain under which to add the new machine. This domain
    is the same as the **Domain Name** property when you add machines using manual
    discovery. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Domain Type** | Select one out of **Active Directory**, **DNS**, or **NetBIOS**
    domain types. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Protocol** | Select **DCOM** or **HTTP**. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **HTTP Port (default used if blank)** | This uses the HTTP listener on the
    target machine. The listener is configured to listen on the designated port. Port
    `26542` is the default setting. Accepted port values range from `1` to `65535`.
    Other applications must not use this port. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Use a proxy server** | **No** |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Connection String** | This is the address of the virtual machine to contact.
    This address can differ from the address that resolves by machine name from DNS
    or other name-resolution systems. Use this address when VCM must contact a vApp
    virtual machine through a Network Address Translation (**NAT**) address. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **ESX Host Name Filter** | This filters the query to ESX host machine names
    in the virtual environment based on the information you type. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **VM Guest Name Filter** | This filters the query to guest VM names on the
    ESX host machine in the virtual environment based on the information you type.
    |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Guest DNS Name Filter** | This filters the query to domain name servers
    based on the information you type. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Guest OS Name Filter** | This filters the query to the guest operating
    systems in the virtual environment based on the information you type. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: '| **Power State** | This filters the query to the state of the guest virtual
    machine in the virtual environment based on the information you type. |'
  prefs:
  - PREF_IND
  type: TYPE_TB
- en: 'After you make appropriate selections as described in the table, your screen
    should look like this:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_02_013.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Select **Yes** to start the discovery once the rule creation is over, and if
    you want, you can select **License** and install **Agent** on **Discovered Machines**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As this is a query run against the VCM database, we must perform a collection
    against at least one vCenter Server before we run this discovery rule.
  prefs: []
  type: TYPE_NORMAL
- en: VCM adds the machines either to the available machines in the machine manager
    if you choose not to license the machine; and if you choose to license it as part
    of the discovery rule, then they go to either licensed Windows or Unix machines.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This is the table describing all the available methods taken from the VCM help
    document on [http://www.vmware.com/](http://www.vmware.com/):'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Sr. No.** | **Method** | **Description** |'
  prefs: []
  type: TYPE_TB
- en: '| **1** | **By Active Directory** | This discovers all the machines that have
    an account on the selected AD domain. The discovery process identifies machines
    based on the current domain controller data. |'
  prefs: []
  type: TYPE_TB
- en: '| **2** | **By Browse List** | This discovers all the machines that have the
    **Computer Browser** service turned on. When the rule discovers machines through
    the browse list, VCM returns the NetBIOS domain name for each machine. |'
  prefs: []
  type: TYPE_TB
- en: '| **3** | **By Domain Controller** | This discovers all the machines that have
    an account on the selected domain. When the domain controller performs a periodic
    update, existing machines might not appear, while deleted machines might. |'
  prefs: []
  type: TYPE_TB
- en: '| **4** | **By IP Address** | This discovers all the machines in your network
    that exist in specific IP address ranges. Discovered machines appear in the list
    of available machines. |'
  prefs: []
  type: TYPE_TB
- en: '| **5** | **By DB Discovery** | This discovers machines based on the SQL query
    used for the discovery rule. This discovery type uses data that VCM has already
    collected from other sources as the basis for finding new systems to manage. You
    can discover vCD-managed virtual machines, virtual machine guests, and virtual
    machine hosts. |'
  prefs: []
  type: TYPE_TB
- en: 'Refer here for more:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminMachMngrDiscAECWiz.htm](https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminMachMngrDiscAECWiz.htm)'
  prefs: []
  type: TYPE_NORMAL
- en: Adding a network authority account to manage machines in multiple domains
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For medium to large infrastructures, there are always multiple Active Directory
    domains available. We can use VCM to manage servers in multiple domains. This
    recipe explains what you need to do for that.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There should be a proper name resolution. If there is a firewall in between,
    then the ports stated in the first chapter must be open.
  prefs: []
  type: TYPE_NORMAL
- en: We need a **network authority account** per domain in order to manage the machines
    in that domain and VCM functions such as collecting data, patching, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We need to add the domains and network authority account and finally associate
    them with one another.
  prefs: []
  type: TYPE_NORMAL
- en: Go to **Administration** | **Settings** | **Network Authority**
  prefs: []
  type: TYPE_NORMAL
- en: 'We have three options:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Available Domains** (identified while performing the installation); we can
    add new ones if required'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Available Accounts** (we assigned one NAA while performing VCM deployment)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Assigned Accounts**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Available Domains
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Domains are identified in one of the steps when we perform the VCM server installation;
    now, we can add extra domains. Click on **Add** under **Available Domains**, and
    provide the domain **Name** and **Type**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Available Domains](img/image_02_014.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Available Accounts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Under **Available Accounts**, we can see which network authority accounts are
    available and then add any extra accounts or remove unwanted ones.
  prefs: []
  type: TYPE_NORMAL
- en: '![Available Accounts](img/image_02_015.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Assigned Accounts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This is the place where we associate available accounts with available domains.
  prefs: []
  type: TYPE_NORMAL
- en: Go to **Assigned Accounts** | **By Domain** | **Active Directory**, and then
    click on **Edit Assigned Accounts** and associate the available accounts with
    this domain.
  prefs: []
  type: TYPE_NORMAL
- en: '![Assigned Accounts](img/image_02_016.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Basically, by following this process, we assigned an account that has local
    admin privileges or the rights explained in the first chapter to all the machines
    in the respective domain that will be managed by VCM.
  prefs: []
  type: TYPE_NORMAL
- en: We can assign as many accounts as required. When a VCM function is started,
    assigned accounts will be tried in the specified order. When something starts
    a subsequent time, the last successfully used account will be used first. Accounts
    are listed in the order in which they are assigned, from top to bottom.
  prefs: []
  type: TYPE_NORMAL
- en: 'If a machine is in multiple lists (such as a domain and a machine group), the
    authority account that will be used to contact it will be in the following order:'
  prefs: []
  type: TYPE_NORMAL
- en: The last account that worked
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The accounts assigned to the domain
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The accounts assigned any machine group (including the default **All Machines**
    group) to which the machine belongs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We need to do this for Windows only, as in the case of Linux, we need to accept
    the certificate in the VCM console. Unless we accept the certificate, we will
    not be able to patch the Linux machine from VCM. To accept the certificate, on
    the VCM console, go to **Administration** | **Certificates**, select the machine,
    and click on **Change Trust Status**. Follow the wizard, and you will see a handshake
    symbol in front of the machine. This will allow you to patch the Linux machine
    from the VCM console. The steps to perform this action are a part of the next
    recipe.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring a managing agent machine for virtual environment management
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Managing agents are systems that manage the communication between the collector
    and the virtual environment we manage via VCM, that is, vCenter Server, vCD, and
    vShield Manager. In this recipe, we will assign a system the role of a management
    agent.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We need to have the version 5.5 or later agent installed on the machine and
    data collected from it, which will be designated as the managing agent. Refer
    to the next recipe.
  prefs: []
  type: TYPE_NORMAL
- en: The managing agent machines must have the version 5.5 or later agent installed.
  prefs: []
  type: TYPE_NORMAL
- en: We can designate any server that can communicate with VCM as well as vCD, vShield,
    and vCenter Server as a managing agent.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Log in to VCM and follow these steps to designate a managing agent and then
    change it to a managed virtual environment:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Administration** | **Certificates**.![How to do it...](img/image_02_017.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the machine that you want to designate as a managing agent.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Change Trust Status**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check to trust or uncheck to untrust the selected machines box, click on **Next**,
    and click on **Finish** on the next page to complete the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the machine again and click on **Managing Agent** in the top menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Enable**, click on **Next**, and then click on **Finish** on the next
    page to complete the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Note**: The choice of managing agent solely depends on the size of the infrastructure
    you manage; you can use your collector as a managing agent, or you can use another
    Windows machine. If your individual vCenter instance manages between 1 to 30 hosts
    and a maximum of 1,000 guests, then you can use the collector as your managing
    agent. Otherwise, designate a dedicated managing agent.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_02_018.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: The selected server will become the managing agent now.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the managing agent has been designated, we can change it for the managed
    virtual environment.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Virtual Environments**. Select the machine whose managing agent you want to change,
    and click on **Configure Settings**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the machine added if required.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the top, there is a dropdown to select either of the available managing agents.
    Change to a new one and click on **Next** (not visible in the screenshot), and
    click on **Finish** on next page to close the wizard.![How to do it...](img/image_02_019.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Repeat steps 8 through 10 for the remaining virtual environments in the infrastructure.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The managing agents are systems that manage the communication between the collector
    and the virtual environment using the VMware APIs of the various products. They
    must be configured to manage secure communication between virtual environment
    instances and the collector.
  prefs: []
  type: TYPE_NORMAL
- en: It is recommended that VCM collector act as the managing agent if any of the
    vCenter instances it is managing has 1 to 30 hosts and upto 1,000 guests. The
    default managing agent is the Collector server, but as the workload increases,
    we can start adding them. In this recipe, we looked at designating a managed machine
    to a managed agent.
  prefs: []
  type: TYPE_NORMAL
- en: We are designating another server to communicate with the virtual environment
    so that some of the work can be offloaded from VCM Collector. The server must
    have connectivity to the virtual environment servers and VCM Collector.
  prefs: []
  type: TYPE_NORMAL
- en: Installing an agent on Windows servers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before we start managing any machine, we need to install an agent on it. This
    can be done in multiple ways, such as pushing it from the VCM console, installing
    it manually, or installing it with a script.
  prefs: []
  type: TYPE_NORMAL
- en: In this recipe, we will have a look at installing the agent manually and with
    a script on a Windows server.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Prepare a server to install the agent; the installer is available on the VCM
    Collector server, at `X:\Program Files (x86)\Vmware\VCM\AgentFiles` and the certificate
    is available at `X:\Program Files (x86)\Vmware\VCM\CollectorData`, where `X` is
    the drive where VCM is installed.
  prefs: []
  type: TYPE_NORMAL
- en: Copy the installer and certificate on a shared location from where it can be
    copied to the server where we want to install it.
  prefs: []
  type: TYPE_NORMAL
- en: We need administrative access on the server where we will be installing the
    agent.
  prefs: []
  type: TYPE_NORMAL
- en: The local firewall should be disabled (not recommended) or port `26542` must
    be open between the managed machine and VCM Collector.
  prefs: []
  type: TYPE_NORMAL
- en: For an agent push, we need the machines to be registered as licensed machines
    on the VCM console and the network authority account to be a part of the local
    administrators group, and port `26542` should be open on the machine where we
    are pushing the agent.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will split this recipe into three sections, as follows
  prefs: []
  type: TYPE_NORMAL
- en: '*Manual agent installation*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Agent push from the console*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Licensing Windows machines*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Manual agent installation
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Log in to the server with an administrative account, copy the installer with
    a certificate locally, and follow this process:'
  prefs: []
  type: TYPE_NORMAL
- en: Start `VCMAgentInstall.exe`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Next**, again on **Next**, and on the destination location screen,
    continue with the default `C:\Windows\CMAgent` value.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Allow HTTP**, and go with the default port, `26542`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On this page, browse to the location where the certificate is copied.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Next** three more times, and it will start installing the agent.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the agent has been installed, log in to VCM console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Windows Machines**, and click on **Add Machine**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Basic** and select automatically license machines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Provide details about the machine where you installed the agent, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the hostname for the **Machine Name** parameter
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Select the domain from the dropdown which the machine belongs to
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Select **DNS** as **Type**
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Select **Windows Server** as **Machine Type**
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Click on **Next** and then on **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the machine has been added to VCM, we need to hit the R**efresh** button
    on the console and click on **Collect** to start data collection.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Monitor the data collection job, and finally, we are done with adding a machine
    to VCM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Agent push from the console
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The machine should be in the VCM console either by running a discovery rule
    or adding it manually. Now, we can perform a push of the agent from the console.
  prefs: []
  type: TYPE_NORMAL
- en: 'Log in to the VCM console and follow these steps to install the agent on the
    machine:'
  prefs: []
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Windows Machines**, and select the machine which you want to add the agent to.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Install** in the menu.![Agent push from the console](img/image_02_020.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The wizard will open. Make sure the machine appears in the **Selected** box.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On the next page, set the following values:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Install At:** Keep this default.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Install From:** Keep this default.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Options:** Select **HTTP** and set the port to `26542`. Keep the rest default.'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Agent push from the console](img/image_02_021.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: On the schedule screen, select **Run Now**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Confirm the selection and click on **Finish**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Jobs** to see whether the job is successful, and after that, go back
    to the console, scroll to the right, and check whether the machine has its agent
    state changed from **Unknown** to **Current Agent** and shows its agent version
    as **5.8.2**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the machine has its agent installed, perform an initial collection.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Licensing Windows machines
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We will perform the following steps to license a managed machine. The steps
    are the same for Windows and Linux/Unix machines.
  prefs: []
  type: TYPE_NORMAL
- en: Log in to the VCM console with an admin account.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Administration**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Machines Manager** | **Available Machines**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the Windows machines to license.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **License**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the wizard to finish licensing the machine, and if the available number
    is below zero and in red, contact VMware to purchase more licenses.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: With this recipe, we are making sure that the machine we want to manage has
    an agent installed, is licensed in VCM, and that we have performed the data collection.
  prefs: []
  type: TYPE_NORMAL
- en: VCM has enough information about managed machines to start deploying software;
    put the machine in the correct machine group. We can perform further specific
    collections to find out the compliance status or patching status, and based on
    that, we can fix the machine or install missing patches.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We can install the agent with a script.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the code for the script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Here is what the options stand for:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Sr. No.** | **Option** | **Description** |'
  prefs: []
  type: TYPE_TB
- en: '| **1** | `C:\VCM_Agent` | The location where the BAT file, installer, and
    certificate are copied |'
  prefs: []
  type: TYPE_TB
- en: '| **2** | `CMAgentInstall.exe` | The VCM agent installer |'
  prefs: []
  type: TYPE_TB
- en: '| **3** | `/s` | Option for a silent installation |'
  prefs: []
  type: TYPE_TB
- en: '| **4** | `INSTALLPATH` | The location to install the VCM agent on the server
    |'
  prefs: []
  type: TYPE_TB
- en: '| **5** | `PORT` | The port for the VCM agent to communicate |'
  prefs: []
  type: TYPE_TB
- en: '| **6** | `CERT` | The VCM Enterprise certificate path |'
  prefs: []
  type: TYPE_TB
- en: Just run the batch file and then follow steps 6 to 11 to complete the agent
    installation.
  prefs: []
  type: TYPE_NORMAL
- en: You can also use the `PowerCLI` commands `Copy.VMGuestFile` and `Invoke-VMSCript`
    to automate the deployment.
  prefs: []
  type: TYPE_NORMAL
- en: Installing an agent on Linux servers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We need an agent to manage Linux/Unix machines; in this recipe, we will install
    it manually on a Linux machine.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In case of a Linux installer, make sure that it is copied from the same VCM
    server where the managed machine will get managed, as VCM certificates are embedded
    in the installer. If we use an installer from another VCM server and then try
    to manage it from a different server, it will fail.
  prefs: []
  type: TYPE_NORMAL
- en: Copy the correct installer from the VCM server to the Linux server.
  prefs: []
  type: TYPE_NORMAL
- en: Install the prerequisites and verify that the `glibc.i686`, `net-tools`, and
    `redhat-lsb-core` packages have been installed on the target machine.
  prefs: []
  type: TYPE_NORMAL
- en: Open port `26542` if a firewall is enabled.
  prefs: []
  type: TYPE_NORMAL
- en: We need the root password of the machine where the agent will be installed.
  prefs: []
  type: TYPE_NORMAL
- en: 'The agent is available at `X: \Program Files (x86)\VMware\VCM\Installer\Packages\CMAgent.5.8.2.linux`
    on the VCM Collector server. We don''t need to copy the certificate the way we
    did in Windows as the certificate is built into the installer.'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow the steps to install the agent on a Linux machine:'
  prefs: []
  type: TYPE_NORMAL
- en: Copy the installer with `scp` or `winscp` on the server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the Linux server as root.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run `chmod u+x CMAgent.5.8.2.linux`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run  `./CMAgent.5.8.2.linux` .
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Copy the modified and `savedcsi.config` file to the extracted location.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Note:** `csi.config` is a configuration file used by the VCM agent to install
    the agent.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: More details about the configuration options can be found at [https://www.vmware.com/support/vcm/doc/help/vcm581/Content/NIX/CM_Ref_UNIX_csi_config_options.htm](https://www.vmware.com/support/vcm/doc/help/vcm581/Content/NIX/CM_Ref_UNIX_csi_config_options.htm).There
    are lots of options available to configure the `csi.config` file.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We need to set `CSI_AGENT_RUN_OPTION = daemon` to start this as a daemon; for
    the rest, you can consult with your Linux admin and decide.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: An example:  `# cp /<Shared_location> csi.config /<extractedlocation>/CSIInstall/csi.config`
    .
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once this is done, run the installer script using `./CSIInstall/InstallCMAgent
    -s`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Once the agent has been installed, follow the previous recipe from step 6 onward;
    just change the location from **Licensed Windows Machines** to **Licensed UNIX
    Machines**, and when entering details, set **Machine Type** as **Red Hat Server**
    or any other, depending upon the OS and as per the following screenshot:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_02_022.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We added the agent to the Linux/Unix machines as well so that we can collect
    the details of the managed machines; then, those details will be used to check
    compliance and patch status.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We can create a preconfigured `csi-config` file and copy it to `/opt/CMAgent`
    along with the installer.
  prefs: []
  type: TYPE_NORMAL
- en: Copy the content of the following script into a `.sh` file.
  prefs: []
  type: TYPE_NORMAL
- en: 'Give it execute permission: `chmod CMAgentInstall.sh 755`.'
  prefs: []
  type: TYPE_NORMAL
- en: Then, run the `./CMAgentInstall.sh` command.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The script identifies the OS of the machine and, based on that, opens port `26542`
    on the local firewall. Then, it copies the preconfigured `csi.config` file and,
    finally, installs the agent from the `/opt/CSIInstall` folder.
  prefs: []
  type: TYPE_NORMAL
- en: Creating machine groups
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Machine/virtual object groups are used to organize managed machines and virtual
    objects into small logical groups. There are default groups available from VCM
    when it is deployed (more details are in the *There's More...* section).
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As an administrator, you must have some idea of which machine you should put
    together. You can use this concept and create machine groups as per your requirement.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Once you have a basic understanding of what you want to achieve with the group,
    log in to the VCM console and follow the steps detailed shortly.
  prefs: []
  type: TYPE_NORMAL
- en: We will create a machine group that will include all the machines that are a
    part of the `Study.local` Active Directory group, and it will keep on adding machines
    as soon as a new machine is added to VCM from the same domain.
  prefs: []
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Machine/Virtual Object Group**
    | **All Machines** and click on **Add Group**.![How to do it...](img/image_02_023.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a name and proper description, and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Membership Type** as **Dynamic** or **Static**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In our case, we are going ahead with **Dynamic**, so click on **Finish** on
    the next page to complete the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow step 1 again, but this time, go to the machine group we just created.
    Click on the group and then click on **Filters**. This is where we will define
    the criteria to add machines to this group.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Filters**, click on **Add Filter**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a meaningful name and description, and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, all the details we collected from vCenter, vCloud, and all the managed
    machines are available here to filter.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Your imagination is the limit for creating filters, and you can use all the
    information you can gather from VCM. In our case, we have selected Machines as
    the data type; this is where your experience and expectations will meet together
    to make the exact machine group you want.![How to do it...](img/image_02_024.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Basic** under **Rule Type**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, add your condition, such as **Domain Name****=**`'STUDY'`.![How to do it...](img/image_02_025.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Next**, and then click on **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, go to the machine group, and a refresh will give you all the machines that
    are a part of the `STUDY` domain.![How to do it...](img/image_02_026.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When you work with managed machines, you can create static groups, where members
    are selected manually, or dynamic groups, where filters dynamically determine
    membership. Machines can belong to multiple groups.
  prefs: []
  type: TYPE_NORMAL
- en: You set the active machine group on the main toolbar, and you can define a machine
    filter with the options to the right of the textbox, as shown in this screenshot.
    A machine group filter further limits the selected machine group.
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/image_02_027.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In all nodes except those in the **Administration** slider, an active machine
    group limits the displayed data to the managed machines defined in the selected
    machine group.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This is the list of default groups created with an installation of VCM:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Name** | **Description** |'
  prefs: []
  type: TYPE_TB
- en: '| All machines | All the licensed machines in VCM |'
  prefs: []
  type: TYPE_TB
- en: '| AD auto-created | Active Directory auto-created machine groups |'
  prefs: []
  type: TYPE_TB
- en: '| All Unix machines | All Unix machines |'
  prefs: []
  type: TYPE_TB
- en: '| All VM guest machines | All managed VM guests from managed vCenter, vCloud,
    and vShield environments |'
  prefs: []
  type: TYPE_TB
- en: '| All VM guest Unix machines | All VM guest Unix machines |'
  prefs: []
  type: TYPE_TB
- en: '| All VM guest Windows machines | All VM guest Windows machines |'
  prefs: []
  type: TYPE_TB
- en: '| All VM host machines | All VM host machines |'
  prefs: []
  type: TYPE_TB
- en: '| All Windows machines | All Windows machines |'
  prefs: []
  type: TYPE_TB
- en: Dynamic groups
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In dynamic groups, we define single or multiple filters, and based on the filters,
    the group is populated. If we are defining multiple filters, then a logical `AND`
    operation is performed on them.
  prefs: []
  type: TYPE_NORMAL
- en: Your imagination is the limit, considering the amount of data you have in VCM
    and all that of it is available to play with while creating filters for groups.
  prefs: []
  type: TYPE_NORMAL
- en: Static groups
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In static groups, we define the members when we create the group, and then,
    we need to update them as and when required. There are no filters associated with
    them.
  prefs: []
  type: TYPE_NORMAL
- en: The best use case is creating a static group for all the vCenter Server instances,
    as we won't be adding members on a daily basis, and if we add anyone, we can add
    them manually.
  prefs: []
  type: TYPE_NORMAL
