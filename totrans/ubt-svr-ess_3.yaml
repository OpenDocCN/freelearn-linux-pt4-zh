- en: Chapter 3. Deploying Servers on Ubuntu
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第三章：在 Ubuntu 上部署服务器
- en: Hundreds of different services can be deployed on an Ubuntu Server, and each
    one of these services can be detailed in an entire book. In this chapter, we will
    have a look at the essentials of setting up and configuring some of the most common
    servers that system administrators need. Newbies will get a step-by-step guide,
    and advanced users will discover the Ubuntu approach towards servers. We will
    start with the deployment of the famous OpenSSH server. Then, we'll move on to
    set up a DNS server. After that, we will cover how to turn on a web and an e-mail
    server. Finally, we will cover how to deploy a database, DHCP, and file server.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 数百种不同的服务可以部署在 Ubuntu 服务器上，每一种服务都可以在一本书中详细介绍。本章将重点介绍一些系统管理员常见的服务器设置和配置要点。新手将获得逐步指导，而高级用户将了解
    Ubuntu 的服务器方法。我们将从部署著名的 OpenSSH 服务器开始，然后设置 DNS 服务器。接着，我们将介绍如何启动 Web 服务器和邮件服务器。最后，我们将介绍如何部署数据库、DHCP
    和文件服务器。
- en: 'The following topics are covered in the chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章内容涵盖了以下主题：
- en: Deploying an OpenSSH server
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署 OpenSSH 服务器
- en: Setting up a DNS server
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 DNS 服务器
- en: Turning on a web server
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动 Web 服务器
- en: Deploying a mail server
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署邮件服务器
- en: Setting up a database server
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置数据库服务器
- en: Setting up a DHCP server
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 DHCP 服务器
- en: Installing a file server
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装文件服务器
- en: Deploying an OpenSSH server
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署 OpenSSH 服务器
- en: Let's start with the most useful server that, according to me, every administrator
    should install on their server, irrespective of the aim of this server and the
    services that need to be put on it. It is the **OpenSSH** server that allows you
    to remotely connect in a secure way to a server from a computer that can reach
    this server. The OpenSSH server is a set of tools that allow, besides the secure
    remote connection, a secure file transfer with the help of the scp protocol.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从最有用的服务器开始，依我看来，每个管理员都应该在他们的服务器上安装它，无论该服务器的目的是什么，以及需要放置哪些服务。它就是 **OpenSSH**
    服务器，允许你通过安全的方式从一个可以访问该服务器的计算机远程连接到服务器。OpenSSH 服务器是一组工具，除了提供安全的远程连接外，还支持通过 scp
    协议进行安全的文件传输。
- en: The OpenSSH server allows clients to connect using many authentication methods,
    such as a plain password, a public key, and kerberos tickets.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: OpenSSH 服务器允许客户端使用多种认证方式连接，如简单密码、公共密钥和 Kerberos 票证。
- en: Installing the OpenSSH server
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 OpenSSH 服务器
- en: We can install only the OpenSSH server, but in general, we need both the OpenSSH
    tools—a server and a client. We need a server to connect to the Ubuntu Server
    that we are working on from a reachable computer. We require a client to connect
    it to another server or computer.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以只安装 OpenSSH 服务器，但通常我们需要同时安装 OpenSSH 工具——即服务器和客户端。我们需要一个服务器来从可访问的计算机连接到我们正在使用的
    Ubuntu 服务器。我们还需要一个客户端来将其连接到另一个服务器或计算机。
- en: 'Installing OpenSSH (the server and client) is quite easy. To install the OpenSSH
    client, you need to run the following command:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 OpenSSH（包括服务器和客户端）非常简单。要安装 OpenSSH 客户端，你需要运行以下命令：
- en: '[PRE0]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'For the OpenSSH server, we previously saw that we can install it by using the
    `tasksel` utility during the Ubuntu Server installation process, but if you forgot
    to do this in the preceding step, you need to run the following command:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 OpenSSH 服务器，我们之前看到可以在 Ubuntu Server 安装过程中使用 `tasksel` 工具进行安装，但如果你在之前的步骤中忘记执行此操作，你需要运行以下命令：
- en: '[PRE1]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Note
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'To install both the client and the server at once, you can simply run the following
    command:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 要同时安装客户端和服务器，你只需运行以下命令：
- en: '[PRE2]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Configuring the OpenSSH server
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 OpenSSH 服务器
- en: The OpenSSH server is handled by the `sshd` daemon. Its configuration is located
    in the `/etc/ssh/sshd_config` file, which can be modified by editing it.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: OpenSSH 服务器由 `sshd` 守护进程管理。其配置文件位于 `/etc/ssh/sshd_config`，可以通过编辑该文件来修改配置。
- en: Tip
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'A bad manipulation of this file can alter the SSH server work and break it.
    Therefore, it is better to start by performing a backup for this file and, as
    a security measurement, set the backup file as read-only by using the following
    commands:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 对该文件的不当操作可能会影响 SSH 服务器的正常运行，甚至使其崩溃。因此，最好先对该文件进行备份，并作为安全措施，通过以下命令将备份文件设置为只读：
- en: '[PRE3]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Let''s have a look at a couple of examples of what you can change by using
    this file. For the first example, find the port number. By default, `sshd` is
    listening on port *22*. You can change this behavior and configure it to make
    it listen on port *2233* by setting the value of the port directive to *2233*
    inside this file. You will also find the **HostKey** directive, which allows us
    to set authentication keys paths. Another example is an instance where you would
    like to show the banner message that exists in the `/etc/issue.net` file as a
    pre-login message by commenting out the following line:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看几个可以通过此文件进行更改的示例。第一个例子是查找端口号。默认情况下，`sshd`监听端口*22*。您可以更改此行为，并通过在该文件中将端口指令的值设置为*2233*，使其监听端口*2233*。您还会找到**HostKey**指令，它允许我们设置认证密钥的路径。另一个例子是，当您想在登录前显示`/etc/issue.net`文件中的横幅消息时，通过注释掉以下行来实现：
- en: '[PRE4]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: If you would like to know more about the configuration directives that can be
    changed, and the eventual values and their use, just run the man `sshd_config`
    command.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想了解更多可以更改的配置指令及其可能的值和用途，只需运行 `man sshd_config` 命令。
- en: After making modifications in the `/etc/ssh/sshd_config` file, you should save
    it and then restart the daemon by using the `sudo service ssh restart` command.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在修改了`/etc/ssh/sshd_config`文件后，您应保存文件，并使用`sudo service ssh restart`命令重启守护进程。
- en: Tip
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Be careful when editing this file from a remote location, especially when the
    remote connection is the only way of reaching the server, because modifying this
    file can change the way it behaves when interacting with the network. Besides,
    in case there are some errors in this file and you restart the `sshd` daemon,
    the server may not start again and you will lose the connection on the server.
    Therefore, be careful and prepare your plan B (for example, having someone on
    site to reestablish the connection by restoring the original backup file).
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在远程位置编辑此文件时要小心，尤其是当远程连接是连接到服务器的唯一方式时，因为修改此文件可能会改变与网络交互时的行为。此外，如果该文件中有错误并且您重新启动`sshd`守护进程，服务器可能无法重新启动，您将失去与服务器的连接。因此，请小心操作，并准备好应急计划（例如，让现场人员通过恢复原始备份文件重新建立连接）。
- en: Note that by running `/usr/bin/sshd -t`, you can test the `config` file before
    restarting the server and thus avoid the eventual problems that we talked about
    in the preceding section.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，通过运行`/usr/bin/sshd -t`，您可以在重启服务器之前测试`config`文件，从而避免我们在前一节中讨论的潜在问题。
- en: Setting up a DNS server
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 DNS 服务器
- en: A **DNS** is a **domain name system** server that answers queries about domain
    names by providing the relative IP address. It is a must for www working; without
    it, users will have to learn the IP addresses of every website that they want
    to visit and type them manually in their browser (or add them manually to host
    files), which is impossible.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**DNS** 是一种**域名系统**服务器，它通过提供相应的 IP 地址来回答有关域名的查询。它是 www 工作的必要条件；没有它，用户将不得不学习每个网站的
    IP 地址并手动输入到浏览器中（或者将它们手动添加到主机文件中），这是不可能的。'
- en: There are a lot of programs that provide DNS services under Ubuntu, but the
    most common one is BIND.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Ubuntu 下有许多提供 DNS 服务的程序，但最常见的是 BIND。
- en: The BIND installation
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BIND 安装
- en: If you missed installing BIND during the Ubuntu Server installation, you can
    do it now, and there is more than one way of doing that.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在 Ubuntu Server 安装过程中错过了安装 BIND，您现在可以安装，方法有不止一种。
- en: 'You can either use the `tasksel` utility, which will automatically install
    for you the two `bind9` and `bind9-doc` packages. Alternatively, you can use the
    `apt-get` tool, as follows:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`tasksel`工具，它会自动为您安装`bind9`和`bind9-doc`两个软件包。或者，您也可以使用`apt-get`工具，如下所示：
- en: '[PRE5]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Once the BIND packages are installed, it is fully configured and functional
    with the default parameters that allow it to work as a caching DNS for recursive
    queries. You can of course customize it to fit your needs. We will discuss how
    to do that in the following sections.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装了 BIND 软件包，它将使用默认参数完全配置并能够作为递归查询的缓存 DNS 工作。您当然可以根据需要自定义它。我们将在接下来的章节中讨论如何做到这一点。
- en: 'You can check BIND''s status by using the following command:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下命令检查 BIND 的状态：
- en: '[PRE6]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'In case it is not running, you can launch it by using the following command:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果它没有运行，您可以使用以下命令启动它：
- en: '[PRE7]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The output of this command is shown in the following screenshot:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令的输出如下图所示：
- en: '![The BIND installation](img/B04800_03_01.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![BIND 安装](img/B04800_03_01.jpg)'
- en: Ubuntu's BIND conventions
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Ubuntu 的 BIND 约定
- en: 'BIND files may have an organization in Ubuntu that is different from the ones
    in other distributions. The following are the basic files and directories:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: BIND 文件在 Ubuntu 中的组织方式可能与其他发行版有所不同。以下是基本的文件和目录：
- en: '`/etc/bind`: This is the main directory for the BIND configuration files. It
    also contains the `zone` files.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/bind`：这是 BIND 配置文件的主目录，它还包含 `区域` 文件。'
- en: '`/etc/bind/named.conf`: This is BIND''s main configuration file. It includes
    scripts from other files, with the most notable ones being: `/etc/bind/named.conf.default-zones`,
    which contains a default zone such as local host; `/etc/bind/named.conf.local`,
    which contains zones added by the system administrator (use this file when you
    would like to add zones); and `/etc/bind/named.conf.options`, which contains additional
    options such as forwarders'' addresses.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/bind/named.conf`：这是 BIND 的主配置文件。它包含了来自其他文件的脚本，其中最著名的文件有：`/etc/bind/named.conf.default-zones`，它包含如本地主机的默认区域；`/etc/bind/named.conf.local`，它包含由系统管理员添加的区域（当您想要添加区域时使用此文件）；以及
    `/etc/bind/named.conf.options`，它包含诸如转发器地址等附加选项。'
- en: '`/etc/bind/db.*`: The zone files, which contain information related to each
    zone, have the convention of starting with `db.`, and each file identifies a particular
    zone.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/bind/db.*`：包含与每个区域相关的信息的区域文件，约定以 `db.` 开头，每个文件表示一个特定的区域。'
- en: '`/etc/init.d/bind9`: This is the file that contains the BIND startup parameters
    that are needed to launch the service.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/init.d/bind9`：这是包含启动 BIND 服务所需的启动参数的文件。'
- en: '`/var/log/syslog`: By default, BIND uses this file to store its logs. This
    file contains the log of a lot of other services. So, if you would like to have
    only the BIND log, you can simply search for the named keyword using the `grep`
    command, as follows:'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/log/syslog`：默认情况下，BIND 使用此文件存储其日志。该文件包含许多其他服务的日志。因此，如果您只希望获取 BIND 的日志，可以使用
    `grep` 命令查找关键字 `named`，如下所示：'
- en: '[PRE8]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Configuring BIND
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 BIND
- en: 'Configuring BIND is simple. It is always about creating new zones (or editing
    the existing ones). This is done by performing the following three steps:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 BIND 很简单。它通常是创建新的区域（或编辑现有的区域）。这可以通过执行以下三个步骤来完成：
- en: Either create a zone file relative to the zone that needs to be added, or edit
    an existing one.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可以创建与需要添加的区域相关的区域文件，或者编辑现有的文件。
- en: Add a reference to the zone file in `/etc/bind/named.conf.local`
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `/etc/bind/named.conf.local` 中添加对区域文件的引用
- en: 'Reload the BIND service by using the following command:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令重新加载 BIND 服务：
- en: '[PRE9]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Zone file configuration
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 区域文件配置
- en: The details related to a specific domain name are stored in a DNS server in
    an entity called **zone**. Each zone is represented by a file under the `/etc/bind/
    directory`. In this section, we will take a look at how to configure a DNS zone
    file.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 与特定域名相关的详细信息存储在 DNS 服务器中的一个实体中，称为 **区域**。每个区域都由 `/etc/bind/` 目录下的一个文件表示。在本节中，我们将了解如何配置
    DNS 区域文件。
- en: Note
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you would like to get more information about this subject, a complete tutorial
    on zone files and their contents is available at [http://www.slashroot.in/what-dns-zone-file-complete-tutorial-zone-file-and-its-contents](http://www.slashroot.in/what-dns-zone-file-complete-tutorial-zone-file-and-its-contents).
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想了解更多关于该主题的信息，可以在 [http://www.slashroot.in/what-dns-zone-file-complete-tutorial-zone-file-and-its-contents](http://www.slashroot.in/what-dns-zone-file-complete-tutorial-zone-file-and-its-contents)
    找到完整的关于区域文件及其内容的教程。
- en: The zone files have the same structure. So, an easy way of configuring a new
    zone is by copying an existing zone file (such as `/etc/bind/db.local`) and then
    modifying it as required.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 区域文件具有相同的结构。因此，配置新区域的一个简单方法是复制现有的区域文件（例如 `/etc/bind/db.local`），然后根据需要修改它。
- en: By default, timers in the zone file are set in seconds. You can use other time
    units such as the day by adding the letter `d` to the value, the week by adding
    the letter `w`, the hour using the letter `h`, and so on.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，区域文件中的定时器是以秒为单位设置的。您可以通过在值后添加字母 `d` 来使用其他时间单位，例如天、添加字母 `w` 表示周、使用字母 `h`
    表示小时，等等。
- en: 'The following are the most important fields in the zone file configuration:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是区域文件配置中最重要的字段：
- en: '**SOA**: **Start of Authority**, this server is considered to be the best source
    of information'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SOA**：**授权开始**，该服务器被认为是信息的最佳来源'
- en: '**NS**: This is the name servers for the zone file'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**NS**：这是区域文件的名称服务器'
- en: '**A**: This is IPv4 address'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**A**：这是 IPv4 地址'
- en: '**AAAA**: This is IPv6 address'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AAAA**：这是 IPv6 地址'
- en: '**MX**: This is the mail server'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**MX**：这是邮件服务器'
- en: You also need to configure a reversed DNS file for every zone that you create.
    The structure is also the same, so you can just copy one of the default reversed
    zones, such as `/etc/bind/db.127`.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 你还需要为每个创建的区域配置一个反向 DNS 文件。其结构与正向文件相同，因此你可以简单地复制一个默认的反向区域，例如 `/etc/bind/db.127`。
- en: 'To reference a zone file inside `/etc/bind/named.conf.local`, you need to just
    copy a sample of an existing reference and modify it. The following is an example
    that demonstrates this:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 `/etc/bind/named.conf.local` 文件中引用一个区域文件，只需复制现有引用的示例并进行修改。以下是一个示例，演示了这个过程：
- en: '[PRE10]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Note
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When you reload BIND, it will take into consideration the modified zone file
    that has a higher serial number. So, be sure to increment the serial field in
    the zone file each time you modify it. If you don't do this, your modifications
    will be ignored. Most system administrators use the yyyyMMddHHmm format for this
    field.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 当你重新加载 BIND 时，它会考虑到修改后的区域文件，并且该文件具有更高的序列号。所以，在每次修改文件时，确保增加区域文件中的序列号。如果不这样做，你的修改将会被忽略。大多数系统管理员使用
    yyyyMMddHHmm 格式来表示这个字段。
- en: DNS redundancy
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DNS 冗余
- en: DNS is a critical service for web and e-mail applications. So, it is important
    to have a redundancy of the main DNS server (called **salve**), which has the
    same information as the **master** DNS server.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: DNS 是 Web 和电子邮件应用程序的关键服务。因此，保持主 DNS 服务器（称为 **salve**）的冗余非常重要，它应该与 **master**
    DNS 服务器拥有相同的信息。
- en: 'To configure this, you have to add the salve server to the zone file in the
    master server by using the NS record. Then, when referencing the zone file, you
    should add the allow-transfer option to the zone definition inside the master
    DNS to allow the slave DNS to copy the data from it. You can also add the also-notify
    option so that the master DNS will notify the slave DNS for every modification
    inside that zone. On the other hand, in the slave server, the zone definition
    should contain the slave type and point to the master server. As an example, if
    we assume that the IP address of the master DNS is *192.168.1.1* and the IP address
    of the slave DNS is *192.168.1.2*, we should get the following output:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 配置这个过程时，你需要通过使用 NS 记录将 salve 服务器添加到主服务器的区域文件中。然后，在引用区域文件时，应该在主 DNS 的区域定义中添加
    allow-transfer 选项，以允许 slave DNS 从主 DNS 复制数据。你还可以添加 also-notify 选项，以便主 DNS 在该区域有任何修改时通知
    slave DNS。另一方面，在 slave 服务器中，区域定义应该包含 slave 类型，并指向主服务器。例如，假设主 DNS 的 IP 地址是 *192.168.1.1*，而
    slave DNS 的 IP 地址是 *192.168.1.2*，那么你应该得到如下输出：
- en: 'On the `master` server you will find the following output:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `master` 服务器上，你会看到如下输出：
- en: '[PRE11]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'On the `slave` server you will find the following output:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `slave` 服务器上，你会看到如下输出：
- en: '[PRE12]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: DNS testing
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DNS 测试
- en: To test whether your DNS is working, you should request to server and check
    the correctness of the information. To do this, you should either use a computer
    in which you point your name server to this DNS, or simply add the IP address
    of that DNS server as a parameter.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 要测试你的 DNS 是否正常工作，你应该向服务器发送请求并检查信息的正确性。为此，你可以使用一台计算机，将其 DNS 服务器指向该 DNS，或者直接将该
    DNS 服务器的 IP 地址作为参数添加。
- en: The famous NsLookup tool is the simplest tool to test DNS and reverse DNS. There
    is also the `dig` utility, which gives a richer answer, and the host tool, which
    is similar to NsLookup.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 著名的 NsLookup 工具是最简单的 DNS 和反向 DNS 测试工具。还有 `dig` 工具，它可以提供更丰富的答案，以及与 NsLookup 类似的
    host 工具。
- en: Turning on a web server
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动 web 服务器
- en: There are a lot of open source web servers that we can deploy on the Ubuntu
    Server, such as Apache Tomcat, NGINX, and Jetty. Each web server should be installed
    and configured to deal with a specific programming language. We should also install
    its libraries, along with the installation and configuration of the database that
    is necessary for the web server. Instead of doing all of this, especially when
    you need a web server to deploy an application developed in PHP, Perl, or Python,
    the best choice is to install a LAMP server.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多开源的 web 服务器可以在 Ubuntu Server 上部署，例如 Apache Tomcat、NGINX 和 Jetty。每个 web 服务器都应该安装并配置好，以处理特定的编程语言。我们还需要安装相关的库，并配置与
    web 服务器所需的数据库。与其做这些繁琐的步骤，尤其是当你需要一个 web 服务器来部署 PHP、Perl 或 Python 开发的应用时，最好的选择是安装一个
    LAMP 服务器。
- en: '**LAMP** is the abbreviation for **Linux Apache MySQL PHP** (or sometimes **Perl**
    or **Python**). It is the de facto standard for a web server deployment based
    on a combination of the Apache web server program that is used with Perl, PHP,
    or Python for dynamic content handling, and a MySQL database on the backend, with
    all of these components running on a Linux server. It has become a common way
    of setting up a web server deployment under Linux. That''s the reason why Ubuntu
    has grouped all the necessary packages together—to simplify using LAMP inside
    an Ubuntu Server.'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**LAMP** 是 **Linux Apache MySQL PHP**（有时是 **Perl** 或 **Python**）的缩写。它是基于 Apache
    web 服务器程序与 Perl、PHP 或 Python 处理动态内容，以及 MySQL 数据库在后台共同运行在 Linux 服务器上的标准 Web 服务器部署方案。它已成为在
    Linux 下设置 Web 服务器部署的一种常见方式。这也是为什么 Ubuntu 将所有必要的包组合在一起——为了简化在 Ubuntu 服务器中使用 LAMP。'
- en: The LAMP Installation
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: LAMP 安装
- en: There are a few different ways of setting up a web server on a default Ubuntu
    Server installation. Probably the easiest method is selecting the LAMP server
    during the initial installation, or afterwards with the `tasksel` tool. This will
    add the `apache2`, `apache2-mpm-prefork`, `mysql-server-5.6`, `mysql-client-5.6`,
    and `php5-mysql` packages along with all of their libraries and other dependencies.
    Alternatively, you can install each of these packages from the command line using
    the `apt-get install` tool.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在默认的 Ubuntu 服务器安装中，有几种不同的方法来设置 Web 服务器。最简单的方法可能是在初始安装过程中选择 LAMP 服务器，或者之后使用`tasksel`工具。这将添加`apache2`、`apache2-mpm-prefork`、`mysql-server-5.6`、`mysql-client-5.6`和`php5-mysql`包以及它们的所有库和其他依赖项。或者，你也可以通过命令行使用
    `apt-get install` 工具单独安装这些包。
- en: 'During installation, the package manager will ask you to enter the root password
    of the MySQL database, as shown in the following screenshot:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，包管理器会要求你输入 MySQL 数据库的 root 密码，如下图所示：
- en: '![The LAMP Installation](img/B04800_03_02.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![LAMP 安装](img/B04800_03_02.jpg)'
- en: Entering the password is optional. You can keep it empty, but for security reasons
    it is recommended that you set a root password for the MySQL database. If you
    don't do that, anyone with an account on the server can access your database and
    read, alter, and even delete data.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 输入密码是可选的。你可以将其保持为空，但出于安全原因，建议你为 MySQL 数据库设置 root 密码。如果不这样做，任何在服务器上有账户的人都可以访问你的数据库，读取、修改甚至删除数据。
- en: After installing the LAMP server, there is an additional program that is very
    helpful and which can be installed. This program is called **phpMyAdmin**. It
    is a LAMP application that was specifically written for the administration of
    MySQL servers. It provides an easy graphical interface for database administration
    tasks that are written in PHP and which can be accessed via a web browser.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 LAMP 服务器后，还有一个额外的程序非常有用，可以进行安装。这个程序叫做**phpMyAdmin**。它是一个专门为 MySQL 服务器管理编写的
    LAMP 应用程序，提供了一个简便的图形界面，用于数据库管理任务，编写语言为 PHP，可以通过 web 浏览器访问。
- en: 'To install it, run the following command:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装它，请运行以下命令：
- en: '[PRE13]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'During installation, you will be asked to choose the web server that you want
    to configure for phpMyAdmin. In our case, it is `apache2`, as shown in the following
    screenshot:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，系统会要求你选择想要为 phpMyAdmin 配置的 web 服务器。在我们的案例中，选择的是`apache2`，如下图所示：
- en: '![The LAMP Installation](img/B04800_03_03.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![LAMP 安装](img/B04800_03_03.jpg)'
- en: You can test the LAMP server by using the IP address of the Ubuntu Server on
    your web browser. You should get the Apache2 default page. Also, you can test
    `phpmyadmin` by using `<ubuntu-server-IP>/phpmyadmin`. You will get the login
    interface (use the MySQL parameters to log in to `phpmyadmin`).
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过在浏览器中使用 Ubuntu 服务器的 IP 地址来测试 LAMP 服务器。你应该会看到 Apache2 的默认页面。此外，你还可以通过`<ubuntu-server-IP>/phpmyadmin`来测试`phpmyadmin`。你将看到登录界面（使用
    MySQL 参数登录到`phpmyadmin`）。
- en: Ubuntu's LAMP Conventions
  id: totrans-103
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Ubuntu 的 LAMP 约定
- en: 'Like most other distributions, Ubuntu has certain conventions when it comes
    to the Apache administration. Configuration files are organized in a particular
    way, as are administrative tools and logs. If you aren''t used to the way Debian
    and Ubuntu organize Apache, it is quite different from what you may have seen
    on other distributions. Here are the major file conventions for Apache:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 和大多数其他发行版一样，Ubuntu 在 Apache 管理方面有一些约定。配置文件的组织方式、管理工具和日志的组织方式都有特定的规则。如果你不习惯 Debian
    和 Ubuntu 对 Apache 的组织方式，可能会觉得与其他发行版有很大不同。以下是 Apache 的主要文件约定：
- en: '`/etc/apache2`: This directory contains all the Apache configuration files.
    Formerly, Apache was configured via one large `httpd.conf` file, which contained
    options, settings, and different virtual hosts. Actually, this file is empty because
    Ubuntu has moved away from the monolithic `httpd.conf` model and has split up
    its configuration across a number of files and subdirectories.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2`: 该目录包含所有 Apache 配置文件。以前，Apache 是通过一个大的 `httpd.conf` 文件进行配置的，文件中包含了选项、设置和不同的虚拟主机。实际上，该文件为空，因为
    Ubuntu 已经不再使用单一的 `httpd.conf` 模式，而是将配置分散到多个文件和子目录中。'
- en: '`/etc/apache2/apache2.conf`: This is the main Apache configuration file that
    is used by Ubuntu''s Apache2 binary. The default `apache2.conf` file is heavily
    commented. So, it works well as a guide in and of itself to each configuration
    option and what it does.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/apache2.conf`: 这是 Ubuntu 的 Apache2 二进制文件使用的主配置文件。默认的 `apache2.conf`
    文件注释丰富，因此它本身就可以作为每个配置选项及其作用的指南。'
- en: '`/etc/apache2/envvars`: This file contains the definition of the environment
    variables used by different scripts when Apache starts to define settings such
    as the location of the PID files.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/envvars`: 该文件包含 Apache 启动时用于定义环境变量的定义，这些变量会被不同的脚本使用，例如 PID 文件的位置等设置。'
- en: '`/etc/apache2/ports.conf`: This file is used to define which ports Apache listens
    on when it starts. The default settings make it listen on the standard port *80,*
    and additionally on port *443* when the SSL module is enabled.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/ports.conf`: 该文件用于定义 Apache 启动时监听的端口。默认设置使 Apache 监听标准端口 *80*，并且当启用
    SSL 模块时，监听端口 *443*。'
- en: '`/etc/apache2/conf.d/`: This directory is listed as an included directory in
    the main `apache2.conf` file, which means that when Apache starts, it will also
    include the configuration files found in this directory and add them to the overall
    configuration. This directory is used for additional Apache options that an administrator
    (or a package) might want to add separately from the core `apache2.conf` file.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/conf.d/`: 该目录在主 `apache2.conf` 文件中被列为包含目录，这意味着当 Apache 启动时，它也会包括此目录中的配置文件，并将其添加到整体配置中。该目录用于管理员（或软件包）可能希望与核心
    `apache2.conf` 文件分开添加的附加 Apache 选项。'
- en: '`/etc/apache2/mods-available/`: Ubuntu offers a simpler and more modular approach
    than the traditional way of adding modules. All the modules that are available
    on the system are represented within this directory by the .load and `.conf` files.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/mods-available/`: Ubuntu 提供了一种比传统方式更简单且模块化的模块添加方法。系统中所有可用的模块都通过
    .load 和 `.conf` 文件在此目录中表示。'
- en: '`/etc/apache2/mods-enabled/`: This directory basically contains symbolic links
    to the .load and .conf files in the `mods-enabled` directory. When Apache starts,
    it will scan this directory and load all the modules referenced within the directory.
    So for instance, if you want to enable the SSL module, you can run `sudo ln -s
    /etc/apache2/mod-available/ssl.load /etc/apache2/mods-enabled/ssl.load`. Ubuntu
    even provides tools to simplify this. To enable a module, just run `a2enmod`,
    followed by the module that you want to enable. For example, to enable the SSL
    module as we did previously, just run `sudo a2enmod ssl`. Likewise, there is an
    `a2dismod` program that will disable a module for you. It takes the same syntax
    as `a2enmod`. So, to disable SSL, execute `sudo a2dismod ssl`.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/mods-enabled/`: 该目录基本上包含指向 `mods-available` 目录中 .load 和 .conf
    文件的符号链接。当 Apache 启动时，它会扫描此目录并加载其中引用的所有模块。因此，例如，如果您想启用 SSL 模块，可以运行 `sudo ln -s
    /etc/apache2/mod-available/ssl.load /etc/apache2/mods-enabled/ssl.load`。Ubuntu
    甚至提供了简化这一过程的工具。要启用模块，只需运行 `a2enmod`，后跟您想启用的模块。例如，要启用之前提到的 SSL 模块，只需运行 `sudo a2enmod
    ssl`。同样，`a2dismod` 程序可以帮助您禁用模块。它的语法与 `a2enmod` 相同。因此，要禁用 SSL，执行 `sudo a2dismod
    ssl`。'
- en: '`/etc/apache2/sites-available/`: Ubuntu organizes the Apache virtual hosts
    in a similar way to how it organizes modules. Under Ubuntu, every virtual host
    or site that is available to be served by Apache on this machine has its configuration
    in a separate file under sites-available.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/sites-available/`: Ubuntu 以类似于组织模块的方式组织 Apache 虚拟主机。在 Ubuntu
    中，每个可由 Apache 服务的虚拟主机或站点都会有一个单独的配置文件，位于 sites-available 目录下。'
- en: '`/etc/apache2/sites-enabled/`: Like `mods-enabled`, this directory contains
    symbolic links to configuration files in sites-available. So, when you want to
    add a new virtual host to Apache, just create a new configuration file for the
    host that contains a complete `<VirtualHost>` block under sites-available, and
    **symbolic link** (**symlink**) it here:'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/apache2/sites-enabled/`：与 `mods-enabled` 类似，该目录包含指向 `sites-available`
    中配置文件的符号链接。因此，当您想为 Apache 添加一个新的虚拟主机时，只需在 `sites-available` 中为该主机创建一个包含完整 `<VirtualHost>`
    块的新配置文件，并将其 **符号链接**（**symlink**）到此处：'
- en: '[PRE14]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Alternatively, you can use the `a2ensite` script that works just like `a2enmod`.
    Just run `a2enmod` with the site that you wish to enable as an argument. To enable
    `mysite`, type `sudo a2ensite mysite`, and to disable it you can use `a2dissite`,
    as follows:'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 或者，您可以使用与 `a2enmod` 相同工作原理的 `a2ensite` 脚本。只需运行 `a2enmod` 并传入您希望启用的站点作为参数。要启用
    `mysite`，输入 `sudo a2ensite mysite`，要禁用它，您可以使用 `a2dissite`，如下所示：
- en: '[PRE15]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '`/var/www/`: This is the default document root for Apache. An HTML file that
    is readable by Apache and placed in this directory will be available once you
    point a web browser at the server. There is already a default `index.html` in
    this directory.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/www/`：这是 Apache 的默认文档根目录。任何可以被 Apache 读取并放置在此目录中的 HTML 文件，一旦您指向浏览器到该服务器，便可以访问。该目录中已经有一个默认的
    `index.html` 文件。'
- en: '`/usr/lib/cgi-bin/`: This is the default location for the CGI scripts. The
    scripts referenced on the web server by `/cgi-bin` will point here.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/usr/lib/cgi-bin/`：这是 CGI 脚本的默认位置。通过 `/cgi-bin` 引用的脚本将指向此处。'
- en: '`/var/log/apache2/`: This is the standard directory in which the Apache logs
    are stored. The `access.log` file contains information about the files that have
    been accessed on the web server, and the `error.log` file lists the Apache errors.
    In case you have trouble starting Apache, look in `error.log` for clues.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/log/apache2/`：这是 Apache 日志存储的标准目录。`access.log` 文件包含关于已访问文件的信息，`error.log`
    文件列出了 Apache 错误。如果您在启动 Apache 时遇到问题，可以查看 `error.log` 文件以获取线索。'
- en: Note
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'To activate the new configuration, you need to run the following command:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 要激活新的配置，您需要运行以下命令：
- en: '[PRE16]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Apache management and testing
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Apache 管理和测试
- en: In the following section, we will discover one of the most helpful Apache tools
    named `apache2ctl,` and some of its applications.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将介绍一个非常有用的 Apache 工具，名为 `apache2ctl`，以及它的一些应用。
- en: apache2ctl
  id: totrans-125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: apache2ctl
- en: 'The `/usr/sbin/apache2ctl` program is the primary command-line program that
    you will use to manage Apache under Ubuntu. The syntax for the command is fairly
    straightforward. Run `apache2ctl` from the command line and pass a single command
    to it as an argument. The simple start, stop, and restart commands will, as you
    might imagine, start, stop, and restart the Apache process respectively. You can
    also achieve the same functionality with the `apache2 init` script. Therefore,
    the three commands that do the same thing are as follows:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: '`/usr/sbin/apache2ctl` 程序是您在 Ubuntu 上管理 Apache 的主要命令行程序。该命令的语法相当简单。从命令行运行 `apache2ctl`
    并将一个命令作为参数传递给它。简单的启动、停止和重启命令，顾名思义，将分别启动、停止和重启 Apache 进程。您也可以通过 `apache2 init`
    脚本实现相同的功能。因此，执行相同操作的三个命令如下：'
- en: '[PRE17]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Stopping Apache gracefully
  id: totrans-128
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 优雅地停止 Apache
- en: There is a potential risk associated with the `restart` and `stop` commands.
    When you restart or stop Apache with these commands, all the currently running
    Apache processes are killed, even if they are in the middle of serving files to
    a user. If you issue a `restart` command when a user is in the middle of loading
    a page, it will only load as much information as it currently has and then stop
    loading a page, thus forcing users to reload the page. To avoid this, `apache2ctl`
    has provided the `graceful` and `graceful-stop` commands.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '`restart` 和 `stop` 命令存在潜在风险。当您使用这些命令重启或停止 Apache 时，所有当前运行的 Apache 进程都会被终止，即使它们正在为用户提供文件。如果您在用户正在加载页面时发出
    `restart` 命令，页面只会加载当前有的信息，然后停止加载，从而迫使用户重新加载页面。为了避免这种情况，`apache2ctl` 提供了 `graceful`
    和 `graceful-stop` 命令。'
- en: These commands restart and stop Apache respectively, but when they do, they
    wait for each process to finish the outstanding requests first. On an active site,
    a graceful restart won't even be noticed by anyone using the service. In general,
    unless you know that a site is not actively serving traffic (or unless you don't
    care whether all the active connections are closed), you should use `graceful`
    and `graceful-stop`. The only exception is when you add new SSL certificates to
    a site or make other changes that do require a full Apache restart to take effect.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 这些命令分别重新启动和停止 Apache，但在执行此操作时，它们会等待每个进程完成未完成的请求。在活动站点上，优雅重启对于正在使用服务的任何人来说甚至都不会被注意到。一般来说，除非你知道站点不会主动提供流量（或者你不在乎所有活动连接是否关闭），否则应该使用
    `graceful` 和 `graceful-stop`。唯一的例外是当你添加新的SSL证书到站点或进行其他需要完全重启Apache才能生效的更改时。
- en: Diagnostic apache2ctl commands
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 诊断 apache2ctl 命令
- en: The other main commands for `apache2ctl` provide more diagnostic features. The
    first, `configtest`, will test the current Apache configuration files for errors.
    This can be very useful in case you decide to automate the deployment of Apache
    scripts. When you set up a script to deploy configuration files and restart Apache,
    a challenge that you may face is that in case you have made a mistake in the configuration
    files, Apache might not start a back up. If you deploy the same file to the entire
    web farm, you may potentially bring the entire web farm down with a single syntax
    error and a script that blindly deploys and restarts Apache. With `configtest`,
    you can set up logic in your deployment scripts that restarts Apache once a server
    has passed the `configtest` command.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '`apache2ctl` 的其他主要命令提供了更多的诊断功能。首先，`configtest` 将测试当前的Apache配置文件是否存在错误。这在您决定自动部署Apache脚本时非常有用。当您设置脚本来部署配置文件并重新启动Apache时，您可能面临的挑战是，如果配置文件中出现错误，Apache可能不会启动备份。如果您将相同的文件部署到整个Web农场，那么一个语法错误和一个盲目部署和重启Apache的脚本可能会导致整个Web农场崩溃。通过
    `configtest`，您可以在部署脚本中设置逻辑，一旦服务器通过了 `configtest` 命令，就重新启动Apache。'
- en: As an Apache server gets traffic, you typically want to get diagnostic information
    from it, such as how many Apache processes are active, what those processes are
    doing, and how many open slots you still have available. The `status` and `fullstatus
    apache2ctl` commands provide you with a lot of great diagnostic data. The status
    command outputs a general-purpose overall status of the Apache server, including
    how long the server has been up, how many requests are active, and how many processes
    are idle. In addition to this, it outputs an ASCII art map of all the available
    processes with different letters representing different process states. The `fullstatus`
    command outputs similar information, with just more of it and in more detail.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 当Apache服务器获得流量时，您通常希望从中获取诊断信息，例如有多少个Apache进程处于活动状态，这些进程正在做什么以及您还有多少空闲槽可用。`status`
    和 `fullstatus apache2ctl` 命令为您提供了大量优秀的诊断数据。status 命令输出Apache服务器的通用整体状态，包括服务器已运行时间，有多少个请求处于活动状态以及有多少个进程处于空闲状态。除此之外，它还输出了一个ASCII艺术图，显示所有可用进程的地图，不同的字母代表不同的进程状态。`fullstatus`
    命令输出类似的信息，只是更详细。
- en: Deploying an e-mail server
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署电子邮件服务器
- en: Along with the Web, e-mail is probably the service that most people think of
    when they think of the Internet. Like web servers, e-mail servers have traditionally
    been pretty tricky to set up, and there are many guides and books on this subject.
    However, you will find that e-mail servers are pretty easy to set up and use under
    Ubuntu.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 与网络一同，电子邮件可能是大多数人在想到互联网时首先想到的服务。像网页服务器一样，电子邮件服务器传统上设置起来相当棘手，并且有许多关于此主题的指南和书籍。然而，在Ubuntu下设置和使用电子邮件服务器相当容易。
- en: Installing an e-mail server requires you to manage the sending and receiving
    of e-mails. These two notions are important because they implement two different
    protocols—**SMTP** to send, and **POP** or **IMAP** to receive the messages.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 安装电子邮件服务器要求您管理发送和接收电子邮件。这两个概念很重要，因为它们实现了两种不同的协议——**SMTP** 用于发送，**POP** 或 **IMAP**
    用于接收消息。
- en: When a user sends an e-mail it is in fact never in direct contact with the recipient.
    The e-mail goes through at least two servers that are, in order, the sending server
    (SMTP), called the **MTA** (**Mail Transfer Agent**), which sends it to the receiver
    server (POP or IMAP), called **MDA** (**Mail Delivery Agent**), possibly transiting
    the e-mail via other SMTP servers as well. Then, the e-mail will wait on this
    last server until the recipient launches its e-mail client (such as Thunderbird),
    which will retrieve the message from the receiving server via one of the two POP
    or IMAP protocols.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户发送电子邮件时，实际上并不是直接与接收方进行联系。电子邮件至少会经过两个服务器，顺序是发送服务器（SMTP），称为**MTA**（**邮件传输代理**），然后将邮件发送到接收服务器（POP
    或 IMAP），称为**MDA**（**邮件投递代理**），可能还会通过其他 SMTP 服务器中转电子邮件。然后，电子邮件将在这个最后的服务器上等待，直到接收方启动他们的电子邮件客户端（例如
    Thunderbird），并通过 POP 或 IMAP 协议从接收服务器中提取消息。
- en: Note
  id: totrans-138
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We can find all of these servers located on the same machine or different machines;
    it depends on the dimension of the e-mail server that you want to use.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将所有这些服务器安装在同一台机器上，也可以安装在不同的机器上，这取决于你想使用的电子邮件服务器的规模。
- en: Also note that to have a working e-mail server that sends and receives mails
    to and from the Internet, you should have a working DNS server with a valid domain
    name that you own.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 还要注意，为了让电子邮件服务器能够正常工作并与互联网进行收发邮件，你需要拥有一个有效的 DNS 服务器并且拥有一个有效的域名。
- en: If you would like to avoid assembling the different pieces of an e-mail server,
    and at the same time use a very powerful mailing server on Ubuntu, you can opt
    for a solution such as the famous Zimbra server. Explaining how to install and
    administrate Zimbra needs more than a section in a chapter. That's why I wrote
    a book about it named *Learning Zimbra Server Essentials*, Packt Publishing, in
    October 2013 (for more information, visit [https://www.packtpub.com/networking-and-servers/learning-zimbra-server-essentials](https://www.packtpub.com/networking-and-servers/learning-zimbra-server-essentials)).
    If you want, you can refer to it.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想避免自己组装电子邮件服务器的各个组件，同时又希望在 Ubuntu 上使用一个非常强大的邮件服务器，你可以选择一个像著名的 Zimbra 服务器这样的解决方案。解释如何安装和管理
    Zimbra 需要的不仅仅是章节中的一部分内容。这就是为什么我写了一本名为 *Learning Zimbra Server Essentials* 的书，Packt
    出版社出版，2013年10月发布（欲了解更多信息，请访问 [https://www.packtpub.com/networking-and-servers/learning-zimbra-server-essentials](https://www.packtpub.com/networking-and-servers/learning-zimbra-server-essentials)）。如果你愿意，你可以参考它。
- en: Now, let's discover how to handle every piece of the e-mail server.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们来看看如何处理电子邮件服务器的每个组件。
- en: The MTA server
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: MTA 服务器
- en: There are a lot of **Mail Transfer Agent** (**MTA**s) that can be deployed on
    an Ubuntu Server, but the most famous MTA one is **Postfix**, because it is a
    good, secure, and an easy-to-administer e-mail server. Besides, it is the default
    e-mail server that Ubuntu uses when you select **Mail server** in `tasksel`.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多可以在 Ubuntu 服务器上部署的**邮件传输代理**（**MTA**），但最著名的 MTA 是**Postfix**，因为它是一个安全、易于管理的好邮件服务器。此外，它是
    Ubuntu 在选择**邮件服务器**时默认使用的电子邮件服务器，选择方法是在 `tasksel` 中进行选择。
- en: Installing Postfix
  id: totrans-145
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装 Postfix
- en: 'Postfix can be installed with the same methods that are used by many of the
    other services that I mentioned in this chapter. You can choose **Mail server**
    either during the initial installation or when you run the `tasksel` program.
    Alternatively, you can use the following command:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: Postfix 可以使用与本章中提到的许多其他服务相同的方法进行安装。你可以在初始安装时选择**邮件服务器**，或在运行 `tasksel` 程序时选择。此外，你还可以使用以下命令：
- en: '[PRE18]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: When you install Postfix, the installer will launch the initial Postfix configuration
    script. It is an interactive program that provides you with a few standard common
    e-mail server configurations. Based on your choice, it will propose a few more
    options so that at the end of this process, you should at least have a functional
    e-mail server.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 当你安装 Postfix 时，安装程序将启动初始的 Postfix 配置脚本。这是一个交互式程序，它为你提供了一些常见的电子邮件服务器配置。根据你的选择，它会提出更多选项，最终使你至少能够拥有一个功能齐全的电子邮件服务器。
- en: 'First of all, it gives you an overview of the different configuration modes
    that you can adopt, as shown in the following screenshot:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，它给你一个不同配置模式的概览，你可以根据需要选择，如下图所示：
- en: '![Installing Postfix](img/B04800_03_04.jpg)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![安装 Postfix](img/B04800_03_04.jpg)'
- en: 'Then, it will give you the options to choose. In our case, we will choose **Internet
    site**, as shown in the following screenshot, so that we can directly send and
    receive e-mails using SMTP:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，它会给你选择的选项。在我们的例子中，我们将选择**Internet site**，如下图所示，这样我们就可以通过 SMTP 直接发送和接收电子邮件：
- en: '![Installing Postfix](img/B04800_03_05.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![安装 Postfix](img/B04800_03_05.jpg)'
- en: 'Finally, it asks you about the domain name that you will use for this e-mail
    server. This is the domain name that you will use to send e-mails. In our case,
    we will choose `ubuntu-essentials.net`, which will allow us to send mail such
    as `contact@ ubuntu-essentials.net`, as shown in the following screenshot:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，它会询问您将用于该邮件服务器的域名。这是您用来发送电子邮件的域名。在我们的例子中，我们选择 `ubuntu-essentials.net`，这将允许我们发送类似
    `contact@ ubuntu-essentials.net` 的邮件，如下图所示：
- en: '![Installing Postfix](img/B04800_03_06.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![安装 Postfix](img/B04800_03_06.jpg)'
- en: Keep in mind that although the e-mail server will function, you will need to
    perform some extra configurations if you want to add greylisting, spam/virus checking,
    IMAP or POP servers, or other advanced options.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，尽管邮件服务器能够正常工作，如果您想添加灰名单、垃圾邮件/病毒检查、IMAP 或 POP 服务器，或其他高级选项，您还需要进行一些额外的配置。
- en: Note
  id: totrans-156
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'During the installation process, you will be asked for only a few details.
    Therefore, to complete the customization of the other necessary parameters, such
    as the trusted subnets, the default mailbox size, and the root address, you can
    run the following command after finishing the installation process and follow
    the given steps:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，您只需提供少量信息。因此，为了完成其他必要参数的自定义设置，例如信任子网、默认邮箱大小和根地址，您可以在安装过程完成后运行以下命令并按照给定的步骤进行操作：
- en: '[PRE19]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Managing Postfix
  id: totrans-159
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 管理 Postfix
- en: There aren't too many surprises with Ubuntu's Postfix conventions. Most of the
    directories and files used by Postfix under Ubuntu follow the same structure on
    other platforms. For example, the `/etc/postfix/ directory` contains a majority
    of the Postfix configuration files, especially `/etc/postfix/main.cf`, where you
    can activate secure authentication using SSL, install TLS certificates for signature
    and encryption, and make use of a lot of other options. The `/var/spool/mail/`
    directory contains the users' mailboxes, and `/var/log/mail.*` are the log files.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu 的 Postfix 约定没有太多意外。Postfix 在 Ubuntu 下使用的大多数目录和文件与其他平台上的结构相同。例如，`/etc/postfix/`
    目录包含大多数 Postfix 配置文件，特别是 `/etc/postfix/main.cf`，在这里您可以启用 SSL 安全认证、安装 TLS 证书进行签名和加密，并使用许多其他选项。`/var/spool/mail/`
    目录包含用户的邮箱，而 `/var/log/mail.*` 是日志文件。
- en: 'The main tool that you will use to administer Postfix is aptly named postfix.
    It works much like `apache2ctl` in that it accepts a few different commands as
    arguments and can also be used as a substitute for the `init` script to start
    and stop the service. For instance, to stop Postfix and then start it again, type
    in the following command:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 您将用来管理 Postfix 的主要工具名为 postfix。它的工作方式与 `apache2ctl` 类似，接受多个不同的命令作为参数，也可以作为 `init`
    脚本的替代品来启动和停止服务。例如，要停止 Postfix 并重新启动它，请输入以下命令：
- en: '[PRE20]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'For other parameters and their explanation, you can get them from the `man`
    command via the following command:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 对于其他参数及其说明，您可以通过以下命令从 `man` 命令获取：
- en: '[PRE21]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'In addition to the Postfix command-line tool, Postfix provides a few other
    tools to help you with the administration of the services. The following are some
    of these tools:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 Postfix 命令行工具外，Postfix 还提供了一些其他工具来帮助您管理服务。以下是一些这些工具：
- en: The `postqueue` command can be used by regular users to get information about
    the current e-mail queue.
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`postqueue` 命令可以由普通用户用来获取当前邮件队列的信息。'
- en: The `postsuper` command allows a superuser to perform privileged operations
    on a queue.
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`postsuper` 命令允许超级用户对队列执行特权操作。'
- en: 'The `postconf` command outputs every Postfix setting to the screen along with
    its value. This can be very useful in case you modify the main `config` file and
    you would like to get the active running configuration before reloading. So for
    example, if you want to see the current value of `myhostname` in the running `config`
    file, we just have to type the following command:'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`postconf` 命令将每个 Postfix 设置及其值输出到屏幕上。如果您修改了主配置文件并希望在重新加载之前查看当前的运行配置，这将非常有用。例如，如果您想查看当前
    `config` 文件中 `myhostname` 的值，只需输入以下命令：'
- en: '[PRE22]'
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The MDA server
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: MDA 服务器
- en: Like for MTA, there is a lot of MDA software that exist under the official Ubuntu
    repositories and which differs in terms of complexity and functionalities besides
    the interoperability with other e-mail server components, such as Postfix. For
    this example, I will cover the Dovecot POP and IMAP servers, as they integrate
    well with Postfix, support Maildirs, and have a number of additional packages
    available that provide advanced features such as LDAP, MySQL, and Postgres support.
    The steps are pretty simple. They start with enabling Maildirs on Postfix and
    then installing Dovecot.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 像 MTA 一样，很多 MDA 软件也存在于官方的 Ubuntu 仓库中，它们在复杂性和功能性方面有所不同，此外，还与其他电子邮件服务器组件（如 Postfix）之间的互操作性也有差异。为了举例说明，我将介绍
    Dovecot POP 和 IMAP 服务器，因为它们与 Postfix 集成良好，支持 Maildirs，并且有很多附加软件包可供选择，这些软件包提供了如
    LDAP、MySQL 和 Postgres 支持等高级功能。步骤相当简单，从在 Postfix 上启用 Maildirs 开始，然后安装 Dovecot。
- en: 'Maildir is a specific directory structure that is used to save e-mails instead
    of the traditional manner of using the `mbox` format. It should be enabled on
    Postfix by setting the `home_mailbox` variable inside the `/etc/postfix/main.cf`
    file, as follows:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: Maildir 是一种特定的目录结构，用来保存电子邮件，而不是传统的使用 `mbox` 格式的方式。它应通过设置 `/etc/postfix/main.cf`
    文件中的 `home_mailbox` 变量来在 Postfix 上启用，具体如下：
- en: '[PRE23]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Alternatively, to enable it, you can just run the following command:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，要启用它，你只需运行以下命令：
- en: '[PRE24]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'You should of course reload `postfix` after this step by using the following
    command:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，在这一步之后，你应该通过以下命令重新加载 `postfix`：
- en: '[PRE25]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Then, move on to install Dovecot by using the following command:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，通过以下命令安装 Dovecot：
- en: '[PRE26]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: This will install and enable POP, POP with SSL, IMAP, and IMAP with SSL.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 这将安装并启用 POP、POP 带 SSL、IMAP 和 IMAP 带 SSL。
- en: After this, you can customize Dovecot by using the main `/etc/dovecot/dovecot.conf
    config` file. Don't forget to reload the daemon every time you modify the `config`
    file using the `sudo /etc/init.d/dovecot reload` command to implement the changes.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 安装后，你可以通过主配置文件 `/etc/dovecot/dovecot.conf` 来定制 Dovecot。每次修改 `config` 文件时，不要忘记使用
    `sudo /etc/init.d/dovecot reload` 命令重新加载守护进程，以实施更改。
- en: 'The next step is to tell Dovecot to use Maildirs and also let it know where
    it can find them on the system. To do this, check whether there is already an
    uncommented line that starts with `mail_location` (in the default installation,
    it''s commented out). If it doesn''t exist, then add the following line; if it
    does exist, then modify the `mail_location` line so that it looks like the following
    line:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是告诉 Dovecot 使用 Maildirs，并且让它知道在哪里可以找到它们。在此过程中，检查是否已经有一个未被注释的以 `mail_location`
    开头的行（在默认安装中，它是被注释掉的）。如果不存在，那么添加以下行；如果存在，则修改 `mail_location` 行，使其看起来像下面的行：
- en: '[PRE27]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Then, reload Dovecot by using the `sudo /etc/init.d/dovecot reload` command.
    Now, you should be able to configure e-mail clients to point to the server and
    access their local e-mail.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，通过 `sudo /etc/init.d/dovecot reload` 命令重新加载 Dovecot。现在，你应该能够配置电子邮件客户端指向服务器并访问其本地电子邮件。
- en: Filters and security for an e-mail server
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 电子邮件服务器的过滤器和安全性
- en: 'Today, **Unsolicited Bulk Email** (**UBE**) represents one of the largest problems
    for e-mail servers. Also known as **spam**, such messages may also carry viruses
    and other forms of malware. To handle this issue, there are a lot of powerful
    utilities that can be installed on an Ubuntu Server and integrated with an e-mail
    server. The following is a list of the best utilities:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 今天，**未请求的大宗电子邮件**（**UBE**）已经成为电子邮件服务器面临的最大问题之一。也被称为 **垃圾邮件**，这些信息还可能携带病毒和其他形式的恶意软件。为了解决这个问题，有许多强大的工具可以安装在
    Ubuntu 服务器上并与电子邮件服务器集成。以下是一些最好的工具列表：
- en: '**Amavisd-new** is a generic scanner program. Its role is to call a certain
    number of content filtering tools such as antivirus, spam detection, and so on.
    You can install it by using the following command:'
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Amavisd-new** 是一个通用的扫描程序。它的作用是调用若干内容过滤工具，如病毒扫描、垃圾邮件检测等。你可以通过以下命令安装它：'
- en: '[PRE28]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'To configure it, you have to first of all activate antivirus and anti-spam
    detection in Amavisd-new by editing the `/etc/amavis/conf.d/15-content_filter_mode`
    file and uncommenting some lines, as described in the file itself. To customize
    Amavisd-new, you can edit options in the `config` files under the `/etc/amavis/conf.d/`
    directory. Don''t forget to restart the daemon by using the following command:'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要配置它，你首先需要通过编辑`/etc/amavis/conf.d/15-content_filter_mode`文件并取消注释其中的一些行来激活Amavisd-new中的防病毒和反垃圾邮件检测功能，文件中有详细说明。要自定义Amavisd-new，你可以编辑`/etc/amavis/conf.d/`目录下的`config`文件中的选项。别忘了通过以下命令重新启动守护进程：
- en: '[PRE29]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'For integration with Postfix, you have to enter the following command:'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 若要与Postfix集成，你需要输入以下命令：
- en: '[PRE30]'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Then, edit `/etc/postfix/master.cf` by adding the following to the end of the
    file:'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 然后，通过在文件末尾添加以下内容来编辑`/etc/postfix/master.cf`文件：
- en: '[PRE31]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'To prevent messages that are generated to report spam from being classified
    as spam, add the following two lines immediately below the pickup transport service:'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了防止生成的报告垃圾邮件的消息被误分类为垃圾邮件，请在pickup传输服务下方立即添加以下两行：
- en: '[PRE32]'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Finally, restart Postfix by using the following command:'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 最后，通过以下命令重新启动Postfix：
- en: '[PRE33]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: At this step, content filtering with spam and virus detection is enabled.
  id: totrans-199
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此步骤中，已启用垃圾邮件和病毒检测的内容过滤。
- en: '**Spamassassin** is the most used open source anti-spam program in the world
    today. It uses a variety of mechanisms to filter e-mails based on message content.
    You can install it via the `sudo apt-get install spamassassin` command. To activate
    the `spamassassin` daemon, you have to change the value of the enabled parameter
    from *0* to *1* in the `/etc/default/spamassassin` file. Then, start the daemon
    by using the following command:'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Spamassassin**是目前世界上使用最广泛的开源反垃圾邮件程序。它利用多种机制根据邮件内容过滤电子邮件。你可以通过`sudo apt-get
    install spamassassin`命令来安装它。要启动`spamassassin`守护进程，你需要在`/etc/default/spamassassin`文件中将enabled参数的值从*0*更改为*1*。然后，使用以下命令启动守护进程：'
- en: '[PRE34]'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '**ClamAV** is the most known open source antivirus application. You can install
    it by using the `sudo apt-get install clamav-daemon` command. The default configuration
    of ClamAV fits our needs. Therefore, we can start working with it. However, you
    can customize it by using the `config` files in `/etc/clamav`.'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ClamAV**是最著名的开源防病毒应用程序。你可以使用`sudo apt-get install clamav-daemon`命令来安装它。ClamAV的默认配置符合我们的需求，因此我们可以开始使用它。然而，你也可以通过编辑`/etc/clamav`中的`config`文件进行自定义配置。'
- en: Tip
  id: totrans-203
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'You need to add the ClamAV and Amavis users to each other''s groups in order
    for Amavisd-new to have appropriate access to scan files and prevent ownership
    issues from inhibiting scans, as follows:'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你需要将ClamAV和Amavis用户添加到彼此的用户组中，以便Amavisd-new能够获得适当的访问权限，扫描文件并避免因所有权问题而阻碍扫描，具体操作如下：
- en: '[PRE35]'
  id: totrans-205
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '**Postgrey** is a program that implements greylisting for the Postfix server.
    **Greylisting** is a technique that helps you cut down on the amount of spam a
    server receives. You can install it by using the `sudo apt-get install postgrey`
    command. For its configuration, all that you have to do is modify the `smtpd_recipient_restrictions`
    option in Postfix''s `main.cf` file to add the `localhost:10023` service.'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Postgrey**是一个为Postfix服务器实现灰名单的程序。**灰名单**是一种帮助减少服务器收到的垃圾邮件量的技术。你可以通过使用`sudo
    apt-get install postgrey`命令来安装它。对于其配置，你只需修改Postfix的`main.cf`文件中的`smtpd_recipient_restrictions`选项，添加`localhost:10023`服务。'
- en: 'The **OpenDKIM** implements a **Sendmail Mail Filter** (**Milter**) for the
    **DomainKeys Identified Mail** (**DKIM**) standard, and `python-postfix-policyd-spf`
    enables **Sender Policy Framework** (**SPF**) to check it with Postfix. You can
    install OpenDKIM via the following command:'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**OpenDKIM**实现了**Sendmail邮件过滤器**（**Milter**）用于**DomainKeys Identified Mail**（**DKIM**）标准，而`python-postfix-policyd-spf`则启用**发送者策略框架**（**SPF**）与Postfix进行检查。你可以通过以下命令安装OpenDKIM：'
- en: '[PRE36]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: To get more knowledge about this subject, visit [https://mandrill.zendesk.com/hc/en-us/articles/205582267-What-are-SPF-and-DKIM-and-how-do-I-set-them-up-](https://mandrill.zendesk.com/hc/en-us/articles/205582267-What-are-SPF-and-DKIM-and-how-do-I-set-them-up-).
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要了解更多关于这个主题的知识，请访问[https://mandrill.zendesk.com/hc/en-us/articles/205582267-What-are-SPF-and-DKIM-and-how-do-I-set-them-up-](https://mandrill.zendesk.com/hc/en-us/articles/205582267-What-are-SPF-and-DKIM-and-how-do-I-set-them-up-)。
- en: The **Spamassassin** process can be enhanced by using some optional packages
    that integrate with it, for better spam detection. We can install these packages
    by using the `sudo apt-get install pyzor razor` command. Spamassassin automatically
    detects optional components and will use these components if they are present.
    So, there is no need to configure `pyzor` and `razor`.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Spamassassin** 进程可以通过使用与其集成的一些可选软件包来增强，从而提高垃圾邮件检测效果。我们可以通过使用 `sudo apt-get
    install pyzor razor` 命令安装这些软件包。Spamassassin 会自动检测可选组件，并在组件存在时使用它们。所以，不需要配置 `pyzor`
    和 `razor`。'
- en: 'To filter e-mail attachments, we need the main filtering application''s compression
    utilities, which can be installed by using the following command:'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要过滤电子邮件附件，我们需要主过滤应用程序的压缩工具，可以使用以下命令安装：
- en: '[PRE37]'
  id: totrans-212
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Other facilities
  id: totrans-213
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 其他功能
- en: 'After installing an e-mail server, you can use it by configuring an e-mail
    client such as Thunderbird or Evolution. You can also access it via the Web if
    you have already installed a webmail client. There are a lot of webmail clients
    that you can install. All that you need is a working MTA and MDA, along with a
    web server. We have covered these topics in the previous sections. Then, you should
    install the webmail solution and configure it to work with your e-mail server.
    You can choose a solution from SquirrelMail, Horde, OpenWebMail, and Roundcube.
    As an example, we will install and configure Roundcube. To do this, you need to
    run the `sudo apt-get install roundcube-mysql roundcube` command. Then, edit the
    `/etc/roundcube/apache.conf` file and uncomment the following two lines:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完邮件服务器后，你可以通过配置 Thunderbird 或 Evolution 等电子邮件客户端来使用它。如果你已经安装了 Webmail 客户端，也可以通过
    Web 访问它。你可以安装许多 Webmail 客户端。你需要的只是一个正常工作的 MTA 和 MDA，以及一个 Web 服务器。我们在之前的章节中已经讨论过这些话题。然后，你应该安装
    Webmail 解决方案，并配置它与电子邮件服务器配合使用。你可以选择 SquirrelMail、Horde、OpenWebMail 和 Roundcube
    中的任何一种解决方案。作为示例，我们将安装并配置 Roundcube。为此，你需要运行 `sudo apt-get install roundcube-mysql
    roundcube` 命令。然后，编辑 `/etc/roundcube/apache.conf` 文件并取消注释以下两行：
- en: '[PRE38]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Finally, restart Apache by using the following command:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，通过使用以下命令重启 Apache：
- en: '[PRE39]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: You can now access your webmail via `<domaine-name>/roundcube`. In our case,
    it is `www.buntu-essentials.net/roundcube`.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以通过 `<domaine-name>/roundcube` 访问你的 Webmail。在我们的例子中，它是 `www.buntu-essentials.net/roundcube`。
- en: You can also install a mass mailing manager (a mailing list manager), such as
    the famous mailman, and configure it to work with the e-mail server in a manner
    that is similar to how you installed and configured the webmail client.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以安装一个批量邮件管理器（邮件列表管理器），如著名的 mailman，并将其配置为与电子邮件服务器配合工作，方式与安装和配置 Webmail 客户端类似。
- en: Setting up a database server
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置数据库服务器
- en: Databases are also one of most used services that every system administrator
    deals with every day. With the Ubuntu Server, installing and managing databases
    is quite simple. We previously saw how to install a MySQL database within a LAMP
    server. In this section, we will see how to do that as a separate action. We will
    also see how to install and manage another commonly used Open Source database
    server named Postgres.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库也是每个系统管理员每天都要处理的常用服务之一。在 Ubuntu Server 上，安装和管理数据库非常简单。我们之前已经看到如何在 LAMP 服务器中安装
    MySQL 数据库。在本节中，我们将看到如何单独完成这项操作。我们还将看到如何安装和管理另一种常用的开源数据库服务器——Postgres。
- en: The MySQL server
  id: totrans-222
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: MySQL 服务器
- en: 'It is easy to install the MySQL database on Ubuntu, just run the following
    command:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Ubuntu 上安装 MySQL 数据库非常简单，只需运行以下命令：
- en: '[PRE40]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: You will be asked to enter the root password. You can leave it empty, but I
    recommend that you set one, and a good one (a strong password) is better.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 系统会要求你输入 root 密码。你可以留空，但我建议你设置一个密码，并且设置一个强密码会更好。
- en: For customization tasks, you can find the MySQL main configuration files under
    `/etc/mysql/`.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 对于定制任务，你可以在 `/etc/mysql/` 目录下找到 MySQL 的主配置文件。
- en: 'Ubuntu includes the `mysqladmin` tool to help you with MySQL administration.
    You can think of it as the `apache2ctl` program in that it accepts certain commands
    on the command line and then interacts with the `mysqld` process for you. For
    instance, to get the current status of your MySQL process, run the following command:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu 包含了 `mysqladmin` 工具，帮助你进行 MySQL 管理。你可以把它看作是 `apache2ctl` 程序，因为它接受命令行中的特定命令，然后与你的
    `mysqld` 进程进行交互。例如，要获取 MySQL 进程的当前状态，运行以下命令：
- en: '[PRE41]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Note
  id: totrans-229
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'I used the `-p` argument in this command, which will tell `mysqladmin` to prompt
    me for the password on the command line. If you set a password for the root user,
    you will need to use `-p` with your commands. However, if you plan to run a batch
    of commands and don''t want to enter the password every time, you can add the
    password to the `-p` option. So for instance, if the MySQL password was myP@ssword,
    type the following command:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 我在此命令中使用了 `-p` 参数，这会告诉 `mysqladmin` 在命令行上提示我输入密码。如果你为 root 用户设置了密码，那么在执行命令时需要使用
    `-p`。然而，如果你打算运行一批命令并且不想每次都输入密码，你可以将密码添加到 `-p` 选项中。例如，如果 MySQL 密码是 myP@ssword，请输入以下命令：
- en: '[PRE42]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The `mysqladmin` manual page (type man mysqladmin on a console) lists the full
    set of commands.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: '`mysqladmin` 手册页面（在控制台中输入 man mysqladmin）列出了完整的命令集。'
- en: Note
  id: totrans-233
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The easiest way to manage a MySQL database is by using the phpMyAdmin utility.
    Have a look at how to install and configure it in the section named *Web Server*
    in this chapter.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 管理 MySQL 数据库最简单的方法是使用 phpMyAdmin 工具。请查看本章 *Web 服务器* 部分中关于如何安装和配置它的内容。
- en: The Postgre server
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Postgre 服务器
- en: 'Even though MySQL has the reputation of being easy to use, PostgreSQL under
    Ubuntu is also simple to install and use. To install PostgreSQL, you can either
    select **PostgreSQL Server** as you install Ubuntu or do so afterwards with `tasksel`,
    or use a package manager to install the `postgresql` package, as follows:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管 MySQL 因易于使用而闻名，但在 Ubuntu 上安装和使用 PostgreSQL 同样简单。要安装 PostgreSQL，你可以在安装 Ubuntu
    时选择 **PostgreSQL 服务器**，或者事后使用 `tasksel`，也可以通过包管理器安装 `postgresql` 包，如下所示：
- en: '[PRE43]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Once the `postgresql` package has been installed, the database service will
    start in the background and you can then set up your superuser account and create
    a database. The initial administration will be performed by the `postgres` user.
    So first, use `sudo` to become that user by using the following command:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 `postgresql` 包后，数据库服务将在后台启动，然后你可以设置超级用户账户并创建数据库。初始的管理工作将由 `postgres` 用户执行。因此，首先使用
    `sudo` 切换到该用户，执行以下命令：
- en: '[PRE44]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Now, from this shell, you can create a new user account by using the `createuser`
    program. On the other hand, the `dropuser` command deletes users. Creating databases
    is done via the `createdb` program, and accessing the database is done via the
    `psql` command.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在这个 shell 中，你可以使用 `createuser` 程序创建一个新用户账户。另一方面，`dropuser` 命令用于删除用户。创建数据库使用
    `createdb` 程序，访问数据库使用 `psql` 命令。
- en: 'As with MySQL, there is a PHP-based administration tool called **phpPgAdmin**.
    To install phpPgAdmin, you simply need to install the `phppgadmin` package, as
    follows:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 与 MySQL 一样，也有一个基于 PHP 的管理工具叫做 **phpPgAdmin**。要安装 phpPgAdmin，你只需要安装 `phppgadmin`
    包，如下所示：
- en: '[PRE45]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'The package will download all of its dependencies, including a web server,
    in case one is not already installed. Once the package is installed, create a
    symlink to its Apache configuration file under `/etc/apache2/sites-available`
    and then use `a2ensite` to enable the site, as follows:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 该包将下载所有依赖项，包括一个 Web 服务器，以防未安装一个。安装包后，创建指向其 Apache 配置文件的符号链接，位于 `/etc/apache2/sites-available`，然后使用
    `a2ensite` 启用该站点，如下所示：
- en: '[PRE46]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Setting up a DHCP server
  id: totrans-245
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 DHCP 服务器
- en: '**DHCP** stands for **Dynamic Host Control Protocol**. With this protocol,
    a new host on the network can issue a request for IP information. The DHCP server
    will then provide the host with all the necessary information that it needs to
    communicate on the network, such as its IP address, netmask, the gateway, and
    the DNS servers that need to be used.'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: '**DHCP** 代表 **动态主机配置协议**。通过此协议，网络上的新主机可以请求 IP 信息。DHCP 服务器随后会为主机提供它所需的所有通信信息，例如
    IP 地址、子网掩码、网关和需要使用的 DNS 服务器。'
- en: Installing DHCP
  id: totrans-247
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 DHCP
- en: 'Installing a DHCP server under Ubuntu is an easy task, just type the following
    command and you will get the DHCP server installed:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Ubuntu 上安装 DHCP 服务器是一项简单的任务，只需输入以下命令，你就可以安装 DHCP 服务器：
- en: '[PRE47]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: Ubuntu DHCP Conventions
  id: totrans-250
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Ubuntu DHCP 约定
- en: 'It just needs additional configuration to be useful; we will see this in this
    section:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 它只需要额外的配置才能发挥作用；我们将在本节中看到这一点：
- en: '`/etc/dhcp3/dhcpd.conf`: This is the configuration file for the DHCP server.
    By default, it is a heavily commented file that should provide plenty of examples
    for you to work on.'
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/etc/dhcp3/dhcpd.conf`：这是 DHCP 服务器的配置文件。默认情况下，它是一个带有大量注释的文件，应该为你提供许多示例以供参考。'
- en: '`/var/lib/dhcp3/dhcpd.leases`: This file contains the current list of DHCP
    leases that your server has handed out. If you are wondering which MAC address
    got a particular IP or when a particular lease will expire, look in this file.'
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/lib/dhcp3/dhcpd.leases`: 此文件包含服务器分发的当前 DHCP 租约列表。如果您想知道哪个 MAC 地址获取了特定的
    IP 或者特定租约何时到期，请查看此文件。'
- en: '`/var/log/syslog`: DHCP uses the standard `syslog` file for all of its logs.
    Here, you will be able to find requests from the network for a DHCP request along
    with the DHCP server''s reply.'
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/log/syslog`: DHCP 使用标准的 `syslog` 文件记录其所有日志。在这里，您将能够找到来自网络的 DHCP 请求以及
    DHCP 服务器的回复。'
- en: Configuring DHCP
  id: totrans-255
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 DHCP
- en: Ubuntu provides a heavily commented DHCP configuration file that explains all
    the major options and gives a number of different configuration examples. For
    basic DHCP services, you generally want to set up one or possibly two scenarios—**dynamic
    DHCP** and **static DHCP**. In a dynamic DHCP configuration, new hosts get assigned
    an IP out of a possible range of IPs. There's no guarantee that a host will get
    assigned the same IP every time. With static DHCP, you can bind a particular IP
    address to a host's MAC address and ensure that every time it shows up on the
    network, it will get the same IP. Dynamic DHCP is good for a simple, easy-to-maintain
    DHCP server, and static DHCP gives you many benefits of static IPs without nearly
    as many headaches. Plus with static IPs, if you do want to change the IP address
    of a host, you can do so in the `dhcpd.conf` file and reload DHCP instead of having
    to track down and change the host.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu 提供了一个详细注释的 DHCP 配置文件，解释了所有主要选项并提供了多个不同的配置示例。对于基本的 DHCP 服务，通常您希望设置一个或两个场景——**动态
    DHCP** 和 **静态 DHCP**。在动态 DHCP 配置中，新主机将从可能的 IP 范围中分配一个 IP。不能保证每个主机每次都分配相同的 IP。使用静态
    DHCP，您可以将特定的 IP 地址绑定到主机的 MAC 地址，并确保每次它出现在网络上时都会获取相同的 IP。动态 DHCP 适用于简单易于维护的 DHCP
    服务器，而静态 DHCP 则提供了静态 IP 的许多好处，而几乎没有太多麻烦。另外，对于静态 IP，如果您确实想要更改主机的 IP 地址，您可以在 `dhcpd.conf`
    文件中执行此操作并重新加载 DHCP，而不必跟踪并更改主机。
- en: 'Now, to reload DHCP and enable my settings, run the following command:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为了重新加载 DHCP 并启用我的设置，请运行以下命令：
- en: '[PRE48]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: In case you didn't make a syntax error, the DHCP server will stop and then start
    again. If there is an error in the file, it should output an error to the screen
    along with its location. A common error is a missing semicolon at the end of a
    particular line.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有出现语法错误，DHCP 服务器将会停止然后重新启动。如果文件中存在错误，它应该在屏幕上输出错误以及其位置。一个常见的错误是在特定行的末尾缺少分号。
- en: Installing a file server
  id: totrans-260
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装文件服务器
- en: This is the last section in this chapter. In this section, we will discover
    how to install and configure, on an Ubuntu Server, two of the most used file servers—**FTP**
    and **Samba**.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 这是本章的最后一节。在本节中，我们将了解如何在 Ubuntu 服务器上安装和配置两种最常用的文件服务器——**FTP** 和 **Samba**。
- en: The FTP server
  id: totrans-262
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: FTP 服务器
- en: 'The `vsftpd` is an FTP daemon available in Ubuntu. It is easy to install, set
    up, and maintain. To install `vsftpd`, run the following command:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '`vsftpd` 是 Ubuntu 中提供的 FTP 守护程序。它易于安装、设置和维护。要安装 `vsftpd`，请运行以下命令：'
- en: '[PRE49]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'The `/etc/vsftpd.conf` file contains the main configuration options for the
    FTP server. It is well commented. Therefore, you can edit it easily. After the
    `config` modification, you should restart the server by using the following command:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '`/etc/vsftpd.conf` 文件包含 FTP 服务器的主要配置选项。它有很好的注释。因此，您可以轻松地进行编辑。在修改配置之后，您应该使用以下命令重启服务器：'
- en: '[PRE50]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Connecting to the FTP server is quite easy. You can do so either by using the
    FTP command in the CLI of the customer machine or a client GUI program such as
    FileZilla.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 连接到 FTP 服务器非常简单。您可以通过在客户机的 CLI 中使用 FTP 命令或者像 FileZilla 这样的客户端 GUI 程序来进行连接。
- en: Note
  id: totrans-268
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: With FTP, data is transmitted unencrypted over the network. To transmit data
    securely, you can either use the FTPS protocol (FTP over SSL), or advantageously
    turn to **SFTP** (**SSH File Transfer Protocol**).
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 FTP 时，数据通过网络以未加密的方式传输。要安全地传输数据，您可以使用 FTPS 协议（FTP over SSL），或者更好地转向**SFTP**（**SSH
    文件传输协议**）。
- en: The Samba server
  id: totrans-270
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Samba 服务器
- en: '**Samba** is a program that implements SMB and CIFS, the Windows file-sharing
    protocols. As such, it''s ideal as a platform to share file under Windows, since
    all the clients can access the server without additional software. Over time,
    Samba has grown to support advanced sections of Windows file sharing to a point
    where it can operate like any other Windows file server or **Primary Domain Controller**
    (**PDC**).'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '**Samba** 是一个实现 SMB 和 CIFS 协议的程序，这些是 Windows 文件共享协议。因此，它非常适合作为 Windows 下共享文件的平台，因为所有客户端都可以无需额外软件即可访问服务器。随着时间的推移，Samba
    已经发展成支持 Windows 文件共享的高级功能，甚至能够像其他 Windows 文件服务器或 **主域控制器**（**PDC**）一样工作。'
- en: 'To install Samba, you can either select the **Samba Server** option during
    the Ubuntu installation or after the installation with the help of the `tasksel`
    program, or install the `samba`, `samba-doc`, `smbfs`, and `winbind` packages
    separately with the help of the package manager, as follows:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 Samba，你可以在安装 Ubuntu 时选择 **Samba 服务器** 选项，或者在安装后通过 `tasksel` 程序帮助安装，或者通过包管理器单独安装
    `samba`、`samba-doc`、`smbfs` 和 `winbind` 包，具体方法如下：
- en: '[PRE51]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: The Samba service will start automatically. By default, of course nothing too
    interesting will be shared. So, you will need to tweak Samba's configuration files
    before any directories are shared. The main configuration files are located under
    the `/etc/samba/` directory, especially the core configuration file named `/etc/samba/smb.conf`.
    This file is heavily commented, and it contains a number of different examples
    of how to set up shares, including a useful example configuration.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: Samba 服务将自动启动。当然，默认情况下并不会共享任何有趣的内容。因此，你需要在共享任何目录之前调整 Samba 的配置文件。主要的配置文件位于 `/etc/samba/`
    目录下，特别是名为 `/etc/samba/smb.conf` 的核心配置文件。该文件有大量注释，并包含了多个不同的共享设置示例，其中包括一个有用的配置示例。
- en: After installing and configuring the Samba server, go to another host on the
    network and attempt to connect to the Samba server. On an Ubuntu desktop, navigate
    to **Places** | **Connect to Server**. Then, select **Windows share** from the
    **Service type** drop-down menu. Finally, enter the IP address or hostname of
    the Samba server and then enter the name that you put between the brackets in
    the `smb.conf` file for the name of the share. Click on **Connect**. Ubuntu will
    mount and display the mounted share on the desktop.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 安装并配置好 Samba 服务器后，去网络上的另一台主机尝试连接 Samba 服务器。在 Ubuntu 桌面上，导航至 **位置** | **连接到服务器**。然后，从
    **服务类型** 下拉菜单中选择 **Windows 共享**。最后，输入 Samba 服务器的 IP 地址或主机名，然后输入你在 `smb.conf` 文件中方括号之间的共享名称。点击
    **连接**。Ubuntu 将挂载并在桌面显示该共享。
- en: Summary
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we went in depth in terms of deploying services on an Ubuntu
    Server. We discussed how to install and configure some of the most used servers
    that every system administrator will usually deal with.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们深入讨论了在 Ubuntu 服务器上部署服务的相关内容。我们讨论了如何安装和配置一些系统管理员通常会处理的最常用的服务器。
- en: In the next chapter, we will move on to the security aspect of an Ubuntu Server.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨 Ubuntu 服务器的安全性方面。
