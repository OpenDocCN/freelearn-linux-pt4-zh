<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Troubleshooting Database Services"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Troubleshooting Database Services</h1></div></div></div><p>Database services <a id="id319" class="indexterm"/>play a vital role within today's corporate infrastructure, and yet this chapter is not aimed at programmers, database administrators, or developers. Instead, the following pages will take the alternative point of view in order to develop the conversation for system administrators and troubleshooters who are primarily working with CentOS 7. So, let's begin our journey by looking at some of the more common problems associated with databases as a whole in order to provide a troubleshooter's guide to MariaDB, MySQL, and PostgreSQL.</p><p>In this chapter, we will:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learn how to get up-and-running with MariaDB on CentOS 7</li><li class="listitem" style="list-style-type: disc">Learn how to reset and recover a lost password for the root user with MariaDB</li><li class="listitem" style="list-style-type: disc">Learn how to tune both MariaDB and MySQL server with <code class="literal">mysqltuner</code></li><li class="listitem" style="list-style-type: disc">Discover how to run metrics across the MariaDB and MySQL servers</li><li class="listitem" style="list-style-type: disc">Learn how to remove MariaDB and return to the MySQL server</li><li class="listitem" style="list-style-type: disc">Learn how to install and configure PostgreSQL on CentOS 7</li></ul></div><div class="section" title="Getting up-and-running with MariaDB"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec74"/>Getting up-and-running with MariaDB</h1></div></div></div><p>In the latest release of CentOS, you <a id="id320" class="indexterm"/>will find that MariaDB has replaced MySQL. It is correct to say that there are similarities between the two database systems, but it is also important to recognize that they are both very different systems. Based on this premise, a typical issue often begins at the point of installation, where the following message may prove to be more than uncomfortable:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Redirecting to /bin/systemctl start  mysqld.service. </strong></span>
<span class="strong"><strong>Failed to issue method call: Unit mysqld.service failed to load: No such file or directory.</strong></span>
</pre></div><p>In this case, your first action is to verify what is currently installed. This can be achieved by running one or more of the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># which mysql</strong></span>
<span class="strong"><strong># ls -la /bin/my*</strong></span>
<span class="strong"><strong># ps -ef | grep mysql</strong></span>
</pre></div><p>However, given that the output will seem to be misleading to the untrained eye, this issue provides a point of confusion, and it happens as a result of trying to run the MySQL installation and startup commands. Yes, it is an easy mistake to make, and the most effective means of troubleshooting this issue is to explore the correct way of installing MariaDB.</p><p>To <a id="id321" class="indexterm"/>install MariaDB, you should use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># yum install mariadb mariadb-server</strong></span>
</pre></div><p>To start the MariaDB service, simply execute the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl start mariadb.service</strong></span>
<span class="strong"><strong># systemctl enable mariadb.service</strong></span>
</pre></div><p>The output of which will result in:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ln -s '/usr/lib/systemd/system/mariadb.service' '/etc/systemd/system/multi-user.target.wants/mariadb.service'</strong></span>
</pre></div><p>To complete the installation, you should now run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysql_secure_installation</strong></span>
</pre></div><p>Remember, you have not set a password at this stage. So, when prompted, just press the <span class="emphasis"><em>return</em></span> key to signify that there is no current password and complete the secure installation process by following the prompts as required. As an addition to this, you may also see the following error message:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/usr/bin/mysql_secure_installation: line 379: find_mysql_client: command not found</strong></span>
</pre></div><p>This message can be safely ignored as it represents an outstanding bug associated with Fedora 19 (see the references at the end of this chapter for Red Hat Bugzilla - Bug 1020055).</p><p>The complete <code class="literal">mysql_secure_installation</code> procedure runs as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB. SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!</strong></span>

<span class="strong"><strong>In order to log into MariaDB to secure it, we'll need the current</strong></span>
<span class="strong"><strong>password for the root user. If you've just installed MariaDB, and</strong></span>
<span class="strong"><strong>you haven't set the root password yet, the password will be blank,</strong></span>
<span class="strong"><strong>so you should just press enter here.</strong></span>

<span class="strong"><strong>Enter current password for root (enter for none): type enter</strong></span>
<span class="strong"><strong>OK, successfully used password, moving on...</strong></span>

<span class="strong"><strong>Setting the root password ensures that nobody can log into the MariaDB root user without the proper authorisation.</strong></span>

<span class="strong"><strong>Set root password? [Y/n] &lt;Y&gt;</strong></span>
<span class="strong"><strong>New password: your-password</strong></span>
<span class="strong"><strong>Re-enter new password: your-password</strong></span>
<span class="strong"><strong>Password updated successfully!</strong></span>
<span class="strong"><strong>Reloading privilege tables..</strong></span>
<span class="strong"><strong>... Success!</strong></span>

<span class="strong"><strong>By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment.</strong></span>

<span class="strong"><strong>Remove anonymous users? [Y/n] &lt;Y&gt;</strong></span>
<span class="strong"><strong>... Success!</strong></span>

<span class="strong"><strong>Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network.</strong></span>

<span class="strong"><strong>Disallow root login remotely? [Y/n] &lt;Y&gt;</strong></span>
<span class="strong"><strong>... Success!</strong></span>

<span class="strong"><strong>By default, MariaDB comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment.</strong></span>

<span class="strong"><strong>Remove test database and access to it? [Y/n] &lt;Y&gt;</strong></span>
<span class="strong"><strong>- Dropping test database...</strong></span>
<span class="strong"><strong>... Success!</strong></span>
<span class="strong"><strong>- Removing privileges on test database...</strong></span>
<span class="strong"><strong>... Success!</strong></span>

<span class="strong"><strong>Reloading the privilege tables will ensure that all changes made so far will take effect immediately.</strong></span>

<span class="strong"><strong>Reload privilege tables now? [Y/n] &lt;Y&gt;</strong></span>
<span class="strong"><strong>... Success!</strong></span>

<span class="strong"><strong>Cleaning up...</strong></span>

<span class="strong"><strong>All done! If you've completed all of the above steps, your MariaDB</strong></span>
<span class="strong"><strong>installation should now be secure.</strong></span>

<span class="strong"><strong>Thanks for using MariaDB!</strong></span>
</pre></div><p>From this point on, everything <a id="id322" class="indexterm"/>should feel familiar once again and you can begin by checking the status of MariaDB at any time with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl status mariadb.service</strong></span>
</pre></div></div></div>
<div class="section" title="Resetting and recovering a root password with MariaDB"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec75"/>Resetting and recovering a root password with MariaDB</h1></div></div></div><p>The act of <a id="id323" class="indexterm"/>resetting a root password provides true currency for a system troubleshooter. It can happen—and yes, it does happen more times <a id="id324" class="indexterm"/>than you can imagine—but by following the <a id="id325" class="indexterm"/>next few steps, a crisis can be averted.</p><p>To begin, you<a id="id326" class="indexterm"/> will need to stop the MariaDB service like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl stop mariadb.service</strong></span>
</pre></div><p>The next step is to activate "safe mode" in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysqld_safe --skip-grant-tables --skip-networking</strong></span>
</pre></div><p>Now run the following sequence to access the MySQL console and connect to the database:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysql -u root</strong></span>
<span class="strong"><strong># use mysql;</strong></span>
</pre></div><p>At this <a id="id327" class="indexterm"/>point, we <a id="id328" class="indexterm"/>now want to create a new password for the root user, flush the new privileges, and exit the MySQL console like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># update user set password=PASSWORD("NEW_PASSWORD") where User='root';</strong></span>
<span class="strong"><strong># flush privileges;</strong></span>
<span class="strong"><strong># exit</strong></span>
</pre></div><p>Having completed <a id="id329" class="indexterm"/>these steps, you <a id="id330" class="indexterm"/>can either reboot the server or simply stop and start the MariaDB service in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl stop mariadb.service</strong></span>
<span class="strong"><strong># systemctl start mariadb.service</strong></span>
</pre></div><p>Finally, you can now access the database with the new root user credentials by typing:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysql -u root -p</strong></span>
</pre></div></div>
<div class="section" title="Tuning MariaDB and MySQL"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec76"/>Tuning MariaDB and MySQL</h1></div></div></div><p>The MYSQL tuner<a id="id331" class="indexterm"/> is a useful package that connects to a running instance of your database service and provides a series of configuration recommendations based on the current workload. Naturally, such a tool will not always provide<a id="id332" class="indexterm"/> the perfect answer for your system, but you should allow the database system to run for one or more days under a typical workload before introducing a modified configuration.</p><p>To install the <code class="literal">mysqltuner</code> package (part of the EPEL repository), you should type this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># yum install mysqltuner</strong></span>
</pre></div><p>To run the <code class="literal">mysqltuner</code> package from the command line, you can use the following syntax at any time:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysqltuner</strong></span>
</pre></div><p>Now, depending on your system configuration and hardware, the output of <code class="literal">mysqltuner</code> will look similar<a id="id333" class="indexterm"/> to this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt;&gt;  MySQLTuner 1.2.0 - Major Hayden &lt;major@mhtx.net&gt;</strong></span>
<span class="strong"><strong> &gt;&gt;  Bug reports, feature requests, and downloads at http://mysqltuner.com/</strong></span>
<span class="strong"><strong> &gt;&gt;  Run with '--help' for additional options and output filtering</strong></span>
<span class="strong"><strong>Please enter your MySQL administrative login: &lt;username&gt;</strong></span>
<span class="strong"><strong>Please enter your MySQL administrative password: &lt;password&gt;</strong></span>

<span class="strong"><strong>-------- General Statistics --------------------------------------</strong></span>
<span class="strong"><strong>[--] Skipped version check for MySQLTuner script</strong></span>
<span class="strong"><strong>[OK] Currently running supported MySQL version 5.5.41-MariaDB</strong></span>
<span class="strong"><strong>[OK] Operating on 64-bit architecture</strong></span>

<span class="strong"><strong>-------- Storage Engine Statistics -------------------------------</strong></span>
<span class="strong"><strong>[--] Status: +Archive -BDB +Federated +InnoDB -ISAM -NDBCluster</strong></span>
<span class="strong"><strong>[--] Data in PERFORMANCE_SCHEMA tables: 0B (Tables: 17)</strong></span>
<span class="strong"><strong>[!!] InnoDB is enabled but isn't being used</strong></span>
<span class="strong"><strong>[OK] Total fragmented tables: 0</strong></span>

<span class="strong"><strong>-------- Security Recommendations  -------------------------------</strong></span>
<span class="strong"><strong>[OK] All database users have passwords assigned</strong></span>

<span class="strong"><strong>-------- Performance Metrics -------------------------------------</strong></span>
<span class="strong"><strong>[--] Up for: 1h 35m 23s (33 q [0.006 qps], 15 conn, TX: 16K, RX: 1K)</strong></span>
<span class="strong"><strong>[--] Reads / Writes: 75% / 25%</strong></span>
<span class="strong"><strong>[--] Total buffers: 288.0M global + 2.8M per thread (151 max threads)</strong></span>
<span class="strong"><strong>[OK] Maximum possible memory usage: 708.0M (38% of installed RAM)</strong></span>
<span class="strong"><strong>[OK] Slow queries: 0% (0/33)</strong></span>
<span class="strong"><strong>[OK] Highest usage of available connections: 0% (1/151)</strong></span>
<span class="strong"><strong>[OK] Key buffer size / total MyISAM indexes: 128.0M/99.0K</strong></span>
<span class="strong"><strong>[!!] Key buffer hit rate: 73.3% (15 cached / 4 reads)</strong></span>
<span class="strong"><strong>[!!] Query cache is disabled</strong></span>
<span class="strong"><strong>[OK] Temporary tables created on disk: 0% (0 on disk / 2 total)</strong></span>
<span class="strong"><strong>[!!] Thread cache is disabled</strong></span>
<span class="strong"><strong>[OK] Table cache hit rate: 2700% (27 open / 1 opened)</strong></span>
<span class="strong"><strong>[OK] Open file limit used: 2% (23/1K)</strong></span>
<span class="strong"><strong>[OK] Table locks acquired immediately: 100% (59 immediate / 59 locks)</strong></span>
<span class="strong"><strong>[!!] Connections aborted: 6%</strong></span>

<span class="strong"><strong>-------- Recommendations -----------------------------------------</strong></span>
<span class="strong"><strong>General recommendations:</strong></span>
<span class="strong"><strong>    Add skip-innodb to MySQL configuration to disable InnoDB</strong></span>
<span class="strong"><strong>    MySQL started within last 24 hours - recommendations may be inaccurate</strong></span>
<span class="strong"><strong>    Enable the slow query log to troubleshoot bad queries</strong></span>
<span class="strong"><strong>    Set thread_cache_size to 4 as a starting value</strong></span>
<span class="strong"><strong>    Your applications are not closing MySQL connections properly</strong></span>
<span class="strong"><strong>Variables to adjust:</strong></span>
<span class="strong"><strong>    query_cache_size (&gt;= 8M)</strong></span>
<span class="strong"><strong>    thread_cache_size (start at 4)</strong></span>
</pre></div><p>The <code class="literal">mysqltuner</code> package is designed to enable you to make ongoing adjustments to the performance and stability of your MySQL installation. Much of the output is verbose, and it shows you the current configuration variables along with an array of current status data that results in a summary of some general performance recommendations.</p><p>It is advisable that <a id="id334" class="indexterm"/>you allow the database to run under typical conditions for at least 24 hours before any changes are made. However, should you wish to take advantage of one or more of these recommendations, then you can add them to, or integrate them with, your existing MySQL configuration file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nano /etc/my.cnf</strong></span>
</pre></div><p>Upon completion, you will be required to restart the database service in question in order to take advantage of the changes made.</p><p>You can do this by typing the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl restart mariadb.service</strong></span>
</pre></div><p>Then confirm the database status using this command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl status mariadb.service</strong></span>
</pre></div><p>The output of which may look similar to this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mariadb.service - MariaDB database server</strong></span>
<span class="strong"><strong>   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled)</strong></span>
<span class="strong"><strong>   Active: active (running) since Mon 2015-05-04 07:10:58 EDT; 9s ago</strong></span>
<span class="strong"><strong>  Process: 4756 ExecStartPost=/usr/libexec/mariadb-wait-ready $MAINPID (code=exited, status=0/SUCCESS)</strong></span>
<span class="strong"><strong>  Process: 4726 ExecStartPre=/usr/libexec/mariadb-prepare-db-dir %n (code=exited, status=0/SUCCESS)</strong></span>
<span class="strong"><strong> Main PID: 4755 (mysqld_safe)</strong></span>
<span class="strong"><strong>   CGroup: /system.slice/mariadb.service</strong></span>
<span class="strong"><strong>           ├─4755 /bin/sh /usr/bin/mysqld_safe --basedir=/usr</strong></span>
<span class="strong"><strong>           └─4911 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/...</strong></span>

<span class="strong"><strong>May 04 07:10:56 centos7 systemd[1]: Starting MariaDB database server...</strong></span>
<span class="strong"><strong>May 04 07:10:56 centos7 mysqld_safe[4755]: 150504 07:10:56 mysqld_safe Logging to '/var/log/mariadb/mariadb.log'.</strong></span>
<span class="strong"><strong>May 04 07:10:56 centos7 mysqld_safe[4755]: 150504 07:10:56 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</strong></span>
<span class="strong"><strong>May 04 07:10:58 centos7 systemd[1]: Started MariaDB database server.</strong></span>
</pre></div><p>Remember, as <a id="id335" class="indexterm"/>system requirements and database needs change on an ongoing basis, you can keep running <code class="literal">mysqltuner</code> as often you like in order to see whether further recommendations have been made.</p></div>
<div class="section" title="Obtaining metrics from MariaDB and MySQL"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec77"/>Obtaining metrics from MariaDB and MySQL</h1></div></div></div><p>Metrics <a id="id336" class="indexterm"/>not only enable you to build a character analysis of your database server, but they can provide evidence of an unexpected<a id="id337" class="indexterm"/> behavior. For the troubleshooter, this type of data is<a id="id338" class="indexterm"/> important and that can be obtained by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysqladmin -u root -p status</strong></span>
</pre></div><p>The output will provide the following information:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Uptime</code>: This value represents the number of seconds the database server has been running.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Threads</code>: This value indicates the number of connected clients.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Questions</code>: This value indicates the number of queries served since the database server was started.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Slow queries</code>: This value indicates the number of queries that have exceeded the <code class="literal">long_query_time</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Opens</code>: This value indicates the number of tables that have been served to clients.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Flush tables</code>: This value indicates the number of flush requests served by the database server. This includes the <code class="literal">flush</code>, <code class="literal">refresh</code>, and <code class="literal">reload</code> commands.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Open tables</code>: This value indicates the number of tables that are currently open.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Queries per second avg</code>: This value indicates the number of queries the database server receives per second.</li></ul></div><p>However, as <a id="id339" class="indexterm"/>the preceding command is quite slim on <a id="id340" class="indexterm"/>detail, greater detail can be obtained by using the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysqladmin -u root -p extended-status</strong></span>
</pre></div><p>An alternative or real-time approach can be obtained by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysqladmin -i 10 -u root -p processlist</strong></span>
</pre></div><p>Note the use of <a id="id341" class="indexterm"/>the <code class="literal">-i</code> option. This indicates that a 10-second pause will take place before the command will refresh. Based on this, you can establish a real-time monitor of the database server events, thereby enabling you to identify, capture, and kill any queries that can be slowing down the system as a whole.</p></div>
<div class="section" title="Returning to MySQL"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec78"/>Returning to MySQL</h1></div></div></div><p>In some <a id="id342" class="indexterm"/>environments, you will want CentOS 7 to use MySQL as opposed to installing MariaDB. To do this, you will need to ensure that MariaDB is not installed, which can be done by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># yum remove mysql-server mysql-libs mysql-devel mysql*</strong></span>
</pre></div><p>You should now check to confirm whether it has been removed using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># rpm -qa | grep mysql</strong></span>
</pre></div><p>To begin the installation of MySQL, you should download the YUM repository configuration file<a id="id343" class="indexterm"/> from <a class="ulink" href="http://dev.mysql.com/downloads/repo/yum/">http://dev.mysql.com/downloads/repo/yum/</a>.</p><p>Now, you will not need an account to download this file, but for those of you who do not want to tour the Oracle website, at the time of writing this book it is possible to bypass the preceding process and use the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># rpm -Uvh http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</strong></span>
</pre></div><p>You can then run the appropriate installation command like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># yum install mysql-community-server</strong></span>
</pre></div><p>Ensure <a id="id344" class="indexterm"/>that the MySQL daemon is enabled to start on boot by running this command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl enable mysqld</strong></span>
</pre></div><p>You can now start the server:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl start mysqld</strong></span>
</pre></div><p>Then, run the MySQL secure installation routine in the usual way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># mysql_secure_installation</strong></span>
</pre></div><p>Finally, rerunning the following command will confirm that the process was successful:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># ps -ef | grep mysql</strong></span>
</pre></div></div>
<div class="section" title="Installing and configuring PostgreSQL 9"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec79"/>Installing and configuring PostgreSQL 9</h1></div></div></div><p>PostgreSQL<a id="id345" class="indexterm"/> is fast, robust, cross-platform, and maintains an excellent pedigree. However, in order to troubleshoot when or where an irregular or unexpected event took place, it is always best to begin by remembering how this database service is installed.</p><p>To begin this <a id="id346" class="indexterm"/>process, we must add the relevant repository in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># rpm -iUvh http://yum.postgresql.org/9.3/redhat/rhel-7-x86_64/pgdg-centos93-9.3-1.noarch.rpm</strong></span>
</pre></div><p>You should always confirm that you are downloading the appropriate version by visiting the repository itself but, having completed this step, you can now install PostgreSQL like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># yum install postgresql93-server</strong></span>
</pre></div><p>At this stage, you may want to make some configuration changes to PostgreSQL. To begin, open the following file in your favorite text editor like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nano /var/lib/pgsql/9.3/data/postgresql.conf</strong></span>
</pre></div><p>The preceding configuration is verbose, and in most cases, you will be simply uncommenting lines or substituting the relevant values to suit your environment. For example, to make the PostgreSQL database server listen on a specific IP address, you will have to uncomment the following line:</p><div class="informalexample"><pre class="programlisting">#listen_addresses = 'localhost'</pre></div><p>Then you can change this to suit the IP address of your choice like this:</p><div class="informalexample"><pre class="programlisting">listen_addresses = 'XXX.XXX.XXX.XXX'</pre></div><p>However, depending<a id="id347" class="indexterm"/> on what flavor of Linux you come from, in<a id="id348" class="indexterm"/> instances where you may or may not be looking for the <code class="literal">tcpip_socket</code> parameter, you should use the following syntax instead:</p><div class="informalexample"><pre class="programlisting">listen_addresses = '*'</pre></div><p>Taking this one step further, you should also spend time making relevant changes to the other settings found within this file. This can include the port used, the maximum number of connections supported, authentication timeout, resource usage, and the many more features afforded by PostgreSQL before opening the following file in order to adjust network access to the database server:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nano /var/lib/pgsql/9.3/data/pg_hba.conf</strong></span>
</pre></div><p>For example, if you want to provide local network access for an entire IP range (for example, 192.168.1.0/24), you can use the following syntax:</p><div class="informalexample"><pre class="programlisting">host all all 192.168.1.0 255.255.255.0 trust</pre></div><p>Alternatively, for peace of mind, you can use the following syntax to achieve a similar result with slightly less typing:</p><div class="informalexample"><pre class="programlisting">host all all 192.168.1.0/24 md5</pre></div><p>So, having completed the preceding steps to enable PostgreSQL at boot, you must type:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl enable postgresql-9.3</strong></span>
</pre></div><p>To initialize the database server, you must type this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># /usr/pgsql-9.3/bin/postgresql93-setup initdb</strong></span>
<span class="strong"><strong># systemctl start postgresql-9.3</strong></span>
</pre></div><p>Finally, if you want to access the database server, you must switch to the predefined PostgreSQL user account like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># su - postgres</strong></span>
</pre></div><p>Then you can proceed to connect to the PostgreSQL database in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># psql</strong></span>
</pre></div><p>Then, by using the following expression, you will be able to review the full list of <code class="literal">psql</code> commands <a id="id349" class="indexterm"/>available to you in order that you can begin adding users and templates, and creating databases:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># \?</strong></span>
</pre></div><p>For example, to <a id="id350" class="indexterm"/>quit the <code class="literal">psql</code> console at any time, use the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># \q</strong></span>
</pre></div><p>Finally, having returned to the standard bash console, you can confirm PostgreSQL connectivity at any time by customizing the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># psql -h &lt;database_hostname&gt; -U &lt;username&gt; -d &lt;database_name&gt;</strong></span>
</pre></div><p>Alternatively, you can use the <code class="literal">ps</code> command like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># ps -ef | grep posgres</strong></span>
</pre></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec80"/>Summary</h1></div></div></div><p>From installation and optimization to recovering a lost password for the root user, in this chapter we have highlighted a number of issues related to the process of troubleshooting both MariaDB and PostgreSQL. As was stated at the outset, there was no intention to deal with specific programming or development issues, but as these database systems can be found throughout the enterprise, it is expected that you will be dealing with them; in this respect, we have discussed a range of topics that will provide a useful starting point when troubleshooting almost any database service.</p><p>In the next chapter, we will further the theme of the book and discuss a unique approach to troubleshooting web services.</p></div>
<div class="section" title="References"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec81"/>References</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The MySQL project home page: <a class="ulink" href="http://dev.mysql.com/">http://dev.mysql.com/</a></li><li class="listitem" style="list-style-type: disc">MySQL YUM downloads: <a class="ulink" href="http://dev.mysql.com/downloads/repo/yum/">http://dev.mysql.com/downloads/repo/yum/</a></li><li class="listitem" style="list-style-type: disc">The MariaDB project home page: <a class="ulink" href="https://mariadb.org/en/">https://mariadb.org/en/</a></li><li class="listitem" style="list-style-type: disc">MariaDB FAQ: <a class="ulink" href="https://mariadb.com/kb/en/mariadb/faq/">https://mariadb.com/kb/en/mariadb/faq/</a></li><li class="listitem" style="list-style-type: disc">Installing MariaDB with Yum: <a class="ulink" href="https://mariadb.com/kb/en/mariadb/yum/">https://mariadb.com/kb/en/mariadb/yum/</a></li><li class="listitem" style="list-style-type: disc">Red Hat Bugzilla – Bug 1020055, <a class="ulink" href="https://bugzilla.redhat.com/show_bug.cgi?id=1020055">https://bugzilla.redhat.com/show_bug.cgi?id=1020055</a></li><li class="listitem" style="list-style-type: disc">The MySQLTuner home page: <a class="ulink" href="http://mysqltuner.com">http://mysqltuner.com</a></li><li class="listitem" style="list-style-type: disc">The MySQLTuner GitHub home page: <a class="ulink" href="https://github.com/major/MySQLTuner-perl">https://github.com/major/MySQLTuner-perl</a></li><li class="listitem" style="list-style-type: disc">Benchmarking MariaDB-5.3.4: <a class="ulink" href="https://blog.mariadb.org/benchmarking-mariadb-5-3-4/">https://blog.mariadb.org/benchmarking-mariadb-5-3-4/</a></li><li class="listitem" style="list-style-type: disc">Troubleshooting problems – starting the MySQL server: <a class="ulink" href="http://dev.mysql.com/doc/refman/5.1/en/starting-server.html">http://dev.mysql.com/doc/refman/5.1/en/starting-server.html</a></li><li class="listitem" style="list-style-type: disc">MariaDB versus MySQL – compatibility: <a class="ulink" href="https://mariadb.com/kb/en/mariadb/mariadb-vs-mysql-compatibility/">https://mariadb.com/kb/en/mariadb/mariadb-vs-mysql-compatibility/</a></li><li class="listitem" style="list-style-type: disc">PostgreSQL 9.3.6 documentation: <a class="ulink" href="http://www.postgresql.org/docs/9.3/static/index.html">http://www.postgresql.org/docs/9.3/static/index.html</a></li><li class="listitem" style="list-style-type: disc">PostgreSQL client authentication: <a class="ulink" href="http://www.postgresql.org/docs/9.3/static/client-authentication.html">http://www.postgresql.org/docs/9.3/static/client-authentication.html</a></li><li class="listitem" style="list-style-type: disc">PostgreSQL database roles: <a class="ulink" href="http://www.postgresql.org/docs/9.3/static/user-manag.html">http://www.postgresql.org/docs/9.3/static/user-manag.html</a></li><li class="listitem" style="list-style-type: disc">PostgreSQL repositories: <a class="ulink" href="http://yum.postgresql.org/repopackages.php">http://yum.postgresql.org/repopackages.php</a></li></ul></div></div></body></html>