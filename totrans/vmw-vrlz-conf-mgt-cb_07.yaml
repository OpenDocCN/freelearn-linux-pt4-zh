- en: Chapter 7. Maintenance of VCM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  prefs: []
  type: TYPE_NORMAL
- en: Upgrading VCM from a previous version - in place
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Upgrading VCM from a previous version - parallel
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Migrating VCM from another domain
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Applying a new license key
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Upgrading VCM agents
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Changing service account passwords
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Managing users
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decommissioning VMs - manual VM purge
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decommissioning VMs - scheduled VM record purge
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After installation and configuration, another extremely important aspect we
    need to look at is the lifecycle management of VCM. VMware will keep on improving
    VCM, and to have those improvements implemented, we also need to invest our time
    to maintain the infrastructure we have built.
  prefs: []
  type: TYPE_NORMAL
- en: This is not just limited to VMware updates and upgrades but also to our own
    infrastructure changes; for example, relocating a datacenter might need us to
    change IP or we might have decided to change our Active Directory domain and we
    need to migrate our management servers to the newly created domain. All this falls
    under maintenance, and we will have a look what we can do for VCM.
  prefs: []
  type: TYPE_NORMAL
- en: Apart from this, we are managing our infrastructure, and it has its own lifecycle
    to manage; for example, once the server is decommissioned, we need to remove it
    from VCM, and after upgrading VCM, we need to upgrade VCM agents on the managed
    servers.
  prefs: []
  type: TYPE_NORMAL
- en: To manage VCM, we will have a support team; everyone does not need to have admin
    access on the server. In order to adhere to the security principle of least privilege,
    we need to create some groups and give them proper access to VCM.
  prefs: []
  type: TYPE_NORMAL
- en: We will have a look at those points in this chapter to make sure we have a maintained
    VCM infrastructure so that it can manage our infrastructure better.
  prefs: []
  type: TYPE_NORMAL
- en: Upgrading VCM from a previous version – in place
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we will upgrade VCM in place, meaning we will do a regular upgrade
    without changing the OS underneath. If you want to change the OS underneath, have
    a look at the following recipe.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To start with this activity, you must have all the user accounts in place, and
    they must have permissions as described in the *Service accounts* subsection under
    the *Understanding the requirements of VCM* recipe in [Chapter 1](ch01.html "Chapter 1. Installing
    VCM"), *Installing VCM*. You must have a user apart from the service account,
    which may be your own account, with admin privilege on the VCM Collector server.
  prefs: []
  type: TYPE_NORMAL
- en: If you are using a physical server, then take a backup of the server with the
    tool you are using in your infrastructure; otherwise, if that Collector server
    is a virtual machine, take a snapshot of the VM.
  prefs: []
  type: TYPE_NORMAL
- en: Take a backup of the databases (`Excel VCM_Raw`) so that if something goes wrong,
    you can get back to where you were before the upgrade. If you don't know how,
    you can get help from your SQL admin to take a backup of the databases.
  prefs: []
  type: TYPE_NORMAL
- en: You must have access to [https://my.vmware.com](https://my.vmware.com) to download
    the latest VCM installation ISO files.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In the following example, we will perform an in-place upgrade of a two-tier
    VCM deployment:'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that you should not use a VCM service account to upgrade VCM. Use any domain
    account that is an admin on the VCM server. You can use your own account to log
    in to the VCM Collector server if you have those privileges; if not, assign them
    to your account for the time being.
  prefs: []
  type: TYPE_NORMAL
- en: Mount the ISO downloaded from the Internet on your VCM Collector VM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the Collector OS with a [user right/role].
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open an Explorer window and navigate to the CD-ROM drive just mounted.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on `setup.exe` and select **Run as Administrator**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Upgrade** and click on **Next**:![How to do it...](img/image_07_001.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Accept the license agreement, and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Confirm the components to be upgraded, and click on **Next****:**![How to do
    it...](img/image_07_002.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Wait until the checks are completed and click on **Next** once they are successful;
    if not, check what needs a fix, resolve any issues, and then perform a recheck.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that while performing the upgrade, the details asked in the wizard should
    be automatically filled in. If not, fill in the appropriate details; if you want
    to make any changes, then this is the time to make those changes, such as changing
    service accounts.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If you want to change the Tomcat service account, provide the details; otherwise,
    go with the default value and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the SQL reporting service details and credentials here, and click on **Validate**;
    when validated, click on **Next**:![How to do it...](img/image_07_003.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the Collector service account (if required) and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If not populated automatically, enter the default network authority account
    and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The certificates should be selected automatically already. If not, select your
    certificates by clicking on **Select**, and once done, click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If not populated automatically, enter your remote virtual directory details
    and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If not populated automatically, enter your virtualization client plugin details
    and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If not populated automatically, enter the installation directory, and click
    on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There is no option for you to change this path for the local packages cache
    location; click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The option for the path for the software repository is preselected and can't
    be changed; click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the Package Studio folder location and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Confirm the details and click on **Upgrade**:![How to do it...](img/image_07_004.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The process of upgrading all components can take half an hour or more.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check whether the upgrade was successful by checking the version of VCM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the installation is complete, log in to VCM and check the version; it should be
    **5.8.2.160**, as in the following screenshot, or the version you downloaded from
    [http://www.vmware.com/](http://www.vmware.com/):![How to do it...](img/image_07_005.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We installed the latest version of VCM on the same server, using the old data
    collected for our infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here are the upgrade options to upgrade the version:'
  prefs: []
  type: TYPE_NORMAL
- en: Upgrade directly from VCM 5.6 or later by running VCM 5.8.x Installation Manager
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Upgrade VCM versions earlier than 5.6 to VCM 5.6 and then upgrade from VCM 5.6
    to VCM 5.8.x
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Earlier versions include VMware VCM 5.5.x, 5.4, 5.3, 5.2.1, EMC Ionix SCM 5.0
    or later, or Configuresoft ECM 4.11.1 or later.
  prefs: []
  type: TYPE_NORMAL
- en: Aftercare
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'After upgrading VCM, we need to upgrade the agents to the latest versions;
    have a look at the *Upgrading VCM agents* recipes in this chapter to do that:'
  prefs: []
  type: TYPE_NORMAL
- en: There is a small bug with the agent upgrade to version 5.8.1 (resolved in 5.8.2)
    from an older version; have a look at the *Troubleshooting agent upgrade* issues
    recipe and the one after that in [Chapter 9](ch09.html "Chapter 9. Troubleshooting
    VCM"), *Troubleshooting VCM* for how to solve it
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Once the upgrade is complete, roam through the VCM console to have a look at
    whether all the servers that were managed earlier, such as vCenter, vCloud, and
    VCNS, are visible
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If you have designated a managing agent in your infrastructure, then after
    an upgrade, there is a chance that the trust between the managing agent and the
    VCM Collector will be broken. To fix this issue, follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Follow the steps of the *Issue 1 - mutual authentication failure* subsection
    of the *Troubleshooting agent communication issues* recipe in [Chapter 9](ch09.html
    "Chapter 9. Troubleshooting VCM"), *Troubleshooting VCM*.
  prefs: []
  type: TYPE_NORMAL
- en: 'To re-enable the server as a managing agent, we need VCM Collector to trust
    the server again; for this, log in to VCM console and follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Go to **Administration**| **Certificate** and select the managing agent server.
    Click on **Change Trust Status** at the top.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the wizard, select the managing agent machine and tick the **Check to trust
    and uncheck to untrust the selected machine** option.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You should see a handshake sign in front of managing agent server.
  prefs: []
  type: TYPE_NORMAL
- en: Now, we need to re-enable the old managing agent to do its job again as was
    done in the *Configuring a managing agent machine for virtual environment management*
    recipe in [Chapter 2](ch02.html "Chapter 2. Configuring VCM to Manage Your Infrastructure"),
    *Configuring  VCM to Manage Your Infrastructure*.
  prefs: []
  type: TYPE_NORMAL
- en: Upgrading VCM from a previous version – parallel
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you want to upgrade not only VCM but also the OS underneath it, this is the
    recipe to look at. VCM 5.8.2 now supports Windows Server 2012 R2, and it's a good
    chance to perform an upgrade.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To start with this activity, you must have all the user accounts in place and
    they must have permissions as described in the first chapter. You must have a
    user apart from the service account, which may be your own account, with admin
    privileges on the VCM Collector server to perform the installation.
  prefs: []
  type: TYPE_NORMAL
- en: If you are using a physical server, then take a backup of the server with the
    tool you are using in your infrastructure; if that Collector server is a virtual
    machine, take a snapshot of the VM.
  prefs: []
  type: TYPE_NORMAL
- en: Take a backup of the databases so that if something goes wrong, you can get
    back to where you were before the upgrade. If you are not aware, you can get help
    from your SQL admin to take a backup of the databases.
  prefs: []
  type: TYPE_NORMAL
- en: You must have access to [https://my.vmware.com](https://my.vmware.com) to download
    the latest VCM installation ISO files.
  prefs: []
  type: TYPE_NORMAL
- en: Deploy another server with the latest supported OS available with you, that
    is, Windows Server 2008 R2, Windows Server 2012, or Windows Server 2012 R2\. Check
    the VCM requirements in the *Software requirements* subsection under the *Understanding
    the requirements of VCM* recipe in [Chapter 1](ch01.html "Chapter 1. Installing
    VCM"), *Installing VCM*.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the following example, we will perform a parallel upgrade of a two-tier VCM
    deployment.
  prefs: []
  type: TYPE_NORMAL
- en: This recipe splits into multiple sections.
  prefs: []
  type: TYPE_NORMAL
- en: Migrating the VCM certificate
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: First, we will export the VCM Enterprise certificate and then we will start
    installing VCM.
  prefs: []
  type: TYPE_NORMAL
- en: 'So, let''s log in to the old VCM server and follow these steps to export the
    certificate:'
  prefs: []
  type: TYPE_NORMAL
- en: Launch `mmc.exe` and add a snap-in for **Certificates (Local Computer)**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Trusted Root Certification Authority** | **Certificates**; select **VMWare
    VCM Enterprise Certificate...** and right-click on the certificate under **All
    Tasks** | **Export...**:![Migrating the VCM certificate](img/image_07_006.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This will launch the wizard; export the private key.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'For the file format, select **Personal Information Exchange** and do the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Include all certificates in the certification path if possible.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Export all extended properties.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Type and confirm the password; copy it to a safe place–we will need it later.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a name and path to save the file to, and you are done with the certificate
    export.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the same process for the Collector certificate, under **Personal** | **Certificate**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Copy the certificates to the new VCM server and then import them to the respective
    folders from where they were exported. Use the same password given earlier while
    importing both the certificates.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Shut down* the old VCM server after *disabling and stopping VCM services*
    on the server.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Migrating VCM to the new server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Once the certificate is available, we can start deploying a new VCM instance
    by following these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to the newly created VCM server and mount the VCM installer ISO downloaded
    from [https://my.vmware.com/](https://my.vmware.com/).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to the mounted ISO, right-click on `setup.exe`, and select **Run as
    Administrator**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose **Advanced Installation**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Next** for the introduction page.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Next** for the patent information page.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Read and accept the license agreement and select **I am an authorized agent
    and/or representative of the customer/end user** and **I have read the terms and
    conditions stated above**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Under **Select Installation Type**, select the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**VMware vRealize Configuration Manager**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VCM Web Console**'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VCM Collector Components**'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Tools**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Import Export Utility**'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Foundation Checker**'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VMware VCM package manager for Windows**'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VMware VCM package Studio**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The installer will perform a prerequisite check and present the results on successful
    checks. Click on **Next**; if there are failures, click on **View Results**, remedy
    any errors and warnings, and perform a recheck.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Do not proceed further until there are zero errors.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: On the next page, enter the serial key.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Configure Components** page, provide the hostname of the SQL server
    that was used with the earlier VCM instance and VCM as the database name (if you
    have named the VCM database with a different name, then provide that name) and
    click on **Validate**:![Migrating VCM to the new server](img/image_07_007.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next page, provide the Tomcat service account and its password.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next page, provide the details in **WebService URL** (this is the path
    to the SQL server–the same as the old VCM deployment). Provide the path to install
    the web console. Check out the following screenshot for more details:![Migrating
    VCM to the new server](img/image_07_008.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a URL to the application; the default is fine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We can provide an SMTP address; the default is the Collector server's. If you
    don't know it right now, this can be configured in the VCM console later.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the path for installing the Collector component and accept the SSL3
    warning.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the path to store staging data; this is the path where data is temporarily
    stored before adding it to the database.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the details of the Collector service account; this account will be given
    rights to log in as a service; accept the prompt.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide details of the network authority account; we can add as many accounts
    as we want later. We need at least one for the time being. More details about
    this account can be found under the *Service accounts* section in [Chapter 1](ch01.html
    "Chapter 1. Installing VCM"), *Installing VCM*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The next page is for the certificate; here, we need to reuse the certificate
    exported from the old VCM server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Select** and provide the Collector and Enterprise certificates:![Migrating
    VCM to the new server](img/image_07_009.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide details about Virtual Directory and the credentials to access it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the credentials for the Virtualization Client plugin.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next page, provide the path to install the package manager components
    to.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next page, provide the path to the local package cache.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next page, provide the path for the software repository and local cache.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a Virtual Directory name.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the path for the Package Studio components.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, you will reach the summary page. Check the options and click on **Install**:![Migrating
    VCM to the new server](img/image_07_010.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once VCM is installed successfully, log in to the console with the account you
    used to install VCM. Check whether all the managed machines are available and
    all the virtual infrastructure elements you configured are present.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Also check the version–it should be **5.8.2.160**, as in the following screenshot:![Migrating
    VCM to the new server](img/image_07_011.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Perform a collection of any managed VMs available on the console.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We went to the latest Windows OS and then migrated the VCM installation to give
    us the edge, that is, if you are on an older version of the OS that is not supported
    by Microsoft or not supported as a *base* OS for VCM, then you can migrate retaining
    all the old data. You can perform a hardware refresh if your old server was on
    a physical server.
  prefs: []
  type: TYPE_NORMAL
- en: When we perform a parallel upgrade, we migrate from the old operating system
    but still using the old database. As we keep the old database, all the data collected
    is retained after the upgrade. We have all the agents and all the already configured
    vCenter servers. This helps in keeping our old configuration with the latest build
    of VCM and the latest supported base OS.
  prefs: []
  type: TYPE_NORMAL
- en: Selecting the right certificate is the key to success here. As you know, the
    certificate is used by agents when we install them. If we regenerate or use the
    wrong certificate, the agent-server communication will break and we will be forced
    to install a new agent with the latest certificate from the server.
  prefs: []
  type: TYPE_NORMAL
- en: Aftercare
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Refer to the corresponding section of the previous recipe for aftercare instructions.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Refer to the corresponding section of the previous recipe. The same steps need
    to be followed.
  prefs: []
  type: TYPE_NORMAL
- en: Migrating VCM from another domain
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are scenarios in which we need to migrate from one domain to another and
    can't afford to lose all the historical data of our managed machines. In this
    recipe, we will look at how to migrate the VCM server from an old domain to a
    new domain.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Make sure that the network and DNS (forward and reverse) is correct for the
    VCM Collector server. Add the VCM Collector to the new domain and create or identify
    the domain account that you want to use, as described in *Service accounts* subsection
    under the *Understanding the requirements of VCM* recipe in [Chapter 1](ch01.html
    "Chapter 1. Installing VCM"), *Installing VCM*.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To change VCM service accounts to run under a different domain account, follow
    these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'On the VCM database server, run the following SQL update queries against the
    core VCM database. Make the appropriate name substitutions:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Select and stop the following services:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**VCM Collector**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VCM Database Service**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VCM Patch Management**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Right-click on each service, select **Properties**, and select the **Log On**
    tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Change the account credentials to the new account, and click on **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Start** | **Administrative Tools** | **Component Services**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the left, go to **Console Root** | **Component Services** | **Computers**
    | **My Computer** | **DCOM Config** | **LicenseDcom**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click, select **Properties**, and select the **Identity** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **This** user, enter the new domain account credentials, and click on
    **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From **Start** | **Administrative Tools** | **Services**, restart the services
    you stopped.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Start** | **Administrative Tools** | **Server Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the left, navigate to **Server Manager** (hostname) | **Configuration** | **Local
    Users and Groups**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click on **Groups**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select `VCM_LDP_GROUP`, right-click, and select **Properties**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Remove the old account and add the new one.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **Server Manager** (hostname) | **Configuration** | **Services**,
    double-click on **Groups**, select `CSI_COMM_PROXY_SVC`, and repeat the process
    for replacing the account.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that if you run the **Repair** option of the VCM installer, account changes
    revert to what you specified during installation.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Note that if you run the VCM installer to upgrade to a newer version of VCM,
    account changes default to what you specified during the older installation. Enter
    the account changes that you want during the upgrade process.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Add the new domain to the network authority in VCM.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Add any new users required for the new domain.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: VCM runs its services under accounts that you specify during installation. After
    installing VCM, the conditions at your site might require that you change from
    running under the initial domain account to a different domain account.
  prefs: []
  type: TYPE_NORMAL
- en: This procedure also applies when you need to change from running under a built-in
    Windows account to a domain account. To change from domain accounts to built-in
    accounts, refer to the next recipe, where we provide new credentials to run services
    in the new domain and retain historical data in VCM.
  prefs: []
  type: TYPE_NORMAL
- en: Applying a new license key
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You might have had a temporary license key when you installed VCM or the infrastructure
    might have grown more than you expected and you now need to provide new licenses
    to manage the infrastructure. This is where you need to provide new keys, and
    entering a new serial key is not a straightforward console option; there is a
    command-line utility called **jlicense.cmd** available to do this.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Get the new key to be used. You must have VCM admin access on the VCM console.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Log in to the VCM server with VCM admin privileges, and follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Launch CMD with administrative privileges and go to `X:\Program Files (x86)\VMware\VCM\Tools`
    (*X* is the drive where VCM is installed).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run `jlicense.cmd -k xxxxx-xxxxx-xxxxx-xxxxx-xxxxx` (this is the new key you
    want to add to VCM), as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_07_012.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: It will append to the already available capacity of VCM, that is, the number
    of machines we can manage and the expiration date of the key.
  prefs: []
  type: TYPE_NORMAL
- en: 'Using the **jlicense.cmd** utility, you can:'
  prefs: []
  type: TYPE_NORMAL
- en: Update a single license key for servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Update a single license key for workstations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enter two keys for servers and workstations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enter a single license key for servers or workstations or enter two license
    keys for both servers and workstations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Here''s how to use the JLicense tool:'
  prefs: []
  type: TYPE_NORMAL
- en: 'To display the JLicense help information, run this command: `jlicense -h`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To evaluate the license key but not to install it, run this command:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Here, `xxxxx-xxxxx-xxxxx-xxxxx-xxxxx` is the license key
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'To change a license, run this command:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Here, `xxxxx-xxxxx-xxxxx-xxxxx-xxxxx` is the license key
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Upgrading VCM agents
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After an upgrade of the VCM server, you need to upgrade the VCM agent. This
    recipe deals with the Windows and Linux VCM agent upgrades from their previous
    versions.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must have some old agents to be upgraded to the latest version and they
    should be communicating with VCM server.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are two ways to upgrade the agent in the case of Windows. From the console,
    you can choose **Upgrade** as an option, or you can choose Install and in the
    wizard choose **Remove Current Agent** from the machine. Both the processes do
    the same thing–upgrading the agent to the latest build–but **Install with Remove
    Current** version takes more time. Both the options retain all the old collected
    data.
  prefs: []
  type: TYPE_NORMAL
- en: We will use the **Upgrade** method in this recipe.
  prefs: []
  type: TYPE_NORMAL
- en: Windows
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This is the way to do it in Windows:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to VCM with administrative privileges.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **Administration** | **Machines Manager** | **Licensed Machines**
    | **Licensed Windows Machines**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on the machine and select **Upgrade Agent**:![Windows](img/image_07_013.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Machines** page, select the Windows machines to upgrade and click on
    the arrow to move the machines to the selected pane. Click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the installation options page, select or verify the option for the agent
    installation, and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Schedule** page, schedule the operation and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Important** page, verify the summary and click on **Finish**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Jobs** button and see whether the job is completed successfully.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the job is finished, check the console for the agent version. It should be
    the latest one, as in the following screenshot:![Windows](img/image_07_014.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Linux
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here''s how to do it in Linux:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to VCM with administrative privileges.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Console** and go to **UNIX Remote Commands** | **UNIX Agent Upgrade**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **UNIX Agent Upgrade** data grid, click on the appropriate remote upgrade
    package for the operating system and the version of the machines to upgrade:![Linux](img/image_07_015.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Run** and follow the wizard to send the remote command and upgrade
    packages on the agents on the selected machines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The agents will execute the package upgrade.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Select the managed machine whose agent you want to upgrade.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Schedule** page, select **Run Remote Command Now** or schedule the
    operation for later and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Important** page, verify the summary and click on **Finish**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Verify that the job completes successfully.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Perform a collection on the managed machine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Check the status of the agent on the console of VCM; it should look something
    like the following screenshot:![Linux](img/image_07_016.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We push the latest installer from the VCM console, it gets copied to the managed
    machine, starts upgrading the old agent files, and finally creates a VCM service
    on the managed machines and comes back with a status of success.
  prefs: []
  type: TYPE_NORMAL
- en: You can perform a collection after the agent is installed to be sure nothing
    was broken during the upgrade.
  prefs: []
  type: TYPE_NORMAL
- en: In case of a Linux upgrade, the process copies the latest agent installer from
    the VCM console along with the remote command to run on the Linux/Unix machine.
    Then, it executes the script to install the agent.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: It is observed that after most of the agent or server upgrades, we need to perform
    the steps as described in the *Issue 1 - mutual authentication failure* subsection
    of the *Troubleshooting agent communication issues* recipe in [Chapter 9](ch09.html
    "Chapter 9. Troubleshooting VCM"), *Troubleshooting VCM*, as the trust between
    the upgraded agent and VCM Collector is broken.
  prefs: []
  type: TYPE_NORMAL
- en: You will see the error message described in the previous recipe, so simply follow
    the steps to resolve it.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There is a small bug with the agent upgrade to version 5.8.1 (resolved in 5.8.2)
    from an older version; have a look at the *Troubleshooting agent upgrade* issues
    recipe in [Chapter 9](ch09.html "Chapter 9. Troubleshooting VCM"), *Troubleshooting
    VCM*
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Changing service account passwords
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are occasions when we need to change passwords for service accounts; in
    this recipe, we will learn how to.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must have new passwords available to be replaced.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We'll look at the various service accounts used by VCM that we can change if
    we want to.
  prefs: []
  type: TYPE_NORMAL
- en: To update a password for VCM service accounts, follow these steps.
  prefs: []
  type: TYPE_NORMAL
- en: Collector service accounts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: On the Collector, go to **Start |** **Administrative Tools** | **Services**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select and stop the following services:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**VCM Collector**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VCM Database Service**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VCM Patch Management**'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Right-click on each service, select **Properties**, and select the **Log On**
    tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Update the account password and click on **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Start** | **Administrative Tools** | **Component Services**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the left, go to **Console Root** | **Component Services** | **Computers**
    | **My Computer** | **DCOM Config** | **LicenseDcom**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click, select **Properties**, and select the **Identity** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **This** user, update the password and click on **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: VCM remote service accounts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We provided details about the VCM remote user when we performed the installation.
  prefs: []
  type: TYPE_NORMAL
- en: 'The VCM remote service account is used by the VCM remote client for anonymous
    access to the VCM remote virtual directory on the web server. Follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: On the web server, go to **Start** | **Administrative Tools** |** IIS Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the left, navigate to **{web-server-hostname}** | **Sites** | **Default Web
    Site** | **ECMRemoteHTTP**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click on **Authentication**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Anonymous Authentication**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Actions** pane on the right, select **Edit**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Set**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the existing domain/username, then the new password, and click on **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **{web-server-hostname}** | **Sites** | **Default Web Site** | **VCMRemote**,
    and repeat the steps to change the password.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Network authority accounts**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Follow these steps for a network authority account:'
  prefs: []
  type: TYPE_NORMAL
- en: In VCM, click on **Administration** and go to **Settings** | **Network Authority**
    | **Available Accounts.**
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Edit Password**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**SSRS**'
  prefs: []
  type: TYPE_NORMAL
- en: For an SSRS account, run the `RSConfig` command to change the embedded account
    information.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: VCM runs its services under accounts that you specify during installation. After
    installing VCM, conditions at your site might require that passwords on the accounts
    be changed, making it necessary to update the passwords in VCM as well.
  prefs: []
  type: TYPE_NORMAL
- en: We can make those changes using the steps we just went through.
  prefs: []
  type: TYPE_NORMAL
- en: Managing users
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You need to manage VCM logins and assign roles to users who have access to VCM.
    Roles determine the level of access for each user and can be adjusted for access
    to specific machine groups and VCM functionality.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you are planning to create custom roles, they must be ready before starting
    this recipe.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to add new users and groups and give them appropriate permissions:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Administration** | **User Manager** | **VCM Logins**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Add Users**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that you cannot add the Collector service account as a VCM login.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Select **Enter Domain Account** and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that individual Active Directory accounts can also be added. Adding a group
    ensures that role-based access is governed by Active Directory.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Enter the security group in the `DOMAIN\Group` format and click on **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click on **Admin** (or a lesser role for general access) and click on
    **Next**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Finish**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When VCM is installed, the user who installs it gets administrative access on
    the console. We need to add users or groups to give them access. By following
    this recipe, we can add users who need access.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that when a user starts VCM, if more than one role is assigned to their
    login, a drop-down list appears and allows the user to select the desired role.
    To automatically log in to VCM using a particular role, users can check the ****Automatically**
    log in using this role** option. To switch roles or not log in automatically,
    users can select a different role or uncheck this option.
  prefs: []
  type: TYPE_NORMAL
- en: Default roles
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This is the list of default roles available with VCM and a short description
    of each of them:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **Sr. no.** | **Name** | **Description** |'
  prefs: []
  type: TYPE_TB
- en: '| **1** | Admin | Top-level role. Admin has rights to everything in the database.
    |'
  prefs: []
  type: TYPE_TB
- en: '| **2** | Domain Controller Manager | Role with full access to the Domain Controllers
    dynamic machine group. |'
  prefs: []
  type: TYPE_TB
- en: '| **3** | Read-Only | Role with read access to all machines and data. |'
  prefs: []
  type: TYPE_TB
- en: '| **4** | Help Desk | Only allows password changes on domain controllers. |'
  prefs: []
  type: TYPE_TB
- en: '| **5** | IIS Admins | Role with full access to the Microsoft Internet Information
    Servers dynamic machine group. |'
  prefs: []
  type: TYPE_TB
- en: '| **6** | Server Managers | Role with full access to the Servers dynamic machine
    group. |'
  prefs: []
  type: TYPE_TB
- en: '| **7** | SQL Server Admins | Role with full access to the Microsoft SQL Servers
    dynamic machine group. |'
  prefs: []
  type: TYPE_TB
- en: '| **8** | Workstation Managers | Role with full access to the Workstation dynamic
    machine group. |'
  prefs: []
  type: TYPE_TB
- en: '| **9** | VCM Auditor | Role with read access to License Manager. |'
  prefs: []
  type: TYPE_TB
- en: '| **10** | `AD_Admin` | Built in role with access to AD data and Administration
    for AD. |'
  prefs: []
  type: TYPE_TB
- en: '| **11** | `AD_User` | Built in role with access to AD data only. |'
  prefs: []
  type: TYPE_TB
- en: '| **12** | Change Restricted | VCM **Change Restricted** role.With this role,
    users can discover machines, collect data from them, assess them, display bulletin
    and template details, check for updates, and view history. Users can add, edit,
    and delete reports, compliance rules and rule groups, and compliance and patch
    assessment templates. Users with the **Change Restricted** role can also install
    the VCM agent, upgrade VCM, and uninstall it. |'
  prefs: []
  type: TYPE_TB
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When creating a role, we need to understand access rules as they define the
    areas of VCM that users can access and the actions that they can perform.
  prefs: []
  type: TYPE_NORMAL
- en: VCM roles and access rules go hand in hand; roles define which areas can be
    accessed by whom while rules define what kind of access is provided to the user,
    such as **None**, **Read Only**, **Full Access,** or **Custom**. When you select
    **Custom**, it goes to a very granular level and you can select a single privilege,
    such as only **Add Automatic Deployment** or **Run a Report**.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can either use the 14 default access rules or you can create new ones as
    per your requirement:'
  prefs: []
  type: TYPE_NORMAL
- en: To create a new access rule, log in to the VCM console, go to **Administration **| **User
    Manager** | **VCM Access** | **Access Rules**, and click on **Add Rule**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide a nice name and description.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Rule Type**, select **Basic Rule** (this defines data types and areas
    of VCM to access) or **Admin Access Rule** (to access administrative areas of
    VCM).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For **Basic Rule**, under **Data Type**, include what type of data, that is,
    machine data or Active Directory data, and then define access to the VCM console,
    except the **Administration** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Admin Access Rule** defines what type of access is defined in the **Administration**
    tab, such as **None**, **Read Only**, **Full Control**, or going granular with
    **Custom**.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Lastly, click on **Finish** on the **Important** page of the wizard to close
    and create this new access rule.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'As seen previously, there are 12 default roles created, but if you still have
    a use case that requires a different role, then you can create your own role.
    Follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to the VCM console and go to **Administration **| **User Manager** | **VCM
    Access** | **Roles**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Add Role** button and follow the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When creating a role, you will need some information. To start with, provide
    a name and description for the newly created role.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For **Role Access**, we can select either **Machine Data** (access to data based
    on the selected machine groups), **Active Directory** (access to Active Directory
    objects based on the AD structure), or **Admin** (access to administrative functions)
    access.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the next page, under **Machine Data Access**, you can filter which machine
    group this new role user can access.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Active Directory** page, under **Enterprise**, select the **Access
    Rule** that will be applied at the root of AD, if you have configured any.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For **Admin Access**, select a proper rule to provide access.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Logins**, select any logins to assign this role to and, after reviewing
    it under **Important**, close the wizard to finish it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Decommissioning VMs – manual VM purge
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As a part of the lifecycle management of a managed machine, we need to remove
    the details of the managed machine from the VCM console.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must have the name of the machine that you want to remove from VCM.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'It''s a two-step process: First, free up a license and keep the data. Next,
    purge everything and remove the managed machine from the VCM database.'
  prefs: []
  type: TYPE_NORMAL
- en: Unlicense a managed machine
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Log in to VCM with administrative privileges.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Administration** | **Machines Manager** | **Licensed Machines** | **Licensed
    Windows Machines** or **Licensed UNIX Machines**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on the name of the machine you want to remove from the display.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Unlicense** option and follow the prompts.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that this returns the machine to the **Available Machines** list and frees
    up the machine's license for reuse.
  prefs: []
  type: TYPE_NORMAL
- en: Purge the machine
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Log in to VCM with administrative privileges.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to **Administration **| **Machines Manager** | **Available Machine**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From here, if required, we can license the machine and move it to **Licensed
    Windows Machines** or **Licensed UNIX Machines** or remove it from the VCM database.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the machine and click on **Purge** in the top menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the wizard; it will remove the machine completely from the VCM database.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The process will obtain records as well as collected data from the VCM database
    and help us clean the clutter in the VCM, as the machines we want to delete have
    already been decommissioned. If those machines are not deleted from VCM, we could
    have an incorrect compliance score. We will always have machines that will fail
    patch installation and we will never reach the score we want.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you are good with vRealize Orchestrator, VMware had released a package for
    VCM (which is available for download at [https://my.vmware.com](https://my.vmware.com)).
    With the help of this package, you can create a workflow to remove/purge managed
    machines.
  prefs: []
  type: TYPE_NORMAL
- en: Decommissioning VMs – scheduled VM record purge
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the era of the cloud, we would like VM decommissioning to be done automatically
    so that our operations team can do more creative stuff than cleaning up the VCM
    database.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must have access to the SQL server where the VCM database is hosted. You
    must know the basics of SQL Management Studio.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The following stored procedure can be implemented on the VCM database (`VCM`)
    as a scheduled task. This will purge the records of the VMs that haven't been
    contacted in the last 3 weeks.
  prefs: []
  type: TYPE_NORMAL
- en: 'Change the value of `@expire int = xx` (the number of days for which the machine
    has not been contacted) in the script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Schedule a job in SQL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Expand the **SQL Server Agent** node, right-click on the **Jobs** node in **SQL
    Server Agent**, and select **New Job**:![Schedule a job in SQL](img/image_07_017.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **New Job** window, enter the name of the job and a description in the
    **General** tab:![Schedule a job in SQL](img/image_07_018.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Steps** on the left-hand side of the window and click on **New** at
    the bottom.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Steps** window, enter a step name and select the database you want
    the query to run against:![Schedule a job in SQL](img/image_07_019.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Paste in the `T-SQL` command you want to run in the command window, and click
    on **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Schedule** menu to the left of the **New Job** window and enter
    the schedule information (for example, daily and a time).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **OK**, and that should be it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The job will run on the schedule provided by you and clean the managed machines
    that have not been communicating for the last 21 days; if this seems too much,
    then the number can be changed in the script to a suitable number as per your
    requirements.
  prefs: []
  type: TYPE_NORMAL
