<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">User and Group Management</h1>
                </header>
            
            <article>
                
<p><span><span><span>Linux is a multiuser OS, so it is essential to have a basic understanding of user management. In this chapter, you will learn how to add, delete, modify, and suspend user accounts and grant them permissions to perform essential tasks. You will also learn how to apply password policies in</span> a <span>L</span><span>inux environment.</span></span></span></p>
<p>In this chapter, we will cover the following:</p>
<ul>
<li>Understanding different types of users and groups in CentOS 7</li>
<li>Executing commands as a superuser in CentOS 7</li>
<li>Creating, modifying, and deleting local user accounts</li>
<li>Creating, modifying, and deleting local group accounts</li>
<li>Managing user passwords and aging policies</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Understanding users and groups in CentOS 7</h1>
                </header>
            
            <article>
                
<p>Managing different types of users and groups is one of the primary roles of system administration. Using different types of user and group account as a role-based access control is configured into the system. Depending upon the privileges of user, we can restrict user access to various <span>system </span><span>resources.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Defining a user</h1>
                </header>
            
            <article>
                
<p>Each process running on our system is started by a user, to whom it belongs. Access to different files and directories by running processes is determined by the user associated with that process. Similarly, every file in our system is owned by some user and access to different files and directories on the system is restricted by user privileges. By default, new files created are owned by the user creating the file.</p>
<p>There are generally three types of user account in Linux systems:</p>
<ul>
<li>Root user (administrator)</li>
<li>System users (used by various services)</li>
<li>Regular users (normal users who carry out daily operations)</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Identifying the current user</h1>
                </header>
            
            <article>
                
<p>Since Linux is a multiuser OS, we can have multiple users logged in at the same time. The following table lists the different commands that are used to find information about the logged-in user and other information associated with users:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Command</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>$ who</kbd></p>
</td>
<td>
<p>Display currently logged in users</p>
</td>
</tr>
<tr>
<td>
<p><kbd>$ w</kbd></p>
</td>
<td>
<p>Display detailed information of currently logged in users</p>
</td>
</tr>
<tr>
<td>
<p><kbd>$ whoami</kbd></p>
</td>
<td>
<p>Display current user</p>
</td>
</tr>
<tr>
<td>
<p><kbd>$ id</kbd></p>
</td>
<td>
<p>Display information about current logged in user (such as User ID, primary group and secondary group, and SELinux context)</p>
</td>
</tr>
<tr>
<td>
<p><kbd>$ id &lt;username&gt;</kbd></p>
</td>
<td>
<p>Display information about the username passed as the first argument to the <kbd>id</kbd> command</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Examples of the <kbd>id</kbd> command, <kbd>who</kbd> command and the <kbd>w</kbd> command usage are shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d7be6526-23f0-44a7-88f5-4100d55aa5ca.png" width="1365" height="356"/></p>
<p>To show the user associated with the file, use the long-listing (<kbd>ls -l</kbd>) command, which displays user associations in the third column as shown in the following command line:</p>
<pre><strong>$ ls -l /tmp</strong></pre>
<p class="mce-root"/>
<p>To view the user associated with a process, use the <kbd>ps</kbd> command with the <kbd>u</kbd> option. Most of the time, the <kbd>a</kbd> option is also clubbed with the <kbd>ps</kbd> command to display all the processes associated with the Terminal as shown in the following command:</p>
<pre><strong>$ ps -au</strong></pre>
<p>All Linux users are assigned a unique integer number known as a <strong>User ID</strong> (<strong>UID</strong>). Specific UID numbers and ranges of numbers are used for particular purposes by Linux systems.</p>
<p>The following table that lists the various UID ranges and their description:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td style="width: 6.88705%" class="CDPAlignLeft CDPAlign">
<p class="CDPAlignCenter CDPAlign"><strong>UID</strong></p>
</td>
<td style="width: 92.2865%" class="CDPAlignLeft CDPAlign">
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 6.88705%">
<p>UID 0</p>
</td>
<td style="width: 92.2865%">
<p>Root user is always assigned UID as 0.</p>
</td>
</tr>
<tr>
<td style="width: 6.88705%">
<p>UID 1-999</p>
</td>
<td style="width: 92.2865%">
<p>UID 1-999 are assigned to system user accounts. Of this, UID 1-200 are statically assigned to system processes and UID 201–999 are reserved for <span>the </span>system. UID 201-999 are dynamically allocated in the system to an application upon its installation in CentOS 7.</p>
</td>
</tr>
<tr>
<td style="width: 6.88705%">
<p>UID 1000+</p>
</td>
<td style="width: 92.2865%">
<p>Regular user accounts have UID 1000 onward by default.</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>The mapping of user information, such as <kbd>username</kbd>, <kbd>UID</kbd>, <kbd>GID</kbd>, and the <kbd>home</kbd> directory of the user, is defined in a plain text file, <kbd>/etc/passwd</kbd>. The <kbd>/etc/passwd</kbd> file contains seven colon-separated fields, as follows:</p>
<pre><strong>username : password : UID : GID: Gecos : /home/dir : Default shell</strong></pre>
<p>The following table describes the various fields of the <kbd>/etc/passwd</kbd> file:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Field</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>username</kbd></p>
</td>
<td>
<p>It is <span>the </span>user login name associated with <span>the </span>UID for human readability (should be between 1 and 32 characters).</p>
</td>
</tr>
<tr>
<td>
<p><kbd>password</kbd></p>
</td>
<td>
<p>In this field, passwords were originally stored in encrypted format. Now, they are stored in <span>the </span><kbd>/etc/shadow</kbd><span> </span><span>file</span><span>.</span></p>
</td>
</tr>
<tr>
<td>
<p><kbd>UID</kbd></p>
</td>
<td>
<p>It is <span>the U</span>ID that system uses to identify a user:</p>
<p>UID 0: reserved for root</p>
<p>UID 1-200: reserved for predefined system accounts (static)</p>
<p>UID 201-999: reserved for system accounts (dynamic)</p>
<p>UID 1000+: reserved for regular user accounts</p>
</td>
</tr>
<tr>
<td>
<p><kbd>GID</kbd></p>
</td>
<td>
<p>It is <span>the </span>primary GID of <span>the </span>user, used by <span>the </span>system to associate <span>the </span>user to its primary group</p>
</td>
</tr>
<tr>
<td>
<p><kbd>Gecos</kbd></p>
</td>
<td>
<p>This field is optional and contains user-related extra information, such as user's full name, address, contact details, and so on</p>
</td>
</tr>
<tr>
<td>
<p><kbd>/home/dir</kbd></p>
</td>
<td>
<p>This field contains <span>the </span>absolute path of <span>the </span>user's home directory</p>
</td>
</tr>
<tr>
<td>
<p><kbd>Default shell</kbd></p>
</td>
<td>
<p>It is the absolute path of <span>the </span>user's default shell (this program runs when <span>the </span>user logs in to the system), which provides the users command prompt</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>The contents of last two lines in <kbd>/etc/passwd</kbd> file is shown in the following <span>the screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/7088b765-c9f2-4bdc-bb35-dc9f1ad39be8.png" style="width:28.50em;height:4.33em;" width="585" height="89"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Understanding groups in Linux</h1>
                </header>
            
            <article>
                
<p>Linux uses groups to organize users in the system. Groups are collections of accounts with certain shared features and access controls. Like users, a group also have a name, which is associated to a number known as the <strong>Group ID</strong> (<strong>GID</strong>), and is generally <span>the </span>same as the UID. Local group information is stored in the <kbd>/etc/group</kbd> file. There are two types of group associated with user accounts:</p>
<ul>
<li><strong>Primary groups</strong>:
<ul>
<li>Every user has only one primary group.</li>
<li>It is the default group of a user to which he belongs.</li>
<li>Each local user's primary group is defined by the GID number of <span>the </span>group listed in <span>the </span>third field of the <kbd>/etc/passwd</kbd> file.</li>
<li>By default, the primary group owns the new files created by the user.</li>
<li>Generally, the primary group of a newly created user will have the same name as the user. Each user is the only member of this private primary group of the user.</li>
</ul>
</li>
<li><strong>Supplementary groups</strong>:
<ul>
<li>Each can be associated with 0 or more supplementary groups.</li>
<li>Each local user's secondary group entry is defined in the last field of the <kbd>/etc/group</kbd> file. This file contains a comma-separated list of users in the last field, which determines the group membership of users for a group.</li>
<li>Supplementary group membership helps in implementing access rights, privileges, and security considerations to files and other resources in the system. The various fields of the <kbd>/etc/group</kbd> file are as follows:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 150px"><strong>groupname : password : GID : &lt;comma separated list of users who belong to this group&gt;</strong></pre>
<p><span>The following screenshot displays the contents of the last two line of the <kbd>/etc/group</kbd> file:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/13cdb025-f0e0-4a24-beaf-e5b0cb1b3038.png" style="width:22.92em;height:5.00em;" width="422" height="92"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Executing commands as superuser in CentOS 7</h1>
                </header>
            
            <article>
                
<p>Every operating system has an account to administer the resources of that system. In the case of CentOS Linux, this user account is known as <strong>root</strong>, very often called the <strong>superuser</strong>. The root account is the most privileged account in a Linux/Unix system. This account is used to carry out system administration tasks, such as managing user accounts and their passwords, managing software packages, modifying system files, and restarting system services. Extra caution must be taken while working as the root user as it has no security restrictions imposed on it. If the root account is compromised, then another person will have full administrative control of the system. The root account on Linux is equivalent to the local administrator account on Windows.</p>
<p>When you are logged in as <span>the </span>root user, the shell prompt displays <span>the </span>hash <kbd>#</kbd> symbol by convention to make <span>the </span>user aware that you are working as most <span>the </span>privileged user in <span>the </span>system.</p>
<p>In Linux, there are two commands, <kbd>su</kbd> and <kbd>sudo</kbd>, which are used to temporarily grant root access to a normal user. We will discuss these commands one by one.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Switching users with the su command</h1>
                </header>
            
            <article>
                
<p>The <strong>su</strong> (short for <strong>switch user</strong> or <strong>substitute user</strong>) command is used to switch into other user accounts. If a username is not specified as an argument to <span>the </span><kbd>su</kbd> command, it takes <span>the </span>root account into consideration. There are two ways of invoking this command, as follows:</p>
<ul>
<li><kbd>$ su - &lt;username&gt;</kbd>: This method starts a new <strong>login shell</strong> as another username specified. It sets up the shell environment as if this was a proper login as that user in the system.</li>
<li><kbd>$ su &lt;username&gt;</kbd>: This method starts a <strong>non-login shell</strong> as the username specified. It just launches the new shell with <span>the </span>current user environment settings, without invoking other username shell variables.<br/>
<br/>
In the absence of any username, <kbd>su –</kbd> invokes the root shell and asks for root credentials to be given at the prompt as shown in the following <span>screenshot</span>:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/29528b59-42db-49da-8d35-fdd5ff30051e.png" style="width:29.58em;height:5.92em;" width="565" height="113"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Disadvantages of using the su command to grant root access to a normal user</h1>
                </header>
            
            <article>
                
<p>Once the user has logged in as the root account using <kbd>su</kbd>, they can do anything for as long as they want, without being asked again for a root password. This command also has limited logging features.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using sudo to run commands as the root user</h1>
                </header>
            
            <article>
                
<p>In the previous method, the standard user temporarily becomes the root using the <kbd>su</kbd> command; all the privileges of root are granted by specifying the <kbd>root</kbd> password. This method is not suitable for running some programs as root as it gives unlimited privileges to the normal user. Granting privileges using <kbd>sudo</kbd> is less dangerous and is the preferred method.</p>
<p>The <kbd>sudo</kbd> feature is used to assign more limited privileges to user accounts, based on the settings in the <kbd>/etc/sudoers</kbd> file. In this method, <kbd>sudo</kbd> requires the user to enter their own password for authentication and not the password of the account they are trying to access. This method allows them to delegate system administration tasks, without giving them access to the root password. We can also restrict the privileges of the user to a specific subset of commands; that is, he can execute only a limited number of specified commands as root. Any command executed using <kbd>sudo</kbd> is logged by default into the <kbd>/var/log/secure</kbd> log file.</p>
<p>To execute just one command with root privilege, type <kbd>sudo &lt;command&gt;</kbd>. After the execution of the command, you will return to being a normal unprivileged user. An example of using <kbd>sudo</kbd> to execute just the <kbd>iptables</kbd> command with root privileges is shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/9427e4c3-00ce-4abc-8971-d4ba5555f33a.png" style="width:38.33em;height:10.58em;" width="907" height="251"/></p>
<p>The log of commands executed using <kbd>sudo</kbd> is stored in <kbd>/var/log/secure</kbd> as shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fd7ea3a7-ef85-4a88-bd3e-f0b15304cc27.png" width="1307" height="94"/></p>
<p>An example of granting a user rights to execute an admin command using <kbd>sudo</kbd> by making the required entry in the <kbd>/etc/sudoers</kbd> file is shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/d35457b7-a674-462b-911a-bbf1f4473d6a.png" style="width:40.42em;height:12.08em;" width="894" height="268"/></p>
<div class="packt_infobox">In CentOS 7, all members of group wheel can use <kbd>sudo</kbd> to run any command as root by specifying their own password. This was not set as the default rule in <span>the </span><kbd>/etc/sudoers</kbd> file in CentOS 7.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating, modifying, or deleting local user accounts</h1>
                </header>
            
            <article>
                
<p>There are multiple commands that can be used to manage local user accounts in CentOS 7. This section covers only <span>the </span>most popular commands available in CentOS 7 to manage local user accounts.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating a user with the useradd command</h1>
                </header>
            
            <article>
                
<p>The <kbd>useradd</kbd> command, when run without options, creates a user account with default parameters. The default parameters are read from the <kbd>/etc/login.defs</kbd> file and include parameters such as valid UID, GID number, default password aging rules, and so on. Values from this file are used while creating a new user only. The syntax of <kbd>useradd</kbd> is as follows:</p>
<pre><strong>$ useradd    &lt;username&gt;</strong></pre>
<p><kbd>useradd --help</kbd> will display options that can be used with <span>the </span><kbd>useradd</kbd> command to override the default parameters.</p>
<p>An example of using the <kbd>useradd</kbd> command to create a user account is shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b06354fa-db8f-4513-a3e6-29851e2d70de.png" style="width:28.33em;height:8.00em;" width="581" height="164"/></p>
<div class="packt_tip">Apart from <kbd>useradd</kbd>, we can also use <span>the </span><kbd>adduser</kbd> command to create a local user account in Linux. You can read more about <kbd>adduser</kbd> in <span>the </span>man page, using <span>the </span>man <kbd>adduser</kbd> command.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Modifying a user with the usermod command</h1>
                </header>
            
            <article>
                
<p>The <kbd>usermod</kbd> command is used with various options to modify the existing user account parameters. The <kbd>usermod --help</kbd> command will display the various options that can be used. The syntax of <kbd>usermod</kbd> is as follows:</p>
<pre><strong>$ usermod    -&lt;option&gt;     &lt;username&gt;</strong></pre>
<p>The following table lists the common options used with <kbd>usermod</kbd> and their descriptions:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td style="width: 47.5417%">
<p class="CDPAlignCenter CDPAlign"><strong>Options</strong></p>
</td>
<td style="width: 49.4583%">
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 47.5417%">
<p><kbd>usermod -c "Comments" &lt;username&gt;</kbd></p>
</td>
<td style="width: 49.4583%">
<p>Add comments, such as <span>the </span>user's full name, address, phone number, and so on, in <span>the </span>GECOS field.</p>
</td>
</tr>
<tr>
<td style="width: 47.5417%">
<p><kbd>usermod -g &lt;gid&gt; &lt;username&gt;</kbd></p>
</td>
<td style="width: 49.4583%">
<p>Modify the user's primary group.</p>
</td>
</tr>
<tr>
<td style="width: 47.5417%">
<p><kbd>usermod -G &lt;groupname&gt; &lt;username&gt;</kbd></p>
</td>
<td style="width: 49.4583%">
<p>Modify the user's secondary group.</p>
</td>
</tr>
<tr>
<td style="width: 47.5417%">
<p><kbd>usermod -a -G &lt;groupname&gt; &lt;user&gt;</kbd></p>
</td>
<td style="width: 49.4583%">
<p>Used with <span>the </span><kbd>-G</kbd> option only. It appends the user to the secondary group mentioned, without removing the user from other groups.</p>
</td>
</tr>
<tr>
<td style="width: 47.5417%">
<p><kbd>usermod -s &lt;shell&gt; &lt;username&gt;</kbd></p>
</td>
<td style="width: 49.4583%">
<p>Modify the login shell of the user account.</p>
</td>
</tr>
<tr>
<td style="width: 47.5417%">
<p><kbd>usermod -L &lt;username&gt;</kbd></p>
</td>
<td style="width: 49.4583%">
<p>Lock a user account.</p>
</td>
</tr>
<tr>
<td style="width: 47.5417%">
<p><kbd>usermod -U &lt;username&gt;</kbd></p>
</td>
<td style="width: 49.4583%">
<p>Unlock a user account.</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>An example of using the <kbd>usermod</kbd> command to modify the user's login shell is shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/06bd9360-098c-4d4e-99e9-a94d1d95db2c.png" style="width:21.92em;height:6.33em;" width="420" height="121"/></p>
<p>The following command is used to view the associated <kbd>groups</kbd> of a user:</p>
<pre><strong>$ groups &lt;username&gt;</strong><br/><strong>$ groups sam</strong></pre>
<p>The <kbd>usermod</kbd> command can be used to add a new secondary group in the existing secondary groups of a user. The following command will add a new secondary group wheel in the existing secondary groups of user <kbd>sam</kbd> as shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c263fdd6-f217-422e-91de-c7d270159559.png" style="width:21.42em;height:6.33em;" width="411" height="122"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deleting a user account with the userdel command</h1>
                </header>
            
            <article>
                
<p>The <kbd>userdel</kbd> command is used to delete the existing user account. The <kbd>userdel</kbd> command can be used in two ways as mentioned follows:</p>
<ul>
<li><kbd>userdel &lt;username&gt;</kbd>: This removes the user entry from <span>the </span><kbd>/etc/passwd</kbd> file, but leaves the user's home directory and mail intact. This way of deleting a user account is not recommended.</li>
<li><kbd>userdel -r &lt;username&gt;</kbd>: This removes the user and <span>the </span>user's home directory, along with <span>the </span>user's mail box. This will remove the files owned by the user along with <span>the </span>user's account from his home directory. An example of <kbd>userdel</kbd> command with option <kbd>-r</kbd> is shown in the following <span>screenshot</span>:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f280a2b2-622f-4fc6-8dc8-c50171a87542.png" style="width:21.17em;height:6.33em;" width="409" height="122"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating, modifying, or deleting local group accounts</h1>
                </header>
            
            <article>
                
<p>Groups are used for organizing users. A group is a collection of accounts with shared permissions. However, a group must exist before a user is added to that group. There are multiple commands that can be used to manage group accounts in CentOS 7. This section covers only <span>the </span>most popular commands available in CentOS 7 to manage local group accounts.</p>
<p>Control of group membership is managed with the <kbd>/etc/group</kbd> file. It lists the group, along with its members.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating supplementary groups with groupadd</h1>
                </header>
            
            <article>
                
<p>The <kbd>groupadd</kbd> command can be used with multiple options to create a supplementary group for user accounts, or a system user group.</p>
<p>The following table list the <kbd>groupadd</kbd> command with various options along with their description:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td style="width: 42.2804%">
<p class="CDPAlignCenter CDPAlign"><strong>Command</strong></p>
</td>
<td style="width: 54.7196%">
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 42.2804%">
<p><kbd>groupadd &lt;groupname&gt;</kbd></p>
</td>
<td style="width: 54.7196%">
<p>Creates a user private groups (GID 1000+) from the next available GID from the range given in <span>the </span><kbd>/etc/login.defs</kbd> file</p>
</td>
</tr>
<tr>
<td style="width: 42.2804%">
<p><kbd>groupadd -g GID &lt;groupname&gt;</kbd></p>
</td>
<td style="width: 54.7196%">
<p>Creates a user private group using the given GID</p>
</td>
</tr>
<tr>
<td style="width: 42.2804%">
<p><kbd>groupadd -r &lt;groupname&gt;</kbd></p>
</td>
<td style="width: 54.7196%">
<p>Creates a system group using a GID from the default system group's range (1-999), or as given in <span>the </span><kbd>/etc/login.defs</kbd> file.</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>An example of <kbd>groupadd</kbd> command usage is shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/b2bc8e9e-f0a2-4ab4-823e-8cdc901b824c.png" style="width:22.83em;height:8.00em;" width="406" height="143"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Modifying existing groups with the groupmod command</h1>
                </header>
            
            <article>
                
<p>The <kbd>groupmod</kbd> command is used to modify group properties such as the group's GID, group name, and so on. The example in following image shows how to use the <kbd>groupmod</kbd> command with the <kbd>-n</kbd> option to modify the <kbd>groupname</kbd> of a specified group:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/f2569645-922b-428e-a324-fb4bbe251555.png" style="width:26.25em;height:6.33em;" width="502" height="122"/></p>
<p>The <kbd>-g</kbd> option is used to assign a new GID to an existing <kbd>groupname</kbd> as shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/29449680-527a-458f-a590-ba3a64ec1d67.png" style="width:20.17em;height:8.08em;" width="400" height="161"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deleting a group with the groupdel command</h1>
                </header>
            
            <article>
                
<p>The <kbd>groupdel</kbd> command is generally used to delete a group from the system if it is not the primary group of any existing user. The following command line shows how to delete a group named <kbd>appusers</kbd> from the system using the <kbd>groupdel</kbd> command:</p>
<pre><strong>$ groupdel appusers</strong><br/><strong>$ tail -2 /etc/group</strong></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Managing user passwords and aging policies</h1>
                </header>
            
            <article>
                
<p>This section covers commands that are used to manage passwords and password aging parameters in <span>the </span>shadow password file available in CentOS 7.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Setting a user password using the passwd command</h1>
                </header>
            
            <article>
                
<p>The <kbd>passwd</kbd> command is used to either set the user's initial password or modify the user's existing password. The syntax of <span>the </span><kbd>passwd</kbd> command is as follows:</p>
<pre><strong>$ passwd    &lt;username&gt;</strong></pre>
<p>The root user can set the password for any user to any value without knowing his current password. For a regular user, <span>the </span>default policy is to use at least an eight-character password, and it should not be a dictionary word, or the username, or a previous password. An example updating a user's password using the <kbd>passwd</kbd> command is shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/c946d58e-3ec7-4fd8-b95c-02e87ec09ed4.png" style="width:29.67em;height:7.33em;" width="577" height="143"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Understanding the shadow password file</h1>
                </header>
            
            <article>
                
<p>In the early days of Linux's evolution, encrypted passwords were stored in a human-readable file, <kbd>/etc/passwd</kbd>. This was considered a safe mechanism for keeping passwords until dictionary attacks on encrypted passwords became more prevalent. Now, to harden Linux security, the encrypted passwords (salted password hashes) are stored in <span>the </span><kbd>/etc/shadow</kbd> file. This file also contains password aging policy parameters. Only those with root access can modify or read this file. We can view the last line of this file by executing the command line given as follows:</p>
<pre><strong># tail -1 /etc/shadow</strong></pre>
<p>On execution of <span>the </span>preceding command, we get the following output, which displays the encrypted password along with <span>the </span>salt and various password aging parameters:</p>
<pre><strong>jack:$6$cKc/hj8V$JZPyiz6TMpz/YpPtSPdNARPd/gXxLqm3c0qHZinNmweXEpM/IMBYGiBYXZw7OuzLnr0YkFdZZifPvywkJYuqv0:17783:0:99999:7:::</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p>In the preceding output, the second field of <span>the </span><kbd>/etc/shadow</kbd> file is the password field and contains <span>the </span>following three pieces of information, separated by a <kbd>$</kbd> symbol, in <span>the </span><kbd>/etc/shadow</kbd> file:</p>
<ul>
<li><kbd>6</kbd>: It represents the hashing algorithm used to encrypt the password. The number 1 indicates MD5 hashing, number 5 indicates SHA-256 hashing, and number 6 indicates the SHA-512 hashing algorithm.</li>
<li><kbd>cKc/hj8V</kbd>: It represents the randomly chosen salt used to encrypt the hash. This salt and the unencrypted password are combined and encrypted to create the password hash. Use of the salt prevents two or more users with the same password from having identical entries in the <kbd>/etc/shadow</kbd> file.</li>
<li><kbd>JZPyiz6TMpz/YpPtSPdNARPd/gXxLqm3c0qHZinNmweXEpM/IMBYGiBYXZw7OuzLnr0YkFdZZifPvywkJYuqv0</kbd>: It is <span>the </span>encrypted hash.</li>
</ul>
<p>When <span>the </span>user enters his password at <span>the </span>login prompt, <span>the </span>system looks up the entry for the user in <kbd>/etc/shadow</kbd>, then combines the salt of the user with <span>the </span>unencrypted password and generates a hash value using <span>the </span>specified hashing algorithm. If the password matches, the user gets logged in; otherwise, the login attempt fails.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Understanding password aging parameters</h1>
                </header>
            
            <article>
                
<p>The <kbd>chage</kbd> command is used to list the existing password aging policy or to modify the policy. The <kbd>/etc/shadow</kbd> file contains nine colon-separated fields, which include <span>both the </span><span>encrypted password and <span>the </span>password aging policy. The following is the format of <span>the </span>information contained in <span>the </span></span><kbd>/etc/shadow</kbd> <span>file:</span></p>
<pre><strong>name : password : lastchange : minage : maxage : warning : inactive : expire : blank</strong></pre>
<p>The following table lists <span>the </span><kbd>/etc/shadow</kbd> file fields and their descriptions:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Field</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td>
<p>Login name</p>
</td>
<td>
<p>It is <span>the </span>user account login name on <span>the </span>local system.</p>
</td>
</tr>
<tr>
<td>
<p>Password</p>
</td>
<td>
<p>It is an encrypted password. If this field contains <span>the </span><kbd>!</kbd> symbol, then it means <span>the </span>password is locked.</p>
</td>
</tr>
<tr>
<td>
<p>Lastchange</p>
</td>
<td>
<p>It is <span>the </span>date of <span>the </span>last password change, represented by <span>the </span>number of days since <kbd>01.01.1970</kbd>.</p>
</td>
</tr>
<tr>
<td>
<p>Minimum age</p>
</td>
<td>
<p>It is <span>the </span>minimum number of days before which a password cannot be changed.<kbd>0</kbd> in this field means no minimum day requirement.</p>
</td>
</tr>
<tr>
<td>
<p>Maximum age</p>
</td>
<td>
<p>It is <span>the </span>maximum number of days after which <span>the </span>password must be changed.</p>
</td>
</tr>
<tr>
<td>
<p>Warning Period</p>
</td>
<td>
<p>It is <span>the </span>number of days before password expiry, when <span>the </span>user starts getting a warning to change his password.<kbd>0</kbd> in this field means no warning would be given.</p>
</td>
</tr>
<tr>
<td>
<p>Inactive</p>
</td>
<td>
<p>It is the number of days an account remains active after a password has expired. A user can still log in during this inactive period and change his password. After the specified number of days, the account will get locked and become inactive.</p>
</td>
</tr>
<tr>
<td>
<p>Expiry date</p>
</td>
<td>
<p>It is the account expiration date, represented as the number of days since <kbd>01.01.1970</kbd>.</p>
</td>
</tr>
<tr>
<td>
<p>Blank</p>
</td>
<td>
<p>A blank field reserved for future use.</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>By default, passwords are set to not expire. Forcing passwords to expire is part of a strong security policy. We can modify the default expiration settings by making changes in <span>the </span><kbd>/etc/login.defs</kbd> file. <span><span>We can</span></span> change the password aging policy using the <kbd>chage</kbd> command. The syntax of the <kbd>chage</kbd> command is given follows:</p>
<pre><strong>$ chage    [option]    &lt;username&gt;</strong></pre>
<p>An example of the <kbd>chage</kbd> command to list all existing password aging policy parameters for a user is shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/69117902-93a4-4e4a-abad-853b7e208f57.png" style="width:38.67em;height:9.75em;" width="734" height="185"/></p>
<p>The following table lists the various options that are used with the <kbd>chage</kbd> command and their descriptions:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td style="width: 36.7442%">
<p class="CDPAlignCenter CDPAlign"><strong>Option</strong></p>
</td>
<td style="width: 62.2982%">
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
</tr>
<tr>
<td style="width: 36.7442%">
<p><kbd>Chage -l &lt;username&gt;</kbd></p>
</td>
<td style="width: 62.2982%">
<p>Lists all the user's current aging parameter settings</p>
</td>
</tr>
<tr>
<td style="width: 36.7442%">
<p><kbd>Chage -d 0 &lt;username&gt;</kbd></p>
</td>
<td style="width: 62.2982%">
<p>Forces password change on next login</p>
</td>
</tr>
<tr>
<td style="width: 36.7442%">
<p><kbd>Chage -m 3 &lt;username&gt;</kbd></p>
</td>
<td style="width: 62.2982%">
<p>Sets the minimum number of days a<span> </span>user can keep a password</p>
</td>
</tr>
<tr>
<td style="width: 36.7442%">
<p><kbd>Chage -M 30 &lt;username&gt;</kbd></p>
</td>
<td style="width: 62.2982%">
<p>Sets the maximum number of days a user can keep a password (<kbd>-1</kbd> here means unlimited)</p>
</td>
</tr>
<tr>
<td style="width: 36.7442%">
<p><kbd>Chage -W 7 &lt;username&gt;</kbd></p>
</td>
<td style="width: 62.2982%">
<p>Sets the number of days at which the user starts getting warnings before a password change</p>
</td>
</tr>
<tr>
<td style="width: 36.7442%">
<p><kbd>Chage -d YYY-MM-DD &lt;username&gt;</kbd></p>
</td>
<td style="width: 62.2982%">
<p>Sets the last change date for a password (<span>the </span><kbd>/etc/shadow</kbd> file stores the number of days starting from 1 Jan 1970)</p>
</td>
</tr>
<tr>
<td style="width: 36.7442%">
<p><kbd>Chage -E YYYY-MM-DD &lt;username&gt;</kbd></p>
</td>
<td style="width: 62.2982%">
<p>Sets the password expiration date for <span>the </span>user (<span>the </span><kbd>/etc/shadow</kbd> file stores the number of days starting from 1 Jan 1970)</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>An example of the <kbd>chage</kbd> command to modify various parameters is shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/fb0f8bcc-f569-4aec-8b60-2eb27ca42cda.png" style="width:37.58em;height:10.33em;" width="738" height="203"/></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Restricting user access</h1>
                </header>
            
            <article>
                
<p>Once the account expiration date set using <span>the </span><kbd>chage</kbd> command is reached, <span>the </span>user cannot log in to the system interactively. Some parameters of <span>the </span><kbd>chage</kbd> command can be set using <kbd>useradd</kbd> and <kbd>usermod</kbd>. The <kbd>usermod</kbd> command can be used to lock an account with the <kbd>-L</kbd> option as shown in follows command line:</p>
<pre><strong># usermod -L jack</strong><br/><strong># su - jack</strong></pre>
<p>We can also unlock the user account using <span>the </span><kbd>-U</kbd> option as shown in the following command line:</p>
<pre><strong># usermod -U jack</strong></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Fake shell or nologin shell</h1>
                </header>
            
            <article>
                
<p>At times, we may need a user account with a password for authentication with a system, but do not require an interactive shell with that username. This helps in preventing the user account being used for logging in to the system with that password. In those scenarios, we can set the user's shell to <kbd>/sbin/nologin</kbd>. If the user tries to log in to system, the <kbd>nologin</kbd> shell closes the connection of the user as shown in the following <span>screenshot</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="Images/421b31f1-fcdc-46a3-a0e1-9917879fecea.png" style="width:26.17em;height:5.25em;" width="522" height="104"/></p>
<p>An example of such a situation could be a mail server, where a user account is needed to store mail and passwords for <span>the </span>user to authenticate with <span>the </span>mail client and retrieve their mail; however, if <span>the </span><kbd>/sbin/nologin</kbd> shell is assigned, then <span>the </span>user cannot log in to <span>the </span>system using that account.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we began by learning about the different types of users and groups on CentOS 7. This was followed by understanding the difference between <kbd>su</kbd> and <kbd>sudo</kbd> for temporarily granting root privileges to the user. Then, we learned about the management of local user accounts and local user groups. Finally, we looked at how passwords are set and stored in Linux and how password aging policies are implemented in CentOS 7.</p>
<p>In the next chapter, we will learn about managing file permissions in CentOS 7.</p>


            </article>

            
        </section>
    </div>



  </body></html>