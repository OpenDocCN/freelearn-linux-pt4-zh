- en: Chapter 2. Configuring and Administering Ubuntu Server
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二章。配置和管理 Ubuntu Server
- en: After installing the Ubuntu Server, you will need to administrate it. If you
    are a newbie, this chapter is mandatory for you. So follow it to the letter. If
    you are an advanced Linux user who has experience working with other distributions,
    you can consider the experience of trying a new distribution similar to that of
    driving a new car. The car certainly has a steering wheel, a gas pedal, and a
    brake, but it still takes you a minute to adjust the mirrors, find out where the
    gauges and controls are, and adjust the seat until you feel comfortable. Think
    of this chapter as that minute or two behind the wheel of a new car.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装 Ubuntu Server 后，您需要进行管理。如果您是新手，本章对您来说是必不可少的。因此，请严格按照指南操作。如果您是有经验的 Linux
    用户，并且熟悉其他发行版的工作方式，您可以考虑尝试类似于驾驶新车的体验。汽车当然有方向盘、油门和刹车，但您仍然需要花一点时间调整镜子，找到仪表和控制装置的位置，并调整座位直到感觉舒适。将本章视为在新车驾驶座位后花费的那一两分钟。
- en: 'To reach this goal, we will follow this plan:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 为了达成这个目标，我们将按照以下计划进行：
- en: Administering using the command line
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用命令行进行管理
- en: The package management of an Ubuntu Server
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu Server 的软件包管理
- en: The network configuration for an Ubuntu Server
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu Server 的网络配置
- en: Performing essential system administration tasks
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行基本系统管理任务
- en: Administering using the command line
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用命令行进行管理
- en: Entire books have been written on command-line tools and how to use them effectively.
    In this section, we will have a look at the essentials one that we need. If you
    are an experienced administrator, feel free to skip to the next section. Just
    keep in mind the following note, that's all.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 有关命令行工具及其有效使用方式，已经有整本书专门写作。在本节中，我们将查看我们需要的基本工具。如果您是经验丰富的管理员，可以跳过到下一节。只需记住以下注意事项即可。
- en: Note
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Note that unlike other Linux distributions, Ubuntu doesn''t allow the use of
    the super user as a root by default; it is disabled for security reasons. So,
    when you would like to run a command with the root privileges, you should run
    it with the `sudo` keyword before doing so. You will be asked to enter your password
    (the one that you used when installing the Ubuntu Server). For example, if you
    would like to edit the `/etc/hosts` file, run the following code:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，与其他 Linux 发行版不同，Ubuntu 默认禁用超级用户作为 root 用户使用，出于安全考虑。因此，当您希望以 root 权限运行命令时，应在命令前加上
    `sudo` 关键字。系统会要求您输入密码（安装 Ubuntu Server 时使用的密码）。例如，如果您希望编辑 `/etc/hosts` 文件，请运行以下代码：
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: If you would like to activate the root account (which is not recommended) or
    allow other users to run `sudo`, you can follow the detailed tutorial at. [https://help.ubuntu.com/community/RootSudo](https://help.ubuntu.com/community/RootSudo).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想激活 root 帐户（不推荐），或允许其他用户运行 `sudo`，您可以按照详细的教程操作。[https://help.ubuntu.com/community/RootSudo](https://help.ubuntu.com/community/RootSudo).
- en: 'Now, let''s start with what I consider to be the most important command for
    a Linux administrator—`man`, or the interface for online reference manuals. It
    gives you the necessary information about any command that you would like to use
    (if it is documented of course, which is true in most cases). We use it by typing
    the `man` keyword just before the command that we would like to be informed about.
    We use arrows keys to navigate, the `/` character to perform a search, the *Enter*
    key to view the next line, the *spacebar* to view the next page, and the *q* character
    to quit the interface. For example, the following screenshot shows what you will
    see when you run the `man ls` command:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们从我认为对 Linux 管理员最重要的命令开始—`man`，或在线参考手册的界面。它为您提供任何您想使用的命令的必要信息（当然，前提是该命令已经有文档，这在大多数情况下是真实的）。我们通过在希望了解的命令前输入
    `man` 关键字来使用它。我们使用箭头键进行导航，`/` 字符进行搜索，*Enter* 键查看下一行，*空格键* 查看下一页，`q` 字符退出界面。例如，以下截图展示了当您运行
    `man ls` 命令时会看到的内容：
- en: '![Administering using the command line](img/B04800_02_01.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![使用命令行进行管理](img/B04800_02_01.jpg)'
- en: The `man` pages are grouped together in sections, with one section per topic.
    For example, the `man` pages in the first section are executable programs or `shell`
    commands, the ones in section 2 are **system calls** (functions provided by the
    kernel), and so on. You can see all the sections on running the `man man` command.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '`man` 页面按章节分组，每个章节对应一个主题。例如，第一个章节的 `man` 页面是可执行程序或 `shell` 命令，第二个章节是 **系统调用**（由内核提供的函数），依此类推。你可以通过运行
    `man man` 命令查看所有章节。'
- en: 'Another useful command is `apropos`, which shows the section and `man` page
    where the word in the parameter was found. For example, when searching the `man`
    pages/sections in which the `pwd` command exists, we use the following command:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有用的命令是 `apropos`，它显示参数中找到的单词所在的章节和 `man` 页面。例如，当搜索包含 `pwd` 命令的 `man` 页面/章节时，我们使用以下命令：
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Let''s consider a case where a command exists under more than one section,
    as follows:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们考虑一个命令出现在多个章节中的情况，如下所示：
- en: '[PRE2]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You can view the information related to this section by using `man <the_section_number>
    <the_command>` (for example, `man 5 smbpasswd`). Alternatively, use `man -a <the_command>`
    if you would like to see all the `man` page sections in succession for that command
    (for example, `man -a smbpasswd`). If you omit the section number, `man` will
    return the `man` page from the first section that it finds.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过使用 `man <章节号> <命令>` 来查看与该章节相关的信息（例如，`man 5 smbpasswd`）。或者，如果你想查看该命令所有 `man`
    页面章节的内容，可以使用 `man -a <命令>`（例如，`man -a smbpasswd`）。如果省略章节号，`man` 会返回它找到的第一个章节的
    `man` 页面。
- en: 'The `ls` command lists files and directories under the path passed in the parameter
    (the actual `.` directory is the default choice). Some options are very helpful.
    For example, with the `-a` option, we can list the cached items. With the `-l`
    option, we can get additional information such as the file size and permissions:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '`ls` 命令列出参数中指定路径下的文件和目录（实际的 `.` 目录是默认选择）。有些选项非常有用。例如，使用 `-a` 选项，我们可以列出缓存项目。使用
    `-l` 选项，我们可以获取额外的信息，如文件大小和权限：'
- en: '[PRE3]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `pwd` command gives the current path (working directory).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '`pwd` 命令给出当前路径（工作目录）。'
- en: The `history` command lists the last commands that you ran.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '`history` 命令列出了你运行的最后几个命令。'
- en: The `chmod` command allows you to change file permissions. Use it carefully,
    especially when you use the `*` magic card instead of a filename coupled with
    the `-R` option that runs it recursively. From the same family, we will find the
    `chown` and `chgrp` commands, which allow you to change the owner and group of
    a file respectively.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '`chmod` 命令允许你更改文件权限。使用时请小心，尤其是在使用 `*` 魔法符号代替文件名并配合 `-R` 选项递归执行时。与此相关的命令还有 `chown`
    和 `chgrp`，它们分别允许你更改文件的所有者和组。'
- en: The `top` command gives you a list of the processes that are running on your
    Ubuntu Server; they are sorted by the CPU usage. This list is updated in real
    time, and it is limited by the size of the screen. If you want to see the whole
    list of the processes that are running on the system, you can run the famous `ps
    -ef | less` command. Here, we pipe the result of this command by using the `|`
    character as an input to the `less` command to see the result output page by page,
    `less` works like the famous `more` command. Besides, it allows you to surf forward
    and backward.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '`top` 命令列出正在你 Ubuntu 服务器上运行的进程；这些进程按 CPU 使用率排序。该列表实时更新，且受屏幕大小限制。如果你想查看系统上运行的所有进程列表，可以运行著名的
    `ps -ef | less` 命令。在这里，我们通过使用 `|` 字符将该命令的结果传递给 `less` 命令，按页面逐步查看结果输出，`less` 的功能类似于著名的
    `more` 命令。此外，`less` 允许你向前和向后浏览。'
- en: Tip
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Note that piping (using the `|` character) is a mechanism used to optimize commands
    output by passing the output of the first command (the command before the `|`
    character) as an input to the second command (the command after the `|` character).
    We can use a cascade of pipes using the `|` character in a single command line.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，管道（使用 `|` 字符）是一种优化命令输出的机制，通过将第一个命令（`|` 字符前的命令）的输出作为输入传递给第二个命令（`|` 字符后的命令）。我们可以在单个命令行中使用多个管道进行级联。
- en: There are some useful shortcuts in the server environment (no graphic interface),
    such as *Ctrl+C*, which is used to quit a command that is not responding (or is
    simply taking too long to complete), *Ctrl+D*, which is used to send the **end
    of file** (**EOF**) signal to a command, and finally *Ctrl+Z*, which is used to
    stop the command that is running in the foreground (on the console). Even though
    it does stop the command, it does not terminate it. Instead, it is just paused.
    We can resume it easily either in the background via the `bg` command or again
    in the foreground with the `fg` command. To do this, you need the job number associated
    with the program that you want to start again. You can get a list of the job numbers
    by using the `jobs` command.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在没有图形界面的服务器环境中，有一些有用的快捷键，比如 *Ctrl+C*，用于退出未响应的命令（或执行时间过长的命令），*Ctrl+D*，用于向命令发送
    **文件结束**（**EOF**）信号，最后是 *Ctrl+Z*，用于停止正在前台运行的命令（在控制台上）。尽管它会停止命令的执行，但并不会终止它。相反，它只是被暂停了。我们可以通过
    `bg` 命令将其恢复到后台，或者通过 `fg` 命令再次将其恢复到前台。要做到这一点，你需要知道与程序相关联的作业号。你可以通过 `jobs` 命令获取作业号列表。
- en: For file management, you will need to use `mkdir` for directory creation, `cd`
    to enter a directory, `touch` to create a file, and `cat` to view its contents.
    For directory/file management, you can use `cp` for copy, `rm` for remove, and
    `mv` for move/rename.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 对于文件管理，你需要使用 `mkdir` 来创建目录，`cd` 进入目录，`touch` 创建文件，`cat` 查看文件内容。对于目录/文件管理，你可以使用
    `cp` 进行复制，`rm` 进行删除，`mv` 进行移动/重命名。
- en: To edit a file, you can use either of the two famous editors, `vi` or `vim`.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 要编辑文件，你可以使用两个著名的编辑器中的任意一个，`vi` 或 `vim`。
- en: Tip
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Note that these are the most useful CLI commands. In the following sections
    and chapters in this book, we will have a look at other commands. An explanation
    for each of the commands will be given every time we need them. In case you would
    like to take advantage of a specific command, you can use the `man` command, as
    seen previously.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，这些是最常用的 CLI 命令。在本书的后续章节中，我们将会介绍其他命令。每当我们需要使用某个命令时，都会为其提供解释。如果你希望充分利用某个特定的命令，可以使用之前提到的
    `man` 命令。
- en: Note
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you would like to learn more about Linux **command line** (**CLI**), I recommend
    that you refer to the book available at [http://linuxcommand.org/tlcl.php](http://linuxcommand.org/tlcl.php).
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想深入了解 Linux **命令行**（**CLI**），我建议你参考[http://linuxcommand.org/tlcl.php](http://linuxcommand.org/tlcl.php)上的书籍。
- en: It is mandatory to know the basics of the `vi`/`vim` editors when you are working
    in a server environment. Learning how to use `vi` is beyond the scope of this
    book. So, you have to make some effort to do it yourself. For more help, you can
    find good basic training for the `vi` editor at [http://www.cs.colostate.edu/helpdocs/vi.html](http://www.cs.colostate.edu/helpdocs/vi.html).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在服务器环境中工作时，了解基本的 `vi`/`vim` 编辑器是强制性的。学习如何使用 `vi` 超出了本书的范围。所以，你需要自己做一些努力来学习它。如果需要更多帮助，你可以在[http://www.cs.colostate.edu/helpdocs/vi.html](http://www.cs.colostate.edu/helpdocs/vi.html)找到一些很好的
    `vi` 编辑器基础培训。
- en: The package management for an Ubuntu Server
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Ubuntu 服务器的软件包管理
- en: Ubuntu, like other Debian-based systems, uses the Debian package format, such
    as `.deb` packages. I prefer using a `.deb` package when installing software instead
    of `tarball` archives because on one hand, unlike the case with `tarball`, we
    can get traceability for every piece of software installed on your system with
    `.deb` packages. On the other hand, because only a `.deb` package can request
    the package database on your server via the package manager and get information
    about the installed and available packages on your system, the package manager
    takes care of installing the missing dependencies automatically.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu 和其他基于 Debian 的系统一样，使用 Debian 软件包格式，如 `.deb` 软件包。在安装软件时，我更喜欢使用 `.deb`
    软件包，而不是 `tarball` 压缩包。因为一方面，与 `tarball` 不同，使用 `.deb` 软件包可以让我们追踪系统中安装的每个软件包。另一方面，只有
    `.deb` 软件包可以通过包管理器请求服务器上的软件包数据库，并获取有关已安装和可用软件包的信息，包管理器会自动处理缺失的依赖项。
- en: Package repositories
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 软件包库
- en: 'Ubuntu packages exist in repositories, which are collections of packages, in
    a pre-compiled binary format that can be located either on different medias, such
    as CD-ROMs, or on the Internet. There are four official repositories provided
    by Canonical (the company that created Ubuntu):'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu 软件包存储在软件库中，软件库是一个预编译的二进制格式的软件包集合，这些软件包可以存储在不同的介质上，例如 CD-ROM，或通过互联网获取。Canonical（Ubuntu
    的创建公司）提供了四个官方软件库：
- en: '`main`: This is the repository that contains software distributed under a completely
    free license and supported by the Ubuntu team.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`main`：这是一个包含完全自由许可下分发的软件，并且由 Ubuntu 团队支持的仓库。'
- en: '`restricted`: This is the repository that contains software that may not be
    under a completely free license but is supported by the Ubuntu team, such as drivers
    for specific hardware components.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`restricted`：这是一个包含可能不完全符合自由许可的软件，但由 Ubuntu 团队支持的仓库，通常包含特定硬件组件的驱动程序。'
- en: '`universe`: This repository contains most of the open source software available
    in the Linux world and which exists under licenses that may not be as free as
    the others. Software in this repository is not supported by the Ubuntu team.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`universe`：这个仓库包含大多数 Linux 世界中的开源软件，这些软件可能不完全符合与其他软件相同的自由许可。该仓库中的软件不由 Ubuntu
    团队提供支持。'
- en: '`multiverse`: Here, you will find software that does not meet the free concept
    standards of software. Software in this repository is not supported by the Ubuntu
    team.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`multiverse`：在这里，你会找到一些不符合自由软件标准的软件。该仓库中的软件不由 Ubuntu 团队提供支持。'
- en: There are a lot of other repositories. Many of them are owned by software editors
    and contain packages related to their products. Most of them are provided by the
    community and exist under the **Personal Package Archives** (**PPA**) which is
    a repository software for Ubuntu (visit [https://launchpad.net/ubuntu/+ppas](https://launchpad.net/ubuntu/+ppas)
    for more information).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 还有许多其他的仓库。它们中的许多是由软件编辑器拥有并包含与其产品相关的软件包。大多数是由社区提供的，并且存在于 **个人软件包档案** (**PPA**)
    下，这是一个适用于 Ubuntu 的仓库软件（更多信息请访问 [https://launchpad.net/ubuntu/+ppas](https://launchpad.net/ubuntu/+ppas)）。
- en: 'The managing of repositories on your Ubuntu Server is done in the `/etc/apt/sources.list`
    file. Here''s a sample of this file from a fresh Ubuntu Server installation:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Ubuntu 服务器上管理仓库是在 `/etc/apt/sources.list` 文件中完成的。以下是一个新安装的 Ubuntu 服务器的该文件示例：
- en: '[PRE4]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: After modifying the sources list file, update the packages database using the
    `sudo apt-get update` command. We will have a look at how to work with the `apt`
    tool in the next section.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在修改了源列表文件后，使用 `sudo apt-get update` 命令更新软件包数据库。接下来我们将看看如何使用 `apt` 工具。
- en: Package management utilities
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 软件包管理工具
- en: In Ubuntu, there are a few package management utilities, especially in a non-graphical
    environment such as those of most server installations. In the following section,
    you will discover the three most used tools—`dpkg`, `aptitude` and `apt`—besides
    the famous `tasksel` utility.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Ubuntu 中，有一些软件包管理工具，尤其是在大多数服务器安装的非图形环境中。在接下来的部分，你将了解除了著名的 `tasksel` 工具外，最常用的三个工具——`dpkg`、`aptitude`
    和 `apt`。
- en: Note
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that working with more than one package management database can be confusing.
    I recommend that you choose one package management system to work with and stick
    to it. For the rest of this book, we will use `apt`.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，使用多个软件包管理数据库可能会导致困惑。我建议你选择一个软件包管理系统并坚持使用它。接下来我们将使用 `apt` 来进行操作。
- en: The dpkg tool
  id: totrans-53
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: dpkg 工具
- en: This tool is used to manage (install, remove, and build) local `.deb` packages
    from a CD-ROM or some other disk storage. It doesn't automatically download and
    install packages from repositories and manage dependencies.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具用于管理（安装、移除和构建）来自 CD-ROM 或其他磁盘存储的本地 `.deb` 软件包。它不会自动从仓库下载和安装软件包，也不会管理依赖关系。
- en: 'The `dpkg` tool is powerful. It can be used when working with locally installed
    packages. For example, it helps you list all the packages installed on your system,
    even the ones installed with other utilities, such as `apt`. To see that, you
    should run the command `dpkg -l` (because the output of this command is a huge
    list you can run `dpkg -l` command less to check them page per page). The following
    is the result of `dpkg -l | less` on our server:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '`dpkg` 工具非常强大。当处理本地安装的软件包时，它可以派上用场。例如，它可以帮助你列出系统上安装的所有软件包，包括那些使用其他工具（如 `apt`）安装的软件包。要查看这些内容，你可以运行命令
    `dpkg -l`（由于该命令的输出是一个巨大的列表，你可以运行 `dpkg -l` 命令并使用 `less` 分页查看）。以下是我们服务器上执行 `dpkg
    -l | less` 的结果：'
- en: '![The dpkg tool](img/B04800_02_02.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![The dpkg tool](img/B04800_02_02.jpg)'
- en: 'The `dpkg` command can also list the different files installed with a specific
    package. In this case, we should use the `-l` option, with the name of the package
    as a parameter. As shown in the following screenshot, we listed the files installed
    with the `isc-dhcp-common` package:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '`dpkg` 命令还可以列出与特定软件包一起安装的不同文件。在这种情况下，我们应该使用 `-l` 选项，并将软件包的名称作为参数。如以下截图所示，我们列出了与
    `isc-dhcp-common` 软件包一起安装的文件：'
- en: '![The dpkg tool](img/B04800_02_03.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![dpkg 工具](img/B04800_02_03.jpg)'
- en: 'On the other hand, we can check for a specific file within the package that
    it was installed in by using the `-S` option. As shown in the following screenshot,
    the `/usr/bin/omshell` file was installed with the `isc-dhcp-common` package:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，我们可以使用 `-S` 选项检查包中安装的特定文件。如下面的截图所示，`/usr/bin/omshell` 文件是与 `isc-dhcp-common`
    包一起安装的：
- en: '![The dpkg tool](img/B04800_02_04.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![dpkg 工具](img/B04800_02_04.jpg)'
- en: Note
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that many files are automatically generated during package installation,
    and even though they are on the file system, `dpkg -S` may not know which package
    they belong to.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在安装包时会自动生成许多文件，尽管它们存在于文件系统中，`dpkg -S` 可能无法识别它们属于哪个包。
- en: 'With `dpkg`, we can install the local `.deb` packages by using the `-i` option:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `dpkg`，我们可以通过 `-i` 选项安装本地的 `.deb` 包：
- en: '[PRE5]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: We can also remove packages by using the `-r` option, but it is not recommended
    because `dpkg` doesn't handle dependencies. If you use `dpkg` to remove a specific
    package that one or more programs depend on, you may break those programs.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以通过 `-r` 选项删除包，但不推荐这么做，因为 `dpkg` 不处理依赖关系。如果你使用 `dpkg` 删除一个程序依赖的包，可能会导致这些程序崩溃。
- en: The aptitude tool
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: aptitude 工具
- en: The `aptitude` tool is based on **apt** (**Advanced Packaging Tool**), which
    will be discussed later in this chapter, but this tool is more user-friendly.
    You can use aptitude either with the `search` keyword to search for a specific
    word in the package description database, or with the `show` keyword to display
    a lot of useful information about a specific package. However, the most helpful
    use of `aptitude` is that you can launch it without a keyword and you will get
    a menu-driven text-based frontend for `apt`. This interface is suitable for server
    environments (usually non graphical tool). It helps users perform a lot of tasks
    automatically.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '`aptitude` 工具基于 **apt**（**高级包管理工具**），这一部分将在本章后面讨论，但这个工具更加用户友好。你可以使用 `aptitude`，通过
    `search` 关键字在包描述数据库中搜索特定的词，或者使用 `show` 关键字来显示特定包的很多有用信息。然而，`aptitude` 最有帮助的用法是，你可以在不加任何关键字的情况下启动它，这时你将看到一个基于菜单的文本界面来操作
    `apt`。这个界面适用于服务器环境（通常是非图形化工具）。它帮助用户自动执行许多任务。'
- en: 'When you execute the `sudo aptitude` command, you will see the following interface:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 当你执行 `sudo aptitude` 命令时，你会看到以下界面：
- en: '![The aptitude tool](img/B04800_02_05.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![aptitude 工具](img/B04800_02_05.jpg)'
- en: 'You can view the `Package` menu by using the *Ctrl+T* shortcut and navigate
    by using the arrow keys, as shown in the following screenshot:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过使用 *Ctrl+T* 快捷键查看 `Package` 菜单，并使用箭头键进行导航，如下图所示：
- en: '![The aptitude tool](img/B04800_02_06.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![aptitude 工具](img/B04800_02_06.jpg)'
- en: You can also use `aptitude` as a command-line interface (a non-menu-driven interface)
    in a way that is similar to how you use `apt` as a command-line interface. For
    example, you can use `sudo aptitude install bind9` to install the `bind9` DNS
    server.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以像使用 `apt` 命令行界面那样使用 `aptitude` 命令行界面（非菜单驱动界面）。例如，你可以使用 `sudo aptitude install
    bind9` 来安装 `bind9` DNS 服务器。
- en: The apt tools
  id: totrans-73
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: apt 工具
- en: The `apt` is used to download and install packages from online repositories.
    The `apt` commands (`apt-get`, `apt-cache`, and so on) are normally used to work
    with online software. However, they can also be used to install packages locally.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '`apt` 用于从在线仓库下载并安装包。`apt` 命令（如 `apt-get`、`apt-cache` 等）通常用于与在线软件配合使用。然而，它们也可以用于安装本地包。'
- en: The `apt-cache` command allows you to manipulate the apt package cache. The
    `apt-cache` command does not modify the state of the system, but it does provide
    functions with which to search and generate useful output from the package metadata.
    For example, with the `search` keyword, you can search for a word in the package
    description database. With the `show` keyword, you can show the details of a specific
    package.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '`apt-cache` 命令允许你操作 apt 包缓存。`apt-cache` 命令不会修改系统的状态，但它提供了搜索和从包元数据中生成有用输出的功能。例如，使用
    `search` 关键字，你可以在包描述数据库中搜索特定词汇。使用 `show` 关键字，你可以显示特定包的详细信息。'
- en: The `apt-get` tool is powerful. It performs a lot of functions, such as installing
    new package, upgrading an old package, updating the package database, and even
    upgrading the entire Ubuntu Server.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '`apt-get` 工具功能强大。它执行许多功能，如安装新包、升级旧包、更新包数据库，甚至升级整个 Ubuntu 服务器。'
- en: 'To install a new package, all you need to do is run the package with the `install`
    keyword. For example, to install the `apache2` web server, you should run the
    following command:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装一个新软件包，你只需要运行带有 `install` 关键字的命令。例如，要安装 `apache2` web 服务器，你应该运行以下命令：
- en: '[PRE6]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You can of course remove it using the following command:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，你可以使用以下命令将其删除：
- en: '[PRE7]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Note
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that with the `--purge` option, you can also remove configuration files.
    So use it carefully.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，使用 `--purge` 选项，你还可以删除配置文件。因此，请谨慎使用它。
- en: We can install and remove a whole list of packages at the same time. Just write
    the packages' names, with the names separated by spaces.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以同时安装和删除一整批软件包。只需写出软件包的名称，名称之间用空格隔开。
- en: 'A common use of `apt-get` is updating a software database after the modification
    of the source list file. To do this, execute the following command:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '`apt-get` 的常见用法是，在修改源列表文件后更新软件数据库。要做到这一点，请执行以下命令：'
- en: '[PRE8]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Over time, a lot of packages will have newer versions. Therefore, an `upgrade`
    operation is needed to keep your Ubuntu Server up-to-date, especially when talking
    about security updates. The `apt-get` tool allows us to do this by using the following
    command (after updating the database, as discussed before):'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 随着时间的推移，很多软件包将会有更新的版本。因此，进行 `upgrade` 操作是必要的，以保持你的 Ubuntu 服务器最新，特别是当涉及到安全更新时。`apt-get`
    工具允许我们通过以下命令来完成此操作（在如前所述更新数据库后）：
- en: '[PRE9]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Note
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Note that in general, after a new installation, the first thing that we need
    to do is upgrade all the software of the system by running the following command:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，一般情况下，完成新安装后的第一件事就是通过运行以下命令升级系统中的所有软件：
- en: '[PRE10]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'For more information about `apt-get`, you can refer to the man pages or use
    the `help` keyword, as shown in the following code:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 若想了解有关 `apt-get` 的更多信息，你可以参考手册页，或使用 `help` 关键字，如下所示：
- en: '[PRE11]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Adding software collections using tasksel
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 tasksel 添加软件集合
- en: The `tasksel` tool provides you with the possibility of installing new software
    and configuring them at the same time—either by using default values, or by asking
    you to enter the appropriate values. As a result, you will get the software that
    you want to install working and ready to use without any need for additional customization
    (you can of course reconfigure it as you want later).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '`tasksel` 工具为你提供了同时安装和配置新软件的可能性——无论是使用默认值，还是让你输入适当的值。因此，你将得到你想要安装的软件，它可以正常工作并且随时可用，无需额外的自定义（当然，你可以稍后根据需要重新配置它）。'
- en: 'You may remember that during the installation of software, we saw an interface
    that which asked us to install some servers (such as DNS, mail, web, and so on).
    This task can be accomplished with the help of `tasksel`. We can launch the same
    menu interface at any time by using the following command:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还记得在安装软件时，我们看到一个界面，询问是否安装一些服务器（如 DNS、邮件、Web 等）。这一任务可以通过 `tasksel` 完成。我们可以随时通过以下命令启动相同的菜单界面：
- en: '[PRE12]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The output of this command is as follows:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令的输出如下：
- en: '![Adding software collections using tasksel](img/B04800_02_07.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![使用 tasksel 添加软件集合](img/B04800_02_07.jpg)'
- en: Use the arrow keys to navigate between the collections, press the *spacebar*
    to select the software that you want to install (you will see an asterisk to the
    left of the software), press the *Tab* key to navigate to the **OK** button, and
    press the *Enter* key to launch the installation.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 使用箭头键在集合之间导航，按 *空格键* 选择你想要安装的软件（你将看到软件左侧有一个星号），按 *Tab* 键导航到 **OK** 按钮，按 *Enter*
    键启动安装。
- en: 'If you would like to know which packages will be installed for a specific task,
    you can run, for the example of the `lamp` web server, the following command:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想知道为完成特定任务将安装哪些软件包，可以运行以下命令，以 `lamp` web 服务器为例：
- en: '[PRE13]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The network configuration for an Ubuntu Server
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Ubuntu 服务器的网络配置
- en: To cover all the aspects of network configuration for a Linux system administrator,
    we need huge books. So, in this little section, we will cover only the essential
    topics that every Ubuntu Server administrator will need to set up and change the
    network settings.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 要涵盖 Linux 系统管理员的所有网络配置方面，我们需要大量的书籍。因此，在这一小节中，我们将只涵盖每个 Ubuntu 服务器管理员在设置和更改网络设置时需要的基本主题。
- en: The configuration files
  id: totrans-104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置文件
- en: In this section, we will have a look at the core files for the network settings
    for the Ubuntu Server.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一节中，我们将查看 Ubuntu 服务器网络设置的核心文件。
- en: Note
  id: totrans-106
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Note that after modifying any of these files, you should restart the network
    process by typing in the following command:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，修改这些文件后，你应该通过输入以下命令重启网络进程：
- en: '[PRE14]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Unlike Red Hat manners, Ubuntu and all the Debian-based distributions use a
    unique file to configure all the network interfaces; this file is named `/etc/network/interfaces`.
    In general, for Ubuntu servers, you will find the loopback and Ethernet interfaces.
    For loopback interfaces (127.0.0.1), its configuration is standard and doesn't
    need any modification from your side. For Ethernet interfaces, you will (in most
    of the cases when you are dealing with servers) find more than one interface.
    They are generally named `ethX`, where `X` is a number starting from *0* and which
    is incremented according to the interface number.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Red Hat 系统不同，Ubuntu 以及所有基于 Debian 的发行版使用一个独特的文件来配置所有网络接口；这个文件叫做 `/etc/network/interfaces`。一般来说，在
    Ubuntu 服务器上，你会看到回环接口和以太网接口。对于回环接口（127.0.0.1），其配置是标准的，不需要你做任何修改。对于以太网接口，在大多数情况下（当你处理服务器时），你会发现多个接口。它们通常被命名为
    `ethX`，其中 `X` 是一个从 *0* 开始并根据接口数量递增的数字。
- en: 'An Ethernet interface is configured in either the DHCP or static mode. If it
    is the DHCP mode, we will find the following lines in `/etc/network/interfaces`:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网接口可以配置为 DHCP 或静态模式。如果是 DHCP 模式，我们将在 `/etc/network/interfaces` 中看到以下内容：
- en: '[PRE15]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Here, the line containing the `auto` keyword means that this interface should
    be automatically brought up when a computer boots up.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，包含 `auto` 关键字的那一行表示该接口在计算机启动时应自动启动。
- en: 'If it is in the static mode, you will find the output that looks like the following
    lines:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果是静态模式，你将看到如下的输出：
- en: '[PRE16]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: These fields are simple and pretty self-explanatory.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 这些字段非常简单，且几乎不需要解释。
- en: 'Another important network configuration file is `/etc/resolv.conf`, which contains
    the DNS list used by your server. If you are using DHCP, the content of this file
    will be set automatically. You can edit it by adding your own/favorite DNS servers
    in the following format:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个重要的网络配置文件是 `/etc/resolv.conf`，它包含了你的服务器使用的 DNS 列表。如果你使用的是 DHCP，这个文件的内容会自动设置。你可以通过以下格式编辑它，添加你自己的/喜欢的
    DNS 服务器：
- en: '[PRE17]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The order of the DNS servers in this list will be followed when processing a
    DNS request.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 该列表中 DNS 服务器的顺序将会在处理 DNS 请求时被遵循。
- en: Note
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Note that in general, we edit DNS servers using the following command:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，一般来说，我们使用以下命令编辑 DNS 服务器：
- en: '[PRE18]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'However, starting from Ubuntu 12.04 and later, you should use the following:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，从 Ubuntu 12.04 及之后的版本开始，你应该使用以下内容：
- en: '[PRE19]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The `/etc/hosts` file is also one of the core network setting files. By default,
    it contains the loopback and local host addresses, but you can add to it another
    address/hostname pair. It will be used before checking the DNS. It is also useful
    when you want to assign an IP address to a hostname even if your DNS is down.
    This file is also used by a lot of services. We will have a look at this in the
    next chapter.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '`/etc/hosts` 文件也是核心网络设置文件之一。默认情况下，它包含了回环地址和本地主机地址，但你可以在其中添加其他地址/主机名对。在检查 DNS
    之前，它将被首先使用。当你希望为主机名分配一个 IP 地址，即使你的 DNS 宕机时，它也非常有用。这个文件也被许多服务使用。我们将在下一章中查看这一点。'
- en: The network utilities
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络工具
- en: In this section, we will take a look at a set of networking programs that an
    administrator on an Ubuntu Server should be aware of.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解一些 Ubuntu 服务器管理员应该了解的网络程序。
- en: The first two that you should know about are `ifup` and `ifdown`, which are
    used to put up interfaces and take them down respectively. You should use them
    with the name of the interface in the parameter.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该了解的前两个命令是 `ifup` 和 `ifdown`，分别用于启用和禁用接口。你应该在参数中使用接口的名称。
- en: Note
  id: totrans-128
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Be careful when you take down an interface. You may potentially disrupt any
    services on the system. Furthermore, if you are connected to the system via SSH
    and you take down the main interface on the system, you will disconnect yourself
    from SSH.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 当你关闭一个接口时要小心。这样做可能会干扰系统中的任何服务。此外，如果你通过 SSH 连接到系统，并且关闭了系统的主要接口，你将会断开与 SSH 的连接。
- en: 'Another important tool is `ifconfig`, which gives you detailed information
    about interfaces, as follows:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个重要的工具是 `ifconfig`，它可以提供关于接口的详细信息，如下所示：
- en: '[PRE20]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The `ifconfig` command also allows you to configure interfaces, put them up,
    and take them down. You can take a look at its potential via `man ifconfig`.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig` 命令也允许你配置接口、启用它们以及禁用它们。你可以通过 `man ifconfig` 查看它的潜力。'
- en: 'Another important networking program is the `route` command. As with `ifconfig`,
    this command can be used to both see and set network settings (network routes
    in this case). It is used to manage routes on your server (such as to list, add,
    remove, and so on). Let''s take a look at the following command:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个重要的网络程序是 `route` 命令。与 `ifconfig` 相似，这个命令既可以用来查看网络设置，也可以用来设置网络路由（在本例中是网络路由）。它用于管理服务器上的路由（例如列出、添加、删除等）。我们来看一下以下命令：
- en: '[PRE21]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: In the same context of routing configuration, there is the famous `traceroute6`
    command, which gives you the path followed by packets `egressing` from your server
    until their destination.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在路由配置的相同上下文中，有一个著名的 `traceroute6` 命令，它能显示从服务器到目标的路径。
- en: 'The `ethtool` command is a program that manipulates the Ethernet card settings,
    such as port speed, auto-negotiation, the duplex mode, and Wake-on-LAN. You can
    install it by using the following command:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '`ethtool` 命令是一个用于操作以太网卡设置的程序，如端口速度、自动协商、双工模式和 Wake-on-LAN。你可以使用以下命令安装它：'
- en: '[PRE22]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: To check the `ethtool` options, you have to run either `man ethtool` or `ethtool
    -h | less`.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看 `ethtool` 选项，你可以运行 `man ethtool` 或 `ethtool -h | less`。
- en: Performing essential system administration tasks
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 执行基本的系统管理任务
- en: In this section, we will explore a useful set of Ubuntu Server administration
    tasks such as monitoring and processes management.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨一组有用的 Ubuntu Server 管理任务，如监控和进程管理。
- en: Monitoring resources
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 监控资源
- en: For a system administrator, monitoring tasks are the most important because
    they allow us to keep our system robust and prevent incidents. The Ubuntu Server
    has a powerful set of monitoring tools that cover CPU usage, hard disks, virtual
    memory, and so on.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 对于系统管理员来说，监控任务是最重要的，因为它们能帮助我们保持系统的稳定，防止事故发生。Ubuntu Server 提供了一套强大的监控工具，涵盖了 CPU
    使用情况、硬盘、虚拟内存等内容。
- en: 'Some tools come with Ubuntu straight out of the box, while others need to be
    installed. The `sysstat` package contains some of them. You need to install it
    by using the command:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 有些工具是 Ubuntu 自带的，而有些则需要安装。`sysstat` 包含其中的一些工具。你可以使用以下命令安装它：
- en: '[PRE23]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: One of the most important resources that an Ubuntu Server administrator should
    permanently monitor is the memory use, because running out of memory will negatively
    affect system performance.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: Ubuntu Server 管理员需要永久监控的最重要资源之一是内存使用情况，因为内存不足会对系统性能产生负面影响。
- en: You can use the `free` and `top` commands to see basic information about the
    use of your RAM and swap. To get more detailed information about your server memory
    use, you can refer to the `vmstat` command. The `slabtop` command is useful in
    case you would like to show how much memory the kernel (the slab cache) of your
    server is consuming.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 `free` 和 `top` 命令查看有关 RAM 和交换空间使用的基本信息。若要获得有关服务器内存使用的更详细信息，可以参考 `vmstat`
    命令。`slabtop` 命令在你想查看内核（内存 slab 缓存）消耗多少内存时非常有用。
- en: As seen earlier, the `top` command is used to watch the currently running processes.
    By default, those processes are sorted by the CPU usage. You can also use `top`
    to keep a tab on your memory usage in a screen-oriented way. When top is running,
    just press *Shift+m*, and the running processes will be sorted by the memory use
    (so that you can examine which processes are consuming memory the most).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，`top` 命令用于查看当前正在运行的进程。默认情况下，这些进程会根据 CPU 使用情况进行排序。你还可以使用 `top` 以屏幕方式监控内存使用情况。当
    `top` 正在运行时，只需按下 *Shift+m*，运行中的进程就会按内存使用情况进行排序（这样你可以检查哪些进程消耗了最多内存）。
- en: Another important system resource that an Ubuntu Server administrator monitors
    is the CPU usage. The `vmstat` command that we previously talked about can produce
    basic statistics related to CPU usage, such as system activity, user activity,
    the I/O wait time, the idle time, and so on. If you want more detailed reports
    of CPU utilization, you can use the `iostat` command that comes with the `sysstat`
    package, which was installed at the beginning of this section.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个 Ubuntu Server 管理员需要监控的重要系统资源是 CPU 使用情况。我们之前提到过的 `vmstat` 命令可以生成与 CPU 使用情况相关的基本统计信息，如系统活动、用户活动、I/O
    等待时间、空闲时间等。如果你想要更详细的 CPU 利用率报告，可以使用 `iostat` 命令，它包含在开头提到的 `sysstat` 包中。
- en: 'For example, here''s how the CPU statistics are shown every 5 seconds:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，下面是如何每 5 秒显示一次 CPU 统计信息：
- en: '[PRE24]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'An alternative to `iostat` in terms of viewing CPU usage information as well
    as other performance-related items is the `dstat` command, which comes with the
    `dstat` package. The `dstat` command has some advantages over other tools, such
    as the simplicity and clarity of information shown, and the use of colors. To
    install this tool, install the `dstat` package using the following command:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '`iostat`的替代方法是`dstat`命令，它可以查看CPU使用情况和其他性能相关的信息。`dstat`命令具有一些其他工具所不具备的优势，比如信息显示的简洁性和清晰性，以及颜色的使用。要安装这个工具，请使用以下命令安装`dstat`包：'
- en: '[PRE25]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Here is an example of `dstat` displaying CPU information:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 这是`dstat`显示CPU信息的一个示例：
- en: '![Monitoring resources](img/B04800_02_08.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![监控资源](img/B04800_02_08.jpg)'
- en: As discussed previously, the `top` command allows you to specifically find out
    which processes are consuming processing time the most. By default, the sorting
    order is based on CPU usage, but if you change it for some reason (like we did
    before when we changed it so that it was based on memory usage), you can revert
    to the default sorting order by using the *Shift+p* command when `top` is running.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，`top`命令允许你专门找出哪些进程占用了最多的处理时间。默认情况下，排序顺序是基于CPU使用率的，但如果你因某些原因改变了排序方式（比如我们之前把排序方式改成了基于内存使用情况），你可以通过在运行`top`时使用*Shift+p*命令恢复到默认的排序顺序。
- en: Commands such as `du` and `df` allow you get basic information about storage
    space available to your Ubuntu Server. For more details about how your storage
    devices are performing, you can use commands such as `vmstat` and `iostat`.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 像`du`和`df`这样的命令可以让你获取有关你Ubuntu服务器可用存储空间的基本信息。要了解存储设备的详细性能，可以使用`vmstat`和`iostat`等命令。
- en: 'Let''s have a look at the capacity of the `vmstat` command by using it to list
    statistics related to your disks. Here''s an example of using `vmstat` to view
    information about the disk read and write statistics using the -d option:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过使用`vmstat`命令查看与磁盘相关的统计信息。以下是使用`vmstat`查看磁盘读写统计信息的示例，使用了-d选项：
- en: '[PRE26]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Another useful command in terms of file system management is `lsof`. It allows
    you to find out what files and directories are actually open on your storage devices.
    One of the most common cases where you need to use this command is when you are
    trying to unmount a file system that keeps telling you that it is busy. In this
    case, you can evaluate which open file is preventing the unmounting, decide if
    you want to stop the process holding that file open, and perform the unmounting
    of the file system again.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有用的文件系统管理命令是`lsof`。它可以帮助你查找哪些文件和目录实际上在存储设备上是打开的。你需要使用这个命令的最常见情况之一是当你试图卸载一个提示仍然在使用中的文件系统时。在这种情况下，你可以评估哪个打开的文件阻止了卸载，决定是否停止持有该文件的进程，然后再次执行卸载操作。
- en: Processes management
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 进程管理
- en: As discussed before, the `ps` and `top` commands allow us to show a lot of information
    related to the running processes. In this section, we will examine other commands
    that allow us to manage processes.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，`ps`和`top`命令允许我们显示大量与运行中的进程相关的信息。在本节中，我们将探讨其他可以帮助我们管理进程的命令。
- en: When you are running `top`, you can perform a lot of actions besides sorting.
    For example, you can type the letter *k* followed by a signal number (for example,
    9 or 15) and the PID, which sends that signal to the process that has this PID.
    You can also use the letter *n* to change the priority of one process.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 当你运行`top`时，除了排序之外，你还可以执行很多操作。例如，你可以输入字母*k*，后跟一个信号编号（例如9或15）和PID，这会将信号发送到具有该PID的进程。你也可以使用字母*n*来更改一个进程的优先级。
- en: Another way to change the priority of a running process is via the `renice`
    command. If you want to change the default priority or set a higher or lower priority
    at the time of launching a process, you can use the nice command.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 改变正在运行的进程优先级的另一种方法是使用`renice`命令。如果你想在启动进程时更改默认优先级或设置更高或更低的优先级，可以使用nice命令。
- en: Another way that can be used to change how a running process behaves is to send
    a signal to that process. Commands such as `kill`, `pkill`, and `killall` can
    be used to send signals to running processes. We can represent signals by numbers
    (the famous ones are 9 and 15) and strings (such as SIGKILL and SIGTERM).
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 改变正在运行的进程行为的另一种方法是向该进程发送信号。像`kill`、`pkill`和`killall`这样的命令可以用来向正在运行的进程发送信号。我们可以用数字（例如9和15）或字符串（如SIGKILL和SIGTERM）来表示信号。
- en: Scheduling the processes that need to be run
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调度需要运行的进程
- en: 'Commands associated with the `cron` facility can be used to make a command
    run at a specific time (including now) so that it is not connected to the current
    shell. The `at` command runs a command at the time you set. For example, if you
    want to run a command in 1 minute, all you need is to run the `at now +1 min`
    command. Then, when you get the at prompt, you write the command, as follows:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 与 `cron` 服务相关的命令可以用于在特定时间（包括当前时间）运行一个命令，因此它不会与当前的 shell 连接。`at` 命令用于在你设置的时间运行命令。例如，如果你想在
    1 分钟后运行命令，只需运行 `at now +1 min` 命令。然后，当你看到 at 提示符时，写下你要执行的命令，如下所示：
- en: '[PRE28]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: After this, press *Enter*. You will get the at prompt again. You can enter another
    command or number of commands that you want, with each one on a line. Then, type
    enter. Finally, run the *Ctrl+d* shortcut to close the at prompt.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，按 *Enter* 键。你将再次看到 at 提示符。你可以输入另一个命令或多个命令，每个命令占一行。然后，按 Enter 键。最后，运行 *Ctrl+d*
    快捷键来关闭 at 提示符。
- en: In the same manner, you can type `at now +7 days` to run a command after 7 days.
    Alternatively, if you would like to execute a command at a specific date, you
    can run `at` followed by the date in the `dd/mm/yy` format.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 以同样的方式，你可以输入 `at now +7 days` 来在 7 天后运行一个命令。或者，如果你想在特定日期执行命令，可以运行 `at`，后跟 `dd/mm/yy`
    格式的日期。
- en: If you want to check the list (queue) of the at jobs that were set to run after
    you finish entering the commands, as discussed previously, you have to run the
    `atq` command. If you are a new user, you can see your own queued at jobs. Only
    the root user can see everyone's queued `at` jobs. The `atrm` command, followed
    by the job number (given `at` the creation step or via the `atq` command), is
    used to delete an `at` job from the queue.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想查看你输入命令后将执行的 at 作业队列（如前所述），你需要运行 `atq` 命令。如果你是新用户，你只能看到自己排队的 at 作业。只有 root
    用户才能看到所有人的排队 at 作业。使用 `atrm` 命令，后跟作业编号（通过 `at` 创建步骤或 `atq` 命令获得），可以删除队列中的某个 `at`
    作业。
- en: 'The `at` command is used to queue up a command that is supposed to run only
    once. If you want to set up commands so that they run repeatedly, you can use
    the `cron` facility, which allows you to script the `cron` jobs scheduled in the
    `crontab` files. Generally, there is one system `crontab` file (which is `/etc/crontab`),
    but each user can create their personal `crontab` file that allows them to launch
    commands `at` the times that they choose. To create a personal `crontab` file,
    you need to type the following command:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: '`at` 命令用于排队一个只运行一次的命令。如果你想设置让命令反复运行，你可以使用 `cron` 服务，它允许你在 `crontab` 文件中编写脚本来安排
    `cron` 作业。通常，有一个系统级的 `crontab` 文件（位于 `/etc/crontab`），但每个用户都可以创建个人的 `crontab` 文件，允许他们在自己选择的时间启动命令。要创建个人的
    `crontab` 文件，你需要输入以下命令：'
- en: '[PRE29]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'The `crontab -e` command opens the `crontab` file in case it exists, or it
    creates a new one using a text editor from your choice:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '`crontab -e` 命令会打开 `crontab` 文件（如果文件存在的话），如果没有，它会使用你选择的文本编辑器创建一个新的文件：'
- en: '[PRE30]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'In a `crontab` file, each job is represented by a single line that determines
    when to run the job, followed by the command that needs to be run. For the `times`
    fields, they are in the following order: **minute** (**m**), **hour** (**h**),
    **day of month** (**dom**), **month** (**mon**), and **day of the week** (**dow**).
    You can use `*` in these fields (for `any`).'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `crontab` 文件中，每个作业都由一行表示，该行决定了作业的运行时间，后面跟着需要运行的命令。对于 `times` 字段，它们的顺序如下：**分钟**
    (**m**)、**小时** (**h**)、**日期** (**dom**)、**月份** (**mon**) 和 **星期几** (**dow**)。你可以在这些字段中使用
    `*`（表示 `任何`）。
- en: Note
  id: totrans-177
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'The following are the fields from left to right: minute (0 to 59), hour (0
    to 23), date of the month (0 to 31), month (0 to 12 or Jan, Feb, Mar, Apr, May,
    Jun, Jul, Aug, Sep, Oct, Nov, or Dec), and day of the week (0 to 7 or Sun, Mon,
    Tue, Wed, Thu, Fri, or Sat). An asterisk (*) in a field means that any value for
    that field can be matched.'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是从左到右的字段：分钟（0 到 59）、小时（0 到 23）、日期（0 到 31）、月份（0 到 12 或 Jan, Feb, Mar, Apr,
    May, Jun, Jul, Aug, Sep, Oct, Nov, Dec）和星期几（0 到 7 或 Sun, Mon, Tue, Wed, Thu, Fri,
    Sat）。字段中的星号（*）表示该字段可以匹配任何值。
- en: You can use a single value for each field or more than one. For example, for
    the `dow` field, you can use the **Mon**, **Fri** value to run a job at every
    beginning and end of the week (every **Monday** and **Friday**). Providing another
    example, for the `mon` field, a value of 1,4,7,10 means that the job will be launched
    in the first month of each quarter (January, April, July, and October).
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以为每个字段使用单个值或多个值。例如，对于`dow`字段，你可以使用**Mon**、**Fri**的值来在每周的开始和结束（每个**星期一**和**星期五**）运行作业。举个例子，对于`mon`字段，值1,4,7,10意味着作业将在每个季度的第一个月启动（即1月、4月、7月和10月）。
- en: The output of the `crontab` jobs (including errors) is sent via an e-mail to
    the user belongs to the `crontab` file (unless redirected).
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '`crontab`作业的输出（包括错误信息）会通过电子邮件发送给属于该`crontab`文件的用户（除非被重定向）。'
- en: To list the contents of your `crontab` file, you should run `crontab –l`, and
    to delete your `crontab` file, you should run `crontab -r`.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出你的`crontab`文件内容，应该运行`crontab –l`，要删除你的`crontab`文件，应该运行`crontab -r`。
- en: Summary
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we saw different aspects of configuring and administering the
    Ubuntu Server system. We were introduced to CLI using network settings, package
    management, and administration tasks.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们了解了配置和管理Ubuntu Server系统的不同方面。我们学习了使用CLI进行网络设置、软件包管理和管理任务。
- en: In the next chapter, we will start a new part of this book, which involves service
    creation and management.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将开始本书的新部分，涉及服务的创建和管理。
