<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Scripts for System Administration Tasks</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this chapter, we will introduce the following topics:</p>
<ul class="calibre13">
<li class="calibre14">Gathering and aggregating system information</li>
<li class="calibre14">Gathering network information and connectivity diagnostics</li>
<li class="calibre14">Configuring basic network connectivity</li>
<li class="calibre14">Monitoring directories and files</li>
<li class="calibre14">Compressing and archiving files</li>
<li class="calibre14">Rotating files from RAM to storage for log rotation</li>
<li class="calibre14">Using Linux iptables for a firewall</li>
<li class="calibre14">Accessing SQL databases remotely or locally</li>
<li class="calibre14">Creating SSH keys for password less remote access</li>
<li class="calibre14">Creating and configuring cron jobs for task scheduling</li>
<li class="calibre14">Creating users and groups systematically</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">This chapter is about performing system administration tasks common to nearly all users and we'll be looking at logs, archiving them, job/task management, network connectivity, securing systems using a firewall (IPtables), monitoring directories for changes, and creating users. We will also acknowledge that users and administrators often have to access resources from other systems for resources such as SQL or they have to use SSH to log in to another system using only cryptographic keys<span class="calibre16">—</span>no passwords required!</p>
<p class="mce-root"/>
<p class="mce-root">This chapter also serves as a crash course on some critical components in today's computing environment: <strong class="calibre6">networking</strong>.  Users might not know what a port is, an IP address, or how to find <strong class="calibre6">network interfaces</strong> (<strong class="calibre6">NICs</strong>) on their computer. By the end of this chapter, beginners should be able to configure a network, and will have an improved level of competency when working with a network terminology.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Gathering and aggregating system information</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to discuss the <kbd class="calibre17">dmidecode</kbd> Linux tool, which will gather information about the system such as CPU information, server, memory, and networking.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Besides having a terminal open, we need to remember a few concepts:</p>
<ul class="calibre13">
<li class="calibre14">We are going to use some commands that will give us information about the Kernel, Linux distribution, physical server information, system uptime, network information, memory information, and CPU information.</li>
<li class="calibre14">By using this, anyone can create scripts to gather system information.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<ol class="calibre20">
<li class="chapter">We can get details about the Linux distribution that you are working on. These distributions have a release file that you can locate in the <kbd class="calibre17">/etc/</kbd> folder. Now, open a terminal and enter the following command to get the information regarding the Linux distribution you are working on:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">cat /etc/*-release</strong></pre></div>
<ol start="2" class="calibre20">
<li class="chapter">The preceding option has an alternative, and the alternative is the version file that's present in the <kbd class="calibre17">/proc</kbd> folder. So, run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">cat /proc/version</strong></pre></div>
<ol start="3" class="calibre20">
<li class="chapter">Now, run the following command to get the Kernel's information:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">uname -a</strong></pre></div>
<ol start="4" class="calibre20">
<li class="chapter">System <kbd class="calibre17">uptime</kbd>: for information about this, create a script called <kbd class="calibre17">server_uptime.sh</kbd>:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">server_uptime=`uptime | awk '{print $3,$4}'| sed 's/,//'| grep "day"`;</strong><br class="calibre2"/><strong class="calibre3">if [[ -z "$server_uptime" ]]; then</strong><br class="calibre2"/><strong class="calibre3">       server_uptime=`uptime | awk '{print $3}'| sed 's/,//'`</strong><br class="calibre2"/><strong class="calibre3">       echo $server_uptime</strong><br class="calibre2"/><strong class="calibre3">else</strong><br class="calibre2"/><strong class="calibre3">       :;</strong><br class="calibre2"/><strong class="calibre3">fi;</strong></pre></div>
<ol start="5" class="calibre20">
<li class="chapter">Now, we will run the following commands to get the physical server's information:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sudo dmidecode -s system-manufacture</strong><br class="calibre2"/><strong class="calibre3">$ sudo dmidecode -s system-product-name</strong><br class="calibre2"/><strong class="calibre3">$ sudo dmidecode -s system-serial-number</strong></pre></div>
<ol start="6" class="calibre20">
<li class="chapter">Then, we will run the following command to get the CPU's information:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">sudo dmidecode -t4|awk '/Handle / {print $2}' |sed 's/,//'</strong></pre></div>
<p class="calibre38">You can get each CPU's information from the <kbd class="calibre17">cpuinfo</kbd> file, which is present in the <kbd class="calibre17">/proc</kbd> directory.       </p>
<ol start="7" class="calibre20">
<li class="chapter">Network information: We are going to get the IP address by running the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">ip a</strong></pre></div>
<p class="calibre38">To get the MAC address, run the following command:</p>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">ip addr show ens33</strong></pre></div>
<p class="calibre38">You may replace <kbd class="calibre17">ens33</kbd> with <kbd class="calibre17">eth0</kbd>, depending on your network interface's information.</p>
<p class="mce-root"/>
<ol start="8" class="calibre20">
<li class="chapter">Memory information: To get the total number of slots, run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">sudo dmidecode -t17 |awk '/Handle / {print $2}'|wc -l</strong></pre></div>
<p class="calibre38">To get the total populated slots, run the following command:</p>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">sudo dmidecode -t17 |awk '/Size:/'|awk '!/No/'|wc -l</strong></pre></div>
<p class="calibre38">To get the total unpopulated slots, run the following command:</p>
<pre class="calibre27"><strong class="calibre3">sudo dmidecode -t17 |awk '/Size:/'|awk '/No/'|wc -l</strong></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">After running the <kbd class="calibre17">cat /etc/*-release</kbd> command, press <em class="calibre18">Enter</em> and you will get the output according to your Linux distribution. In my case, the output is as follows:</p>
<pre class="calibre22"><strong class="calibre3">DISTRIB_ID=Ubuntu</strong><br class="calibre2"/><strong class="calibre3">DISTRIB_RELEASE=16.04</strong><br class="calibre2"/><strong class="calibre3">DISTRIB_CODENAME=xenial</strong><br class="calibre2"/><strong class="calibre3">DISTRIB_DESCRIPTION="Ubuntu 16.04.4 LTS"</strong><br class="calibre2"/><strong class="calibre3">NAME="Ubuntu"</strong><br class="calibre2"/><strong class="calibre3">VERSION="16.04.4 LTS (Xenial Xerus)"</strong><br class="calibre2"/><strong class="calibre3">ID=ubuntu</strong><br class="calibre2"/><strong class="calibre3">ID_LIKE=Debian</strong><br class="calibre2"/><strong class="calibre3">PRETTY_NAME="Ubuntu 16.04.4 LTS"</strong><br class="calibre2"/><strong class="calibre3">VERSION_ID="16.04"</strong><br class="calibre2"/><strong class="calibre3">HOME_URL="http://www.ubuntu.com/"</strong><br class="calibre2"/><strong class="calibre3">SUPPORT_URL="http://help.ubuntu.com/"</strong><br class="calibre2"/><strong class="calibre3">BUG_REPORT_URL="http://bugs.launchpad.net/ubuntu/"</strong><br class="calibre2"/><strong class="calibre3">VERSION_CODENAME=xenial</strong><br class="calibre2"/><strong class="calibre3">UBUNTU_CODENAME=xenial</strong></pre>
<p class="mce-root">There is an alternate way to get system information. You can get the system information by running a version file from the <kbd class="calibre17">/proc</kbd> directory. After running the command, press <em class="calibre18">Enter</em>, and you will get the output according to your Linux distribution. In my case, the output is as follows:</p>
<pre class="calibre22"><strong class="calibre3">Linux version 4.13.0-45-generic (buildd@lgw01-amd64-011) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9)) #50~16.04.1-Ubuntu SMP Wed May 30 11:18:27 UTC 2018</strong></pre>
<p class="mce-root"><kbd class="calibre17">uname</kbd> is the tool that we are using to gather this information. Press <em class="calibre18">Enter</em> after running the command and you will get the Kernel information. In my case, the output is as follows:</p>
<pre class="calibre22"><strong class="calibre3">Linux ubuntu 4.13.0-45-generic #50~16.04.1-Ubuntu SMP Wed May 30 11:18:27 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</strong></pre>
<p class="mce-root">Execute the <kbd class="calibre17">$ bash server_uptime.sh</kbd> script<span class="calibre16">—</span>press <em class="calibre18">Enter</em> at the prompt and you will get the uptime of the server.</p>
<p class="mce-root">To get the physical server information, we used the <kbd class="calibre17">dmidecode</kbd> tool. The first command is used to get the manufacturer's information, the second command is to get the model name, and the third command gets the serial number. While running a <kbd class="calibre17">dmidecode</kbd> command, you must be the root user.</p>
<p class="mce-root">The output snippet will look as follows:</p>
<pre class="calibre22"><strong class="calibre3">0x0004</strong><br class="calibre2"/><strong class="calibre3">0x0005</strong><br class="calibre2"/><strong class="calibre3">0x0006</strong><br class="calibre2"/><strong class="calibre3">0x0007</strong></pre>
<p class="mce-root">To get each CPU’s information, we created a script. Execute the <kbd class="calibre17">$ sudo bash cpu_info.sh</kbd> script<span class="calibre16">—</span>press <em class="calibre18">Enter</em> at the prompt and you will get information for each CPU.</p>
<p class="mce-root">The output snippet will look like the following:</p>
<pre class="calibre22"><strong class="calibre3">CPU#000</strong><br class="calibre2"/><strong class="calibre3">Unknown</strong><br class="calibre2"/><strong class="calibre3">GenuineIntel</strong><br class="calibre2"/><strong class="calibre3">1800MHz</strong><br class="calibre2"/><strong class="calibre3">3.3V</strong><br class="calibre2"/><strong class="calibre3">1</strong><br class="calibre2"/><strong class="calibre3">CPU#001</strong><br class="calibre2"/><strong class="calibre3">Unknown</strong><br class="calibre2"/><strong class="calibre3">GenuineIntel</strong><br class="calibre2"/><strong class="calibre3">1800MHz</strong><br class="calibre2"/><strong class="calibre3">3.3V</strong><br class="calibre2"/><strong class="calibre3">1</strong><br class="calibre2"/><strong class="calibre3">CPU#002</strong><br class="calibre2"/><strong class="calibre3">Unknown</strong><br class="calibre2"/><strong class="calibre3">GenuineIntel</strong><br class="calibre2"/><strong class="calibre3">1800MHz</strong><br class="calibre2"/><strong class="calibre3">3.3V</strong><br class="calibre2"/><strong class="calibre3">1</strong><br class="calibre2"/><strong class="calibre3">CPU#003</strong><br class="calibre2"/><strong class="calibre3">Unknown</strong><br class="calibre2"/><strong class="calibre3">GenuineIntel</strong><br class="calibre2"/><strong class="calibre3">1800MHz</strong><br class="calibre2"/><strong class="calibre3">3.3V</strong><br class="calibre2"/><strong class="calibre3">1</strong></pre>
<p class="mce-root">Network information: We ran the <kbd class="calibre17">ip</kbd> command to get the IP address and MAC address.</p>
<p class="mce-root">Memory information: We used the <kbd class="calibre17">dmidecode</kbd> tool to get the memory information such as the total number of slots, and the total populated and unpopulated slots. You must be the root user to run this command.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Gathering network information and connectivity diagnostics</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to test IPv4's connectivity and write scripts for it.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Besides having a terminal open, we need to remember a few concepts:</p>
<ul class="calibre13">
<li class="calibre14">The If..Else condition case in shell scripting</li>
<li class="calibre14">IP address of the device</li>
<li class="calibre14"><kbd class="calibre17">curl</kbd> command must be installed (you can install it by using the following command: <kbd class="calibre17">sudo apt install curl</kbd>)</li>
</ul>
<p class="mce-root">The purpose of this section is to show you how you can check network connectivity.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<ol class="calibre20">
<li class="chapter">Open a terminal and create the <kbd class="calibre17">test_ipv4.sh</kbd><strong class="calibre3"> </strong>script:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">if ping -q -c 1 -W 1 8.8.8.8 &gt;/dev/null; then</strong><br class="calibre2"/><strong class="calibre3">  echo "IPv4 is up"</strong><br class="calibre2"/><strong class="calibre3">else</strong><br class="calibre2"/><strong class="calibre3">  echo "IPv4 is down"</strong><br class="calibre2"/><strong class="calibre3">fi</strong></pre></div>
<ol start="2" class="calibre20">
<li class="chapter">Now, to test IP connectivity and DNS, create a script called <kbd class="calibre17">test_ip_dns.sh</kbd>:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">if ping -q -c 1 -W 1 google.com &gt;/dev/null</strong><br class="calibre2"/><strong class="calibre3">then</strong><br class="calibre2"/><strong class="calibre3">  echo "The network is up"</strong><br class="calibre2"/><strong class="calibre3">else</strong><br class="calibre2"/><strong class="calibre3">  echo "The network is down"</strong><br class="calibre2"/><strong class="calibre3">fi</strong></pre></div>
<ol start="3" class="calibre20">
<li class="chapter">Lastly, create a script called <kbd class="calibre17">test_web.sh</kbd> to test web connectivity:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">case "$(curl -s --max-time 2 -I http://google.com | sed 's/^[^ ]*  *\([0-9]\).*/\1/; 1q')" in</strong><br class="calibre2"/><strong class="calibre3">  [23]) echo "HTTP connectivity is up";;</strong><br class="calibre2"/><strong class="calibre3">  5) echo "The web proxy won't let us through";;</strong><br class="calibre2"/><strong class="calibre3">  *) echo "The network is down or very slow";;</strong><br class="calibre2"/><strong class="calibre3">esac</strong></pre></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<ol class="calibre20">
<li class="chapter">Execute the script as <kbd class="calibre17">$ bash test_ipv4.sh</kbd>. Here, we are checking the connection with the <kbd class="calibre17">8.8.8.8</kbd>  IP address. For that, we use the <kbd class="calibre17">ping</kbd> command in the <kbd class="calibre17">if</kbd> condition. If the condition is <kbd class="calibre17">true,</kbd> we will get the statement written and printed on the screen as an if block. If not, the statement in <kbd class="calibre17">else</kbd> will be printed.</li>
<li class="chapter">Execute the script as <kbd class="calibre17">$ bash test_ip_dns.sh</kbd>. Here, we are testing the connectivity using the hostname. We are also passing the <kbd class="calibre17">ping</kbd> command in the <kbd class="calibre17">if</kbd> condition and checking if the network is up or not. If the condition is <kbd class="calibre17">true</kbd>, we will get the statement written in an <kbd class="calibre17">if</kbd> block that's printed on the screen. If not, the statement in <kbd class="calibre17">else</kbd> will be printed.</li>
<li class="chapter">Execute the script as <kbd class="calibre17">$ bash test_web.sh</kbd>. Here, we are testing the web connectivity. We use the <kbd class="calibre17">case</kbd> statement here. We are using the curl tool in this case, which is used to transfer data to and from a server.</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Configuring basic network connectivity</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to configure basic network connectivity using <kbd class="calibre17">wpa_supplicant</kbd>.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Besides having a terminal open, we need to remember a few concepts:</p>
<ul class="calibre13">
<li class="calibre14">Check whether <kbd class="calibre17">wpa_supplicant</kbd> is installed or not.</li>
<li class="calibre14">You should know the SSID and password.</li>
<li class="calibre14">Remember that you have to run your program as a root user.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Create a script called <kbd class="calibre17">wifi_conn.sh</kbd> and write the following code in it:</p>
<div class="title-page-name">
<pre class="calibre27">#!/bin/bash<br class="calibre2"/>ifdown wlan0<br class="calibre2"/>rm /etc/network/interfaces<br class="calibre2"/>touch /etc/network/interfaces<br class="calibre2"/>echo 'auto lo' &gt;&gt; /etc/network/interfaces<br class="calibre2"/>echo 'iface lo inet loopback' &gt;&gt; /etc/network/interfaces<br class="calibre2"/>echo 'iface eth0 inet dhcp' &gt;&gt; /etc/network/interfaces<br class="calibre2"/>echo 'allow-hotplug wlan0' &gt;&gt; /etc/network/interfaces<br class="calibre2"/>echo 'iface wlan0 inet manual' &gt;&gt; /etc/network/interfaces<br class="calibre2"/>echo 'wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf' &gt;&gt; /etc/network/interfaces<br class="calibre2"/>echo 'iface default inet dhcp' &gt;&gt; /etc/network/interfaces<br class="calibre2"/>rm /etc/wpa_supplicant/wpa_supplicant.conf<br class="calibre2"/>touch /etc/wpa_supplicant/wpa_supplicant.conf<br class="calibre2"/>echo 'ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev' &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf<br class="calibre2"/>echo 'update_config=1' &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf<br class="calibre2"/>wpa_passphrase $1 $2 &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf<br class="calibre2"/>ifup wlan0</pre></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Execute the script using <kbd class="calibre17">sudo</kbd>:</p>
<pre class="calibre22"><strong class="calibre3">sudo bash wifi_conn.sh &lt;SSID&gt; &lt;password&gt;</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Monitoring directories and files</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><kbd class="calibre17">inotify</kbd> is a tool in Linux which is used to report when a file system event occurs. Using <kbd class="calibre17">inotify</kbd>, you can monitor individual files or directories.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Make sure you have the <kbd class="calibre17">inotify</kbd> tool installed on your system.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Create a script called <kbd class="calibre17">inotify_example.sh</kbd>:</p>
<pre class="calibre22">#! /bin/bash<br class="calibre2"/>folder=~/Desktop/abc<br class="calibre2"/>cdate=$(date +"%Y-%m-%d-%H:%M")<br class="calibre2"/>inotifywait -m -q -e create -r --format '%:e %w%f' $folder | while read file<br class="calibre2"/>do<br class="calibre2"/>    mv ~/Desktop/abc/output.txt ~/Desktop/Old_abc/${cdate}-output.txt<br class="calibre2"/>done</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">The <kbd class="calibre17">inotifywait</kbd> command is mostly used in shell scripting. The main purpose of the inotify tool is to monitor the directories and new files. It also monitors the changes in the files.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Compressing and archiving files</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">There is a difference between a compressed and an archive file. So, what is an archive file? It is a collection of files and directories that are stored in a single file. An archive file is not a compressed file.</p>
<p class="mce-root">What is a compressed file? This is a collection of files and directories stored in one file. It uses less disk space for storage.</p>
<p class="mce-root"/>
<p class="mce-root">In this section, we are going to discuss two compression tools:</p>
<ul class="calibre13">
<li class="calibre14"><kbd class="calibre17">bzip2</kbd></li>
<li class="calibre14"><kbd class="calibre17">zip</kbd></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">You should have files to archive and compress.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">First, let's see how we can compress the files:</p>
<ol class="calibre20">
<li class="chapter">We are going to look at compression with the help of <kbd class="calibre17">bzip2</kbd>. Decide which file to compress and run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ bzip2 <em class="calibre26">filename</em></strong></pre></div>
<p class="mce-root1">Using <kbd class="calibre17">bzip2</kbd>, we can compress multiple files and directories at the same time. Just separate them by putting a space between each of them. You can compress it as follows:</p>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ bzip2 file1 file2 file3 /student/work</strong></pre></div>
<ol start="2" class="calibre20">
<li class="chapter">We are going to use <kbd class="calibre17">zip</kbd> for compression. By using the zip compression tool, files are compressed individually:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ zip -r file_name.zip files_dir</strong></pre></div>
<p class="mce-root">After running the preceding command, the file to be compressed or the directory to be compressed, such as <kbd class="calibre17">files_zip</kbd> will be compressed and you will get a compressed file called <kbd class="calibre17">file_name.zip</kbd>. The <kbd class="calibre17">-r</kbd> option includes all the files in the <kbd class="calibre17">files_dir</kbd> directory recursively.</p>
<p class="mce-root">Now, let's discuss how to archive files:</p>
<p class="mce-root">An archive file contains more than one file or directory. <strong class="calibre6">Tar</strong><span class="calibre16"> is used to archive files without compression.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root">The following are the two archiving modes:</p>
<ul class="calibre13">
<li class="calibre14"><kbd class="calibre17">-x</kbd>: extract an archive</li>
<li class="calibre14"><kbd class="calibre17">-c</kbd>: create an archive</li>
</ul>
<p class="mce-root">Options:</p>
<ul class="calibre13">
<li class="calibre14"><kbd class="calibre17">-f</kbd>: FILE name of the archive<span class="calibre11">—you </span>must specify this unless using tape drive for archive</li>
<li class="calibre14"><kbd class="calibre17">-v</kbd>: Be verbose, list all files being archived/extracted</li>
<li class="calibre14"><kbd class="calibre17">-z</kbd>: Create/extract archive with gzip/gunzip</li>
<li class="calibre14"><kbd class="calibre17">-j</kbd>: Create/extract archive with bzip2/bunzip2</li>
<li class="calibre14"><kbd class="calibre17">-J</kbd>: Create/extract archive with XZ</li>
</ul>
<p class="mce-root">To create a TAR file, use the following command:</p>
<div class="title-page-name">
<pre class="calibre22"><strong class="calibre3">$ tar -cvf filename.tar directory/file</strong></pre></div>
<p class="mce-root">In this example, we are representing a file, which is created when we use the <kbd class="calibre17">tar</kbd> command. Its name is <kbd class="calibre17">filename.tar</kbd>. We can specify the directory or file in which we are putting archive files. We must specify it after inserting <kbd class="calibre17">filename.tar</kbd>. Multiple files and directories can archive at the same time, just leave a space between the file and directory names:</p>
<div class="title-page-name">
<pre class="calibre22"><strong class="calibre3">$ tar -cvf filename.tar /home/student/work /home/student/school</strong></pre></div>
<p class="mce-root">After executing the preceding command, all the contents from work and school directories will be stored in the new file <kbd class="calibre17">filename.tar</kbd>. </p>
<p class="mce-root">After running the preceding command, all the contents from work and school subdirectories will be stored in the new file <kbd class="calibre17">filename.tar</kbd>.</p>
<p class="mce-root">The following command is used to list the contents of a TAR file:</p>
<div class="title-page-name">
<pre class="calibre22"><strong class="calibre3">$ tar -tvf filename.tar</strong></pre></div>
<p class="mce-root">To extract the contents of a TAR file, use the following command:</p>
<div class="title-page-name">
<pre class="calibre22"><strong class="calibre3">$ tar -xvf filename.tar</strong></pre></div>
<p class="mce-root">This command is used for extraction and it will not remove the TAR file. However, in your current working directory, you will find the unarchived contents.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><strong class="calibre6">bzip2</strong> is used to compress the files and folder at the same time. Just issue the command in the terminal and the files will be compressed. After the compression, the compressed file will get the extension <kbd class="calibre17">.bz2</kbd>.</p>
<p class="mce-root"><strong class="calibre6">zip</strong> compress the files individually and then collects them in a single file.</p>
<p class="mce-root">A TAR file is a collection of different files and directories, which combines them into one file. TAR is used for creating backups and archives.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Rotating files from RAM to storage for log rotation</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to discuss the logrotate Linux tool. Using this tool, administration of systems becomes easy. The systems generate large number of log files. This allows for automatic rotation, removal, compression, and mailing of log files.</p>
<p class="mce-root">We can handle each and every log file. We can handle them daily, weekly, and monthly. Using this tool, we can keep logs longer with less disk space. The default configuration file is <kbd class="calibre17">/etc/logrotate.conf</kbd>. Run the following command to see the contents of this file:</p>
<div class="title-page-name">
<pre class="calibre22"><strong class="calibre3">$ cat /etc/logrotate.conf</strong></pre></div>
<p class="mce-root">You will see the following:</p>
<pre class="calibre22"><strong class="calibre3">weekly</strong><br class="calibre2"/><strong class="calibre3">rotate 4</strong><br class="calibre2"/><strong class="calibre3">create</strong><br class="calibre2"/> <br class="calibre2"/><strong class="calibre3">include /etc/logrotate.d</strong><br class="calibre2"/><strong class="calibre3"># no packages own wtmp, or btmp -- we'll rotate them here</strong><br class="calibre2"/><strong class="calibre3">/var/log/wtmp {</strong><br class="calibre2"/><strong class="calibre3">    missingok</strong><br class="calibre2"/><strong class="calibre3">    monthly</strong><br class="calibre2"/><strong class="calibre3">    create 0664 root utmp</strong><br class="calibre2"/><strong class="calibre3">    rotate 1</strong><br class="calibre2"/><strong class="calibre3">}</strong><br class="calibre2"/> <br class="calibre2"/><strong class="calibre3">/var/log/btmp {</strong><br class="calibre2"/><strong class="calibre3">    missingok</strong><br class="calibre2"/><strong class="calibre3">    monthly</strong><br class="calibre2"/><strong class="calibre3">    create 0660 root utmp</strong><br class="calibre2"/><strong class="calibre3">    rotate 1</strong><br class="calibre2"/><strong class="calibre3">}</strong><br class="calibre2"/> <br class="calibre2"/><strong class="calibre3"># system-specific logs may be configured here</strong></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To use logrotator, you must be aware of the <kbd class="calibre17">logrotate</kbd> command.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">We are going to look at an example configuration.</p>
<p class="mce-root">We have two options for managing log files:</p>
<ol class="calibre20">
<li class="chapter">Create a new configuration file and store it in <kbd class="calibre17">/etc/logrotate.d/</kbd>. This configuration file will be executed daily along with other standard jobs. This will be with root privileges.</li>
<li class="chapter">Create a new configuration file and execute it independently. This will execute with non-root privileges. This way, you can execute it manually, at whatever times you want.</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Adding configuration to /etc/logrotate.d/</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Now, we will configure a web server. This puts information like <kbd class="calibre17">access.log</kbd> and <kbd class="calibre17">error.log</kbd> into the <kbd class="calibre17">/var/log/example-app</kbd>. It will act as a data user or group.</p>
<p class="mce-root">To add some configuration to <kbd class="calibre17">/etc/logrotate.d/</kbd>, first open up a new file there:</p>
<div class="title-page-name">
<pre class="calibre22"><strong class="calibre3">$ sudo nano /etc/logrotate.d/example-app</strong></pre></div>
<p class="mce-root">Write the following code in <kbd class="calibre17">example-app</kbd>:</p>
<div class="title-page-name">
<pre class="calibre22">/var/log/example-app/*.log {<br class="calibre2"/>    daily<br class="calibre2"/>    missingok<br class="calibre2"/>    rotate 14<br class="calibre2"/>    compress<br class="calibre2"/>    notifempty<br class="calibre2"/>    create 0640 www-data www-data<br class="calibre2"/>    sharedscripts<br class="calibre2"/>    postrotate<br class="calibre2"/>        systemctl reload example-app<br class="calibre2"/>    endscript<br class="calibre2"/>}<br class="calibre2"/><br class="calibre2"/></pre></div>
<p class="mce-root">Some of the new configuration directives in this file are as follows:</p>
<ul class="calibre13">
<li class="calibre14"><kbd class="calibre17">create 0640 www-data www-data</kbd>: After rotation, this will create a new empty log file with specified permissions for the owner and group.</li>
<li class="calibre14"><kbd class="calibre17">sharedscripts</kbd>: This means that configuration scripts are run only once per run instead of there being a rotation for each file.</li>
<li class="calibre14"><kbd class="calibre17">postrotate</kbd> to <kbd class="calibre17">endscript</kbd>: This particular block has a script that has code for running after the log file is rotated. Using this, our application can switch over to the newly created log file.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">We can customize the <kbd class="calibre17">.config</kbd> file according to our needs and then save that file in <kbd class="calibre17">/etc/logrotate.d</kbd>. For that, run the following command:</p>
<div class="title-page-name">
<pre class="calibre22"><strong class="calibre3"> $ sudo logrotate /etc/logrotate.conf --debug</strong></pre></div>
<p class="mce-root">After running this command, logrotate will point the standard configuration file, and then it will be on debug mode. It will give us the information about the files which logrotate is handling.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Using Linux iptables for a firewall</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to set up a firewall using iptables. <strong class="calibre6">iptables</strong> is the standard firewall software present in most Linux distributions. We are going to use these set of rules to filter the network traffic. You can protect the server from unwanted traffic by filtering the data packets by specifying the source or destination IP address, port addresses, protocol types, network interfaces, and so on. We can configure this for accepting, rejecting, or forwarding network packets.</p>
<p class="mce-root">Rules are arranged in chains. By default, there are three chains (input, output, and forward). The input chain handles incoming traffic, while the output chain handles outgoing traffic. The forward chain handles routing traffic. Each chain has a default policy to adhere to if network packets do not match any policy inside the chain.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Please check that the following requirements are satisfied before proceeding to the next activity:</p>
<ul class="calibre13">
<li class="calibre14">Root privileges</li>
<li class="calibre14">SSH access (command line access to the server)</li>
<li class="calibre14">Make sure you have gt and looptools installed in your Linux environment</li>
<li class="calibre14">Basic skills for working on a Linux environment</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Now, we are going to see some of the <kbd class="calibre17">iptables</kbd> commands:</p>
<ol class="calibre20">
<li class="chapter">Run the following command to list all the rules that are set on the server:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sudo iptables -L</strong></pre></div>
<ol start="2" class="calibre20">
<li class="chapter">To allow incoming traffic from a specific port, use the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sudo iptables -A INPUT -p tcp --dport 4321 -j ACCEPT</strong></pre></div>
<p class="calibre38">This rule will allow incoming traffic from port <kbd class="calibre17">4321</kbd>. The firewall needs to be restarted to make this rule effective.</p>
<p class="calibre38"> Using <kbd class="calibre17">iptables</kbd>, you can block the incoming traffic. For that, run the following command:</p>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sudo iptables -A INPUT -j DROP</strong></pre></div>
<ol start="3" class="calibre20">
<li class="chapter">If any new rules are added in the <kbd class="calibre17">iptables</kbd>, we should save them first. Otherwise, after a system reboot, they will disappear. Run the following command to saving the <kbd class="calibre17">iptables</kbd> after adding new rules:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sudo iptables-save</strong></pre></div>
<ol start="4" class="calibre20">
<li class="chapter">The default file where rules are saved might differ depending on which Linux distribution you are working on.</li>
</ol>
<p class="mce-root"> </p>
<ol start="5" class="calibre20">
<li class="chapter">We can save rules in a specific file by using the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sudo iptables-save &gt; /path/to/the/file</strong></pre></div>
<ol start="6" class="calibre20">
<li class="chapter">You can restore these rules that are saved in the file. Run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sudo iptables-restore &gt; /path/to/the/file</strong></pre></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Using iptables, we can control the incoming traffic, drop the traffic on a specific port, and add new rules and save them.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Accessing SQL databases remotely or locally</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to learn how to automate SQL queries by connecting to a server using a shell script. Bash scripting is used for automating things.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Make sure that <kbd class="calibre17">mysql</kbd>, <kbd class="calibre17">postgres</kbd>, and <kbd class="calibre17">sqlite</kbd> are installed. Ensure that the user is created in MySQL and that you have granted permission to that user.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<ol class="calibre20">
<li class="chapter">MySQL queries in script: We are going to write a script called <kbd class="calibre17">mysql_version.sh</kbd> <span class="calibre11">to get the latest version of MySQL:</span></li>
</ol>
<div class="title-page-name">
<pre class="calibre27">#!/bin/bash<br class="calibre2"/>mysql -u root -pTraining2@^ &lt;&lt;MY_QUERY<br class="calibre2"/>SELECT VERSION();<br class="calibre2"/>MY_QUERY</pre></div>
<p class="mce-root1">Now, we are going to create a script called <kbd class="calibre17">create_database.sh</kbd> to create the database:</p>
<div class="title-page-name">
<pre class="calibre27">#!/bin/bash<br class="calibre2"/>mysql -u root -pTraining2@^ &lt;&lt;MY_QUERY<br class="calibre2"/>create database testdb;<br class="calibre2"/>MY_QUERY</pre></div>
<ol start="2" class="calibre20">
<li class="chapter">SQLite queries in script: Now, we are going to create a <kbd class="calibre17">sqlite</kbd> database. You can create the <kbd class="calibre17">sqlite</kbd> database by simply writing <kbd class="calibre17">sqlite3</kbd> and a name for the database. For example:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ sqlite3 testdb</strong></pre></div>
<p class="mce-root1">Now, we are going to create a table in the <kbd class="calibre17">sqlite</kbd> console. Enter <kbd class="calibre17">sqlite3 testdb</kbd> and press <em class="calibre18">Enter<span class="calibre16">—</span></em>you will see the sqlite3 console. Now, write the <kbd class="calibre17">create table</kbd> command to create a table:</p>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$  sqlite3 testdb</strong><br class="calibre2"/><strong class="calibre3">SQLite version 3.11.0 2016-02-15 17:29:24</strong><br class="calibre2"/><strong class="calibre3">Enter ".help" for usage hints.</strong><br class="calibre2"/><strong class="calibre3">sqlite&gt; .databases</strong><br class="calibre2"/><strong class="calibre3">seq  name             file         </strong><br class="calibre2"/><strong class="calibre3">---  ---------------  ----------------------------------------------------------</strong><br class="calibre2"/><strong class="calibre3">0   main             /home/student/testdb                                  </strong><br class="calibre2"/><strong class="calibre3">sqlite&gt; CREATE TABLE bookslist(title text, author text);</strong><br class="calibre2"/><strong class="calibre3">sqlite&gt; .tables</strong><br class="calibre2"/><strong class="calibre3">bookslist</strong></pre></div>
<ol start="3" class="calibre20">
<li class="chapter">Postgres queries in scripting: Now, we are going to check the postgresql database version. Here, <kbd class="calibre17">testdb</kbd> is our database name, which is what we created earlier. For that, run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">student@ubuntu:~$ sudo -i -u postgres</strong><br class="calibre2"/><strong class="calibre3">postgres@ubuntu:~$ psql</strong><br class="calibre2"/><strong class="calibre3">psql (9.5.13)</strong><br class="calibre2"/><strong class="calibre3">Type "help" for help.</strong><br class="calibre2"/><strong class="calibre3">postgres=# create database testdb;</strong><br class="calibre2"/><strong class="calibre3">CREATE DATABASE</strong><br class="calibre2"/><strong class="calibre3">postgres=# \quit</strong><br class="calibre2"/><strong class="calibre3">postgres@ubuntu:~$ psql testdb</strong><br class="calibre2"/><strong class="calibre3">psql (9.5.13)</strong><br class="calibre2"/><strong class="calibre3">Type "help" for help.</strong><br class="calibre2"/><strong class="calibre3">testdb=# select version();</strong><br class="calibre2"/><strong class="calibre3">                                                     version      </strong><br class="calibre2"/><strong class="calibre3">-------------------------------------------------------------------------------------------</strong><br class="calibre2"/><strong class="calibre3"> PostgreSQL 9.5.13 on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609, 64-bit</strong><br class="calibre2"/><strong class="calibre3">(1 row)</strong></pre></div>
<ol start="4" class="calibre20">
<li class="chapter">Now, we are going to create a table. For that, run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">postgres@ubuntu:~$ psql testdb</strong><br class="calibre2"/><strong class="calibre3">psql (9.5.13)</strong><br class="calibre2"/><strong class="calibre3">Type "help" for help.</strong><br class="calibre2"/><strong class="calibre3">testdb=# create table employee(id integer, name text, address text, designation text, salary integer);</strong><br class="calibre2"/><strong class="calibre3">CREATE TABLE</strong><br class="calibre2"/><strong class="calibre3">testdb=#</strong></pre></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<ol class="calibre20">
<li class="chapter">We are creating bash scripts to check the version of a database and to create a new database. In these scripts, we are using the root user and there is a password present right after <kbd class="calibre17">-p</kbd> for that user. You can use the <kbd class="calibre17">root</kbd> user or else you can create a new user, assign a password to it, and use that user in your scripts.</li>
<li class="chapter">SQLite software provides us with a simple command-line interface. Using this interface, we can manually enter and execute SQL commands. You can list the database using the dot (<kbd class="calibre17">.</kbd>) operator. <kbd class="calibre17">.databases</kbd> and <kbd class="calibre17">.tables</kbd> are used to list all the tables in the database.</li>
<li class="chapter">In PostgreSQL, first we are changing the user from student to postgres. Then, we enter <kbd class="calibre17">psql</kbd> to start the <kbd class="calibre17">postgres</kbd> command-line console. In that console, we must create the <kbd class="calibre17">testdb</kbd> database. To come out of the console, run the <kbd class="calibre17">\quit</kbd> command. Now, once again, start the <kbd class="calibre17">testdb</kbd> console by typing <kbd class="calibre17">psql testdb</kbd> and pressing <em class="calibre26">Enter.</em> Now, create a table in that database.</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Creating SSH keys for password less remote access</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to learn how to log in without a password using SSH. <strong class="calibre6">SSH</strong> is an open source network protocol and is used to log in to the remote servers to perform some actions. We can use the SSH protocol to transfer files from one computer to another. SSH uses public key cryptography.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Make sure you have SSH access.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<ol class="calibre20">
<li class="chapter">First, we are going to create a SSH key. The <kbd class="calibre17">ssh-keygen</kbd> command is used to create a SSH key. Run the command as follows:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ ssh-keygen</strong></pre></div>
<p class="calibre38">You will get the following output:</p>
<pre class="calibre39"><strong class="calibre3">Generating public/private rsa key pair.</strong><br class="calibre2"/><strong class="calibre3">Enter file in which to save the key (/home/student/.ssh/id_rsa): /home/student/keytext</strong><br class="calibre2"/><strong class="calibre3">Enter passphrase (empty for no passphrase):</strong><br class="calibre2"/><strong class="calibre3">Enter same passphrase again:</strong><br class="calibre2"/><strong class="calibre3">Your identification has been saved in /home/student/keytext.</strong><br class="calibre2"/><strong class="calibre3">Your public key has been saved in /home/student/keytext.pub.</strong><br class="calibre2"/><strong class="calibre3">The key fingerprint is:</strong><br class="calibre2"/><strong class="calibre3">SHA256:6wmj6l9EcjufZhvwQ+iKIqEchO1mtEwC/x5rMyoKyeY student@ubuntu</strong><br class="calibre2"/><strong class="calibre3">The key's randomart image is:</strong><br class="calibre2"/><strong class="calibre3">+---[RSA 2048]----+</strong><br class="calibre2"/><strong class="calibre3">|                 |</strong><br class="calibre2"/><strong class="calibre3">|.                |</strong><br class="calibre2"/><strong class="calibre3">|oo  . o          |</strong><br class="calibre2"/><strong class="calibre3">|o.=  + o         |</strong><br class="calibre2"/><strong class="calibre3">|.* o  * S        |</strong><br class="calibre2"/><strong class="calibre3">|oo* oo * o       |</strong><br class="calibre2"/><strong class="calibre3">|=*.. o= X        |</strong><br class="calibre2"/><strong class="calibre3">|O. .*+ * =       |</strong><br class="calibre2"/><strong class="calibre3">|+E==+o  +        |</strong><br class="calibre2"/><strong class="calibre3">+----[SHA256]-----+</strong></pre>
<ol start="2" class="calibre20">
<li class="chapter">Now, we will copy the SSH public key to the remote host. Run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ ssh-copy-id remote_hostname</strong></pre></div>
<ol start="3" class="calibre20">
<li class="chapter">Now, you can log in to the remote host without a password. Run the <kbd class="calibre17">ssh</kbd> command as follows:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ ssh remote_hostname</strong></pre></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Creating and configuring cron Jobs for task scheduling</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to learn how to configure Cron Jobs. We are going to use crontab to set up a Cron Job.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<ol class="calibre20">
<li class="chapter">Open your terminal and go to the <kbd class="calibre17">/etc</kbd> folder and check the <kbd class="calibre17">/cron</kbd> folders. You will see the following cron folders:
<ul class="calibre13">
<li class="calibre28"><kbd class="calibre17">/etc/cron.hourly</kbd></li>
<li class="calibre28"><kbd class="calibre17">/etc/cron.daily</kbd></li>
<li class="calibre28"><kbd class="calibre17">/etc/cron.weekly</kbd></li>
<li class="calibre28"><kbd class="calibre17">/etc/cron.monthly</kbd></li>
</ul>
</li>
<li class="chapter">Now, we will copy our shell script into one the preceding folders. </li>
<li class="chapter">If you need to run your shell script to run daily, place it in the <kbd class="calibre17">cron.daily</kbd> folder. If you need to run it hourly, place it in the <kbd class="calibre17">cron.hourly</kbd> folder, and so on.</li>
<li class="chapter">Example: Write a script and place it in the <kbd class="calibre17">cron.daily</kbd> folder. Make the script executable by giving the necessary permissions.</li>
<li class="chapter">Now, run the <kbd class="calibre17">crontab</kbd> command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ crontab -e</strong></pre></div>
<ol start="6" class="calibre20">
<li class="chapter">Press <em class="calibre26">Enter</em> and it will ask for the editor of your type. By default, it will open <kbd class="calibre17">vi</kbd> editor. In my case, I selected <kbd class="calibre17">nano</kbd>. Now, create a <kbd class="calibre17">cron</kbd> command. The syntax for creating the <kbd class="calibre17">cron</kbd> command is:
<ul class="calibre13">
<li class="calibre28">The number of minutes after the hour (0 to 59)</li>
<li class="calibre28">The hour in military time (24 hour) format (0 to 23)</li>
<li class="calibre28">The day of the month (1 to 31)</li>
<li class="calibre28">The month (1 to 12)</li>
<li class="calibre28">The day of the week (0 or 7 is Sunday, or use the appropriate name)</li>
<li class="calibre28">The command to run</li>
</ul>
</li>
<li class="chapter">If you enter <kbd class="calibre17">*</kbd> in all options before the script name, you script will execute, every minute of every hour, of every day of the month, of every month and every day in the week.</li>
<li class="chapter">Now, add the following line in your script:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"> * * * * * /etc/name_of_cron_folder/script.sh</pre></div>
<ol start="9" class="calibre20">
<li class="chapter">Save the file and exit.</li>
<li class="chapter">You can list the existing jobs by running the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ crontab -l</strong></pre></div>
<ol start="11" class="calibre20">
<li class="chapter">To remove the existing Cron Job, delete the line that contains your Cron Job and save it. Run the following command:</li>
</ol>
<div class="title-page-name">
<pre class="calibre27"><strong class="calibre3">$ crontab -e</strong></pre></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">We used the <kbd class="calibre17">crontab</kbd> command to add and delete the Cron Job. Use the appropriate settings to execute your script daily, hourly, monthly, and weekly.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Creating users and groups systematically</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this section, we are going to learn how to create users and groups through a shell script.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Now, we will create a script to add a user. The <kbd class="calibre17">useradd</kbd> command is used to create a user. We are going to use the <kbd class="calibre17">while</kbd> loop, which will read our <kbd class="calibre17">.csv</kbd> file, and we will use the <kbd class="calibre17">for</kbd> loop to add each user that's present in that <kbd class="calibre17">.csv</kbd> file.</p>
<p class="mce-root">Create a script using <kbd class="calibre17">add_user.sh</kbd>:</p>
<div class="title-page-name">
<pre class="calibre22">#!/bin/bash<br class="calibre2"/>#set -x<br class="calibre2"/>MY_INPUT='/home/mansijoshi/Desktop'<br class="calibre2"/>declare -a SURNAME<br class="calibre2"/>declare -a NAME<br class="calibre2"/>declare -a USERNAME<br class="calibre2"/>declare -a DEPARTMENT<br class="calibre2"/>declare -a PASSWORD<br class="calibre2"/>while IFS=, read -r COL1 COL2 COL3 COL4 COL5 TRASH;<br class="calibre2"/>do<br class="calibre2"/>    SURNAME+=("$COL1")<br class="calibre2"/>    NAME+=("$COL2")<br class="calibre2"/>    USERNAME+=("$COL3")<br class="calibre2"/>    DEPARTMENT+=("$COL4")<br class="calibre2"/>    PASSWORD+=("$COL5")<br class="calibre2"/>done &lt;"$MY_INPUT"<br class="calibre2"/>for index in "${!USERNAME[@]}"; do<br class="calibre2"/>    useradd -g "${DEPARTMENT[$index]}" -d "/home/${USERNAME[$index]}" -s /bin/bash -p "$(echo "${PASSWORD[$index]}" | openssl passwd -1 -stdin)" "${USERNAME[$index]}"<br class="calibre2"/>done</pre></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this recipe, we have used <kbd class="calibre17">while</kbd> and <kbd class="calibre17">for</kbd> loops. The <kbd class="calibre17">while</kbd> loop will read our <kbd class="calibre17">.csv</kbd> file. It will create arrays for each column. We used <kbd class="calibre17">-d</kbd> for the home directory, <kbd class="calibre17">-s</kbd> for the bash shell, and <kbd class="calibre17">-p</kbd> for the password.</p>


            </article>

            
        </section>
    </div>



  </body></html>