<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Delivering Published Apps with Horizon 7</h1>
                </header>
            
            <article>
                
<p>So far in this book, we have concentrated on the delivery of virtual desktop machines, but Horizon View also has the ability to deliver remote applications, or published applications, as they're more commonly known, as well as session-based desktops, all from the same platform. In this chapter, we are going to dive deeper into this feature, which is part of the Horizon Advanced Edition and above, and look at how Horizon View publishes an application directly into the Horizon View Client, without the need to launch a full virtual desktop machine.</p>
<p>A use case for this could be a call center worker who uses just a couple of different applications. It's far easier from a management perspective to just give them the applications they require rather than a full-blown virtual desktop. Another use case is the ability to launch applications using the View Client running on a device that wouldn't normally be able to run that application. For example, you could run the "real" version of Microsoft Word on your iPad using the Horizon View Client for iOS.</p>
<p>The infrastructure required for this is based on Microsoft <strong>Remote Desktop Services</strong> (<strong>RDS</strong>) running at the backend, with Horizon View acting as the broker to connect users with the applications or desktop sessions. As it's View-based, it uses the View protocols, such as PCoIP and Blast, as the delivery protocols, taking advantage of all the features the protocols have to offer, as we have discussed previously.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Architectural overview</li>
<li>RDSH sizing guidelines</li>
<li>Installing and configuring View-hosted apps</li>
<li>Installing the Horizon View Agent for RDSH</li>
<li>Configuring published apps in the View Administrator</li>
<li>Load-balancing published apps in Horizon View</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Architectural overview</h1>
                </header>
            
            <article>
                
<p>So, what does the architecture look like, and how does the hosted application feature work when compared to virtual desktop machine brokering? In terms of the architecture, delivering hosted applications is handled in pretty much the same way as virtual desktop machines are managed and brokered.</p>
<p>Horizon View acts as the broker, using the same Connection Server, but instead of brokering a virtual desktop machine that would be running on the ESXi host server, it is now brokering an application session that is running on a Microsoft Windows server, configured with the RDSH role and the applications installed on it.</p>
<p>The following diagram gives you a high-level outline of the architecture for delivering hosted applications:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/86227e67-de18-4b54-9e13-0804402a6caf.png" style=""/></div>
<p>So, how does the hosted application feature work?</p>
<p>To begin with, as with connecting to a View delivered to the virtual desktop machine, you launch the View client and log in to the Connection Server. You enter the details of the View Connection Server you want to connect to (<strong>1</strong>), enter your <span class="packt_screen">User name</span> and <span class="packt_screen">Password</span> (<strong>2</strong>), and then authenticate against AD (<strong>3</strong>).</p>
<p>Once authenticated, the client sends a <kbd>&lt;get-launch-items&gt;</kbd> request to the Connection Server to request a list of all the entitled application sessions, applications, and desktops for that user. The response contains the following details:</p>
<ul>
<li><kbd>&lt;app-sessions&gt;</kbd>, <kbd>&lt;desktops&gt;</kbd>, and <kbd>&lt;applications&gt;</kbd></li>
<li>Absolute paths to the icons</li>
</ul>
<p>The client fetches any icons it doesn't have already cached via HTTPS using the paths that were provided by the Connection Server when it sent the response.</p>
<p>Access to icon <strong>uniform resource identifiers</strong> (<strong>URIs</strong>) needs to be authenticated. The Connection Server performs an entitlement check and only returns an icon if that user is entitled to at least one application that has an icon associated with it. For applications that don't have any icons, the client will provide a default icon.</p>
<p>A list of entitled desktop and application pools is then displayed to the end user in the View Client (<strong>4</strong>).</p>
<p>The end user then double-clicks on an application (or desktop) to launch it (<strong>5</strong>), the connection is made, and the application opens in a new window (<strong>6</strong>).</p>
<p>In the next section, we will take a deep dive into what happens during the connection process to connect the user to the application or desktop session they requested.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Application connection sequence</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to break down the connection sequence into three separate parts, showing the process flow of what happens when the user launches an application.</p>
<p>The process starts when the end user double-clicks to launch an application and is illustrated in the following diagram:</p>
<p class="NormalPACKT"><span>So, now we have a user that has made a request via the View Client to the Connection Server to launch an application.</span></p>
<p class="NormalPACKT"><span>The next phase of the connection process is for the Connection Server to talk to the Horizon Agent installed on the RDS host server.</span></p>
<p class="NormalPACKT"><span>The following diagram illustrates the next part of the process:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/83e038dc-7344-41ff-879c-1cc5d6859d84.png" style=""/></div>
<p>The next step in the connection process is to set up the secure connection to the <strong>PCoIP Secure Gateway server</strong> (<strong>PSG</strong>).</p>
<p>A tunnel is set up by the View agent on the RDS server by talking to the PSG. The details of this connection are then forwarded, via the Connection Server, back to the client. This is pretty much the same way that this process works when connecting to a virtual desktop machine hosted on an ESXi host server.</p>
<p>This process is illustrated in the following diagram, along with the final part of the process, which is to log the end user in and then connect them to the application that they requested:</p>
<p class="mce-root"/>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cb391750-cea4-49ad-b1c0-05468e0502e0.png" style=""/></div>
<p>We have now covered a deep dive on how the process works for connecting the end user to their remote applications. In the next section, we are going to look at some of the specifics around the RDS roles in this environment, starting with sizing guidelines.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">RDSH sizing guidelines</h1>
                </header>
            
            <article>
                
<p>As with the sizing of View for virtual desktop machines, configuring the right specification for the RDSH servers is also key, and in a similar way in which we consider the desktop sizing, we are going to look at different user types.</p>
<p>The VMware recommendation for the user workloads and the memory requirements are shown in the following table:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/acdfdfed-f21e-4588-bd0c-296d8a162345.png" style=""/></div>
<p>For the total memory in each RDSH server, VMware recommends that a virtual machine configured as an RDSH server should be provisioned with 64 GB memory, and in terms of CPU requirements, the VMware recommendation is to create virtual servers for the RDSH roles and configure each one with four vCPUs. Make sure that you do not overcommit on the number of cores.</p>
<p>So, for example, if you had a virtual machine running as an RDSH server configured with 64 GB of memory, and had heavy users hosted on it, you would be able to host a maximum of 64 sessions on that server.</p>
<p>For the hardware configuration, let's say you had a physical ESXi host server, configured with a 2-socket CPU that had 12 cores, giving you a total of 24 cores.</p>
<p class="mce-root"/>
<p>This would allow a maximum of 6 RDSH servers as we are going to provision virtual machines for the RDSH role that each has 4 cores (24 cores/4 cores per server). That would mean that the physical server would also need to be configured with 384 GB of memory in total (64 GB x 6 RDSH host servers).</p>
<p>These figures are only guidelines and are based on some of the VMware-recommended best practices. It is always best to run an assessment on your environment to work out your optimum configuration.</p>
<p>In the next section, we are going to install and configure the View-hosted applications feature.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing and configuring View-hosted apps</h1>
                </header>
            
            <article>
                
<p>We are now going to start the installation process, starting with configuring the server that is going to be used for hosting the remote applications, by adding the RDSH role to it. In the example lab, there is a Windows Server 2016 server ready built, called <strong>RDSH-Apps</strong>, to perform this role.</p>
<p>The installation and configuration process is pretty straightforward and can be summarized with the following schematic diagram:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/90e0fef1-4c4b-4225-a0bb-fae4c1e0e295.png" style=""/></div>
<p>In the next sections, we are going to walk through this process in more detail, starting with configuring the RDSH role.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring the RDS server role</h1>
                </header>
            
            <article>
                
<p>The first thing that we are going to do is to configure the RDSH server role, and then configure this server to deliver the remote applications. In the example lab, the server we are going to configure is called <strong>RDSH-Apps</strong>. To configure the RDSH role, perform the following steps:</p>
<ol>
<li>Open a console to the server, and then from the <span class="packt_screen">Server Manager</span> and the <span class="packt_screen">Dashboard</span> screen, click on <span class="packt_screen">Add roles and features</span> (<strong>1</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/01715728-5418-4193-8630-5496a06da4e4.png" style=""/></div>
<ol start="2">
<li class="mce-root">The first screen you will see is the <span class="packt_screen">Before You Begin</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d6e8c259-de54-47e4-abbb-990b2170ab0f.png"/></div>
<ol start="3">
<li>Click <span class="packt_screen">Next &gt;</span> to continue.</li>
</ol>
<ol start="4">
<li>You will now see the <span class="packt_screen">Select installation type</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/bd66acf7-deb5-4f45-98e5-50b606be2bf5.png"/></div>
<ol start="5">
<li>Click the radio button for <span class="packt_screen">Remote Desktop Services installation</span>, and then click <span class="packt_screen">Next &gt;</span> to continue.</li>
</ol>
<ol start="6">
<li>You will now see the <span class="packt_screen">Select deployment type</span> <span>screen, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0ecef8a3-7de2-4622-bc18-336f42356500.png"/></div>
<ol start="7">
<li>Click the radio button for <span class="packt_screen">Quick Start</span>, and then click <span class="packt_screen">Next &gt;</span> to continue.</li>
<li>You will now see the <span class="packt_screen">Select deployment scenari</span><strong>o</strong> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/491fa8e0-1761-40b0-8d33-a3bf9b52b4a2.png"/></div>
<ol start="9">
<li>Click the radio button for <span class="packt_screen">Session-based desktop deployment</span>, and then click <span class="packt_screen">Next &gt;</span> <span>to</span> continue<span>.</span></li>
<li>You will now see the <span class="packt_screen">Select a server</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9c00eb59-21a6-427b-aace-5533faf18a23.png"/></div>
<ol start="11">
<li>From the <span class="packt_screen">Server Pool</span> box, click and highlight the server you want to install the RDSH role onto and click the arrow to add it to the <span class="packt_screen">Selected</span> box. In the example lab, this is the server called <kbd>rdsh-apps.pvolab.com</kbd>.</li>
<li>Click <span class="packt_screen">Next &gt;</span> to continue.</li>
</ol>
<ol start="13">
<li>You will now see the <span class="packt_screen">Confirm selections</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0db1a638-4c5e-4802-a28e-72febed2d7dc.png"/></div>
<ol start="14">
<li>Check the services that are going to be installed, and then check the box to <span class="packt_screen">Restart the destination server automatically if required</span>.</li>
<li>Click <span class="packt_screen">Deploy</span> to start the installation.</li>
</ol>
<ol start="16">
<li>You will now see the progress of the installation, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/af11eb06-d8b0-4648-8410-8acbf73202bc.png"/></div>
<ol start="17">
<li>During the installation, the server will reboot. After rebooting, log back in and launch the Server Manager again to monitor the rest of the installation process.</li>
<li>Once the installation has completed, from the <span class="packt_screen">Server Manager Dashboard<strong>,</strong></span> you will now see that the <span class="packt_screen">Remote Desktop Services</span> role has been added, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7977ba47-0de5-4f93-b3b1-1572f35ae13e.png"/></div>
<p><span>You have now successfully installed the RDS role.</span></p>
<div class="packt_infobox">You will need to add and configure the Remote Desktop Licensing role on this server.</div>
<p class="NormalPACKT"><span>In the next section, we will configure some example applications that will be made available as remote applications.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Testing with the standard remote applications</h1>
                </header>
            
            <article>
                
<p>The first applications we are going to configure for session-based remote access are those that are integrated into the Windows operating system and configured by default when you create the RDSH server role. These include applications such as Calculator and Notepad.</p>
<p>We are going to test that these applications work as remote applications by first checking they have been configured, and then whether or not we can access them remotely, before configuring the Horizon View components and any additional applications:</p>
<ol>
<li>From the <span class="packt_screen">Server Manager Dashboard</span> screen, click on <span class="packt_screen">Remote Desktop Services</span> (<strong>1</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/887f9e20-20fc-4578-89dd-ecd3c66a2882.png"/></div>
<ol start="2">
<li>You will then see the list of servers that are configured with the RDSH role, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4455f1f5-d6b3-48cc-ae20-27047e86ca21.png"/></div>
<ol start="3">
<li>Click to highlight the <kbd>RDSH_APPS</kbd> server, and then click on <span class="packt_screen">QuickSessionCollection</span> (<strong>3</strong>).</li>
</ol>
<ol start="4">
<li>You will now see the <span class="packt_screen">QuickSessionCollection</span> and <span class="packt_screen">REMOTEAPP PROGRAMS</span> (<strong>4</strong>) boxes, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d5fa29c4-3c78-483f-aba7-66abb4726fde.png"/></div>
<p>This will show WordPad, Paint, and Calculator listed as available remote applications.</p>
<p>So, now that the standard applications are available as remote sessions for end users, we are going to try connecting using the RD Web Access web portal to test that everything is working before continuing with the configuration. To do this, perform the following steps:</p>
<ol start="1">
<li>Open a browser from either your desktop or the server itself. It's best to test from a remote desktop rather than the server itself.</li>
<li>In the browser, type in the URL of the RDSH server. In the example lab, this address is <kbd>https://rdsh-apps.pvolab.com/rdweb</kbd><strong>.</strong></li>
</ol>
<ol start="3">
<li>You will then see the login screen, as shown in the following screenshot:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/414c3d01-1aeb-4271-9268-d382ed0c7d54.png"/></div>
<ol start="4">
<li>In the <span class="packt_screen">Domain\user name</span> box, enter a username in the format of <span class="packt_screen">Domain\user name</span>. So, for this example, we are logging in as the administrator using the format <kbd>pvolab\administrator</kbd>. Then enter the password.</li>
<li>Now click the <span class="packt_screen">Sign in</span> button. You will now see the following <span class="packt_screen">Work Resources</span> web page, which displays the available applications:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/80e7a241-13ff-4e24-b638-58bdc2264f6d.png" style=""/></div>
<p class="NormalPACKT"><span>To test that an application launches, double-click on it. In this example, we will launch the calculator.</span> <span>The calculator should then successfully launch, as shown in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/28e38c7b-3d71-4277-b022-1309a5d47f33.png" style=""/></div>
<p class="NormalPACKT"><span>Now that everything is working and applications can be published and launched, in the next section, we are going to add some more applications.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing additional applications</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to install some additional application for remote access, starting with Microsoft Office 2016.</p>
<p>Installing applications is almost identical to installing applications on any other Windows operating system; however, there are a few subtle differences given that this is a remote session host server. We are going to quickly run through the process, as described in the following steps:</p>
<ol>
<li>As we are going to install <span>Microsoft Office 2016</span>, the first thing to do is mount the ISO image containing the installer, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/89f1c700-8124-405b-b407-628f7046d0f8.png"/></div>
<p style="padding-left: 60px">We can now move on to the actual installation process.</p>
<ol start="2">
<li>Open a console to the RDSH server on which you want to install the applications and open the <span class="packt_screen">Control Panel<strong>,</strong></span> as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4364f1d5-9f5e-46d8-bae7-6b7d5270ff98.png"/></div>
<ol start="3">
<li>Click on <span class="packt_screen">Programs</span>. You will now see the <span class="packt_screen">Programs</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8884c51d-ee2d-43a5-b4fd-f9c7b12b3583.png"/></div>
<ol start="4">
<li>Click on <span class="packt_screen">Install Application on Remote Desktop...</span>.</li>
</ol>
<ol start="5">
<li>You will now see the <span class="packt_screen">Install Program From Floppy Disk or CD-ROM</span> <span>dialog box, as shown in the following screenshot:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/78c87c5c-5db3-4ce0-aced-c3f417a5b486.png"/></div>
<p>Before we continue, we are going to talk about how to install apps on an RDSH server. In this dialog box, it highlights something called the <strong>RD-Install mode</strong>; so, what does that mean?</p>
<p>To install an application on an RDSH host server, it needs to be switched into a special install mode called <strong>RD-Install</strong> to make sure that the applications are able to run in a multi-user environment.</p>
<p>Once you have installed the applications on the RDSH server, the server will then need to be switched back into what is called the execution mode, or <strong>RD-Execute</strong>, so that users can remotely connect to the server and the applications running on it.</p>
<p>This can also be done at the command line, using the following commands:</p>
<pre><strong>change user /install<br/></strong><strong>change user /execute</strong></pre>
<p>You can check the current install mode of your RDSH server using the following command:</p>
<pre><strong>change user /query</strong></pre>
<p>The easiest way to install applications is by using the <span class="packt_screen">Programs</span> option from the <span class="packt_screen">Control Panel</span>, which is how we are going to do it in this example. This option takes you through the installation process by automatically switching the server to the RD-Install mode, installing the program, and switching the server back to the RD-Execute mode once finished. <span>Let's continue with the installation:</span></p>
<ol>
<li><span>Click</span> <span class="packt_screen">Next &gt;</span> <span>to start the installation.</span></li>
<li><span>You will now see that the</span> <span class="packt_screen">Run Installation Program</span> <span>dialog box is displayed, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b69aed00-3974-4bad-bdb5-9d053b7130d3.png"/></div>
<ol start="3">
<li>Click the <span class="packt_screen">Browse...</span> button and then navigate to the installer for the app you want to install. In the example lab, this is the <kbd>setup.exe</kbd> file for <span>Microsoft Office 2016</span> from the ISO image we mounted at the beginning of this section.</li>
<li>Now click <span class="packt_screen">Next &gt;</span> to continue.</li>
</ol>
<ol start="5">
<li>The first thing you will see is the <span class="packt_screen">Finish Admin Install</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0b69c56d-3b54-4321-b337-4c698fdec722.png"/></div>
<div class="packt_infobox">Ignore this dialog box for now, and make sure that you <strong>DO NOT</strong> click the <strong>Finish</strong> button at this point. You need to complete the application installation first.</div>
<ol start="6">
<li>The installation of Office 2016 will now run, and you should install Office in exactly the same way as you would normally.</li>
<li>Once the installation is complete, return to the <span class="packt_screen">Finish Admin Install</span> <span>box and click on the</span> <span class="packt_screen">Finish</span> <span>button.</span></li>
</ol>
<p>Now Microsoft Office 2016 has been installed on the RDSH server, you need to go back and configure which of the individual Office suite applications are going to be made available to the users as remote applications. To do this, perform the following steps:</p>
<ol>
<li class="NormalPACKT"><span>From the</span> <span class="packt_screen">Server Manager d</span>ashboard <span>screen, click on</span> <span class="packt_screen">Remote Desktop Services</span>.</li>
<li class="NormalPACKT"><span>Highlight the RDSH server you want to configure, and then click on</span> <span class="packt_screen">QuickSessionCollection</span> <span>(<strong>1</strong>), as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e1d5ab0b-919a-4f9c-affc-a188d190cdf4.png"/></div>
<ol>
<li class="NormalPACKT" style="list-style-type: none">
<ul>
<li class="NormalPACKT"><span>Scroll down to the</span> <span class="packt_screen">REMOTEAPP PROGRAMS</span> <span>dialog box and then click the down arrow on the</span> <span class="packt_screen">TASKS</span> <span>button in the top right of the screen, and then click</span> <span class="packt_screen">Publish RemoteApp Programs</span> <span><span>(<strong>4</strong>).</span></span></li>
<li class="NormalPACKT">You will now see the <span class="packt_screen">Select RemoteApp programs</span> <span>configuration screen, as shown in the following screenshot:</span></li>
</ul>
</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6727e6aa-7d58-44c8-b2b4-22b8ae6b4fe1.png"/></div>
<ol start="3">
<li>From here, you can select which applications you want to publish and make available remotely to your end users.</li>
<li>Check the boxes next to the applications you want to add (<strong>3</strong>). In the example lab, we are going to check the boxes for the following applications:
<ul>
<li><span class="packt_screen">Excel 2016</span></li>
<li><span class="packt_screen">OneNote 2016</span></li>
<li><span class="packt_screen">Outlook 2016</span></li>
<li><span class="packt_screen">PowerPoint 2016</span></li>
<li><span class="packt_screen">Publisher 2016</span></li>
<li><span class="packt_screen">Word 2016</span></li>
</ul>
</li>
<li>From here, you can select which applications you want to publish and make available remotely to your end users.</li>
</ol>
<ol start="6">
<li>Once you have selected all the applications you want to publish, click the <span class="packt_screen">Next &gt;</span> <span>button.</span></li>
<li>You will now see the <span class="packt_screen">Confirmation</span> <span>box of the applications you selected, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/89102d39-fa6d-4fe3-8fae-eaee2d716a45.png"/></div>
<ol start="8">
<li>Now click the <span class="packt_screen">Publish</span> button.</li>
<li>You will then see a progress bar, detailing the progress of the applications being published, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c49833dc-ce39-4f60-85da-595cd98f994e.png"/></div>
<p class="mce-root"/>
<ol start="10">
<li>Once completed, you will now see the <span class="packt_screen">Completion</span> <span>screen, as shown in the following screenshot, detailing the applications that were successfully published:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/865c37fc-c2b2-4f5b-9432-9df58bf05344.png"/></div>
<ol start="11">
<li>Click the <span class="packt_screen">Close</span> button to complete the publishing process.</li>
</ol>
<p>As previously, we are going to test that the applications are available from the web access portal. Open a browser and go to the following address: <kbd>https://rdsh-apps.pvolab.com/rdweb</kbd><strong>.</strong></p>
<p>Log in to the portal using the administrator account.</p>
<p>You will see the following screenshot from the RD web access portal, showing the newly published applications for Office 2016:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/431662ee-4735-4468-ab85-8f105199ea80.png" style=""/></div>
<p class="NormalPACKT"><span>As you can see, the newly published Office applications are available to the end users. Double-click on one of them to test that it launches and, once happy it's working, then click on</span> <span class="packt_screen">Sign out</span> <span>and close the web page.</span></p>
<p class="NormalPACKT"><span>In the next section, we are going to install the Horizon Agent on the RDSH server.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Horizon Agent for RDSH</h1>
                </header>
            
            <article>
                
<p>In the next part of the process, we are going to install the Horizon View Agent onto the RDSH server. The agent is exactly the same agent as the one that you would install on virtual desktop machines and registers the RDSH with the Horizon Connection Server. To install the agent, perform the following steps:</p>
<ol>
<li>Open a remote console to the RDSH server running the applications, navigate to the shared software folder, and then find the agent installer, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/182c016d-ef19-47b3-bf4d-77b1e4d0cc27.png" style=""/></div>
<ol start="2">
<li>Double-click to launch <kbd>VMware-Horizon-Agent-x86_64-7.6.0-9539447</kbd>. The seven-digit number at the end of the filename refers to the build version, and so you may have a different number, depending on the build version you are using.</li>
</ol>
<ol start="3">
<li>You will now see the <span class="packt_screen">Welcome to the Installation Wizard for VMware Horizon View Agent</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f7bce05d-d015-4eb3-95e5-71b246059013.png" style=""/></div>
<ol start="4">
<li>Click the <span class="packt_screen">Next &gt;</span> button to start the installation.</li>
</ol>
<ol start="5">
<li>You will now see the <span class="packt_screen">License Agreement</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/69802673-ce2f-4e2d-aa75-e5aca326a1ec.png" style=""/></div>
<ol start="6">
<li>Click the radio button for <span class="packt_screen">I accept the terms in the license agreement</span>, and then cli<span>ck the</span> <span class="packt_screen">Next &gt;</span> <span>button to continue.</span></li>
</ol>
<ol start="7">
<li>You will now see the <span class="packt_screen">Network protocol configuration</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6cdd8330-d40c-428c-97e4-b76f2542ca59.png" style=""/></div>
<ol start="8">
<li>Click on <span class="packt_screen">IPv4</span> and then click on the <span class="packt_screen">Next &gt;</span> button to continue the installation.</li>
</ol>
<ol start="9">
<li>You will now see the <span class="packt_screen">Custom Setup</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/85789811-08e6-4345-9c2b-34367e5f0e25.png" style=""/></div>
<p style="padding-left: 120px">In the example lab, we are going to accept the default options; however, you can choose to install the 3D RDSH, USB Redirection, View Composer, and Flash Redirection options, should you want to.<br/>
As you can see, there are a number of features that can be installed as part of the View Agent installation. These are listed here:</p>
<ul>
<li style="padding-left: 90px"><span class="packt_screen">Core</span>: Installs the core features required for RDSH</li>
<li style="padding-left: 90px"><span class="packt_screen">3D RDSH</span>: Enables 3D acceleration in RDSH sessions</li>
<li style="padding-left: 90px"><span class="packt_screen">USB Redirection</span>: Redirects USB devices from the client to the RDSH session</li>
<li style="padding-left: 90px"><span class="packt_screen">VMware Horizon View Composer Agent</span>: Allows RDS host servers to be built from a single parent image using linked clone technology to easily deploy the RDS server farm</li>
<li style="padding-left: 90px"><span class="packt_screen">Client Redirection</span>: Allows clients to share local drives with the RDS sessions (not supported when using IPv6)</li>
<li style="padding-left: 90px"><span class="packt_screen">Virtual Printing</span>: Allows printing from RDS sessions</li>
<li style="padding-left: 90px"><span class="packt_screen">vRealize Operations Desktop Agent</span>: Allows the management agent to be deployed for monitoring RDS sessions with vRealize</li>
<li style="padding-left: 90px"><span class="packt_screen">Flash Redirection</span>: Enables the Flash redirection feature with RDS sessions (note that this is currently a tech preview in this version of Horizon View)</li>
</ul>
<ol start="10">
<li>Click the <span class="packt_screen">Next &gt;</span> button to continue the installation.</li>
<li><span>You will now see the</span> <strong><span class="packt_screen">Register with Horizon 7 Connection Server</span></strong> <span>configuration screen, where we will configure the Horizon Agent to talk to the Connection Server. This allows the Connection Server to read the published applications list from the</span> RemoteApp <span>catalog and allows you to create application pools within View.</span></li>
<li><span>In the</span> <span class="packt_screen">hostname or IP address</span> <span>box, enter the name of the Connection Server. In the example, this is</span> <kbd>hzn7-cs1.pvolab.com</kbd><span>.</span></li>
<li><span>In the</span> <span class="packt_screen">Authentication</span> <span>section, click the radio button for</span> <span class="packt_screen">Specify administrator credentials</span> <span>and then in the</span> <span class="packt_screen"><strong><span class="underline">U</span>sername</strong></span> <span>box, enter the user account you want to use to connect to the Connection Server. In the example lab, this is</span> <span class="packt_screen">pvolab\administrator</span><span>.</span></li>
</ol>
<div class="packt_infobox">Make sure you use the <span>D</span><span class="packt_screen">omain\user</span> format <span>to enter the username, and also that the account has the correct privileges to access the Connection Server. You would typically use a service account for this.</span></div>
<ol start="14">
<li>In the <span class="packt_screen"><span class="underline">P</span>assword</span> box, type in the password for the account, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d47d9c38-a8c6-4ddf-a078-3ec699a6d392.png"/></div>
<ol start="15">
<li>Click the <span class="packt_screen">Next &gt;</span> button to continue the installation.</li>
<li>You will now see the <span class="packt_screen">Ready to Install the Program</span> screen. Click the <span class="packt_screen">Install</span> button to start the installation process.</li>
<li>Once <span>successfully installed, you will see the</span> <span class="packt_screen">Installer Complete</span> <span>screen.</span></li>
<li><span>Click</span> <span class="packt_screen">Finish</span> <span>to quit the installation.</span></li>
<li>You will then be prompted to reboot the server. Click <span class="packt_screen">Yes</span> to reboot.</li>
</ol>
<div class="packt_infobox">One of the most common reasons that the installation of the View agent fails is down to the configuration of the RDSH server. More often than not, there are no sound drivers loaded on the Windows Server running the RDSH role. If this is the case, then the installation of the agent will fail and automatically roll back. If that happens, it is worth checking this first.</div>
<p>We have now completed the first part of the Horizon View configuration. In the next step of the process, we will turn our attention to the View Administrator and configure the application pools.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring published apps in the View Administrator</h1>
                </header>
            
            <article>
                
<p>The next stage in the installation and configuration process is performed using the View Administrator console and, like a standard View setup, involves creating pools and entitlements. However, rather than creating pools for virtual desktop machines, this time we are going to configure application pools.</p>
<p>Before we do any of that, the first thing we need to do is to set up a farm that contains the newly built RDSH server. To do this, perform the following steps:</p>
<ol>
<li><span>Open a browser and connect to the View Administrator. In our example lab, the address for the View Administrator is</span> <kbd>https://hzn7-cs1.pvolab.com/admin/</kbd><span>.</span></li>
<li>Log in to the View Administrator using the administrator account and password.</li>
<li>You will now see the View Administrator <span class="packt_screen">Dashboard</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/97990f92-7505-4ab4-a3eb-1e67260d84e1.png"/></div>
<ol start="4">
<li>Expand the arrow for <span class="packt_screen">Resources</span> <span>from the</span> <span class="packt_screen">Inventory</span> <span>pane on the left, and then click on</span> <span class="packt_screen">Farms</span> <span>(<strong>1</strong>).</span></li>
<li>Now click the <span class="packt_screen">Add…</span> button (<strong>2</strong>).</li>
<li>You will now see the <span class="packt_screen">Add Farm</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/566a9947-54cb-4c74-8876-821b852c2df2.png"/></div>
<ol start="7">
<li>In the <span class="packt_screen">Type</span> <span>section, click the radio button for</span> <span class="packt_screen">Manual Farm</span><span>.</span></li>
<li>Click the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="9">
<li>You will now see the <span class="packt_screen">Identification and Settings</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/90bc8618-e13c-4bf6-8f44-8f02f4dc55dd.png"/></div>
<p style="padding-left: 60px">You need to fill the details, as shown here:</p>
<ol>
<li style="padding-left: 30px">In the <span class="packt_screen">ID</span> <span>box, enter an ID for the farm that will be used by View to identify it. In the example lab, this is called</span> <kbd>Horizon-Published-Apps</kbd><span>.</span></li>
</ol>
<div class="packt_infobox">You cannot use spaces for the ID, only letters (upper and lowercase), numbers (0-9), and <em>–</em> (minus) or <em>_</em> (underscore) characters.</div>
<ol start="2">
<li class="mce-root" style="padding-left: 30px">In the <span class="packt_screen">Description</span> box, enter an optional description for the farm and then, from the <span class="packt_screen">Access Group</span> dropdown, select an access group if you have one.</li>
<li class="mce-root" style="padding-left: 30px">Next, under <span class="packt_screen">Farm Settings</span>, set the <span class="packt_screen">Default display protocol</span> to <span class="packt_screen">PCoIP</span> and from the <span class="packt_screen">Allow users to choose protocol</span> dropdown, select <span class="packt_screen">Yes</span>.</li>
<li class="mce-root" style="padding-left: 30px">In the <span class="packt_screen">Pre-launch session timeout</span>, leave this as the default setting of <kbd>10</kbd> minutes. Pre-launch allows apps to load ahead of a user clicking to launch it. This option configures a timeout.</li>
<li class="mce-root" style="padding-left: 30px">In the <span class="packt_screen">Empty session timeout<strong>,</strong></span> enter a time after which the session should timeout when not being used, and then in the <span class="packt_screen">When timeout occurs</span> <span>box, from the</span> drop-down <span>menu, select what happens at</span> timeout<span>. In the example</span> lab<span>, this is set to disconnect the user from the session.</span></li>
<li class="mce-root" style="padding-left: 30px">The next option is whether or not to <span class="packt_screen">Log off disconnected sessions</span>. This option will log off any disconnected sessions. In the example lab<span>, this is set to</span> <span class="packt_screen">Never</span> happen.</li>
<li class="mce-root" style="padding-left: 30px">Check the <span class="packt_screen">Enabled</span> box to allow <span class="packt_screen">HTML access to desktops and applications on this farm</span>.</li>
<li class="mce-root" style="padding-left: 30px">Finally, check the box for <span class="packt_screen">Allow Session Collaboration</span>. This only works when you connect using the Blast protocol.</li>
<li class="mce-root" style="padding-left: 30px">Once you have completed the configuration options on this screen, click the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="10">
<li class="mce-root" style="padding-left: 30px">You will now see the <span class="packt_screen">Select RDS Hosts</span> configuration screen from where you select which hosts are going to participate in this farm, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b95a97d1-2965-46d3-a5c4-b05c2ef1ccaa.png"/></div>
<ol start="10">
<li>Click and select the <kbd>rdsh-apps.pvolab.com</kbd> server entry and then click the <span class="packt_screen">Next &gt;</span> button.</li>
<li>You will now see the <span class="packt_screen">Ready to Complete</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cc26a567-b643-4687-9083-86f5d8de8ec6.png" style=""/></div>
<ol start="12">
<li>Check that the settings you have entered are correct, and then click the <span class="packt_screen">Finish</span> button.</li>
</ol>
<p>You have now successfully created a new farm configuration for the hosted applications, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1637d1eb-25de-434e-8d4c-d8f2ddf324a7.png" style=""/></div>
<p>You will also see in the <span class="packt_screen">RDS Farms</span> section in the <span class="packt_screen">System Health</span> box on the View Administrator Dashboard that the farm name, <span class="packt_screen">Horizon-Published-Apps</span>, and the server name, <kbd>rdsh-apps.pvolab.com</kbd>, are now listed, along with a green box to show they are working correctly:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c2bcdbc6-6472-4af5-9358-7a4a67856838.png"/></div>
<p>In the next section, we are going to create an application pool.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an application pool for published apps</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to create an application pool. This allows you to create a pool that contains a number of different applications. You may want to create application pools to reflect different departments, for example. To configure an application pool, perform the following steps:</p>
<ol>
<li>From the View Administrator, expand the arrow for <span class="packt_screen">Catalog</span> from the <span class="packt_screen">Inventory</span> pane on the left, and then click on <span class="packt_screen">Application Pools</span> (1), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0c51aded-0df0-4f62-9f40-69abc33fb21e.png"/></div>
<ol start="2">
<li>Now click on the <span class="packt_screen">Add...</span> button (<strong>2</strong>).</li>
</ol>
<ol start="3">
<li>You will now see the <span class="packt_screen">Add Application Pools</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/500e9c42-77c7-4ca9-b5fb-81afda90c4ee.png"/></div>
<ol start="4">
<li>From the <span class="packt_screen">Select an RDS farm</span> drop-down menu, select the farm that we created previously for our published applications. In the example lab, select the farm called <span class="packt_screen">Horizon-Published-Apps</span> from the menu.</li>
<li>Next, click the radio button for <span class="packt_screen">Select installed applications</span>. This will automatically list all the applications that are installed on that particular RDSH server. There is also the option to add an application pool manually.</li>
</ol>
<ol start="6">
<li>From the list of applications, check the box for the applications you want to add to the application pool. In the example, we have selected <span class="packt_screen">PowerPoint 2016</span> (<strong>3</strong>) and <span class="packt_screen">Word 2016</span> (<strong>4</strong>), as well as Calculator, Paint, Excel 2016, Publisher 2016, and Outlook 2016.</li>
<li>You then have the option to check the <span class="packt_screen">Pre-Launch</span> box. That means the applications in the pool are launched and ready when the end users click on them to speed up launch times.</li>
<li>The next option is for <span class="packt_screen">Connection Server restrictions</span>, which allows you to configure tags for which Connection Servers you can connect with.</li>
<li>Finally, you can configure the <span class="packt_screen">Category Folder<strong>,</strong></span> which allows you to add a shortcut on the end user's device.</li>
<li>When you have selected all the required applications, click the <span class="packt_screen">Next &gt;</span> button to continue.</li>
<li>You will now see the <strong>Edit ID</strong> <strong>and Display Name</strong> screen. Here, you can choose to edit the ID and the display name for the applications if you want to. This is shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/16a808b7-df2d-4b0a-9aae-929f8f513809.png"/></div>
<ol start="12">
<li>Also, check the <span class="packt_screen">Entitle users after this wizard finishes</span> box to automatically launch the user entitlement configuration, which we will complete in the next section.</li>
<li>Click the <span class="packt_screen">Finish</span> button to complete the configuration. You will then see that the application pool has been created.</li>
</ol>
<p>Now that you have your application pool all set up and ready to go, the next step is to entitle end users to the pool and allow them to launch applications.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Entitling users to application pools</h1>
                </header>
            
            <article>
                
<p>In the previous section, we checked the <span class="packt_screen">Entitle users after this wizard finished</span> box, which means that you will now see the <span class="packt_screen">Add Entitlements</span> configuration screen, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/512fac43-3763-4875-be05-7f57d3e5de40.png" style=""/></div>
<p>Now perform the following steps to add entitlements:</p>
<ol>
<li>Click the <span class="packt_screen">Add...</span> button (<strong>1</strong>).</li>
<li>You will now see the <span class="packt_screen">Find User or Group</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4189b532-fe82-458e-b98d-c94b4ec32e98.png" style=""/></div>
<ol start="3">
<li>In the <span class="packt_screen">Type</span> section, ensure that the <span class="packt_screen">Users</span> box (<strong>2</strong>) is ticked.</li>
<li>From the <span class="packt_screen">Domain</span> drop-down menu (<strong>3</strong>), select the domain that contains the user you want to entitle. In the example lab, this is the <kbd>pvolab.com</kbd> domain.</li>
<li>In the <span class="packt_screen">Name/User name</span> box (<strong>4</strong>), enter the details of the user you want to entitle. In the example lab, we are going to entitle the user called <kbd>Peter von Oven</kbd><span>, so type the first part of the username, in this case,</span> <kbd>peter</kbd><span>, into the box and then click the</span> <span class="packt_screen">Find</span> <span>button (<strong>5</strong>) to search for the user in the domain.</span></li>
</ol>
<ol start="6">
<li>Once found, <span>the user and their details will be displayed in the table. Select the user by clicking on the entry in the table to highlight and select the user.</span></li>
<li>Click <span class="packt_screen">OK</span> to continue.</li>
<li>You will now return to the <span class="packt_screen">Application Pools</span> screen, detailing the applications published, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c603fc1d-20b2-44fe-94bb-b48680473e53.png"/></div>
<p>As a final check, we are going to launch the Horizon Client, log in as the entitled user, and then launch one of the published applications using the Horizon Client, to test that everything works.</p>
<div class="packt_infobox">Make sure you are using the latest version of the Horizon Client, version 3.0 and above. Older versions will still work with VDI desktops, but will not show the published applications.</div>
<p>To test the functionality, complete the following steps:</p>
<ol>
<li>Launch the VMware Horizon Client and make sure that you have added the address of the Connection Server. We will cover the Horizon View Client in <a href="e1944fcc-6ae9-4db7-b51b-db75e37e01ab.xhtml" target="_blank"/><a href="e1944fcc-6ae9-4db7-b51b-db75e37e01ab.xhtml" target="_blank">Chapter 12</a>, <em>Horizon Client Options</em>.</li>
</ol>
<ol start="2">
<li>In the example lab, we are connecting to the <kbd>hzn7-cs1.pvolab.com</kbd> Connection Server, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cf978123-f482-4c61-960b-ff936d6a261b.png" style=""/></div>
<ol start="3">
<li>Double-click on the <kbd>hzn7-cs1.pvolab.com</kbd> icon in the VMware Horizon Client.</li>
<li>You will then see the <span class="packt_screen">Login</span> box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4f7d3e19-685a-48b1-b17a-e8c4e1ae3d28.png" style=""/></div>
<ol start="5">
<li>In the <span class="packt_screen">User name</span> box, enter the username for the user that is entitled to the application pool. In the example lab, the <span class="packt_screen">User name</span> for the user <kbd>Peter von Oven</kbd> is <kbd>pvo</kbd>.</li>
<li>In the <span class="packt_screen">Password</span> <span>box,</span> enter <span>the</span> password <span>for the username.</span></li>
<li>In the <span class="packt_screen">Domain</span> box, ensure the correct domain is selected from the drop-down menu. In the example lab<span>, this is the</span> <span class="packt_screen">PVOLAB</span> <span>domain.</span></li>
<li>Now click the <span class="packt_screen">Login</span> box.</li>
<li>Once authenticated, the Horizon Client will connect to the application pool and display the available applications, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9dae20bd-c0c3-4082-ac39-9a1aa8970208.png" style=""/></div>
<ol start="5"/>
<ol start="10">
<li><span>Double-click on any of the applications to ensure that they launch correctly.</span></li>
</ol>
<p class="NormalPACKT"><span>You have now successfully installed, configured, and delivered a Vieww-hosted applications environment. In this example, we have deployed a single RDSH server to host remote applications; however, in a production environment, you are more likely to have multiple servers in a farm.</span></p>
<p class="NormalPACKT"><span>In the final section of this chapter, we are going to look how you load-balance the session connections across multiple host servers in a farm.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Load-balancing published apps in Horizon View</h1>
                </header>
            
            <article>
                
<p>The next thing we are going to cover is how the Connection Broker decides which of the RDS host servers in the farm that is running the requested application is actually going to deliver the application. There are two options for configuring load balancing.</p>
<p>For the first option, there is no real complicated science behind the load balancing from a Horizon View perspective. It is purely based on how many sessions are available on any given RDSH server. So, that means when a user logs in and launches a published application, the application is delivered from the server that has the highest amount of free sessions available; that is, the one that is least busy.</p>
<p>This is illustrated in the following diagram:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ffdb0bb7-cd55-4f94-a8ef-4312da738a43.png" style=""/></div>
<p>This first option works fine, but how does it know what each session is consuming in terms of resources? A particular host may well have enough capacity for additional sessions based on the number of sessions it has free, but what if the sessions it's already hosting are consuming vast amounts of resources?</p>
<p>This is where the second option comes in, as it uses more in-depth information to place sessions, which is based on measuring the CPU and memory utilization of each host rather than the number of free sessions.</p>
<p>To enable this load-balancing method, there are a number of manual steps you need to complete, as we will now describe.</p>
<p>First of all, this method is based on executing scripts, and therefore you need to ensure that those scripts are stored on each RDS host server in the farm. You can create your own scripts; however, there are a couple of example scripts that ship as part of the View Agent installation. You will find them in the following folder once the View Agent has been installed (View Agent installation was covered earlier on in this chapter):</p>
<pre><strong>C:\Program Files\VMware\VMware View\Agent\scripts</strong></pre>
<p>You will then see the two example scripts, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/abe0902a-af70-4217-a860-9d3c8381b709.png"/></div>
<p>As the names suggest, one script monitors CPU utilization and the other monitors memory utilization. Each script monitors its respective component and returns the following values to make the decision on placing sessions:</p>
<ul>
<li><kbd>0</kbd>: For utilization &gt; 90%</li>
<li><kbd>1</kbd>: For utilization &gt; 75%</li>
<li><kbd>2</kbd>: For utilization &gt; 25%</li>
<li><kbd>3</kbd>: For utilization &gt; 25%</li>
</ul>
<p>Let's now configure the CPU script for use in the example lab by completing the following tasks. The first of these is to enable the View Script Host service. To do this, perform the following the steps:</p>
<ol>
<li>Open a console to the RDSH host server, RDSH-Apps, and from the desktop of the server, launch a <kbd>RUN</kbd> command.</li>
<li>In the <strong><span class="packt_screen"><span class="underline">O</span>pen</span></strong> box, type <kbd>services.msc</kbd> <span>and click</span> <span class="packt_screen">OK</span> <span>to launch the <span class="packt_screen">Services</span> management screen. You will now see the <strong>Services</strong> screen, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e92f5526-dbff-45ff-ae8b-745fd14a869e.png"/></div>
<ol start="3">
<li>Scroll down until you find the entry for <strong>VMware Horizon View Script Host</strong>. Click on it to highlight it, and then right-click.</li>
<li>From the contextual menu that is now displayed, click <span class="packt_screen">Properties</span>.</li>
</ol>
<ol start="5">
<li>You will now see the <span class="packt_screen">VMware Horizon View Script Host Properties</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/56e0e0b9-cfdd-4003-9902-bb70fc245b38.png" style=""/></div>
<ol start="6">
<li>In the <span class="packt_screen">Startup type</span> box, from the drop-down menu (<strong>1</strong>), select the option for <span class="packt_screen">Automatic<strong>,</strong></span> so that this service starts when the server boots.</li>
<li class="NormalPACKT"><span>Next, click the</span> <span class="packt_screen">Apply</span> <span>button.</span></li>
<li class="NormalPACKT">Finally, click the <span class="packt_screen">Start</span> button (<strong>2</strong>) to start the service. You should now see that the service is running, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9a08cfc3-f853-4ba1-8359-210a24698e0d.png"/></div>
<p class="NormalPACKT"><span>Once completed, close the</span> <span class="packt_screen">Services</span> <span>management screen. The next step is to add the script details to the registry of the server. To do this, perform the following steps:</span></p>
<ol>
<li>Open a console to the RDSH host server, RDSH-Apps, and from the desktop of the server, launch a <kbd>RUN</kbd> command.</li>
<li>In the <span class="packt_screen"><strong><span class="underline">O</span>pen</strong></span>box, type <kbd>regedit</kbd> <span>and click</span> <strong><span class="packt_screen">OK</span></strong> <span>to launch the registry editor.</span></li>
<li>Once the registry editor has launched, navigate to the following path:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/07afa9ad-c699-478e-a1e0-1fac33271071.png" style=""/></div>
<ol start="4">
<li>You will now see the following screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cb0247dc-45d8-4620-8736-7a7bea64cb3f.png"/></div>
<p class="mce-root"/>
<ol start="5">
<li><span>Now right-click in the right-hand side pane and, from the contextual menu displayed, click on</span> <span class="packt_screen">New</span> <span>(<strong>3</strong>), and then select the option for</span> <span class="packt_screen">String Value</span> <span>(<strong>4</strong>), as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a0a43b3c-81cb-42c7-b34c-5b386af1e695.png" style=""/></div>
<ol start="6">
<li><span>You will now be able to enter a new string value. In the example lab, this is called</span> <kbd>cpuutilisation</kbd> <span>(<strong>5</strong>) to reflect the script that will be run, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/fe8ff537-ab1a-429d-90d3-11611243ecc9.png" style=""/></div>
<ol start="7">
<li><span>Next, you need to edit the newly created string value and enter a value.</span></li>
</ol>
<ol start="8">
<li>To do this, highlight the <kbd>cpuutilisation</kbd> <span>entry (<strong>6</strong>),</span> right-click <span>and from the contextual menu, and click the option for</span> <span class="packt_screen">Modify…</span> <span><span>(<strong>7</strong>), as shown in the following screenshot:</span></span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/757b3e53-44f1-46dd-bfb4-3b42effce953.png" style=""/></div>
<ol start="9">
<li>You will now see the <span class="packt_screen">Edit String</span> box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5d05d093-7daf-4162-b1fc-306206fe1d09.png" style=""/></div>
<ol start="10">
<li>In the <span class="packt_screen">Value data<strong>,</strong></span> box enter the path to the script. In the example lab, this path is <kbd>C:\Program Files\VMware\VMware View\Agent\scripts\cpuutilisation.vbs</kbd><strong>.</strong></li>
<li>Click <span class="packt_screen">OK</span>.</li>
<li>You will now see that the script has been added, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f405cf04-bc36-429c-96b7-c0e6ecaac761.png" style=""/></div>
<ol start="13">
<li>Exit the registry editor.</li>
</ol>
<p class="mce-root"/>
<p class="mce-root"/>
<p>As you have changed the properties of the VMware Horizon Agent, you will need to restart this service for the changes to be applied. To do this, perform the following steps:</p>
<ol>
<li>Launch a <kbd>RUN</kbd> command.</li>
<li>In the <span class="packt_screen"><strong><span class="underline">O</span>pen</strong></span> box, type <kbd>service.msc</kbd> and click <span class="packt_screen">OK</span> to launch the <span class="packt_screen">Services</span> management screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/34e9a4fc-3fed-4a4d-b0da-335adb6d816f.png"/></div>
<ol start="3">
<li>Scroll down until you find the entry for <span class="packt_screen">VMware Horizon View Agent</span> (<strong>8</strong>).</li>
<li>Click on it to select it, right-click, and, from the contextual menu, select the <span class="packt_screen">Restart</span> option (<strong>9</strong>) to restart the service.</li>
<li>Once the service has restarted, you can close the <span class="packt_screen">Services</span> <span>management screen.</span></li>
</ol>
<p class="NormalPACKT"><span>You have now completed the configuration steps for load balancing and this will now be calculated based on CPU utilization. You can check that this is working by performing the following:</span></p>
<ol>
<li class="NormalPACKT"><span>From the <span class="ScreenTextPACKT">View Administrator Dashboard</span>, navigate to the</span> <span class="packt_screen">System Health</span> <span>box.</span></li>
<li class="NormalPACKT"><span>Then expand the options for</span> <span class="packt_screen">RDS Farms</span> <span>and the farm for</span> <span class="packt_screen">Horizon-Published-Apps</span><span>. Now click on the</span> <kbd>RDSH-Apps.pvolab.com</kbd> <span><span>server. You will see the following screen:</span></span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/014122b4-460b-4997-90c6-59a80b516b04.png" style=""/></div>
<p class="NormalPACKT"><span>You will see that at the bottom of the box, there is a</span> <span class="packt_screen">Server load</span> <span>option now shown. This is being measured from the script, and as you can see, currently, the CPU load is light and new sessions are able to be resourced by this particular server.</span></p>
<p class="NormalPACKT"><span>Click</span> <span class="packt_screen">OK</span> <span>to close the box. You have now successfully configured the optional load-balancing feature.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we have discussed how to deliver remote/published applications with the Horizon published applications feature. We started off by looking at the architecture and took a deep dive into how it works, before walking through the installation and configuration process of both the Microsoft RDSH components and the Horizon View components needed to make it work.</p>
<p>We then configured an RDS farm and an application pool, and then entitled a test user to the pool. Finally, to check that everything was working, we logged in as the user and tested the environment by launching a remote application.</p>
<p>In the final section, we looked at how to configure load balancing in a View published application environment.</p>
<p>In the next chapter, we are going to look at how we apply the same methodology to deliver session-based or published desktops.</p>


            </article>

            
        </section>
    </body></html>