["```\nroot@kvm:~# virsh list\n Id  Name State\n----------------------------------------------------\n 16  kvm  running\n\nroot@kvm:~# pgrep -lfa qemu\n19913 /usr/bin/qemu-system-x86_64 -name kvm -S -machine pc-i440fx-trusty,accel=kvm,usb=off -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid 283c6653-9981-9396-efb4-fb864d87f769 -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-kvm/monitor.sock,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -boot strict=on -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -drive file=/tmp/debian.img,format=raw,if=none,id=drive-ide0-0-0 -device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=1 -netdev tap,fd=26,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:2f:df:93,bus=pci.0,addr=0x3 -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -vnc 0.0.0.0:0 -device cirrus-vga,id=video0,bus=pci.0,addr=0x2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x4 -msg timestamp=on\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# ps -eLf\nUID PID PPID LWP C NLWP STIME TTY TIME CMD\n...\nlibvirt+ 19913 1 19913 0 3 14:02 ? 00:00:00 /usr/bin/qemu-system-x86_64 -name kvm -S -machine pc-i440fx-trusty,accel=kvm,usb=off -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid 283c6653-9981-9396-efb4-fb864d87f769 -no-user-config -nodefaul\nlibvirt+ 19913 1 19914 0 3 14:02 ? 00:00:08 /usr/bin/qemu-system-x86_64 -name kvm -S -machine pc-i440fx-trusty,accel=kvm,usb=off -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid 283c6653-9981-9396-efb4-fb864d87f769 -no-user-config -nodefaul\nlibvirt+ 19913 1 19917 0 3 14:02 ? 00:00:00 /usr/bin/qemu-system-x86_64 -name kvm -S -machine pc-i440fx-trusty,accel=kvm,usb=off -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid 283c6653-9981-9396-efb4-fb864d87f769 -no-user-config -nodefaul\n...\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# cat /sys/block/sda/queue/scheduler\nnoop deadline [cfq]\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# echo deadline > /sys/block/sda/queue/scheduler\nroot@kvm:~# cat /sys/block/sda/queue/scheduler\nnoop [deadline] cfq\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# echo 'GRUB_CMDLINE_LINUX=\"elevator=deadline\"' >> /etc/default/grub\nroot@kvm:~# tail -1 /etc/default/grub\nGRUB_CMDLINE_LINUX=\"elevator=deadline\"\nroot@kvm:~# update-grub2\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-3.13.0-107-generic\nFound initrd image: /boot/initrd.img-3.13.0-107-generic\ndone\nroot@kvm:~# cat /boot/grub/grub.cfg | grep elevator\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro elevator=deadline rd.fstab=no acpi=noirq noapic cgroup_enable=memory swapaccount=1 quiet\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro elevator=deadline rd.fstab=no acpi=noirq noapic cgroup_enable=memory swapaccount=1 quiet\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro recovery nomodeset elevator=deadline\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh console kvm1\nConnected to domain kvm1\nEscape character is ^]\nroot@kvm1:~# echo 'GRUB_CMDLINE_LINUX=\"elevator=noop\"' >> /etc/default/grub\nroot@kvm1:~# tail -1 /etc/default/grub\nGRUB_CMDLINE_LINUX=\"elevator=noop\"\nroot@kvm1:~# update-grub2\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-3.13.0-107-generic\nFound initrd image: /boot/initrd.img-3.13.0-107-generic\ndone\nroot@kvm1:~# cat /boot/grub/grub.cfg | grep elevator\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro elevator=noop rd.fstab=no acpi=noirq noapic cgroup_enable=memory swapaccount=1 quiet\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro elevator=noop rd.fstab=no acpi=noirq noapic cgroup_enable=memory swapaccount=1 quiet\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro recovery nomodeset elevator=noop\nroot@kvm1:~#\n\n```", "```\nroot@kvm:~# virsh blkiotune --weight 100 kvm\n\nroot@kvm:~# virsh blkiotune kvm\nweight : 100\ndevice_weight :\ndevice_read_iops_sec:\ndevice_write_iops_sec:\ndevice_read_bytes_sec:\ndevice_write_bytes_sec:\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# mount | grep cgroup\nnone on /sys/fs/cgroup type tmpfs (rw)\nsystemd on /sys/fs/cgroup/systemd type cgroup (rw,noexec,nosuid,nodev,none,name=systemd)\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# cat /sys/fs/cgroup/blkio/machine/kvm.libvirt-qemu/blkio.weight\n100\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# cat /proc/meminfo | grep -i huge\nAnonHugePages: 509952 kB\nHugePages_Total: 0\nHugePages_Free: 0\nHugePages_Rsvd: 0\nHugePages_Surp: 0\nHugepagesize: 2048 kB\nroot@kvm:~#\n\n```", "```\nroot@kvm1:~# cat /proc/meminfo | grep -i huge\nHugePages_Total: 0\nHugePages_Free: 0\nHugePages_Rsvd: 0\nHugePages_Surp: 0\nHugepagesize: 2048 kB\nroot@kvm1:~#\n\n```", "```\nroot@kvm:~# sysctl vm.nr_hugepages=25000\nvm.nr_hugepages = 25000\nroot@kvm:~# cat /proc/meminfo | grep -i huge\nAnonHugePages: 446464 kB\nHugePages_Total: 25000\nHugePages_Free: 24484\nHugePages_Rsvd: 0\nHugePages_Surp: 0\nHugepagesize: 2048 kB\nroot@kvm:~# cat /proc/sys/vm/nr_hugepages\n25000\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# cat /proc/cpuinfo | egrep -i \"pse|pdpe1\" | tail -1\nflags : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb xsaveopt pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# cat /etc/default/grub\n...\nGRUB_CMDLINE_LINUX_DEFAULT=\"rd.fstab=no acpi=noirq noapic cgroup_enable=memory swapaccount=1 quiet hugepagesz=1GB hugepages=1\"\n...\nroot@kvm:~# update-grub\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-3.13.0-107-generic\nFound initrd image: /boot/initrd.img-3.13.0-107-generic\ndone\nroot@kvm:~# cat /boot/grub/grub.cfg | grep -i huge\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro elevator=deadline rd.fstab=no acpi=noirq noapic cgroup_enable=memory swapaccount=1 quiet hugepagesz=1GB hugepages=1\n linux /boot/vmlinuz-3.13.0-107-generic root=/dev/md126p1 ro elevator=deadline rd.fstab=no acpi=noirq noapic cgroup_enable=memory swapaccount=1 quiet hugepagesz=1GB hugepages=1\nroot@kvm:~# reboot\n\n```", "```\nroot@kvm:~# apt-get install hugepages\n\n```", "```\nroot@kvm:~# hugeadm --pool-list\n Size      Minimum Current Maximum Default\n 2097152   25000   25000   25000   *\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sed -i 's/KVM_HUGEPAGES=0/KVM_HUGEPAGES=1/g' /etc/default/qemu-kvm\nroot@kvm:~# root@kvm:~# /etc/init.d/libvirt-bin restart\nlibvirt-bin stop/waiting\nlibvirt-bin start/running, process 16257\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# mkdir /hugepages\nroot@kvm:~# echo \"hugetlbfs /hugepages hugetlbfs mode=1770,gid=2021 0 0\" >> /etc/fstab\nroot@kvm:~# mount -a\nroot@kvm:~# mount | grep hugepages\nhugetlbfs on /hugepages type hugetlbfs (rw,mode=1770,gid=2021)\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh destroy kvm1\nDomain kvm1 destroyed\n\nroot@kvm:~# virsh edit kvm1\n...\n <memoryBacking>\n <hugepages/>\n </memoryBacking>\n...\nDomain kvm1 XML configuration edited.\n\nroot@kvm:~# virsh start kvm1\nDomain kvm1 started\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh memtune kvm1\nhard_limit : unlimited\nsoft_limit : unlimited\nswap_hard_limit: unlimited\n\nroot@kvm:~# virsh memtune kvm1 --hard-limit 2GB\n\nroot@kvm:~# virsh memtune kvm1\nhard_limit : 1953125\nsoft_limit : unlimited\nswap_hard_limit: unlimited\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh nodeinfo\nCPU model: x86_64\nCPU(s): 40\nCPU frequency: 2593 MHz\nCPU socket(s): 1\nCore(s) per socket: 10\nThread(s) per core: 2\nNUMA cell(s): 2\nMemory size: 131918328 KiB\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh vcpuinfo kvm1\nVCPU: 0\nCPU: 2\nState: running\nCPU time: 9.1s\nCPU Affinity: yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh vcpupin kvm1 0 0 --live\n\nroot@kvm:~# virsh vcpuinfo kvm1\nVCPU: 0\nCPU: 0\nState: running\nCPU time: 9.3s\nCPU Affinity: y---------------------------------------\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh schedinfo kvm1\nScheduler : posix\ncpu_shares : 1024\nvcpu_period : 100000\nvcpu_quota : -1\nemulator_period: 100000\nemulator_quota : -1\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh schedinfo kvm cpu_shares=512\nScheduler : posix\ncpu_shares : 512\nvcpu_period : 100000\nvcpu_quota : -1\nemulator_period: 100000\nemulator_quota : -1\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# cat /sys/fs/cgroup/cpu/machine/kvm1.libvirt-qemu/cpu.shares\n512\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh dumpxml kvm1\n...\n <vcpu placement='static'>1</vcpu>\n <cputune>\n <shares>512</shares>\n <vcpupin vcpu='0' cpuset='0'/>\n </cputune>\n ...\n root@kvm:~#\n\n```", "```\nroot@kvm:~# ldd /usr/sbin/libvirtd | grep numa\n libnuma.so.1 => /usr/lib/x86_64-linux-gnu/libnuma.so.1 (0x00007fd12d49e000)\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# apt-get install numactl\n...\nroot@kvm:~# numactl --hardware\navailable: 2 nodes (0-1)\nnode 0 cpus: 0 1 2 3 4 5 6 7 8 9 20 21 22 23 24 25 26 27 28 29\nnode 0 size: 64317 MB\nnode 0 free: 3173 MB\nnode 1 cpus: 10 11 12 13 14 15 16 17 18 19 30 31 32 33 34 35 36 37 38 39\nnode 1 size: 64509 MB\nnode 1 free: 31401 MB\nnode distances:\nnode 0 1\n 0: 10 21\n 1: 21 10\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# numastat -c kvm1\n\nPer-node process memory usage (in MBs) for PID 22395 (qemu-system-x86)\n            Node 0    Node 1    Total\n            ------    ------    -----\nHuge             0         0        0\nHeap             1         1        2\nStack            2         2        4\nPrivate         39        21       59\n-------     ------    ------    -----\nTotal           42        23       65\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh edit kvm1\n...\n<vcpu placement='static' cpuset='10-11'>2</vcpu>\n<numatune>\n <memory mode='strict' nodeset='1'/>\n</numatune>\n...\nDomain kvm1 XML configuration edited.\n\nroot@kvm:~# virsh destroy kvm1\nDomain kvm1 destroyed\n\nroot@kvm:~# virsh start kvm1\nDomain kvm1 started\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh numatune kvm1\nnuma_mode : strict\nnuma_nodeset : 1\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh vcpuinfo kvm1\nVCPU: 0\nCPU: 11\nState: running\nCPU time: 8.4s\nCPU Affinity: ----------yy----------------------------\n\nVCPU: 1\nCPU: 10\nState: running\nCPU time: 0.3s\nCPU Affinity: ----------yy----------------------------\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# numastat -c kvm1\n\nPer-node process memory usage (in MBs) for PID 22395 (qemu-system-x86)\n            Node 0    Node 1    Total\n            ------    ------    -----\nHuge             0         0        0\nHeap             0         3        3\nStack            0         2        2\nPrivate          0       174      174\n-------     ------    ------    -----\nTotal            0       179      179\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription: Ubuntu 16.04.2 LTS\nRelease: 16.04\nCodename: xenial\nroot@kvm2:~# apt install numad\n...\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# service numad start\nroot@kvm2:~# pgrep -lfa numad\n12601 /usr/bin/numad -i 15\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# numad -S 0 -p $(pidof qemu-system-x86_64)\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# tail /var/log/numad.log\nThu May 25 21:06:42 2017: Changing THP scan time in /sys/kernel/mm/transparent_hugepage/khugepaged/scan_sleep_millisecs from 10000 to 1000 ms.\nThu May 25 21:06:42 2017: Registering numad version 20150602 PID 12601\nThu May 25 21:09:25 2017: Adding PID 4601 to inclusion PID list\nThu May 25 21:09:25 2017: Scanning only explicit PID list processes\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.core.rmem_max\nnet.core.rmem_max = 212992\nroot@kvm:~# sysctl net.core.wmem_max\nnet.core.wmem_max = 212992\nroot@kvm:~# sysctl net.core.rmem_max=33554432 net.core.rmem_max = 33554432 root@kvm:~# sysctl net.core.wmem_max=33554432 net.core.wmem_max = 33554432 root@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_rmem\nnet.ipv4.tcp_rmem = 4096 87380 6291456\nroot@kvm:~# sysctl net.ipv4.tcp_wmem\nnet.ipv4.tcp_wmem = 4096 16384 4194304\nroot@kvm:~# sysctl net.ipv4.tcp_rmem=\"4096 87380 33554432\"\nnet.ipv4.tcp_rmem = 4096 87380 33554432\nroot@kvm:~# sysctl net.ipv4.tcp_wmem=\"4096 65536 33554432\"\nnet.ipv4.tcp_wmem = 4096 65536 33554432\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_window_scaling\nnet.ipv4.tcp_window_scaling = 1\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# ifconfig eth0 txqueuelen 5000\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_fin_timeout\nnet.ipv4.tcp_fin_timeout = 60\nroot@kvm:~# sysctl net.ipv4.tcp_fin_timeout=30\nnet.ipv4.tcp_fin_timeout = 30\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_keepalive_intvl\nnet.ipv4.tcp_keepalive_intvl = 75\nroot@kvm:~# sysctl net.ipv4.tcp_keepalive_intvl=30\nnet.ipv4.tcp_keepalive_intvl = 30\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_tw_recycle\nnet.ipv4.tcp_tw_recycle = 0\nroot@kvm:~# sysctl net.ipv4.tcp_tw_recycle=1\nnet.ipv4.tcp_tw_recycle = 1\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_tw_reuse\nnet.ipv4.tcp_tw_reuse = 0\nroot@kvm:~# sysctl net.ipv4.tcp_tw_reuse=1\nnet.ipv4.tcp_tw_reuse = 1\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_available_congestion_control\nnet.ipv4.tcp_available_congestion_control = cubic reno\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# modprobe tcp_htcp\nroot@kvm:~# modprobe tcp_bic\nroot@kvm:~# modprobe tcp_vegas\nroot@kvm:~# modprobe tcp_westwood\nroot@kvm:~# sysctl net.ipv4.tcp_available_congestion_control\nnet.ipv4.tcp_available_congestion_control = cubic reno htcp bic vegas westwood\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_congestion_control\nnet.ipv4.tcp_congestion_control = cubic\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.ipv4.tcp_max_syn_backlog\nnet.ipv4.tcp_max_syn_backlog = 2048\nroot@kvm:~# sysctl net.ipv4.tcp_max_syn_backlog=16384\nnet.ipv4.tcp_max_syn_backlog = 16384\nroot@kvm:~# sysctl net.ipv4.tcp_synack_retries\nnet.ipv4.tcp_synack_retries = 5\nroot@kvm:~# sysctl net.ipv4.tcp_synack_retries=1\nnet.ipv4.tcp_synack_retries = 1\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl fs.file-nr\nfs.file-nr = 1280 0 13110746\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl fs.file-max=10000000\nfs.file-max = 10000000\nroot@kvm:~# sysctl fs.file-nr\nfs.file-nr = 1280 0 10000000\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# sysctl net.netfilter.nf_conntrack_count\nnet.netfilter.nf_conntrack_count = 23\nroot@kvm:~# sysctl net.netfilter.nf_conntrack_max\nnet.netfilter.nf_conntrack_max = 65536\nroot@kvm:~# sysctl -w net.netfilter.nf_conntrack_max=1000000\nnet.netfilter.nf_conntrack_max = 1000000\nroot@kvm:~# echo 250000 > /sys/module/nf_conntrack/parameters/hashsize # hashsize = nf_conntrack_max / 4\nroot@kvm:~#\n\n```"]