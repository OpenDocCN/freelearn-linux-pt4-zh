- en: Chapter 1. The Build System
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Setting up the host system
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing Poky
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a build directory
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building your first image
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Explaining the Freescale Yocto ecosystem
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing support for Freescale hardware
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building Wandboard images
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting your Wandboard's first boot
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring network booting for a development setup
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sharing downloads
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sharing the shared state cache
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up a package feed
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using build history
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with build statistics
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Debugging the build system
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Yocto project ([http://www.yoctoproject.org/](http://www.yoctoproject.org/))
    is an embedded Linux distribution builder that makes use of several other open
    source projects.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: 'The Yocto project provides a reference build system for embedded Linux, called
    **Poky**, which has the **BitBake** and **OpenEmbedded-Core** (**OE-Core**) projects
    at its base. The purpose of Poky is to build the components needed for an embedded
    Linux product, namely:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: A bootloader image
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A Linux kernel image
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A root filesystem image
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Toolchains and **software development kits** (**SDKs**) for application development
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With these, the Yocto project covers the needs of both system and application
    developers. When the Yocto project is used as an integration environment for bootloaders,
    the Linux kernel, and user space applications, we refer to it as system development.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: For application development, the Yocto project builds SDKs that enable the development
    of applications independently of the Yocto build system.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: The Yocto project makes a new release every six months. The latest release at
    the time of this writing is Yocto 1.7.1 Dizzy, and all the examples in this book
    refer to the 1.7.1 release.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: 'A Yocto release comprises the following components:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: Poky, the reference build system
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A build appliance; that is, a VMware image of a host system ready to use Yocto
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An **Application Development Toolkit** (**ADT**) installer for your host system
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'And for the different supported platforms:'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Prebuilt toolchains
  id: totrans-32
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Prebuilt packaged binaries
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Prebuilt images
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The Yocto 1.7.1 release is available to download from [http://downloads.yoctoproject.org/releases/yocto/yocto-1.7.1/](http://downloads.yoctoproject.org/releases/yocto/yocto-1.7.1/).
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Setting up the host system
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This recipe will explain how to set up a host Linux system to use the Yocto
    project.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The recommended way to develop an embedded Linux system is using a native Linux
    workstation. Development work using virtual machines is discouraged, although
    they may be used for demo and test purposes.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Yocto builds all the components mentioned before from scratch, including the
    cross-compilation toolchain and the native tools it needs, so the Yocto build
    process is demanding in terms of processing power and both hard drive space and
    I/O.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: Although Yocto will work fine on machines with lower specifications, for professional
    developer's workstations, it is recommended to use **symmetric multiprocessing**
    (**SMP**) systems with 8 GB or more system memory and a high capacity, fast hard
    drive. Build servers can employ distributed compilation, but this is out of the
    scope of this book. Due to different bottlenecks in the build process, there does
    not seem to be much improvement above 8 CPUs or around 16 GB RAM.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: The first build will also download all the sources from the Internet, so a fast
    Internet connection is also recommended.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Yocto supports several distributions, and each Yocto release will document
    a list of the supported ones. Although the use of a supported Linux distribution
    is strongly advised, Yocto is able to run on any Linux system if it has the following
    dependencies:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: Git 1.7.8 or greater
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tar 1.24 or greater
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Python 2.7.3 or greater (but not Python 3)
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Yocto also provides a way to install the correct version of these tools by either
    downloading a *buildtools-tarball* or building one on a supported machine. This
    allows virtually any Linux distribution to be able to run Yocto, and also makes
    sure that it will be possible to replicate your Yocto build system in the future.
    This is important for embedded products with long-term availability requirements.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: This book will use the Ubuntu 14.04 **Long-Term Stable** (**LTS**) Linux distribution
    for all examples. Instructions to install on other Linux distributions can be
    found on the *Supported Linux Distributions* section of the *Yocto Project Development
    Manual*, but the examples will only be tested with Ubuntu 14.04 LTS.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: 'To make sure you have the required package dependencies installed for Yocto
    and to follow the examples in the book, run the following command from your shell:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Tip
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Downloading the example code**'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: You can download the example code files for all Packt books you have purchased
    from your account at [http://www.packtpub.com](http://www.packtpub.com). If you
    purchased this book elsewhere, you can visit [http://www.packtpub.com/support](http://www.packtpub.com/support)
    and register to have the files e-mailed directly to you.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: The example code in the book can be accessed through several GitHub repositories
    at [https://github.com/yoctocookbook](https://github.com/yoctocookbook). Follow
    the instructions on GitHub to obtain a copy of the source in your computer.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The preceding command will use `apt-get`, the **Advanced Packaging Tool** (**APT**),
    command-line tool. It is a frontend of the **dpkg** package manager that is included
    in the Ubuntu distribution. It will install all the required packages and their
    dependencies to support all the features of the Yocto project.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If build times are an important factor for you, there are certain steps you
    can take when preparing your disks to optimize them even further:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: Place the `build` directories on their own disk partition or a fast external
    drive.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将`build`目录放置在独立的磁盘分区或快速外部驱动器上。
- en: Use the ext4 filesystem but configure it not to use journalism on your Yocto-dedicated
    partitions. Be aware that power losses may corrupt your build data.
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用ext4文件系统，但配置其不在Yocto专用分区上使用日志记录。请注意，电源丧失可能会损坏你的构建数据。
- en: 'Mount the filesystem in such a way that read times are not written/recorded
    on file reads, disable write barriers, and delay committing filesystem changes
    with the following mount options:'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 挂载文件系统时，确保读取时不记录读写时间，禁用写入屏障，并使用以下挂载选项延迟提交文件系统更改：
- en: '[PRE1]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Do not build on network-mounted drives.
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要在网络挂载的驱动器上进行构建。
- en: These changes reduce the data integrity safeguards, but with the separation
    of the `build` directories to their own disk, failures would only affect temporary
    build data, which can be erased and regenerated.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这些更改减少了数据完整性保护，但由于`build`目录已分离到独立磁盘，失败只会影响临时构建数据，这些数据可以被删除并重新生成。
- en: See also
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: The complete Yocto project installation instructions for Ubuntu and other supported
    distributions can be found on the *Yocto Project Reference Manual* at [http://www.yoctoproject.org/docs/1.7.1/ref-manual/ref-manual.html](http://www.yoctoproject.org/docs/1.7.1/ref-manual/ref-manual.html)
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 完整的Yocto项目安装说明适用于Ubuntu和其他受支持的发行版，可以在*Yocto项目参考手册*中找到，网址是[http://www.yoctoproject.org/docs/1.7.1/ref-manual/ref-manual.html](http://www.yoctoproject.org/docs/1.7.1/ref-manual/ref-manual.html)
- en: Installing Poky
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装Poky
- en: This recipe will explain how to set up your host Linux system with Poky, the
    Yocto project reference system.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱将解释如何使用Poky设置你的Linux主机系统，Poky是Yocto项目的参考系统。
- en: Getting ready
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Poky uses the OpenEmbedded build system, and as such, uses the BitBake tool,
    a task scheduler written in Python which forked from Gentoo's Portage tool. You
    can think of BitBake as the make utility in Yocto. It will parse the configuration
    and recipe metadata, schedule a task list, and run through it.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: Poky使用OpenEmbedded构建系统，因此使用BitBake工具，BitBake是一个用Python编写的任务调度器，源自Gentoo的Portage工具。你可以将BitBake视为Yocto中的make工具。它将解析配置和食谱元数据，调度任务列表，并执行其中的任务。
- en: BitBake is also the command-line interface to Yocto.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: BitBake也是Yocto的命令行接口。
- en: Poky and BitBake are two of the open source projects used by Yocto. The Poky
    project is maintained by the Yocto community. You can download Poky from its Git
    repository at [http://git.yoctoproject.org/cgit/cgit.cgi/poky/](http://git.yoctoproject.org/cgit/cgit.cgi/poky/).
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: Poky和BitBake是Yocto使用的两个开源项目。Poky项目由Yocto社区维护。你可以从其Git仓库下载Poky，网址是[http://git.yoctoproject.org/cgit/cgit.cgi/poky/](http://git.yoctoproject.org/cgit/cgit.cgi/poky/)。
- en: Development discussions can be followed and contributed to by visiting the development
    mailing list at [https://lists.yoctoproject.org/listinfo/poky](https://lists.yoctoproject.org/listinfo/poky).
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过访问开发邮件列表[https://lists.yoctoproject.org/listinfo/poky](https://lists.yoctoproject.org/listinfo/poky)来跟踪和参与开发讨论。
- en: BitBake, on the other hand, is maintained by both the Yocto and OpenEmbedded
    communities, as the tool is used by both. BitBake can be downloaded from its Git
    repository at [http://git.openembedded.org/bitbake/](http://git.openembedded.org/bitbake/).
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，BitBake由Yocto和OpenEmbedded社区共同维护，因为这两个社区都使用该工具。你可以从其Git仓库下载BitBake，网址是[http://git.openembedded.org/bitbake/](http://git.openembedded.org/bitbake/)。
- en: Development discussions can be followed and contributed to by visiting the development
    mailing list at [http://lists.openembedded.org/mailman/listinfo/bitbake-devel](http://lists.openembedded.org/mailman/listinfo/bitbake-devel).
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过访问开发邮件列表[http://lists.openembedded.org/mailman/listinfo/bitbake-devel](http://lists.openembedded.org/mailman/listinfo/bitbake-devel)来跟踪和参与开发讨论。
- en: 'The Poky build system only supports virtualized QEMU machines for the following
    architectures:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: Poky构建系统仅支持以下架构的虚拟化QEMU机器：
- en: ARM (qemuarm)
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ARM (qemuarm)
- en: x86 (qemux86)
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: x86 (qemux86)
- en: x86-64 (qemux86-64)
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: x86-64 (qemux86-64)
- en: PowerPC (qemuppc)
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PowerPC (qemuppc)
- en: MIPS (qemumips, qemumips64)
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MIPS (qemumips, qemumips64)
- en: 'Apart from these, it also supports some reference hardware **Board Support
    Packages** (**BSPs**), representative of the architectures just listed. These
    are those BSPs:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这些，Poky还支持一些**板级支持包**（**BSPs**），这些BSP代表了刚刚列出的架构。以下是这些BSP：
- en: Texas Instruments Beaglebone (beaglebone)
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Texas Instruments Beaglebone (beaglebone)
- en: Freescale MPC8315E-RDB (mpc8315e-rdb)
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Freescale MPC8315E-RDB (mpc8315e-rdb)
- en: Intel x86 based PCs and devices (genericx86 and genericx86-64)
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于Intel x86的PC和设备（genericx86和genericx86-64）
- en: Ubiquiti Networks EdgeRouter Lite (edgerouter)
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubiquiti Networks EdgeRouter Lite (edgerouter)
- en: To develop on different hardware, you will need to complement Poky with hardware-specific
    Yocto layers. This will be covered later on.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Poky project incorporates a stable BitBake release, so to get started with
    Yocto, we only need to install Poky in our Linux host system.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that you can also install BitBake independently through your distribution's
    package management system. This is not recommended and can be a source of problems,
    as BitBake needs to be compatible with the metadata used in Yocto. If you have
    installed BitBake from your distribution, please remove it.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: 'The current Yocto release is 1.7.1, or Dizzy, so we will install that into
    our host system. We will use the `/opt/yocto` folder as the installation path:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: How it works...
  id: totrans-95
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The previous instructions will use Git (the source code management system command-line
    tool) to clone the Poky repository, which includes BitBake, into a new `poky`
    directory on our current path, and point it to the Dizzy stable branch.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Poky contains three metadata directories, `meta`, `meta-yocto`, and `meta-yocto-bsp`,
    as well as a template metadata layer, `meta-skeleton`, that can be used as a base
    for new layers. Poky''s three metadata directories are explained here:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: '`meta`: This directory contains the OpenEmbedded-Core metadata, which supports
    the ARM, x86, x86-64, PowerPC, MIPS, and MIPS64 architectures and the QEMU emulated
    hardware. You can download it from its Git repository at [http://git.openembedded.org/openembedded-core/](http://git.openembedded.org/openembedded-core/).'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Development discussions can be followed and contributed to by visiting the development
    mailing list at [http://lists.openembedded.org/mailman/listinfo/openembedded-core](http://lists.openembedded.org/mailman/listinfo/openembedded-core).
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '`meta-yocto`: This contains Poky''s distribution-specific metadata.'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`meta-yocto-bsp`: This contains metadata for the reference hardware boards.'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There is documentation about Git, the distributed version control system, at
    [http://git-scm.com/doc](http://git-scm.com/doc)
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a build directory
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before building your first Yocto image, we need to create a `build` directory
    for it.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: The build process, on a host system as outlined before, can take up to one hour
    and need around 20 GB of hard drive space for a console-only image. A graphical
    image, like `core-image-sato`, can take up to 4 hours for the build process and
    occupy around 50 GB of space.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The first thing we need to do is create a `build` directory for our project,
    where the build output will be generated. Sometimes, the `build` directory may
    be referred to as the project directory, but `build` directory is the appropriate
    Yocto term.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: There is no right way to structure the `build` directories when you have multiple
    projects, but a good practice is to have one `build` directory per architecture
    or machine type. They can all share a common `downloads` folders, and even a shared
    state cache (this will be covered later on), so keeping them separate won't affect
    the build performance, but it will allow you to develop on multiple projects simultaneously.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: To create a `build` directory, we use the `oe-init-build-env` script provided
    by Poky. The script needs to be sourced into your current shell, and it will set
    up your environment to use the OpenEmbedded/Yocto build system, including adding
    the BitBake utility to your path. You can specify a `build` directory to use or
    it will use `build` by default. We will use `qemuarm` for this example.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The script will change to the specified directory.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-114
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As `oe-init-build-env` only configures the current shell, you will need to source
    it on every new shell. But, if you point the script to an existing `build` directory,
    it will set up your environment but won't change any of your existing configurations.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-116
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'BitBake is designed with a client/server abstraction, so we can also start
    a memory resident server and connect a client to it. With this setup, loading
    cache and configuration information each time is avoided, which saves some overhead.
    To run a memory resident BitBake that will always be available, you can use the
    `oe-init-build-env-memres` script as follows:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Here `12345` is the local port to be used.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: Do not use both BitBake flavors simultaneously, as this can be a source of problems.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
- en: 'You can then kill the memory resident BitBake by executing the following command:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: How it works...
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Both scripts call the `scripts/oe-setup-builddir` script inside the `poky` directory
    to create the `build` directory.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: 'On creation, the `build` directory contains a `conf` directory with the following
    three files:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: '`bblayers.conf`: This file lists the metadata layers to be considered for this
    project.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`local.conf`: This file contains the project-specific configuration variables.
    You can set common configuration variables to different projects with a `site.conf`
    file, but this is not created by default.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`templateconf.cfg`: This file contains the directory that includes the template
    configuration files used to create the project. By default it uses the one pointed
    to by the `templateconf` file in your Poky installation directory, which is `meta-yocto/conf`
    by default.'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To start a build from scratch, that's all the `build` directory needs.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: Erasing everything apart from these files will recreate your build from scratch.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: There's more...
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You can specify a different template configuration file to use when you create
    your `build` directory using the `TEMPLATECONF` variable; for example:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The `TEMPLATECONF` variable needs to refer to a directory containing templates
    for both `local.conf` and `bblayer.conf`, but named `local.conf.sample` and `bblayers.conf.sample`.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: For our purposes, we can use the unmodified default project configuration files.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: Building your first image
  id: totrans-138
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before building our first image, we need to decide what type of image we want
    to build. This recipe will introduce some of the available Yocto images and provide
    instructions to build a simple image.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Poky contains a set of default target images. You can list them by executing
    the following commands:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'A full description of the different images can be found on the *Yocto Project
    Reference Manual*. Typically, these default images are used as a base and customized
    for your own project needs. The most frequently used base default images are:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: '`core-image-minimal`: This is the smallest BusyBox-, sysvinit-, and udev-based
    console-only image'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`core-image-full-cmdline`: This is the BusyBox-based console-only image with
    full hardware support and a more complete Linux system, including bash'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`core-image-lsb`: This is a console-only image that is based on Linux Standard
    Base compliance'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`core-image-x11`: This is the basic X11 Windows-system-based image with a graphical
    terminal'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`core-image-sato`: This is the X11 Window-system-based image with a SATO theme
    and a GNOME Mobile desktop environment'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`core-image-weston`: This is a Wayland protocol and Weston reference compositor-based
    image'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You will also find images with the following suffixes:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: '`dev`: These images are suitable for development work, as they contain headers
    and libraries.'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`sdk`: These images include a complete SDK that can be used for development
    on the target.'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`initramfs`: This is an image that can be used for a RAM-based root filesystem,
    which can optionally be embedded with the Linux kernel.'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To build an image, we need to configure the `MACHINE` we are building it for
    and pass its name to BitBake. For example, for the `qemuarm` machine, we would
    run the following:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Or we could export the `MACHINE` variable to the current shell environment
    with the following:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'But the preferred and persistent way to do it is to edit the `conf/local.conf`
    configuration file to change the default machine to `qemuarm`:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Then you can just execute the following:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: How it works...
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'When you pass a target recipe to BitBake, it first parses the following configuration
    files:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: '`conf/bblayers.conf`: This file is used to find all the configured layers'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`conf/layer.conf`: This file is used on each configured layer'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`meta/conf/bitbake.conf`: This file is used for its own configuration'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`conf/local.conf`: This file is used for any other configuration the user may
    have for the current build'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`conf/machine/<machine>.conf`: This file is the machine configuration; in our
    case, this is `qemuarm.conf`'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`conf/distro/<distro>.conf`: This file is the distribution policy; by default,
    this is the `poky.conf` file'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: And then BitBake parses the target recipe that has been provided and its dependencies.
    The outcome is a set of interdependent tasks that BitBake will then execute in
    order.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Most developers won''t be interested in keeping the whole build output for
    every package, so it is recommended to configure your project to remove it with
    the following configuration in your `conf/local.conf` file:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: But at the same time, configuring it for all packages means that you won't be
    able to develop or debug them.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: 'You can add a list of packages to exclude from cleaning by adding them to the
    `RM_WORK_EXCLUDE` variable. For example, if you are going to do BSP work, a good
    setting might be:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Remember that you can use a custom template `local.conf.sample` configuration
    file in your own layer to keep these configurations and apply them for all projects
    so that they can be shared across all developers.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: Once the build finishes, you can find the output images on the `tmp/deploy/images/qemuarm`
    directory inside your `build` directory.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: 'By default, images are not erased from the `deploy` directory, but you can
    configure your project to remove the previously built version of the same image
    by adding the following to your `conf/local.conf` file:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'You can test run your images on the QEMU emulator by executing this:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: The `runqemu` script included in Poky's `scripts` directory is a launch wrapper
    around the QEMU machine emulator to simplify its usage.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: Explaining the Freescale Yocto ecosystem
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As we saw, Poky metadata starts with the `meta`, `meta-yocto`, and `meta-yocto-bsp`
    layers, and it can be expanded by using more layers.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
- en: An index of the available OpenEmbedded layers that are compatible with the Yocto
    project is maintained at [http://layers.openembedded.org/](http://layers.openembedded.org/).
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: An embedded product's development usually starts with hardware evaluation using
    a manufacturer's reference board design. Unless you are working with one of the
    reference boards already supported by Poky, you will need to extend Poky to support
    your hardware.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The first thing to do is to select which base hardware your design is going
    to be based on. We will use a board that is based on a Freescale i.MX6 **System
    on Chip** (**SoC**) as a starting point for our embedded product design.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: This recipe gives an overview of the support for Freescale hardware in the Yocto
    project.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The SoC manufacturer (in this case, Freescale) has a range of reference design
    boards for purchase, as well as official Yocto-based software releases. Similarly,
    other manufacturers that use Freescale's SoCs offer reference design boards and
    their own Yocto-based software releases.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
- en: 'Selecting the appropriate hardware to base your design on is one of the most
    important design decisions for an embedded product. Depending on your product
    needs, you will decide to either:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
- en: Use a production-ready board, like a **single-board computer** (**SBC**)
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use a module and build your custom carrier board around it
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use Freescale's SoC directly and design your own board
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Most of the times, a production-ready board will not match the specific requirements
    of an professional embedded system, and the process of designing a complete carrier
    board using Freescale's SoC would be too time consuming. So, using an appropriate
    module that already solves the most technically challenging design aspects is
    a common choice.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数情况下，生产就绪的板卡无法满足专业嵌入式系统的具体要求，使用 Freescale SoC 设计完整载板的过程也会非常耗时。因此，使用一个已经解决了大部分技术挑战设计问题的合适模块是一个常见选择。
- en: 'Some of the characteristics that are important to consider are:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 需要考虑的一些重要特性包括：
- en: Industrial temperature ranges
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工业温度范围
- en: Power management
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电源管理
- en: Long-term availability
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 长期可用性
- en: Precertified wireless and Bluetooth (if applicable)
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预认证的无线和蓝牙（如果适用）
- en: The Yocto community layers that support Freescale-based boards are called `meta-fsl-arm`
    and `meta-fsl-arm-extras`. The selection of boards that are supported on `meta-fsl-arm`
    is limited to Freescale reference designs, which would be the starting point if
    you are considering designing your own carrier board around Freescale's SoC. Boards
    from other vendors are maintained on the `meta-fsl-arm-extras` layer.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 支持 Freescale 基板的 Yocto 社区层被称为 `meta-fsl-arm` 和 `meta-fsl-arm-extras`。`meta-fsl-arm`
    层支持的板卡仅限于 Freescale 参考设计，如果你考虑围绕 Freescale 的 SoC 设计自己的载板，参考设计将是起点。其他厂商的板卡则由 `meta-fsl-arm-extras`
    层维护。
- en: There are other embedded manufacturers that use `meta-fsl-arm`, but they have
    not integrated their boards in the `meta-fsl-arm-extras` community layer. These
    manufacturers will keep their own BSP layers, which depend on `meta-fsl-arm`,
    with specific support for their hardware. An example of this is Digi International
    and its ConnectCore 6 module, which is based on the i.MX6 SoC.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 还有其他嵌入式厂商使用 `meta-fsl-arm`，但他们没有将自己的板卡集成到 `meta-fsl-arm-extras` 社区层中。这些厂商将保留自己的
    BSP 层，该层依赖于 `meta-fsl-arm`，并针对其硬件提供特定支持。一个例子是 Digi International 及其基于 i.MX6 SoC
    的 ConnectCore 6 模块。
- en: How it works...
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它的工作原理...
- en: To understand Freescale Yocto ecosystem, we need to start with the Freescale
    community BSP, comprising the `meta-fsl-arm` layer with support for Freescale
    reference boards, and its companion, `meta-fsl-arm-extra`, with support for boards
    from other vendors, and its differences with the official Freescale Yocto releases
    that Freescale offers for their reference designs.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 为了理解 Freescale Yocto 生态系统，我们需要从 Freescale 社区 BSP 开始，其中包括支持 Freescale 参考板的 `meta-fsl-arm`
    层及其配套的 `meta-fsl-arm-extra` 层，后者支持其他厂商的板卡，以及它与 Freescale 为其参考设计提供的官方 Freescale
    Yocto 发布版之间的区别。
- en: 'There are some key differences between the community and Freescale Yocto releases:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 社区发布版和 Freescale Yocto 发布版之间有一些关键的区别：
- en: Freescale releases are developed internally by Freescale without community involvement
    and are used for BSP validation on Freescale reference boards.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Freescale 发布版由 Freescale 内部开发，未涉及社区参与，并用于在 Freescale 参考板上进行 BSP 验证。
- en: Freescale releases go through an internal QA and validation test process, and
    they are maintained by Freescale support.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Freescale 发布版经过内部 QA 和验证测试流程，并由 Freescale 支持进行维护。
- en: Freescale releases for a specific platform reach a maturity point, after which
    they are no longer worked on. At this point, all the development work has been
    integrated into the community layer and the platforms are further maintained by
    the Freescale BSP community.
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Freescale 为特定平台发布的版本会达到一个成熟的阶段，之后不再继续开发。此时，所有的开发工作已被集成到社区层中，平台将由 Freescale BSP
    社区继续维护。
- en: Freescale Yocto releases are not Yocto compatible, while the community release
    is.
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Freescale Yocto 发布版与 Yocto 不兼容，而社区发布版则兼容。
- en: Freescale's engineering works very closely with the Freescale BSP community
    to make sure that all development in their official releases is integrated in
    the community layer in a reliable and quick manner.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: Freescale 的工程团队与 Freescale BSP 社区紧密合作，确保他们在官方发布版中的所有开发工作都能以可靠且快速的方式集成到社区层中。
- en: Usually, the best option is to use the Freescale BSP community release but stay
    with the U-Boot and Linux kernel versions that were released as part of the manufacturer's
    stable BSP release.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，最佳选择是使用 Freescale BSP 社区发布版，但仍然使用作为厂商稳定 BSP 发布版一部分的 U-Boot 和 Linux 内核版本。
- en: This effectively means that you get the latest updates to the Linux kernel and
    U-Boot from the manufacturer while simultaneously getting the latest updates to
    the root filesystem from the community, extending the lifetime of your product,
    and making sure you are up to date with applications, bug fixes, and security
    updates.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
- en: This takes advantage of the manufacturer's QA process for the system components
    that are closer to the hardware, and makes it possible to use the manufacturer's
    support while simultaneously getting user space updates from the community. The
    Freescale BSP community is also very responsive and active, so problems can usually
    be worked on with them to benefit all parts.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The Freescale BSP community extends Poky with the following layers:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
- en: '`meta-fsl-arm`: This is the community layer that supports Freescale reference
    designs. It has a dependency on OpenEmbedded-Core. Machines in this layer will
    be maintained even after Freescale stops active development on them. You can download
    `meta-fsl-arm` from its Git repository at [http://git.yoctoproject.org/cgit/cgit.cgi/meta-fsl-arm/](http://git.yoctoproject.org/cgit/cgit.cgi/meta-fsl-arm/).'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Development discussions can be followed and contributed to by visiting the development
    mailing list at [https://lists.yoctoproject.org/listinfo/meta-freescale](https://lists.yoctoproject.org/listinfo/meta-freescale).
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'The `meta-fsl-arm` layer pulls both the Linux kernel and the U-Boot source
    from Freescale''s repositories using the following links:'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**Freescale Linux kernel Git** **repository**: [http://git.freescale.com/git/cgit.cgi/imx/linux-2.6-imx.git/](http://git.freescale.com/git/cgit.cgi/imx/linux-2.6-imx.git/)'
  id: totrans-222
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Freescale** **U-Boot Git repository**: [http://git.freescale.com/git/cgit.cgi/imx/uboot-imx.git/](http://git.freescale.com/git/cgit.cgi/imx/uboot-imx.git/)'
  id: totrans-223
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Other Linux kernel and U-Boot versions are available, but keeping the manufacturer's
    supported version is recommended.
  id: totrans-224
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'The `meta-fsl-arm` layer includes Freescale''s proprietary binaries to enable
    some hardware features – most notably its hardware graphics, multimedia, and encryption
    capabilities. To make use of these capabilities, the end user needs to accept
    Freescale''s **End-User License Agreement** (**EULA**), which is included in the
    `meta-fsl-arm` layer. To accept the license, the following line needs to be added
    to the project''s `conf/local.conf` configuration file:'
  id: totrans-225
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-226
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '`meta-fsl-arm-extra`: This layer adds support for other community-maintained
    boards; for example, the Wandboard. To download the layer''s content, you may
    visit [https://github.com/Freescale/meta-fsl-arm-extra/](https://github.com/Freescale/meta-fsl-arm-extra/).'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`meta-fsl-demos`: This layer adds a metadata layer for demonstration target
    images. To download the layer''s content, you may visit [https://github.com/Freescale/meta-fsl-demos](https://github.com/Freescale/meta-fsl-demos).'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Freescale uses another layer on top of the layers above for their official
    software releases: `meta-fsl-bsp-release`.'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
- en: '`meta-fsl-bsp-release`: This is a Freescale-maintained layer that is used in
    the official Freescale software releases. It contains modifications to both `meta-fsl-arm`
    and `meta-fsl-demos`. It is not part of the community release.'
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  id: totrans-231
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For more information, refer to the FSL community BSP release notes available
    at [http://freescale.github.io/doc/release-notes/1.7/](http://freescale.github.io/doc/release-notes/1.7/)
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing support for Freescale hardware
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we will install the community Freescale BSP Yocto release that
    adds support for Freescale hardware to our Yocto installation.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: With so many layers, manually cloning each of them and adding them to your project's
    `conf/bblayers.conf` file is cumbersome. The community is using the `repo` tool
    developed by Google for their community Android to ease the installation of Yocto.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
- en: 'To install `repo` in your host system, type in the following commands:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The `repo` tool is a Python utility that parses an XML file, called `manifest`,
    with a list of Git repositories. The `repo` tool is then used to manage those
    repositories as a whole.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-240
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'For example, we will use `repo` to download all the repositories listed in
    the previous recipe to our host system. For that, we will point it to the Freescale
    community BSP `manifest` for the Dizzy release:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The `manifest` file shows all the installation paths and repository sources
    for the different components that are going to be installed.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The `manifest` file is a list of the different layers that are needed for the
    Freescale community BSP release. We can now use `repo` to install it. Run the
    following:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: You can optionally pass a `-jN` argument to sync if you have a multicore machine
    for multithreaded operations; for example, you could pass `repo sync -j8` in an
    8-core host system.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To list the hardware boards supported by the different layers, we may run:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'And to list the newly introduced target images, use the following:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The community Freescale BSP release introduces the following new target images:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
- en: '`fsl-image-mfgtool-initramfs`: This is a small, RAM-based `initramfs` image
    used with the Freescale manufacturing tool'
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`fsl-image-multimedia`: This is a console-only image that includes the `gstreamer`
    multimedia framework over the framebuffer, if applicable'
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`fsl-image-multimedia-full`: This is an extension of `fsl-image-multimedia`,
    but extends the `gstreamer` multimedia framework to include all available plugins'
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`fsl-image-machine-test`: This is an extension on `fsl-image-multimedia-full`
    for testing and benchmarking'
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`qte-in-use-image`: This is a graphical image that includes support for Qt4
    over the framebuffer'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`qt-in-use-image`: This is a graphical image that includes support for Qt4
    over the X11 Windows system'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  id: totrans-260
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Instructions to use the `repo` tool, including using `repo` with proxy servers,
    can be found in the Android documentation at [https://source.android.com/source/downloading.html](https://source.android.com/source/downloading.html)
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building Wandboard images
  id: totrans-262
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Building images for one of the supported boards (for example, `Wandboard Quad`)
    follows the same process we described earlier for the QEMU machines, with the
    exception of using the `setup-environment` script, which is a wrapper around `oe-init-build-env`.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-264
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To build an image for the `wandboard-quad` machine, use the following commands:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Note
  id: totrans-267
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The current version of the `setup-environment` script only works if the `build`
    directory is under the installation folder; in our case, `/opt/yocto/fsl-community-bsp`.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `setup-environment` script will create a `build` directory, set up the `MACHINE`
    variable, and prompt you to accept the Freescale EULA as described earlier. Your
    `conf/local.conf` configuration file will be updated both with the specified machine
    and the EULA acceptance variable.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-271
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Remember that if you close your terminal session, you will need to set up the
    environment again before being able to use BitBake. You can safely rerun the `setup-environment`
    script as seen previously, as it will not touch an existing `conf/local.conf`
    file. Run the following:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'The resulting image, `core-image-minimal.sdcard`, which is created inside the
    `build` directory, can be programmed into a microSD card, inserted into the primary
    slot in the Wandboard CPU board, and booted using the following commands:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Here, `/dev/sdN` corresponds to the device node assigned to the microSD card
    in your host system.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-277
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Be careful when running the `dd` command, as it could harm your machine. You
    need to be absolutely sure that the *sdN* device corresponds to your microSD card
    and not a drive on your development machine.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-279
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can find more information regarding the `repo` tool on Android's documentation
    at [https://source.android.com/source/using-repo.html](https://source.android.com/source/using-repo.html)
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting your Wandboard's first boot
  id: totrans-281
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you have problems booting your image, follow this recipe to troubleshoot.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-283
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Without the microSD card inserted, plug in a microUSB-to-USB cable to the USB
    OTG interface of your Wandboard. Check the `lsusb` utility on your Linux host
    to see whether the Wandboard appears as follows:'
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-285
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: If you don't see this, try a different power supply. It should be 5V, 10W.
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Make sure you connect a NULL modem serial cable between the RS232 connector
    in your Wandboard target and a serial port on your Linux host. Then open a terminal
    program like minicom with the following:'
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-288
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Note
  id: totrans-289
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You will need to add your user to the dialout group, or try to run the command
    as sudo. This should open a 115200 8N1 serial connection. The serial device may
    vary in your Linux host. For example, a USB-to-serial adapter may be detected
    as `/dev/ttyUSB0`. Also, make sure both hardware and software flow control are
    disabled.
  id: totrans-290
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-291
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Insert the microSD card image to the module slot, not the base board, as the
    latter is only used for storage and not for booting, and power it. You should
    see the U-Boot banner in the minicom session output.
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If not, you may have a problem with the serial communication. By default, the
    Ethernet interface in the FSL community BSP image is configured to request an
    address by DHCP, so you can use that to connect to the target.
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure you have a DHCP server running on the test network where the target
    is.
  id: totrans-294
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You can use a packet sniffer like **Wireshark** to capture a network trace on
    your Linux host and filter packages like the `bootp` protocol. At the least, you
    should see some broadcasts from your target, and if you use an Ethernet hub, you
    should also see the DHCP replies.
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Optionally, you can log in to your DHCP server and check the logs to see if
    a new IP address has been assigned. If you see an IP address being assigned, you
    might want to consider adding an SSH server, like **Dropbear**, to your core-image-minimal
    image so that you can establish a network connection with the target. You can
    do this by adding the following line to the `conf/local.conf` configuration file:'
  id: totrans-296
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Note the space after the initial quote.
  id: totrans-298
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'After building and reprogramming, you can then start an SSH session to the
    Wandboard from your Linux host with:'
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-300
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The connection should automatically log in without a password prompt.
  id: totrans-301
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Try to program the default microSD card images from [http://www.wandboard.org/index.php/downloads](http://www.wandboard.org/index.php/downloads)
    to make sure the hardware and your setup is valid.
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Try to reprogram your microSD card. Make sure you are using the correct images
    for your board (for example, do not mix dual and quad images). Also, try different
    cards and card readers.
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: These steps will have your Wandboard start booting, and you should have some
    output in your serial connection.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-305
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If everything else fails, you can verify the position of the bootloader on
    your microSD card. You can dump the contents of the first blocks of your microSD
    card with:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'You should see a U-Boot header at offset 0x400\. That''s the offset where the
    i.MX6 boot ROM will be looking for the bootloader when bootstrapped to boot from
    the microSD interface. Use the following commands:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'You can recognize the U-Boot header by dumping the U-Boot image from your build.
    Run the following commands:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-311
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Configuring network booting for a development setup
  id: totrans-312
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Most professional i.MX6 boards will have an internal **embedded MMC** (**eMMC**)
    flash memory, and that would be the recommended way to boot firmware. The Wandboard
    is not really a product meant for professional use, so it does not have one. But
    neither the eMMC nor the microSD card are ideal for development work, as any system
    change would involve a reprogramming of the firmware image.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-314
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The ideal setup for development work is to use both TFTP and NFS servers in
    your host system and to only store the U-Boot bootloader in either the eMMC or
    a microSD card. With this setup, the bootloader will fetch the Linux kernel from
    the TFTP server and the kernel will mount the root filesystem from the NFS server.
    Changes to either the kernel or the root filesystem are available without the
    need to reprogram. Only bootloader development work would need you to reprogram
    the physical media.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
- en: Installing a TFTP server
  id: totrans-316
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you are not already running a TFTP server, follow the next steps to install
    and configure a TFTP server on your Ubuntu 14.04 host:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'The `tftpd-hpa` configuration file is installed in `/etc/default/tftpd-hpa`.
    By default, it uses `/var/lib/tftpboot` as the root `TFTP` folder. Change the
    folder permissions to make it accessible to all users using the following command:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Now copy the Linux kernel and device tree from your `build` directory as follows:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Installing an NFS server
  id: totrans-323
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you are not already running an NFS server, follow the next steps to install
    and configure one on your Ubuntu 14.04 host:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-325
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'We will use the `/nfsroot` directory as the root for the NFS server, so we
    will "untar" the target''s root filesystem from our Yocto `build` directory in
    there:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-327
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Next, we will configure the NFS server to export the `/nfsroot` folder:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'We will then restart the NFS server for the configuration changes to take effect:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-331
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: How to do it...
  id: totrans-332
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Boot the Wandboard and stop at the U-Boot prompt by pressing any key on the
    serial console. Then run through the following steps:'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
- en: 'Get an IP address by DHCP:'
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-335
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Alternatively, you can configure a static IP address with:'
  id: totrans-336
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-337
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Configure the IP address of your host system, where the TFTP and NFS servers
    have been set up:'
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-339
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Configure the root filesystem mount:'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-341
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Configure the Linux kernel and device tree filenames:'
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE44]'
  id: totrans-343
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'If you have configured a static IP address, you need to disable DHCP on boot
    by running:'
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE45]'
  id: totrans-345
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Save the U-Boot environment to the microSD card:'
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE46]'
  id: totrans-347
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Perform a network boot:'
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE47]'
  id: totrans-349
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: The Linux kernel and device tree will be fetched from the TFTP server, and the
    root filesystem will be mounted by the kernel from the NFS share after getting
    a DHCP address from your network (unless using static IP addresses).
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
- en: You should be able to log in with the root user without a password prompt.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
- en: Sharing downloads
  id: totrans-352
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You will usually work on several projects simultaneously, probably for different
    hardware platforms or different target images. In such cases, it is important
    to optimize the build times by sharing `downloads`.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-354
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The build system runs a search for downloaded sources in a number of places:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
- en: It tries the local `downloads` folder.
  id: totrans-356
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It looks into the configured premirrors, which are usually local to your organization.
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It then tries to fetch from the upstream source as configured in the package
    recipe.
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finally, it checks the configured mirrors. Mirrors are public alternate locations
    for the source.
  id: totrans-359
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If a package source is not found in any of the these four, the package build
    will fail with an error. Build warnings are also issued when upstream fetching
    fails and mirrors are tried, so that the upstream problem can be looked at.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
- en: The Yocto project maintains a set of mirrors to isolate the build system from
    problems with the upstream servers. However, when adding external layers, you
    could be adding support for packages that are not in the Yocto project's mirror
    servers, or other configured mirrors, so it is recommended that you keep a local
    premirror to avoid problems with source availability.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
- en: The default Poky setting for a new project is to store the downloaded package
    sources on the current `build` directory. This is the first place the build system
    will run a search for source `downloads`. This setting can be configured in your
    project's `conf/local.conf` file with the `DL_DIR` configuration variable.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-363
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To optimize the build time, it is recommended to keep a shared `downloads`
    directory between all your projects. The `setup-environment` script of the `meta-fsl-arm`
    layer changes the default `DL_DIR` to the `fsl-community-bsp` directory created
    by the `repo` tool. With this setup, the `downloads` folder will already be shared
    between all the projects in your host system. It is configured as:'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  id: totrans-365
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'A more scalable setup (for instance, for teams that are remotely distributed)
    is to configure a premirror. For example, adding the following to your `conf/local.conf`
    file:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'A usual setup is to have a build server serve its `downloads` directory. The
    build server can be configured to prepare tarballs of the Git directories to avoid
    having to perform Git operations from upstream servers. This setting in your `conf/local.conf`
    file will affect the build performance, but this is usually acceptable in a build
    server. Add the following:'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  id: totrans-369
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: An advantage of this setup is that the build server's `downloads` folder can
    also be backed up to guarantee source availability for your products in the future.
    This is especially important in embedded products with long-term availability
    requirements.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
- en: 'In order to test this setup, you may check to see whether a build is possible
    just by using the premirrors with the following:'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  id: totrans-372
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: This setting in your `conf/local.conf` file can also be distributed across the
    team with the `TEMPLATECONF` variable during the project's creation.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
- en: Sharing the shared state cache
  id: totrans-374
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Yocto project builds everything from source. When you create a new project,
    only the configuration files are created. The build process then compiles everything
    from scratch, including the cross-compilation toolchain and some native tools
    important for the build.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
- en: This process can take a long time, and the Yocto project implements a shared
    state cache mechanism that is used for incremental builds with the aim to build
    only the strictly necessary components for a given change.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
- en: For this to work, the build system calculates a checksum of the given input
    data to a task. If the input data changes, the task needs to be rebuilt. In simplistic
    terms, the build process generates a run script for each task that can be checksummed
    and compared. It also keeps track of a task's output, so that it can be reused.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
- en: A package recipe can modify the shared state caching to a task; for example,
    to always force a rebuild by marking it as `nostamp`. A more in-depth explanation
    of the shared state cache mechanism can be found in the *Yocto Project Reference
    Manual* at [http://www.yoctoproject.org/docs/1.7.1/ref-manual/ref-manual.html](http://www.yoctoproject.org/docs/1.7.1/ref-manual/ref-manual.html).
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-379
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: By default, the build system will use a shared state cache directory called
    `sstate-cache` on your `build` directory to store the cached data. This can be
    changed with the `SSTATE_DIR` configuration variable in your `conf/local.conf`
    file. The cached data is stored in directories named with the first two characters
    of the hash. Inside, the filenames contain the whole task checksum, so the cache
    validity can be ascertained just by looking at the filename. The build process
    set scene tasks will evaluate the cached data and use it to accelerate the build
    if valid.
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
- en: When you want to start a build from a clean state, you need to remove both the
    `sstate-cache` directory and the `tmp` directory.
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
- en: You can also instruct BitBake to ignore the shared state cache by using the
    `--no-setscene` argument when running it.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
- en: It's a good practice to keep backups of clean shared state caches (for example,
    from a build server), which can be used in case of shared state cache corruption.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-384
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Sharing a shared state cache is possible; however, it needs to be approached
    with care. Not all changes are detected by the shared state cache implementation,
    and when this happens, some or all of the cache needs to be invalidated. This
    can cause problems when the state cache is being shared.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
- en: The recommendation in this case depends on the use case. Developers working
    on Yocto metadata should keep the shared state cache as default, separated per
    project.
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
- en: However, validation and testing engineers, kernel and bootloader developers,
    and application developers would probably benefit from a well-maintained shared
    state cache.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
- en: 'To configure an NFS share drive to be shared among the development team to
    speed up the builds, you can add the following to your `conf/local.conf` configuration
    file:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The expression `PATH` in this example will get substituted by the build system
    with a directory named with the hash's first two characters.
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
- en: Setting up a package feed
  id: totrans-391
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: An embedded system project seldom has the need to introduce changes to the Yocto
    build system. Most of the time and effort is spent in application development,
    followed by a lesser amount in maybe kernel and bootloader development.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
- en: As such, a whole system rebuild is probably done very few times. A new project
    is usually built from a prebuilt shared state cache, and application development
    work only needs to be done to perform full or incremental builds of a handful
    of packages.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
- en: Once the packages are built, they need to be installed on the target system
    for testing. Emulated machines are fine for application development, but most
    hardware-related work needs to be done on embedded hardware.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-395
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: An option is to manually copy the build binaries to the target's root filesystem,
    either copying it to the NFS share on the host system the target is mounting its
    root filesystem from (as explained in the *Configuring network booting for a development
    setup* recipe earlier) or using any other method like SCP, FTP, or even a microSD
    card.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
- en: This method is also used by IDEs like Eclipse when debugging an application
    you are working on. However, this method does not scale well when you need to
    install several packages and dependencies.
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
- en: 'The next option would be to copy the packaged binaries (that is, the RPM, deb,
    or ipk packages) to the target''s filesystem and then use the target''s package
    management system to install them. For this to work, your target''s filesystem
    needs to be built with package management tools. Doing this is as easy as adding
    the `package-management` feature to your root filesystem; for example, you may
    add the following line to your project''s `conf/local.conf` file:'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  id: totrans-399
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: So for an RPM package, you will copy it to the target and use the **rpm** or
    **smart** utilities to install it. The smart package management tool is GPL licensed
    and can work with a variety of package formats.
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
- en: However, the most optimized way to do this is to convert your host system package's
    output directory into a package feed. For example, if you are using the default
    RPM package format, you may convert `tmp/deploy/rpm` in your `build` directory
    into a package feed that your target can use to update.
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
- en: For this to work, you need to configure an HTTP server on your computer that
    serves the packages.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
- en: Versioning packages
  id: totrans-403
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You also need to make sure that the generated packages are correctly versioned,
    and that means updating the recipe revision, **PR**, with every change. It is
    possible to do this manually, but the recommended—and compulsory way if you want
    to use package feeds—is to use a PR server.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
- en: However, the PR server is not enabled by default. The packages generated without
    a PR server are consistent with each other but offer no update guarantees for
    a system that is already running.
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
- en: 'The simplest PR server configuration is to run it locally on your host system.
    To do this, you add the following to your `conf/local.conf` file:'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  id: totrans-407
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: With this setup, update coherency is guaranteed for your feed.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to share your feed with other developers, or you are configuring
    a build server or package server, you would run a single instance of the PR server
    by running the following command:'
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE55]'
  id: totrans-410
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'And you will update the project''s build configuration to use the centralized
    PR server, editing `conf/local.conf` as follows:'
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE56]'
  id: totrans-412
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Also, if you are using a shared state cache as described before, all of the
    contributors to the shared state cache need to use the same PR server.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
- en: Once the feed's integrity is guaranteed, we need to configure an HTTP server
    to serve the feed.
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-415
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We will use `lighttpd` for this example, as it is lightweight and easy to configure.
    Follow these steps:'
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
- en: 'Install the web server:'
  id: totrans-417
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE57]'
  id: totrans-418
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'By default, the document root specified in the `/etc/lighttpd/lighttpd.conf`
    configuration file is `/var/www/`, so we only need a symlink to our package feed:'
  id: totrans-419
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE58]'
  id: totrans-420
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Next, reload the configuration as follows:'
  id: totrans-421
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE59]'
  id: totrans-422
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Refresh the package index. This needs to be done manually to update the package
    feed after every build:'
  id: totrans-423
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE60]'
  id: totrans-424
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Then we need to configure our target filesystem with the new package feeds:'
  id: totrans-425
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE61]'
  id: totrans-426
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Once the setup is ready, we will be able to query and update packages from
    the target''s root filesystem with the following:'
  id: totrans-427
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE62]'
  id: totrans-428
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'To make this change persistent in the target''s root filesystem, we can configure
    the package feeds at compilation time by using the `PACKAGE_FEED_URIS` variable
    in `conf/local.conf` as follows:'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]'
  id: totrans-430
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: See also
  id: totrans-431
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: More information and a user manual for the smart utility can be found at [https://labix.org/smart/](https://labix.org/smart/)
  id: totrans-432
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using build history
  id: totrans-433
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When maintaining software for an embedded product, you need a way to know what
    has changed and how it is going to affect your product.
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
- en: On a Yocto system, you may need to update a package revision (for instance,
    to fix a security vulnerability), and you need to make sure what the implications
    of this change are; for example, in terms of package dependencies and changes
    to the root filesystem.
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
- en: Build history enables you to do just that, and we will explore it in this recipe.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-437
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To enable build history, add the following to your `conf/local.conf` file:'
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  id: totrans-439
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'The following enables information gathering, including dependency graphs:'
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE65]'
  id: totrans-441
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: The preceding line of code enables the storage of build history in a local Git
    repository.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
- en: The Git repository location can be set by the `BUILDHISTORY_DIR` variable, which
    by default is set to a `buildhistory` directory on your `build` directory.
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
- en: 'By default, `buildhistory` tracks changes to packages, images, and SDKs. This
    is configurable using the `BUILDHISTORY_FEATURES` variable. For example, to track
    only image changes, add the following to your `conf/local.conf`:'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  id: totrans-445
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'It can also track specific files and copy them to the `buildhistory` directory.
    By default, this includes only `/etc/passwd` and `/etc/groups`, but it can be
    used to track any important files like security certificates. The files need to
    be added with the `BUILDHISTORY_IMAGE_FILES` variable in your `conf/local.conf`
    file as follows:'
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE67]'
  id: totrans-447
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: Build history will slow down the build, increase the build size, and may also
    grow the Git directory to an unmanageable size. The recommendation is to enable
    it on a build server for software releases, or in specific cases, such as when
    updating production software.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-449
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When enabled, it will keep a record of the changes to each package and image
    in the form of a Git repository in a way that can be explored and analyzed.
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
- en: 'For a package, it records the following information:'
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
- en: Package and recipe revision
  id: totrans-452
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dependencies
  id: totrans-453
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Package size
  id: totrans-454
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Files
  id: totrans-455
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'For an image, it records the following information:'
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
- en: Build configuration
  id: totrans-457
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dependency graphs
  id: totrans-458
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A list of files that includes ownership and permissions
  id: totrans-459
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: List of installed packages
  id: totrans-460
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'And for an SDK, it records the following information:'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
- en: SDK configuration
  id: totrans-462
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: List of both host and target files, including ownership and permissions
  id: totrans-463
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dependency graphs
  id: totrans-464
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A list of installed packages
  id: totrans-465
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Looking at the build history
  id: totrans-466
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Inspecting the Git directory with the build history can be done in several
    ways:'
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
- en: Using Git tools like gitk or git log.
  id: totrans-468
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the **buildhistory-diff** command-line tool, which displays the differences
    in a human-readable format.
  id: totrans-469
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using a Django-1.4-based web interface. You will need to import the build history
    data to the application's database after every build. The details are available
    at [http://git.yoctoproject.org/cgit/cgit.cgi/buildhistory-web/tree/README](http://git.yoctoproject.org/cgit/cgit.cgi/buildhistory-web/tree/README).
  id: totrans-470
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-471
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To maintain the build history, it's important to optimize it and avoid it from
    growing over time. Periodic backups of the build history and clean-ups of older
    data are important to keep the build history repository at a manageable size.
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
- en: 'Once the `buildhistory` directory has been backed up, the following process
    will trim it and keep only the most recent history:'
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
- en: Copy your repository to a temporary RAM filesystem (`tmpfs`) to speed things
    up. Check the output of the `df -h` command to see which directories are `tmpfs`
    filesystems and how much space they have available, and use one. For example,
    in Ubuntu, the `/run/shm` directory is available.
  id: totrans-474
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add a graft point for a commit one month ago with no parents:'
  id: totrans-475
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE68]'
  id: totrans-476
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Make the graft point permanent:'
  id: totrans-477
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE69]'
  id: totrans-478
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Clone a new repository to clean up the remaining Git objects:'
  id: totrans-479
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE70]'
  id: totrans-480
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Replace the old `buildhistory` directory with the new cleaned one:'
  id: totrans-481
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE71]'
  id: totrans-482
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: Working with build statistics
  id: totrans-483
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The build system can collect build information per task and image. The data
    may be used to identify areas of optimization of build times and bottlenecks,
    especially when new recipes are added to the system. This recipe will explain
    how the build statistics work.
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-485
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To enable the collection of statistics, your project needs to inherit the `buildstats`
    class by adding it to `USER_CLASSES` in your `conf/local.conf` file. By default,
    the `fsl-community-bsp` build project is configured to enable them.
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE72]'
  id: totrans-487
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: You can configure the location of these statistics with the `BUILDSTATS_BASE`
    variable, and by default it is set to the `buildstats` folder in the `tmp` directory
    under the `build` directory (`tmp/buildstats`).
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
- en: 'The `buildstats` folder contains a folder per image with the build stats under
    a `timestamp` folder. Under it will be a subdirectory per package in your built
    image, and a `build_stats` file that contains:'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
- en: Host system information
  id: totrans-490
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Root filesystem location and size
  id: totrans-491
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Build time
  id: totrans-492
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Average CPU usage
  id: totrans-493
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Disk statistics
  id: totrans-494
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-495
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The accuracy of the data depends on the download directory, `DL_DIR`, and the
    shared state cache directory, `SSTATE_DIR`, existing on the same partition or
    volume, so you may need to configure them accordingly if you are planning to use
    the build data.
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
- en: 'An example `build-stats` file looks like the following:'
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE73]'
  id: totrans-498
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'These disk statistics come from the Linux kernel disk I/O stats ([https://www.kernel.org/doc/Documentation/iostats.txt](https://www.kernel.org/doc/Documentation/iostats.txt)).
    The different elements are explained here:'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
- en: '`ReadsComp`: This is the total number of reads completed'
  id: totrans-500
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ReadsMerged`: This is the total number of adjacent reads merged'
  id: totrans-501
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SectRead`: This is the total number of sectors read'
  id: totrans-502
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`TimeReads`: This is the total number of milliseconds spent reading'
  id: totrans-503
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`WritesComp`: This is the total number of writes completed'
  id: totrans-504
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SectWrite`: This is the total number of sectors written'
  id: totrans-505
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`TimeWrite`: This is the total number of milliseconds spent writing'
  id: totrans-506
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`IOinProgress`: This is the total number of I/Os in progress when reading `/proc/diskstats`'
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
- en: '`TimeIO`: This is the total number of milliseconds spent performing I/O'
  id: totrans-508
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`WTimeIO`: This is the total number of weighted time while performing I/O'
  id: totrans-509
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'And inside each package, we have a list of tasks; for example, for `ncurses-5.9-r15.1`,
    we have the following tasks:'
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
- en: '`do_compile`'
  id: totrans-511
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_fetch`'
  id: totrans-512
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_package`'
  id: totrans-513
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_package_write_rpm`'
  id: totrans-514
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_populate_lic`'
  id: totrans-515
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_rm_work`'
  id: totrans-516
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_configure`'
  id: totrans-517
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_install`'
  id: totrans-518
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_packagedata`'
  id: totrans-519
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_patch`'
  id: totrans-520
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_populate_sysroot`'
  id: totrans-521
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`do_unpack`'
  id: totrans-522
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Each one of them contain, in the same format as earlier, the following:'
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
- en: Build time
  id: totrans-524
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CPU usage
  id: totrans-525
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Disk stats
  id: totrans-526
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-527
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You can also obtain a graphical representation of the data using the `pybootchartgui.py`
    tool included in the Poky source. From your project''s `build` folder, you can
    execute the following command to obtain a `bootchart.png` graphic in `/tmp`:'
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE74]'
  id: totrans-529
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: Debugging the build system
  id: totrans-530
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the last recipe of this chapter, we will explore the different methods available
    to debug problems with the build system and its metadata.
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-532
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let's first introduce some of the usual use cases on a debugging session.
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
- en: Finding recipes
  id: totrans-534
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'A good way to check whether a specific package is supported in your current
    layers is to search for it as follows:'
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE75]'
  id: totrans-536
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'This will recursively search all layers for the BusyBox pattern. You can limit
    the search to recipes and append files by executing:'
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE76]'
  id: totrans-538
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: Dumping BitBake's environment
  id: totrans-539
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When developing or debugging package or image recipes, it is very common to
    ask BitBake to list its environment both globally and for a specific target, be
    it a package or image.
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
- en: 'To dump the global environment and `grep` for a variable of interest (for example,
    `DISTRO_FEATURES`), use the following command:'
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE77]'
  id: totrans-542
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'Optionally, to locate the source directory for a specific package recipe like
    BusyBox, use the following command:'
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE78]'
  id: totrans-544
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'You could also execute the following command to locate the working directory
    for a package or image recipe:'
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE79]'
  id: totrans-546
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: Using the development shell
  id: totrans-547
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'BitBake offers the `devshell` task to help developers. It is executed with
    the following command:'
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE80]'
  id: totrans-549
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: It will unpack and patch the source, and open a new terminal (it will autodetect
    your terminal type or it can be set with `OE_TERMINAL`) in the target source directory,
    which has the environment correctly setup.
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-551
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'While in a graphical environment, devshell opens a new terminal or console
    window, but if we are working on a non-graphical environment, like telnet or SSH,
    you may need to specify `screen` as your terminal in your `conf/local.conf` configuration
    file as follows:'
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE81]'
  id: totrans-553
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: Inside the devshell, you can run development commands like `configure` and `make`
    or invoke the cross-compiler directly (use the `$CC` environment variable, which
    has been set up already).
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-555
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The starting point for debugging a package build error is the BitBake error
    message printed on the build process. This will usually point us to the task that
    failed to build.
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
- en: 'To list all the tasks available for a given recipe, with descriptions, we execute
    the following:'
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE82]'
  id: totrans-558
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'If you need to recreate the error, you can force a build with the following:'
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE83]'
  id: totrans-560
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'Or you can ask BitBake to force-run only a specific task using the following
    command:'
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE84]'
  id: totrans-562
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: Task log and run files
  id: totrans-563
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To debug the build errors, BitBake creates two types of useful files per shell
    task and stores them in a `temp` folder in the working directory. Taking BusyBox
    as an example, we would look into:'
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE85]'
  id: totrans-565
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: And find a list of log and run files. The filename format is
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
- en: '`log.do_<task>.<pid>`'
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
- en: and `run.do_<task>.<pid>`.
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
- en: But luckily, we also have symbolic links, without the `pid` part, that link
    to the latest version.
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
- en: The log files will contain the output of the task, and that is usually the only
    information we need to debug the problem. The run file contains the actual code
    executed by BitBake to generate the log mentioned before. This is only needed
    when debugging complex build issues.
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
- en: Python tasks, on the other hand, do not currently write files as described previously,
    although it is planned to do so in the future. Python tasks execute internally
    and log information to the terminal.
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
- en: Adding logging to recipes
  id: totrans-572
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'BitBake recipes accept either bash or Python code. Python logging is done through
    the `bb` class and uses the standard logging Python library module. It has the
    following components:'
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
- en: '`bb.plain`: This uses `logger.plain`. It can be used for debugging, but should
    not be committed to the source.'
  id: totrans-574
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bb.note`: This uses `logger.info`.'
  id: totrans-575
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bb.warn`: This uses `logger.warn`.'
  id: totrans-576
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bb.error`: This uses `logger.error`.'
  id: totrans-577
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bb.fatal`: This uses `logger.critical` and exits BitBake.'
  id: totrans-578
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bb.debug`: This should be passed log level as the first argument and uses
    `logger.debug`.'
  id: totrans-579
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To print debug output from bash in our recipes, we need to use the `logging`
    class by executing:'
  id: totrans-580
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE86]'
  id: totrans-581
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: 'The `logging` class is inherited by default by all recipes containing `base.bbclass`,
    so we don''t usually have to inherit it explicitly. We will then have access to
    the following bash functions, which will output to the log files (not to the console)
    in the `temp` directory inside the working directory as described previously:'
  id: totrans-582
  prefs: []
  type: TYPE_NORMAL
- en: '`bbplain`: This function outputs literally what''s passed in. It can be used
    in debugging but should not be committed to a recipe source.'
  id: totrans-583
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bbnote`: This function prints with the `NOTE` prefix.'
  id: totrans-584
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bbwarn`: This prints a non-fatal warning with the `WARNING` prefix.'
  id: totrans-585
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bberror`: This prints a non-fatal error with the `ERROR` prefix.'
  id: totrans-586
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bbfatal`: This function halts the build and prints an error message as with
    `bberror`.'
  id: totrans-587
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`bbdebug`: This function prints debug messages with log level passed as the
    first argument. It is used with the following format:'
  id: totrans-588
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE87]'
  id: totrans-589
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE87]'
- en: Tip
  id: totrans-590
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The bash functions mentioned here do not log to the console but only to the
    log files.
  id: totrans-591
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Looking at dependencies
  id: totrans-592
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'You can ask BitBake to print the current and provided versions of packages
    with the following command:'
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE88]'
  id: totrans-594
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: Another common debugging task is the removal of unwanted dependencies.
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
- en: 'To see an overview of pulled-in dependencies, you can use BitBake''s verbose
    output by running this:'
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE89]'
  id: totrans-597
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: 'To analyze what dependencies are pulled in by a package, we can ask BitBake
    to create DOT files that describe these dependencies by running the following:'
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE90]'
  id: totrans-599
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: The DOT format is a text description language for graphics that is understood
    by the **GraphViz** open source package and all the utilities that use it. DOT
    files can be visualized or further processed.
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
- en: 'You can omit dependencies from the graph to produce more readable output. For
    example, to omit dependencies from `glibc`, you would run the following command:'
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE91]'
  id: totrans-602
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'Once the preceding commands have been run, we get three files in the current
    directory:'
  id: totrans-603
  prefs: []
  type: TYPE_NORMAL
- en: '`package-depends.dot`: This file shows the dependencies between runtime targets'
  id: totrans-604
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`pn-depends.dot`: This file shows the dependencies between recipes'
  id: totrans-605
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`task-depends.dot`: This file shows the dependencies between tasks'
  id: totrans-606
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There is also a `pn-buildlist` file with a list of packages that would be built
    by the given target.
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
- en: 'To convert the `.dot` files to postscript files (`.ps`), you may execute:'
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE92]'
  id: totrans-609
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'However, the most useful way to display dependency data is to ask BitBake to
    display it graphically with the dependency explorer, as follows:'
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE93]'
  id: totrans-611
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: 'The result may be seen in the following screenshot:'
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
- en: '![Looking at dependencies](img/5186OS_01_01.jpg)'
  id: totrans-613
  prefs: []
  type: TYPE_IMG
- en: Debugging BitBake
  id: totrans-614
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'It is not common to have to debug BitBake itself, but you may find a bug in
    BitBake and want to explore it by yourself before reporting it to the BitBake
    community. For such cases, you can ask BitBake to output the debug information
    at three different levels with the `-D` flag. To display all the debug information,
    run the following command:'
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE94]'
  id: totrans-616
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: Error reporting tool
  id: totrans-617
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Sometimes, you will find a build error on a Yocto recipe that you have not modified.
    The first place to check for errors is the community itself, but before launching
    your mail client, head to [http://errors.yoctoproject.org](http://errors.yoctoproject.org).
  id: totrans-618
  prefs: []
  type: TYPE_NORMAL
- en: This is a central database of user-reported errors. Here, you may check whether
    someone else is experiencing the same problem.
  id: totrans-619
  prefs: []
  type: TYPE_NORMAL
- en: 'You can submit your own build failure to the database to help the community
    debug the problem. To do so, you may use the `report-error` class. Add the following
    to your `conf/local.conf` file:'
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE95]'
  id: totrans-621
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: By default, the error information is stored under `tmp/log/error-report` under
    the `build` directory, but you can set a specific location with the `ERR_REPORT_DIR`
    variable.
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
- en: 'When the error reporting tool is activated, a build error will be captured
    in a file in the `error-report` folder. The build output will also print a command
    to send the error log to the server:'
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE96]'
  id: totrans-624
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: When this command is executed, it will report back with a link to the upstream
    error.
  id: totrans-625
  prefs: []
  type: TYPE_NORMAL
- en: You can set up a local error server, and use that instead by passing a server
    argument. The error server code and setting up details can be found at [http://git.yoctoproject.org/cgit/cgit.cgi/error-report-web/tree/README](http://git.yoctoproject.org/cgit/cgit.cgi/error-report-web/tree/README).
  id: totrans-626
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-627
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Although you can use Linux utilities to parse Yocto's metadata and build output,
    BitBake lacks a command base UI for common tasks. One project that aims to provide
    it is `bb`, which is available at [https://github.com/kergoth/bb](https://github.com/kergoth/bb).
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
- en: 'To use it, you need to clone the repository locally by executing the following
    command:'
  id: totrans-629
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE97]'
  id: totrans-630
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: Then run the `bb/bin/bb init` command, which prompts you to add a bash command
    to your `~/.bash_profile` file.
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
- en: 'You can either do that or execute it in your current shell as follows:'
  id: totrans-632
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE98]'
  id: totrans-633
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: 'You will first need to set up your environment as usual:'
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE99]'
  id: totrans-635
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: Note
  id: totrans-636
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Some of the commands only work with a populated work directory, so you may need
    to remove the `rm_work` class if you want to use `bb`.
  id: totrans-637
  prefs: []
  type: TYPE_NORMAL
- en: 'Some of the tasks that are made easier by the `bb` utility are:'
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
- en: 'Exploring the contents of a package:'
  id: totrans-639
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE100]'
  id: totrans-640
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE100]'
- en: 'Searching for a pattern in the recipes:'
  id: totrans-641
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE101]'
  id: totrans-642
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE101]'
- en: 'Displaying either the global BitBake environment or the environment for a specific
    package and grepping for a specific variable:'
  id: totrans-643
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE102]'
  id: totrans-644
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE102]'
