- en: Chapter 5. Troubleshooting Users, Directories, and Files
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第五章：故障排除用户、目录和文件
- en: Unlike the previous subjects discussed so far, the process of troubleshooting
    users, directories, and files can be seen as a continual process that requires
    constant attention during the life time of the server. It will become an every
    day event, and for this reason, we will start with the basic principles of user
    management with the intention to show you how to restore the default file and
    folder permissions, recover lost files, and take you on a journey through many
    more associated themes in order to prepare you for a variety of issues that any
    professional troubleshooter may encounter.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 与之前讨论的主题不同，故障排除用户、目录和文件的过程可以看作是一个持续的过程，需要在服务器的生命周期中不断关注。它将成为日常事务，因此，我们将从用户管理的基本原则开始，目的是向你展示如何恢复默认的文件和文件夹权限，恢复丢失的文件，并带你走过许多相关主题，为你准备应对专业故障排除人员可能遇到的各种问题。
- en: 'In this chapter, we will:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将：
- en: Learn how to effectively manage the process of adding, deleting, modifying users,
    and implementing system-wide changes with `login.defs`
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何有效管理添加、删除、修改用户的过程，并使用`login.defs`实现系统范围的更改
- en: Discover how to monitor user activity with `utmpdump`
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何使用`utmpdump`监控用户活动
- en: Learn how to reset the root password and initiate root-based logging to achieve
    improved command-line security audits
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何重置 root 密码并启动基于 root 的日志记录，以实现更好的命令行安全审计
- en: Learn how to recover lost data with Scalpel
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何使用 Scalpel 恢复丢失的数据
- en: Learn how to restore default permissions and ownership
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何恢复默认的权限和所有权
- en: Discover more about the XFS filesystem by discovering how to run ongoing repairs
    and investigate defragmentation
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过了解如何进行持续修复和检查碎片整理，进一步探索 XFS 文件系统
- en: Learn how to audit directories and files
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何审计目录和文件
- en: Discover how to visualize directories and files
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何可视化目录和文件
- en: Users
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用户
- en: User management is a fundamental skill associated with the need to manage a
    server, and in this respect, it will inevitably represent a milestone when troubleshooting
    any system. So, with this in mind, we will quickly analyze the process of managing
    users in order to dispel any confusion.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 用户管理是与管理服务器相关的基础技能，在这方面，它无疑是解决任何系统问题时的一个里程碑。因此，考虑到这一点，我们将快速分析管理用户的过程，以消除任何困惑。
- en: Adding users and forcing a password change
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加用户并强制密码更改
- en: 'You can add a new user (and create a home folder for them) by using the following
    command:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用以下命令添加新用户（并为他们创建主目录）：
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You can provide the new user with a password like this:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以这样为新用户提供密码：
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Alternatively, if you would like to force a password reset, thereby implying
    that a user must reset his/her password, then the following command will suffice:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，如果你想强制重置密码，意味着用户必须重置其密码，那么以下命令就足够了：
- en: '[PRE2]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In addition, you can null a password for a specific user by typing:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你可以通过输入以下命令为特定用户取消密码：
- en: '[PRE3]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'However, if you would like to grant this new user the ability to use `sudo`,
    then type:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，如果你想授予新用户使用`sudo`的权限，那么请输入以下命令：
- en: '[PRE4]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Finally, if you would like to know more about a user, using the following command,
    will disclose their current properties:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，如果你想了解更多关于用户的信息，使用以下命令将显示他们当前的属性：
- en: '[PRE5]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Deleting users
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 删除用户
- en: 'The action of deleting a user account is generally straightforward, but it
    can involve a number of stages that can be forgotten. Therefore, to avoid any
    future issues across extensive systems with a large amount of users, prior to
    deleting a user from the system, the account should be locked in the following
    way:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 删除用户账户的操作通常是直接的，但它可能涉及多个容易被忽视的步骤。因此，为了避免在大规模用户系统中出现任何未来的问题，在删除用户之前，应先按以下方式锁定账户：
- en: '[PRE6]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You will then want to back up the home directory using `tar` before confirming
    if there are any active processes attributed to this account by typing:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，你需要使用`tar`备份用户的主目录，并通过输入以下命令来确认是否存在与该账户关联的活动进程：
- en: '[PRE7]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Having done this, you can now proceed to kill any active processes attributed
    to that account by using the following command:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些后，你现在可以通过以下命令结束与该账户关联的任何活动进程：
- en: '[PRE8]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Or, you can remove individual process IDs like this:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你可以像这样删除单独的进程 ID：
- en: '[PRE9]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: By using `pkill`, you are invoking the `SIGTERM` command, which will streamline
    the task of removing any active process associated with that account. So, at this
    stage, you should now consider removing any files, print jobs, and re-assign or
    delete any `cron` jobs associated with that account.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用`pkill`，您调用了`SIGTERM`命令，这将简化移除与该账户关联的任何活动进程的任务。因此，在这个阶段，您应该考虑移除任何文件、打印作业，并重新分配或删除与该账户关联的任何`cron`作业。
- en: 'You can do this by typing the following command:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过键入以下命令来执行此操作：
- en: '[PRE10]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Having done this, you can safely delete a user with:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些操作后，您可以安全地删除用户：
- en: '[PRE11]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Using the `-r` option will also remove the home directory associated with that
    account, but if you would like to delete the user, their home directory, and remove
    any `SELinux` mappings, you should use:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`-r`选项还会删除与该账户关联的主目录，但如果您希望删除用户、其主目录并移除任何`SELinux`映射，您应该使用：
- en: '[PRE12]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'However, if you encounter any difficulties, then you can always use the force
    option in the following way:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果遇到任何困难，您可以始终以以下方式使用强制选项：
- en: '[PRE13]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Finally, you will need to consider removing any SSH keys associated with that
    user. Ensure that `sudo` or `su` is not enabled for that account, and then proceed
    to work through your applications and services one at a time (including database,
    e-mail, file sharing, htaccess, web directories, CGI files, and more) while reassigning
    new settings to any common accounts that the system may use.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您需要考虑移除与该用户关联的任何SSH密钥。确保该账户没有启用`sudo`或`su`，然后逐一处理您的应用程序和服务（包括数据库、电子邮件、文件共享、htaccess、网页目录、CGI文件等），同时为系统可能使用的任何公共账户重新分配新的设置。
- en: Modifying a user
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 修改用户
- en: 'One of the most useful aspects of user management for a troubleshooter is being
    able to modify an existing user account. There could be many reasons as to why
    this task is required, but the best illustration of this skill would begin with
    changing the default `adduser` attributes in the following file:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 对于故障排除人员来说，用户管理的一个最有用的方面是能够修改现有的用户账户。可能有许多原因需要执行此任务，但最好的说明这种技能的方法是从修改以下文件中的默认`adduser`属性开始：
- en: '[PRE14]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: From here, you can redefine what shell is used, the default location of the
    home directories, and whether a default mail spool is set.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 从这里，您可以重新定义使用的shell、主目录的默认位置以及是否设置默认的邮件队列。
- en: 'For example, you can use this technique to change the default location of the
    home directories from `/home` to `/home/<companyname>`. However, if you prefer
    to do this manually (on a case-by-case basis), in order to change the location
    of the home directory, you need to use the `usermod` command in conjunction with
    the `-d` option (the path to the new directory) and the `-m` option (to move the
    contents of the current home directory), like this:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，您可以使用此技术将主目录的默认位置从`/home`更改为`/home/<公司名>`。然而，如果您更倾向于手动操作（逐个案例处理），为了更改主目录的位置，您需要使用`usermod`命令结合`-d`选项（新目录的路径）和`-m`选项（移动当前主目录的内容），如下所示：
- en: '[PRE15]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: When running the preceding command, it is important to realize that a PID will
    be displayed on the console if the user is currently using the system and this
    must be killed before any modifications can be made.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行上述命令时，重要的是要意识到，如果该用户正在使用系统，控制台上将显示一个PID，在进行任何修改之前，必须终止该进程。
- en: 'Finally, should the need arise to transfer an existing user to a different
    group, then this can be achieved by invoking the `-g` option like so:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，如果需要将现有用户转移到不同的组，可以通过调用`-g`选项来实现，如下所示：
- en: '[PRE16]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: However, having done this, and just as you would for deleting a user, you must
    manually change the ownership of any `crontab` files or jobs and complete the
    process by making any relevant changes to any remaining (related/existing) services
    as well.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，完成这些操作后，就像删除用户一样，您必须手动更改任何`crontab`文件或任务的所有权，并通过对任何剩余（相关/现有）服务进行必要的修改来完成该过程。
- en: Meet login.defs
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 了解login.defs
- en: When it comes to managing users, an alternative or long-term approach is to
    consider altering the default settings found in `/etc/login.defs` so that you
    can alter the behavior of the delete command.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在管理用户时，另一种替代方法或长期方法是考虑修改`/etc/login.defs`中找到的默认设置，这样您就可以更改删除命令的行为。
- en: 'For example, consider you find the following line commented out like this:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设您发现以下行被注释掉，如下所示：
- en: '[PRE17]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Uncomment this line and it will ensure that all `at/cron/print` jobs are removed.
    Moreover, you can also use the `login.defs` file to determine the default values
    assigned to the user mail directory, password encryption method, password expiry
    period, `userid`, `groupid`, and many more.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 取消注释这一行，它将确保移除所有`at/cron/print`任务。此外，你还可以使用`login.defs`文件来确定分配给用户邮件目录、密码加密方式、密码过期周期、`userid`、`groupid`等的默认值。
- en: Monitoring user activity with utmpdump
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用utmpdump监控用户活动
- en: Keeping track of user activity is one of the most essential skills associated
    with any Linux administrator. In situations where user management may be the cause
    of a troubleshooting session, we can make use of `utmpdump`.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪用户活动是任何Linux管理员最基本的技能之一。在需要解决与用户管理相关的故障排除问题时，我们可以使用`utmpdump`。
- en: 'User histories are typically stored in the following locations:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 用户历史通常存储在以下位置：
- en: '`/var/run/utmp`: The purpose of this binary is to record open sessions. You
    can review the contents of this file with `utmpdump /var/run/utmp`.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/run/utmp`：这个二进制文件的目的是记录打开的会话。你可以使用`utmpdump /var/run/utmp`查看该文件的内容。'
- en: '`/var/run/wtmp`: The purpose of this binary is to record connection histories.
    You can review the contents of this file with `utmpdump /var/log/wtmp`.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/run/wtmp`：这个二进制文件的目的是记录连接历史。你可以使用`utmpdump /var/log/wtmp`查看该文件的内容。'
- en: '`/var/log/btmp`. The purpose of this binary is to record failed login attempts.
    You can review the contents of this file with `utmpdump /var/log/btmp`.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/var/log/btmp`。这个二进制文件的目的是记录失败的登录尝试。你可以使用`utmpdump /var/log/btmp`查看该文件的内容。'
- en: 'Taking this one step further, you can also review the current history of logged
    sessions contained within `/var/run/wtmp` by typing:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 更进一步，你还可以通过输入以下命令来查看`/var/run/wtmp`中当前记录的会话历史：
- en: '[PRE18]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'You can review the current history of logged sessions contained within `/var/run/btmp`
    by typing:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过输入以下命令查看`/var/run/btmp`中当前记录的会话历史：
- en: '[PRE19]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'However, as a simple review of these files is slightly redundant for our needs,
    you can read the current status of these files with the following commands:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，鉴于对这些文件的简单查看对于我们的需求来说有些冗余，你可以使用以下命令查看这些文件的当前状态：
- en: '[PRE20]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The output of these commands may look similar to this:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 这些命令的输出可能类似于以下内容：
- en: '[PRE21]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Now, given that binary files cannot be viewed using basic reading commands
    such as `cat`, `less`, and `more`, rather than simply relying on basic commands
    such as `last`, `who`, `lastb`, and others, a different approach is to use the
    `utmpdump` command like this:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 由于二进制文件无法通过基本的阅读命令如`cat`、`less`和`more`进行查看，因此，除了简单依赖`last`、`who`、`lastb`等基本命令外，另一种方法是使用`utmpdump`命令，方式如下：
- en: '[PRE22]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'So, as we have already mentioned earlier, in the case of wanting to read `/var/run/utmp`,
    you can use the following command:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，如果你想读取`/var/run/utmp`，可以使用以下命令：
- en: '[PRE23]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'While the remaining files would be accessible with:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 而其余的文件可以通过以下方式访问：
- en: '[PRE24]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: So, having used all three commands, you will then notice that the output is
    in a familiar format with the most obvious difference being that the results of
    `wtmp` are displayed in reverse order as opposed to both `utmp` and `btmp` which
    are displayed in chronological order.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 使用完这三个命令后，你会注意到输出格式是熟悉的，最明显的区别是`wtmp`的结果按逆序显示，而`utmp`和`btmp`则按时间顺序显示。
- en: 'The results of `utmpdump` are formatted in the following way:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '`utmpdump`的结果格式如下：'
- en: The first column displays a session identifier; the value 7 is typically associated
    with a new login event, while the value 8 is associated with a logout event.
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一列显示会话标识符；值7通常与新登录事件关联，而值8则与登出事件关联。
- en: The second column displays a PID.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第二列显示PID。
- en: 'The third column can hold a relative variable based on either of the following:'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第三列可以根据以下任一条件包含一个相对变量：
- en: '`~~`, indicating a run-level or system reboot change'
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`~~`，表示运行级别或系统重启变化'
- en: '`bw`, or a bootwait process'
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bw`，或称为启动等待进程'
- en: A numeric or TTY value
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个数字或TTY值
- en: A character/digit that indicates a PTY value (the pseudo terminal).
  id: totrans-88
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个字符/数字，表示PTY值（伪终端）。
- en: The fourth column can sometimes remain empty or maintain an associated username,
    runlevel, or reboot value.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第四列有时可能为空，或者保留一个关联的用户名、运行级别或重启值。
- en: The fifth column (if this information is available), will display the TTY or
    PTY value.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第五列（如果该信息可用）将显示TTY或PTY值。
- en: The sixth column will display the identity of the remote host. In most local
    cases, you will only see a runlevel message at most, but for remote access, you
    will see an IP address or name.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第六列将显示远程主机的身份。在大多数本地情况下，你最多只会看到一个运行级别信息，但对于远程访问，你会看到IP地址或名称。
- en: The seventh column will display the remote host's IP address, or it will show
    0.0.0.0 for local access.
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第七列将显示远程主机的IP地址，或者如果是本地访问，则显示0.0.0.0。
- en: The eighth, and final column, will indicate the time and date information as
    to when the record was created.
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第八列（最后一列）将指示记录创建的时间和日期信息。
- en: You should also be aware that columns six and seven will show identical information
    if no DNS resolution is performed.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 你还应该注意，如果没有进行DNS解析，第六列和第七列将显示相同的信息。
- en: 'So, with the preceding information in mind, with a bit of practice, and using
    the skills we discovered in the previous chapters, `utmpdump` can be used to perform
    a wide range of queries such as displaying general access information like this:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，考虑到前述信息，通过一点练习，并使用我们在前几章中发现的技巧，`utmpdump`可以用来执行广泛的查询，例如显示像这样的常规访问信息：
- en: '[PRE25]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Further to this, you can use `grep` to show the details of specific records.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你可以使用`grep`显示特定记录的详细信息。
- en: 'For example, if you wanted to display the records of a particular user from
    `wtmp`, you will type:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你想显示某个特定用户的`wtmp`记录，你可以输入：
- en: '[PRE26]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Taking this one step further, you can use `grep` to identify the number of
    logins from a particular IP address in the following way:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 进一步来说，你可以使用`grep`以以下方式识别来自特定IP地址的登录次数：
- en: '[PRE27]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Or use the following syntax to check how many times root accessed the system:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 或者使用以下语法检查root访问系统的次数：
- en: '[PRE28]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Then use the following command to monitor the number of failed login attempts:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 然后使用以下命令来监视失败登录尝试的次数：
- en: '[PRE29]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Remember, the output of `btmp` should be minimal, given that this binary will
    show a variety of issues related to the use of incorrect passwords being used
    or attempts to log in with an unknown username. The latter of which is particularly
    important when a tty1 was shown to be used, as this will indicate that an unknown
    person had access to a terminal on your machine. Look at it this way, noticing
    such an important issue may inspire you to run a security audit on access privileges
    and keys by creating a basic text-based output file with the following command:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，`btmp`的输出应该是最小化的，因为这个二进制文件将显示与使用错误密码或尝试使用未知用户名登录相关的各种问题。特别是当tty1被显示为正在使用时，后者尤其重要，因为这表示一个未知的人访问了你机器上的终端。从这个角度来看，注意到这样一个重要问题可能会激发你运行安全审计，检查访问权限和密钥，通过以下命令创建一个基本的基于文本的输出文件：
- en: '[PRE30]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Resetting the root password and enhancing logging
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重置root密码并增强日志记录
- en: With the release of CentOS 7, you may find that the process of resetting the
    root password has changed. So, in the event that you forget the root password,
    you will need to follow these important steps.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 随着CentOS 7的发布，你可能会发现重置root密码的过程发生了变化。所以，如果你忘记了root密码，你需要按照这些重要步骤进行操作。
- en: 'Boot the computer and press the *E* key during the kernel screen phase. On
    the next screen, scroll down the text and look for the following line:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 启动计算机，并在内核屏幕阶段按*E*键。在下一个屏幕上，滚动文本并查找以下行：
- en: '[PRE31]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Now, replace the letters `ro` with the following:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，替换字母`ro`为以下内容：
- en: '[PRE32]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'It should then look like this:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 它应该看起来像这样：
- en: '[PRE33]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: When done, press *Control* + *X* or *Ctrl* + *X* to boot into the single user
    mode using the bash shell `/sysroot/bin/sh`.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，按*Control* + *X* 或 *Ctrl* + *X* 以使用bash shell `/sysroot/bin/sh`进入单用户模式。
- en: 'In the single user mode, type:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在单用户模式下，输入：
- en: '[PRE34]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'After the hash sign (`#`), type:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在井号（`#`）后，输入：
- en: '[PRE35]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Follow the onscreen instructions and proceed to reset the password, but if you
    do need to update `SELINUX` use the command `touch /.autorelabel` before you do
    anything else.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 按照屏幕上的指示进行操作，并继续重置密码，但如果你确实需要更新`SELINUX`，在做任何操作之前，使用命令`touch /.autorelabel`。
- en: 'When you are ready to finish, type the following command to access the machine
    in the usual way:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 当你准备好完成时，输入以下命令以按通常的方式访问机器：
- en: '[PRE36]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Now, reboot your system in the usual way:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，以通常的方式重新启动你的系统：
- en: '[PRE37]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Well done! You should now be able to gain full access to the system using the
    new root password. However, if you decide to update the logging for all system
    commands, simply open the following file in your favorite text editor like this:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 做得好！你现在应该能够使用新的root密码完全访问系统。然而，如果你决定更新所有系统命令的日志记录，只需在你喜欢的文本编辑器中打开以下文件：
- en: '[PRE38]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Scroll down to the bottom and add the following line:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 向下滚动到文件底部并添加以下行：
- en: '[PRE39]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Having done this, you will now find that all the SSH-based command-line activity
    is logged through `/var/log/messages` like this:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这一步后，你会发现所有基于SSH的命令行活动都被记录在`/var/log/messages`中，如下所示：
- en: '[PRE40]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Recovering lost or deleted files with Scalpel
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Scalpel恢复丢失或删除的文件
- en: 'If a file has been accidentally deleted from the system, you can use a small
    utility called Scalpel to recover it. Scalpel is a faster alternative to Foremost,
    which was originally developed by the United States Air Force Office of Special
    Investigations and The Center for Information Systems Security Studies and Research.
    Today, it is a tool that is generally associated with both digital forensics investigation
    and file recovery, and you can install it by typing the following command:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 如果文件不小心从系统中删除，你可以使用一个名为Scalpel的小工具来恢复它。Scalpel是Foremost的一个更快的替代工具，Foremost最初由美国空军特种调查办公室和信息系统安全研究中心开发。如今，它是一个通常与数字取证调查和文件恢复相关的工具，你可以通过键入以下命令来安装它：
- en: '[PRE41]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'You will need the EPEL repository to complete this process (which is discussed
    in a previous chapter), but when you are ready, simply update the following configuration
    file to determine what types of files you would like to search for:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要EPEL仓库来完成这个过程（这在前一章中讨论过），但是当你准备好时，只需更新以下配置文件，以确定你希望搜索哪些类型的文件：
- en: '[PRE42]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Having done this, you should now create a recovery directory, and then you
    should move to the `/etc` directory in order to use `scalpel.conf` like this:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这一步后，你应该创建一个恢复目录，然后转到`/etc`目录以使用`scalpel.conf`，如图所示：
- en: '[PRE43]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You can run a scan on a relevant device by customizing the following command:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过定制以下命令来扫描相关设备：
- en: '[PRE44]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'An example of the preceding command would look like this:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令的示例看起来像这样：
- en: '[PRE45]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Scalpel will begin by creating work queues, but be mindful that the entire operation
    will take some time to complete. In simple terms, the actual time taken to complete
    a scan will depend on the disk size, the number of deleted files, the power of
    the machine in general, and other activities that the system is currently performing.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: Scalpel将通过创建工作队列来开始，但请注意，整个操作需要一定的时间才能完成。简单来说，完成扫描所需的实际时间将取决于磁盘大小、删除文件的数量、机器的性能以及系统当前正在执行的其他活动。
- en: 'You can view the findings by using the `ls` command like this:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`ls`命令像这样查看结果：
- en: '[PRE46]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Finally, and before you get started, you should be aware that a new recovery
    directory must be created every time you run Scalpel (so you may want to consider
    using an alternative hard disk) as the results will be maintained by a single
    audit file.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在开始之前，你需要注意，每次运行Scalpel时都必须创建一个新的恢复目录（所以你可能需要考虑使用一个备用硬盘），因为结果将由一个单一的审计文件维护。
- en: 'This particular file can be viewed by typing:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过键入以下命令来查看这个特定文件：
- en: '[PRE47]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: Remember, Scalpel will work with a variety of filesystem formats or raw partitions,
    and in this respect, it can be seen as a very useful tool for any troubleshooter.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，Scalpel可以与各种文件系统格式或原始分区一起工作，从这个角度来看，它可以视为一个非常有用的故障排除工具。
- en: 'You can learn more about Scalpel by reviewing the manual like this:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过查看手册来了解更多关于Scalpel的内容，方法如下：
- en: '[PRE48]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: Restoring file and directory permissions
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 恢复文件和目录权限
- en: 'File and directory permissions are important, and to view the current state
    of all the files in a particular directory, you can run the following command:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 文件和目录权限非常重要，要查看特定目录中所有文件的当前状态，可以运行以下命令：
- en: '[PRE49]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Alternatively, you can target a particular directory by running:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你可以通过运行以下命令来定位特定目录：
- en: '[PRE50]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'However, in a situation where someone has mistakenly changed the permissions
    of a particular system-based file or folder this calamitous situation can be rectified
    with the following RPM-based commands:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在某个系统文件或文件夹的权限被误改的情况下，可以通过以下基于RPM的命令来修复这一灾难性情况：
- en: '[PRE51]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'On the other hand, should it be the case that an entire directory has been
    mistakenly updated with `chown` or the `chmod` commands, the following commands
    will prove more useful:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果整个目录被错误地使用 `chown` 或 `chmod` 命令更新，那么以下命令会更加有用：
- en: '[PRE52]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Based on the commands shown preceding, the first command will serve to reset
    all the file and folder ownerships values to the default state, while the second
    command will serve to reset the relative file permissions. So having run these
    commands, it is possible that you will see the following messages:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 根据前面显示的命令，第一个命令将重置所有文件和文件夹的所有权值到默认状态，而第二个命令将重置相对的文件权限。因此，在运行这些命令后，你可能会看到以下消息：
- en: '[PRE53]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: Don't worry! Regardless of which file or directory is listed, such notices can
    be safely ignored.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 不用担心！无论列出的是哪个文件或目录，这些通知都可以安全忽略。
- en: Working with and extending the XFS filesystem
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用和扩展 XFS 文件系统
- en: Originally developed at Silicon Graphics in 1993, the main purpose of XFS is
    to not only support the creation of large filesystems that will allow for metadata
    journaling, but to provide a technology that can be defragmented and enlarged
    while mounted and active. This information may or may not be of much use to you
    as a troubleshooter, but you should be aware that the default filesystem now employed
    by the most recent release of CentOS is known as XFS. If you did not customize
    the partitions to any great extent, then you may find that XFS is the filesystem
    you will be dealing with.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: XFS 最早于 1993 年由 Silicon Graphics 开发，其主要目的是不仅支持创建能够进行元数据日志记录的大型文件系统，还提供一种可以在挂载和活动状态下进行碎片整理和扩展的技术。作为故障排除者，这些信息对你可能没什么用，但你应该知道，最新版本的
    CentOS 默认使用的文件系统就是 XFS。如果你没有对分区进行过大的自定义，那么你可能会发现 XFS 是你需要处理的文件系统。
- en: 'You can quickly confirm the structure of your system with the following command:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过以下命令快速确认系统的结构：
- en: '[PRE54]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'The preceding command (the disk size and partitions ignored) can result in
    something similar to the following output:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令（忽略磁盘大小和分区）可能会产生类似于以下输出的结果：
- en: '[PRE55]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'The wording `xfs` under the column labeled `type` is what we are looking for.
    If it is found that your server does use the XFS filesystem, then the XFS tools
    and utilities file `xfsprogs.x86_64` can be installed with the following command:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 在标记为 `type` 的列下，如果出现 `xfs`，那就是我们要找的。如果发现服务器确实使用了 XFS 文件系统，那么可以使用以下命令安装 XFS 工具和实用程序文件
    `xfsprogs.x86_64`：
- en: '[PRE56]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Generally speaking, you should be aware that XFS can prove to be the source
    of a subtle loss of performance if the server system is relatively small. In these
    circumstances ext4 tends to be faster with some single threaded and metadata intensive
    workloads. Moreover, as shrinking support is not available to XFS, you should
    know that this technology does not allow the filesystem to be reduced in size
    even when un-mounted. For this reason, you may want to stay with ext4 when big
    filesystems or big files are not required.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，你应该了解，如果服务器系统相对较小，XFS 可能会导致性能轻微下降。在这些情况下，ext4 在一些单线程和元数据密集型工作负载下通常会更快。此外，由于
    XFS 不支持缩小，你应该知道，即使在未挂载时，该技术也不允许文件系统缩小。因此，当不需要大文件系统或大文件时，你可能会选择继续使用 ext4。
- en: 'Looking at the bigger picture, you will be comforted to know that the basic
    syntax required to create an XFS is similar to other filesystems:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 从更广泛的角度来看，你会感到宽慰，因为创建 XFS 所需的基本语法与其他文件系统相似：
- en: '[PRE57]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: So, no surprises there, and due to the similarities with other filesystems,
    I will assume that you are comfortable completing the rest of this procedure.
    However, before you begin, you should always be aware of the server's hardware
    configuration before starting this operation, as there may be a few notable issues
    you may want to be aware of before concluding this operation.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，没什么意外的，而且由于与其他文件系统的相似性，我假设你可以舒适地完成这整个过程。然而，在你开始之前，应该始终了解服务器的硬件配置，因为在开始操作之前，可能会有一些你需要注意的显著问题。
- en: For example, let's say the server exceeded 2 TB. So having completed the initial
    `fdisk` operations to build the filesystem layout, (prior to mounting) you may
    decide to benchmark the system because every good troubleshooter knows that XFS
    enables write barriers to ensure filesystem integrity.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设服务器超过了 2 TB。所以，在完成初步的 `fdisk` 操作以构建文件系统布局后（挂载之前），你可能会决定对系统进行基准测试，因为每个优秀的故障排除者都知道
    XFS 启用了写入屏障，以确保文件系统的完整性。
- en: 'You can achieve this simple operation by typing:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过输入以下命令来完成这个简单的操作：
- en: '[PRE58]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: By default, write barriers will serve to preserve the filesystem from issues
    relating to power failure, resets, and system crashes, but if your hardware maintains
    a good write cache, then it may seem more prudent to disable the write barrier
    in order to reduce the impact on performance.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，写入屏障将有助于保护文件系统免受电源故障、重置和系统崩溃等问题的影响，但如果你的硬件具有良好的写入缓存，可能更明智的做法是禁用写入屏障，以减少对性能的影响。
- en: 'In this respect, you can mount the device in the following way:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在这方面，你可以通过以下方式挂载设备：
- en: '[PRE59]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'On completion, you can always request further information about a specific
    volume with the following syntax:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，你可以始终使用以下语法请求有关特定卷的更多信息：
- en: '[PRE60]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: So as we can see, XFS does come with a lot of good features and tools, but when
    it comes to the process of troubleshooting a server, it is precisely these differences
    that could be the cause of the problem.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所看到的，XFS 确实有许多优秀的功能和工具，但在排查服务器问题时，正是这些差异可能会成为问题的根源。
- en: 'In this respect, and as we will now see, XFS should be treated in a different
    way to a comparable ext3- or ext4-based system. However, if you need to extend
    the filesystem, then you will be happy to know that XFS comes complete with a
    standard tool known as `xfs_growfs` that can be used in the following way:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在这方面，正如我们现在看到的，XFS 应该与类似的基于 ext3 或 ext4 的系统有所不同对待。然而，如果你需要扩展文件系统，那么你会高兴地发现，XFS
    配备了一种名为 `xfs_growfs` 的标准工具，可以通过以下方式使用：
- en: '[PRE61]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Assuming that you have reviewed the man pages, it would be obvious to state
    that your syntax would use the `-d` option in order to grow the filesystem to
    the maximum size supported by the device.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你已经查看了 man 页，显然可以指出，你的语法会使用 `-d` 选项来将文件系统扩展到设备所支持的最大大小。
- en: Running repairs on XFS
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 对 XFS 进行修复
- en: XFS was created with the intention to support extremely large filesystems. It
    performs incredibly well under a heavy load and scales with large files, but as
    a result, it is also susceptible to damage, and it is with this in mind that we
    now consider a set of tools that will enable us to troubleshoot the server and
    restore the filesystem.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: XFS 是为了支持极大的文件系统而创建的。在高负载下，它表现得非常出色，并且能够扩展大文件，但也因此更容易受到损坏。正因为如此，我们现在考虑一组工具，帮助我们排查服务器问题并恢复文件系统。
- en: Known as `xfs_repair`, this tool is used to confirm filesystem consistency and
    repair any problems that are found. This process will not restore lost data, but
    it should restore the filesystem on the device in question.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 这个被称为 `xfs_repair` 的工具，用于确认文件系统的一致性并修复发现的问题。这个过程不会恢复丢失的数据，但应该可以恢复相关设备上的文件系统。
- en: 'The basic syntax used by `xfs_repair` is as follows:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '`xfs_repair` 使用的基本语法如下：'
- en: '[PRE62]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'However, to avoid any error messages, the procedure will then require that
    you should initially `umount` the device in question. In this respect, the entire
    procedure will be as follows:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，为了避免任何错误信息，该过程需要你首先 `umount` 相关设备。整个过程如下所示：
- en: '[PRE63]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: The resulting output will then proceed to run through a series of phases and
    confirm the relevant events. Once complete, simply remount the device in the usual
    way to complete the task. However, on the chance that `xfs_repair` fails, repeat
    this process again but do your research on the respective error messages.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 结果输出将继续经过一系列阶段，并确认相关事件。完成后，只需按常规方式重新挂载设备以完成任务。然而，如果 `xfs_repair` 失败，请再次重复此过程，并对相关错误信息进行研究。
- en: If `xfs_repair` fails to fix the consistency problems on a third occasion, depending
    on the error messages, you may want to consider an alternative rescue plan for
    the server, as it should be assumed that data recovery can only be made from backups.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `xfs_repair` 第三次未能修复一致性问题，依据错误信息，你可能需要考虑为服务器制定一个替代的救援计划，因为应该假设数据恢复只能通过备份来完成。
- en: Note
  id: totrans-197
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Having said that, it is possible that you can consider additional steps to recover
    the device in question.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，你也可以考虑采取额外的步骤来恢复相关设备。
- en: At this current stage, you should assume that data recovery can only be made
    from backups and your plan is now based on the recovery of the filesystem only.
    However, having said this, it is important to remember that you should not take
    any action that will impact the production environment.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在当前阶段，你应该假设数据恢复只能通过备份进行，你的计划现在是基于仅恢复文件系统。然而，值得记住的是，你不应采取任何可能影响生产环境的操作。
- en: It may be possible to restore files from the disk by backing up and restoring
    the files on the filesystem. To do this, mount the filesystem in the read-only
    mode and proceed to make a backup with `xfsdump`. From this point onwards, you
    will want to remake the partition and restore the files with `xfsrestore`. Check
    `man xfsdump` and `man xfsrestore` for further details.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 通过备份和恢复文件系统上的文件，可能能够从磁盘恢复文件。要做到这一点，请以只读模式挂载文件系统，然后使用`xfsdump`进行备份。从此以后，你需要重新创建分区并使用`xfsrestore`恢复文件。有关详细信息，请查阅`man
    xfsdump`和`man xfsrestore`。
- en: Alternatively, if log recovery is unsuccessful, it may be possible to recover
    some of the data by mounting the filesystem in the read-only mode with the `no
    recover` option. This will avoid running the log recovery process but, by using
    this method, the filesystem is unlikely to be consistent, and it is to be expected
    that not all of the data will be returned.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，如果日志恢复失败，可能可以通过以只读模式挂载文件系统，并使用`no recover`选项来恢复部分数据。这将避免运行日志恢复过程，但使用这种方法，文件系统可能不一致，并且无法保证所有数据都会恢复。
- en: 'The `xfs_repair` utility is designed to repair filesystems. It is size independent
    (treating both large and small filesystems equally), but unlike other repair tools,
    it will not run at boot and it will only initiate logging at mount in order to
    ensure a consistent filesystem. In cases where `xfs_repair` encounters a damaged
    log file, it will not be able to repair the filesystem, so in the event that this
    does happen, you will need to clear the relevant log, mount and then un-mount
    the XFS filesystem, which is done by adding the `-L` option to force log zeroing
    like this:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '`xfs_repair`工具用于修复文件系统。它与文件系统的大小无关（无论大文件系统还是小文件系统都一样处理），但与其他修复工具不同，它不会在启动时运行，并且只会在挂载时启动日志记录，以确保文件系统的一致性。如果`xfs_repair`遇到损坏的日志文件，它将无法修复文件系统，因此如果发生这种情况，你需要清除相关日志，挂载然后卸载
    XFS 文件系统，这可以通过添加`-L`选项来强制清零日志，如下所示：'
- en: '[PRE64]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: Remember, resetting the log can leave the filesystem in an inconsistent state.
    This can, and generally does, result in the loss of data and/or data corruption.
    So, only apply these methods with the intention to restore the filesystem alone.
    Remember, the `xfs_repair` command is not intended to restore the data on that
    filesystem.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，重置日志可能会导致文件系统处于不一致状态。这通常会导致数据丢失和/或数据损坏。因此，只应在仅打算恢复文件系统的情况下应用这些方法。记住，`xfs_repair`命令并非用于恢复该文件系统上的数据。
- en: Investigating fragmentation on XFS
  id: totrans-205
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调查 XFS 上的碎片化
- en: 'In situations where the filesystem is acting sluggishly, it is possible that
    fragmentation is impacting your server. In this instance, and if you suspect that
    fragmentation has occurred or is occurring, then simply run the following command
    on the relevant device:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 在文件系统运行缓慢的情况下，可能是碎片化影响了你的服务器。在这种情况下，如果你怀疑发生了或正在发生碎片化，可以在相关设备上运行以下命令：
- en: '[PRE65]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'By using this command, we are causing `xfs_db` to open the filesystem in a
    read-only mode (`-r` option) and passing a command (`-c` option) to get the file
    fragmentation data (`frag`) for the device in question. When we use the `frag`
    command, it will only return information relevant to the file data in the filesystem
    as opposed to concerning itself with the fragmentation of free space. So, depending
    on the specific nature of your system, the resulting output could look similar
    to this:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此命令时，我们让`xfs_db`以只读模式（`-r`选项）打开文件系统，并传递一个命令（`-c`选项）来获取该设备的文件碎片数据（`frag`）。当我们使用`frag`命令时，它只会返回与文件数据相关的信息，而不会关注空闲空间的碎片化。因此，根据系统的具体情况，输出结果可能如下所示：
- en: '[PRE66]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'In a more severe case, it could report the following output:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在更严重的情况下，它可能会报告以下输出：
- en: '[PRE67]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'By drawing your attention to the fragmentation factor (expressed as a percentage)
    in the preceding examples, you may have found at least one reason as to why your
    server requires troubleshooting. Fixing this situation would be a matter of calling
    the filesystem organizer utility, otherwise known as `xfs_fsr`. We would simply
    require the system to reorganize our partition or device to optimize disk usage
    in a similar way to a Microsoft Windows desktop. In this respect, the most basic
    syntax for using `xfs_fsr` would be as follows:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将你的注意力引导到前面示例中的碎片因素（以百分比表示），你可能已经找到了至少一个需要故障排除的原因。修复这种情况只需要调用文件系统重组工具，也就是
    `xfs_fsr`。我们只需要系统重组我们的分区或设备，以类似于 Microsoft Windows 桌面的方式优化磁盘使用。在这方面，使用 `xfs_fsr`
    的最基本语法如下：
- en: '[PRE68]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Whereas, for a single file, you can use:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 而对于单个文件，你可以使用：
- en: '[PRE69]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'However, given that the period of time for these events to complete can be
    quite long, a more succinct use of this command would be to specify a list of
    filesystems to reorganize (`-m`), a time option `-t` calculated in seconds, and
    the verbose option `-v` for a clear indication of what is happening, as follows:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，考虑到这些事件完成的时间可能相当长，这个命令的更简洁用法是指定一个要重组的文件系统列表（`-m`），一个以秒为单位计算的时间选项 `-t`，以及一个详细选项
    `-v`，以清晰指示发生的情况，如下所示：
- en: '[PRE70]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'The corresponding output will then display the number of extents that are both
    before and after the inode. By default, `xfs_fsr` will make ten passes before
    completing the process unless you decide to reduce the number of passes by using
    the option `-p` like this:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 对应的输出将显示 inode 前后范围的数量。默认情况下，`xfs_fsr` 会在完成过程之前执行十次遍历，除非你决定使用选项 `-p` 来减少遍历次数，如下所示：
- en: '[PRE71]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'You should be aware that `xfs_fsr` should not be used to defragment the whole
    system as this is generally regarded to be unnecessary as it can give rise to
    free space fragmentation, so you can complete this task in stages in the knowledge
    that the operation can be interrupted cleanly. This will leave the filesystem
    in a consistent state. If you interrupt the process (using *Ctrl* + *C*), `xfs_fsr`
    will save the defragmentation process to the following location:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该知道，`xfs_fsr` 不应被用来碎片整理整个系统，因为这通常被认为是不必要的，它可能导致空闲空间碎片化，因此你可以分阶段完成此任务，并知道操作可以被干净地中断。这样将保持文件系统的一致性。如果你中断了过程（使用
    *Ctrl* + *C*），`xfs_fsr` 会将碎片整理过程保存到以下位置：
- en: '[PRE72]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: However, before you dive in, the real issue here is that this fragmentation
    issue should be approached with caution on a live system, as proceeding to defragment
    a device or partition during periods of high-load will place an unnecessary burden
    on your server. So in this instance, the best course of action is to run `xfs_fsr`
    at a time when the relevant device or partition is not at full load or during
    lighter working periods.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在你深入了解之前，真正需要注意的问题是，应该小心谨慎地在实时系统上处理碎片问题，因为在高负载期间对设备或分区进行碎片整理将给你的服务器带来不必要的负担。因此，在这种情况下，最好的做法是在相关设备或分区未满载或在较轻工作负荷期间运行
    `xfs_fsr`。
- en: 'Finally, and having completed the process of defragmentation, you can confirm
    the extent of the work performed with the following command:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在完成碎片整理过程后，你可以使用以下命令确认已完成的工作量：
- en: '[PRE73]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: So having completed these simple actions, or necessitated a future (and possibly
    repeat) cron job, you should now notice an immediate improvement with regard to
    the speed at which files and folders can be moved and transferred.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在完成这些简单操作后，或需要未来的（并可能是重复的）定时任务，你应该能立即注意到文件和文件夹移动及传输速度的改善。
- en: Auditing directories and files
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 审计目录和文件
- en: 'An important task related to troubleshooting can arise from an understanding
    of activities commonly associated with the action of reading and writing files.
    CentOS 7 provides a simple utility for this. Known as `auditd`, this service (or
    daemon) starts during the boot process. Events are recorded to an associated log
    file found at `/var/log/audit` and as it runs in the background, you can check
    the current service status with:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 处理故障排除的一个重要任务可以来自于对与文件读写操作相关的活动的理解。CentOS 7 提供了一个简单的实用工具。这个工具称为 `auditd`，它在启动过程中启动。事件会记录到一个关联的日志文件，位于
    `/var/log/audit`，并且由于它在后台运行，你可以通过以下命令检查当前服务状态：
- en: '[PRE74]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'It is possible to customize the auditing service and you can have direct access
    to manage the log file size, location, and associated attributes by accessing
    the following file with your favorite text editor:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 审计服务是可以自定义的，你可以通过访问以下文件，并使用你喜欢的文本编辑器，直接管理日志文件的大小、位置和相关属性：
- en: '[PRE75]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Moreover, if you do not wish to lose any auditing data, you are able to disable
    the machine when an audit cannot be performed. To do this, open the configuration
    file `auditd.conf` and add or modify the following lines:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，如果你不希望丢失任何审计数据，你可以在无法执行审计时禁用机器。为此，打开配置文件 `auditd.conf`，并添加或修改以下几行：
- en: '[PRE76]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: This action is severe and it is not something to jump into without doing your
    homework, but it will serve to remove the default action of rotating log files
    and replace it with an instruction to e-mail the root user.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 这个操作很严重，在没有做好充分准备的情况下不建议贸然进行，但它会移除旋转日志文件的默认操作，并用发送电子邮件给 root 用户的指令来替代。
- en: 'Finally, should you wish to take advantage of the audit service flag for every
    process, simply open `/etc/default/grub` and add the following argument to the
    kernel line:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，如果你希望对每个进程利用审计服务标志，只需打开 `/etc/default/grub` 并将以下参数添加到内核行：
- en: '[PRE77]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'Remember to regenerate grub with the following command and reboot:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 记得使用以下命令重新生成 grub 并重启：
- en: '[PRE78]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'This will ensure that an auditable flag is set for every process after the
    boot sequence has been initiated and, for even greater simplicity, we can then
    consider building a unique set of rules by editing the following file:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 这将确保在启动序列启动后，每个进程都设置一个可审计的标志，为了更简便，我们可以通过编辑以下文件来构建一套独特的规则：
- en: '[PRE79]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'To make this as easy as possible, the best approach is to find your server''s
    `stig.rules` file at `/usr/share/doc/audit-X.X.X/stig.rules` and copy it to `/etc/audit/rules.d/audit.rules`.
    Based on the current package version (in my case), the `stig.rules` file can be
    found at `/usr/share/doc/audit-2.3.3/stig.rules`. Consequently, I ran the following
    command to create a default rule set:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简化操作，最好的方法是找到服务器的 `stig.rules` 文件，路径为 `/usr/share/doc/audit-X.X.X/stig.rules`，并将其复制到
    `/etc/audit/rules.d/audit.rules`。根据当前的包版本（以我为例），`stig.rules` 文件可以在 `/usr/share/doc/audit-2.3.3/stig.rules`
    找到。因此，我运行了以下命令来创建默认规则集：
- en: '[PRE80]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'So, having customized the rules and restarted the `auditd` service, you will
    discover that a query can be initiated with the following syntax:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在自定义规则并重启 `auditd` 服务后，你会发现可以使用以下语法发起查询：
- en: '[PRE81]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'As an alternative to this, you can use `aureport` to produce a series of audits
    in the following way:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 作为替代方案，你可以使用 `aureport` 以以下方式生成一系列审计：
- en: 'To monitor unusual behavior, you can use:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 要监控异常行为，可以使用：
- en: '[PRE82]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'To build a report on user logins, you can use:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 要构建用户登录报告，可以使用：
- en: '[PRE83]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'To review access violations, you can try:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 要审查访问违规行为，可以尝试：
- en: '[PRE84]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Finally, to review anomalies, you can use:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，要查看异常情况，可以使用：
- en: '[PRE85]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'Of course, we haven''t covered every aspect of the auditing service, but the
    preceding examples should get you started. Remember, all of the examples shown
    can be added to a cron job and, should you wish to know more, the `aureport` manual
    can always be viewed any time by typing:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，我们没有涵盖审计服务的每个方面，但前面的示例应该能帮助你入门。记住，所有示例都可以添加到 cron 作业中，如果你想了解更多内容，可以随时通过输入以下命令查看
    `aureport` 手册：
- en: '[PRE86]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: Visualizing directories and files
  id: totrans-255
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可视化目录和文件
- en: Good administration starts with good housekeeping, and for this reason, the
    maintenance of detailed records regarding your server's layout is generally considered
    to be a good starting point for any Linux administrator. Such a task not only
    allows you to keep abreast of any changes made to the system as a whole, but it
    can be a useful approach to debugging. Moreover, because you may have inherited
    this system, or shared access with a number of administrators, it is probably
    a good idea to consider running an up-to-date inventory of the changes made.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 良好的管理始于良好的家务处理，因此，维护关于服务器布局的详细记录通常被认为是任何 Linux 管理员的良好起点。这项任务不仅能让你随时了解系统整体所做的更改，还可以作为调试的有效方法。此外，因为你可能继承了这个系统，或者和其他管理员共享访问权限，因此考虑运行一次最新的更改清单可能是个好主意。
- en: All directories, folders, and files accessible to a specific Linux-based system
    are arranged in a single tree. Starting from root (`/`), this hierarchy may consist
    of either local or remote files, local or remote filesystem(s), and local or remote
    block devices.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 所有可以访问的目录、文件夹和文件都会以树状结构排列在一个特定的基于 Linux 的系统中。从根目录 (`/`) 开始，这个层次结构可能包含本地或远程文件、本地或远程文件系统，以及本地或远程块设备。
- en: 'To view this tree, simply ensure that you have installed the following package:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看此树，只需确保你已经安装了以下软件包：
- en: '[PRE87]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: 'By default, the `tree` command will begin indexing from your current location,
    so to begin, simply change your location to the boot directory like this:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`tree` 命令将从当前位置开始索引，因此首先，只需将位置更改为启动目录，如下所示：
- en: '[PRE88]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'Now, run the following command:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，运行以下命令：
- en: '[PRE89]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: 'The `tree` command is technically described as *a recursive directory listing
    command* that displays the content of your server in a tree-like format. It is
    highly customizable, so if you prefer to target a specific directory from your
    current location, you can use:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: '`tree` 命令在技术上被描述为 *递归目录列表命令*，它以树状格式显示服务器的内容。它高度可定制，因此如果你希望从当前位置指定一个特定目录，可以使用：'
- en: '[PRE90]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'You may have noticed that the tree command does not show hidden files by default.
    Therefore, in order to see all files (including all hidden files), use the `-a`
    option like this:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能已经注意到，`tree` 命令默认不会显示隐藏文件。因此，为了查看所有文件（包括所有隐藏文件），请使用 `-a` 选项，如下所示：
- en: '[PRE91]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'However, if you would like the tree function to restrict itself to displaying
    folder names only, you should use the `-d` option like this:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果你希望 `tree` 功能仅显示文件夹名称，你应该使用 `-d` 选项，如下所示：
- en: '[PRE92]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'If it all looks a little plain and ordinary, you can add some color to the
    output with the `-C` option like this:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切看起来有些平凡无奇，你可以通过 `-C` 选项为输出添加一些颜色，如下所示：
- en: '[PRE93]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: 'Finally, you can combine the preceding options to print the output to a text
    file by typing:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你可以将之前的选项组合起来，通过输入以下命令将输出打印到文本文件中：
- en: '[PRE94]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'For example, if you wanted to maintain a list of files in one or more directories
    showing the current permissions, you can use the `-p` option like this:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你想维护一个列出当前权限的文件清单，可以使用 `-p` 选项，如下所示：
- en: '[PRE95]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 'Alternatively, if you would prefer to display the output with embedded HTML
    code for export, try:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，如果你更愿意显示嵌入了 HTML 代码的输出以便导出，可以尝试：
- en: '[PRE96]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: 'So, regardless of whether you have adopted a new server, or you are troubled
    by the number of users accessing and writing files to that server, the `tree`
    function provides a relative solution to keeping a visual audit of your server,
    or your devices, by typing:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，无论你是采用了新服务器，还是被访问并写入文件的用户数量所困扰，`tree` 功能提供了一个相对的解决方案，可以通过输入以下命令来保持对你的服务器或设备的可视化审计：
- en: '[PRE97]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'So why not combine this with a cron job? Then you can regularly keep an eye
    on the rise of any potential problems or even maintain a visual record of when
    those changes took place. In this respect you could assert that the `tree` package
    is a very useful tool, and to learn more you can review the manual at any time
    by typing:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 那为什么不把它与定时任务（cron job）结合使用呢？这样你就可以定期监控潜在问题的出现，甚至保持一个视觉记录，了解这些变化何时发生。从这个角度看，你可以断言
    `tree` 软件包是一个非常有用的工具，要了解更多，你可以随时通过输入以下命令查看手册：
- en: '[PRE98]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: Summary
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have approached a number of topics related to users, directories,
    and files, while introducing some related themes associated with the release of
    the XFS filesystem. From forcing password changes to visualizing the directory
    structure, restoring the root password to understanding the need for disk defragmentation,
    our pursuit of troubleshooting CentOS 7 has gone some way to show that the knowledge
    gained from resolving fundamental system-based issues directly relate to the ongoing
    human-based issues. It would be true to say that you can never rehearse a disastrous
    scenario because every event may be unique to one or more systems but, as we have
    seen, regardless of whether you are monitoring users, modifying users, recovering
    data, or maintaining the filesystem as a whole, by following a few simple procedures,
    much of those file, directory, and user-based issues can be solved quickly and
    efficiently; which leads us gently towards the subject of troubleshooting shared
    resources.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了与用户、目录和文件相关的多个主题，同时介绍了与 XFS 文件系统发布相关的一些主题。从强制更改密码到可视化目录结构，从恢复 root
    密码到理解磁盘碎片整理的必要性，我们对 CentOS 7 故障排除的探索表明，解决系统基础问题所获得的知识与持续的人为问题密切相关。可以说，你永远无法预演一个灾难性场景，因为每个事件可能是独特的，可能仅适用于一个或多个系统，但正如我们所看到的，无论你是在监控用户、修改用户、恢复数据，还是在维护整个文件系统，通过遵循一些简单的步骤，许多与文件、目录和用户相关的问题都可以快速有效地解决；这也自然引导我们进入了共享资源故障排除的话题。
- en: References
  id: totrans-284
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考资料
- en: 'The Red Hat customer portal: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/)'
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Red Hat 客户门户: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/)'
- en: 'The Tree Project home page: [http://mama.indstate.edu/users/ice/tree/](http://mama.indstate.edu/users/ice/tree/)'
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Tree 项目主页: [http://mama.indstate.edu/users/ice/tree/](http://mama.indstate.edu/users/ice/tree/)'
- en: 'XFS FAQ: [http://xfs.org/index.php/XFS_FAQ](http://xfs.org/index.php/XFS_FAQ)'
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'XFS 常见问题解答: [http://xfs.org/index.php/XFS_FAQ](http://xfs.org/index.php/XFS_FAQ)'
- en: 'The XFS user guide: [http://xfs.org/docs/xfsdocs-xml-dev/XFS_User_Guide//tmp/en-US/html/index.html](http://xfs.org/docs/xfsdocs-xml-dev/XFS_User_Guide//tmp/en-US/html/index.html)'
  id: totrans-288
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'XFS 用户指南: [http://xfs.org/docs/xfsdocs-xml-dev/XFS_User_Guide//tmp/en-US/html/index.html](http://xfs.org/docs/xfsdocs-xml-dev/XFS_User_Guide//tmp/en-US/html/index.html)'
- en: 'The Red Hat XFS guide: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/ch-xfs.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/ch-xfs.html)'
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Red Hat XFS 指南: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/ch-xfs.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/ch-xfs.html)'
- en: 'The XFS wiki page: [http://en.wikipedia.org/wiki/XFS](http://en.wikipedia.org/wiki/XFS)'
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'XFS 维基页面: [http://en.wikipedia.org/wiki/XFS](http://en.wikipedia.org/wiki/XFS)'
