<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;1.&#xA0;Cluster Basics and Installation on CentOS 7" id="DB7S1-1d2c6d19b9d242db82da724021b51ea0"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01" class="calibre1"/>Chapter 1. Cluster Basics and Installation on CentOS 7</h1></div></div></div><p class="calibre8">In this chapter, we will introduce the basic principles of clustering and show how to set up two Linux servers as members of a cluster, step by step.</p><p class="calibre8">As part of this process, we will install the CentOS 7 Linux distribution from scratch, along with the necessary packages, and finally configure key-based authentication for SSH access from one computer to the other. All commands, except if noted otherwise, must be run as root and are indicated by a leading <code class="email">$</code> sign throughout this book.</p></div>

<div class="book" title="Chapter&#xA0;1.&#xA0;Cluster Basics and Installation on CentOS 7" id="DB7S1-1d2c6d19b9d242db82da724021b51ea0">
<div class="book" title="Clustering fundamentals"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch01lvl1sec08" class="calibre1"/>Clustering fundamentals</h1></div></div></div><p class="calibre8">In <a id="id0" class="calibre1"/>computer science, a cluster consists of a group of computers (with each computer referred to as a <span class="strong"><strong class="calibre2">node</strong></span><a id="id1" class="calibre1"/> or <span class="strong"><strong class="calibre2">member</strong></span>) that work together so that the set is seen as a single system from the outside.</p><p class="calibre8">The enterprise<a id="id2" class="calibre1"/> and science environments often require high computing power to analyze massive amounts of data produced every day, and redundancy. In order for the results to be always available to people either using those services or managing them, we rely on the high availability and performance of computer systems. The need of Internet websites, such as those used by banks and other commercial institutions, to perform well when under a significant load is a clear example of the advantages of using clusters.</p><p class="calibre8">There are two typical cluster setups. The first one involves assigning a different task to each node, thus achieving a higher performance compared with several tasks being performed by a single member on its own. Another classic use of clustering is to help ensure high availability by providing failover capabilities to the set where one node may automatically replace a failed member to minimize the downtime of one or several critical services. In either case, the concept of clustering implies not only taking advantage of the computing functionality of each member alone, but also maximizing it by complementing it with the others.</p><p class="calibre8">This type of cluster setup is called <span class="strong"><strong class="calibre2">high availability</strong></span> (<span class="strong"><strong class="calibre2">HA</strong></span>), and it aims to eliminate system downtime<a id="id3" class="calibre1"/> by failing over services from one node to another in case one of them experiences an issue that renders it inoperative. As opposed to switchover, which requires human intervention, a failover procedure is performed<a id="id4" class="calibre1"/> automatically by the cluster without any downtime. In other words, this operation is transparent to end users and clients from outside the cluster.</p><p class="calibre8">The second setup uses its nodes to perform operations in parallel in order to enhance the performance<a id="id5" class="calibre1"/> of one or more applications, and is called a <span class="strong"><strong class="calibre2">high-performance cluster</strong></span> (<span class="strong"><strong class="calibre2">HPC</strong></span>). HPCs are typically seen in scenarios involving applications and processes that use large collections of data.</p></div></div>

<div class="book" title="Chapter&#xA0;1.&#xA0;Cluster Basics and Installation on CentOS 7" id="DB7S1-1d2c6d19b9d242db82da724021b51ea0">
<div class="book" title="Clustering fundamentals">
<div class="book" title="Why Linux and CentOS 7?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec07" class="calibre1"/>Why Linux and CentOS 7?</h2></div></div></div><p class="calibre8">As mentioned<a id="id6" class="calibre1"/> earlier, we will build a cluster with two machines<a id="id7" class="calibre1"/> running Linux. This choice is supported by the fact that this<a id="id8" class="calibre1"/> involves low costs and stability associated with this setup—no paid<a id="id9" class="calibre1"/> operating system or software licenses, along with the possibility of running Linux on systems with small resources (such as a Raspberry Pi or relatively old hardware). Thus, we can set up a cluster with very little resources or money.</p><p class="calibre8">We will begin our own journey toward clustering by setting up the separate nodes that will make up our system. Our choice of operating system is Linux and CentOS version 7, as the distribution, which is the latest available release of CentOS as of now. The binary compatibility with Red Hat Enterprise Linux © (which is one of the most well-used distributions in enterprise and scientific environments) along with its well-proven stability are the reasons behind this decision.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note02" class="calibre1"/>Note</h3><p class="calibre8">CentOS 7 is<a id="id10" class="calibre1"/> available for download, free of charge, from the project's<a id="id11" class="calibre1"/> web site at <a class="calibre1" href="http://www.centos.org/">http://www.centos.org/</a>. In addition to this, specific details about the release can always be consulted in release notes available through the CentOS wiki, <a class="calibre1" href="http://wiki.centos.org/Manuals/ReleaseNotes/CentOS7">http://wiki.centos.org/Manuals/ReleaseNotes/CentOS7</a>.</p></div></div></div></div>

<div class="book" title="Chapter&#xA0;1.&#xA0;Cluster Basics and Installation on CentOS 7" id="DB7S1-1d2c6d19b9d242db82da724021b51ea0">
<div class="book" title="Clustering fundamentals">
<div class="book" title="Downloading CentOS"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch01lvl2sec08" class="calibre1"/>Downloading CentOS</h2></div></div></div><p class="calibre8">To <a id="id12" class="calibre1"/>download <a id="id13" class="calibre1"/>CentOS, go to <a class="calibre1" href="http://www.centos.org/download/">http://www.centos.org/download/</a> and click on one of the three options outlined in the following screenshot:</p><div class="mediaobject"><img src="../images/00002.jpeg" alt="Downloading CentOS" class="calibre10"/></div><p class="calibre11"> </p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre2">DVD ISO</strong></span>: This is an <code class="email">.iso</code> file (~4 GB) that can be written into regular DVD optical media and includes the common tools. Download this file if you have permanent access to a reliable Internet connection that you can use to download other packages and utilities later.</li><li class="listitem"><span class="strong"><strong class="calibre2">Everything ISO</strong></span>: This is an <code class="email">.iso</code> file (~7 GB) with the complete set of packages made available in the base repository of CentOS 7. Download this file if you do not have access to a permanent Internet connection or if your plan contemplates the possibility of installing or populating a local or network mirror.</li><li class="listitem"><span class="strong"><strong class="calibre2">alternative downloads</strong></span>: This link will take you to a public directory within an official nearby CentOS mirror where the previous options are available along with others, including different choices of desktop versions (GNOME or KDE), and the minimal <code class="email">.iso</code> file (~570 MB), which contains the core or essential packages of the distribution.</li></ul></div><p class="calibre8">Although all the <a id="id14" class="calibre1"/>three download options will work, we will use the minimal install as it is sufficient for our purpose at hand, and we can install other <a id="id15" class="calibre1"/>needed packages using public software package repositories with the <span class="strong"><strong class="calibre2">standard Centos package manager yum</strong></span> later. The recommended <code class="email">.iso</code> file to download is the latest that is available from the download page, which at the time of writing this is <span class="strong"><strong class="calibre2">CentOS 7.0 1406 x86_64 Minimal.iso</strong></span>.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Setting up CentOS 7 nodes"><div class="book" id="E9OE2-1d2c6d19b9d242db82da724021b51ea0"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec09" class="calibre1"/>Setting up CentOS 7 nodes</h1></div></div></div><p class="calibre8">If you do<a id="id16" class="calibre1"/> not have dedicated hardware that you can use to set up the<a id="id17" class="calibre1"/> nodes of your cluster, you can still create them using virtual machines over some virtualization software, such as Oracle Virtualbox © or VMware ©, for example. Using virtualization will allow us to easily set up the second node after setting up the first by cloning it. The only limitation in this case is that we will not have a STONITH device available. <span class="strong"><strong class="calibre2">Shoot The Other Node In The Head</strong></span> (<span class="strong"><strong class="calibre2">STONITH</strong></span>) is a mechanism that aims to prevent two nodes from <a id="id18" class="calibre1"/>acting as the primary node in an HA cluster, thus avoiding the possibility of data corruption.</p><p class="calibre8">The following <a id="id19" class="calibre1"/>setup is going to be performed on a Virtualbox VM with 1 GB of RAM and 30 GB of disk space plus two network card interfaces. The first <a id="id20" class="calibre1"/>one will allow us to reach the Internet to download other packages, whereas the second will be needed to create a shared IP address to reach the cluster as a whole.</p><p class="calibre8">The reason why I have chosen VirtualBox over VMware is that the former is free of cost and is available for Microsoft Windows, Linux, and MacOS, while a full version of the latter costs money.</p><p class="calibre8">To download and install <a id="id21" class="calibre1"/>VirtualBox, go to <a class="calibre1" href="https://www.virtualbox.org/">https://www.virtualbox.org/</a> and choose the version for your operating system. For the installation<a id="id22" class="calibre1"/> instructions, you can refer to <a class="calibre1" href="https://www.virtualbox.org/manual/UserManual.html">https://www.virtualbox.org/manual/UserManual.html</a>, especially sections <span class="strong"><em class="calibre9">1.7 Creating your first virtual machine</em></span>, and <span class="strong"><em class="calibre9">1.13 Cloning virtual machines</em></span>.</p><p class="calibre8">Other than that, you will also need to ensure that your virtual machine has two network interface cards. The first one is created by default while the second one has to be created manually.</p><p class="calibre8">To display the current network configuration for a VM, click on it in Virtualbox's main interface and then on the <span class="strong"><strong class="calibre2">Settings</strong></span> button. A popup window will appear with the list of the different hardware categories. Choose <span class="strong"><strong class="calibre2">Network</strong></span> and configure <span class="strong"><strong class="calibre2">Adapter 1</strong></span> to <span class="strong"><strong class="calibre2">Bridged Adapter</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00003.jpeg" alt="Setting up CentOS 7 nodes" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Click on <span class="strong"><strong class="calibre2">Adapter 2</strong></span>, enable it by checking the corresponding checkbox and configure it as part of an <span class="strong"><strong class="calibre2">Internal Network</strong></span> named <span class="strong"><strong class="calibre2">intnet</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00004.jpeg" alt="Setting up CentOS 7 nodes" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">We will <a id="id23" class="calibre1"/>use the default partitioning schema (LVM) as suggested by<a id="id24" class="calibre1"/> the installation process.</p></div>

<div class="book" title="Setting up CentOS 7 nodes">
<div class="book" title="Installing CentOS 7"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec09" class="calibre1"/>Installing CentOS 7</h2></div></div></div><p class="calibre8">We will <a id="id25" class="calibre1"/>start by creating the first node step by step and<a id="id26" class="calibre1"/> then use the cloning feature in Virtualbox to instantiate an identical node. This will reduce the necessary time for the installation as it will only require a slight modification to the hostname and network. Follow these steps to install CentOS 7 in a virtual machine:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The splash screen shown in the following screenshot is the first step in the installation process after loading the installation media on boot. Highlight <span class="strong"><strong class="calibre2">Install CentOS 7</strong></span> using the up and down arrows and press <span class="strong"><em class="calibre9">Enter</em></span>:<div class="mediaobject"><img src="../images/00005.jpeg" alt="Installing CentOS 7" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">Select <span class="strong"><strong class="calibre2">English</strong></span> (or your preferred installation language) and click on <span class="strong"><strong class="calibre2">Continue</strong></span>:<div class="mediaobject"><img src="../images/00006.jpeg" alt="Installing CentOS 7" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">In the<a id="id27" class="calibre1"/> next screen, you can set the current <a id="id28" class="calibre1"/>date and time, choose a keyboard layout and language support, pick a hard drive destination for the installation along with a partitioning method, connect the main network interface, and assign a unique hostname for the node. We will name the current node as <span class="strong"><strong class="calibre2">node01</strong></span> and leave the rest of the settings as default (we will configure the extra network card later). Then, click on the <span class="strong"><strong class="calibre2">Begin installation</strong></span> button.<div class="mediaobject"><img src="../images/00007.jpeg" alt="Installing CentOS 7" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">While<a id="id29" class="calibre1"/> the installation continues in<a id="id30" class="calibre1"/> the background, we will be prompted to set the password for the root account and create an administrative user for the node. Once these steps have been confirmed, the corresponding warnings will no longer appear:<div class="mediaobject"><img src="../images/00008.jpeg" alt="Installing CentOS 7" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="5">When the process is completed, click on <span class="strong"><strong class="calibre2">Finish configuration</strong></span> and the installation will finish configuring the system and the devices. When the system is ready to boot on its own, you will be prompted to do so. Remove the installation media and click on <span class="strong"><strong class="calibre2">Reboot</strong></span>.</li><li class="listitem" value="6">After <a id="id31" class="calibre1"/>successfully restarting the<a id="id32" class="calibre1"/> computer and booting into a Linux prompt, our first task will be to update our system. However, before we can do this, we first have to set up our basic network adapter to access the Internet to download and update packages. Then, we will be able to proceed with setting up our network interfaces.</li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Setting up CentOS 7 nodes">
<div class="book" title="Setting up the network infrastructure"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec10" class="calibre1"/>Setting up the network infrastructure</h2></div></div></div><p class="calibre8">Since our nodes <a id="id33" class="calibre1"/>will communicate between each other over the network, we will first define our network addresses and configuration. Our rather basic network infrastructure will consist of two CentOS 7 boxes with static IP addresses and host names <code class="email">node01 [192.168.0.2]</code> and <code class="email">node02 [192.168.0.3]</code>, and a gateway router called <span class="strong"><strong class="calibre2">simply gateway [192.168.0.1]</strong></span>.</p><p class="calibre8">In CentOS, all <a id="id34" class="calibre1"/>network interfaces are configured using scripts in the <code class="email">/etc/sysconfig/network-scripts</code> directory. If you followed the steps outlined earlier to create a second network interface, you should have a <code class="email">ifcfg-enp0s3</code> and <code class="email">ifcfg-enp0s8</code> file inside that directory. The first one is the configuration file for the network card that we will use to access the Internet and to connect via SSH using an outside client, whereas the second will be used in a later chapter to be a part of a cluster resource. Note that the exact naming of the network interfaces may differ a little, but it is safe to assume that they will follow the <code class="email">ifcfg-enp0sX</code> format, where <code class="email">X</code> is an integer number.</p><p class="calibre8">This is the minimum content that is needed in the <code class="email">/etc/sysconfig/network-scripts/ifcfg-enp0s3</code> directory for our purposes in our first node (when you set up the second node later, just change the IP address <code class="email">(IPADDR)</code> to <code class="email">192.168.0.3</code>):</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">HWADDR="08:00:27:C8:C2:BE"</strong></span>
<span class="strong"><strong class="calibre2">TYPE="Ethernet"</strong></span>
<span class="strong"><strong class="calibre2">BOOTPROTO="static"</strong></span>
<span class="strong"><strong class="calibre2">NAME="enp0s3"</strong></span>
<span class="strong"><strong class="calibre2">ONBOOT="yes"</strong></span>
<span class="strong"><strong class="calibre2">IPADDR="192.168.0.2"</strong></span>
<span class="strong"><strong class="calibre2">NETMASK="255.255.255.0"</strong></span>
<span class="strong"><strong class="calibre2">GATEWAY="192.168.0.1"</strong></span>
<span class="strong"><strong class="calibre2">PEERDNS="yes"</strong></span>
<span class="strong"><strong class="calibre2">DNS1="8.8.8.8"</strong></span>
<span class="strong"><strong class="calibre2">DNS2="8.8.4.4"</strong></span></pre></div><p class="calibre8">Note that the <code class="email">UUID</code> and <code class="email">HWADDR</code> values will be different in your case as they are assigned as part of the underlying hardware. For this reason, it is safe to leave the default values for those settings. In addition to this, beware that cluster machines need to be assigned a static IP address—never leave that up to DHCP! In the configuration file used previously, we are using Google's DNS but if you wish to, feel free to use another DNS.</p><p class="calibre8">When <a id="id35" class="calibre1"/>you are done making changes, save the file and restart the network service in order to apply them. Since CentOS, beginning with version 7, uses systemd instead of SysVinit for service management, we will use the <code class="email">systemctl</code> command instead of the /<code class="email">etc/init.d</code> scripts to restart the services throughout this book, as follows:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ systemctl restart network.service # Restart the network service</strong></span></pre></div><p class="calibre8">You can verify that the previous changes have taken effect using the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ systemctl status network.service # Display the status of the network service</strong></span></pre></div><p class="calibre8">You can verify that the expected changes have been correctly applied with the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ ip addr | grep 'inet' ''# Display the IP addresses</strong></span></pre></div><div class="mediaobject"><img src="../images/00009.jpeg" alt="Setting up the network infrastructure" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">You can disregard all error messages related to the loopback interface as shown in the preceding screenshot. However, you will need to examine carefully any error messages related to <code class="email">enp0s3</code>, if any, and get them resolved in order to proceed further.</p><p class="calibre8">The second interface will be called <code class="email">enp0sX</code>, where <code class="email">X</code> is typically <code class="email">8</code>, as it is in our case. You can verify this with the following command, as shown in the following screenshot:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ ip link show</strong></span></pre></div><div class="mediaobject"><img src="../images/00010.jpeg" alt="Setting up the network infrastructure" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">As for the<a id="id36" class="calibre1"/> configuration file of <code class="email">enp0s8</code>, you can safely create it copying the contents of <code class="email">ifcfg-enp0s3</code>. Do not forget, however, to change the hardware (MAC) address as returned by the information on the NIC by the <code class="email">ip link show enp0s8</code> command and leave the IP address field blank now, using the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">ip link show enp0s8</strong></span>
<span class="strong"><strong class="calibre2">cp /etc/sysconfig/network-scripts/ifcfg-enp0s3 /etc/sysconfig/network-scripts/ifcfg-enp0s8</strong></span></pre></div><p class="calibre8">Next, restart the network service as explained earlier.</p><p class="calibre8">Note that you will also need to set up at least a basic DNS resolution method. Considering that we will set up a cluster with two nodes only, we will use <code class="email">/etc/hosts</code> in both hosts for this purpose.</p><p class="calibre8">Edit <code class="email">/etc/hosts</code> with the following content:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">192.168.0.2	node01</strong></span>
<span class="strong"><strong class="calibre2">192.168.0.3	node02</strong></span>
<span class="strong"><strong class="calibre2">192.168.0.1	gateway</strong></span></pre></div><p class="calibre8">Once you have set up both nodes as explained in the following sections, at this point and before proceeding further, you can perform a ping as a basic test for connectivity between the two hosts to ensure that they are reachable from each other.</p><p class="calibre8">To begin, execute in <code class="email">node01</code>:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ ping –c 4 node02</strong></span></pre></div><p class="calibre8">Next, do the same in <code class="email">node02</code>:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ ping –c 4 node01</strong></span></pre></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing the packages required for clustering"><div class="book" id="F8902-1d2c6d19b9d242db82da724021b51ea0"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec10" class="calibre1"/>Installing the packages required for clustering</h1></div></div></div><p class="calibre8">Once we have<a id="id37" class="calibre1"/> finished installing the operating system<a id="id38" class="calibre1"/> and configuring the basic network infrastructure, we are ready to install the packages that will provide the clustering functionality to each node. Let's emphasize here that without these core components, our two nodes would become simple standalone servers that would not be able to support each other in the event of a system crash or another major issue in one of them.</p></div>

<div class="book" title="Installing the packages required for clustering">
<div class="book" title="Key software components"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec11" class="calibre1"/>Key software components</h2></div></div></div><p class="calibre8">Each node will <a id="id39" class="calibre1"/>need the following software<a id="id40" class="calibre1"/> components in order to work as a member of the cluster. These packages are fully supported in CentOS 7 as part of a cluster setup, as opposed to other alternatives that have been deprecated:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre2">Pacemaker</strong></span>: This is <a id="id41" class="calibre1"/>a cluster resource <a id="id42" class="calibre1"/>manager that runs scripts at boot time, when individual nodes go up or down or when related resources fail. In addition, it can be configured to periodically check the health status of each cluster member. In other words, pacemaker will be in charge of starting and stopping services (such as a web or database server, to name a classic example) and will implement the logic to ensure that all of the necessary services are running in only one location at the same time in order to avoid data failure or corruption.</li><li class="listitem"><span class="strong"><strong class="calibre2">Corosync</strong></span>: This is<a id="id43" class="calibre1"/> a messaging service that will <a id="id44" class="calibre1"/>provide a communication channel between nodes. As you can guess, corosync is essential for pacemaker to perform its job.</li><li class="listitem"><span class="strong"><strong class="calibre2">PCS</strong></span>: This is a<a id="id45" class="calibre1"/> corosync and pacemaker configuration<a id="id46" class="calibre1"/> tool that will allow you to easily view, modify, and create pacemaker-based clusters. This is not strictly necessary but rather optional. We choose to install it because it will come in handy at a later stage.</li></ul></div><p class="calibre8">To install the three preceding software packages, run the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ yum update &amp;&amp; yum install pacemaker corosync pcs</strong></span></pre></div><p class="calibre8">Yum will update all the installed packages to their most recent version in order to better satisfy dependencies, and it will then proceed with the actual installation.</p><p class="calibre8">In addition to installing the preceding packages, we also need to enable <code class="email">iptables</code>, as the default firewall for CentOS 7 is <code class="email">firewalld</code>. We choose <code class="email">iptables</code> over <code class="email">firewalld</code> because its use is far more extended, and there is a chance that you will be familiar with it compared with the relatively new <code class="email">firewalld</code>. We will install the necessary packages here and leave the configuration for the next chapter.</p><p class="calibre8">In order to manage <code class="email">iptables</code> via systemd utilities, you will need to install (if it is not already installed) the <code class="email">iptables-services</code> package using the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">yum update &amp;&amp; yum install iptables-services</strong></span></pre></div><p class="calibre8">Now, you<a id="id47" class="calibre1"/> can stop and disable <code class="email">firewalld</code> using<a id="id48" class="calibre1"/> the following commands:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">systemctl stop firewalld.service</strong></span>
<span class="strong"><strong class="calibre2">systemctl disable firewalld.service</strong></span></pre></div><p class="calibre8">Next, enable <code class="email">iptables</code> to both initialize on boot and start during the current session:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">systemctl enable iptables.service</strong></span>
<span class="strong"><strong class="calibre2">systemctl start iptables.service</strong></span></pre></div><p class="calibre8">You can refer to the following screenshot for a step-by-step example of this process:</p><div class="mediaobject"><img src="../images/00011.jpeg" alt="Key software components" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Once the installation of the first node (<code class="email">node01</code>) has been completed successfully, clone the first node following the outline in section 1.13 of <code class="email">Virtualbox manual</code> (<code class="email">Cloning virtual machines</code>). Once you're done cloning the virtual machine, add the following minor changes to the second virtual machine:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Name the machine <code class="email">node02</code>. When you start this newly created virtual machine, its hostname will still be set to <code class="email">node01</code>. To change it, issue the following command and then reboot the machine to apply it:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ hostnamectl set-hostname node02</strong></span>
<span class="strong"><strong class="calibre2">$ systemctl reboot</strong></span></pre></div></li><li class="listitem">In the configuration file for <code class="email">enp0s3</code> in <code class="email">node02</code>, enter <code class="email">192.168.0.3</code> as the IP address and the right <code class="email">HWADDR</code> address.</li><li class="listitem">Ensure that both the virtual machines are running and that each node can ping the other and the gateway, as shown in the next two screenshots.</li></ul></div><p class="calibre8">First, we will <a id="id49" class="calibre1"/>ping <code class="email">node02</code> and gateway from <code class="email">node01</code>, and <a id="id50" class="calibre1"/>we will see the following output:</p><div class="mediaobject"><img src="../images/00012.jpeg" alt="Key software components" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Then, we will ping <code class="email">node01</code> and gateway from <code class="email">node02</code>:</p><div class="mediaobject"><img src="../images/00013.jpeg" alt="Key software components" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">If any of the <a id="id51" class="calibre1"/>pings do not return the expected <a id="id52" class="calibre1"/>result, as shown in the preceding screenshot, check the network interface configuration in both Virtualbox and in the configuration files, as outlined earlier in this chapter.</p></div></div>

<div class="book" title="Installing the packages required for clustering">
<div class="book" title="Setting up key-based authentication for SSH access"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec12" class="calibre1"/>Setting up key-based authentication for SSH access</h2></div></div></div><p class="calibre8">While not strictly required, we will also set up a public key-based authentication for SSH so that<a id="id53" class="calibre1"/> we can access <a id="id54" class="calibre1"/>each host from the other <a id="id55" class="calibre1"/>without entering the accounts password every time we want to access a different node. This feature will come in handy in case, for some reason, we need to perform some system administration task on one of the nodes. Note that you will need to repeat this operation on both nodes.</p><p class="calibre8">In order to increase security, we may also enter a passphrase while creating the RSA key, which is shown in the following screenshot. This step is optional and you can omit it if you want. In fact, I advise you to leave it empty in order to make things easier down the road, but it's up to you.</p><p class="calibre8">Run the following command in order to create a RSA key:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ ssh-keygen -t rsa</strong></span></pre></div><div class="mediaobject"><img src="../images/00014.jpeg" alt="Setting up key-based authentication for SSH access" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">To enable<a id="id56" class="calibre1"/> passwordless login, we will copy the newly created key to <code class="email">node02</code>, and vice versa, as shown<a id="id57" class="calibre1"/> in the next two figures, respectively.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ cat .ssh/id_rsa.pub | ssh root@node02 'cat' &gt;&gt; .ssh/authorized_keys'</strong></span></pre></div><p class="calibre8">Copy<a id="id58" class="calibre1"/> the key from <code class="email">node01</code> to <code class="email">node02</code>:</p><div class="mediaobject"><img src="../images/00015.jpeg" alt="Setting up key-based authentication for SSH access" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Copy the key from <code class="email">node02</code> to <code class="email">node01</code>:</p><div class="mediaobject"><img src="../images/00016.jpeg" alt="Setting up key-based authentication for SSH access" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Next, we<a id="id59" class="calibre1"/> need to verify <a id="id60" class="calibre1"/>that we can connect from each <a id="id61" class="calibre1"/>cluster member to the other without a password but with the passphrase we entered previously:</p><div class="mediaobject"><img src="../images/00017.jpeg" alt="Setting up key-based authentication for SSH access" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Finally, if passwordless login is not successful, you may want to ensure that the SSH daemon is running on both hosts:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ systemctl status sshd</strong></span></pre></div><p class="calibre8">If it is not running, start it using the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ systemctl start sshd</strong></span></pre></div><p class="calibre8">You may want to check the status of the service again after attempting to restart it. If there have been any errors, the output of <code class="email">systemctl status sshd</code> will give you indications as to what is wrong with the service and why it is refusing to start properly. Following those directions, you will be able to troubleshoot the problem without much hassle.</p></div></div>
<div class="book" title="Summary" id="G6PI1-1d2c6d19b9d242db82da724021b51ea0"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec11" class="calibre1"/>Summary</h1></div></div></div><p class="calibre8">In this chapter, we reviewed how to install the operating system and installed the necessary software components to implement the basic cluster functionality. Ensure that you have installed your nodes, the basic clustering software as outlined earlier in this chapter, and configured the network and SSH access before proceeding with <a class="calibre1" title="Chapter 2. Installing Cluster Services and Configuring Network Components" href="part0018_split_000.html#H5A42-1d2c6d19b9d242db82da724021b51ea0">Chapter 2</a>, <span class="strong"><em class="calibre9">Installing Cluster Services and Configuring Network Components</em></span>, where we will configure the resource manager, the messaging layer, and the firewall service in order to actually start building our cluster.</p></div></body></html>