<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Let's Start Programming</h1>
                
            
            <article>
                
<p class="calibre1">Mastering Bash is the art of taking advantage of your environment to make the best out of it. It is not just a matter of dealing with boring routine tasks that can be automated. It is crafting your working space so that it becomes more efficient for your goals. Thus, even though Bash scripting is not as expressive as other more complex languages, such as Python or JavaScript, it is simple enough to be grabbed in a short time, and so flexible that it will suffice for most of your everyday tasks, even the trickiest ones.</p>
<p class="calibre1">But is Bash so plain and easy? Let's have a look at our first lines in Bash. Let's begin with something easy:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ time echo $0</strong><br class="title-page-name"/><strong class="calibre2">/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">real 0m0.000s</strong><br class="title-page-name"/><strong class="calibre2">user 0m0.000s</strong><br class="title-page-name"/><strong class="calibre2">sys 0m0.000s</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$</strong> 
</pre>
<p class="calibre1">Now, let us do it again in a slightly different way:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ time /bin/echo $0/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">real 0m0.001s</strong><br class="title-page-name"/><strong class="calibre2">user 0m0.000s</strong><br class="title-page-name"/><strong class="calibre2">sys 0m0.000s</strong>  
</pre>
<p class="calibre1">What is interesting here is that the value of <kbd class="calibre9">real</kbd> is slightly different between the two commands. OK, but why? Let's dig a bit further with the following commands:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ type echo</strong><br class="title-page-name"/><strong class="calibre2">echo is a shell builtin</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ type /bin/echo</strong><br class="title-page-name"/><strong class="calibre2">/bin/echo is /bin/echo</strong>  
</pre>
<p class="calibre1">Interestingly enough, the first seems to be a <kbd class="calibre9">shell builtin</kbd>, the second simply a system program, an external utility, and it is here that lies the difference. <kbd class="calibre9">builtin</kbd> is a command that is built into the shell, the opposite of a system program, which is invoked by the shell. An internal command, the opposite to an external command.</p>
<p class="calibre1">To understand the difference between internal and external shell commands that lead to such different timing, we have to understand how an external program is invoked by the shell. When an external program is to be executed, Bash creates a copy of itself with the same environment of the parent shell, giving birth to a new process with a different process ID number. So to speak, we just saw how forking is carried out. Inside the new address space, a system exec is called to load the new process data.</p>
<p class="calibre1">For the <kbd class="calibre9">builtin</kbd> commands, it is a different story, Bash executes them without any forks, and this leads to a couple of the following interesting outcomes:</p>
<ul class="calibre12">
<li class="calibre13">The <kbd class="calibre9">builtin</kbd> execution is faster because there are no copies and no executables invoked. One side note is that this advantage is more evident with short-running programs because the overhead is before any executable is called: once the external program is invoked, the difference in the pure execution time between the <kbd class="calibre9">builtin</kbd> command and the program is negligible.</li>
<li class="calibre13">Being internal to Bash, the <kbd class="calibre9">builtin</kbd> commands can affect its internal state, and this is not possible with the external program. Let's take into account a classic example using <kbd class="calibre9">builtincd</kbd>. If <kbd class="calibre9">cd</kbd> were an external program, once invoked from shell as:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">cd /this_dir</strong>  
</pre>
<div class="calibre22">
<ul class="calibre12">
<li class="calibre13">The first operation would be our shell forking a process for <kbd class="calibre9">cd</kbd>, and this latter would change the current directory for its own process, not for the one we are inside and that was forked to give birth to the <kbd class="calibre9">cd</kbd> process. The parent shell would remain unaffected. So, we would not go anywhere.</li>
</ul>
</div>
<p class="calibre1">Curious about which <kbd class="calibre9">bulitins</kbd> are available? You have some options, to either execute the following <kbd class="calibre9">builtin</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">compgen -b</strong>  
</pre>
<p class="calibre1">Or this other <kbd class="calibre9">builtin</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">enable -a | awk '{ print $2 }'</strong>  
</pre>
<p class="calibre1">To better understand why there is a difference between the execution of a <kbd class="calibre9">builtin</kbd> and an external program, we must see what happens when we invoke a command.</p>
<ul class="calibre12">
<li class="calibre13">First, remember that the shell works from left to right and takes all the variable assignments and redirections and saves them in order to process later.</li>
<li class="calibre13">If nothing else is left, the shell takes the first word from the command line as the name of the command itself, while all the rest is considered as its arguments.</li>
<li class="calibre13">The next step is dealing with the required input and output redirection.</li>
<li class="calibre13">Finally, before being assigned to a variable, all the text following the sign <kbd class="calibre9">=</kbd> is subject to tilde expansion, parameter expansion, command substitution, arithmetic expansion, and quote removal.</li>
<li class="calibre13">If no command name comes out as a result of the last operation, the variable can then affect the environment. If an assignment fails, an error is raised and the command invoked exits with a non-zero status.</li>
<li class="calibre13">If no command name is the outcome of the operation seen before, all the redirections are applied, but differently from variables, they do not affect the current environment. Again, if any error occurs, there is a non-zero status exit.</li>
</ul>
<p class="calibre1">Once the preceding operations are performed, the command is then executed and exited with a status, depending on whether one or more expansions contain command substitutions. The overall exit status will be the one from the last command substitution, and if no command substitution were performed, the exit status will be zero.</p>
<p class="calibre1">At this point, we are finally left with a command name and some optional arguments. It is at this point the roads of <kbd class="calibre9">builtins</kbd> and external programs divert.</p>
<ul class="calibre12">
<li class="calibre13">At first, the shell looks at the command name, and if there are no slashes, it searches for its location</li>
<li class="calibre13">If there are no slashes, the shell tries to see if there is a function with that name and executes it</li>
<li class="calibre13">If no functions are found, the shell tries to hit <kbd class="calibre9">builtin</kbd>, and if there is anyone with that name, it is executed</li>
</ul>
<p class="calibre1">OK, now if there is any <kbd class="calibre9">builtin</kbd>, it already got invoked. What about an external program?</p>
<ul class="calibre12">
<li class="calibre13">Our Bash goes on, and if it finds no <kbd class="calibre9">builtins</kbd> by that name on the command line, there are three chances:</li>
<li class="calibre13">
<ul class="calibre23">
<li class="calibre13">The full path of the command to execute is already contained into its internal hash table, which is a structure used to speed up the search</li>
<li class="calibre13">If the full path is not in the hash, the shell looks for it into the content of the environmental <kbd class="calibre9">PATH</kbd> variable, and if it finds it, it is added to the hash table</li>
<li class="calibre13">The full path is not available in the <kbd class="calibre9">PATH</kbd> variable, so the shell returns with an exit status of 127</li>
</ul>
</li>
</ul>
<p class="calibre1">Hash can even be invoked as follows:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ hash</strong><br class="title-page-name"/><strong class="calibre2">hits command</strong><br class="title-page-name"/><strong class="calibre2">1  /usr/bin/which</strong><br class="title-page-name"/><strong class="calibre2">1  /usr/bin/ld</strong><br class="title-page-name"/><strong class="calibre2">24  /bin/sh</strong><br class="title-page-name"/><strong class="calibre2">1  /bin/ps</strong><br class="title-page-name"/><strong class="calibre2">1  /usr/bin/who</strong><br class="title-page-name"/><strong class="calibre2">1  /usr/bin/man</strong><br class="title-page-name"/><strong class="calibre2">1  /bin/ls</strong><br class="title-page-name"/><strong class="calibre2">1  /usr/bin/top</strong>  
</pre>
<p class="calibre1">The second column will then tell you not only which commands have been hashed, but also how many times each of them has been executed during the current session (hits).</p>
<p class="calibre1">Let's say that the search found the full path to the command we want to execute; now we have a full path, and we are in the same situation as if the Bash found one or more slashes into the command name. In either case, the shell thinks that it has a good path to invoke a command and executes the latter in a forked environment.</p>
<p class="calibre1">This is when we are lucky, but it can happen that the file invoked is not an executable, and in this case, given that our path does not point to a directory instead of a file, the Bash makes an educated guess and thinks to run a shell script. In this case, the script is executed in a subshell that is at all a new environment, which inherits the content of the hash table of the parent shell.</p>
<p class="calibre1">Before doing anything else, the shell looks at the first line of the script for an optional <kbd class="calibre9">sha-bang</kbd> (we will see later what this is) - after the <kbd class="calibre9">sha-bang</kbd>, there is the path to the interpreter used to manage the script and some optional arguments.</p>
<p class="calibre1">At this point, and only at this point, your external command, if it is a script, is executed. If it is an executable, it is invoked a bit before, but way after any <kbd class="calibre9">builtin</kbd>.</p>
<p class="calibre1">During these first paragraphs, we saw some commands and concepts that should sound familiar to you. The next paragraphs of this chapter will quickly deal with some basic elements of Bash, such as variables, expansions, and redirections. If you already know them, you will be able to use the next pages as a reference while working on your scripts. If, on the contrary, you are not so familiar with them, have a look at what comes next because all you will read will be fundamental in understanding what you can do in and with the shell.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">I/O redirection</h1>
                
            
            <article>
                
<p class="calibre1">As we saw in the previous pages, redirection is one of the last operations undertaken by Bash to parse and prepare the command line that will lead to the execution of a command. But what is a redirection? You can easily guess from your everyday experience. It means taking a stream that goes from one point to another and making it go somewhere else, like changing the flow of a river and making it go somewhere else. In Linux and Unix, it is quite the same, just keep in mind the following two principles:</p>
<ul class="calibre12">
<li class="calibre13">In Unix, each process, except for daemons, is supposed to be connected to a standard input, standard output, and standard error device</li>
<li class="calibre13">Every device in Unix is represented by a file</li>
</ul>
<p class="calibre1">You can also think of these devices as streams:</p>
<ul class="calibre12">
<li class="calibre13">Standard input, named <kbd class="calibre9">stdin</kbd>, is the intaking stream from which the process receives input data</li>
<li class="calibre13">Standard output, named <kbd class="calibre9">stdout</kbd>, is the outbound stream where the process writes its output data</li>
<li class="calibre13">Standard error, named <kbd class="calibre9">stderr</kbd>, is the stream where the process writes its error messages</li>
</ul>
<p class="calibre1">These streams are also identified by a standard POSIX file descriptor, which is an integer used by the kernel as a handler to refer to them, as you can see in the following table:</p>
<table class="table">
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Device</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Mode</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">File descriptor</strong></p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">stdin</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">read</p>
</td>
<td class="calibre8">
<p class="calibre1">0</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">stdout</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">write</p>
</td>
<td class="calibre8">
<p class="calibre1">1</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">stderr</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">write</p>
</td>
<td class="calibre8">
<p class="calibre1">2</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre1">So, tinkering with the file descriptors for the three main streams means that we can redirect the flows between <kbd class="calibre9">stdin</kbd> and <kbd class="calibre9">stdout</kbd>, but also <kbd class="calibre9">stderr</kbd>, from one process to the other. So, we can make different processes communicate with each other, and this is actually a form of IPC, inter-process communication, which we will <span>look at it in more </span>detail later in this book.</p>
<p class="calibre1">How do we redirect the <strong class="calibre2">Input/Output</strong> (<strong class="calibre2">I/O</strong>), from one process to another? We can get to this goal making use of some special characters:</p>
<pre class="codepackt">
<strong class="calibre2">&gt;</strong>  
</pre>
<p class="calibre1">Let's start stating that the default output of a process, usually, is the <kbd class="calibre9">stdout</kbd>. Whatever it returns is returned on the <kbd class="calibre9">stdout</kbd> which, again usually, is the monitor or the terminal. Using the <kbd class="calibre9">&gt;</kbd> character, we can divert this flow and make it go to a file. If the file does not exist, it is created, and if it exists, it is flattened and its content is overwritten with the output stream of the process.</p>
<p class="calibre1">A simple example will clarify how the redirection to a file works:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo "This is some content"</strong><br class="title-page-name"/><strong class="calibre2">This is some content</strong>  
</pre>
<p class="calibre1">We used the command <kbd class="calibre9">echo</kbd> to print a message on the <kbd class="calibre9">stdout</kbd>, and so we see the message written, in our case, to the text terminal that is usually connected to the shell:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ls -lah</strong><br class="title-page-name"/><strong class="calibre2">total 0</strong><br class="title-page-name"/><strong class="calibre2">drwxr-xr-x   2 zarrelli  gzarrelli    68B 20 Jan 07:43 .</strong><br class="title-page-name"/><strong class="calibre2">drwxr-xr-x+ 47 zarrelli  gzarrelli   1.6K 20 Jan 07:43 ..</strong>  
</pre>
<p class="calibre1">There is nothing on the filesystem, so the output went straight to the terminal, but the underlying directory was not affected. Now, time for a redirection:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo "This is some content" &gt; output_file.txt</strong>  
</pre>
<p class="calibre1">Well, nothing to the screen; no output at all:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ls -lah</strong><br class="title-page-name"/><strong class="calibre2">total 8</strong><br class="title-page-name"/><strong class="calibre2">drwxr-xr-x   3 gzarrelli  gzarrelli   102B 20 Jan 07:44 .</strong><br class="title-page-name"/><strong class="calibre2">drwxr-xr-x+ 47 gzarrelli  gzarrelli   1.6K 20 Jan 07:43 ..</strong><br class="title-page-name"/><strong class="calibre2">-rw-r--r--   1 gzarrelli  gzarrelli    21B 20 Jan 07:44 <br class="title-page-name"/>output_file.txt</strong>  
</pre>
<p class="calibre1">Actually, as you can see, the output did not vanish; it was simply redirected to a file on the current directory which got created and filled in:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat output_file.txt</strong><br class="title-page-name"/><strong class="calibre2">This is some content</strong>  
</pre>
<p class="calibre1">Here we have something interesting. The <kbd class="calibre9">cat</kbd> command takes the content of the <kbd class="calibre9">output_file.txt</kbd> and sends it on the <kbd class="calibre9">stdout.</kbd> What we can see is that the output from the former command was redirected from the terminal and written to a file.</p>
<pre class="codepackt">
<strong class="calibre2">&gt;&gt;</strong>  
</pre>
<p class="calibre1">This double mark answers a requirement we often face: <em class="calibre20">How can we add more content coming from a process to a file without overwriting anything?</em> Using this double character, which means no file is already in place, create a new one; if it already exists, just append the new data. Let's take the previous file and add some content to it:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo "This is some other content" &gt;&gt; output_file.txt</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ cat output_file.txt</strong><br class="title-page-name"/><strong class="calibre2">This is some content</strong><br class="title-page-name"/><strong class="calibre2">This is some other content</strong>  
</pre>
<p class="calibre1">Bingo, the file was not overwritten and the new content from the <kbd class="calibre9">echo</kbd> command was added to the old. Now, we know how to write to a file, but what about reading from somewhere else other than the <kbd class="calibre9">stdin</kbd>?</p>
<pre class="codepackt">
<strong class="calibre2">&lt;</strong>  
</pre>
<p class="calibre1">If the text terminal is the <kbd class="calibre9">stdin</kbd>, the keyboard is the standard input for a process, where it expects some data from. Again, we can divert the flow or data reading and get the process read from a file. For our example, we start creating a file containing a set of unordered numbers:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo -e '5\n9\n4\n1\n0\n6\n2' &gt; to_sort</strong>  
</pre>
<p class="calibre1">And let us verify its content, as follows:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat to_sort</strong><br class="title-page-name"/><strong class="calibre2">5</strong><br class="title-page-name"/><strong class="calibre2">9</strong><br class="title-page-name"/><strong class="calibre2">4</strong><br class="title-page-name"/><strong class="calibre2">1</strong><br class="title-page-name"/><strong class="calibre2">0</strong><br class="title-page-name"/><strong class="calibre2">6</strong><br class="title-page-name"/><strong class="calibre2">2</strong>  
</pre>
<p class="calibre1">Now we can have the <kbd class="calibre9">sort</kbd> command read this file into its <kbd class="calibre9">stdin</kbd>, as follows:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ sort &lt; to_sort</strong><br class="title-page-name"/><strong class="calibre2">0</strong><br class="title-page-name"/><strong class="calibre2">1</strong><br class="title-page-name"/><strong class="calibre2">2</strong><br class="title-page-name"/><strong class="calibre2">4</strong><br class="title-page-name"/><strong class="calibre2">5</strong><br class="title-page-name"/><strong class="calibre2">6</strong><br class="title-page-name"/><strong class="calibre2">9</strong>  
</pre>
<p class="calibre1">Nice, our numbers are now in sequence, but we can do something more interesting:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ sort &lt; to_sort &gt; sorted</strong>  
</pre>
<p class="calibre1">What did we do? We simply gave the file <kbd class="calibre9">to_sort</kbd> to the command <kbd class="calibre9">sort</kbd> into its standard input, and at the same time, we concatenated a second redirection so that the output of <kbd class="calibre9">sort</kbd> is written into the file <kbd class="calibre9">sorted</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat sorted</strong><br class="title-page-name"/><strong class="calibre2">0</strong><br class="title-page-name"/><strong class="calibre2">1</strong><br class="title-page-name"/><strong class="calibre2">2</strong><br class="title-page-name"/><strong class="calibre2">4</strong><br class="title-page-name"/><strong class="calibre2">5</strong><br class="title-page-name"/><strong class="calibre2">6</strong><br class="title-page-name"/><strong class="calibre2">9 </strong>  
</pre>
<p class="calibre1">So, we can concatenate multiple redirections and have some interesting results, but we can do something even trickier, that is, chaining together inputs and outputs, not on files but on processes, as we will see now.</p>
<pre class="codepackt">
<strong class="calibre2">|</strong>  
</pre>
<p class="calibre1">The pipe character does exactly what its name suggests, <em class="calibre20">pipes</em> the stream; could be the <kbd class="calibre9">stdout</kbd> or <kbd class="calibre9">stderr</kbd>, from one process to another, creating a simple interprocess communication facility:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ <br class="title-page-name"/></strong><strong class="calibre2">ps aux | awk '{print $2, $3, $4}' | grep -v [A-Z] | sort -r -k 2 <br class="title-page-name"/>-g | head -n 3</strong><br class="title-page-name"/><strong class="calibre2">95 0.0 0.0</strong><br class="title-page-name"/><strong class="calibre2">94 0.0 0.0</strong><br class="title-page-name"/><strong class="calibre2">93 0.0 0.0</strong>  
</pre>
<p class="calibre1">In this example, we had a bit of fun, first getting a list of processes, then piping the output to the <kbd class="calibre9">awk</kbd> utility, which printed only the first, eleventh, and twelfth fields of the output of the first command, giving us the process ID, CPU percentage, and memory percentage columns. Then, we got rid of the heading <kbd class="calibre9">PID %CPU %MEM</kbd>, piping the <kbd class="calibre9">awk</kbd> output to the input of <kbd class="calibre9">grep</kbd>, which performed a reverse pattern matching on any strings containing a character, not a number. In the next stage, we piped the output to the <kbd class="calibre9">sort</kbd> command, which reverse-ordered the data based on the values in the second column. Finally, we wanted only the three lines, and so we got the <kbd class="calibre9">PID</kbd> of the first three heaviest processes relying on CPU occupation.</p>
<p class="calibre1">Redirection can also be used for some kind of fun or useful stuff, as you can see in the following screenshot:</p>
<div class="packt_figure"><img class="image-border" src="../images/00005.jpeg"/></div>
<p class="calibre1">As you can see, there are two users on the same machine on different terminals, and remember that each user has to be connected to a terminal. To be able to write to any user's terminal, you must be root or, as in this example, the same user on two different terminals. With the <kbd class="calibre9">who</kbd> command we can identify which terminal (<kbd class="calibre9">ttys</kbd>) the user is connected to, also known as <em class="calibre20">reads from</em>, and we simply redirect the output from an <kbd class="calibre9">echo</kbd> command to his terminal. Because its session is connected to the terminal, he will read what we send to the <kbd class="calibre9">stdin</kbd> of his terminal device (hence, <kbd class="calibre9">/dev/ttysxxx</kbd>).</p>
<p class="calibre1">Everything in Unix is represented by a file, be it a device, a terminal, or anything we need access to. We also have some special files, such as <kbd class="calibre9">/dev/null</kbd>, which is a sinkhole - whatever you send to it gets lost:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo "Hello" &gt; /dev/null</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$</strong>  
</pre>
<p class="calibre1">And have a look at the following example too:</p>
<pre class="codepackt">
<strong class="calibre2">root:~$ ls</strong><br class="title-page-name"/><strong class="calibre2">output_file.txtsortedto_sort</strong><br class="title-page-name"/><strong class="calibre2">root:~$ mv output_file.txt /dev/null</strong><br class="title-page-name"/><strong class="calibre2">root:~$ ls</strong><br class="title-page-name"/><strong class="calibre2">to_sort</strong>  
</pre>
<p class="calibre1">Great, there is enough to have fun, but it is just the beginning. There is a whole lot more to do with the file descriptors.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Messing around with stdin, stdout, and stderr</h1>
                
            
            <article>
                
<p class="calibre1">Well, if we tinker a little bit with the file descriptors and special characters we can have some nice, really nice, outcomes; let's see what we can do.</p>
<ul class="calibre12">
<li class="calibre13"><kbd class="calibre9">x &lt; filename</kbd>: This opens a file in read mode and assigns the descriptor named <kbd class="calibre9">a</kbd>, whose value falls between <kbd class="calibre9">3</kbd> and <kbd class="calibre9">9</kbd>. We can choose any name by the means of which we can easily access the file content through the <kbd class="calibre9">stdin</kbd>.</li>
<li class="calibre13"><kbd class="calibre9">1 &gt; filename</kbd>: This redirects the standard output to filename. If it does not exist, it gets created; if it exists, the pre-existing data is overwritten.</li>
<li class="calibre13"><kbd class="calibre9">1 &gt;&gt; filename</kbd>: This redirects the standard output to filename. If it does not exist, it is created; otherwise, the contents get appended to the pre-existing data.</li>
<li class="calibre13"><kbd class="calibre9">2 &gt; filename</kbd>: This redirects the standard error to filename. If it does not exist, it gets created; if it exists, the pre-existing data is overwritten.</li>
<li class="calibre13"><kbd class="calibre9">2 &gt;&gt; filename</kbd>: This redirects the standard error to filename. If it does not exist, it is created; otherwise, the contents get appended to the pre-existing data.</li>
<li class="calibre13"><kbd class="calibre9">&amp;&gt; filename</kbd>: This redirects both the <kbd class="calibre9">stdout</kbd> and the <kbd class="calibre9">stderr</kbd> to filename. This redirects the standard error to filename. If it does not exist, it gets created; if it exists, the pre-existing data is overwritten.</li>
<li class="calibre13"><kbd class="calibre9">2&gt;&amp;1</kbd>: This redirects the <kbd class="calibre9">stderr</kbd> to the <kbd class="calibre9">stdout</kbd>. If you use this with a program, its error messages will be redirected to the <kbd class="calibre9">stdout</kbd>, that is, usually, the monitor.</li>
<li class="calibre13"><kbd class="calibre9">y&gt;&amp;x</kbd>: This redirects the file descriptor for <kbd class="calibre9">y</kbd> to <kbd class="calibre9">x</kbd> so that the output from the file pointed by descriptor <kbd class="calibre9">y</kbd> will be redirected to the file pointed by descriptor <kbd class="calibre9">x</kbd>.</li>
<li class="calibre13"><kbd class="calibre9">&gt;&amp;x</kbd>: This redirects the file descriptor <kbd class="calibre9">1</kbd> that is associated with the <kbd class="calibre9">stdout</kbd> to the file pointed by the descriptor <kbd class="calibre9">x</kbd>, so whatever hits the standard output will be written in the file pointed by <kbd class="calibre9">x</kbd>.</li>
<li class="calibre13"><kbd class="calibre9">x&lt;&gt; filename</kbd>: This opens a file in read/write mode and assigns the descriptor <kbd class="calibre9">x</kbd> to it. If the file does not exist, it is created, and if the descriptor is omitted, it defaults to <kbd class="calibre9">0</kbd>, the <kbd class="calibre9">stdin</kbd>.</li>
<li class="calibre13"><kbd class="calibre9">x&lt;&amp;-</kbd>: This closes the file opened in read mode and associated with the descriptor <kbd class="calibre9">x</kbd>.</li>
<li class="calibre13"><kbd class="calibre9">0&lt;&amp;- or &lt;&amp;-</kbd>: This closes the file opened in read mode and associated with the descriptor <kbd class="calibre9">0</kbd>, the <kbd class="calibre9">stdin</kbd> , which is then closed.</li>
<li class="calibre13"><kbd class="calibre9">x&gt;&amp;-</kbd>: This closes the file opened in write mode and associated with the descriptor <kbd class="calibre9">x</kbd>.</li>
<li class="calibre13"><kbd class="calibre9">1&gt;&amp;- or &gt;&amp;-</kbd>: This closes the file opened in write mode and associated with the descriptor <kbd class="calibre9">1</kbd>, the <kbd class="calibre9">stdout</kbd>, which is then closed.</li>
</ul>
<p class="calibre1">If you want to see which file descriptors are associated with a process, you can explore the <kbd class="calibre9">/proc</kbd> directory and point to the following:</p>
<pre class="codepackt">
<strong class="calibre2">/proc/pid/fd</strong>  
</pre>
<p class="calibre1">Under that path, change <kbd class="calibre9">PID</kbd> with the ID of the process you want to explore; you will find all the file descriptors associated with it, as in the following example:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ls -lah /proc/15820/fd</strong><br class="title-page-name"/><strong class="calibre2">total 0</strong><br class="title-page-name"/><strong class="calibre2">dr-x------ 2 postgres postgres  0 Jan 20 17:59 .</strong><br class="title-page-name"/><strong class="calibre2">dr-xr-xr-x 9 postgres postgres  0 Jan 20 09:59 ..</strong><br class="title-page-name"/><strong class="calibre2">lr-x------ 1 postgres postgres 64 Jan 20 17:59 0 -&gt; /dev/null <br class="title-page-name"/>(deleted)</strong><br class="title-page-name"/><strong class="calibre2">l-wx------ 1 postgres postgres 64 Jan 20 17:59 1 -&gt; /var/log/postgresql/postgresql-9.4-main.log</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 10 -&gt; /var/lib/postgresql/9.4/main/base/16385/16587</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 11 -&gt; socket:[13135]</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 12 -&gt; socket:[1502010]</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 13 -&gt; /var/lib/postgresql/9.4/main/base/16385/16591</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 14 -&gt; /var/lib/postgresql/9.4/main/base/16385/16593</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 15 -&gt; /var/lib/postgresql/9.4/main/base/16385/16634</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 16 -&gt; /var/lib/postgresql/9.4/main/base/16385/16399</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 17 -&gt; /var/lib/postgresql/9.4/main/base/16385/16406</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 18 -&gt; /var/lib/postgresql/9.4/main/base/16385/16408</strong><br class="title-page-name"/><strong class="calibre2">l-wx------ 1 postgres postgres 64 Jan 20 17:59 2 -&gt; /var/log/postgresql/postgresql-9.4-main.log</strong><br class="title-page-name"/><strong class="calibre2">lr-x------ 1 postgres postgres 64 Jan 20 17:59 3 -&gt; /dev/urandom</strong><br class="title-page-name"/><strong class="calibre2">l-wx------ 1 postgres postgres 64 Jan 20 17:59 4 -&gt; /dev/null <br class="title-page-name"/>(deleted)</strong><br class="title-page-name"/><strong class="calibre2">l-wx------ 1 postgres postgres 64 Jan 20 17:59 5 -&gt; /dev/null <br class="title-page-name"/>(deleted)</strong><br class="title-page-name"/><strong class="calibre2">lr-x------ 1 postgres postgres 64 Jan 20 17:59 6 -&gt; pipe:[1502013]</strong><br class="title-page-name"/><strong class="calibre2">l-wx------ 1 postgres postgres 64 Jan 20 17:59 7 -&gt; pipe:[1502013]</strong><br class="title-page-name"/><strong class="calibre2">lrwx------ 1 postgres postgres 64 Jan 20 17:59 8 -&gt; /var/lib/postgresql/9.4/main/base/16385/11943</strong><br class="title-page-name"/><strong class="calibre2">lr-x------ 1 postgres postgres 64 Jan 20 17:59 9 -&gt; pipe:[13125]</strong>
</pre>
<p class="calibre1">Nice, isn't it? So, let us do something that is absolute fun:</p>
<p class="calibre1">First, let's open a socket in read/write mode to the web server of a virtual machine created for this book and assign the descriptor <kbd class="calibre9">9</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ exec 9&lt;&gt; /dev/tcp/172.16.210.128/80 || exit 1</strong>  
</pre>
<p class="calibre1">Then, let us write something to it; nothing complex:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ printf 'GET /index2.html HTTP/1.1\nHost: 172.16.210.128\nConnection: close\n\n' &gt;&amp;9</strong>
</pre>
<p class="calibre1">We just requested a simple HTML file created for this example.</p>
<p class="calibre1">And now let us read the file descriptor <kbd class="calibre9">9</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat &lt;&amp;9</strong><br class="title-page-name"/><strong class="calibre2">HTTP/1.1 200 OK</strong><br class="title-page-name"/><strong class="calibre2">Date: Sat, 21 Jan 2017 17:57:33 GMT</strong><br class="title-page-name"/><strong class="calibre2">Server: Apache/2.4.10 (Debian)</strong><br class="title-page-name"/><strong class="calibre2">Last-Modified: Sat, 21 Jan 2017 17:57:12 GMT</strong><br class="title-page-name"/><strong class="calibre2">ETag: "f3-5469e7ef9e35f"</strong><br class="title-page-name"/><strong class="calibre2">Accept-Ranges: bytes</strong><br class="title-page-name"/><strong class="calibre2">Content-Length: 243</strong><br class="title-page-name"/><strong class="calibre2">Vary: Accept-Encoding</strong><br class="title-page-name"/><strong class="calibre2">Connection: close</strong><br class="title-page-name"/><strong class="calibre2">Content-Type: text/html</strong><br class="title-page-name"/><strong class="calibre2">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"</strong><br class="title-page-name"/><strong class="calibre2">   "http://www.w3.org/TR/html4/strict.dtd"&gt;</strong><br class="title-page-name"/><strong class="calibre2">&lt;HTML&gt;</strong><br class="title-page-name"/><strong class="calibre2">   &lt;HEAD&gt;</strong><br class="title-page-name"/><strong class="calibre2">      &lt;TITLE&gt;This is a test file&lt;/TITLE&gt;</strong><br class="title-page-name"/><strong class="calibre2">   &lt;/HEAD&gt;</strong><br class="title-page-name"/><strong class="calibre2">   &lt;BODY&gt;</strong><br class="title-page-name"/><strong class="calibre2">      &lt;P&gt;And we grabbed it through our descriptor!</strong><br class="title-page-name"/><strong class="calibre2">   &lt;/BODY&gt;</strong><br class="title-page-name"/><strong class="calibre2">&lt;/HTML&gt;</strong>  
</pre>
<p class="calibre1">That's it! We connected the file descriptor to a remote server through a socket, we could write to it and read the response, redirecting the streams over the network.</p>
<p class="calibre1">For dealing just with the command line, we have done a lot so far, but if we want to go further, we have to see how to script all these commands and make the most out of them. It is time for our first script!</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Time for the interpreter: the sha-bang</h1>
                
            
            <article>
                
<p class="calibre1">When the game gets tougher, a few concatenations on the command line cannot be enough to perform the tasks we are meant to accomplish. Too many bits on single lines are too messy, and we lack clarity, so better to store our commands or <kbd class="calibre9">builtins</kbd> in a file and have it executed.</p>
<p class="calibre1">When a script is executed, the system loader parses the first line looking for what is named the <kbd class="calibre9">sha-bang</kbd> or shebang, a sequence of characters.</p>
<pre class="codepackt">
<strong class="calibre2">#!</strong>  
</pre>
<p class="calibre1">This will force the loader to treat the following characters as a path to the interpreter and its optional arguments to be used to further parse the script, which will then be passed as another argument to the interpreter itself. So, at the end, the interpreter will parse the script and, this time, we will ignore the <kbd class="calibre9">sha-bang</kbd>, since its first character is a hash, usually indicating a comment inside a script and comments do not get executed. To go a little further, the <kbd class="calibre9">sha-bang</kbd> is what we call a 2-bit magic number, a constant sequence of numbers or text values used in Unix to identify file or protocol types. So, <kbd class="calibre9">0x23 0x21</kbd> is actually the ASCII representation of <kbd class="calibre9">#!</kbd>.</p>
<p class="calibre1">So, let's make a little experiment and create a tiny one line script:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo "echo \"This should go under the sha-bang\"" &gt; test.sh</strong>  
</pre>
<p class="calibre1">Just one line. Let's have a look:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat test.sh </strong><br class="title-page-name"/><strong class="calibre2">echo "This should go under the sha-bang"</strong>  
</pre>
<p class="calibre1">Nice, everything is as we expected. Has Linux something to say about our script? Let's ask:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ file test.sh </strong><br class="title-page-name"/><strong class="calibre2">test.sh: ASCII text</strong>  
</pre>
<p class="calibre1">Well, the file utility says that it is a plain file, and this is a simple text file indeed. Time for a nice trick:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ sed -i '1s/^/#!\/bin\/sh\n/' test.sh</strong>  
</pre>
<p class="calibre1">Nothing special; we just added a <kbd class="calibre9">sha-bang</kbd> pointing to <kbd class="calibre9">/bin/sh</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat test.sh </strong><br class="title-page-name"/><strong class="calibre2">#!/bin/sh</strong><br class="title-page-name"/><strong class="calibre2">echo "This should go under the sha-bang"</strong>  
</pre>
<p class="calibre1">As expected, the <kbd class="calibre9">sha-bang</kbd> is there at the beginning of our file:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ file test.sh </strong><br class="title-page-name"/><strong class="calibre2">test.sh: POSIX shell script, ASCII text executable</strong>  
</pre>
<p class="calibre1">No way, now it is a script! The file utility makes three different tests to identify the type of file it is dealing with. In order: file system tests, magic number tests, and language tests. In our case, it identified the magic numbers that represent the <kbd class="calibre9">sha-bang</kbd>, and thus a script, and this is what it told us: it is a script.</p>
<p class="calibre1">Now, a couple of final notes before moving on.</p>
<ul class="calibre12">
<li class="calibre13">You can omit the <kbd class="calibre9">sha-bang</kbd> if your script is not using a shell <kbd class="calibre9">builtins</kbd> or shell internals
<ul class="calibre23">
<li class="calibre13">Pay attention to <kbd class="calibre9">/bin/sh</kbd>, not everything that looks like an innocent executable is what it seems:</li>
</ul>
</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">gzarrelli:~$ ls -lah /bin/sh</strong><br class="title-page-name"/><strong class="calibre2">lrwxrwxrwx 1 root root 4 Nov  8  2014 /bin/sh -&gt; dash</strong>  
</pre>
<p class="calibre1">In some systems, <kbd class="calibre9">/bin/sh</kbd> is a symbolic link to a different kind of interpreter, and if you are using some internals or <kbd class="calibre9">builtins</kbd> of Bash, your script could have unwanted or unexpected outcomes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Calling your script</h1>
                
            
            <article>
                
<p class="calibre1">Well, we have our two-line script; time to see if it really does what we want it to do:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ./test.sh</strong><br class="title-page-name"/><strong class="calibre2">-bash: ./test.sh: Permission denied</strong>  
</pre>
<p class="calibre1">No way! It is not executing, and from the error message, it seems related to the file permissions:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ls -lah test.sh </strong><br class="title-page-name"/><strong class="calibre2">-rw-r--r-- 1 gzarrelli gzarrelli 41 Jan 21 18:56 test.sh</strong>  
</pre>
<p class="calibre1">Interesting. Let us recap what the file permissions are. As you can see, the line describing the properties of a file starts with a series of letters and lines.</p>
<table class="table">
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Type</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">User</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Group</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Others</strong></p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">-</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">rw-</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">r--</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">r--</kbd></p>
</td>
</tr>
</tbody>
</table>
<p class="calibre1"> </p>
<p class="calibre1">For type, we can have two main values, d - this is actually a directory, or <kbd class="calibre9">-</kbd> and means this is a regular file. Then, we can see what permissions are set for the user owning the file, for the group owning the file, and for all other users. As you may guess, <kbd class="calibre9">r</kbd> stands for permission to read; <kbd class="calibre9">w</kbd> stands for being able to write; <kbd class="calibre9">x</kbd> stands for permission to execute; and <kbd class="calibre9">-</kbd> means no right. These are all in the same order, first <kbd class="calibre9">r</kbd>, then <kbd class="calibre9">w</kbd>, then <kbd class="calibre9">x</kbd>. So  wherever you see a <kbd class="calibre9">-</kbd> instead of an <kbd class="calibre9">r</kbd>, <kbd class="calibre9">w</kbd>, or <kbd class="calibre9">x</kbd> , it means that particular right is not granted.</p>
<p class="calibre1">The same works for directory permission, except that <kbd class="calibre9">x</kbd> means you can traverse the directory; <kbd class="calibre9">r</kbd> means that you can enumerate the content of it; <kbd class="calibre9">w</kbd> means that you can modify the attributes of the directory and removes the entries that are eventually in it.</p>
<table class="table">
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Indicator</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">File type</strong></p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">-</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Regular file</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">b</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Block file (disk or partition)</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">c</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Character file, like the terminal under /dev</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">d</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Directory</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">l</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Symbolic link</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">p</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Named pipe (FIFO)</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">s</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Socket</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre1"> </p>
<p class="calibre1">So, going back to our file, we do not see any execution bit set. Why? Here, a shell <kbd class="calibre9">builtin</kbd> can help us:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ umask</strong><br class="title-page-name"/><strong class="calibre2">0022</strong>  
</pre>
<p class="calibre1">Does it make any sense to you? Well, it should, once we see how the permissions on files can be represented in numeric form. Think of permissions as bits of metadata pertaining to a file, one bit for each grant; no grant is <kbd class="calibre9">0</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">r-- = 100</strong><br class="title-page-name"/><strong class="calibre2">-w- = 010</strong><br class="title-page-name"/><strong class="calibre2">--x = 001</strong>  
</pre>
<p class="calibre1">Now, let's convert from binary to decimal:</p>
<table class="table">
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Permission</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Binary</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Decimal</strong></p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">r</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">100</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">4</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">w</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">010</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">2</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">x</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">001</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">1</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre1">Now, just combine the decimal values to obtain the final permission, but remember that you have to calculate read, write, and execution grants in triplets - one set for the user owning the file, one for the group, and one for the others.</p>
<p class="calibre1">Back again to our file, we can change its permissions in a couple of ways. Let's say we want it to be readable, writable, and executable by the user; readable and writable by the group; and only readable by the others. We can use the command <kbd class="calibre9">chmod</kbd> to accomplish this goal:</p>
<pre class="codepackt">
<strong class="calibre2">chmod u+rwx filename</strong><br class="title-page-name"/><strong class="calibre2">chmod g+wfilename</strong>  
</pre>
<p class="calibre1">So, <kbd class="calibre9">+</kbd> or  <kbd class="calibre9">-</kbd> add or subtract the permissions to the file or directory pointed and <kbd class="calibre9">u</kbd>, <kbd class="calibre9">g</kbd>, <kbd class="calibre9">w</kbd> to define which of the three sets of attributes we are referring to.</p>
<p class="calibre1">But we can speed things up using the numeric values:</p>
<pre class="codepackt">
<strong class="calibre2">User - rwx: 4+2+1 =7</strong><br class="title-page-name"/><strong class="calibre2">Group - rw: 4+2 = 6</strong><br class="title-page-name"/><strong class="calibre2">Other - r = 4</strong>  
</pre>
<p class="calibre1">So, the following command should do the trick in one line:</p>
<pre class="codepackt">
<strong class="calibre2">chmod  764 test.sh</strong>  
</pre>
<p class="calibre1">Time to verify:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ls -lah test.sh </strong><br class="title-page-name"/><strong class="calibre2">-rwxrw-r-- 1 gzarrelli gzarrelli 41 Jan 21 18:56 test.sh</strong>  
</pre>
<p class="calibre1">Here we are. So we just need to see whether our user can execute the file, as the permissions granted suggest:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ./test.sh</strong>  
</pre>
<p class="calibre1">This should go under the <kbd class="calibre9">sha-bang</kbd>.</p>
<p class="calibre1">Great, it works. Well, the script is not that complex, but served our purposes. But we left one question behind<em class="calibre20">: Why was the file created with that set of permissions? </em>As a preliminary explanation, I ran the command <kbd class="calibre9">umask</kbd>, and the result was <kbd class="calibre9">0022</kbd>  but did not go further.</p>
<p class="calibre1">Count the digits in <kbd class="calibre9">umask</kbd>, and those in the numeric modes for <kbd class="calibre9">chmod</kbd>. Four against three. What does that leading digit means? We have to introduce some special permission modes that enable some interesting features:</p>
<ul class="calibre12">
<li class="calibre13">Sticky bit. Think of it as a user right assertion on a file or directory. If a sticky bit is set on a directory, the files inside it can be deleted or renamed only by the file owner, the owner of the directory the file is in, or by root. Really useful in a shared directory to prevent one user from deleting or renaming some other user's file. The sticky bit is represented by the t letter at the end of the of the list of permissions or by the octal digit 1 at the beginning. Let's see how it works:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">gzarrelli:~$ chmod +t test.sh</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test.sh</strong><br class="title-page-name"/><strong class="calibre2">-rwxrw-r-T 1 gzarrelli gzarrelli 41 Jan 22 09:05 test.sh</strong>  
</pre>
<ul class="calibre12">
<li class="calibre13">Interestingly, the t is capital, not lower, as we were talking about. Maybe this sequence of commands will make everything clearer:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">gzarrelli:~$ chmod +t test.sh </strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test.sh </strong><br class="title-page-name"/><strong class="calibre2">-rwxrw-r-T 1 gzarrelli gzarrelli 41 Jan 22 09:05 test.sh </strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ chmod o+x test.sh </strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test.sh </strong><br class="title-page-name"/><strong class="calibre2">-rwxrw-r-t 1 gzarrelli gzarrelli 41 Jan 22 09:05 test.sh</strong> 
</pre>
<ul class="calibre12">
<li class="calibre13">You probably got it: the t attribute is a capital when, on the file or directory, the execution bix (x) is not set for the others (o).</li>
<li class="calibre13">And now, back to the origins:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">gzarrelli:~$ chmod 0764 test.sh </strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test.sh </strong><br class="title-page-name"/><strong class="calibre2">-rwxrw-r-- 1 gzarrelli gzarrelli 41 Jan 22 09:05 test.sh</strong> 
</pre>
<ul class="calibre12">
<li class="calibre13">We used the four-digit notations, and the leading <kbd class="calibre9">0</kbd> cleared out the <kbd class="calibre9">1</kbd> which referred to the sticky bit. Obviously, we could also use <kbd class="calibre9">chmod -t</kbd> to accomplish the same goal. One final note, if sticky bit and GUID are in conflicts, the sticky bit prevails in granting permissions.</li>
<li class="calibre13">
<ul class="calibre23">
<li class="calibre13"><strong class="calibre2">Set UID</strong>: The <strong class="calibre2">Set User ID</strong> (<strong class="calibre2">SUID</strong> upon execution) marks an executable, so that when it runs, it will do so as the file owner, with his privileges, and not as the user invoking it. Another tricky use is that, if assigned to a directory, all the files created or moved to that directory will have the ownership changed to the owner of the directory and not to the user actually performing the operation. Visually, it is represented by an s in the position of the user execution rights. The octal number referring to it is 4:</li>
</ul>
</li>
</ul>
<pre class="calibre24">
<strong class="calibre2">gzarrelli:~$ chmod u+s test.sh</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test.sh</strong><br class="title-page-name"/><strong class="calibre2">-rwsrw-r-- 1 gzarrelli gzarrelli 41 Jan 22 09:05 test.sh</strong>      
</pre>
<ul class="calibre12">
<li class="calibre13">
<ul class="calibre23">
<li class="calibre13"><strong class="calibre2">Set GID</strong>: The <strong class="calibre2">SGID</strong> (<strong class="calibre2">Set Group ID</strong> upon execution) marks an executable, so that when it is run, it does as the user invoking it was in the group that owns the file. If applied to a directory, every file created or moved to the directory will have the group set to the group owning the directory rather than the one the user performing the operation belongs to. Visually, it is represented by an <kbd class="calibre9">s</kbd> in the position of the group execution rights. The octal number referring to it is 2.</li>
</ul>
</li>
<li class="calibre13">Let's reset the permissions on our <kbd class="calibre9">test</kbd> file:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">gzarrelli:~$ chmod 0764 test.sh</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test.sh</strong><br class="title-page-name"/><strong class="calibre2">-rwxrw-r-- 1 gzarrelli gzarrelli 41 Jan 22 09:05 test.sh</strong>    
</pre>
<ul class="calibre12">
<li class="calibre13">Now we apply SGID using the octal digit referring to it:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">gzarrelli:~$ chmod 2764 test.sh</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test.sh</strong><br class="title-page-name"/><strong class="calibre2">-rwxrwSr-- 1 gzarrelli gzarrelli 41 Jan 22 09:05 test.sh</strong>  
</pre>
<p class="calibre1">In this example, the s is capital because we do not have the execution permission granted on the group; the same applies for SUID.</p>
<p class="calibre1">So, now we can go back again to our umask, and at this point you probably already know what is the meaning of the four-digit notation is. It is a command that modifies the permissions on a file creation, denying the permission bits. Taking our default creation mask for directory:</p>
<pre class="codepackt">
<strong class="calibre2">0777</strong>  
</pre>
<p class="calibre1">We can think of  <kbd class="calibre9">umask</kbd> of <kbd class="calibre9">0022</kbd> as:</p>
<pre class="codepackt">
<strong class="calibre2">0777 -</strong><br class="title-page-name"/><strong class="calibre2">0022</strong><br class="title-page-name"/><strong class="calibre2">------ </strong><br class="title-page-name"/><strong class="calibre2">0755</strong>  
</pre>
<p class="calibre1">Do not pay attention to the first <kbd class="calibre9">0</kbd>; it is the sticky bit and simply subtracts from the default grant mask for a directory, <kbd class="calibre9">rwx</kbd> for user, group, and others, the value of the <kbd class="calibre9">umask</kbd>. The remaining value is the current permission mask for file creation. If you are not comfortable with the numeric notation, you can see the <kbd class="calibre9">umask</kbd> values in the familiar <kbd class="calibre9">rwx</kbd> notation using:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ umask -S</strong><br class="title-page-name"/><strong class="calibre2">u=rwx,g=rx,o=rx</strong>  
</pre>
<p class="calibre1">For the files, the default mask is <kbd class="calibre9">666</kbd>, so:</p>
<pre class="codepackt">
<strong class="calibre2">0666 -</strong><br class="title-page-name"/><strong class="calibre2">0022</strong><br class="title-page-name"/><strong class="calibre2">--------</strong><br class="title-page-name"/><strong class="calibre2">0644</strong>  
</pre>
<p class="calibre1">It is actually a tad more complicated than this, but this rule of thumb will let you calculate the masks quickly. Let us try to create a new <kbd class="calibre9">umask</kbd>. First, let's reset the <kbd class="calibre9">umask</kbd> value:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ umask</strong><br class="title-page-name"/><strong class="calibre2">0000</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ umask -S</strong><br class="title-page-name"/><strong class="calibre2">u=rwx,g=rwx,o=rwx</strong>  
</pre>
<p class="calibre1">As we can see, nothing gets subtracted:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ touch test-file</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ mkdir test-dir</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah test-*</strong><br class="title-page-name"/><strong class="calibre2">-rw-rw-rw- 1 gzarrelli gzarrelli    0 Jan 22 18:01 test-file</strong><br class="title-page-name"/><br class="title-page-name"/><strong class="calibre2">test-dir:</strong><br class="title-page-name"/><strong class="calibre2">total 8.0K</strong><br class="title-page-name"/><strong class="calibre2">drwxrwxrwx 2 gzarrelli gzarrelli 4.0K Jan 22 18:01 .</strong><br class="title-page-name"/><strong class="calibre2">drwxr-xr-x 4 gzarrelli gzarrelli 4.0K Jan 22 18:01 ..</strong>  
</pre>
<p class="calibre1">The <kbd class="calibre9">test</kbd> file has <kbd class="calibre9">666</kbd> access rights and the directory <kbd class="calibre9">777</kbd>. This is really way too much:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ umask o-rwx,g-w</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ umask -S</strong><br class="title-page-name"/><strong class="calibre2">u=rwx,g=rx,o=</strong><br class="title-page-name"/><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ touch 2-test-file</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ mkdir 2-test-dir</strong><br class="title-page-name"/><strong class="calibre2">gzarrelli:~$ ls -lah 2-test-*</strong><br class="title-page-name"/><strong class="calibre2">-rw-r----- 1 gzarrelli gzarrelli    0 Jan 22 18:03 2-test-file</strong><br class="title-page-name"/><br class="title-page-name"/><strong class="calibre2">2-test-dir:</strong><br class="title-page-name"/><strong class="calibre2">total 8.0K</strong><br class="title-page-name"/><strong class="calibre2">drwxr-x--- 2 gzarrelli gzarrelli 4.0K Jan 22 18:03 .</strong><br class="title-page-name"/><strong class="calibre2">drwxr-xr-x 5 gzarrelli gzarrelli 4.0K Jan 22 18:03 ..</strong>  
</pre>
<p class="calibre1">As you can see, the permissions are 750 for directories and 640 for files. A bit of math will help:</p>
<pre class="codepackt">
<strong class="calibre2">0777 -</strong><br class="title-page-name"/><strong class="calibre2">0750</strong><br class="title-page-name"/><strong class="calibre2">--------</strong><br class="title-page-name"/><strong class="calibre2">0027</strong>  
</pre>
<p class="calibre1">You would get the same result from the <kbd class="calibre9">umask</kbd> command:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ umask</strong><br class="title-page-name"/><strong class="calibre2">0027</strong>  
</pre>
<p class="calibre1">All these settings last as long as you are logged in to the session, so if you want to make them permanent, just add the <kbd class="calibre9">umask</kbd> call with the appropriate argument to<kbd class="calibre9">/etc/bash.bashrc</kbd>,  or <kbd class="calibre9">/etc/profile</kbd> for a system-wide effect or, for a single user mask, add it to the <kbd class="calibre9">.bashrc</kbd> file inside the user home directory.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Something went wrong, let's trace it</h1>
                
            
            <article>
                
<p class="calibre1">So, we have a new tiny script named <kbd class="calibre9">disk.sh</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat disk.sh</strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The total disk allocation for this system is: "</strong>    <br class="title-page-name"/><strong class="calibre2">echo -e "\n"</strong>    <br class="title-page-name"/><strong class="calibre2">df -h</strong>    <br class="title-page-name"/><strong class="calibre2">echo -e "\n</strong>    <br class="title-page-name"/><strong class="calibre2">df -h | grep /$ | awk '{print "Space left on root partition: " $4}'</strong>  
</pre>
<p class="calibre1">Nothing special, a shebang, a couple of echoes on a new line just to have some vertical spacing, the output of <kbd class="calibre9">df -h</kbd> and the same command but parsed by <kbd class="calibre9">awk</kbd> to give us a meaningful message. Let's run it:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./disk.sh</strong>  
</pre>
<p class="calibre1">The total disk allocation for this system is:</p>
<pre class="codepackt">
<strong class="calibre2">Filesystem      Size  Used Avail Use% Mounted on</strong><br class="title-page-name"/><strong class="calibre2">/dev/dm-0        19G   15G  3.0G  84% /</strong><br class="title-page-name"/><strong class="calibre2">udev             10M     0   10M   0% /dev</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            99M  9.1M   90M  10% /run</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           248M   80K  248M   1% /dev/shm</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           5.0M  4.0K  5.0M   1% /run/lock</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           248M     0  248M   0% /sys/fs/cgroup</strong><br class="title-page-name"/><strong class="calibre2">/dev/sda1       236M   33M  191M  15% /boot</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            50M   12K   50M   1% /run/user/1000</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            50M     0   50M   0% /run/user/0</strong><br class="title-page-name"/><strong class="calibre2">Space left on root partition: 3.0G</strong>  
</pre>
<p class="calibre1">Nothing too complicated, a bunch of easy commands, which in case of failure print an error message on the standard output. However, let's think for a moment that we have a more flexible script, more lines, some variable assignments, loops, and other constructs, and something goes wrong, but the output does not tell us anything. In this case, be handy to see a method that is actually running inside our script so that we can see the output of the commands, the variable assignments, and so forth. In Bash, this is possible; thanks to the <kbd class="calibre9">set</kbd> command associated with the <kbd class="calibre9">-x</kbd> argument, which shows all the commands and arguments in the script printed to the <kbd class="calibre9">stdout</kbd>, after the commands have been expanded and before they are actually invoked. The same behavior can be obtained running a subshell with the <kbd class="calibre9">-x</kbd> argument. Let's see what would happen if it was used with our script:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ bash -x disk.sh</strong><br class="title-page-name"/><strong class="calibre2">+ echo 'The total disk allocation for this system is: '</strong><br class="title-page-name"/><strong class="calibre2">The total disk allocation for this system is:</strong><br class="title-page-name"/><strong class="calibre2">+ echo -e '\n'</strong>    <br class="title-page-name"/><strong class="calibre2">+ df -h</strong><br class="title-page-name"/><strong class="calibre2">Filesystem      Size  Used Avail Use% Mounted on</strong><br class="title-page-name"/><strong class="calibre2">/dev/dm-0        19G   15G  3.0G  84% /</strong><br class="title-page-name"/><strong class="calibre2">udev             10M     0   10M   0% /dev</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            99M  9.1M   90M  10% /run</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           248M   80K  248M   1% /dev/shm</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           5.0M  4.0K  5.0M   1% /run/lock</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           248M     0  248M   0% /sys/fs/cgroup</strong><br class="title-page-name"/><strong class="calibre2">/dev/sda1       236M   33M  191M  15% /boot</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            50M   12K   50M   1% /run/user/1000</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            50M     0   50M   0% /run/user/0</strong><br class="title-page-name"/><strong class="calibre2">+ echo -e '\n'</strong>    <br class="title-page-name"/><strong class="calibre2">+ awk '{print "Space left on root partition: " $4}'</strong><br class="title-page-name"/><strong class="calibre2">+ grep /dm-0</strong><br class="title-page-name"/><strong class="calibre2">+ df -h</strong><br class="title-page-name"/><strong class="calibre2">Space left on root partition: 3.0G</strong>  
</pre>
<p class="calibre1">Now it is quite easy to understand how the stream of data flows inside the script: all the lines beginning with a <kbd class="calibre9">+</kbd> sign are commands, and the following lines are outputs.</p>
<p class="calibre1">Let's think for a moment that we have longer scripts; for most parts, we are sure that things work fine. For some lines, we are not completely sure of the outcome. Debugging everything would be <em class="calibre20">noisy</em>. In this case, we can use <kbd class="calibre9">set-x</kbd> to enable the logging only for those lines we need to inspect, turning it off with <kbd class="calibre9">set+x</kbd> when it is no longer needed. Time to modify the script, as follows:</p>
<pre class="codepackt">
#!/bin/bash  <br class="title-page-name"/>set -x <br class="title-page-name"/>echo "The total disk allocation for this system is: "  <br class="title-page-name"/>echo -e "\n"  <br class="title-page-name"/>df -h  <br class="title-page-name"/>echo -e "\n"  <br class="title-page-name"/>set +x  <br class="title-page-name"/>df -h | grep /dm-0 | awk '{print "Space left on root partition: " $4}' 
</pre>
<p class="calibre1">And now, time to run it again, as follows:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ ./disk.sh</strong><br class="title-page-name"/><strong class="calibre2">+ echo 'The total disk allocation for this system is: '</strong><br class="title-page-name"/><strong class="calibre2">The total disk allocation for this system is:</strong><br class="title-page-name"/><strong class="calibre2">+ echo -e '\n'</strong>    <br class="title-page-name"/><strong class="calibre2">+ df -h</strong><br class="title-page-name"/><strong class="calibre2">Filesystem      Size  Used Avail Use% Mounted on</strong><br class="title-page-name"/><strong class="calibre2">/dev/dm-0        19G   15G  3.0G  84% /</strong><br class="title-page-name"/><strong class="calibre2">udev             10M     0   10M   0% /dev</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            99M  9.1M   90M  10% /run</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           248M   80K  248M   1% /dev/shm</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           5.0M  4.0K  5.0M   1% /run/lock</strong><br class="title-page-name"/><strong class="calibre2">tmpfs           248M     0  248M   0% /sys/fs/cgroup</strong><br class="title-page-name"/><strong class="calibre2">/dev/sda1       236M   33M  191M  15% /boot</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            50M   12K   50M   1% /run/user/1000</strong><br class="title-page-name"/><strong class="calibre2">tmpfs            50M     0   50M   0% /run/user/0</strong><br class="title-page-name"/><strong class="calibre2">+ echo -e '\n'</strong>    <br class="title-page-name"/><strong class="calibre2">+ set +x</strong><br class="title-page-name"/><strong class="calibre2">Space left on root partition: 3.0G</strong>  
</pre>
<p class="calibre1">As you can see, we see the instructions given in the block marked by <kbd class="calibre9">set-x</kbd>, and we also see the <kbd class="calibre9">set+x</kbd> instruction given, but then, after this, the line with <kbd class="calibre9">awk</kbd> disappears and we see only its output, filtering out what was not so interesting for us and leaving only the part we want to focus on.</p>
<p class="calibre1">This is not a powerful debugging system typical of more complex programming languages, but it can be really helpful in scripts of hundreds of lines where we can lose track of sophisticated structures, such as evaluations, cycles, or variable assignments, which make the scripts more expressive but even more difficult to get hold of and master. So, now that we are clear on how to debug a file, which permissions are needed to make it safely executable, and how to shell parse the command line, we are ready to spice things up looking at how we can use variables to add more flexibility to our hand-crafted tools.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Variables</h1>
                
            
            <article>
                
<p class="calibre1">What is a variable? We could answer that it is something not constant; nice joke, but it would not help us so much. Better to think of it as a bucket where we can store some information for later processing: at a certain point of your script you get a value, a piece of info that you do not want to process at that very moment, so you fit it into a variable that you will recall later in the script. This is, in an intuitive way, the use of a variable, a way to allocate a part of the system memory to hold your data.</p>
<p class="calibre1">So far, we have seen that our scripts could retrieve some pieces of information from the system and had to process them straight away, since, without the use of a variable, we had no way to further process the information except for concatenating or redirecting the output to another program. This forced us to have a linear execution, no flexibility, no complexity: once you get some data, you process it straight away redirecting the file descriptors, one link in the chain after the other.</p>
<p class="calibre1">A variable is nothing really new; a lot of programming languages use them to store different types of data, integers, floating, strings, and you can see many different kinds of variables related to different kinds of data they hold. So, you have probably heard about casting a variable, which means, roughly, changing its type: you get a value as a string of numbers and you want to use it as an integer, so you cast it as an <kbd class="calibre9">int</kbd> and proceed processing it using some math functions.</p>
<p class="calibre1">Our shell is not so sophisticated, and it has only one type of variable or, better, it has none: whatever you store in it can be later processed without any casting. This can be nice because you do not have to pay attention to what type of data you are holding; you get a number as a string and can process it straight away as an integer. Nice and easy, but we must remember that restrictions are in place not just to prevent us from doing something, but also to help us not do something that would be unhealthy for our code, and this is exactly the risk in having flat variables, to write some piece of code that simply does not work, cannot work.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Assigning a variable</h1>
                
            
            <article>
                
<p class="calibre1">As we just saw, a variable is a way to store a value: we get a value, assign it to a variable and refer to the latter to access the former. The operation of retrieving the content of a variable is named <strong class="calibre2">variable substitution</strong>. A bit like, if you think about descriptors, the way that  you use them to access files. The way you assign a variable is quite straightforward:</p>
<pre class="codepackt">
<strong class="calibre2">LABEL=value</strong>  
</pre>
<p class="calibre1"><kbd class="calibre9">LABEL</kbd> can be any string, can have upper and lowercase, start with or contain numbers and underscores, and it is case sensitive.</p>
<p class="calibre1">The assignment is performed by the <kbd class="calibre9">=</kbd> character, which, be wary, is not the same as the <em class="calibre20">equal to </em><kbd class="calibre9">==</kbd> sign; they are two different things and are used in different contexts. Finally, whatever you put at the right of the assignment operator becomes the value of the variable. So, let's assign some value to our first variable:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ FIRST_VARIABLE=amazing</strong>  
</pre>
<p class="calibre1">Now we can try to access the value trying to perform an action on the variable itself:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo FIRST_VARIABLE</strong><br class="title-page-name"/><strong class="calibre2">FIRST_VARIABLE</strong>  
</pre>
<p class="calibre1">Not exactly what we expected. We want the content, not the name of the variable. Have a look at this:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo $FIRST_VARIABLE</strong><br class="title-page-name"/><strong class="calibre2">amazing</strong>  
</pre>
<p class="calibre1">This is better. Using the <kbd class="calibre9">$</kbd> character at the beginning of the variable name identified this as a variable and not a plain string, so we had access to the content. This means that, from now on, we can just use the variable with any commands instead of referring to the whole content of it. So, let us try again:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo $first_variable</strong>    <br class="title-page-name"/><strong class="calibre2">gzarrelli:~$</strong>  
</pre>
<p class="calibre1">The output is null, and not 0; we will see later on that zero is not the same as null, since null is no value but zero is indeed a value, an integer. What does the previous output mean? Simply that our labels are case sensitive, change one character from upper to lower or vice versa, and you will have a new variable which, since you did not assign any value to it, does not hold any value, hence the null you receive once you try to access it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Keep the variable name safe</h1>
                
            
            <article>
                
<p class="calibre1">We just saw that <kbd class="calibre9">$label</kbd> is the way we reference the content of a variable, but if you have a look at some scripts, you can find another way of retrieving variable content:</p>
<pre class="codepackt">
<strong class="calibre2">${label}</strong>  
</pre>
<p class="calibre1">The two ways of referencing the content of a variable are both valid, and you can use the first, more compact, in any case except when concatenating the variable name to any characters, which could change the variable name itself. In this case, it becomes mandatory to use the extended version of the variable substitution, as the following example will make clear.</p>
<p class="calibre1">Let's start printing our variable again:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo $FIRST_VARIABLE</strong><br class="title-page-name"/><strong class="calibre2">amazing</strong>  
</pre>
<p class="calibre1">Now, let's do it again using the extended version of substitution:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo ${FIRST_VARIABLE}</strong><br class="title-page-name"/><strong class="calibre2">amazing</strong>  
</pre>
<p class="calibre1">Exactly the same output since, as we said, these two methods are equivalent. Now, let us add a string to our variable name:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo $FIRST_VARIABLEngly</strong>    <br class="title-page-name"/><strong class="calibre2">gzarrelli:~$</strong>  
</pre>
<p class="calibre1">Nothing, and we can understand why the name of the variable changed; so we have no content to access to. But now, let us try the extended way:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo ${FIRST_VARIABLE}ly</strong><br class="title-page-name"/><strong class="calibre2">amazingly</strong>  
</pre>
<p class="calibre1">Bingo! The name of the variable has been preserved so that the shell was able to reference its value and then concatenated it to the <kbd class="calibre9">ly</kbd> string we added to the name.</p>
<p class="calibre1">Keep this difference in mind, because the graphs will be a handy way to concatenate strings to a variable to spice your scripts up and, as a good rule of thumb, refer to variables using the graphs. This will help you avoid unwanted hindrances.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Variables with limited scope</h1>
                
            
            <article>
                
<p class="calibre1">As we said before, variables have no type in shell, and this makes them somehow easy to use, but we must pay attention to some sorts of limits to their use.</p>
<ul class="calibre12">
<li class="calibre13">First, the content of a variable is accessible only after the value has been assigned</li>
<li class="calibre13">An example will make everything clearer:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">gzarrelli:~$ cat disk-space.sh </strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">echo -e "\n"</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The space left is ${disk_space}"</strong><strong class="calibre2"> </strong><br class="title-page-name"/><strong class="calibre2">disk_space=`df -h | grep /$ | awk '{print $4}'`</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The space left is ${disk_space}</strong>  
</pre>
<p class="calibre1">We used the variable disk space to store the result of the <kbd class="calibre9">df</kbd> command and try to reference its value on the preceding and following lines. Let us run it in debug mode:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ sh -x disk-space.sh </strong><br class="title-page-name"/><strong class="calibre2">+ echo -e \n</strong><br class="title-page-name"/><strong class="calibre2">-e </strong>    <br class="title-page-name"/><strong class="calibre2">+ echo The space left is </strong><br class="title-page-name"/><strong class="calibre2">The space left is </strong><br class="title-page-name"/><strong class="calibre2">+ awk {print $4}</strong><br class="title-page-name"/><strong class="calibre2">+ grep /dm-0</strong><br class="title-page-name"/><strong class="calibre2">+ df -h</strong><br class="title-page-name"/><strong class="calibre2">+ disk_space=3.0G</strong><br class="title-page-name"/><strong class="calibre2">+ echo The space left is 3.0G</strong><br class="title-page-name"/><strong class="calibre2">The space left is 3.0G</strong>  
</pre>
<p class="calibre1">As we can see, the flow of execution is sequential: you access the value of the variable only after it is instanced, not before. And bear in mind that the first line actually printed something: a null value. Well, now let us print the variable on the command line:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ echo ${disk_space}</strong>    <br class="title-page-name"/><strong class="calibre2">gzarrelli:~$</strong>  
</pre>
<p class="calibre1">The variable is instanced inside the script, and it is confined there, inside the shell spawned to invoke the command and nothing passed to our main shell.</p>
<p class="calibre1">We can ourselves impose some restrictions to a variable, as we will see with the next example. In this new case, we will introduce the use of a function, something that we are going to look at in more detail further in this book and the keyword local:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat disk-space-function.sh</strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">echo -e "\n"</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The space left is ${disk_space}"</strong>    <br class="title-page-name"/><strong class="calibre2">disk_space=`df -h | grep /dm-0 | awk '{print $4}'`</strong>    <br class="title-page-name"/><strong class="calibre2">print () {</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The space left inside the function is ${disk_space}"</strong>    <br class="title-page-name"/><strong class="calibre2">local available=yes</strong><br class="title-page-name"/><strong class="calibre2">last=yes</strong><br class="title-page-name"/><strong class="calibre2">echo "Is the available variable available inside the function? ${available}"</strong>    <br class="title-page-name"/><strong class="calibre2">}</strong><br class="title-page-name"/><strong class="calibre2">echo "Is the last variable available outside the function before it is invoked? ${last}"</strong><br class="title-page-name"/><strong class="calibre2">print</strong><br class="title-page-name"/><strong class="calibre2">echo "The space left outside is ${disk_space}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Is the available variable available outside the function? ${available}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Is the last variable available outside the function after it is invoked? ${last}"</strong>  
</pre>
<p class="calibre1">Now let us run it:</p>
<pre class="codepackt">
<strong class="calibre2">gzarrelli:~$ cat di./pace-function.sh</strong><br class="title-page-name"/><strong class="calibre2">The space left is</strong><br class="title-page-name"/><strong class="calibre2">Is the last variable available outside the function before it is invoked?</strong><br class="title-page-name"/><strong class="calibre2">The space left inside the function is 3.0G</strong><br class="title-page-name"/><strong class="calibre2">Is the available variable available inside the function? yes</strong><br class="title-page-name"/><strong class="calibre2">The space left outside is 3.0G</strong><br class="title-page-name"/><strong class="calibre2">Is the available variable available outside the function?</strong><br class="title-page-name"/><strong class="calibre2">Is the last variable available outside the function after it is invoked? yes</strong>  
</pre>
<p class="calibre1">What can we see here?</p>
<p class="calibre1">The content of variable <kbd class="calibre9">disk_space</kbd> is not available before the variable itself is instanced. We already knew this.</p>
<p class="calibre1">The content of a variable instanced inside a function is not available when it is defined in the function, but when the function itself is invoked.</p>
<p class="calibre1">A variable marked by the keyword local and defined inside a function is available only inside the function and only when the function is invoked. Outside the block of code defined by the function itself; the local variable is not visible to the rest of the script. So, using local variables can be handy to write recursive code, even though not recommended.</p>
<p class="calibre1">So, we just saw a few ways to make a variable really limited in its scope, and we also noted that its content is not available outside the script it was instanced in. Wouldn't it be nice to have some variables with a broader scope, capable of influencing the execution of each and every script, something at environment level? It would, and from now on we are going to explore the environment variables.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Environment variables</h1>
                
            
            <article>
                
<p class="calibre1">As we discussed earlier, the shell comes with an environment, which dictates what it can do and what not, so let's just have a look at what these variables are using the <kbd class="calibre9">env</kbd> command:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ env</strong>    <br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">LANG=en_GB.utf8</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">DISPLAY=:0.0</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">USER=zarrelli</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">DESKTOP_SESSION=xfce</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">PWD=/home/zarrelli/Documents</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">HOME=/home/zarrelli</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">SHELL=/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">LANGUAGE=en_GB:en</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">GDMSESSION=xfce</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">LOGNAME=zarrelli</strong><br class="title-page-name"/><strong class="calibre2">...</strong><br class="title-page-name"/><strong class="calibre2">PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</strong><br class="title-page-name"/><strong class="calibre2">_=/usr/bin/env</strong>  
</pre>
<p class="calibre1">Some of the variables have been omitted for the sake of clarity; otherwise, the output would have been too long, but still we can see something interesting. We can have a look at the <kbd class="calibre9">PATH</kbd> variable content, which influences where the shell will look for a program or script to execute. We can see which shell is being currently used, by which user, what the current directory is and the previous one.</p>
<p class="calibre1">But environment variables can not only be read; they can be instanced using the export command:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ export TEST_VAR=awesome</strong>  
</pre>
<p class="calibre1">Now, let us read it:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~/$ echo ${TEST_VAR}</strong><br class="title-page-name"/><strong class="calibre2">awesome</strong>  
</pre>
<p class="calibre1">That is it, but since this was just a test, it is better to unset the variable so that we do not leave unwanted values around the shell environment:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ unset TEST_VAR</strong>  
</pre>
<p class="calibre1">And now, let us try to get the content of the variable:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~/$ echo ${TEST_VAR}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~/$</strong>  
</pre>
<p class="calibre1">No way! The variable content is no more, and as you will see now, the environment variables disappear once their shell is no more. Let's have a look at the following script:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ cat setting.sh </strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">export MYTEST=NOWAY</strong>    <br class="title-page-name"/><strong class="calibre2">env | grep MYTEST</strong>    <br class="title-page-name"/><strong class="calibre2">echo ${MYTEST}</strong>  
</pre>
<p class="calibre1">We simply instance a new variable, <kbd class="calibre9">grep</kbd> for it in the environment and then print its content to the <kbd class="calibre9">stdout</kbd>. What happens once invoked?</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli@:~$ ./setting.sh ; echo ${MYTEST}</strong><br class="title-page-name"/><strong class="calibre2">MYTEST=NOWAY</strong><br class="title-page-name"/><strong class="calibre2">NOWAY</strong>    <br class="title-page-name"/><strong class="calibre2">zarrelli:~$ </strong>  
</pre>
<p class="calibre1">We can easily see that the variable was grepped on the <kbd class="calibre9">env</kbd> output, so this means that the variable is actually instanced at the environment level and we could access its content and print it. But then we executed the echo of the content of <kbd class="calibre9">MYTEST</kbd> outside the script again, and we could just print a blank line. If you remember, when we execute a script, the shell forks a new shell and passes to it its full environment, thus the command inside the program shell can manipulate the environment. But then, once the program is terminated, the related shell is terminated, and its environment variables are lost; the child shell inherits the environment from the parent, the parent does not inherit the environment from the child.</p>
<p class="calibre1">Now, let us go back to our shell, and let us see how we can manipulate the environment to our advantage. If you remember, when the shell has to invoke a program or a script, it looks inside the content of the <kbd class="calibre9">PATH</kbd> environment variable to see if it can find it in one of the paths listed. If it is not there, the executable or the script cannot be invoked just with their names, they have to be called passing the full path to it. But have a look at what this script is capable of doing:</p>
<pre class="codepackt">
#!/bin/bash    <br class="title-page-name"/>echo "We are into the directory"<br class="title-page-name"/>pwd  
</pre>
<p class="calibre1">We print our current user directory:</p>
<pre class="codepackt">
<strong class="calibre2">echo "What is our PATH?"</strong><br class="title-page-name"/><strong class="calibre2">echo ${PATH}</strong>  
</pre>
<p class="calibre1">And now we print the content of the environment <kbd class="calibre9">PATH</kbd> variable:</p>
<pre class="codepackt">
<strong class="calibre2">echo "Now we expand the path for all the shell"</strong><br class="title-page-name"/><strong class="calibre2">export PATH=${PATH}:~/tmp</strong>  
</pre>
<p class="calibre1">This is a little tricky. Using the graphs, we preserve the content of the variable and add <kbd class="calibre9">a</kbd>, which is the delimiter for each path inside the list held by <kbd class="calibre9">PATH</kbd>, plus the <kbd class="calibre9">~/tmp</kbd>, which literally means the <kbd class="calibre9">tmp</kbd> directory inside the <kbd class="calibre9">home</kbd> directory of the current user:</p>
<pre class="codepackt">
<strong class="calibre2">echo "And now our PATH is..."</strong><br class="title-page-name"/><strong class="calibre2">echo ${PATH}</strong><br class="title-page-name"/><strong class="calibre2">echo "We are looking for the setting.sh script!"</strong><br class="title-page-name"/><strong class="calibre2">which setting.sh</strong><br class="title-page-name"/><strong class="calibre2">echo "Found it!"</strong>  
</pre>
<p class="calibre1">And we actually found it. Well, you could also add some evaluation to make the <kbd class="calibre9">echo</kbd> conditional, but we will see such a thing later on. Time for something funny:</p>
<pre class="codepackt">
<strong class="calibre2">echo "Time for magic!"</strong><br class="title-page-name"/><strong class="calibre2">echo  "We are looking for the setting.sh script!"</strong><br class="title-page-name"/><strong class="calibre2">env PATH=/usr/bin which setting.sh</strong><br class="title-page-name"/><strong class="calibre2">echo "BOOOO, nothing!"</strong>  
</pre>
<p class="calibre1">Pay attention to the line starting with <kbd class="calibre9">env</kbd>; this command is able to overrun the <kbd class="calibre9">PATH</kbd> environment variable and to pass its own variable and related value. The same behavior can be obtained using export instead of <kbd class="calibre9">env</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">echo "Second try..."</strong><br class="title-page-name"/><strong class="calibre2">env PATH=/usr/sbin which setting.sh</strong>    <br class="title-page-name"/><strong class="calibre2">echo "No way..."</strong>  
</pre>
<p class="calibre1">This last try is even worse. We modified the content of the <kbd class="calibre9">$PATH</kbd> variable which now points to a directory where we cannot find the script. So, not being in the <kbd class="calibre9">$PATH</kbd>, the script cannot be invoked by just its name:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./setenv.sh </strong>  
</pre>
<p class="calibre1">We are in the directory:</p>
<pre class="codepackt">
<strong class="calibre2">/home/zarrelli/Documents/My books/Mastering bash/Chapter 1/Scripts</strong>  
</pre>
<p class="calibre1">What is our <kbd class="calibre9">PATH</kbd>?</p>
<pre class="codepackt">
<strong class="calibre2">/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</strong>  
</pre>
<p class="calibre1">Now we expand the path for all the shell.</p>
<p class="calibre1">And now our <kbd class="calibre9">PATH</kbd> is:</p>
<pre class="codepackt">
<strong class="calibre2">/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/home<br class="title-page-name"/>/zarrelli/tmp</strong>  
</pre>
<p class="calibre1">We are looking for the <kbd class="calibre9">setting.sh</kbd> script!</p>
<pre class="codepackt">
<strong class="calibre2">/home/zarrelli/tmp/setting.sh</strong>  
</pre>
<p class="calibre1">Found it!</p>
<p class="calibre1">Time for magic!</p>
<p class="calibre1">We are looking for the <kbd class="calibre9">setting.sh</kbd> script!</p>
<p class="calibre1">BOOOO, nothing!</p>
<p class="calibre1">Second try...</p>
<p class="calibre1"><kbd class="calibre9">env</kbd>: 'which': No such file or directory</p>
<p class="calibre1">No way...</p>
<table class="table">
<tbody class="calibre6">
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Environment variable</strong></p>
</td>
<td class="calibre8">
<p class="calibre1"><strong class="calibre2">Use</strong></p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">BASH_VERSION</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The version of the current Bash session</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">HOME</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The home directory of the current user</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">HOSTNAME</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The name of the host</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">LANG</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The locale used to manage the data</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">PATH</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The search path for the shell</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">PS1</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The prompt configuration</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">PWD</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The path to the current directory</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">USER</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">The name of the currently logged in user</p>
</td>
</tr>
<tr class="calibre7">
<td class="calibre8">
<p class="calibre1"><kbd class="calibre9">LOGNAME</kbd></p>
</td>
<td class="calibre8">
<p class="calibre1">Same as user</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre1"> </p>
<p class="calibre1">We can also use <kbd class="calibre9">env</kbd> with the <kbd class="calibre9">-i</kbd> argument to strip down all the environment variables and just pass to the process what we want, as we can see in the following examples. Let's start with something easy:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ cat env-test.sh </strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">env PATH=HELLO /usr/bin/env | grep -A1 -B1 ^PATH</strong>  
</pre>
<p class="calibre1">Nothing too difficult, we modified the <kbd class="calibre9">PATH</kbd> variable passing a useless value because <kbd class="calibre9">HELLO</kbd> is not a searchable path, then we had to invoke <kbd class="calibre9">env</kbd> using the full path because <kbd class="calibre9">PATH</kbd> became useless. Finally, we piped everything to the input of <kbd class="calibre9">grep</kbd>, which will select all the rows (<kbd class="calibre9">^)</kbd> starting with the string <kbd class="calibre9">PATH</kbd>, printing that line and one line before and after:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./env-test.sh </strong>    <br class="title-page-name"/><strong class="calibre2">2705-XDG_CONFIG_DIRS=/etc/xdg</strong><br class="title-page-name"/><strong class="calibre2">2730:PATH=HELLO</strong><br class="title-page-name"/><strong class="calibre2">2741-SESSION_MANAGER=local/moveaway:@/tmp/.ICE-unix/888,unix/moveaway:/tmp/.ICE-unix/888</strong>  
</pre>
<p class="calibre1">Now, let's modify the script, adding <kbd class="calibre9">-i</kbd> to the first <kbd class="calibre9">env</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ cat env-test.sh </strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">env -i PATH=HELLO /usr/bin/env | grep -A1 -B1 ^PATH</strong>  
</pre>
<p class="calibre1">And now let us run it:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~/$ ./env-test.sh </strong><br class="title-page-name"/><strong class="calibre2">PATH=HELLO</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~/$ </strong>  
</pre>
<p class="calibre1">Can you guess what happened? Another change will make everything clearer:</p>
<pre class="codepackt">
<strong class="calibre2">env -i PATH=HELLO /usr/bin/env </strong>  
</pre>
<p class="calibre1">No <kbd class="calibre9">grep</kbd>; we are able to see the complete output of the second <kbd class="calibre9">env</kbd> command:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ env -i PATH=HELLO /usr/bin/env</strong><br class="title-page-name"/><strong class="calibre2">PATH=HELLO</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ </strong>  
</pre>
<p class="calibre1">Just <kbd class="calibre9">PATH=HELLO env</kbd> with the argument <kbd class="calibre9">-i</kbd> passed to the second <kbd class="calibre9">env</kbd> process, a stripped down environment with only the variables specified on the command line:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ env -i PATH=HELLO LOGNAME=whoami/usr/bin/env</strong><br class="title-page-name"/><strong class="calibre2">PATH=HELLO</strong><br class="title-page-name"/><strong class="calibre2">LOGNAME=whoami/usr/bin/env</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$</strong>  
</pre>
<p class="calibre1">Because we are engaged in stripping down, let us see how we can make a function disappear with the well-known <kbd class="calibre9">unset -f</kbd> command:</p>
<pre class="codepackt">
<strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">echo -e "\n"</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The space left is ${disk_space}"</strong>    <br class="title-page-name"/><strong class="calibre2">disk_space=`df -h | grep vg-root | awk '{print $4}'`</strong>    <br class="title-page-name"/><strong class="calibre2">print () {</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The space left inside the function is ${disk_space}"</strong>    <br class="title-page-name"/><strong class="calibre2">local available=yes</strong><br class="title-page-name"/><strong class="calibre2">last=yes</strong>    <br class="title-page-name"/><strong class="calibre2">echo "Is the available variable available inside the function? ${available}"</strong>   <br class="title-page-name"/><strong class="calibre2">}</strong>    <br class="title-page-name"/><strong class="calibre2">echo "Is the last variable available outside the function before it is invoked? ${last}"</strong><br class="title-page-name"/><strong class="calibre2">print</strong><br class="title-page-name"/><strong class="calibre2">echo "The space left outside is ${disk_space}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Is the available variable available outside the function? ${available}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Is the last variable available outside the function after it is invoked? ${last}"</strong>    <br class="title-page-name"/><strong class="calibre2">echo "What happens if we unset a variable, like last?"</strong><br class="title-page-name"/><strong class="calibre2">unset last</strong><br class="title-page-name"/><strong class="calibre2">echo "Has last a referrable value ${last}"</strong><br class="title-page-name"/><strong class="calibre2">echo "And what happens if I try to unset a while print functions using  unset -f"<br class="title-page-name"/></strong><strong class="calibre2">t</strong><br class="title-page-name"/><strong class="calibre2">print</strong>    <br class="title-page-name"/><strong class="calibre2">unset -f print</strong><br class="title-page-name"/><strong class="calibre2">echo "Unset done, now let us invoke the function"</strong><br class="title-page-name"/><strong class="calibre2">print</strong>  
</pre>
<p class="calibre1">Time to verify what happens with the <kbd class="calibre9">unset</kbd> command:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./disk-space-function-unavailable.sh </strong>  
</pre>
<p class="calibre1">The space left is:</p>
<pre class="codepackt">
<strong class="calibre2">Is the last variable available outside the function before it is invoked? </strong><br class="title-page-name"/><strong class="calibre2">The space left inside the function is 202G</strong><br class="title-page-name"/><strong class="calibre2">Is the available variable available inside the function? yes</strong><br class="title-page-name"/><strong class="calibre2">The space left outside is 202G</strong><br class="title-page-name"/><strong class="calibre2">Is the available variable available outside the function? </strong><br class="title-page-name"/><strong class="calibre2">Is the last variable available outside the function after it is invoked? yes</strong><br class="title-page-name"/><strong class="calibre2">What happens if we unset a variable, like last?</strong><br class="title-page-name"/><strong class="calibre2">Has last a referrable value </strong><br class="title-page-name"/><strong class="calibre2">And what happens if I try to unset a while print functions using  <br class="title-page-name"/>unset -f</strong><br class="title-page-name"/><strong class="calibre2">The space left inside the function is 202G</strong><br class="title-page-name"/><strong class="calibre2">Is the available variable available inside the function? yes</strong>  
</pre>
<p class="calibre1">Unset done, now let us invoke the function:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ </strong>  
</pre>
<p class="calibre1">The <kbd class="calibre9">print</kbd> function works well, as expected before we unset it, and also the variable content becomes no longer available. Speaking about variables, we can actually unset some of them on the same row using the following:</p>
<pre class="codepackt">
<strong class="calibre2">unset -v variable1 variable2 variablen</strong>  
</pre>
<p class="calibre1">We saw how to modify an environment variable, but what if we want to make it read-only so to protect its content from an unwanted modification?</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ cat readonly.sh </strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">echo "What is our PATH?"</strong><br class="title-page-name"/><strong class="calibre2">echo ${PATH}</strong>    <br class="title-page-name"/><strong class="calibre2">echo "Now we make it readonly"</strong><br class="title-page-name"/><strong class="calibre2">readonly PATH</strong><br class="title-page-name"/><strong class="calibre2">echo "Now  we expand the path for all the shell"</strong><br class="title-page-name"/><strong class="calibre2">export PATH=${PATH}:~/tmp</strong>  
</pre>
<p class="calibre1">Look at the line <kbd class="calibre9">readonlyPATH</kbd>, and now let's see what the execution of this script leads us to:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./readonly.sh </strong><br class="title-page-name"/><strong class="calibre2">What is our PATH?</strong><br class="title-page-name"/><strong class="calibre2">/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</strong><br class="title-page-name"/><strong class="calibre2">Now we make it readonly</strong><br class="title-page-name"/><strong class="calibre2">Now  we expand the path for all the shell</strong><br class="title-page-name"/><strong class="calibre2">./readonly.sh: line 10: PATH: readonly variable</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$</strong>  
</pre>
<p class="calibre1">What happened is that our script tried to modify the <kbd class="calibre9">PATH</kbd> variable that was just made <kbd class="calibre9">readonly</kbd> a few lines before and failed. This failure then led us out of the screen with a failure, and this is confirmed by printing the value of the <kbd class="calibre9">$?</kbd> variable, which holds the exit state of the last command invoked:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ echo $?</strong><br class="title-page-name"/><strong class="calibre2">1</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo $?</strong><br class="title-page-name"/><strong class="calibre2">0</strong>  
</pre>
<p class="calibre1">We will see the use of such a kind of variable later, but now what interests us is to know what that <kbd class="calibre9">0</kbd> and <kbd class="calibre9">1</kbd> mean: the first time we issued the <kbd class="calibre9">echo</kbd> command, right after invoking the script, it gave us the exit code <kbd class="calibre9">1</kbd>, which means failure, and this makes sense because the script exited abruptly with an error. The second time we ran <kbd class="calibre9">echo</kbd>, it showed <kbd class="calibre9">0</kbd>, which means that the last command executed, the previous <kbd class="calibre9">echo</kbd> went well, without any errors.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Variable expansion</h1>
                
            
            <article>
                
<p class="calibre1">The variable expansion is the method we have to access and actually change the content of a variable or parameter. The simplest way to access or reference the variable value is as in the following example:</p>
<pre class="codepackt">
<strong class="calibre2">x=1 ; echo $x</strong>    <br class="title-page-name"/><strong class="calibre2">zarrelli:~$ x=1 ; echo $x</strong><br class="title-page-name"/><strong class="calibre2">1</strong>  
</pre>
<p class="calibre1">So, we assigned a value to the variable <kbd class="calibre9">x</kbd> and then referenced the value preceding the variable name with the dollar sign <kbd class="calibre9">$.</kbd> So, <kbd class="calibre9">echo$x</kbd> prints the content of <kbd class="calibre9">x</kbd>, <kbd class="calibre9">1</kbd>, to the standard output. But we can do something even more subtle:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ x=1 ; y=$x; echo "x is $x" ; echo "y is $y"</strong><br class="title-page-name"/><strong class="calibre2">x is 1</strong><br class="title-page-name"/><strong class="calibre2">y is 1</strong>  
</pre>
<p class="calibre1">So, we gave a value to the variable <kbd class="calibre9">x</kbd>, then we instanced the variable <kbd class="calibre9">y</kbd> referencing the content of the variable <kbd class="calibre9">x</kbd>. So, <kbd class="calibre9">y</kbd> got its assignment referencing the value of <kbd class="calibre9">x</kbd> through the <kbd class="calibre9">$</kbd> character, not directly using a number after the <kbd class="calibre9">=</kbd> char. So far, we saw two different ways to reference a variable:</p>
<pre class="codepackt">
<strong class="calibre2">$x</strong><br class="title-page-name"/><strong class="calibre2">${x}</strong>  
</pre>
<p class="calibre1">The first one is terser, but it would be better to stick to the second way because it preserves the name of the variable and, as we saw a few pages before, it allows us to concatenate a string to the variable without losing the possibility of referencing it.</p>
<p class="calibre1">We just saw the simplest among different ways to manipulate the value held by a variable. What we are going to see now is how to thinker with a variable to have default values and messages, so we make the interaction with the variable more flexible. Before proceeding, just bear in mind that we can use two notations for our next example and they are equivalent:</p>
<pre class="codepackt">
<strong class="calibre2">${variable-default}</strong><br class="title-page-name"/><strong class="calibre2">${variable:-default}</strong>  
</pre>
<p class="calibre1">So, you could see either of the two in a script, and both are correct:</p>
<pre class="codepackt">
<strong class="calibre2">${variable:-default} ${variable-default}</strong>  
</pre>
<p class="calibre1">Simply, if a variable is not set, return a default value, as we can see in the following example:</p>
<pre class="codepackt">
<strong class="calibre2">#!/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">echo "Setting the variable x"</strong><br class="title-page-name"/><strong class="calibre2">x=10</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x using a default fallback value"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:-20}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Unsetting x"</strong><br class="title-page-name"/><strong class="calibre2">unset -v x</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x using a default fallback value"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:-20}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Setting the value of x to null"</strong><br class="title-page-name"/><strong class="calibre2">x=</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x with x to null"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:-30}</strong>  
</pre>
<p class="calibre1">Now, let's execute it:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./variables.sh </strong><br class="title-page-name"/><strong class="calibre2">Setting the variable x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x using a default fallback value</strong><br class="title-page-name"/><strong class="calibre2">10</strong><br class="title-page-name"/><strong class="calibre2">Unsetting x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x using a default fallback value</strong><br class="title-page-name"/><strong class="calibre2">20</strong><br class="title-page-name"/><strong class="calibre2">Setting the value of x to null</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x with x to null</strong><br class="title-page-name"/><strong class="calibre2">30</strong>  
</pre>
<p class="calibre1">As mentioned before, the two notations, with or without the colon, are quite the same. Let us see what happens if in the previous script we substitute <kbd class="calibre9">${x:-somenumber}</kbd> with <kbd class="calibre9">${x-somenumber}</kbd>.</p>
<p class="calibre1">Let's run the modified script:</p>
<pre class="codepackt">
<strong class="calibre2">Setting the variable x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x using a default fallback value</strong><br class="title-page-name"/><strong class="calibre2">10</strong><br class="title-page-name"/><strong class="calibre2">Unsetting x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x using a default fallback value</strong><br class="title-page-name"/><strong class="calibre2">20</strong><br class="title-page-name"/><strong class="calibre2">Setting the value of x to null</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x with x to null</strong>    <br class="title-page-name"/><strong class="calibre2">zarrelli:$ </strong>  
</pre>
<p class="calibre1">Everything is fine, but the last line. So what is the difference at play here? Simple:</p>
<ul class="calibre12">
<li class="calibre13"><kbd class="calibre9">*${x-30}</kbd>: The notation with a colon forces a check on the existence of a value for the variable and this value may well be null. In case you have a value, it does print the value of the variable, ignoring the fallback.
<ul class="calibre23">
<li class="calibre13"><kbd class="calibre9">unset -f x</kbd>: It unsets the variable, so it has no value and we have a fallback value</li>
<li class="calibre13"><kbd class="calibre9">x=</kbd>: It gives a null to <kbd class="calibre9">x</kbd>; so the fallback does not come in to play, and we get back the variable value, for example, null</li>
</ul>
</li>
<li class="calibre13"><kbd class="calibre9">${x:-30}</kbd>: This forces a fallback value in case the value of a variable is null or nonexistent</li>
<li class="calibre13">
<ul class="calibre23">
<li class="calibre13"><kbd class="calibre9">unset -f x</kbd>: It unsets the variable, so it has no value and we have a fallback value</li>
<li class="calibre13"><kbd class="calibre9">x=</kbd>: It gives a null to <kbd class="calibre9">x</kbd>, but the fallback comes in to play and we get a default value</li>
</ul>
</li>
</ul>
<p class="calibre1">Default values can be handy if you are writing a script which expects an input or the customer: if the customer does not provide a value, we can use a fallback default value and have our variable instanced with something meaningful:</p>
<pre class="codepackt">
<strong class="calibre2">#!/bin/bash</strong>        <br class="title-page-name"/><strong class="calibre2">echo "Hello user, please give me a number: "</strong><br class="title-page-name"/><strong class="calibre2">read user_input</strong>        <br class="title-page-name"/><strong class="calibre2">echo "The number is: ${user_input:-99}"</strong>      
</pre>
<p class="calibre1">We ask the user for an input. If he gives us a value, we print it; otherwise, we fallback the value of the variable to <kbd class="calibre9">99</kbd> and print it:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./userinput.sh </strong><br class="title-page-name"/><strong class="calibre2">Hello user, please give me a number: </strong><br class="title-page-name"/><strong class="calibre2">10</strong><br class="title-page-name"/><strong class="calibre2">The number is: 10</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~/$</strong>    <br class="title-page-name"/><strong class="calibre2">zarrelli$ ./userinput.sh </strong><br class="title-page-name"/><strong class="calibre2">Hello user, please give me a number: </strong>    <br class="title-page-name"/><strong class="calibre2">The number is: 99</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~/$</strong><br class="title-page-name"/><strong class="calibre2">${variable:=default} ${variable=default}</strong>  
</pre>
<p class="calibre1">If the variable has a value, it is returned; otherwise, the variable has a default value assigned. In the previous case, we got back a value if the variable had no value; or null, here the variable is actually assigned a value. Better to see an example:</p>
<pre class="codepackt">
<strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">echo "Setting the variable x"</strong><br class="title-page-name"/><strong class="calibre2">x=10</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x"</strong><br class="title-page-name"/><strong class="calibre2">echo ${x}</strong><br class="title-page-name"/><strong class="calibre2">echo "Unsetting x"</strong><br class="title-page-name"/><strong class="calibre2">unset -v x</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x using a default fallback value"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:-20}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x"</strong><br class="title-page-name"/><strong class="calibre2">echo ${x}</strong><br class="title-page-name"/><strong class="calibre2">echo "Setting the variable x with assignement"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:=30}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x again"</strong><br class="title-page-name"/><strong class="calibre2">echo ${x}</strong>  
</pre>
<p class="calibre1">We set a variable and then print its value. Then, we unset it and print its value, but because it is unset, we get back a default value. So we try to print the value of <kbd class="calibre9">x</kbd>, but since the number we got in the preceding operation was not obtained by an assignment, <kbd class="calibre9">x</kbd> is still unset. Finally, we use <kbd class="calibre9">echo "${x:=30}"</kbd> and get the value <kbd class="calibre9">30</kbd> assigned to the variable <kbd class="calibre9">x</kbd>, and indeed, when we print the value of the variable, we get something. Let us see the script in action:</p>
<pre class="codepackt">
<strong class="calibre2">Setting the variable x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x</strong><br class="title-page-name"/><strong class="calibre2">10</strong><br class="title-page-name"/><strong class="calibre2">Unsetting x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x using a default fallback value</strong><br class="title-page-name"/><strong class="calibre2">20</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x</strong>    <br class="title-page-name"/><strong class="calibre2">Setting the variable x with assignement</strong><br class="title-page-name"/><strong class="calibre2">30</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x again</strong><br class="title-page-name"/><strong class="calibre2">30</strong>  
</pre>
<p class="calibre1">Notice the blank line in the middle of the output: we just got a value from the preceding operation, not a real variable assignment:</p>
<pre class="codepackt">
<strong class="calibre2">${variable:+default} ${variable+default}</strong>  
</pre>
<p class="calibre1">Force a check on the existence of a non null value for a variable. If it exists, it returns the default value; otherwise it returns null:</p>
<pre class="codepackt">
<strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">echo "Setting the variable x"</strong><br class="title-page-name"/><strong class="calibre2">x=10</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x"</strong><br class="title-page-name"/><strong class="calibre2">echo ${x}</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x with a default value on <br class="title-page-name"/>assigned value"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:+100}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x after default"</strong><br class="title-page-name"/><strong class="calibre2">echo ${x}</strong><br class="title-page-name"/><strong class="calibre2">echo "Unsetting x"</strong><br class="title-page-name"/><strong class="calibre2">unset -v x</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x using a default fallback value"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:+20}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x"</strong><br class="title-page-name"/><strong class="calibre2">echo ${x}</strong><br class="title-page-name"/><strong class="calibre2">echo "Setting the variable x with assignement"</strong><br class="title-page-name"/><strong class="calibre2">echo "${x:+30}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Printing the value of x again"</strong><br class="title-page-name"/><strong class="calibre2">echo ${x}</strong>  
</pre>
<p class="calibre1">Now, let us run it and check, as follows:</p>
<pre class="codepackt">
<strong class="calibre2">Setting the variable x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x</strong><br class="title-page-name"/><strong class="calibre2">10</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x with a default value on assigned value</strong><br class="title-page-name"/><strong class="calibre2">100</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x after default</strong><br class="title-page-name"/><strong class="calibre2">10</strong><br class="title-page-name"/><strong class="calibre2">Unsetting x</strong><br class="title-page-name"/><strong class="calibre2">Printing the value of x using a default fallback value</strong>    <br class="title-page-name"/><strong class="calibre2">Printing the value of x</strong>    <br class="title-page-name"/><strong class="calibre2">Setting the variable x with assignement</strong>    <br class="title-page-name"/><strong class="calibre2">Printing the value of x again</strong>    <br class="title-page-name"/><strong class="calibre2">zarrelli:~$ </strong>  
</pre>
<p class="calibre1">As you can see, when the variable is correctly instanced, instead of returning its value, it returns a default <kbd class="calibre9">100</kbd> and this is double-checked in the following rows where we print the value of <kbd class="calibre9">x</kbd> and it is still <kbd class="calibre9">10</kbd>: the <kbd class="calibre9">100</kbd> we saw was not a value assignment but just a default returned instead of the real value:</p>
<pre class="codepackt">
<strong class="calibre2">${variable:?message} ${variable?message}</strong><br class="title-page-name"/><strong class="calibre2">#!/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">x=10</strong><br class="title-page-name"/><strong class="calibre2">y=</strong><br class="title-page-name"/><strong class="calibre2">unset -v z</strong><br class="title-page-name"/><strong class="calibre2">echo ${x:?"Should work"}</strong><br class="title-page-name"/><strong class="calibre2">echo ${y:?"No way"}</strong><br class="title-page-name"/><strong class="calibre2">echo ${y:?"Well"}</strong>  
</pre>
<p class="calibre1">The results are quite straightforward:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./set-message.sh </strong><br class="title-page-name"/><strong class="calibre2">10</strong><br class="title-page-name"/><strong class="calibre2">./set-message.sh: line 8: y: No way</strong>  
</pre>
<p class="calibre1">As we tried to access a <kbd class="calibre9">void</kbd> variable, but for the unset would have been the same, the script exited with an error and the message we got from the variable expansion. All good with the first line, <kbd class="calibre9">x</kbd> has a value and we printed it but, as you can see, we cannot arrive to the third line, which remains unparsed: the script exited abruptly with a default message printed.</p>
<p class="calibre1">Nice stuff, isn't it? Well, there is a lot more, we have to look at the pattern matching against variables.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Pattern matching against variables</h1>
                
            
            <article>
                
<p class="calibre1">We have a few ways to fiddle with variables, and some of these have a really interesting use in scripts, as we will see later on in this book. Let's briefly recap what we can do with variables and how to do it, but remember we are dealing with values that are returned, not assigned back to the variable:</p>
<pre class="codepackt">
<strong class="calibre2">${#variable)</strong>  
</pre>
<p class="calibre1">It gives us the length of the variable, or if it is an array, the length of the first element of an array. Here is an example:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ my_variable=thisisaverylongvalue</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${#my_variable}</strong><br class="title-page-name"/><strong class="calibre2">20</strong>  
</pre>
<p class="calibre1">And indeed <kbd class="calibre9">thisisaverylongvalue</kbd> is made up of  <kbd class="calibre9">20</kbd> characters. Now, let us see an example with arrays:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ fruit=(apple pear banana)</strong>  
</pre>
<p class="calibre1">Here, we instantiated an array with three elements <kbd class="calibre9">apple</kbd>, <kbd class="calibre9">pear</kbd>, and <kbd class="calibre9">banana</kbd>. We will see later in this book how to work with arrays in detail:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli@moveaway:~$ echo ${fruit[2]}</strong><br class="title-page-name"/><strong class="calibre2">banana</strong>  
</pre>
<p class="calibre1">We printed the third element of the array. Arrays start with an index of 0, so the third element is at index <kbd class="calibre9">2</kbd>, and it is banana, a 6 characters long word:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli@moveaway:~$ echo ${fruit[1]}</strong><br class="title-page-name"/><strong class="calibre2">pear</strong>  
</pre>
<p class="calibre1">We print the second element of the array: pear,a 4 characters long word:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli@moveaway:~$ echo ${fruit[0]}</strong><br class="title-page-name"/><strong class="calibre2">apple</strong>  
</pre>
<p class="calibre1">And now, the first element, that is, apple is 5 characters long. Now, if the example we saw is true, the following command should return <kbd class="calibre9">5</kbd>.</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ echo ${#fruit}</strong><br class="title-page-name"/><strong class="calibre2">5</strong>  
</pre>
<p class="calibre1">And indeed, the length of the word apple is <kbd class="calibre9">5</kbd> characters:</p>
<pre class="codepackt">
<strong class="calibre2">${variable#pattern)</strong> 
</pre>
<p class="calibre1">If you need to tear out your variable, for a part of it you can use a pattern and remove the shortest occurrence of the pattern from the beginning of the variable and return the resulting value. It is not a variable assignment, not so easy to grasp, but an example will make it clear:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ shortest=1010201010</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${shortest#10}</strong><br class="title-page-name"/><strong class="calibre2">10201010</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${shortest}</strong><br class="title-page-name"/><strong class="calibre2">1010201010</strong><br class="title-page-name"/><strong class="calibre2">${variable##pattern)</strong>  
</pre>
<p class="calibre1">This form is like the preceding one but with a slight difference, the pattern is used to remove its largest occurrence in the variable:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ my_variable=10102010103</strong>  
</pre>
<p class="calibre1">We instanced the variable with a series of recurring digits:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ echo ${my_variable#1*1}</strong><br class="title-page-name"/><strong class="calibre2">02010103</strong>  
</pre>
<p class="calibre1">Then, we tried to match a pattern, which means any digit between a leading and ending 1, the shortest occurrence. So it took out 10102010103:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ echo ${my_variablet##1*1}</strong><br class="title-page-name"/><strong class="calibre2">03</strong>  
</pre>
<p class="calibre1">Now, we cut away the widest occurrence of the pattern, and so 10102010103, resulting in a meager <kbd class="calibre9">03</kbd> as the value returned:</p>
<pre class="codepackt">
<strong class="calibre2">${variable%pattern)</strong>  
</pre>
<p class="calibre1">Here, we cut away the shortest occurrence of the pattern but now from the end of the variable value:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ending=10102010103</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${ending%1*3}</strong><br class="title-page-name"/><strong class="calibre2">10102010</strong>  
</pre>
<p class="calibre1">So, the shortest occurrence of the <kbd class="calibre9">1*3</kbd> pattern counted from the end of the file is <kbd class="calibre9">10102010103</kbd> so we get <kbd class="calibre9">10102010</kbd> back:</p>
<pre class="codepackt">
<strong class="calibre2">${variable%%pattern)</strong>  
</pre>
<p class="calibre1">Similar to the previous example, with <kbd class="calibre9">##</kbd>, in this case, we cut away the longest occurrence of the pattern from the end of the variable value:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ending=10102010103</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${ending}</strong><br class="title-page-name"/><strong class="calibre2">10102010103</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${ending%1*3}</strong><br class="title-page-name"/><strong class="calibre2">10102010</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${ending%%1*3}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ </strong>  
</pre>
<p class="calibre1">Quite clear, isn't it? The longest occurrence is <kbd class="calibre9">1*3</kbd> is <kbd class="calibre9">10102010103</kbd>, so we tear away everything and we return nothing, as this example which makes use of the evaluation of <kbd class="calibre9">-z</kbd> (is empty) will show:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ my_var=${ending%1*3}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ [[ -z "$my_var" ]] &amp;&amp; echo "Empty" || echo "Not empty"</strong><br class="title-page-name"/><strong class="calibre2">Not empty</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ my_var=${ending%%1*3}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ [[ -z "$my_var" ]] &amp;&amp; echo "Empty" || echo "Not empty"</strong><br class="title-page-name"/><strong class="calibre2">Empty</strong><br class="title-page-name"/><strong class="calibre2">${variable/pattern/substitution}</strong>  
</pre>
<p class="calibre1">The reader familiar with regular expressions probably already understood what the outcome is: replace the first occurrence of the pattern in the variable by substitution. If substitution does not exist, then delete the first occurrence of a pattern in variable:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ my_var="Give me a banana"</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${my_var}</strong><br class="title-page-name"/><strong class="calibre2">Give me a banana</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${my_var/banana/pear}</strong><br class="title-page-name"/><strong class="calibre2">Give me a pear</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ fruit=${my_var/banana/pear}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${fruit}</strong><br class="title-page-name"/><strong class="calibre2">Give me a pear</strong>  
</pre>
<p class="calibre1">Not so nasty, and we were able to instance a variable with the output of our find and replace:</p>
<pre class="codepackt">
<strong class="calibre2">${variable//pattern/substitution}</strong>  
</pre>
<p class="calibre1">Similar to the preceding, in this case, we are going to replace the occurrences of a pattern in the variable:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli@moveaway:~$ fruit="A pear is a pear and is not a banana"</strong><br class="title-page-name"/><strong class="calibre2">zarrelli@moveaway:~$ echo ${fruit//pear/watermelon}</strong><br class="title-page-name"/><strong class="calibre2">A watermelon is a watermelon and is not a banana</strong>  
</pre>
<p class="calibre1">Like the preceding example, if substitution is omitted, a pattern is deleted from the variable:</p>
<pre class="codepackt">
<strong class="calibre2">${variable/#pattern/substitution}</strong>  
</pre>
<p class="calibre1">If the prefix of the variable matches, then replace the pattern with substitution in variable, so this is similar to the preceding but matches only at the beginning of the variable:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ fruit="a pear is a pear and is not a banana"</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${fruit/#"a pear"/}</strong><br class="title-page-name"/><strong class="calibre2">is a pear and is not a banana</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${fruit/#"a pear"/"an apple"}</strong><br class="title-page-name"/><strong class="calibre2">an apple is a pear and is not a banana</strong>  
</pre>
<p class="calibre1">As usual, omitting means deleting the occurrence of the pattern from the variable.</p>
<pre class="codepackt">
<strong class="calibre2">${variable/%pattern/substitution}</strong>  
</pre>
<p class="calibre1">Once again, a positional replacement, this time at the end of the variable value:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ fruit="a pear is not a banana even tough I would <br class="title-page-name"/>like to eat a banana"</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${fruit/%"a banana"/"an apple"}</strong><br class="title-page-name"/><strong class="calibre2">a pear is not a banana even though I would like to eat an apple</strong>  
</pre>
<p class="calibre1">A lot of nonsense, but it makes sense:</p>
<pre class="codepackt">
<strong class="calibre2">${!prefix_variable*}</strong><br class="title-page-name"/><strong class="calibre2">${!prefix_variable@}</strong>  
</pre>
<p class="calibre1">Match the name of the variable names starting with the highlighted prefix:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ firstvariable=1</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ secondvariable=${!first*}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli@:~$ echo ${secondvariable}</strong><br class="title-page-name"/><strong class="calibre2">firstvariable</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ thirdvariable=${secondvariable}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${thirdvariable}</strong><br class="title-page-name"/><strong class="calibre2">firstvariable</strong><br class="title-page-name"/><strong class="calibre2">${variable:position}</strong>  
</pre>
<p class="calibre1">We can decide from which position we want to start the variable expansion, so determining what part of its value we want to get back:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ picnic="Either I eat an apple or I eat a raspberry"</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${picnic:25}</strong><br class="title-page-name"/><strong class="calibre2">I eat a raspberry</strong>  
</pre>
<p class="calibre1">So, we just took a part of the variable, and we decided the starting point, but we can also define for how long cherry-picking is done:</p>
<pre class="codepackt">
<strong class="calibre2">${variable:position:offset}</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ wheretogo="I start here, I go there, no further"</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ echo ${wheretogo:14:10}</strong><br class="title-page-name"/><strong class="calibre2">I go there</strong>  
</pre>
<p class="calibre1">So we do not go further, start at a position and stop at the offset; this way, we can extract whatever consecutive characters/digits we want from the value of a variable.</p>
<p class="calibre1">So far, we have seen many different ways to access and modify the content of a variable or, at least, of what we get from a variable. There is a class of very special variables left to look at, and these will be really handy when writing a script.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Special variables</h1>
                
            
            <article>
                
<p class="calibre1">Let's see now some variables which have some spacial uses that we can benefit from:</p>
<pre class="codepackt">
<strong class="calibre2">${1}, ${n}</strong>
</pre>
<p class="calibre1">The first interesting variables we want to explore have a special role in our scripts because they will let us capture more than an argument on our first command-line execution. Have a look at this bunch of lines:</p>
<pre class="codepackt">
<strong class="calibre2">!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">fistvariable=${1}</strong><br class="title-page-name"/><strong class="calibre2">secondvariable=${2}</strong><br class="title-page-name"/><strong class="calibre2">thirdvariable=${3}</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The value of the first variable is ${1}, the second <br class="title-page-name"/>is ${2}, the third is ${3}"</strong> 
</pre>
<p class="calibre1">Pay attention to <kbd class="calibre9">$1</kbd>, <kbd class="calibre9">$2</kbd>, <kbd class="calibre9">$3</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh </strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is , the second is , the third is </strong>  
</pre>
<p class="calibre1">First try, no arguments on the command line, we see nothing printed for the variables:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is 1, the second is 2, <br class="title-page-name"/>the third is 3</strong>  
</pre>
<p class="calibre1">Second try, we invoke the script and add three digits separated by spaces and, actually, we can see them printed. The first on the command line corresponds to <kbd class="calibre9">$1</kbd>, the second to <kbd class="calibre9">$2</kbd>, and the third to <kbd class="calibre9">$3</kbd>:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh Green Yellow Red</strong>  
</pre>
<p class="calibre1">The value of the first variable is <kbd class="calibre9">Green</kbd>; the second is <kbd class="calibre9">Yellow</kbd>; and the third is <kbd class="calibre9">Red</kbd>.</p>
<p class="calibre1">Third try, we use words with the same results. But notice here:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh "One sentence" "Another one" <br class="title-page-name"/>A third one</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is One sentence, the second <br class="title-page-name"/>is Another one, the third is A</strong>  
</pre>
<p class="calibre1">We used a double quote to prevent the space between one sentence and another being interpreted as a divider for the command-line bits, and in fact, the first and second sentences were added as a complete string to the variables, but the third came up just with an A because the subsequent spaces, not quoted, were considered to be separators and the following bits taken as <kbd class="calibre9">$4</kbd>, <kbd class="calibre9">$5</kbd>, and <kbd class="calibre9">$n</kbd>. Note that we could also mix the order of assignment, as follows:</p>
<pre class="codepackt">
<strong class="calibre2">thirdvariable=${3}</strong><br class="title-page-name"/><strong class="calibre2">fistvariable=${1}</strong><br class="title-page-name"/><strong class="calibre2">secondvariable=${2}</strong>  
</pre>
<p class="calibre1">The result would be the same. What is important is not the position of the variable we declare, but what positional we associate with it.</p>
<p class="calibre1">As you saw, we used two different methods to represent a positional variable:</p>
<pre class="codepackt">
<strong class="calibre2">${1}</strong><br class="title-page-name"/><strong class="calibre2">$1</strong>  
</pre>
<p class="calibre1">Are they the same? Almost. Look here:</p>
<pre class="codepackt">
<strong class="calibre2">#!/bin/bash</strong>    <br class="title-page-name"/><strong class="calibre2">fistvariable=${1}</strong><br class="title-page-name"/><strong class="calibre2">secondvariable=${2}</strong><br class="title-page-name"/><strong class="calibre2">thirdvariable=${3}</strong><br class="title-page-name"/><strong class="calibre2">eleventhvariable=$11</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The value of the first variable is ${fistvariable}, <br class="title-page-name"/>the second is ${secondvriable}, the third is ${thirdvariable}, <br class="title-page-name"/>the eleventh is ${eleventhvariable}" </strong>  
</pre>
<p class="calibre1">Now, let's execute the script:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh "One sentence" "Another one" A <br class="title-page-name"/>third one</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is One sentence, the second <br class="title-page-name"/>is Another one, the third is A, the eleventh is One sentence1</strong>  
</pre>
<p class="calibre1">Interesting, the <kbd class="calibre9">eleventhvariable</kbd> has been interpreted as it were the positional <kbd class="calibre9">$1</kbd> and added a <kbd class="calibre9">1</kbd>. Odd, let's rewrite the echo in the following way:</p>
<pre class="codepackt">
<strong class="calibre2">eleventhvariable=${11}</strong>  
</pre>
<p class="calibre1">And run the script again:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli$ ./positional.sh "One sentence" "Another one" A third one</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is One sentence, the second is <br class="title-page-name"/>Another one, the third is A, the eleventh is </strong>  
</pre>
<p class="calibre1">Now we are correct. We did not pass an eleventh positional value on the command line, so the <kbd class="calibre9">eleventhvariable</kbd> has not been instantiated and we do not see anything printed to the video. Be cautious, always use <kbd class="calibre9">${}</kbd>; it will preserve the value of the variable in your complex scripts when having a grasp of every single detail would be really difficult:</p>
<pre class="codepackt">
<strong class="calibre2">${0}</strong>  
</pre>
<p class="calibre1">This expands to the full path to the script; it gives you a way to handle it in your script. So, let's add the following line at the end of the script and execute it:</p>
<pre class="codepackt">
<strong class="calibre2">echo "The full path to the script is $0"</strong><br class="title-page-name"/><strong class="calibre2">zarrelli:~$ ./positional.sh 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is 1, the second is 2, the <br class="title-page-name"/>third is 3, the eleventh is </strong><br class="title-page-name"/><strong class="calibre2">The full path to the script is ./positional.sh</strong> 
</pre>
<p class="calibre1">In our case, the path is local, since we called the script from inside the directory that is holding it:</p>
<pre class="codepackt">
<strong class="calibre2">${#}</strong>  
</pre>
<p class="calibre1">Expands into the number of the arguments passed to the script, showing us the number of arguments that have been passed on the command line to the script. So, let's add the following line to our script and let's see what comes out of it:</p>
<pre class="codepackt">
<strong class="calibre2">echo "We passed ${#} arguments to the script"</strong>    <br class="title-page-name"/><strong class="calibre2">zarrelli:~$ ./positional.sh 1 2 3 4 5 6 7 </strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is 1, the second is 2, the <br class="title-page-name"/>third is 3, the eleventh is </strong><br class="title-page-name"/><strong class="calibre2">The full path to the script is ./positional.sh</strong><br class="title-page-name"/><strong class="calibre2">We passed 7 arguments to the script</strong>    <br class="title-page-name"/><strong class="calibre2">${@}</strong><br class="title-page-name"/><strong class="calibre2">${*}</strong>  
</pre>
<p class="calibre1">Gives us the list of arguments passed on the command line to the script, with one difference: <kbd class="calibre9">${@}</kbd> preserves the spaces, the second doesn't:</p>
<pre class="codepackt">
<strong class="calibre2">#!/bin/bash</strong><br class="title-page-name"/><strong class="calibre2">fistvariable=${1}</strong><br class="title-page-name"/><strong class="calibre2">secondvariable=${2}</strong><br class="title-page-name"/><strong class="calibre2">thirdvariable=${3}</strong><br class="title-page-name"/><strong class="calibre2">eleventhvariable=${11}</strong><br class="title-page-name"/><strong class="calibre2">export IFS=*</strong>    <br class="title-page-name"/><strong class="calibre2">echo "The value of the first variable is ${fistvariable}, <br class="title-page-name"/>the second is ${secondvariable}, the third is ${thirdvariable}, <br class="title-page-name"/>the eleventh is ${eleventhvariable}"</strong><br class="title-page-name"/><strong class="calibre2">echo "The full path to the script is $0"</strong><br class="title-page-name"/><strong class="calibre2">echo "We passed ${#} arguments to the script"</strong>    <br class="title-page-name"/><strong class="calibre2">echo "This is the list of the arguments ${@}"</strong><br class="title-page-name"/><strong class="calibre2">echo "This too is the list of the arguments ${*}"</strong><br class="title-page-name"/><strong class="calibre2">IFS=</strong><br class="title-page-name"/><strong class="calibre2">echo "This too is the list of the arguments ${*}"</strong>  
</pre>
<p class="calibre1">We changed the characters used by the shell as a delimiter to identify single words. Now, let us execute the script:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is 1, the second is 2, <br class="title-page-name"/>the third is 3, the eleventh is </strong><br class="title-page-name"/><strong class="calibre2">The full path to the script is ./positional.sh</strong><br class="title-page-name"/><strong class="calibre2">We passed 3 arguments to the script</strong><br class="title-page-name"/><strong class="calibre2">This is the list of the arguments 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">This too is the list of the arguments 1*2*3</strong><br class="title-page-name"/><strong class="calibre2">This too is the list of the arguments 123</strong>  
</pre>
<p class="calibre1">Here, you can see the difference at play:</p>
<ul class="calibre12">
<li class="calibre13"><kbd class="calibre9">*</kbd>: This expands to the positional parameters, starting from the first and when the expansion is within double quotes, it expands to a single word and separates each positional parameter using the first character of IFS. If the latter is null, a space is used, if it is null the words are concatenated without separators.</li>
<li class="calibre13"><kbd class="calibre9">@</kbd>: This expands to the positional parameter, starting from the first, and if the expansion occurs within a double quote, each positional parameter is expanded to a word on its own:</li>
</ul>
<pre class="calibre21">
<strong class="calibre2">${?}</strong>  
</pre>
<p class="calibre1">This special variable expands to the exit value of the last command executed, as we have already seen:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ /bin/ls disk.sh ; echo ${?} ; tt ; echo ${?}</strong><br class="title-page-name"/><strong class="calibre2">disk.sh</strong><br class="title-page-name"/><strong class="calibre2">0</strong><br class="title-page-name"/><strong class="calibre2">bash: tt: command not found</strong><br class="title-page-name"/><strong class="calibre2">127</strong>  
</pre>
<p class="calibre1">The first command was successful, so the exit code is <kbd class="calibre9">0</kbd> ; the second gave an error <kbd class="calibre9">127command not found</kbd>, since such a command as <kbd class="calibre9">tt</kbd> does not exist.</p>
<p class="calibre1"><kbd class="calibre9">${$}</kbd> expands to the process number of the current shell and for a script is the shell in which it is running. Let us add the following line to our <kbd class="calibre9">positional.sh</kbd> script:</p>
<pre class="codepackt">
<strong class="calibre2">echo "The process id of this script is ${$}"</strong>  
</pre>
<p class="calibre1">Then let's run it:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is 1, the second is 2, the <br class="title-page-name"/>third is 3, the eleventh is </strong><br class="title-page-name"/><strong class="calibre2">The full path to the script is ./positional.sh</strong><br class="title-page-name"/><strong class="calibre2">We passed 3 arguments to the script</strong><br class="title-page-name"/><strong class="calibre2">This is the list of the arguments 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">This too is the list of the arguments 1*2*3</strong><br class="title-page-name"/><strong class="calibre2">This too is the list of the arguments 123</strong><br class="title-page-name"/><strong class="calibre2">The process id of this script is 13081</strong>  
</pre>
<p class="calibre1">Step by step, our script is telling us more and more:</p>
<pre class="codepackt">
<strong class="calibre2">${!}</strong>  
</pre>
<p class="calibre1">This is tricky; it expands to the process number of the last command executed in the background. Time to add some other lines to our script:</p>
<pre class="codepackt">
<strong class="calibre2">echo "The background process id of this script is ${!}"</strong><br class="title-page-name"/><strong class="calibre2">echo "Executing a ps in background"</strong><br class="title-page-name"/><strong class="calibre2">nohup ps &amp;</strong><br class="title-page-name"/><strong class="calibre2">echo "The background process id of this script is ${!}"</strong>  
</pre>
<p class="calibre1">And now execute it:</p>
<pre class="codepackt">
<strong class="calibre2">zarrelli:~$ ./positional.sh 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">The value of the first variable is 1, the second is 2, <br class="title-page-name"/>the third is 3, the eleventh is </strong><br class="title-page-name"/><strong class="calibre2">The full path to the script is ./positional.sh</strong><br class="title-page-name"/><strong class="calibre2">We passed 3 arguments to the script</strong><br class="title-page-name"/><strong class="calibre2">This is the list of the arguments 1 2 3</strong><br class="title-page-name"/><strong class="calibre2">This too is the list of the arguments 1*2*3</strong><br class="title-page-name"/><strong class="calibre2">This too is the list of the arguments 123</strong><br class="title-page-name"/><strong class="calibre2">The process id of this script is 13129</strong><br class="title-page-name"/><strong class="calibre2">The background process id of this script is </strong><br class="title-page-name"/><strong class="calibre2">Executing a ps in background</strong><br class="title-page-name"/><strong class="calibre2">The background process id of this script is 13130</strong><br class="title-page-name"/><strong class="calibre2">nohup: appending output to 'nohup.out'</strong>  
</pre>
<p class="calibre1">We used <kbd class="calibre9">nohup ps &amp;</kbd> to send the <kbd class="calibre9">ps</kbd> in the background (<kbd class="calibre9">&amp;</kbd>) and detach it from the current terminal (<kbd class="calibre9">nohup</kbd>). We will see later, in more details the use of background commands; it suffices now to see how, before sending the process in to the background, we had no value to print for <kbd class="calibre9">${!}</kbd> ; it was instanced only after we sent <kbd class="calibre9">ps</kbd> in to the background.</p>
<p class="calibre1">Do you see that?</p>
<pre class="codepackt">
<strong class="calibre2">nohup: appending output to 'nohup.out'</strong>  
</pre>
<p class="calibre1">Well, for our purposes, it has no value, so how can we redirect this useless output and get rid of it during the execution of our script? You know what? It is a tiny exercise for you to do before you start reading the next chapter, which will deal with the operators and much more fun.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre1">In this chapter, we touched on some of the very basics of the shell, such as things that you should know how to deal with in the correct way. Failing to preserve variable names can, for instance, lead us to unwanted results and, on a different side, knowing how to access environment variables will help us create a better environment for our day-to-day tasks. As we said, basic but important things that a Bash master should know by heart, because unmasks, file descriptors, and fiddling with variables are what let you play awesome tricks and are the building blocks to becoming more advanced. So, do not just overlook them; they will help you.</p>


            </article>

            
        </section>
    </body></html>