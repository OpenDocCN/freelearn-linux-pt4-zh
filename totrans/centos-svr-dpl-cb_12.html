<html><head></head><body><div class="chapter" title="Chapter&#xA0;12.&#xA0;Virtualization"><div class="titlepage"><div><div><h1 class="title"><a id="ch12"/>Chapter 12. Virtualization</h1></div></div></div><p>This chapter contains the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a new virtual machine</li><li class="listitem" style="list-style-type: disc">Cloning a virtual machine</li><li class="listitem" style="list-style-type: disc">Adding storage to a virtual machine</li><li class="listitem" style="list-style-type: disc">Connecting USB peripherals to a guest system</li><li class="listitem" style="list-style-type: disc">Configuring a guest's network interface</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec93"/>Introduction</h1></div></div></div><p>The recipes in this chapter focus on running a second operating system as a guest using virtualization on your CentOS system. You'll learn how to setup the virtual machine to install a guest operating system, properly create a copy of the machine through cloning, and add additional storage resources. You'll also learn how to share access to USB peripherals attached to the host system and configure the guest's virtual network interface to access the network.</p></div></div>
<div class="section" title="Creating a new virtual machine"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec94"/>Creating a new virtual machine</h1></div></div></div><p>This recipe teaches you how to install the KVM virtualization software and create a new virtual machine. Virtualization allows us to take advantage of the hardware resources available to us by running multiple operating systems on the same physical system. The primary operating system is installed "bare-metal" and is known as the host OS. Then, special software is installed that allows the host to provide emulation or direct access to hardware resources. The resources are partitioned as virtual machines and several guest operating systems can then be installed and run on top of the host, each in their own virtual machine.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec305"/>Getting ready</h2></div></div></div><p>This recipe requires a CentOS system with a working network connection and a graphical user interface installed (refer to the <span class="emphasis"><em>Installing the GNOME desktop</em></span> and <span class="emphasis"><em>Installing the KDE Plasma desktop</em></span> recipes in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with CentOS">Chapter 1</a>, <span class="emphasis"><em>Getting Started with CentOS</em></span>). Administrative privileges are also required, either by logging in with the <code class="literal">root</code> account or through the use of <code class="literal">sudo</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec306"/>How to do it...</h2></div></div></div><p>Follow these steps to install a guest operating system:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Install the necessary virtualization packages using package groups:<pre class="programlisting">
<span class="strong"><strong>yum groupinstall "Virtualization Platform"   &#13;
       "Virtualization Client" "Virtualization Tools"</strong></span>
</pre></li><li class="listitem">Launch the Virtual Machine Manager application:<pre class="programlisting">
<span class="strong"><strong>       virt-manager</strong></span>
</pre></li><li class="listitem">Create a new virtual machine by selecting <span class="strong"><strong>New Virtual Machine</strong></span> from the <span class="strong"><strong>File</strong></span> menu. This opens the <span class="strong"><strong>New VM</strong></span> wizard.</li><li class="listitem">Select the desired installation method and click on <span class="strong"><strong>Forward</strong></span>. For this recipe, we'll choose the <span class="strong"><strong>Local install media</strong></span> option:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_001.jpg"/><div class="caption"><p>The New VM wizard collects the necessary details to create a new machine</p></div></div></li><li class="listitem">Select the media source. If the media is a CD or DVD, select the <span class="strong"><strong>Use CDROM or DVD</strong></span> option. If the media is an ISO file, select the <span class="strong"><strong>Use ISO image</strong></span> option and specify the path to the image file. Then, click on <span class="strong"><strong>Forward</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_002.jpg"/><div class="caption"><p>The new machine will use an ISO file as its installation media</p></div></div></li><li class="listitem">Set the amount of RAM and the number of CPUs that you want to allocate to the virtual machine and then click on <span class="strong"><strong>Forward</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_003.jpg"/><div class="caption"><p>1 GB of RAM and 1 CPU are allocated to the virtual machine</p></div></div></li><li class="listitem">Specify the storage capacity that will be allocated to the machine and then click on <span class="strong"><strong>Forward</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_004.jpg"/><div class="caption"><p>The machine is set up with 8 GB of storage</p></div></div></li><li class="listitem">Provide a name to identify the virtual machine and click on <span class="strong"><strong>Finish</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_005.jpg"/><div class="caption"><p>The wizard is ready to create the virtual machine and boot the installation media</p></div></div></li><li class="listitem">The virtual machine will automatically start and boot from the specified installation media. You can now proceed with installing your guest operating system in the machine as if it were a physical system:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_006.jpg"/><div class="caption"><p>An operating system can be installed on the virtual machine the same way as a physical system</p></div></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec307"/>How it works...</h2></div></div></div><p>The necessary software is installed by installing three package groups; the <code class="literal">Virtualization Platform</code> group installs the base virtualization libraries, the <code class="literal">Virtualization Client</code> package installs client programs for creating and managing virtual machines, and the <code class="literal">Virtualization Tools</code> package installs utilities for maintaining the machines:</p><pre class="programlisting">
<span class="strong"><strong>yum groupinstall "Virtualization Platform" &#13;
"Virtualization Client"  "Virtualization Tools"</strong></span>
</pre><p>After installing the software, we used the Virtual Machine Manager to create a machine. The machine defines a virtual system, specifying what resources are available to the guest and how the guest may access them. Under the GNOME desktop environment, the manager is launched from the <span class="strong"><strong>System Tools</strong></span> category of the <span class="strong"><strong>Applications</strong></span> menu. In KDE, it's found via the Kickoff Application Launcher under <span class="strong"><strong>Applications</strong></span> | <span class="strong"><strong>System Tools</strong></span>. The manager can also be launched from the command line with <code class="literal">virt-manager</code>:</p><pre class="programlisting">
<span class="strong"><strong>virt-manager</strong></span>
</pre><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note84"/>Note</h3><p>A new virtual machine can be created on the command line as well, using <code class="literal">virt-install</code> and specifying the resource allocations as arguments. This is especially useful if you want to script the process of spinning up new guests.</p></div></div><p>The manager's new VM makes it easy to create a new virtual machine definition by prompting us for the necessary resource allocations. For instance, we're asked to provide the amount of RAM, the number of CPUs, and the amount of storage space to make available to the guest. After we provide the values, it creates the machine and starts it, booting from the specified installation media to install the guest operating system. From there, installing the operating system is the same as if you were installing it on a physical system.</p><p>To boot a virtual machine, select the desired machine from the available list so that it's highlighted and then click on the play arrow icon in the manager's tool bar. Alternatively, right-click on the list entry and select <span class="strong"><strong>Run</strong></span> from the context menu. This powers on the machine and its status changes to <span class="emphasis"><em>Running</em></span>. When you're finished, you can power the machine off by clicking on the power switch icon in the tool bar or on one of the <span class="strong"><strong>Shut Down</strong></span> options from the context menu. The machine's status changes to <span class="emphasis"><em>Shut off</em></span>. To interact with the guest while it's running, double-click on the entry or highlight it and then click on the Open icon in the manager's tool bar.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note85"/>Note</h3><p>Scrollbars will appear on the side and bottom of the window if the guest's display is too large to show in its entirety. Scaling it to fit within the window can improve your experience. To adjust the display's presentation, select <span class="strong"><strong>Display</strong></span> from <span class="strong"><strong>View</strong></span>.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec308"/>See also</h2></div></div></div><p>Refer to the following resources for more information on working with virtual machines:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">virt-install</code> manual page (<code class="literal">man 1 virt-install</code>)</li><li class="listitem" style="list-style-type: disc">The KVM website (<a class="ulink" href="http://www.linux-kvm.org/page/Main_Page">http://www.linux-kvm.org/page/Main_Page</a>)</li><li class="listitem" style="list-style-type: disc">RHEL 7 Virtualization Deployment and Administration Guide (<a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/</a>)</li><li class="listitem" style="list-style-type: disc">Best practices for KVM (<a class="ulink" href="http://www.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatbpkickoff.htm">http://www.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatbpkickoff.htm</a>)</li></ul></div></div></div>
<div class="section" title="Cloning a virtual machine"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec95"/>Cloning a virtual machine</h1></div></div></div><p>Since a virtual machine is ultimately nothing more than data files, these can easily be copied and shared. This is useful because you can set up a gold server exactly how you want it and then make copies that are used for different purposes. However, using the <code class="literal">cp</code> command isn't the way to go about it. This recipe shows you the correct way to duplicate a machine with a process called cloning.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec309"/>Getting ready</h2></div></div></div><p>This recipe requires a virtual machine set up as described in the previous recipe. While the cloning process doesn't require administrative privileges per se, privileges may be needed to access the machine's files depending on where they are located. By default, the files are stored at <code class="literal">/var/lib/libvirt/images</code>, which requires administrative access.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec310"/>How to do it...</h2></div></div></div><p>Follow these steps to clone a virtual machine:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure the machine you want to clone is not running.</li><li class="listitem">In Virtual Machine Manager, right-click on the desired machine in the list of available machines and select <span class="strong"><strong>Clone</strong></span> from the context menu. This opens the <span class="strong"><strong>Clone Virtual Machine</strong></span> dialog:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_007.jpg"/><div class="caption"><p>The Clone Virtual Machine dialog makes it easy to clone a machine image</p></div></div></li><li class="listitem">Specify a unique name for the new image and click on the <span class="strong"><strong>Clone</strong></span> button. This will create a standalone copy of the virtual machine and selected storage.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec311"/>How it works...</h2></div></div></div><p>This recipe used Virtual Machine Manager to create a copy of a machine known as a clone. The machine should be cloned in this manner instead of simply copying the underlying files, because the cloning process also updates various identifiers that should be unique between machines, such as the MAC address of the network interface.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note86"/>Note</h3><p>The <code class="literal">virt-clone</code> command can be used to clone a guest on the command-line. For more information, refer to the program's man page using <code class="literal">man 1 virt-clone</code>.</p></div></div><p>If you want to update various aspects of the cloned machine before booting it, you can use tools such as <code class="literal">virt-sysprep</code> and <code class="literal">virt-configure</code>. These programs mount the machine's disk image in a chrooted environment, perform the requested modifications, and then unmount the image. <code class="literal">virt-sysprep</code> is installed via <code class="literal">libguestfs-tools-c</code>:</p><pre class="programlisting">
<span class="strong"><strong>    yum install libguestfs-tools-c &#13;
</strong></span>
</pre><p>To view a list of the available maintenance actions <code class="literal">virt-sysprep</code> can perform, invoke the program using <code class="literal">--list-operations</code>. Each option will be displayed along with a brief description of what it does. To perform an operation, use the <code class="literal">--operation</code> argument followed by one or more of the operation labels, separated by commas. For example, the following command clears the bash history for any accounts on the system and deletes any files that may be in <code class="literal">/tmp</code>. The <code class="literal">-a</code> argument provides the path to the machine's disk image:</p><pre class="programlisting">
<span class="strong"><strong>virt-sysprep -a /var/lib/virt/images/Ubuntu-clone.qcow2 &#13;
--operations bash-history,tmp-files</strong></span>
</pre><p>Depending on what the original machine image was used for, you may find the following cleanup operations useful as well:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ca-certificates</code>: This deletes any CA certificates</li><li class="listitem" style="list-style-type: disc"><code class="literal">logfiles</code>: This deletes log files</li><li class="listitem" style="list-style-type: disc"><code class="literal">ssh-hostkeys</code>: This deletes the SSH host keys</li><li class="listitem" style="list-style-type: disc"><code class="literal">ssh-userdir</code>: This deletes the users' <code class="literal">.ssh</code> directories</li><li class="listitem" style="list-style-type: disc"><code class="literal">user-account</code>: This deletes all user accounts except for root</li></ul></div><p>There is some overlap in the functionality of <code class="literal">virt-sysprep</code> and <code class="literal">virt-customize</code>; however, <code class="literal">virt-customize</code> performs more general customization operations, while virt-sysprep's actions focus more on cleaning up an image. <code class="literal">virt-customize</code> can do things like move and set the system's hostname, reset passwords, and install and uninstall packages.</p><p>To reset the system's hostname, use the <code class="literal">--hostname</code> argument and provide the desired name:</p><pre class="programlisting">
<span class="strong"><strong>virt-customize -a /var/lib/virt/images/Ubuntu-clone.qcow2 &#13;
--hostname ubuntu2</strong></span>
</pre><p>The <code class="literal">--install</code> and <code class="literal">--uninstall</code> arguments add and remove packages and specify one or more package names separated by commas:</p><pre class="programlisting">
<span class="strong"><strong>virt-customize -a /var/lib/virt/images/Ubuntu-clone.qcow2 &#13;
--install build-essential</strong></span>
</pre><p>Some arguments you may find useful for <code class="literal">virt-customize</code> are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">--chmod</code>: This changes file permissions</li><li class="listitem" style="list-style-type: disc"><code class="literal">--copy</code>: This creates a copy of a file or directory</li><li class="listitem" style="list-style-type: disc"><code class="literal">--delete</code>: This removes a file or directory</li><li class="listitem" style="list-style-type: disc"><code class="literal">--mkdir</code>: This creates a new directory</li><li class="listitem" style="list-style-type: disc"><code class="literal">--move</code>: This moves a file or directory to a new destination</li><li class="listitem" style="list-style-type: disc"><code class="literal">--password</code>: This updates a user's password</li><li class="listitem" style="list-style-type: disc"><code class="literal">--run-command</code>: This runs a command on the image</li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec312"/>See also</h2></div></div></div><p>Refer to the following resources for more information on cloning and customizing virtual machines:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">virt-clone</code> manual page (<code class="literal">man 1 virt-clone</code>)</li><li class="listitem" style="list-style-type: disc">The <code class="literal">virt-configure</code> manual page (<code class="literal">man 1 virt-configure</code>)</li><li class="listitem" style="list-style-type: disc">The <code class="literal">virt-sysprep</code> manual page (<code class="literal">man 1 virt-sysprep</code>)</li><li class="listitem" style="list-style-type: disc">How to clone a KVM virtual machine and reset the VM (<a class="ulink" href="http://www.unixarena.com/2015/12/how-to-clone-a-kvm-virtual-machines-and-reset-the-vm.html">http://www.unixarena.com/2015/12/how-to-clone-a-kvm-virtual-machines-and-reset-the-vm.html</a>)</li></ul></div></div></div>
<div class="section" title="Adding storage to a virtual machine"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec96"/>Adding storage to a virtual machine</h1></div></div></div><p>Even if you're not a data hoarder, the time will probably come when you need to add additional storage to a guest system. No worries! This is easy to do! This recipe teaches you how to add and modify the virtual hardware attached to a machine.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec313"/>Getting ready</h2></div></div></div><p>This recipe requires a virtual machine set up as described in the previous recipes.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec314"/>How to do it...</h2></div></div></div><p>Follow these steps to add storage to a virtual machine:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure the virtual machine you want to modify is not running.</li><li class="listitem">Open the virtual machine by double-clicking on the desired entry in the list of available machines.</li><li class="listitem">Either click on the lightbulb icon in the menu bar or select <span class="strong"><strong>Details</strong></span> from <span class="strong"><strong>View</strong></span> to show the virtual machine's hardware details:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_008.jpg"/><div class="caption"><p>The machine's virtual hardware is displayed and resources can be added, modified, and removed</p></div></div></li><li class="listitem">Click on the <span class="strong"><strong>Add Hardware</strong></span> button in the bottom-left corner of the window to open the <span class="strong"><strong>Add New Virtual Hardware</strong></span> window.</li><li class="listitem">Select <span class="strong"><strong>Storage</strong></span> from the list of possible resources. Specify the desired storage space to allocate for the new disk and click on <span class="strong"><strong>Finish</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_009.jpg"/><div class="caption"><p>A virtual 8 GB storage drive is added to the machine</p></div></div></li><li class="listitem">Leave the hardware view by either clicking on the computer icon in the menu bar or selecting <span class="strong"><strong>Console</strong></span> from <span class="strong"><strong>View</strong></span>.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec315"/>How it works...</h2></div></div></div><p>This recipe showed you where to configure the virtual hardware definitions associated with a machine. To increase the storage available to a guest operating system, we navigated to this view and added a new virtual drive. The storage device can be created through the interface, as shown in the recipe, or an existing drive file can be selected and attached to the system.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note87"/>Note</h3><p>If you are creating a new disk, you will want to partition, format, and mount the storage so it can be used. You may find the recipes discussed in <a class="link" href="ch05.html" title="Chapter 5. Managing Filesystems and Storage">Chapter 5</a>, <span class="emphasis"><em>Managing Filesystems and Storage </em></span>helpful.</p></div></div><p>Other hardware can be managed via the hardware view as well. Most notably, you can add and configure new network interfaces and allocate additional RAM and CPU resources. Increasing the RAM/CPU might be done to run resource-intensive processes on the system—it's better to allocate a smaller amount first and then increase the resources when the need arises.</p><p>Another useful configuration is to change the display server. By default, the display is configured to use SPICE, a more robust protocol than VNC. A SPICE server is built into the virtualization platform so that you can connect to the virtual machine using a SPICE client to access its display, even if the guest is only running a console display (refer to <a class="ulink" href="https://www.spice-space.org/">https://www.spice-space.org/</a> to find a SPICE client). If you want to connect using VNC instead, select the <span class="strong"><strong>Display Spice</strong></span> entry in the hardware list and set its <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>VNC server</strong></span>. Change the <span class="strong"><strong>Address</strong></span> value to <span class="strong"><strong>All interfaces</strong></span> to accept connections from outside the localhost, specify a connection password, and then click on the <span class="strong"><strong>Apply</strong></span> button.</p><p>The display's label in the hardware list will change to <span class="strong"><strong>Display VNC</strong></span>:</p><div class="mediaobject"><img alt="How it works..." src="graphics/image_12_010.jpg"/><div class="caption"><p>Users can connect to a virtual system's display using a SPICE or VNC client</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec316"/>See also</h2></div></div></div><p>Refer to the following resources for more information on working with virtual hardware:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">RHEL 7 Virtualization Deployment and Administration Guide: Storage Pools  
(<a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Storage_pools.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Storage_pools.html</a>)</li><li class="listitem" style="list-style-type: disc">Storage management (<a class="ulink" href="http://libvirt.org/storage.html">http://libvirt.org/storage.html</a>)</li></ul></div></div></div>
<div class="section" title="Connecting USB peripherals to a guest system"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec97"/>Connecting USB peripherals to a guest system</h1></div></div></div><p>This recipe teaches you how to share the USB devices that are connected to the host system with a virtual machine. This means you can use your USB printers, webcams, and storage devices from your guest operating system.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec317"/>Getting ready</h2></div></div></div><p>This recipe requires a virtual machine set up as described in the previous recipes.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec318"/>How to do it...</h2></div></div></div><p>Follow these steps to connect USB peripherals to a guest system:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure the virtual machine you want to modify is not running.</li><li class="listitem">Attach the USB device to the physical system.</li><li class="listitem">Open the virtual machine by double-clicking on the desired entry in the list of available machines.</li><li class="listitem">Show the virtual machine's hardware details by clicking on the lightbulb icon in the menu bar or selecting <span class="strong"><strong>Details</strong></span> from <span class="strong"><strong>View</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Add Hardware</strong></span> button to open the <span class="strong"><strong>Add New Virtual Hardware</strong></span> window.</li><li class="listitem">Select <span class="strong"><strong>USB HOST Device</strong></span> from the list of resources.</li><li class="listitem">Select the desired USB device and then click on the <span class="strong"><strong>Finish</strong></span> button:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_011.jpg"/><div class="caption"><p>USB devices attached to the host system can be assigned to the virtual machines</p></div></div></li><li class="listitem">Leave the hardware view by either clicking on the computer icon in the menu bar or selecting <span class="strong"><strong>Console</strong></span> from <span class="strong"><strong>View</strong></span>.</li><li class="listitem">Start the virtual machine and verify that the USB device is available.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec319"/>How it works...</h2></div></div></div><p>USB devices attached to the host system can be allocated to a virtual machine through the hardware details. We selected the <span class="strong"><strong>USB Host Device</strong></span> category, which displayed all of the devices currently registered with the host from which we can make our selection. There are a couple of items to be aware of when using USB devices in your guest system. First, only the USB 1.1 protocol is supported. This isn't an issue for most peripherals, such as webcams, printers, and USB microphones, where transfer speed isn't much of a concern. It may be a concern if you intend to attach a USB storage device and transfer large amounts of data. Second, the device must be plugged in and accessible by the host before starting the virtual machine. This is because the virtualization platform running on the host is responsible for provisioning access to the guest.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note88"/>Note</h3><p>This recipe showed you how to assign a USB device connected to the host system to a guest. If you're accessing your virtual machine remotely with a SPICE client, you can plug in USB devices to your local machine and redirect them to the remote guest using USB redirection. More information can be found in the RHEL 7 Virtualization Deployment and Administration Guide.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec320"/>See also</h2></div></div></div><p>Refer to the following resources for more information on sharing USB devices:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">RHEL 7 Virtualization Deployment and Administration Guide: USB Devices    
(<a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Guest_virtual_machine_device_configuration-USB_devices.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Guest_virtual_machine_device_configuration-USB_devices.html</a>)</li><li class="listitem" style="list-style-type: disc">USB pass-through with libvirt and KVM (<a class="ulink" href="https://david.wragg.org/blog/2009/03/usb-pass-through-with-libvirt-and-kvm.html">https://david.wragg.org/blog/2009/03/usb-pass-through-with-libvirt-and-kvm.html</a>)</li></ul></div></div></div>
<div class="section" title="Configuring a guest's network interface"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec98"/>Configuring a guest's network interface</h1></div></div></div><p>This recipe teaches you how to configure the virtual network interface's behavior. By changing the interface's behavior, you can provide the guest direct access or filtered access to the network, and even set up a local network visible only to the host system and other guests.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec321"/>Getting ready</h2></div></div></div><p>This recipe requires a CentOS system with a working network connection. It also requires a virtual machine set up as described in the previous recipes.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec322"/>How to do it...</h2></div></div></div><p>Follow these steps to configure a guest's network interface:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure that the virtual machine you want to modify is not running.</li><li class="listitem">Open the virtual machine by double-clicking on the desired entry in the list of available machines.</li><li class="listitem">View the virtual machine's hardware details by clicking on the lightbulb icon in the menu bar or selecting <span class="strong"><strong>Details</strong></span> from <span class="strong"><strong>View</strong></span>.</li><li class="listitem">Specify the desired <span class="strong"><strong>Network source</strong></span> (NAT or Host device).</li><li class="listitem">If selecting a host device, specify the desired mode (Bridged, VEPA, Private, or Passthrough):<div class="mediaobject"><img alt="How to do it..." src="graphics/image_12_012.jpg"/><div class="caption"><p>The virtual network interface can be configured to handle the guest's traffic in different ways</p></div></div></li><li class="listitem">Click on the <span class="strong"><strong>Apply</strong></span> button to save your configuration.</li><li class="listitem">Leave the hardware view by either clicking on the computer icon in the menu bar or selecting <span class="strong"><strong>Console</strong></span> from <span class="strong"><strong>View</strong></span>.</li><li class="listitem">Start the virtual machine and proceed to configuring the guest's networking as necessary.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec323"/>How it works...</h2></div></div></div><p>Managing a guest's network connectivity is a matter of specifying the behavior of the virtual machine's network adaptor. To do this correctly, we need to first understand what the behaviors are from the options that are available to us.</p><p>The first option is <span class="strong"><strong>Network Address Translation</strong></span> (<span class="strong"><strong>NAT</strong></span>) and that is the default for new virtual machines. The virtualization platform provides a virtual network interface to the guest and handles all of its traffic. The platform marshals the traffic through the host's physical interface, acting very much like a router between the guest and host.</p><p>The second option is to tie the virtual interface directly to the host's physical interface. There are four sharing modes, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bridged</strong></span>: The virtualization platform connects the guest and host interfaces, giving the guest direct access to the Internet. The guest needs to obtain its own IP address and has full access to the network.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VEPA</strong></span>: This is for use with VEPA-capable network devices (special hardware requirements must be met).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Private</strong></span>: The platform creates private network, routing packets so that virtual machines on the same host can communicate with one another and the external network, but connections coming in from the network can't reach the virtual machines.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Passthrough</strong></span>: The host's interface is shared directly (additional technical requirements must be met).</li></ul></div><p>The documentation and terminology are quite technical, given the nature of the subject. Moreover, many people who are not networking experts often have trouble deciding the correct configuration. In my experience, there're two common scenarios in which non-networkers use virtualization-local virtualization to provide an alternate environment and virtualization to provision multiple server systems. If you're using your virtual machine as a typical desktop system where users need Internet access to read e-mail and surf the Web, use NAT networking and configure the guest to use DHCP. If you're running the machines as servers, share the host's adaptor in the Bridged mode and configure the guest with a static IP address.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec324"/>See also</h2></div></div></div><p>Refer to the following resources for more information on configuring the virtual network interface:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">libvirt Virtualization API: Networking (<a class="ulink" href="http://wiki.libvirt.org/page/Networking">http://wiki.libvirt.org/page/Networking</a>)</li><li class="listitem" style="list-style-type: disc">RHEL 7 Virtualization Deployment and Administration Guide: Network Configuration (<a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Network_configuration.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/chap-Network_configuration.html</a>)</li></ul></div></div></div></body></html>