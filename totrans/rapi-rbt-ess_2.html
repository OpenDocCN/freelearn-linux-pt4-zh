<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Building the Biped"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Building the Biped</h1></div></div></div><p>Now that you've got your Raspberry Pi 2 Model B all configured and ready to go, you'll need to add some hardware to control and interface. In this chapter, you'll learn:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How <a id="id59" class="indexterm"/>to build a basic 10 <span class="strong"><strong>Degrees of Freedom</strong></span> (<span class="strong"><strong>DOF</strong></span>) biped</li><li class="listitem" style="list-style-type: disc">How to use a servo motor controller connected to the USB port of the Raspberry Pi to control the servos to make your robot move</li></ul></div><div class="section" title="Building robots that can walk"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec13"/>Building robots that can walk</h1></div></div></div><p>There <a id="id60" class="indexterm"/>are several choices when considering how to create a mobile robot. One of the more interesting choices is a robot that can walk. This normally comes in three versions: a biped robot with two legs, a biped robot with four legs, and a hexapod robot with six legs. While each offers an interesting and different set of possibilities, in this chapter, you'll build a basic, 10 DOF biped.</p><p>You'll be using a total of 10 servos for your project, as each leg has 5 points that can move, or 5 degrees of freedom (DOF). As servos are the most critical component of this project, it is perhaps useful to go through a tutorial on servos and learn how to control them.</p></div></div>
<div class="section" title="How servo motors work"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>How servo motors work</h1></div></div></div><p>Servo <a id="id61" class="indexterm"/>motors are somewhat similar to DC motors. However, there is an important difference. While DC motors are generally designed to move in a continuous way—rotating 360 degrees at a given speed—servos are generally designed to move to a limited set of angles. In other words, in the DC motor world, you generally want your motors to spin with a continuous rotation speed that you control. In the servo world, you want your motor to move to a specific position that you control.</p><p>This is done by sending a <span class="strong"><strong>Pulse-Width-Modulated</strong></span> (<span class="strong"><strong>PWM</strong></span>) signal to the control connector <a id="id62" class="indexterm"/>of the servo. The length of this pulse will control the angle of the servo like this:</p><div class="mediaobject"><img src="graphics/B04591_02_01.jpg" alt="How servo motors work"/></div><p>These <a id="id63" class="indexterm"/>pulses are sent out with a repetition rate of 60 Hz. You can position the servo to any angle by setting the correct control pulse.</p></div>
<div class="section" title="Building the biped platform"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Building the biped platform</h1></div></div></div><p>There <a id="id64" class="indexterm"/>are several approaches to building your biped platform. Perhaps the most simple is to purchase a set of basic parts; this is the example you'll see<a id="id65" class="indexterm"/> in this chapter. There are several kit possibilities out there, including one at <a class="ulink" href="http://www.robotshop.com/en/lynxmotion-biped-robot-scout-bps-ns-servos.html">http://www.robotshop.com/en/lynxmotion-biped-robot-scout-bps-ns-servos.html</a>, a kit like the one offered at <a class="ulink" href="http://www.ebay.com/itm/10-DOF-Biped-Robot-Mechanical-Leg-Robot-Servo-Motor-Bracket-NO-Servo-Motor-good-/131162548695?pt=LH_DefaultDomain_0&amp;hash=item1e89e5a9d7">http://www.ebay.com/itm/10-DOF-Biped-Robot-Mechanical-Leg-Robot-Servo-Motor-Bracket-NO-Servo-Motor-good-/131162548695?pt=LH_DefaultDomain_0&amp;hash=item1e89e5a9d7</a>, or the one at <a class="ulink" href="http://www.amazon.com/gp/product/B00DR7GA4I/ref=oh_aui_detailpage_o04_s00?ie=UTF8&amp;psc=1">http://www.amazon.com/gp/product/B00DR7GA4I/ref=oh_aui_detailpage_o04_s00?ie=UTF8&amp;psc=1</a>. This is the specific kit we'll use in this chapter.</p><p>In the end, your biped will work more like the legs of a Tyrannosaurus Rex of a human, but this will make it easier to program, and it will power down more gracefully. It will also be a bit more stable.</p><p>You'll also need 10 standard size servos. There are several possible choices, but <span class="strong"><strong>Hitec</strong></span> servos are <a id="id66" class="indexterm"/>relatively inexpensive servos and you can get them at most hobby shops and online electronics retailers. One of the important steps in this process is to select the model of the servo. Servos come in different model numbers, primarily based on the amount of torque they can generate.</p><p>Torque is the force that the servo can exert to move the part connected to it. In this case, your servos<a id="id67" class="indexterm"/> will need to lift and move the weight associated with your biped, so you'll need a servo with enough torque to do this. However, there are different torque needs for your biped robot. The angle joints will not lift the entire leg, so they can be servos with a lower servo <a id="id68" class="indexterm"/>rating, for example, the HS-422 servos. For the knee servo, you'll need a more powerful servo. In this case, I suggest that you use model HS-645MGHB servos. The hip joint that lifts the leg is where you will need the most torque to be able to lift the leg. Here, too, I suggest that you use the model HS-645MG servos. You can also just use 10 HS-645MG servos for all the servos, but they are more expensive, so using different servos will save you some money.</p><p>One final piece that you'll need is some metal servo horns. These servo horns are optional, but they will make your biped robot much more solid than the plastic servo horns that normally come with the servos. Here is a picture of one of these horns:</p><div class="mediaobject"><img src="graphics/B04591_02_02.jpg" alt="Building the biped platform"/></div><p>Here are the steps to assemble the biped:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Attach<a id="id69" class="indexterm"/> the first ankle servo to the foot. To do this, find the foot plate, as shown here:<div class="mediaobject"><img src="graphics/B04591_02_03.jpg" alt="Building the biped platform"/></div><p>This is <a id="id70" class="indexterm"/>the bottom of the foot. Notice the beveled holes-you'll be using bevel-headed bolts to connect a servo bracket to the foot plate, as shown here:</p><div class="mediaobject"><img src="graphics/B04591_02_04.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Make <a id="id71" class="indexterm"/>sure that the bottom of the foot is flat. Before <a id="id72" class="indexterm"/>you mount the servo to this bracket, you'll first connect a U-shaped bracket to this servo bracket using one of the bearings in the kit, like this:<div class="mediaobject"><img src="graphics/B04591_02_05.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Finally, mount <a id="id73" class="indexterm"/>one of the <a id="id74" class="indexterm"/>servos in the bracket and connect the U-shaped bracket to the servo horn, as shown here:<div class="mediaobject"><img src="graphics/B04591_02_06.jpg" alt="Building the biped platform"/></div></li><li class="listitem">This first servo should allow your biped to move the foot, tipping it side to side. Now, add the <a id="id75" class="indexterm"/>second ankle servo to the foot. This will <a id="id76" class="indexterm"/>allow your biped to tip the ankle front to back. To do this, connect a servo bracket to the assembly you just created, and then add a U bracket to this assembly, like this:<div class="mediaobject"><img src="graphics/B04591_02_07.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Now, add<a id="id77" class="indexterm"/> the bracket<a id="id78" class="indexterm"/> to this assembly, like this:<div class="mediaobject"><img src="graphics/B04591_02_08.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Now, you <a id="id79" class="indexterm"/>can add the knee servo to your biped. However, you'll<a id="id80" class="indexterm"/> first want to connect the upper leg, the longest U bracket, to a servo bracket, like this:<div class="mediaobject"><img src="graphics/B04591_02_09.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Now, connect <a id="id81" class="indexterm"/>this assembly, using another bearing, to<a id="id82" class="indexterm"/> the lower leg that you have already built, like this:<div class="mediaobject"><img src="graphics/B04591_02_10.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Now, you<a id="id83" class="indexterm"/> can mount the knee servo in this place. If <a id="id84" class="indexterm"/>you have different servos, use a more powerful servo in the knee joint. Here is a picture:<div class="mediaobject"><img src="graphics/B04591_02_11.jpg" alt="Building the biped platform"/></div></li><li class="listitem">The <a id="id85" class="indexterm"/>last step is to put the hip together. First, you'll put <a id="id86" class="indexterm"/>the servo that turns the leg, connecting it to a servo bracket, as shown here:<div class="mediaobject"><img src="graphics/B04591_02_12.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Now, connect this servo bracket to the long U bracket, and mount the servo that lifts the entire leg. This is another place; if you are using different servos, you'll want to use a servo with a significant torque. The entire assembly <a id="id87" class="indexterm"/>should look like this:<div class="mediaobject"><img src="graphics/B04591_02_13.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Put the other leg together. It will be a mirror image of the first leg.</li><li class="listitem">Now, you'll <a id="id88" class="indexterm"/>connect both legs to the hip by first connecting a servo bracket connector to the hip piece, in two places, like this:<div class="mediaobject"><img src="graphics/B04591_02_14.jpg" alt="Building the biped platform"/></div></li><li class="listitem">Finally, mount the top of the leg servos into the brackets, like this:<div class="mediaobject"><img src="graphics/B04591_02_15.jpg" alt="Building the biped platform"/></div></li></ol></div><p>Your <a id="id89" class="indexterm"/>biped is <a id="id90" class="indexterm"/>now ready to walk. Now that you have the basic hardware assembled, you can turn your attention to the electronics.</p></div>
<div class="section" title="Using a servo controller to control the servos"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Using a servo controller to control the servos</h1></div></div></div><p>To<a id="id91" class="indexterm"/> make your biped walk, you first need to<a id="id92" class="indexterm"/> connect the servo motor controller to the servos. The servo controller you are going to use for this project is a simple servo motor controller utilizing the USB from Pololu—Pololu item number 1354 is available at pololu.com—that can control 18 servo motors. Here is a picture of the unit:</p><div class="mediaobject"><img src="graphics/B04591_02_16.jpg" alt="Using a servo controller to control the servos"/></div><p>Make sure that you order the assembled version. This piece of hardware will turn USB commands from Raspberry Pi into signals that control your servo motors. Pololu creates a number of different versions of this controller, and each one is able to control a certain number of servos. In this case, you may want to choose the 18 servo version, so that you can control all 12 servos with one controller, and you may also add an additional servo to control the direction of a camera or sensor. You could also choose the 12 servo version. One advantage of the 18 servo controller is the ease of connecting power to the unit via screw-type connectors.</p><p>There are two connections you'll need to make to the servo controller in order to get started: the first to the servo motors and the second to a battery.</p><p>First, connect the servos to the controller. In order to be consistent, let's connect your 12 servos to the connections marked 0 through 11 on the controller using this configuration:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Servo Connector</p>
</th><th style="text-align: left" valign="bottom">
<p>Servo</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>0</p>
</td><td style="text-align: left" valign="top">
<p>Right ankle in/out</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>1</p>
</td><td style="text-align: left" valign="top">
<p>Right ankle front/back</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>2</p>
</td><td style="text-align: left" valign="top">
<p>Right knee</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>3</p>
</td><td style="text-align: left" valign="top">
<p>Right hip up/down</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>4</p>
</td><td style="text-align: left" valign="top">
<p>Right hip turn</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>5</p>
</td><td style="text-align: left" valign="top">
<p>Left ankle in/out</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>6</p>
</td><td style="text-align: left" valign="top">
<p>Left ankle front/back</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>7</p>
</td><td style="text-align: left" valign="top">
<p>Left knee</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>8</p>
</td><td style="text-align: left" valign="top">
<p>Left up/down</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>9</p>
</td><td style="text-align: left" valign="top">
<p>Left hip turn</p>
</td></tr></tbody></table></div><p>Here is <a id="id93" class="indexterm"/>a <a id="id94" class="indexterm"/>picture of the back of the controller; this will tell us where to connect our servos:</p><div class="mediaobject"><img src="graphics/B04591_02_17.jpg" alt="Using a servo controller to control the servos"/></div><p>Now, you<a id="id95" class="indexterm"/> need to connect the servo motor<a id="id96" class="indexterm"/> controller to your battery. For this project, you can use a 2S RC LiPo battery; it will supply the 7.4 volts and the current required by your servos, which can be on the order of 2 amps. Here is a picture:</p><div class="mediaobject"><img src="graphics/B04591_02_18.jpg" alt="Using a servo controller to control the servos"/></div><p>This <a id="id97" class="indexterm"/>battery will come with two connectors, one <a id="id98" class="indexterm"/>with larger gauge wires for normal usage and a smaller connector to connect to the battery recharger. You can use the XT60 Connector Pairs, solder some wires to the mating connector of the battery, and then insert the bare end of the wires into the servo controller.</p><p>Your system is now functional. You can connect the motor controller to your personal computer to check whether you can communicate with it. To do this, connect a mini USB cable between the servo controller and your personal computer.</p></div>
<div class="section" title="Communicating with the servo controller with a PC"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Communicating with the servo controller with a PC</h1></div></div></div><p>Now <a id="id99" class="indexterm"/>that the hardware is connected, you can use some software provided by Polulu to control the servos. Let's do this using your personal<a id="id100" class="indexterm"/> computer. First, download the Polulu SW from <a class="ulink" href="http://www.pololu.com/docs/0J40/3.a">www.pololu.com/docs/0J40/3.a</a>, and install it based on the instructions on the website. Once it is installed, run the software, and you should see this screen:</p><div class="mediaobject"><img src="graphics/B04591_02_19.jpg" alt="Communicating with the servo controller with a PC"/></div><p>First, you <a id="id101" class="indexterm"/>will need to change the configuration in Serial Settings, so select the <span class="strong"><strong>Serial Settings</strong></span> tabs, and you should see this:</p><div class="mediaobject"><img src="graphics/B04591_02_20.jpg" alt="Communicating with the servo controller with a PC"/></div><p>Make sure that USB Chained is selected; this will allow you to connect and control the motor controller <a id="id102" class="indexterm"/>over USB. Now, go back to the main screen by selecting the <span class="strong"><strong>Status</strong></span> tab; now, you can actually turn on the 10 servos. The screen should look like this:</p><div class="mediaobject"><img src="graphics/B04591_02_21.jpg" alt="Communicating with the servo controller with a PC"/></div><p>Now you can use the sliders to actually control the servos. Turn on servo 0. Make sure that servo 0 moves the lower-right ankle servo. You can also use this to center the servos. Set servo 1 so that the slider is in the middle. Now, unscrew the servo horn on the servo until the servos are centered at this location. At the zero location of all servos, your biped should look like this:</p><div class="mediaobject"><img src="graphics/B04591_02_22.jpg" alt="Communicating with the servo controller with a PC"/></div></div>
<div class="section" title="Connecting the servo controller to the Raspberry Pi"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Connecting the servo controller to the Raspberry Pi</h1></div></div></div><p>You've <a id="id103" class="indexterm"/>checked the servo motor controller <a id="id104" class="indexterm"/>and the servos. You can now connect the motor controller up to the Raspberry Pi and make sure that you can control the servos from it.</p><p>Now, let's talk to the motor controller. Here are the steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect Raspberry Pi to the motor controller by connecting a mini USB to a mini USB cable. Connect the cable to the USB host connection on the Raspberry Pi, like this:<div class="mediaobject"><img src="graphics/B04591_02_23.jpg" alt="Connecting the servo controller to the Raspberry Pi"/></div></li><li class="listitem">Download<a id="id105" class="indexterm"/> the Linux code from Pololu at <a class="ulink" href="https://www.pololu.com/docs/0J40/3.b">https://www.pololu.com/docs/0J40/3.b</a>. Perhaps the best way to do this is to log on to your Raspberry Pi and then type <code class="literal">wget http://www.pololu.com/file/download/maestro-linux-100507.tar.gz?file_id=0J315</code>.</li><li class="listitem">Then, move <a id="id106" class="indexterm"/>the file using <code class="literal">mv maestro-linux-100507.tar.gz\?file_id\=0J315 maestro-linux-100507.tar.gz</code>.</li><li class="listitem">Unpack the file by typing <code class="literal">tar –xvf maestro_linux_011507.tar.gz</code>. This will create a directory called <code class="literal">maestro_linux</code>. Go to this directory by typing <code class="literal">cd maestro_linux</code>, and then type <code class="literal">ls</code>; you should see something like this:<div class="mediaobject"><img src="graphics/B04591_02_24.jpg" alt="Connecting the servo controller to the Raspberry Pi"/></div></li></ol></div><p>The <code class="literal">README.txt</code> document <a id="id107" class="indexterm"/>will give <a id="id108" class="indexterm"/>you explicit instructions on how to install the software. Unfortunately, you can't run <span class="strong"><strong>MaestroControlCenter</strong></span> on your Raspberry Pi; the version of Windows it uses doesn't support the graphics, but you can control your servos using the <span class="strong"><strong>UscCmd</strong></span> command-line application. First, type<code class="literal">./UscCmd --list</code>, and you should see the following:</p><div class="mediaobject"><img src="graphics/B04591_02_25.jpg" alt="Connecting the servo controller to the Raspberry Pi"/></div><p>The <a id="id109" class="indexterm"/>unit sees<a id="id110" class="indexterm"/> your servo controller. If you just type <code class="literal">./UscCmd</code>, you can see all the commands you could send to your controller:</p><div class="mediaobject"><img src="graphics/B04591_02_26.jpg" alt="Connecting the servo controller to the Raspberry Pi"/></div><p>Note <a id="id111" class="indexterm"/>that you can send a specific target <a id="id112" class="indexterm"/>angle to a servo, although the target is not in angle values, so it makes it a bit difficult to know where you are sending your servo. With a servo and battery connected to the servo controller, try to type <code class="literal">./UscCmd --servo 0, 10</code>. The servo will move to its full angle position. Type <code class="literal">./UscCmd – servo 0, 0</code>, and it will stop the servo from trying to move. In the next section, you'll write some Python code that will translate your angles to the commands that the servo controller will want to see in order to move it to specific angle locations. If you are<a id="id113" class="indexterm"/> struggling with the USB connection, refer to <a class="ulink" href="http://www.linux-usb.org/FAQ.html">http://www.linux-usb.org/FAQ.html</a> for more information.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>If you didn't run the Windows version of Maestro Controller and set <span class="strong"><strong>Serial Settings</strong></span> to <span class="strong"><strong>USB Chained</strong></span>, your motor controller may not respond. Rerun the MaestroController code and set <span class="strong"><strong>Serial Settings</strong></span> to <span class="strong"><strong>USB Chained</strong></span>.</p></div></div></div>
<div class="section" title="Creating a program to control your biped"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Creating a program to control your biped</h1></div></div></div><p>Now you know that you can talk to your servo motor controller and move your servos. In this <a id="id114" class="indexterm"/>section, you'll create a Python program that will let you talk to your servos to move them at specific angles. You can use Python as it is very simple and easy to run.</p><p>Let's start with a simple program that will make your legged mobile robot's servos go to 90 degrees (which should be somewhere close to the middle between the 0 to 180 degrees you can set). Here is the code:</p><div class="mediaobject"><img src="graphics/B04591_02_27.jpg" alt="Creating a program to control your biped"/></div><p>Here is an explanation of the code:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">#!/usr/bin/python</code>: This first line allows you to make this Python file execute from the command line.</li><li class="listitem" style="list-style-type: disc"><code class="literal">import serial</code>: This line imports the serial library. You need the serial library to talk to your unit via the USB.</li><li class="listitem" style="list-style-type: disc"><code class="literal">def setAngle(ser, channel, angle):</code>: This function converts your desired setting of servo and angle into the serial command that the servo motor controller needs. To understand the specifics of the code used to control the <a id="id115" class="indexterm"/>servos, refer to <a class="ulink" href="https://www.pololu.com/docs/0J40">https://www.pololu.com/docs/0J40</a>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ser = serial.Serial("/dev/ttyACM0", 9600)</code>: This opens the serial port <a id="id116" class="indexterm"/>connection to your servo controller.</li><li class="listitem" style="list-style-type: disc"><code class="literal">for i in range(0, 9)</code>: For loop to access all nine servos.</li><li class="listitem" style="list-style-type: disc"><code class="literal">setAngle(ser, i, 90)</code>: Now, you can set each servo to the middle (home) position. The default would be to set each servo to 90 degrees. If your legs aren't in their middle position, you can adjust them by adjusting the position of the servo horns on each servo.</li></ul></div><p>To access the serial port, you'll need to make sure that you have the Python serial library. If you don't, then type <code class="literal">apt-get install python-serial</code>. After you have installed the serial library, you can run your program by typing <code class="literal">python quad.py</code>.</p><p>Once you have the basic home position set, you can ask your robot to do something. Let's start by having your biped move its foot. Here is the Python code:</p><div class="mediaobject"><img src="graphics/B04591_02_28.jpg" alt="Creating a program to control your biped"/></div><p>In this <a id="id117" class="indexterm"/>case, you are using your <code class="literal">setAngle</code> command to set your servos to manipulate your robot's right ankle.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Summary</h1></div></div></div><p>You now have a robot than can move! In the next chapter, you'll learn how to make your robot do many amazing things. You'll learn how to make it walk forward and backward and how to make it dance and turn. With some basic knowledge, any number of movements is possible.</p></div></body></html>