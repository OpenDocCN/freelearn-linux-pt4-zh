<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;A Miscellany of Things"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. A Miscellany of Things</h1></div></div></div><p>The previous chapters have provided us with the foundation and elements to design and put together our entire home security system, which we will do in the next chapter. I hope that I've guided you through this journey in a fairly structured and logical way so that you are ready to do that.</p><p>Beforehand, though, I'm including this chapter dubbed a <span class="emphasis"><em>Miscellany of Things</em></span>, as that's exactly what it is. It comprises a few optional, but useful, extras that we should consider for our system, but that don't really warrant a whole chapter in their own right. I guess you could refer to them as footnotes to previous chapters.</p><p>As such, we will take a look at the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Ways to arm and disarm the system without the web-based panel</li><li class="listitem" style="list-style-type: disc">Driving inductive loads safely from our GPIO outputs</li><li class="listitem" style="list-style-type: disc">Adding an escaped water sensor input to our system</li><li class="listitem" style="list-style-type: disc">Adding a temperature sensor input to our system</li><li class="listitem" style="list-style-type: disc">How carbon monoxide detectors could be added to our system</li><li class="listitem" style="list-style-type: disc">Remotely managing our Raspberry Pi using Webmin</li></ul></div><div class="section" title="Arming and disarming the system"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec53"/>Arming and disarming the system</h1></div></div></div><p>We've included a switch on our Web-based control panel so that you can arm and disarm the system from <a id="id334" class="indexterm"/>your smartphone. However, this is probably not the most convenient way of doing it, especially when you're rushing out of the house, or you've returned home with <a id="id335" class="indexterm"/>a phone whose battery is flat. So, we need to find an additional way of arming and disarming our system at the entry and exit point of our property.</p><p>In the zone list table in the previous chapter, you'll notice that I assigned input GP0 on the Raspberry Pi GPIO as our arm/disarm switch input. This input will work in conjunction with our control panel switch.</p><p>This input can as be a simple<a id="id336" class="indexterm"/> as a toggle switch, or a bit more secure, such as a <span class="strong"><strong>key switch</strong></span> or <a id="id337" class="indexterm"/>
<span class="strong"><strong>electronic keypad</strong></span>. Either way, it will be wired to ground GP0 (GPIO17) on our Raspberry Pi when the system is armed.</p><div class="mediaobject"><img src="graphics/B04579_08_04.jpg" alt="Arming and disarming the system"/><div class="caption"><p>The circuit diagram for our arm/disarm switch</p></div></div><p>If you have switches or other <a id="id338" class="indexterm"/>such devices that will be outside and exposed to the elements, you'll <a id="id339" class="indexterm"/>need to ensure that they are suitable for outdoor use so that they don't get damaged and compromise the integrity of the system.</p><div class="mediaobject"><img src="graphics/B04579_08_05.jpg" alt="Arming and disarming the system"/><div class="caption"><p>The IP67-rated key switch, suitable for outdoor use (type Lorlin WRL-5-E-S-2-B)</p></div></div><p>By using a standalone <a id="id340" class="indexterm"/>
<span class="strong"><strong>security keypad</strong></span>, you can allow each user to have their own code to arm and disarm the system. For <a id="id341" class="indexterm"/>example, the CDVI ECO 100 is a low-cost keypad that allows up to a 100<a id="id342" class="indexterm"/> users. When the correct code is entered, it will arm the system by closing an internal switch. When the code is entered again, the keypad will disarm the system by opening the switch.</p><div class="mediaobject"><img src="graphics/B04579_08_06.jpg" alt="Arming and disarming the system"/><div class="caption"><p>The CDVI ECO 100 programmable keypad</p></div></div></div></div>
<div class="section" title="Driving inductive loads"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec54"/>Driving inductive loads</h1></div></div></div><p>I talked about <a id="id343" class="indexterm"/>driving large loads in <a class="link" href="ch06.html" title="Chapter 6. Adding Cameras to Our Security System">Chapter 6</a>, <span class="emphasis"><em>Adding Cameras to Our Security System</em></span>, but now is probably a good time to expand on this a bit and talk about driving <span class="strong"><strong>inductive loads</strong></span> such as <span class="strong"><strong>bells</strong></span> and<a id="id344" class="indexterm"/> incandescent<a id="id345" class="indexterm"/> <span class="strong"><strong>lamps</strong></span>. In the previous circuit example, I used the TIP120 Darlington transistor to drive an LED array that was not inductive. With inductive loads, you need to add a bit of diode protection to protect the circuit against spikes generated by the coils within relays and bells as they switch <a id="id346" class="indexterm"/>on and off.</p><p>Here's the modified circuit for our digital load driver with a 1N4007 <span class="strong"><strong>rectifier diode</strong></span> for protection:</p><div class="mediaobject"><img src="graphics/B04579_08_07.jpg" alt="Driving inductive loads"/><div class="caption"><p>The digital load driver with diode protection</p></div></div></div>
<div class="section" title="Beyond intrusion"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec55"/>Beyond intrusion</h1></div></div></div><p>Home security is not just about protecting our property against intrusion, it's also about protecting against other risks<a id="id347" class="indexterm"/> too, such as flood, fire, carbon monoxide leaks, and so on. So, it makes sense to extend our home security system to detect these other risks too.</p><p>You may choose to set up the system so that certain types of alerts only come to your phone as emails, rather than triggering all of the outside bells, lights, and whistles. This can be done by adapting the scripts in the next chapter so that they operate how you want them to.</p><div class="section" title="A simple water detector"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec68"/>A simple water detector</h2></div></div></div><p>There's nothing <a id="id348" class="indexterm"/>worse than being away for a few days and coming home to a flooded kitchen because a leak has developed under the sink. Our simple circuit will detect the presence of water and trigger an input on our home security system, which can then alert you. You can also buy kits and ready-built modules to do this, but the following circuit is cheap and features our opto-isolator as we're going to have a different voltage for our actual detector.</p><div class="mediaobject"><img src="graphics/B04579_08_08.jpg" alt="A simple water detector"/><div class="caption"><p>The circuit for a simple water detector, isolated from our GPIO input</p></div></div><div class="section" title="How it works"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec17"/>How it works</h3></div></div></div><p>When water is placed across the probes, current flows through the water, and so, through the R3/R4 potential divider on the base of transistor Q1. When the current at the base is high enough to saturate it, the transistor will switch on fully, allowing the LED inside the opto-coupler to <a id="id349" class="indexterm"/>switch on. This in turn will pull down the input pin to our system to ground via the photo-transistor inside the optocoupler.</p><p>You can use the trimmer, R4, to calibrate the sensor by adjusting its sensitivity. Any generic NPN bipolar transistor should work here, but obviously, they all have different operating parameters, so choose a suitable one.</p></div></div><div class="section" title="A simple temperature sensor"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec69"/>A simple temperature sensor</h2></div></div></div><p>If we want to be alerted when the ambient temperature reaches a certain threshold, then we can build a circuit using the commonly used LM34/LM35 temperature sensors. It's a simple device <a id="id350" class="indexterm"/>with just three pins: power, ground, and output, providing a voltage proportional to the temperature. The difference between the LM34 and LM35 is that the LM34 produces an output of 10mV/°F, whereas the LM35 produces 10mV/°C. There is also an LM335 variant that produces an output of 100mV/°K.</p><div class="mediaobject"><img src="graphics/B04579_08_09.jpg" alt="A simple temperature sensor"/><div class="caption"><p>Pinout taken from the Texas Instruments LM35DZ datasheet</p></div></div><p>It may have occurred to you at this point that this is an analogue device—so how do we interface that with our wholly digital system? One way is to incorporate an analogue-to-digital interface onto our input control board and read the data coming in from that so that we know the exact temperature, but that's probably a bit beyond the scope of this book. So, we're going to<a id="id351" class="indexterm"/> implement a circuit that will alert us when the temperature exceeds a pre-defined threshold, which is probably all we need in the context of our home security system.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note33"/>Note</h3><p>If you're interested in building an analogue-to-digital module to extend your home security, then take a look at something such as the PCF8591 chip from NXP, which is an I2C-based analogue-to-digital converter. This will connect to the I2C bus that we're already <a id="id352" class="indexterm"/>using, and so it is effectively just an add-on.</p><p>
<a class="ulink" href="http://bit.ly/NXPPCF8591T">http://bit.ly/NXPPCF8591T</a>
</p></div></div><p>For our temperature detector circuit, we will use an operational amplifier configured as a comparator that will trigger our opto-coupler input when the pre-set temperature is reached. So, for fire detection, we might want to detect when the ambient temperature has exceeded 50°C.</p><div class="mediaobject"><img src="graphics/B04579_08_10.jpg" alt="A simple temperature sensor"/><div class="caption"><p>The temperature threshold sensor to drive our digital input</p></div></div><div class="section" title="How it works"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec18"/>How it works</h3></div></div></div><p>The reference voltage is set by the variable resistor, R4, which forms a voltage divider between the 12V and<a id="id353" class="indexterm"/> the ground. This essentially means that the reference voltage on the +ve input of the op-amp comparator can be between 0 and 12V. Assuming that we want to detect when 50° is reached, we will need the op-amp to trigger when the –ve is 500mV (10mV/°C).</p><p>In our circuit, the output of the op-amp is high in its normal state, which keeps the opto-coupler on. However, when the threshold is reached, the output of the op-amp is driven low, switching off the transistor Q1, and hence, the opto-coupler. This pulls our alarm input high via resistor R2.</p></div></div><div class="section" title="A carbon monoxide detector"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec70"/>A carbon monoxide detector</h2></div></div></div><p>It's entirely possible to build smoke and carbon-monoxide detectors that we can connect to our home security system in a similar way to the previous sensors, although they are a little bit more<a id="id354" class="indexterm"/> complex as they can require special handling. The SparkFun MQ-7 <span class="strong"><strong>Carbon Monoxide</strong></span> (<span class="strong"><strong>CO</strong></span>) detector (which is actually made by Winsen Electronics) can be implemented in a similar way to our temperature sensor, triggering an alarm input when a particular threshold is reached.</p><div class="mediaobject"><img src="graphics/B04579_08_11.jpg" alt="A carbon monoxide detector"/><div class="caption"><p>The Winsen MQ-7 carbon monoxide gas detector, available from SparkFun.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>The maximum safe continuous exposure to carbon monoxide (CO) is 9ppm (parts-per-million) according to <a id="id355" class="indexterm"/>ASHRAE (<a class="ulink" href="http://www.ashrae.org">www.ashrae.org</a>), and you should certainly not be exposed to CO higher than this for prolonged periods of time, with 35ppm being the absolute maximum for a normal 8-hour working day.</p></div></div><p>The MQ-7 detector has<a id="id356" class="indexterm"/> a sensitivity of between 10 and 500ppm, so in my mind, I'd want to be alerted as soon as it picks up anything, therefore we should set our comparator's reference voltage to the lower end of the scale, in accordance with the sensitivity curve taken from the datasheet, shown as follows:</p><div class="mediaobject"><img src="graphics/B04579_08_12.jpg" alt="A carbon monoxide detector"/><div class="caption"><p>The sensitivity curve taken from the Winsen MQ-7 manufacturer's datasheet.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>
<span class="strong"><strong>Warning</strong></span>
</p><p>I've included this section on carbon monoxide detection more for interest than anything else. It's nasty stuff, and while rolling out your own detector is OK for interest's sake, please keep it just for that. It's useful to have this in our home security system to alert us when we're out of the house as an addition, but this <span class="emphasis"><em>should not</em></span> be a replacement for a commercially available one that sits next to your boiler with<a id="id357" class="indexterm"/> all of the certifications, standards, and so on, and makes a very loud noise when we're in the house.</p></div></div></div></div>
<div class="section" title="Remote administration for our Raspberry Pi"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec56"/>Remote administration for our Raspberry Pi</h1></div></div></div><p>In the previous<a id="id358" class="indexterm"/> chapter, we learned how to set up our system and home network so that we can remotely <a id="id359" class="indexterm"/>access the alarm control panel from wherever we are. I'm now going to show you how to extend this to be able to administer and monitor our entire Raspberry Pi system.</p><div class="section" title="Getting Webmin"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec71"/>Getting Webmin</h2></div></div></div><p>
<span class="strong"><strong>Webmin</strong></span> is a rather fine and well established web-based interface for administering Unix/Linux systems. You can find everything about Webmin on its website at <a class="ulink" href="http://www.webmin.com">www.webmin.com</a>. I'm assuming, as <a id="id360" class="indexterm"/>throughout this book, that you are using the Raspbian distribution on our Pi when it comes to installing Webmin.</p><p>There are a couple of ways to<a id="id361" class="indexterm"/> install Webmin: either by manually downloading and unpacking it, or by updating our repository sources <a id="id362" class="indexterm"/>so that we can use <code class="literal">apt-get</code>. I'm going to opt for the latter, so any dependencies are automatically installed and updates can be managed more easily in the future. There are a few steps, but it's pretty straightforward:</p><div class="section" title="Updating the repository sources"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec19"/>Updating the repository sources</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first thing <a id="id363" class="indexterm"/>we need to do is update our repository sources to include the Webmin repositories:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo nano /etc/apt/sources.list</strong></span>
</pre></div></li><li class="listitem">Add the following two lines to the end of the file:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>deb http://download.webmin.com/download/repository sarge contrib</strong></span>
<span class="strong"><strong>deb http://webmin.mirror.somersettechsolutions.co.uk/repository sarge contrib</strong></span>
</pre></div></li><li class="listitem">Save and exit Nano.</li></ol></div></div><div class="section" title="Importing the signing key"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec20"/>Importing the signing key</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Next, we<a id="id364" class="indexterm"/> need to download and import the repository's signing key:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~</strong></span>
<span class="strong"><strong>$ sudo wget http://www.webmin.com/jcameron-key.asc</strong></span>
<span class="strong"><strong>$ sudo apt-key add jcameron-key.asc</strong></span>
</pre></div></li><li class="listitem">Now that we have everything we need, we can update the package installer and install Webmin. It can take a while, so you might want to go and make yourself a cup of tea or coffee:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get update</strong></span>
<span class="strong"><strong>$ sudo apt-get install webmin</strong></span>
</pre></div></li><li class="listitem">Once it's installed, you should see the following message in the shell window:<div class="mediaobject"><img src="graphics/B04579_08_13.jpg" alt="Importing the signing key"/><div class="caption"><p>Webmin installation</p></div></div></li></ol></div></div><div class="section" title="Accessing Webmin locally"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec21"/>Accessing Webmin locally</h3></div></div></div><p>Webmin, by default, runs on port 10000 and uses the secure HTTP<span class="strong"><strong>S</strong></span> protocol; so, to access it, you need to <a id="id365" class="indexterm"/>enter the following URL in your browser:</p><p>
<code class="literal">https://&lt;my-ip&gt;:10000</code>
</p><p>Where <code class="literal">&lt;my-ip&gt;</code> is the IP address of your Raspberry Pi.</p><p>In the previous chapter, we set up a static IP address on our system; in my case, I set up the address as 192.168.0.99. So, to access Webmin on my system, I would use:</p><p>
<code class="literal">https://192.168.0.99:10000</code>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note36"/>Note</h3><p>
<span class="strong"><strong>HTTPS Privacy Errors</strong></span>
</p><p>In some browsers, such as Google Chrome, you might see a privacy error as you try to access the Webmin Web page. This is because the SSL certificate behind the HTTPS connection is not signed by a known authority. This is fine—just tell your browser that you want to accept this and proceed (in Chrome, you need to click on the <span class="strong"><strong>Advanced</strong></span> link first to access that option).</p></div></div><div class="mediaobject"><img src="graphics/B04579_08_14.jpg" alt="Accessing Webmin locally"/></div><p>You can log into <a id="id366" class="indexterm"/>Webmin using<a id="id367" class="indexterm"/> the <span class="strong"><strong>root</strong></span> or <span class="strong"><strong>pi</strong></span> user<a id="id368" class="indexterm"/> account, or any other account that <a id="id369" class="indexterm"/>has <span class="strong"><strong>sudo</strong></span> rights:</p><div class="mediaobject"><img src="graphics/B04579_08_15.jpg" alt="Accessing Webmin locally"/><div class="caption"><p>Webmin login</p></div></div><p>Once logged in, you'll<a id="id370" class="indexterm"/> be presented with the main system information page. Have a good poke around in it because there's lots of useful stuff you can see and do.</p><div class="mediaobject"><img src="graphics/B04579_08_16.jpg" alt="Accessing Webmin locally"/><div class="caption"><p>Webmin system information view</p></div></div><p>Webmin comes with a lot of modules, and not all of them are installed; therefore, you might want to explore the<a id="id371" class="indexterm"/> <span class="strong"><strong>Un-used Modules</strong></span> section of the panel to see if there is anything you want to <a id="id372" class="indexterm"/>add to Webmin.</p></div><div class="section" title="Remotely accessing Webmin"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec22"/>Remotely accessing Webmin</h3></div></div></div><p>In the same way that we<a id="id373" class="indexterm"/> set up remote access for our alarm control panel in the previous chapter, you can do it with Webmin—just set up port-forwarding <a id="id374" class="indexterm"/>on your router for port 10000. You can then access Webmin from anywhere using <code class="literal">https://&lt;my-public-ip&gt;:10000</code>.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec57"/>Summary</h1></div></div></div><p>Well, this has been a bit of a mix-and-match of various topics to end on before we put together our home security system framework. I hope you enjoyed these various footnotes to previous chapters, and that it's given you some ideas on how far you can take your home security system.</p><p>We started by looking at ways we can arm and disarm our system without having to access the Web-based control panel, by adding a mechanical or digital switch to an arm/disarm input.</p><p>We then looked at adding analogue-type sensors to our system, which can alert us when a threshold has been reached by using operational amplifiers set up as voltage comparators. The idea behind these comparator circuits can be implemented for different types of sensors where you want to know when a certain voltage threshold has been reached at the analogue sensor output.</p><p>Finally, we learned how to install Webmin on our Raspberry Pi so that we can monitor and configure many aspects of the Linux operating system.</p><p>The next chapter is the moment we've all been waiting for; we're going to take all of the elements and concepts from the previous chapters and put together our full system comprising the elements we want to feature. The star of the show will be our Bash scripts, which will glue together all of these elements and provide the control logic for the entire system.</p></div></body></html>