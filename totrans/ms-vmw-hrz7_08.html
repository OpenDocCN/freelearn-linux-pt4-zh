<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Securing Horizon View with SSL Certificates</h1>
                </header>
            
            <article>
                
<p>n this chapter, we will discuss the security aspect of VMware Horizon View 7, and in particular, how we deliver secure communication not only with the end user client but also between the different View infrastructure components in the data center. W<span>e are going to look at two ways t</span>o deliver this secure communication.</p>
<p>We will start with <strong>Secure Sockets Layer</strong> (<strong>SSL</strong>) certificates and get an overview of SSL, before learning how to create/issue a certificate and configure Horizon View to use it. The second option that will be covered in this chapter is <strong>True SSO</strong>. True SSO provides users with a way to authenticate to their virtual desktops that keeps all of their usual domain privileges but doesn't require them to provide their Active Directory credentials. You will more than likely have SSL certificates already set up in your environment, but for this chapter, we're going to set up a test environment using a server in the example lab.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Horizon View and SSL certificates</li>
<li>Installing SSL cerificates for Horizon View</li>
<li>Horizon View True SSO</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Horizon View and SSL certificates</h1>
                </header>
            
            <article>
                
<p>Let's start by defining SSL. SSL is an encryption technology developed by Netscape.</p>
<p>It is used to create an encrypted connection between a web server and the web browser in which you will view web pages. By using SSL, you can securely view the information sent to your browser, knowing that nobody else can access it.</p>
<p class="mce-root"/>
<p>SSL works by means of an SSL certificate that is installed on a server and is used to identify you. So the question is, how do you know whether you are using a secure connection to connect to the server? If you have a secure connection, you will see a padlock icon in your browser or the address bar will be colored green.</p>
<div class="packt_infobox">To ensure you have a secure connection, you can also access the site using <kbd>https://</kbd> in your browser rather than the usual <kbd>http://</kbd>.</div>
<p>SSL certificates are provided by <strong>Certificate Authorities</strong> (<strong>CAs</strong>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">What is a CA?</h1>
                </header>
            
            <article>
                
<p>A <strong>CA</strong> is a service that issues digital certificates to organizations or people after validating them. CAs keep detailed records of the certificates that have been issued and any other information that was used when the certificate was issued. These are regularly audited to ensure compliance.</p>
<p>You can obtain a <span>CA</span> from different organizations, or you can create your own from a root CA.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Why do I need SSL certificates for Horizon View?</h1>
                </header>
            
            <article>
                
<p class="NormalPACKT"><span>If you are transmitting sensitive information from a website to an endpoint device, you need to secure the information with encryption; otherwise, data could be compromised.</span></p>
<p class="NormalPACKT"><span>As Horizon View is essentially like a web service to which end users connect from their endpoint device to the View Connection Server, you need to ensure that this connection is secured. In this case, SSL is used to establish a secured link between the client device and the virtual desktop machine. Although, with Horizon View, no actual data is transmitted, the pixels from your virtual desktop machin</span>e are tran<span>smitted, and if a third party intercepts this transmission, they could potentially see your screen by redrawing these pixels. SSL is also used for communication between Horizon View components, such as Connection Servers and Replica Servers.</span></p>
<p class="mce-root"/>
<div class="NormalPACKT packt_infobox"><span>Having an SSL certificate installed is a requirement for Horizon View.</span></div>
<p>By default, Horizon View comes with self-signed certificates that are fine for a proof of concept or a small-scale pilot, but for a production environment, you will need to have enterprise-class certificates.</p>
<p>The use of certificates became a requirement with View 5.1, where they were used for the Horizon View components to communicate, such as the Connection Server, Replica Server, and View Composer, as well as the underlying infrastructure of the ESXi hosts and Virtual Center Servers. Each of these components needs to have a certificate installed, along with the client device that is connecting to it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing SSL certificates for Horizon View</h1>
                </header>
            
            <article>
                
<p>In the next sections of this chapter, we will briefly cover how to set up certificates by installing a root CA in our example test environment to get you started with Horizon View. However, we strongly recommend that you engage with your security team to deploy the correct type of certificate for your organization and environment.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing a root CA</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to walk through the process of setting up a server that will act as our root CA in the example lab. A server has already been built called <strong>HZN7-CERTS</strong>, which we will use for this role.</p>
<p>To configure the root CA, follow these steps:</p>
<ol>
<li>Open a console to the <strong>HZN7-CERTS</strong> server, and launch the <span class="packt_screen">Server Manager</span>.</li>
<li>Click on <span class="packt_screen">Add roles and features</span> (<strong>1</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5918da65-7cbc-44a2-b9dd-5873b987ea99.png"/></div>
<ol start="3">
<li>You will now see the <span class="packt_screen">Add Roles and Features Wizard</span> and the <span class="packt_screen">Before You Begin</span> screen. Click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
<li>Next, you will see the <span class="packt_screen">Installation Type</span> screen. Click the radio button for <span class="packt_screen">Role-based or feature-based installation</span> (<strong>2</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/15cb8bc9-390d-4fc8-93a3-40f2f1f59931.png"/></div>
<ol start="5">
<li>Click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
<li>You will now see the <span class="packt_screen">Server Selection</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cd1d156f-e385-4f1e-9c93-ea9e3678362d.png"/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="7">
<li>Click on the radio button for <span class="packt_screen">Select a server from the server pool</span> (<strong>3</strong>), and then highlight the <kbd>hzn7-certs.pvolab.com</kbd> server from the list (<strong>4</strong>).</li>
<li>Click the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">Server Roles</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/460d7895-48e3-4de5-8020-a43e13c66178.png"/></div>
<ol start="9">
<li>Check the box for <span class="packt_screen">Active Directory Certificate Services</span> (<strong>5</strong>) and then, in the pop-up box for <span class="packt_screen">Add features that are required for Active Directory Certificate Services</span>, click on the <span class="packt_screen">Add Features</span> button (<strong>6</strong>).</li>
<li>You will now return to the <span class="packt_screen">Server Roles</span> screen, which will show that <span class="packt_screen">Active Directory Certificate Services</span> is now checked. Click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
<li>Next, you will see the <span class="packt_screen">Features</span> configuration screen. Click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="12">
<li>The next part of the <span class="packt_screen">Add Roles and Features Wizard</span> screen is the <span class="packt_screen">Active Directory Certificate Services</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0113abaf-24a6-409f-a2a4-112ddd3674e6.png"/></div>
<ol start="13">
<li>Click the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">Select role service</span><span class="packt_screen">s</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ee033b07-ca4c-4d86-b64a-41c62ed0e026.png"/></div>
<ol start="14">
<li>Under <span class="packt_screen">Role services</span>, check the box for <span class="packt_screen">Certification Authority</span> (<strong>7</strong>), and then click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
<li>On the <span class="packt_screen">Confirm installation selections</span> screen, check the box for <span class="packt_screen">Restart the destination server automatically</span> (<strong>8</strong>), and then click on the <span class="packt_screen">Install</span> button.</li>
</ol>
<p>The certificate services feature has now been installed. There are now some post-deployment configuration to be completed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Root CA post-deployment configuration tasks</h1>
                </header>
            
            <article>
                
<p>With the core root CA components installed, you can now complete the post-deployment configuration tasks:</p>
<ol>
<li>From the menu bar along the top of the <span class="packt_screen">Server Manager Dashboard</span>, click the warning yellow triangle warning box, and from the options that pop up, click the <span class="packt_screen">Configure Active Directory Certificate Services</span> entry (<strong>1</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/27c3f26a-1c6b-4813-a0b0-199c05d0b3f1.png" style=""/></div>
<ol start="2">
<li>You will now see the <span class="packt_screen">AD CS Configuration</span> screen and the <span class="packt_screen">Credentials</span> configuration section:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/100e2472-a764-487b-a90d-ac5446030365.png" style=""/></div>
<ol start="3">
<li>Click on the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">Role Services</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e8a6419c-f4d6-4c9d-94c9-fdbaeeada507.png" style=""/></div>
<ol start="4">
<li>Check the <span class="packt_screen">Certification Authority</span> box (<strong>2</strong>), and then click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="5">
<li>You will now see the <span class="packt_screen">Setup Type</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3aff0e51-1213-42be-8a97-0d3adb5417b2.png" style=""/></div>
<ol start="6">
<li>Click on the radio button to select the <span class="packt_screen">Enterprise CA</span> option (<strong>3</strong>), and then click on the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">CA Type</span> configuration screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/33ddf5a9-b9d1-4c7f-a473-373b9737e750.png" style=""/></div>
<ol start="7">
<li>Next, click on the radio button to select the <span class="packt_screen">Root CA</span> option (<strong>4</strong>), and then click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="8">
<li>You will now see the <span class="packt_screen">Private Key</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8f27f9e1-b2d7-463f-b5b0-2269950e042d.png" style=""/></div>
<ol start="9">
<li>Click on the radio button to select the <span class="packt_screen">Create a new private key</span> option (<strong>5</strong>), and then click on the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">Cryptography for CA</span> configuration screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/abd08213-0167-43be-a711-3d8c0572c0b1.png" style=""/></div>
<ol start="10">
<li>Accept the default settings and click the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="11">
<li>You will now see the <span class="packt_screen">CA Name</span> configuration screen, where you can specify the name of the CA, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a6890240-3100-4ff1-87f7-533f6c6a0378.png" style=""/></div>
<ol start="12">
<li>Accept the default settings and click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="13">
<li>You will now see the <span class="packt_screen">Validity Period</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/71556989-b263-450a-aadf-8b98d0ea86fe.png" style=""/></div>
<ol start="14">
<li>Accept the default settings and click on the <span class="packt_screen">Next &gt;</span> button to continue.</li>
</ol>
<ol start="15">
<li>You will now see the <span class="packt_screen">CA Database</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d4c8d40d-dd60-413c-9030-93105d75e04e.png" style=""/></div>
<ol start="16">
<li>Accept the default settings and click on the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">Confirmation</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/dec50905-4ba3-4904-b95c-f7fbee170783.png" style=""/></div>
<ol start="17">
<li>Click on the <span class="packt_screen">Configure</span> button at the bottom of the screen to complete the configuration. Once the configuration has successfully completed, you will see the following message pop up:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/fccc4f60-d819-44f8-b399-51b75859ae4f.png" style=""/></div>
<ol start="18">
<li>Click on the <span class="packt_screen">Close</span> button to close the Server Manager.</li>
</ol>
<p>Now that we have our certificate server set up and running, we can start configuring the Horizon View software infrastructure components and clients to use it.</p>
<p>We will start by installing the certificate on the Horizon View Connection Server first.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing an SSL certificate on the View Connection Server</h1>
                </header>
            
            <article>
                
<p>With the certificate server installed and configured, we are now going to install the newly created certificate on the View Connection Server:</p>
<ol>
<li>Open a remote console session to the View Connection Server named <strong>HZN7-CS1</strong>, and then open a <span class="packt_screen">Run</span> command box. In the <span class="packt_screen">Run</span> box, type <kbd>mmc</kbd>, and then click on <span class="packt_screen">OK</span> to launch the <strong>Microsoft Management Console</strong> (<strong>MMC</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e4396ff0-10b3-4773-b849-c805a50bdc5c.png" style=""/></div>
<ol start="2">
<li>You will now see the MMC console screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/86cfc8f9-b21b-4d6a-acde-85afdf4a9d05.png" style=""/></div>
<ol start="3">
<li>On the MMC console screen, click on <span class="packt_screen">File</span> (<strong>1</strong>), and then click on the option for <span class="packt_screen">Add/Remove Snap-in…</span> (<strong>2</strong>).</li>
<li>You will now see the <span class="packt_screen">Add or Remove Snap-ins</span> screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b0923fe7-1c32-4eee-a77b-aa88ccd9d4b8.png"/></div>
<ol start="5">
<li>From the <span class="packt_screen">Available snap-ins</span> section on the left, click to highlight the <span class="packt_screen">Certificates</span> entry (<strong>3</strong>), and then click, the <span class="packt_screen">Add &gt;</span> button (<strong>4</strong>), as shown in the previous screenshot.</li>
</ol>
<ol start="6">
<li>You will now see the <span class="packt_screen">Certificates snap-in</span> box appear, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0fc615c9-bb30-4f41-9cd9-0f91a65e1e44.png"/></div>
<ol start="7">
<li>Click on the radio button for <span class="packt_screen">Computer account</span> (<strong>5</strong>), and then click the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">Select Computer</span> configuration box:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/41e387a5-f645-49f8-a5f0-a916a1931733.png"/></div>
<ol start="8">
<li>Click on the radio button for <span class="packt_screen">Local computer</span> (6), and then click on the <span class="packt_screen">Finish</span> button. You will return to the <span class="packt_screen">Add or Remove Snap-ins</span> screen, which now shows the certificates snap-in as being selected.</li>
<li>Click on <span class="packt_screen">OK</span> to close the <span class="packt_screen">Add or Remove Snap-ins</span> screen.</li>
</ol>
<p class="mce-root"/>
<p>You have now successfully added <span class="packt_screen">Certificates</span> to the management console as an option for configuration, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1a3de15f-d203-4ceb-90e6-e1f66b8a97aa.png" style=""/></div>
<p>Now you have the certificates available to manage and configure from the management console, the next task is to request a certificate from the root CA:</p>
<ol>
<li>From the <kbd>Console Root</kbd>, expand the <kbd>Certificates (Local Computer)</kbd> folder, and then right-click on the <kbd>Personal</kbd> folder (<strong>1</strong>). From the contextual menu, navigate to <span class="packt_screen">All Tasks</span> (2) and then select <span class="packt_screen">Request New Certificate...</span> (<strong>3</strong>):</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b1492f38-7064-4e77-9c0e-40e4576166c8.png"/></div>
<ol start="2">
<li>You will now see the <span class="packt_screen">Before You Begin</span> section on <span class="packt_screen">Certificate Enrollment</span> screen. Click on the <span class="packt_screen">Next</span> button to continue.</li>
</ol>
<ol start="3">
<li>Now the <span class="packt_screen">Select Certificate Enrollment Policy</span> screen is displayed, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9a6a1aab-0404-4751-b142-68e92eaf5f02.png"/></div>
<ol start="4">
<li>Click on the <span class="packt_screen">Next</span> button to continue. You will now see the <span class="packt_screen">Certificate Enrollment Request Certificates</span> screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c8d5c7b9-8b81-4d36-96dc-fb8eeeccf407.png"/></div>
<ol start="5">
<li>In the <span class="packt_screen">Active Directory Enrollment Policy</span> box, check the box for <span class="packt_screen">Computer</span> (<strong>4</strong>). We will use this policy template for our certificate; however, you can create your own template on the root CA server.</li>
<li>Now click on the arrow next to <span class="packt_screen">Details</span> (<strong>5</strong>), and then click on the <span class="packt_screen">Properties</span> box (<strong>6</strong>) so that we can configure the properties of the certificate. You will now see the <span class="packt_screen">Certificate Properties</span> <span>configuration box, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c1ce95e0-92b2-4161-a793-84ab6fc41741.png"/></div>
<ol start="7">
<li>Click on the <span class="packt_screen">General</span> tab (<strong>7</strong>), and then in the <span class="packt_screen">Friendly name:</span> box (<strong>8</strong>), type in a friendly name for this certificate. In the example lab, we will call this <kbd>vdm</kbd>. Optionally, you can enter a <span class="packt_screen">Description</span> as well.</li>
</ol>
<ol start="8">
<li>Next, from the <span class="packt_screen">Certificate Properties</span> box again, click on the <span class="packt_screen">Private Key</span> tab, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7818e064-036e-4951-9dd3-506e730856d9.png" style=""/></div>
<ol start="9">
<li>Click on the down arrow for <span class="packt_screen">Key options</span> (<strong>10</strong>) to expand the configuration options, and check the box for <span class="packt_screen">Make private key exportable</span> (<strong>11</strong>).</li>
</ol>
<ol start="10">
<li>Finally, click on the <strong><span class="packt_screen">Certification Authority</span></strong> tab (<strong>12</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8696f61c-bf02-4ebd-953d-3c4886215911.png" style=""/></div>
<ol start="11">
<li>Check the box to select the <span class="packt_screen">pvolab-HZN7-CERTS-CA</span> (<strong>13</strong>) <span>enrollment server</span>. Now click on the <span class="packt_screen">OK</span> button. You will return to the <span class="packt_screen">Request Certificates</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/66c5d495-4c8c-4639-8622-c7a7d3da38f1.png" style=""/></div>
<ol start="12">
<li>Click <span>on </span>the <span class="packt_screen">Enroll</span> button (<strong>14</strong>) to continue and enroll the Connection Server. If the enrollment is successful, then you will see the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/981f9d4d-44fa-4ba9-860f-612edc1207ce.png" style=""/></div>
<ol start="13">
<li>Click the <span class="packt_screen">Finish</span> button to complete the certificate enrollment process.</li>
</ol>
<p>Don't forget that you need to complete the certificate enrollment process on all of the Horizon View components, so if you have additional servers such as Replica Servers and View Composer Servers then these will all need a certificate to be installed on each and every one of them.</p>
<p>In the next section, we will take a look at what to do now that we have our root CA certificate server and the certificate is installed on our Connection Servers.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Post-certificate enrollment configuration tasks</h1>
                </header>
            
            <article>
                
<p class="NormalPACKT"><span>Even though you have installed a certificate server and installed a valid certificate on the Connection Server, there are still a few things to configure.</span></p>
<p class="NormalPACKT"><span>If you were to try and connect to the View Administrator using your browser, you will still see an error message saying there is a problem with the website's security certificate. A typical message would look something like the following:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b92e1c76-46c8-40c5-891f-ff74777b20ed.png" style=""/></div>
<p>If you remember from the beginning of this chapter, we also discussed accessing web pages using <kbd>http://</kbd> or <kbd>https://</kbd> for secure web pages. If the address bar in your browser is red, as shown in the following screenshot, then the connection is not secure and there are no certificates installed:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0a1330cc-1bd6-454e-8b05-9cf5fccb2208.png" style=""/></div>
<p>You can of course ignore these errors and just click <span class="packt_screen">Continue to this website (not recommended)</span>, which allows you to continue past the warning and log on to View Administrator.</p>
<p>However, when you log on, you will see that, in the <span class="packt_screen">System Health</span> section of the View Administrator dashboard, there is also a red warning box. As far as View is concerned, if you don't have a valid certificate installed, the health warning tells you that the connections will be untrusted and therefore that's a bad thing! An example of this is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/931bcbfb-0549-48aa-8454-601e146aeab9.png" style=""/></div>
<p>If you click on the Horizon 7 Administrator dashboard, and under <span class="packt_screen">System Health</span> on the <span class="packt_screen">Dashboard</span> view, select one of the Connection Servers displaying a red warning box. You can see in the server details box that opens that there is a yellow warning sign telling you that there is an untrusted certificate on this particular server. In the example lab environment, we are going to continue using the Horizon View Manager rather than the newer Horizon Console web-based management console. The reason is that at the time of writing, not all of the features we are going to cover can be accessed using the Horizon console.</p>
<p>It's the same thing from the end user perspective. If they try to log on via the Horizon Client, they will see the following:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3f68f114-f74a-4469-b1c9-250c293bf26b.png" style=""/></div>
<p>You can see in the <span class="packt_screen">Server:</span> box highlighted in the preceding screenshot, that the <kbd>https://</kbd> address of the Connection Server is colored red, has been crossed out, and a warning symbol is displayed on the padlock, all indicating that there is no trusted certificate installed.</p>
<p>Now that we have created and installed a certificate on the Connection Server, in order for Horizon View to pick up the installed certificate, you need to restart the View Connection Server service in Windows services. To do this, follow these steps:</p>
<ol>
<li>Open a <span class="packt_screen">Run</span> dialog box, and in the <span class="packt_screen">Run</span> dialog box, type <kbd>services.msc</kbd> to open the <span class="packt_screen">Services (Local)</span> screen. Scroll down to the entry for <span class="packt_screen">VMware Horizon View Connection Server</span> (<strong>1</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2acd9410-c387-40ac-84ec-4c6e61374b6c.png" style=""/></div>
<ol start="2">
<li>Select the option for <span class="packt_screen">VMware Horizon View Connection Server</span>, r<span>ight-click,</span> and then from the contextual menu, click on <span class="packt_screen">Restart</span> (<strong>2</strong>). Once the VMware Horizon View Connection Server service has restarted, you can log in to the View Administrator again, and check the certificate has been applied.</li>
</ol>
<ol start="3">
<li>To do this, once you have logged in, from the <span class="packt_screen">Dashboard</span>, and under <span class="packt_screen">System Health</span>, click on <span class="packt_screen">Connection Servers</span> to expand this section, and then click on the Connection Server <span class="packt_screen">HZN7-CS1</span> (<strong>3</strong>), or the server onto which you have just installed the certificate. In the <span class="packt_screen">Connection Server Details</span> box that pops up, you will now see that the SSL certificate is shown as <span class="packt_screen">Valid</span> (<strong>4</strong>) and that the error boxes have now changed from red to green:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/787d87ad-06cb-4c2b-ab26-bad235e2916b.png" style=""/></div>
<ol start="4">
<li>Finally, click on <span class="packt_screen">OK</span> to close the dialog box for the <span class="packt_screen">Connection Server Details</span> and then log out of the View Administrator.</li>
</ol>
<p>You have now successfully created and installed a certificate for Horizon View. Don't forget that you need to install a certificate on all of the Horizon View components, such as any Replica Servers or View Composer servers.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Horizon View True SSO</h1>
                </header>
            
            <article>
                
<p>In <a href="5d942e5b-dda5-4e5a-8278-62a64210aeef.xhtml" target="_blank">Chapter 2</a>, <em>Understanding Horizon 7 Architecture and Components</em>, we introduced you to the True SSO feature and its architecture. In this section, we are going to look at how to configure True SSO.</p>
<p>To set up True SSO, you first need to configure a CA, which we have already configured earlier on in this chapter in the <em>Installing a root CA</em> section. There are then a number of configuration steps to complete in preparation for installing True SSO.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Preparing AD for True SSO</h1>
                </header>
            
            <article>
                
<p>The first step is to create an <strong>Active Directory</strong> (<strong>AD</strong>) group for the Enrollment Server. To do this, follow these steps:</p>
<ol>
<li>Open a console to your Domain Controller. In the example lab, this is the machine called <kbd>dc.pvolab.com</kbd>. Launch the <span class="packt_screen">Active Directory Users and Computers</span> configuration screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c5a182cf-6fe5-462e-8561-904894c7975a.png"/></div>
<ol start="2">
<li>Click on and select <kbd>Users</kbd> (<strong>1</strong>), and then right-click. From the contextual menu, click on <span class="packt_screen">New</span> (<strong>2</strong>), and then from the expanded options, select <span class="packt_screen">Group</span> (<strong>3</strong>). Y<span>ou will now see the</span> <span class="packt_screen">New Object – Group</span> <span>dialog box, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5ffe91a1-e4f8-43ad-8b0c-76a249018380.png" style=""/></div>
<ol start="3">
<li>In the <span class="packt_screen">Group name</span> box (<strong>4</strong>), type in a name for the new group. In the example lab, this is called <kbd>Enrollment Servers</kbd>. In the <span class="packt_screen">Group scope</span> box, click on the radio button for <span class="packt_screen">Universal</span> (<strong>5</strong>), and in the <span class="packt_screen">Group type</span> box, click on the radio button for <span class="packt_screen">Security</span> (<strong>6</strong>). Once configured, click on the <span class="packt_screen">OK</span> button. Next, you need to add the Enrollment Server into this newly created group.</li>
</ol>
<ol start="4">
<li>In the <span class="packt_screen">Active Directory Users and Computers</span> configuration screen, click on <kbd>Computers</kbd> (<strong>7</strong>), and then double-click on the Enrollment Server. In the example lab, this is the computer called <span class="packt_screen">HZN7-ENROL</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aac056d1-95fa-4362-b3b9-4799dfa8506c.png"/></div>
<ol start="5">
<li>You will now see the <span class="packt_screen">HZN7-ENROL Properties</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/201b0c21-0e30-4080-bb73-82abd1432120.png" style=""/></div>
<ol start="6">
<li>Click on the <span class="packt_screen">Member Of</span> tab (<strong>9</strong>), and then click on the <span class="packt_screen">Add…</span> button (<strong>10</strong>). You will now see the <span class="packt_screen">Select Groups</span> dialog box:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/22c1dffa-781d-4f1d-a72b-236ba6e65796.png" style=""/></div>
<ol start="7">
<li>In the <span class="packt_screen">Enter the object names to select</span> box (<strong>11</strong>), type in the name of the group you created for the <kbd>Enrollment Servers</kbd>. You can just type the first part of the name and then click the <span class="packt_screen">Check Names</span> button (<strong>12</strong>). This will find any names that match the first part of what you type in. In this example, it will find the <span class="packt_screen">Enrollment Servers</span> group. With the correct group name selected, click on the <span class="packt_screen">OK</span> button to continue.</li>
<li>You will return to the <span class="packt_screen">HZN7-ENROL Properties</span> dialog box, which now shows that the Enrollment Server called <span class="packt_screen">HZN7-ENROL</span> is a member of the <span class="packt_screen">Enrollment Servers</span> group. This is shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7d5a4ab4-811e-4743-9fb3-31716746a161.png" style=""/></div>
<p class="NormalPACKT"><span>With the Domain Controller elements now configured, the next step is to create a new certificate template.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a certificate template for TrueSSO</h1>
                </header>
            
            <article>
                
<p>The next step is to create a certificate template. To do this, we are going to work through the following steps:</p>
<ol>
<li>Open a console to the certificate server and launch the <span class="packt_screen">Certificate Management Console</span>. In the example lab, this is the server called <span class="packt_screen">HZN7-CERTS</span>. This is shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/08b65d1d-3ded-4222-ac21-eb3eedb507c2.png"/></div>
<ol start="2">
<li>Click on the <kbd>Certificate Templates</kbd> folder (<strong>1</strong>), and then right-click. From the contextual menu now displayed, click on <span class="packt_screen">Manage</span> (<strong>2</strong>). You will now see the <span class="packt_screen">Certificate Templates Console</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9bec6377-b996-4ea2-a82d-2772da8644aa.png"/></div>
<ol start="3">
<li>Scroll down the <span class="packt_screen">Template Display Name</span> pane until you find the template for <span class="packt_screen">Smartcard Logon</span> (<strong>3</strong>), and click to highlight it. Now right-click, and then from the contextual menu now displayed, click on <span class="packt_screen">Duplicate Template</span>. You will now see the <span class="packt_screen">Properties of New Template</span> configuration box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/dd40959e-cead-47bd-a3d2-6a2daf1f2b44.png" style=""/></div>
<ol start="4">
<li>Click on the <span class="packt_screen">Compatibility</span> tab (<strong>5</strong>). In the <span class="packt_screen">Compatibility Settings</span> section, from the drop-down menu for <span class="packt_screen">Certification Authority</span> (<strong>6</strong>), select the appropriate setting for the server version that is running as the CA. In the example lab, the CA server is running Windows Server 2012 R2.</li>
<li>Next, from the drop-down menu for <span class="packt_screen">Certificate recipient</span> (<strong>7</strong>), select the appropriate setting for the machines that will be in receipt of this certificate. In the example lab, we will set this to <span class="packt_screen">Windows 7 / Server 2008 R2</span>.</li>
</ol>
<div class="packt_infobox">When changing these settings, you will see a dialog box appear warning you about compatibility changes, and changes to the template that you are about to make. Click <span class="packt_screen">OK</span> to accept these messages and to continue.</div>
<ol start="6">
<li>Now click on the <span class="packt_screen">General</span> tab (<strong>8</strong>) box as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4011529f-b73d-4620-bf80-43443fdea4bf.png"/></div>
<ol start="7">
<li>In the <span class="packt_screen">Template display name</span> box (<strong>9</strong>), type in a name for the new certificate template. In the example lab, this is called <kbd>Horizon TrueSSO</kbd>.</li>
<li>Next, you need to configure a validity time. From the drop-down menu under <span class="packt_screen">Validity period</span> (<strong>10</strong>), select the option for <span class="packt_screen">hours</span>. You will then see the <span class="packt_screen">Certificate Templates</span> warning box (<strong>11</strong>).</li>
<li>Click on <span class="packt_screen">OK</span> to accept. Accepting the warning will automatically set the <span class="packt_screen">Renewal period</span> to <kbd>0</kbd> <span class="packt_screen">hours</span> (<strong>12</strong>).</li>
</ol>
<ol start="10">
<li>Now click on the <span class="packt_screen">Request Handling</span> tab (<strong>13</strong>) box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6ea04ebe-5216-46fd-a36d-9d789aeaac5a.png"/></div>
<ol start="11">
<li>In the drop-down box next to <span class="packt_screen">Purpose</span> (<strong>14</strong>), select the option for <strong>S</strong><span class="packt_screen">ignature and smartcard logon</span>. You will then see the <span class="packt_screen">Certificate Templates</span> warning box (<strong>15</strong>), which warns you that you are about to change the purpose of the certificate. Click <span class="packt_screen">Yes</span> to accept the warning message and close the dialog box.</li>
<li>Finally, on this screen, check the box for <span class="packt_screen">Allow private key to be exported</span> (<strong>16</strong>), and check the box for <span class="packt_screen">For automatic renewal of smartcard certificates</span> (<strong>17</strong>).</li>
</ol>
<ol start="13">
<li>Next, click the <span class="packt_screen">Cryptography</span> tab (<strong>18</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a23428f7-8dd3-4e25-a372-b91b29ca3405.png" style=""/></div>
<ol start="14">
<li>In the <span class="packt_screen">Provider Category</span> box, click on the drop-down arrow (<strong>19</strong>) and select the option for <span class="packt_screen">Key Storage Provider</span>. Then, click on the radio button for <span class="packt_screen">Requests can use any provider available on the subject's computer</span> (<strong>20</strong>), and then in the <span class="packt_screen">Request hash</span> box, click on the drop-down arrow (<strong>21</strong>) and select the option for <span class="packt_screen">SHA256</span>.</li>
</ol>
<ol start="15">
<li>The next tab to configure is the <span class="packt_screen">Subject Name</span> tab (<strong>22</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1c140d73-e168-4de9-b17c-d552fac48231.png" style=""/></div>
<ol start="16">
<li>Click on the radio button for <span class="packt_screen">Build from this Active Directory information</span> (<strong>23</strong>), and then check the box for <span class="packt_screen">User principal name (UPN)</span> (<strong>24</strong>).</li>
<li>The next tab to configure is the <span class="packt_screen">Server</span> tab (<strong>25</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b9ece1bd-cb86-4e55-a250-0d27a7f187f2.png" style=""/></div>
<ol start="18">
<li>Check the <span class="packt_screen">Do not store certificates and requests in the CA database</span> box (<strong>26</strong>). Now click on the <span class="packt_screen">Issuance Requirements</span> tab (<strong>27</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/09491c1d-faed-4165-86b0-7b10c0a80240.png" style=""/></div>
<ol start="19">
<li>Check the box for <span class="packt_screen">This number of authorized signatures</span> (<strong>28</strong>), and ensure the value for this option is set to <kbd>1</kbd>.</li>
</ol>
<ol start="20">
<li>From the <span class="packt_screen">Application policy</span> box, click on the drop-down arrow (<strong>29</strong>) and select the option for <span class="packt_screen">Certificate Request Agent</span>. Finally, on this tab, click on the radio button for <span class="packt_screen">Valid existing certificate</span> (<strong>30</strong>).</li>
<li>For the final part of the <span class="packt_screen">Properties of New Template</span> configuration, click on the <span class="packt_screen">Security</span> tab (<strong>31</strong>) as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0c03f06c-71d0-4795-8211-175c716b3652.png"/></div>
<ol start="22">
<li>Click to select the <span class="packt_screen">Enrollment Servers</span> group (<strong>32</strong>), and then click on the <span class="packt_screen">Add…</span> button (<strong>33</strong>).</li>
</ol>
<ol start="23">
<li>You will now see the <span class="packt_screen">Select Users, Computers, Service Accounts or Groups</span> dialog box pop up. In the <span class="packt_screen">Enter the object names to select</span> box (<strong>34</strong>), type in the name of the <kbd>Enrollment Servers</kbd> group. You can just type the first few letters of the group name and then click on the <span class="packt_screen">Check Names</span> button (<strong>35</strong>) to find any matches. You will now see the <span class="packt_screen">Enrollment Servers</span> group (<strong>34</strong>).</li>
<li>Finally, in the <span class="packt_screen">Permissions for Enrollment Servers</span> section, check the box under the <span class="packt_screen">Allow</span> heading for <span class="packt_screen">Read</span> (<strong>36</strong>) and <span class="packt_screen">Enroll</span> (<strong>37</strong>).</li>
<li>This step is now complete so click on the <span class="packt_screen">OK</span> button to finish the configuration and close the dialog box.</li>
</ol>
<p class="NormalPACKT"><span>In the next section, we are going to issue the newly created certificate template.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Issuing the TrueSSO certificate template</h1>
                </header>
            
            <article>
                
<p>Now that the certificate template has been created, the next task is to issue it. To do this, follow the steps as described:</p>
<ol>
<li>From the <span class="packt_screen">Certificate Management Console</span> screen, click on the <kbd>Certificate Templates</kbd> folder (<strong>1</strong>), right-click, and then from the contextual menu that is displayed click on <span class="packt_screen">New</span> (<strong>2</strong>), and then select the option for <span class="packt_screen">Certificate Template to Issue</span> (<strong>3</strong>). This is shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1c2f5101-dd87-4dd0-b300-3ae417ce16de.png"/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="2">
<li>You will now see the <span class="packt_screen">Enable Certificate Templates</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1af47c08-80eb-4108-b2dd-2bb506dd4435.png"/></div>
<ol start="3">
<li>Click on <strong><span class="packt_screen">Horizon True SSO</span></strong> (<strong>4</strong>), and then click on the <span class="packt_screen">OK</span> button.</li>
<li>You will now go back to the <span class="packt_screen">Enable Certificate Templates</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7953326e-1130-45fa-876e-146fa9d43f0a.png"/></div>
<ol start="5">
<li>Next, we need to enable the Enrollment Agent. As in the previous step, from the <span class="packt_screen">Certificate Management Console</span> screen, click on the <kbd>Certificate Templates</kbd> folder (<strong>5</strong>), right-click, and then from the contextual menu that is displayed, click on <span class="packt_screen">New</span> (<strong>6</strong>), and then select the option for <span class="packt_screen">Certificate Template to Issue</span> (<strong>7</strong>). You will now see the <span class="packt_screen">Enable Certificate Templates</span> <span>dialog box, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0704c05e-504d-4fb8-94f3-be1cf3ef31f4.png"/></div>
<ol start="6">
<li>C<span>lick on and select the option for</span> <span class="packt_screen">Enrollment Agent (Computer)</span> <span>(<strong>8</strong>).</span> <span>Now click on the</span> <span class="packt_screen">OK</span> <span>button.</span> <span>You will return to the</span> <span class="packt_screen">Enable Certificate Templates</span> <span>dialog box. You can now exit the</span> <span class="packt_screen">Certificate Management Console</span><span>.</span></li>
</ol>
<div class="packt_infobox">You need to check that the <span class="packt_screen">Enrollment Agent (Computer)</span> template has the same security settings as the template for <kbd>TrueSSO</kbd> template was configured with. This means it has been added to the Enrollment Servers Security group and has been granted read and enroll permissions.</div>
<p>The final few configuration tasks are command-line-based, so from the desktop of the certificate server, launch a <span class="packt_screen">Run</span> dialog box. In the <span class="packt_screen">Run</span> dialog box, type <kbd>cmd</kbd> to open a Command Prompt box.</p>
<p>The first thing you need to do is to configure the <span>CA</span> for non-persistent certificate processing. To do this, at Command Prompt, type the following command:</p>
<pre><strong>certutil –setreg DBFlags +DBFLAGS_ENABLEVOLATILEREQUESTS</strong></pre>
<p>The output from running this command is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1f88729a-c579-4ded-93ee-e832ab3ef54e.png" style=""/></div>
<p>The second thing you need to do it to configure the <span>CA</span> to ignore offline <strong>Certificate Revocation Lists</strong> (<strong><span>CRL</span></strong>) errors. To do this, at Command Prompt, type the following command:</p>
<pre><strong>certutil –setreg ca\CRLFlags +CRLF_REVCHECK_IGNORE_OFFLINE</strong></pre>
<p>The following screenshot shows the command successfully executing:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c68321ee-5231-4b07-a01b-29e9a6211372.png" style=""/></div>
<p>Finally, as it states in Command Prompt, you need to restart the certificate service. To do this at Command Prompt, run the following two commands, one after the other:</p>
<pre><strong>net stop certsvc</strong><br/><strong>net start certsvc</strong></pre>
<p>You should see something similar to the following screenshot, which shows that the certification service was successfully stopped and then started again:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/fa2b125a-ea30-45a1-bb3b-9539499a684f.png"/></div>
<p class="NormalPACKT"><span>The next step in the process is to deploy the certificates on the Enrollment Server and the Connection Server.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Certificate deployment</h1>
                </header>
            
            <article>
                
<p class="NormalPACKT"><span>The next task to perform is to deploy the <span class="KeyWordPACKT"><strong>Enrollment Agent (Computer)</strong> certificate</span> on to the Enrollment Server.</span></p>
<p class="NormalPACKT"><span>By deploying the Enrollment Agent (Computer) certificate onto this server, you are authorizing this Enrollment Server to act as an Enrollment Agent and generate to be able to generate certificates on behalf of the end users.</span></p>
<p class="NormalPACKT"><span>If you are following the example lab, then in</span> <a href="a85150f1-1f32-4c91-87f0-1e8c700b9b96.xhtml" target="_blank">Chapter 4</a><span class="ChapterrefPACKT"><span>,</span></span> <em>Installing and Configuring Horizon 7 - Part 1</em><span>, you will already have an Enrollment Server called <strong>HZN7-ENROL</strong>, onto which we will deploy the certificate. The first thing to do is to open a remote console to this server:</span></p>
<ol>
<li>Launch a <span class="packt_screen">Run</span> command box and type <kbd>mmc</kbd> into the <span class="packt_screen">Open</span> box (<strong>1</strong>) to launch the <span class="packt_screen">Microsoft Management Console</span>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/567be70e-8201-4d85-aaf6-18c5202b5398.png"/></div>
<ol start="2">
<li>On the MMC console screen, click on <span class="packt_screen">File</span> (<strong>2</strong>) and then <span class="packt_screen">Add/Remove Snap-in…</span> (<strong>3</strong>).</li>
</ol>
<ol start="3">
<li>You will now see the <span class="packt_screen">Add or Remove Snap-ins</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e137c61c-4409-46d4-af86-772a0f5504de.png"/></div>
<ol start="4">
<li>From the <span class="packt_screen">Available snap-ins</span> section on the left, click to highlight and select the <span class="packt_screen">Certificates</span> entry (<strong>4</strong>), and then click on the <span class="packt_screen">Add &gt;</span> button (<strong>5</strong>). You will now see the <span class="packt_screen">Certificates snap-in</span> <span>box appear, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a402e774-84bb-402e-863f-1192df399f0d.png"/></div>
<ol start="5">
<li>Click on the radio button for the <span class="packt_screen">Computer account</span> (<strong>6</strong>), and then click on the <span class="packt_screen">Next &gt;</span> button to continue. You will now see the <span class="packt_screen">Select Computer</span> configuration box:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/57b642ca-e24f-4a69-ac87-b599b7dd4534.png"/></div>
<ol start="6">
<li>Click on the radio button for Local computer (<strong>7</strong>), and then click on the <span class="packt_screen">Finish</span> button. You will now return to the <span class="packt_screen">Add or Remove Snap-ins</span> screen, which now shows the certificates snap-in as being selected.</li>
<li>Click on <span class="packt_screen">OK</span> to close the <span class="packt_screen">Add or Remove Snap-ins</span> screen.</li>
</ol>
<p class="NormalPACKT"><span>Now you have the certificates option available in the management console, as shown in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b1a2d5a2-555f-4dd3-a8cc-289a3216defb.png"/></div>
<p>The next task is to request the Enrollment Agent (Computer) certificate:</p>
<ol>
<li>From the <span class="packt_screen">Console Root</span>, expand the <kbd>Certificates (Local Computer)</kbd> folder, and then select and right-click on the <kbd>Personal</kbd> folder (<strong>1</strong>). From the contextual menu, navigate to <span class="packt_screen">All Tasks</span> (<strong>2</strong>) and then select <span class="packt_screen">Request New Certificate...</span> (<strong>3</strong>), as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a8e5d327-3632-4fc3-b56c-2f2ac64887e6.png"/></div>
<ol start="2">
<li>You will now see the <span class="packt_screen">Before You Begin</span> section on Certificate Enrollment screen. Click on the <span class="packt_screen">Next</span> button to continue.</li>
</ol>
<ol start="3">
<li>Next, you will see the <span class="packt_screen">Select Certificate Enrollment Policy</span> screen. Click on the <span class="packt_screen">Next</span> button to continue. The next screen you will see is the <strong>C</strong><span class="packt_screen">ertificate Enrollment Request Certificates</span> screen, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/53f98673-bb9e-40b3-8893-3273781fed3b.png" style=""/></div>
<ol start="4">
<li>Check the box to select the <span class="packt_screen">Enrollment Agent (Computer)</span> option <span>(<strong>4</strong>),</span> and then click on the <span class="packt_screen">Enroll</span> button to request the certificate. You should then see that the certificate has successfully been enrolled:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ec26afb1-473b-41d0-a9f9-d67f85ee31ed.png" style=""/></div>
<ol start="5">
<li>Finally, click on the <span class="packt_screen">Finish</span> button to complete the configuration, close the <span class="packt_screen">Certificate Enrollment</span> dialog box, and then close the <span class="packt_screen">Certificate Management</span> console.</li>
</ol>
<p class="NormalPACKT"><span>The next task is to import the <span class="KeyWordPACKT">Enrollment Service Client Certificate</span>, which you need to first export from the Connection Server before importing it onto the Enrollment Server.</span></p>
<p class="NormalPACKT"><span>Deploying the Enrollment Service Client Certificate from the Connection Server pairs the Connection Server with the Enrollment Server. If you don't do this, then any connection request that is made to the Enrollment Server will be rejected and the result is that no certificate will be generated. The Enrollment Service Client Certificate is automatically generated on the Connection Server when the Connection Server service starts up.</span></p>
<p class="NormalPACKT"><span>Let's start by exporting the certificate from the Connection Server:</span></p>
<ol>
<li>Open a console to the Connection Server. In the example lab, this is the server called <strong>HZN7-CS1</strong>. Launch the MMC console and add the Certificates snap-in as we have covered in previous sections, and then launch the Certificates Management Console, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5660b24d-37c2-4001-a69a-f14f486adbd9.png"/></div>
<ol start="2">
<li>From the <span class="packt_screen">Console Root</span> section in the left-hand pane, navigate to the <kbd>VMware Horizon View Certificates</kbd> folder, expand it by clicking the arrow, and then click on the <kbd>Certificates</kbd> folder (<strong>1</strong>).</li>
</ol>
<ol start="3">
<li>Click on and select the certificate that contains the friendly name <kbd>vdm.ec</kbd> (<strong>2</strong>), right-click, and then from the contextual menu click on <span class="packt_screen">All Tasks</span> (<strong>3</strong>), and then select the option for <span class="packt_screen">Export…</span> (<strong>4</strong>). You will now see the <span class="packt_screen">Welcome to the Certificate Export Wizard</span> screen. Click on the <span class="packt_screen">Next</span> button to continue.</li>
<li>You will now see the <span class="packt_screen">Export Private Key</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7b17fc2d-b948-44dc-9c4c-3a92f889a175.png" style=""/></div>
<ol start="5">
<li>Click on the radio button for the <span class="packt_screen">No, do not export the private key</span> (<strong>5</strong>), and then click on the <span class="packt_screen">Next</span> button.</li>
<li>In the <span class="packt_screen">Export File Format</span> dialog box, accept the default selected format option and then click on the <span class="packt_screen">Next</span> button to continue.</li>
<li>You will now see the <span class="packt_screen">File to Export</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/26d69c9a-bcbc-4f4d-b363-07a5c736abd1.png" style=""/></div>
<ol start="8">
<li>In the <span class="packt_screen">File name</span> box (<strong>6</strong>), type in a filename for the certificate. In the example lab, this has been called <kbd>cs-cert</kbd> and for easy access has been saved in a shared folder called <kbd>cert</kbd> on the Domain Controller because it needs to be accessible from the Enrollment Server when we come to import it.</li>
<li>Click on the <span class="packt_screen">Next</span> button to continue.</li>
<li>You will now see the <span class="packt_screen">Completing the Certificate Export Wizard</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/08ba3df7-5ebd-4a04-b8a9-c51456833314.png" style=""/></div>
<ol start="11">
<li>Finally, click on the <span class="packt_screen">Finish</span> button to complete the certificate export process. You will see a message saying the export was successful.</li>
</ol>
<p class="NormalPACKT"><span>The next task is to import the certificate into the Enrollment Server:</span></p>
<ol>
<li class="NormalPACKT"><span>Open a remote console to the Enrollment Server. In the example lab, this is the server called <strong>HZN7-ENROL</strong>. Launch the MMC console and add the Certificates snap-in as we covered previously, and then launch the Certificates Management Console, as shown in the following screenshot:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0e529363-6833-43e1-9345-df99cea1f7bd.png"/></div>
<ol start="2">
<li>From the <span class="packt_screen">Console Root</span> section in the left-hand pane, navigate to the <kbd>VMware Horizon View Enrollment Server Trusted Roots</kbd> folder (<strong>1</strong>), click and select to highlight it and then right-click. From the contextual menu that is now displayed, click on <span class="packt_screen">All Tasks</span> (<strong>2</strong>), and select the option for <span class="packt_screen">Import…</span> (<strong>3</strong>).</li>
</ol>
<ol start="3">
<li>You will now see the <span class="packt_screen">Welcome to the Certificate Import Wizard</span> screen. Click on the <span class="packt_screen">Next</span> button to continue. You will now see the <span class="packt_screen">File to Import</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9055c446-de8d-4d22-97df-df1d815d9fe9.png" style=""/></div>
<ol start="4">
<li>Type in the filename for the certificate that you are going to import in the <span class="packt_screen">File name</span> box (<strong>4</strong>). In the example lab, this was the file called <kbd>cs-cert</kbd> that was saved to the shared folder on the domain controller. Click on the <span class="packt_screen">Next</span> button to continue.</li>
</ol>
<ol start="5">
<li>In the next screen, <span class="packt_screen">Certificate Store</span>, you need to select the store in which the certificate will be stored:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5c20a9c3-b981-4ed3-97e6-20696ea8b5ed.png" style=""/></div>
<ol start="6">
<li>In the <span class="packt_screen">Certificate Store</span> dialog box, click on the radio button for <span class="packt_screen">Place all certificates in the following store</span> (<strong>5</strong>), and then ensure that the <span class="packt_screen">Certificate store</span> is set to <kbd>VMware Horizon View Enrollment Server Trusted Roots</kbd>.</li>
<li>Click on the <span class="packt_screen">Next</span> button to continue.</li>
</ol>
<ol start="8">
<li>You will now see the <span class="packt_screen">Completing the Certificate Import Wizard</span> dialog box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c83ff4f6-fb9e-4747-8c66-034e9a927fdb.png" style=""/></div>
<ol start="9">
<li>Finally, click on the <span class="packt_screen">Finish</span> button to import the certificate. You should see a message stating that the import was successful.</li>
</ol>
<p class="NormalPACKT"><span>Once imported, you will see the certificate in the Certificate Management Console, as shown in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/fa580a7c-cab4-4bb1-81a8-f8a65e7ca1a0.png"/></div>
<p class="mce-root"/>
<p class="NormalPACKT"><span>Having successfully imported the certificate, you can now close the Certificate Management Console. In the next step, we are going to configure True SSO on the Connection Server.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring True SSO on the Connection Server</h1>
                </header>
            
            <article>
                
<p>Now that you have all of the necessary certificates in place, the next step is to set up the True SSO feature on the Connection Server.</p>
<p>This setup process is command-line-driven and uses the <kbd>vdmUtil</kbd> command, so the first step is to open a Command Prompt window on the Connection Server.</p>
<p>The first command you need to run adds the Enrollment Server to the Horizon View environment. This allows you to query the Enrollment Server and gather information about the domain and other useful information such as available templates and CA name:</p>
<ol>
<li>From the Connection Server, open a command-line dialog box and type in the following command:</li>
</ol>
<pre style="padding-left: 90px"><strong>vdmUtil --authAs administrator --authDomain PVOLAB --authPassword password --truesso --environment --add --enrollmentServer hzn7-enrol.pvolab.com</strong></pre>
<div class="packt_tip"><span>You will need this information during the configuration process, so make sure you make a note of it.</span></div>
<p style="padding-left: 60px"><span>You will see that the Enrollment Server has now been successfully added to the environment:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3ffefba9-414e-4c81-9259-c996cbb8a46d.png"/></div>
<p class="mce-root"/>
<p style="padding-left: 60px">The next command provides you with detailed information about the various Horizon components in your environment. This will help with the configuration of True SSO.</p>
<ol start="2">
<li>From the command line, type the following command:</li>
</ol>
<pre style="padding-left: 90px"><strong>vdmUtil --authAs administrator --authDomain PVOLAB --authPassword password --truesso --environment --list --enrollmentServer hzn7-enrol.pvolab.com --domain pvolab.com</strong></pre>
<p class="NormalPACKT" style="padding-left: 60px"><span>You will see the following output:</span></p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/fe28a04f-9cc5-4fb9-a0f8-bd431989aa5c.png"/></div>
<p style="padding-left: 60px">We can now use this information to create a True SSO connector. A True SSO Connector specifies the details of enrollment servers, CAs, and certificate templates to be used. When a Connection Server receives a request to launch a desktop for an end user, it will look up the True SSO Connector for the domain the user belongs to and uses the components that you configure to obtain the Certificate.</p>
<ol start="3">
<li>From the command line, type the following command:</li>
</ol>
<pre style="padding-left: 90px"><strong>vdmUtil --authAs administrator --authDomain PVOLAB --authPassword password --truesso --create --connector --domain pvolab.com --template HorizonTrueSSO --primaryEnrollmentServer hzn7-enrol.pvolab.com --certificateServer pvolab-hzn7-certs-ca --mode enabled</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p style="padding-left: 60px"><span>You will now see that the connector has been successfully created and enabled, as shown in the following screenshot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6b0626ac-4bec-4505-9641-3d3506ec828b.png"/></div>
<p>Next, we are going to check that True SSO is installed and is working by following these steps:</p>
<ol start="1">
<li>Log in to the Horizon View Administrator console.</li>
<li>From the <span class="packt_screen">Dashboard</span> screen, under the <span class="packt_screen">System Health</span> section, click on the arrow to expand the <span class="packt_screen">True SSO</span> section (<strong>21</strong>), and then click on the link for <kbd>pvolab.com</kbd> (<strong>22</strong>)</li>
<li>You will see the <span class="packt_screen">True SSO Domain Details</span> box, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4c2fe0e4-0ad8-4e23-9b0e-712fa1f9e9f8.png"/></div>
<ol start="4">
<li>Click on the <span class="packt_screen">OK</span> button to close the box and then log out of the View Administrator.</li>
</ol>
<p class="mce-root"/>
<p>You have now successfully configured the View elements for True SSO. The real benefit of the True SSO feature is when used in conjunction with vIDM, allowing a user to single sign-on to their virtual desktop machine or applications from the vIDM portal.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed some of the security aspects of deploying Horizon View. We started off by describing what an SSL certificate is and why Horizon View uses them, before going on to show this practically by installing and configuring a Root CA server and then configuring the View components in the example lab to use these certificates.</p>
<p>The second part of this chapter explored the True SSO feature of Horizon View. Again, we demonstrated this practically by configuring the certificates server to use this feature and then configuring the Horizon View Enrollment Server and Connection Server so that they "trusted" each other with the user login process.</p>
<p>In the next chapter, we are going to turn our attention to virtual desktops and start to build virtual desktop images.</p>


            </article>

            
        </section>
    </body></html>