- en: Chapter 5. Advanced Networking
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 5 章 高级网络
- en: 'In this chapter, we will cover:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖：
- en: Configuring a static IP address
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置静态 IP 地址
- en: Creating a firewall with `ufw`
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `ufw` 创建防火墙
- en: Remote access to a desktop session (`xrdp`)
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 远程访问桌面会话（`xrdp`）
- en: Remote access to the monitor (`x11vnc`)
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 远程访问监视器（`x11vnc`）
- en: Installing a web server (`apache`, `lighttpd`, `nginx`)
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装一个 web 服务器（`apache`，`lighttpd`，`nginx`）
- en: Installing a wiki (`mediawiki`)
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装一个 wiki（`mediawiki`）
- en: Creating a wireless access point with `hostapd`
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `hostapd` 创建无线接入点
- en: Installing a network trace utility
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装网络追踪工具
- en: Installing a network protocol analyzer
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装网络协议分析器
- en: Enabling the IPv6 network protocol
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启用 IPv6 网络协议
- en: Introduction
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: The advanced networking recipes in this chapter are not specific to the Raspberry
    Pi. However, they demonstrate some of the advanced capabilities of the Raspberry
    Pi.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的高级网络配方并不限于树莓派。然而，它们展示了树莓派的一些高级功能。
- en: The recipes in this chapter should generally work with any Linux computer. The
    installation instructions, however, are specific to Linux operating systems that
    are Debian based, like the Raspbian Linux distribution used in this book.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的配方通常适用于任何 Linux 计算机。然而，安装说明是针对基于 Debian 的 Linux 操作系统，例如本书中使用的 Raspbian Linux
    发行版。
- en: After completing the recipes in this chapter, you will have configured a static
    IP address for your Raspberry Pi; learned to protect your Raspberry Pi with a
    firewall; connected to the Raspberry Pi desktop remotely; installed a web server
    and a wiki; set up a wireless access point; and analyzed network packets.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本章配方后，您将为树莓派配置静态 IP 地址；学习如何用防火墙保护树莓派；远程连接到树莓派桌面；安装了 web 服务器和 wiki；设置了无线接入点；并分析了网络数据包。
- en: Configuring a static IP address
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置静态 IP 地址
- en: This recipe configures a Raspberry Pi so that it has a static IP address.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 此配方配置树莓派，使其具有静态 IP 地址。
- en: A static IP address, unlike the dynamic addresses provided by a **DHCP** (**Dynamic
    Host Configuration Protocol**) server, does not change. Network servers on a wired
    network connection (for example, web servers, wikis, and wireless access points)
    generally have static IP addresses to provide a consistent telephone-number-like
    reference for use by its network clients (for example, web browsers, mobile phones,
    and other Internet devices). Servers that have a static IP address are easier
    to find.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 静态 IP 地址与 **DHCP**（**动态主机配置协议**）服务器提供的动态地址不同，它不会变化。使用有线网络连接的网络服务器（例如，web 服务器、wiki
    和无线接入点）通常具有静态 IP 地址，以便为网络客户端（例如，web 浏览器、手机和其他互联网设备）提供一致的电话号般的参考。具有静态 IP 地址的服务器更容易被找到。
- en: After completing this recipe, you will be able to configure a static network
    IP address.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此配方后，您将能够配置静态网络 IP 地址。
- en: Getting ready
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 配料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 树莓派开机后的初始设置或基本网络设置。您也已以 `pi` 用户身份登录（请参阅 [第 1 章](ch01.html "第 1 章. 安装和设置")，*安装和设置*
    中的配方，了解如何启动和登录，并查阅 [第 2 章](ch02.html "第 2 章. 管理")，*管理* 中的配方，了解如何远程登录）。
- en: This recipe does not require the desktop GUI and could either be run from the
    text-based console or from within an `LXTerminal`.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 此配方不需要桌面 GUI，可以从文本控制台或 `LXTerminal` 中运行。
- en: If the Raspberry Pi's Secure Shell server is running, this recipe can be completed
    remotely using a Secure Shell client.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 如果树莓派的安全外壳（Secure Shell）服务器正在运行，可以使用安全外壳客户端远程完成此配方。
- en: How to do it...
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'The steps to configuring a static IP address are:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 配置静态 IP 地址的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录到树莓派。
- en: Use the `hostname –I` command to display the Raspberry Pi's current IP address.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `hostname –I` 命令显示树莓派的当前 IP 地址。
- en: '[PRE0]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Use the output of the `route` command filtered through the `awk` command to
    determine the IP address of the default network gateway.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `route` 命令的输出，通过 `awk` 命令过滤，来确定默认网络网关的 IP 地址。
- en: '[PRE1]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Use the `vi` command to edit the network interface configuration file (`/etc/network/interface)`.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `vi` 命令编辑网络接口配置文件（`/etc/network/interface`）。
- en: '[PRE2]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The `vi` editor displays the contents of the configuration file. Instructions
    for using the editor can be found in the `vi` manpages (see the recipe *Reading
    the built-in documentation* in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration*).
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器显示配置文件的内容。有关使用该编辑器的说明，请参阅 `vi` 的手册（请参见[第 2 章](ch02.html "第 2 章：管理")，*管理*中的食谱
    *阅读内置文档*）。'
- en: '[PRE3]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Change the word **manual** at the end of the line starting with `iface eth0`
    to `static`.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以 `iface eth0` 开头的行末尾的 **manual** 改为 `static`。
- en: '[PRE4]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Add the following lines after the line starting with `iface eth0` using the
    current IP address (`192.168.2.13`), the default network gateway (`192.168.2.1`),
    and network mask (`255.255.255.0`) from steps 2, 3 and 4:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在以 `iface eth0` 开头的行后添加以下几行，使用第 2、3 和 4 步中的当前 IP 地址（`192.168.2.13`）、默认网络网关（`192.168.2.1`）和网络掩码（`255.255.255.0`）：
- en: '[PRE5]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'After editing, the file should look something like this:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑后，文件应类似于以下内容：
- en: '[PRE6]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Save the file and exit the editor (`:wq`).
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Finally, reboot the Raspberry Pi to use the new static IP address!
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，重启树莓派以使用新的静态 IP 地址！
- en: '[PRE7]'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: How it works...
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: After logging in to the Raspberry Pi, this recipe first discovers the necessary
    network configuration parameters needed to configure a static IP address, then
    it uses those parameters to modify the network interface configuration file.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 登录树莓派后，本食谱首先发现配置静态 IP 地址所需的网络配置参数，然后使用这些参数修改网络接口配置文件。
- en: The `hostname -I` command is used to display the Raspberry Pi's current IP address
    (`192.168.2.13`).
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '`hostname -I` 命令用于显示树莓派当前的 IP 地址（`192.168.2.13`）。'
- en: The output of the `route` command, filtered by the `awk` command, displays the
    IP address of the default network gateway (**192.168.2.1**) and the network mask
    of the local network (**255.255.255.0**). The output of **route** is piped (**|**)
    through `awk` so that **awk** can extract information specific to this recipe
    and discard the rest.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 `awk` 命令过滤后的 `route` 命令输出显示了默认网络网关的 IP 地址（**192.168.2.1**）和本地网络的网络掩码（**255.255.255.0**）。`route`
    命令的输出通过管道（**|**）传递给 `awk`，以便 **awk** 提取与本食谱相关的信息并丢弃其他内容。
- en: Unfiltered, the `route` command displays more information than is needed for
    this recipe.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`route` 命令显示的信息比本食谱所需的更多。
- en: '[PRE8]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `awk` command **'/^0/ { print $2 }'** limits its output to those lines beginning
    with a `0` (**/^0/**) and for those limited lines prints the second field (**$2**).
    The result is the IP address of the default gateway (**192.168.2.1**).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '`awk` 命令 **''/^0/ { print $2 }''** 限制其输出为以 `0` 开头的行（**/^0/**），并为这些行打印第二个字段（**$2**）。结果是默认网关的
    IP 地址（**192.168.2.1**）。'
- en: And the `awk` command **'/^[1-9]/ { print $3 }'** limits the output that has
    been piped (**|**) into it to those lines beginning with a digit other than zero
    (**/^[1-9]/**) and for those lines prints the third field (**$3**). The result
    is the network mask (**255.255.255.0**) for the local network.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '`awk` 命令 **''/^[1-9]/ { print $3 }''** 限制已通过管道传输（**|**）的输出为以非零数字开头的行（**/^[1-9]/**），并为这些行打印第三个字段（**$3**）。结果是本地网络的网络掩码（**255.255.255.0**）。'
- en: More information about `awk` and the `awk` command language can be found in
    the `awk` manpages (see the recipe Reading the built-in documentation in [Chapter
    2](ch02.html "Chapter 2. Administration"), *Administration*).
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 `awk` 和 `awk` 命令语言的更多信息，可以在 `awk` 的手册中找到（请参见[第 2 章](ch02.html "第 2 章：管理")，*管理*中的食谱
    *阅读内置文档*）。
- en: After discovering the current IP address, the default gateway, and the network
    mask, the recipe modifies the network interface configuration file (`/etc/network/interfaces`)
    to include the discovered parameters.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在发现当前的 IP 地址、默认网关和网络掩码后，本食谱修改了网络接口配置文件（`/etc/network/interfaces`），以包括已发现的参数。
- en: The wired network interface (**iface eth0**) is set to **static** and the configuration
    parameters **address**, **gateway**, and **netmask** are added using the parameter
    values discovered earlier.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 有线网络接口（**iface eth0**）被设置为 **static**，并使用之前发现的参数值添加了配置参数 **address**、**gateway**
    和 **netmask**。
- en: After the configuration file is saved, the Raspberry Pi is rebooted with its
    new IP address.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件保存后，树莓派会重新启动并使用新的 IP 地址。
- en: There's more...
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: In most networks, both at home and at work, (DHCP) servers are used to dynamically
    assign IP addresses to client computers and devices. Because the DHCP servers
    are responsible for IP address assignment, they usually need additional configuration
    to reserve static IP addresses so that they are not accidentally assigned to another
    client device or computer.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数网络中，无论是家庭网络还是工作网络，都会使用（DHCP）服务器来动态分配IP地址给客户端计算机和设备。由于DHCP服务器负责IP地址分配，因此它们通常需要额外的配置来保留静态IP地址，以避免这些地址被意外分配给其他客户端设备或计算机。
- en: In order to configure the DHCP server, you will need the hardware address of
    the Raspberry Pi's wired network interface. The `ifconfig` command can be used
    to display a lot of useful network information. This combination of `ifconfig`
    and an `awk` filter can be used to display just the hardware address of the network
    interface.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 为了配置DHCP服务器，你需要Raspberry Pi有线网络接口的硬件地址。`ifconfig`命令可以用来显示大量有用的网络信息。结合使用`ifconfig`和`awk`过滤器，可以仅显示网络接口的硬件地址。
- en: '[PRE9]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![There''s more...](img/B04745_05_01.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![还有更多...](img/B04745_05_01.jpg)'
- en: In the preceding screenshot, a local home network gateway is being configured,
    setting the **Reserved IP Address** to **192.168.2.13** for the exclusive use
    of the **raspberry-pi** computer.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的截图中，正在配置本地家庭网络网关，设置**保留IP地址**为**192.168.2.13**，仅供**raspberry-pi**计算机使用。
- en: The **MAC Address** (**b8:27:eb:3f:aa:0c**) is the unique number assigned to
    this specific Raspberry Pi's network interface.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '**MAC地址** (**b8:27:eb:3f:aa:0c**) 是分配给此特定Raspberry Pi网络接口的唯一编号。'
- en: After this configuration is saved, the IP address **192.168.2.13** will be reserved
    for the exclusive use of the **raspberry-pi** computer.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 保存此配置后，IP地址**192.168.2.13**将被保留，专门供**raspberry-pi**计算机使用。
- en: See also
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**Dynamic Host Configuration Protocol** ([http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol](http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol)):
    This Wikipedia article describes the DHCP protocol, its history, and how it works.'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**动态主机配置协议** ([http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol](http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol)):
    这篇维基百科文章介绍了DHCP协议、其历史以及工作原理。'
- en: '**hostname – show or set the system''s hostname**([http://manpages.debian.net/cgi-bin/man.cgi?query=hostname](http://manpages.debian.net/cgi-bin/man.cgi?query=hostname)):
    The Debian manpage for `hostname` describes the command and its options.'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**hostname – 显示或设置系统主机名**([http://manpages.debian.net/cgi-bin/man.cgi?query=hostname](http://manpages.debian.net/cgi-bin/man.cgi?query=hostname)):
    Debian的`hostname`手册页面描述了该命令及其选项。'
- en: '**route – show/manipulate the IP routing table**([http://manpages.debian.net/cgi-bin/man.cgi?query=route](http://manpages.debian.net/cgi-bin/man.cgi?query=route)):
    The Debian manpage for `route` describes the command and its options.'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**route – 显示/操作IP路由表**([http://manpages.debian.net/cgi-bin/man.cgi?query=route](http://manpages.debian.net/cgi-bin/man.cgi?query=route)):
    Debian的`route`手册页面描述了该命令及其选项。'
- en: '**ifconfig – configure network interfaces** ([http://manpages.debian.net/cgi-bin/man.cgi?query=ifconfig](http://manpages.debian.net/cgi-bin/man.cgi?query=ifconfig)):
    The Debian manpage for `ifconfig` describes the command and its options.'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ifconfig – 配置网络接口** ([http://manpages.debian.net/cgi-bin/man.cgi?query=ifconfig](http://manpages.debian.net/cgi-bin/man.cgi?query=ifconfig)):
    Debian的`ifconfig`手册页面描述了该命令及其选项。'
- en: '**interfaces – network interface configuration for ifup and ifdown** ([http://manpages.debian.net/cgi-bin/man.cgi?query=interfaces](http://manpages.debian.net/cgi-bin/man.cgi?query=interfaces)):
    The Debian manpage for `interfaces` describes the configuration file and its parameters.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**interfaces – 网络接口配置文件（用于ifup和ifdown）** ([http://manpages.debian.net/cgi-bin/man.cgi?query=interfaces](http://manpages.debian.net/cgi-bin/man.cgi?query=interfaces)):
    Debian的`interfaces`手册页面描述了配置文件及其参数。'
- en: '**awk – pattern-directed scanning and processing language** ([http://manpages.debian.net/cgi-bin/man.cgi?query=awk](http://manpages.debian.net/cgi-bin/man.cgi?query=awk)):
    The Debian manpage for `awk` describes the command and the `awk` command language.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**awk – 模式驱动的扫描和处理语言** ([http://manpages.debian.net/cgi-bin/man.cgi?query=awk](http://manpages.debian.net/cgi-bin/man.cgi?query=awk)):
    Debian的`awk`手册页面描述了该命令及其`awk`命令语言。'
- en: Creating a firewall with ufw
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用ufw创建防火墙
- en: This recipe uses a simple, yet powerful command-line tool (`ufw`) to configure
    a firewall.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方使用了一个简单而强大的命令行工具（`ufw`）来配置防火墙。
- en: This recipe can be used to completely block network access to the Raspberry
    Pi. It can also be used to configure the Uncomplicated Firewall (`ufw`) to allow
    access through the firewall to specific applications (for example, web servers).
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱可用于完全阻止 Raspberry Pi 的网络访问。它还可以配置 Uncomplicated Firewall (`ufw`)，允许通过防火墙访问特定应用程序（例如，Web
    服务器）。
- en: After completing this recipe, you will be able to protect network access to
    your Raspberry Pi using a firewall.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本食谱后，你将能够通过防火墙保护 Raspberry Pi 的网络访问。
- en: Getting ready
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 材料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 初始设置或已开机的 Raspberry Pi 的基础网络设置。你也已经以用户 `pi` 登录（请参见 [第 1 章](ch01.html "第 1 章
    安装和设置")，*安装和设置*，了解如何启动和登录；以及 [第 2 章](ch02.html "第 2 章 管理")，*管理*，了解如何远程登录）。
- en: This recipe does not require the desktop GUI and could either be run from the
    text-based console or from within an `LXTerminal`.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱不需要桌面 GUI，可以从基于文本的控制台或 `LXTerminal` 中运行。
- en: If the Raspberry Pi's Secure Shell server is running, this recipe can be completed
    remotely using a Secure Shell client.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 Raspberry Pi 的 Secure Shell 服务器正在运行，本食谱可以通过使用 Secure Shell 客户端远程完成。
- en: How to do it...
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The steps for creating a firewall with `ufw` are:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个防火墙的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录 Raspberry Pi。
- en: Use the `apt-get install` command to install the `ufw` software package.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `apt-get install` 命令安装 `ufw` 软件包。
- en: '[PRE10]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The `apt-get install` command downloads and installs `ufw`. The installation
    of `ufw` includes a default set of firewall rules.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install` 命令下载并安装 `ufw`。`ufw` 的安装包含一组默认的防火墙规则。'
- en: Use the `ufw allow` command to add the `ssh` protocol to the list of allowed
    protocols in the firewall rules.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `ufw allow` 命令将 `ssh` 协议添加到防火墙规则中允许的协议列表。
- en: '[PRE11]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Use the `ufw enable` command to turn on the firewall.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `ufw enable` 命令开启防火墙。
- en: '[PRE12]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The firewall rules are enabled immediately and also on startup!
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 防火墙规则会立即启用，并且在启动时也会启用！
- en: How it works...
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: After logging in to the Raspberry Pi, this recipe uses the `apt-get install`
    command to download and install the Uncomplicated Firewall (**ufw**).
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在登录 Raspberry Pi 后，本食谱使用 `apt-get install` 命令下载并安装 Uncomplicated Firewall (**ufw**)。
- en: Then, a firewall rule is defined to permit remote access to the Raspberry Pi
    using the Secure Shell (`ssh`) protocol (`ufw allow ssh`).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，定义一条防火墙规则，允许使用 Secure Shell（`ssh`）协议远程访问 Raspberry Pi（`ufw allow ssh`）。
- en: Finally, the firewall is turned on (`ufw enable`).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，防火墙被启用（`ufw enable`）。
- en: There's more...
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The Uncomplicated Firewall (`ufw`) is a command-line tool for defining firewall
    rules. The `ufw` command is not actually a firewall. There is no extra firewall
    server installed. The Linux kernel can be used as a firewall.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: Uncomplicated Firewall (`ufw`) 是一个用于定义防火墙规则的命令行工具。`ufw` 命令实际上不是防火墙。没有安装额外的防火墙服务器。Linux
    内核可以作为防火墙使用。
- en: The `ufw` command is just used to configure firewall rules. The rule definitions
    are stored in the `/etc/ufw` directory; however, those definition files should
    not be modified directly. Modifying those files correctly is the purpose of the
    `ufw` command.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '`ufw` 命令仅用于配置防火墙规则。规则定义存储在 `/etc/ufw` 目录中；然而，这些定义文件不应直接修改。正确修改这些文件是 `ufw` 命令的目的。'
- en: Don't forget to enable remote access
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 别忘了启用远程访问。
- en: In the preceding recipe, after the `ufw` command is installed and before the
    firewall is enabled, a new firewall rule, allow SSH access (`ufw`) `allow ssh`,
    is added to the rule definitions. Without this rule, the next attempt to connect
    remotely via `ssh` would fail.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的食谱中，`ufw` 命令安装后，在启用防火墙之前，会向规则定义中添加一条新的防火墙规则，允许 SSH 访问（`ufw`）`allow ssh`。没有此规则，下次通过
    `ssh` 远程连接时将失败。
- en: '[PRE13]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: In this example, the `ssh` command fails because there is no firewall rule permitting
    Secure Shell access to the Raspberry Pi.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，`ssh` 命令失败，因为没有防火墙规则允许使用 Secure Shell 访问 Raspberry Pi。
- en: Disabling the firewall
  id: totrans-103
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 禁用防火墙
- en: The firewall rules defined using `ufw` will not prevent a user from logging
    in locally using a keyboard and display connected directly to the Raspberry Pi.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`ufw`定义的防火墙规则不会阻止用户通过直接连接到Raspberry Pi的键盘和显示器本地登录。
- en: 'If `ufw` is preventing remote access, log in directly to the Raspberry Pi and
    then use the command: `ufw disable` to disable the firewall rules.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`ufw`阻止了远程访问，直接登录到Raspberry Pi，然后使用命令：`ufw disable`来禁用防火墙规则。
- en: '[PRE14]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Allowing a file server through the firewall
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 允许文件服务器通过防火墙
- en: If the Raspberry Pi has been set up as a file server (see [Chapter 4](ch04.html
    "Chapter 4. File Sharing"), *File Sharing*), use the firewall rule `ufw allow
    cifs` to allow the SMB (CIFS) protocol through the firewall.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Raspberry Pi已设置为文件服务器（参见[第4章](ch04.html "第4章 文件共享"), *文件共享*），则使用防火墙规则`ufw
    allow cifs`来允许SMB（CIFS）协议通过防火墙。
- en: '[PRE15]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Allowing a web server through the firewall
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 允许网页服务器通过防火墙
- en: Similarly, if the Raspberry Pi has been set up as a local web server (see the
    next recipe in this chapter), use the firewall rule `ufw allow http` to allow
    the HTTP protocol through the firewall.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，如果Raspberry Pi已设置为本地网页服务器（参见本章的下一个教程），则使用防火墙规则`ufw allow http`来允许HTTP协议通过防火墙。
- en: '[PRE16]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Application rules
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 应用规则
- en: The Uncomplicated Firewall has predefined rules for a number of application
    protocols, in addition to network protocols. The applications currently recognized
    by `ufw` can be displayed with the command `ufw app list`.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 除了网络协议之外，简单防火墙还为许多应用协议预定义了规则。当前`ufw`识别的应用可以通过命令`ufw app list`显示。
- en: '[PRE17]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Enable all the defined network connections for one of the preceding applications
    using the command `ufw allow` and disable them using the command `ufw deny`.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 使用命令`ufw allow`启用前述应用程序的所有已定义网络连接，使用命令`ufw deny`禁用它们。
- en: The `ufw app info` command will display the application's configuration.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '`ufw app info`命令将显示应用的配置。'
- en: '[PRE18]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The preceding example shows that the application configuration for **"WWW Full"**
    includes both the **HTTP** port (**80**) and the **HTTPS** port (**443**). By
    using the **"WWW Full"** application profile, network access to both web server
    ports can be allowed (denied or rejected) using a single firewall rule.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的示例表明，**"WWW Full"**的应用配置包括了**HTTP**端口（**80**）和**HTTPS**端口（**443**）。通过使用**"WWW
    Full"**应用配置文件，可以通过一个防火墙规则允许（拒绝或拒绝）对这两个网页服务器端口的网络访问。
- en: Resetting the firewall rules
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 重置防火墙规则
- en: By default, the `ufw` rules deny all network access to the Raspberry Pi. However,
    also by default, the firewall rules are not enabled.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`ufw`规则会拒绝所有网络访问到Raspberry Pi。然而，默认情况下，防火墙规则并未启用。
- en: Use the command `ufw reset` to return the firewall rules to their defaults –
    no remote access at all with the firewall disabled.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 使用命令`ufw reset`将防火墙规则恢复到默认状态——禁用防火墙时，完全无法进行远程访问。
- en: After resetting the default rules, the firewall can then be re-enabled with
    the command `ufw enable`.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 重置默认规则后，可以使用命令`ufw enable`重新启用防火墙。
- en: See also
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**Uncomplicated Firewall (ufw)** ([http://en.wikipedia.org/wiki/Uncomplicated_Firewall](http://en.wikipedia.org/wiki/Uncomplicated_Firewall)):
    This Wikipedia article about the Uncomplicated Firewall explains how it works.'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简单防火墙（ufw）** ([http://en.wikipedia.org/wiki/Uncomplicated_Firewall](http://en.wikipedia.org/wiki/Uncomplicated_Firewall))：这篇关于简单防火墙的维基百科文章解释了它的工作原理。'
- en: '**ufw – program for managing a netfilter firewall** ([http://manpages.debian.net/cgi-bin/man.cgi?query=ufw](http://manpages.debian.net/cgi-bin/man.cgi?query=ufw)):
    The Debian manpage for `ufw` describes the command and its options.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ufw – 管理网络过滤防火墙的程序** ([http://manpages.debian.net/cgi-bin/man.cgi?query=ufw](http://manpages.debian.net/cgi-bin/man.cgi?query=ufw))：Debian的`ufw`手册页描述了该命令及其选项。'
- en: '**iptables – administration tool for IPv4 packet filtering and NAT** ([http://manpages.debian.net/cgi-bin/man.cgi?query=iptables](http://manpages.debian.net/cgi-bin/man.cgi?query=iptables)):
    The Debian manpage for `iptables` describes in more detail how to configure the
    Linux kernel''s built-in firewall.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iptables – IPv4包过滤和NAT管理工具** ([http://manpages.debian.net/cgi-bin/man.cgi?query=iptables](http://manpages.debian.net/cgi-bin/man.cgi?query=iptables))：Debian的`iptables`手册页更详细地描述了如何配置Linux内核内建的防火墙。'
- en: Remote access to a desktop session (xrdp)
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 远程访问桌面会话（xrdp）
- en: This recipe enables remote access to a Raspberry Pi desktop session using `xrdp`.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 这个教程启用通过`xrdp`远程访问Raspberry Pi桌面会话。
- en: Using `xrdp`, teachers, support engineers, and hobbyists can create a new desktop
    session on the Raspberry Pi remotely from another computer. The newly created
    desktop session is separate from the desktop session currently displayed on the
    monitor attached to the Raspberry Pi. This private session is perfect for installing
    updates or performing other background tasks that should not interrupt the desktop
    session currently displayed on the Raspberry Pi's monitor.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`xrdp`，教师、支持工程师和爱好者可以从另一台计算机远程在Raspberry Pi上创建新的桌面会话。新创建的桌面会话与当前连接到Raspberry
    Pi的显示器上显示的桌面会话是分开的。这种私密会话非常适合安装更新或执行其他不应打断当前Raspberry Pi显示器上桌面会话的后台任务。
- en: After completing this recipe, you will be able to use `xrdp` to create a new
    remote desktop session on the Raspberry Pi.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此食谱后，您将能够使用`xrdp`在Raspberry Pi上创建新的远程桌面会话。
- en: Getting ready
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Ingredients:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 配料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 已启动的Raspberry Pi的初始设置或基本网络设置。您还已经以用户`pi`登录（请参阅[第1章](ch01.html "第1章. 安装和设置")中的食谱，*安装和设置*如何启动和登录以及[第2章](ch02.html
    "第2章. 管理")中的食谱，*管理*如何远程登录）。
- en: Running this application requires the desktop GUI. Use `raspi-config` to configure
    the Raspberry Pi to automatically boot with the desktop GUI (see Chapter 2, *Administration*).
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此应用程序需要桌面图形用户界面。使用`raspi-config`配置Raspberry Pi以自动启动桌面GUI（参见第2章，*管理*）。
- en: The installation portion of this recipe does not require the desktop and can
    be run from the text-based console (or from within an LXTerminal).
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 此食谱的安装部分不需要桌面，可以从基于文本的控制台（或从LXTerminal内部）运行。
- en: If the Raspberry Pi's Secure Shell server is running, this recipe can be completed
    remotely using a Secure Shell client.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Raspberry Pi的Secure Shell服务器正在运行，则可以使用Secure Shell客户端远程完成此食谱。
- en: How to do it...
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'The steps for connecting to the Raspberry Pi desktop remotely are:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 连接到Raspberry Pi桌面的步骤是：
- en: Log in to the Raspberry Pi either directly or remotely. If you are using the
    Raspberry Pi desktop, open an LXTerminal window.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录到Raspberry Pi。如果您使用Raspberry Pi桌面，请打开一个LXTerminal窗口。
- en: Use the `apt-get install` command to install the `xrdp` software package.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`apt-get install`命令安装`xrdp`软件包。
- en: '[PRE19]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The `apt-get install` command downloads and installs `xrdp`.Installation of
    the software package includes starting the `xrdp` service.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install`命令下载并安装`xrdp`。安装软件包包括启动`xrdp`服务。'
- en: Use a **RDP** (**Remote Desktop Protocol**) client (such as Microsoft's Remote
    Desktop Connection) to connect to the Raspberry Pi using its IP address (**192.168.2.13**).![How
    to do it...](img/B04745_05_02.jpg)
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**RDP**（**远程桌面协议**）客户端（例如Microsoft的Remote Desktop Connection）通过其IP地址（**192.168.2.13**）连接到Raspberry
    Pi。![如何做...](img/B04745_05_02.jpg)
- en: The preceding screenshot shows how to connect to the Raspberry Pi using Microsoft's
    Remote Desktop Connection for Mac.
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以上截图显示了如何使用Microsoft的Remote Desktop Connection for Mac连接到Raspberry Pi。
- en: Once connected, the `xrdp` session manager (`sesman`) displays a login screen.![How
    to do it...](img/B04745_05_03.jpg)
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 连接后，`xrdp`会话管理器（`sesman`）显示登录屏幕。![如何做...](img/B04745_05_03.jpg)
- en: The preceding image shows how to start a remote desktop session with the Raspberry
    Pi using `xrdp`.
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以上图像显示了如何使用`xrdp`在Raspberry Pi上启动远程桌面会话。
- en: 'Log in to the `xrdp` session: Choose `sesman-Xvnc` as the Module. Use the same
    username (`pi`) and password (`raspberry`) that you use to log in via the console
    (or via ssh).'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到`xrdp`会话：选择`sesman-Xvnc`作为模块。使用与您通过控制台（或通过ssh）登录相同的用户名（`pi`）和密码（`raspberry`）。
- en: After a successful login, the Raspberry Pi desktop is displayed.![How to do
    it...](img/B04745_05_04.jpg)
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 成功登录后，将显示Raspberry Pi桌面。![如何做...](img/B04745_05_04.jpg)
- en: The preceding screenshot shows a remote connection to the Raspberry Pi desktop
    via an RDP connection (client resolution was set to 640x480).
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以上截图显示了通过RDP连接（客户端分辨率设置为640x480）远程连接到Raspberry Pi桌面。
- en: How it works...
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: After logging in to the Raspberry Pi, the `xrdb` software package is downloaded
    and installed using `apt-get install`. The installation includes starting `xrdb`
    and the desktop session manager (`sesman`).
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到树莓派后，`xrdb`软件包通过`apt-get install`进行下载和安装。安装过程中会启动`xrdb`和桌面会话管理器（`sesman`）。
- en: After `sesman` has started, a remote session to the Raspberry Pi can be created
    from another computer that has an RDP client installed.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在`sesman`启动后，可以从另一台安装了RDP客户端的计算机创建到树莓派的远程会话。
- en: The example in the recipe uses Microsoft's Remote Desktop Connection for Mac.
    The Microsoft RDP client prompts for the **Computer**. Enter the Raspberry Pi's
    IP address (**192.168.2.13**) to create a remote connection.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 示例中使用的是Microsoft的Mac版远程桌面连接。Microsoft RDP客户端会提示输入**计算机**。输入树莓派的IP地址（**192.168.2.13**）以建立远程连接。
- en: After the remote connection is made, an RDP session is created (**Login to xrdp**)
    by logging in to `xrdp` with the same username and password that is used to log
    in directly to the Raspberry Pi via `ssh` or directly via the GUI desktop.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 远程连接建立后，RDP会话会通过使用与直接通过`ssh`或通过GUI桌面直接登录树莓派时相同的用户名和密码登录`xrdp`来创建（**登录到xrdp**）。
- en: Once the username and password have been entered correctly, a new desktop session
    is created. This new desktop session is not the same as the session running on
    the monitor connected directly to the Raspberry Pi. It is a new desktop session.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦用户名和密码正确输入，一个新的桌面会话就会被创建。这个新桌面会话与直接连接到树莓派的显示器上的会话不同。它是一个新的桌面会话。
- en: There's more...
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The Remote Desktop Protocol (RDP) is a client-server protocol developed by Microsoft.
    The `xrdp` client is used to display the graphical user interface sent by an RDP
    server. The Microsoft RDP client (`mstsc.exe`) is included in every Windows version
    since XP.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 远程桌面协议（RDP）是微软开发的一种客户端-服务器协议。`xrdp`客户端用于显示由RDP服务器发送的图形用户界面。Microsoft RDP客户端（`mstsc.exe`）自XP以来包含在每个Windows版本中。
- en: The `xrdp` software package also includes the TightVNC server (`tightvncsever`)
    that communicates via the **Virtual Network Computing** (**VNC**) protocol – another
    graphical desktop sharing protocol. A number of open source and proprietary clients
    exist for both the RDP and VNC remote desktop protocols, including clients for
    mobile devices and tablet PCs.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '`xrdp`软件包还包括TightVNC服务器（`tightvncserver`），它通过**虚拟网络计算**（**VNC**）协议进行通信——这也是一种图形桌面共享协议。RDP和VNC远程桌面协议都有许多开源和专有客户端，包括移动设备和平板电脑的客户端。'
- en: The remote desktop connection displays the Raspberry Pi desktop in much the
    same way, as the desktop would be seen, if the Raspberry Pi were connected directly
    to a display. There are some exceptions.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 远程桌面连接以与树莓派直接连接显示器时类似的方式显示树莓派桌面。但也有一些例外。
- en: No streaming video (or Minecraft)
  id: totrans-161
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 无法播放视频流（或Minecraft）
- en: The most noticeable limitation that a remote display has is not being able to
    display streaming video. Most video streaming applications stream directly to
    the video frame buffer, the part of memory that is shared with the display. So,
    the video is streamed directly to the display and bypasses the desktop. Because
    the video bypasses the desktop, it is also not sent to the remote desktop.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 远程显示的最明显的限制是无法显示视频流。大多数视频流应用程序直接将视频流传输到视频帧缓冲区，即与显示器共享的内存部分。因此，视频直接流向显示器，并绕过桌面。因为视频绕过桌面，它也不会被发送到远程桌面。
- en: The Minecraft game for the Raspberry Pi also accesses the video frame buffer
    directly. So, like video streaming, Minecraft cannot be played through a remote
    desktop session.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 树莓派上的Minecraft游戏也直接访问视频帧缓冲区。因此，与视频流一样，Minecraft无法通过远程桌面会话进行播放。
- en: It's not the display
  id: totrans-164
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 这不是显示
- en: Each remote desktop session is a separate desktop session. It is not the same
    desktop session that is displayed on the monitor directly connected to the Raspberry
    Pi.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 每个远程桌面会话都是一个独立的桌面会话。它与直接连接到树莓派显示器上的桌面会话不同。
- en: See also
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**Remote Desktop Protocol** ([http://en.wikipedia.org/wiki/Remote_Desktop_Protocol](http://en.wikipedia.org/wiki/Remote_Desktop_Protocol)):
    This Wikipedia article describes the Remote Desktop Protocol (RDP).'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程桌面协议**（[http://en.wikipedia.org/wiki/Remote_Desktop_Protocol](http://en.wikipedia.org/wiki/Remote_Desktop_Protocol)）：这篇维基百科文章描述了远程桌面协议（RDP）。'
- en: '**Comparison of remote desktop software** ([http://en.wikipedia.org/wiki/Comparison_of_remote_desktop_software](http://en.wikipedia.org/wiki/Comparison_of_remote_desktop_software)):
    This Wikipedia article compares remote desktop software.'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程桌面软件比较**（[http://en.wikipedia.org/wiki/Comparison_of_remote_desktop_software](http://en.wikipedia.org/wiki/Comparison_of_remote_desktop_software)）：这篇维基百科文章比较了远程桌面软件。'
- en: '**xrdp – a Remote Desktop Protocol (RDP) server** ([http://manpages.debian.net/cgi-bin/man.cgi?query=xrdp](http://manpages.debian.net/cgi-bin/man.cgi?query=xrdp)):
    The Debian manpage for `xrdp` has more details about the command and its options.'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**xrdp – 一个远程桌面协议（RDP）服务器**（[http://manpages.debian.net/cgi-bin/man.cgi?query=xrdp](http://manpages.debian.net/cgi-bin/man.cgi?query=xrdp)）：Debian手册页提供了有关`xrdp`命令及其选项的更多信息。'
- en: '**sesman – an xrdp(8) session manager** ([http://manpages.debian.net/cgi-bin/man.cgi?query=sesman](http://manpages.debian.net/cgi-bin/man.cgi?query=sesman)):
    The Debian manpage for `sesman` has more details about the command and its options.'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**sesman – 一个xrdp(8)会话管理器**（[http://manpages.debian.net/cgi-bin/man.cgi?query=sesman](http://manpages.debian.net/cgi-bin/man.cgi?query=sesman)）：Debian手册页提供了有关`sesman`命令及其选项的更多信息。'
- en: '**xrdp – an open source remote desktop protocol (rdp) server** ([http://www.xrdp.org/](http://www.xrdp.org/)):
    The xrdp website has more details about this RDP server.'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**xrdp – 一个开源的远程桌面协议（rdp）服务器**（[http://www.xrdp.org/](http://www.xrdp.org/)）：xrdp网站提供了有关这个RDP服务器的更多信息。'
- en: Remote access to the monitor (x11vnc)
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 远程访问显示器（x11vnc）
- en: This recipe enables remote access to the Raspberry Pi's monitor using `xrdp`.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱启用通过`xrdp`远程访问树莓派的显示器。
- en: Using `x11vnc`, teachers, support engineers, and hobbyists can access the desktop
    session currently displayed on the monitor attached to the Raspberry Pi. Teachers
    can use the remote desktop access to help students complete an assignment. Remote
    support engineers can help a Raspberry Pi user debug, install, or configure software.
    And, hobbyists can use `xrdp` to access the Raspberry Pi attached to the living
    room TV from another room.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`x11vnc`，教师、支持工程师和爱好者可以访问当前显示在树莓派显示器上的桌面会话。教师可以通过远程桌面帮助学生完成作业。远程支持工程师可以帮助树莓派用户调试、安装或配置软件。而爱好者可以使用`xrdp`从其他房间访问连接到客厅电视的树莓派。
- en: After completing this recipe, you will be able to use `xrdp` to remotely access
    the desktop session currently displayed on the Raspberry Pi's monitor.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本食谱后，你将能够使用`xrdp`远程访问当前显示在树莓派显示器上的桌面会话。
- en: Getting ready
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 材料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 树莓派已开机并完成初始设置或基本网络设置。你还需要以`pi`用户身份登录（有关如何启动和登录的食谱，请参见[第1章](ch01.html "第1章. 安装与设置")，*安装与设置*；如何远程登录，请参见[第2章](ch02.html
    "第2章. 管理")，*管理*）。
- en: Running this application requires the desktop GUI. Use `raspi-config` to configure
    the Raspberry Pi to automatically boot with the desktop GUI (see [Chapter 2](ch02.html
    "Chapter 2. Administration"), *Administration*).
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此应用程序需要桌面GUI。使用`raspi-config`配置树莓派，使其能够在启动时自动加载桌面GUI（请参见[第2章](ch02.html "第2章.
    管理"), *管理*）。
- en: The installation portion of this recipe does not require the desktop and can
    be run from the text-based console (or from within an LXTerminal).
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱的安装部分不需要桌面环境，可以从基于文本的控制台（或在LXTerminal中）运行。
- en: If the Raspberry Pi's Secure Shell server is running, the installation portion
    of this recipe can also be completed remotely using a Secure Shell client (see
    `ssh` recipe in [Chapter 2](ch02.html "Chapter 2. Administration"), *Administration*).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 如果树莓派的安全外壳（Secure Shell）服务器正在运行，本食谱的安装部分也可以通过使用安全外壳客户端远程完成（请参见[第2章](ch02.html
    "第2章. 管理"), *管理*中的`ssh`食谱）。
- en: How to do it...
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The steps for connecting to the Raspberry Pi desktop remotely are:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 远程连接到树莓派桌面的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely. If you are using the
    Raspberry Pi desktop, open an LXTerminal.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录到树莓派。如果你使用的是树莓派桌面环境，打开LXTerminal。
- en: Use the `apt-get install` command to install the `x11vnc` package.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`apt-get install`命令安装`x11vnc`包。
- en: '[PRE20]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The `apt-get install` command downloads and installs `x11vnc`.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install`命令会下载并安装`x11vnc`。'
- en: From a remote computer, use a Secure Shell tunnel (`ssh`) to start an instance
    of `x11vnc` running on the Raspberry Pi. It will continue to run while the connection
    is open.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从远程计算机使用安全外壳隧道（`ssh`）启动一个在 Raspberry Pi 上运行的`x11vnc`实例。只要连接处于开启状态，它就会继续运行。
- en: '[PRE21]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Use a VNCclient (such as TightVNC) to connect to the remote Raspberry Pi from
    the local machine (**127.0.0.1**) using the ssh tunnel.![How to do it...](img/B04745_05_05.jpg)
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 VNC 客户端（如 TightVNC）通过 ssh 隧道从本地计算机连接到远程 Raspberry Pi（**127.0.0.1**）。![如何操作...](img/B04745_05_05.jpg)
- en: The preceding screenshot shows how to connect to the Raspberry Pi using TightVNC.
    The **Remote Host** is actually the local host (**127.0.0.1**) because of the
    `ssh` tunnel. The **Port** is the default VNC port (**5900**).
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 前面的截图展示了如何使用 TightVNC 连接到 Raspberry Pi。**远程主机**实际上是本地主机（**127.0.0.1**），这是由于`ssh`隧道的缘故。**端口**是默认的
    VNC 端口（**5900**）。
- en: '![How to do it...](img/B04745_05_06.jpg)'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/B04745_05_06.jpg)'
- en: In the preceding screenshot, the TightVNC client asks for the user to enter
    the authentication password. Enter the password that was specified in the previous
    step (**pass1234**).
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在前面的截图中，TightVNC 客户端请求用户输入认证密码。输入前一步中指定的密码（**pass1234**）。
- en: Once connected, TightVNC displays what is on the monitor.![How to do it...](img/B04745_05_07.jpg)
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦连接，TightVNC 会显示显示器上的内容。![如何操作...](img/B04745_05_07.jpg)
- en: The preceding screenshot shows a remote connection to the Raspberry Pi desktop
    via a TightVNC client (client resolution is at 50 percent).
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 前面的截图显示了如何通过 TightVNC 客户端远程连接到 Raspberry Pi 的桌面（客户端分辨率为 50%）。
- en: How it works...
  id: totrans-196
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: After logging in to the Raspberry Pi, the `apt-get install` command is used
    to download and install the `x11vnc` software package.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 登录 Raspberry Pi 后，使用`apt-get install`命令下载并安装`x11vnc`软件包。
- en: After installation is complete, the `x11vnc` server is started from a remote
    machine using a Secure Shell tunnel (ssh).
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，`x11vnc`服务器通过远程计算机使用安全外壳隧道（ssh）启动。
- en: The ssh tunnel starts the `x11vnc` server and forwards the VNC connection on
    the remote Raspberry Pi to the same port on the local host (**-L 5900:localhost:5900**).
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 隧道启动`x11vnc`服务器，并将远程 Raspberry Pi 上的 VNC 连接转发到本地主机的相同端口（**-L 5900:localhost:5900**）。
- en: The `x11vnc` server is started quietly (**-q**) using the desktop session that
    is displayed on the monitor (**-display :0**). The server only allows local connections
    (**-localhost**). The authentication password is set (**-passwd pass1234**).
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 使用显示在显示器上的桌面会话（**-display :0**）启动`x11vnc`服务器，且以静默模式启动（**-q**）。服务器只允许本地连接（**-localhost**）。设置认证密码（**-passwd
    pass1234**）。
- en: The `x11vnc` server remains running so long as there is a client connection.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 只要有客户端连接，`x11vnc`服务器就会持续运行。
- en: The recipe then uses the TightVNC Java client to connect to the Raspberry Pi.
    The TightVNC client prompts for the **Remote Host** and **Port**. Because the
    recipe is using an ssh tunnel, the IP address of the local host (**127.0.0.1**)
    is entered to use the ssh tunnel.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，配方使用 TightVNC Java 客户端连接到 Raspberry Pi。TightVNC 客户端提示输入**远程主机**和**端口**。由于配方使用了
    SSH 隧道，因此输入本地主机的 IP 地址（**127.0.0.1**）来使用 SSH 隧道。
- en: Before the Raspberry Pi desktop is displayed, the VNC client requests the **VNC
    Authentication** password that was specified when starting the server (**pass1234**).
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Raspberry Pi 桌面显示之前，VNC 客户端请求输入启动服务器时指定的**VNC 认证**密码（**pass1234**）。
- en: Once the password has been entered correctly, the VNC client also displays the
    desktop session displayed on the Raspberry Pi's monitor.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦正确输入密码，VNC 客户端就会显示 Raspberry Pi 显示器上显示的桌面会话。
- en: So long as the remote desktop session is connected, the `x11vnc` server continues
    to run. As soon as the remote connection is closed, the `x11vnc` server quits.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 只要远程桌面会话处于连接状态，`x11vnc`服务器就会继续运行。远程连接关闭时，`x11vnc`服务器退出。
- en: There's more...
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The VNC client displays the same desktop session that is being displayed on
    the Raspberry Pi's monitor. However, there are some exceptions.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: VNC 客户端显示与 Raspberry Pi 显示器上相同的桌面会话。然而，也有一些例外。
- en: No streaming video (or Minecraft)
  id: totrans-208
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 无视频流（或 Minecraft）
- en: Applications that write directly to the video frame buffer (for example, video
    streaming and Minecraft) are still not displayed over VNC (see the previous recipe
    for more info).
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 直接写入视频帧缓冲区的应用程序（例如，视频流和 Minecraft）仍然不会通过 VNC 显示（有关更多信息，请参见前面的配方）。
- en: See also
  id: totrans-210
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**Virtual Network Computing** ([http://en.wikipedia.org/wiki/Vnc](http://en.wikipedia.org/wiki/Vnc)):
    This Wikipedia article about Virtual Network Computing (VNC) describes the history
    and capabilities of the VNC protocol.'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟网络计算** ([http://en.wikipedia.org/wiki/Vnc](http://en.wikipedia.org/wiki/Vnc))：这篇Wikipedia文章介绍了虚拟网络计算（VNC）的历史和功能。'
- en: '**x11vnc** ([https://en.wikipedia.org/wiki/X11vnc](https://en.wikipedia.org/wiki/X11vnc)):
    This Wikipedia article about x11vnc describes its use and configuration.'
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**x11vnc** ([https://en.wikipedia.org/wiki/X11vnc](https://en.wikipedia.org/wiki/X11vnc))：这篇Wikipedia文章介绍了x11vnc的使用和配置。'
- en: '**x11vnc –** allow VNC connections to real X11 displays ([http://manpages.debian.net/cgi-bin/man.cgi?query=x11vnc](http://manpages.debian.net/cgi-bin/man.cgi?query=x11vnc)):
    The Debian manpage for `x11nvc` describes the command and its options.'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**x11vnc –** 允许VNC连接到真实的X11显示器 ([http://manpages.debian.net/cgi-bin/man.cgi?query=x11vnc](http://manpages.debian.net/cgi-bin/man.cgi?query=x11vnc))：Debian的`x11vnc`手册页描述了该命令及其选项。'
- en: '**TightVNC Software** ([http://tightvnc.com/](http://tightvnc.com/)): The TightVNC
    Software website has instructions on how to download and install a client.'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**TightVNC 软件** ([http://tightvnc.com/](http://tightvnc.com/))：TightVNC软件网站提供了下载和安装客户端的说明。'
- en: Installing a web server (Apache, lighttpd, Nginx)
  id: totrans-215
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装web服务器（Apache、lighttpd、Nginx）
- en: This recipe installs the Apache HTTP web server. Installation differences for
    the lighttpd and Nginx web servers are found at the end of this recipe.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱安装Apache HTTP web服务器。lighttpd和Nginx web服务器的安装差异在本食谱末尾有说明。
- en: The Apache web server is one of the most commonly used web servers on GNU Linux
    platforms like the Raspbian Linux distribution used by the Raspberry Pi. Apache
    is a mature, extensible web server that can be used to host a variety of applications;
    proxy access to websites internal and external; as well as host static web pages
    and images.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: Apache web服务器是GNU Linux平台（如Raspberry Pi使用的Raspbian Linux发行版）上最常用的web服务器之一。Apache是一个成熟且可扩展的web服务器，可以用于托管各种应用程序；代理访问内部和外部网站；以及托管静态网页和图像。
- en: After completing this recipe, the Raspberry Pi will able to serve static and
    dynamic web pages from the SD card boot disk and from an external disk.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本食谱后，Raspberry Pi将能够从SD卡启动盘和外部硬盘提供静态和动态网页。
- en: Getting ready
  id: totrans-219
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 配料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 需要为已开机的Raspberry Pi进行初步设置或基本网络配置。你还需要以`pi`用户登录（请参阅[第1章](ch01.html "第1章 安装与设置")，*安装与设置*部分，了解如何启动和登录；以及[第2章](ch02.html
    "第2章 管理")，*管理*部分，了解如何远程登录）。
- en: This recipe does not require the desktop GUI and could either be run from the
    text-based console or from within an `LXTerminal`.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱不需要桌面GUI，可以通过文本控制台或在`LXTerminal`中运行。
- en: If the Raspberry Pi's Secure Shell server is running, this recipe can be completed
    remotely using a Secure Shell client.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Raspberry Pi的安全外壳（Secure Shell）服务器正在运行，可以通过安全外壳客户端远程完成本食谱。
- en: The examples in this recipe also use an external hard disk mounted at `/media/bigdisk`
    (see [Chapter 4](ch04.html "Chapter 4. File Sharing"), *File Sharing* for more
    information).
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱中的示例还使用了挂载在`/media/bigdisk`的外部硬盘（详情请参阅[第4章](ch04.html "第4章 文件共享")，*文件共享*部分）。
- en: 'The steps for installing the Apache web server are:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 安装Apache web服务器的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录到Raspberry Pi。
- en: Use the `apt-get install` command to download and install the Apache HTTP web
    server (`apache2`).
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`apt-get install`命令下载并安装Apache HTTP web服务器（`apache2`）。
- en: '[PRE22]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The `apt-get install` command downloads and installs `apache2`.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install`命令用于下载并安装`apache2`。'
- en: Note
  id: totrans-230
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If the `ufw` firewall has been installed (see the preceding *Creating a firewall*
    recipe), use the `ufw allow http` command to create a rule that allows the HTTP
    (web server) protocol through the firewall.
  id: totrans-231
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果已安装`ufw`防火墙（请参见前面的*创建防火墙*食谱），使用`ufw allow http`命令创建规则，允许HTTP（web服务器）协议通过防火墙。
- en: '[PRE23]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Use the web browser on another computer (or device) to test the HTTP connection
    to the Raspberry Pi.![Getting ready](img/B04745_05_08.jpg)
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用另一台计算机（或设备）上的web浏览器测试与Raspberry Pi的HTTP连接。![准备工作](img/B04745_05_08.jpg)
- en: In the preceding image, a web browser on another computer is used to access
    the default web page of the Apache web server running on the Raspberry Pi. The
    web server works!
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在上面的图像中，另一台计算机上的网页浏览器用于访问运行在树莓派上的 Apache Web 服务器的默认网页。Web 服务器正常工作！
- en: Use the command `ls –l` to list the contents of the web server's root directory,
    `/var/www`.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用命令 `ls -l` 列出 Web 服务器根目录 `/var/www` 的内容。
- en: '[PRE24]'
  id: totrans-236
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: There is one file in the web server's root directory, **index.html**.
  id: totrans-237
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Web 服务器的根目录中有一个文件，**index.html**。
- en: Use the command `ls –l` to list the contents of a website stored on an external
    disk, `/media/bigdisk/MyWebsite/`.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用命令 `ls -l` 列出存储在外部磁盘 `/media/bigdisk/MyWebsite/` 上的网站内容。
- en: '[PRE25]'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: There is one file in the directory on the external disk, `hello.html`.
  id: totrans-240
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 外部磁盘目录中有一个文件，`hello.html`。
- en: Use the command `ln –s` to create a symbolic link from the external disk directory
    (`/media/bigdisk/MyWebsite`) to the web server's root directory (`/var/www/`).
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用命令 `ln -s` 在外部磁盘目录（`/media/bigdisk/MyWebsite`）和 Web 服务器的根目录（`/var/www/`）之间创建一个符号链接。
- en: '[PRE26]'
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: The web server's root directory `(/var/www`) now has a symbolic link to the
    website stored on the external disk `(/media/bigdisk/MyWebsite`).
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Web 服务器根目录（`/var/www`）现在有一个指向存储在外部磁盘上的网站（`/media/bigdisk/MyWebsite`）的符号链接。
- en: Use the web browser on another computer (or device) to test the HTTP connection
    to the Raspberry Pi. The website on the external disk is now accessible!![Getting
    ready](img/B04745_05_09.jpg)
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用另一台计算机（或设备）上的网页浏览器测试与树莓派的 HTTP 连接。外部磁盘上的网站现在可以访问！！[准备就绪](img/B04745_05_09.jpg)
- en: The preceding image shows how a web browser on another computer is used to access
    a web page stored on an external disk attached to the Raspberry Pi.
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上面的图像展示了如何通过另一台计算机上的网页浏览器访问存储在连接到树莓派外部磁盘上的网页。
- en: Use the `vi` command to create a dynamic web page (`timestamp`) in the `/usr/lib/cgi-bin`
    directory.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `vi` 命令在 `/usr/lib/cgi-bin` 目录中创建一个动态网页（`timestamp`）。
- en: '[PRE27]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Add the following lines to the new dynamic web page:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下行添加到新的动态网页中：
- en: '[PRE28]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Save the file and exit (`:wq`).
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出（`:wq`）。
- en: Use the command `chmod a+rx` to make the dynamic web page `/usr/lib/cgi-bin/timestamp`
    executable.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用命令 `chmod a+rx` 使动态网页 `/usr/lib/cgi-bin/timestamp` 可执行。
- en: '[PRE29]'
  id: totrans-252
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The dynamic web page `/usr/lib/cgi-bin/timestamp` is now executable.
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 动态网页 `/usr/lib/cgi-bin/timestamp` 现在是可执行的。
- en: Use a web browser on another computer to display the dynamic web page (`http://192.168.2.13/cgi-bin/timestamp`).
    The dynamic web page displays the current time with each page refresh!![Getting
    ready](img/B04745_05_10.jpg)
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用另一台计算机上的网页浏览器显示动态网页（`http://192.168.2.13/cgi-bin/timestamp`）。该动态网页会在每次刷新页面时显示当前时间！！[准备就绪](img/B04745_05_10.jpg)
- en: The preceding image shows the dynamic web page in action – with every page refresh,
    the timestamp is updated to the current time. The Raspberry Pi now displays dynamic
    pages!
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上面的图像展示了动态网页的实际运行情况——每次刷新页面时，时间戳会更新为当前时间。树莓派现在可以显示动态页面！
- en: Use the `ls -l` command to display the contents of the web server's log files
    directory (`/var/log/apache2/`).
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `ls -l` 命令显示 Web 服务器日志文件目录的内容（`/var/log/apache2/`）。
- en: '[PRE30]'
  id: totrans-257
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The preceding example shows how the `ls -l` command is used to display the contents
    of the Apache web server's log files directory.
  id: totrans-258
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上面的示例展示了如何使用 `ls -l` 命令显示 Apache Web 服务器日志文件目录的内容。
- en: How it works...
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理……
- en: After logging in to the Raspberry Pi, this recipe begins by using the **apt-get
    install** command to download and install the Apache HTTP server software distribution
    meta package, `apache2`. The `apache2` software distribution includes the Apache
    HTTP server and supporting utilities.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到树莓派后，本教程从使用**apt-get install**命令开始，下载并安装 Apache HTTP 服务器软件包 `apache2`。`apache2`
    软件包包括 Apache HTTP 服务器和相关的实用工具。
- en: The Apache HTTP server is started as soon as it is installed. However, if the
    Raspberry Pi has been protected with a firewall (see the *Creating a firewall*
    recipe in this chapter), the firewall will need to be configured to allow HTTP
    connections. The **ufw allow http** command adds a firewall rule that allows connections
    from other computers using the HTTP protocol.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: Apache HTTP 服务器在安装后会自动启动。然而，如果树莓派被防火墙保护（请参见本章中的*创建防火墙*部分），需要配置防火墙以允许 HTTP 连接。**ufw
    allow http** 命令添加了一个防火墙规则，允许其他计算机通过 HTTP 协议进行连接。
- en: After the firewall has been configured, a web browser on another computer is
    used to connect to the Raspberry Pi using the Raspberry Pi's IP address (`192.168.2.13`).
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 配置好防火墙后，可以通过另一台计算机上的网页浏览器使用树莓派的 IP 地址（`192.168.2.13`）连接到树莓派。
- en: The easiest way to add files from an external disk to the web server, is to
    first mount the external disk in the `/media` directory (see [Chapter 4](ch04.html
    "Chapter 4. File Sharing"), *File Sharing*) and then create a symbolic link to
    the external disk in the root directory of the web server `(/var/www`). A symbolic
    link does not copy files, it just points to where files are located.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 将外部磁盘的文件添加到Web服务器的最简单方法是，先将外部磁盘挂载到`/media`目录（请参见[第4章](ch04.html "第4章 文件共享")，*文件共享*），然后在Web服务器的根目录`(/var/www)`下创建一个指向外部磁盘的符号链接。符号链接不会复制文件，它只是指向文件所在的位置。
- en: In the example, a website directory on the external disk `(/media/bigdisk/MyWebsite`)
    is symbolically linked (**ln –s**) to the web server's root directory at `/var/www/MyWebsite`.
    The example website has only one file that is physically located on the external
    disk at `/media/bigdisk/MyWebsite/hello.html`. After the symbolic link is made,
    that file is also located symbolically at `/var/www/MyWebsite/hello.html` and
    can be reached from a web browser at the URL `http://192.168.2.13/MyWebsite/hello.html`.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，外部磁盘上的网站目录`(/media/bigdisk/MyWebsite)`通过符号链接（**ln –s**）指向Web服务器的根目录`/var/www/MyWebsite`。示例网站只有一个文件，实际位于外部磁盘`/media/bigdisk/MyWebsite/hello.html`。创建符号链接后，该文件也会象征性地位于`/var/www/MyWebsite/hello.html`，并且可以通过浏览器访问URL
    `http://192.168.2.13/MyWebsite/hello.html`。
- en: The recipe continues by creating a simple dynamic web page that displays the
    current time. The **vi** editor is used to create the file `timestamp` in the
    `/usr/lib/cgi-bin/` directory. The directory is protected so the `sudo` command
    is used as a prefix to temporarily grant the user the privilege of creating and
    editing the file.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的步骤是创建一个简单的动态网页，显示当前时间。使用**vi**编辑器在`/usr/lib/cgi-bin/`目录下创建文件`timestamp`。该目录是受保护的，因此使用`sudo`命令作为前缀，暂时授予用户创建和编辑文件的权限。
- en: 'The `timestamp` dynamic web page uses the Bash scripting language `(#!/bin/bash`).
    The web page first outputs a header describing the content of the web page as
    plain text (**echo "Content-Type: text/plain"**) followed by a blank line (`echo
    ""`) to separate the HTTP response header from the content of the web page. The
    only line of the web page displays the current time by executing the GNU `date`
    utility (`echo "$(date)"`).'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '`timestamp`动态网页使用Bash脚本语言（`#!/bin/bash`）。网页首先输出一个描述网页内容的头部，作为纯文本（**echo "Content-Type:
    text/plain"**），然后输出一个空行（`echo ""`），以将HTTP响应头与网页内容分开。网页的唯一一行通过执行GNU `date`实用程序来显示当前时间（`echo
    "$(date)"`）。'
- en: In order for the script to be called dynamically, the execution bit of the file's
    mode needs to be set with the `chmod` command `(chmod a+rx`). The file is located
    in a protected directory, so the `sudo` command is used again to temporarily grant
    privileges.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使脚本能够动态调用，需要使用`chmod`命令设置文件模式的执行位（`chmod a+rx`）。由于文件位于受保护的目录中，因此再次使用`sudo`命令，暂时授予权限。
- en: Viewing the dynamic web page (`http://192.168.2.13/cgi-bin/timestamp`) in the
    browser on another computer shows that the page is dynamic with each refresh of
    the browser.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 在另一台计算机的浏览器中查看动态网页（`http://192.168.2.13/cgi-bin/timestamp`），可以看到每次刷新浏览器时网页都会动态更新。
- en: Finally, the contents of the web server's log file directory (`/var/log/apache2/`)
    are displayed. Each request sent to the Apache HTTP web server is logged in the
    `access.log` file – one line per request. Error messages are appended to the end
    of the `error.log` file. If a dynamic web page does not display – or does not
    display properly, look at the end of the error log for a message describing the
    cause. All of the log files in this directory should be deleted (or archived)
    on a regular basis to free up disk space.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，显示了Web服务器日志文件目录（`/var/log/apache2/`）的内容。每个发送到Apache HTTP Web服务器的请求都会记录在`access.log`文件中——每个请求占一行。错误消息会附加到`error.log`文件的末尾。如果动态网页没有显示——或显示不正常，可以查看错误日志末尾的消息，了解原因。该目录下的所有日志文件应定期删除（或归档），以释放磁盘空间。
- en: There's more...
  id: totrans-270
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容…
- en: Configuration files, static content, and dynamic pages
  id: totrans-271
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置文件、静态内容和动态页面
- en: The configuration files for the server are located in the `/etc/apache` directory.
    However, there is no need to change the configuration as the default configuration
    is sufficient for serving static web pages from the `/var/www` directory and CGI-based
    dynamic web pages from the `/usr/lib/cgi-bin` directory.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器的配置文件位于`/etc/apache`目录中。然而，不需要更改配置，因为默认配置已经足够用于从`/var/www`目录提供静态网页以及从`/usr/lib/cgi-bin`目录提供基于CGI的动态网页。
- en: The directory `/var/www` is the default location of static web pages, as well
    as static content like images, fonts, video, and sounds. Any file located under
    this directory can be displayed in a web browser using the URL of the Raspberry
    Pi plus the name of the file (or path to the file). Initially, there is only one
    file in this directory, `index.html`. In the example, it has the URL `http://192.168.2.13/index.html`.
    The `/var/www` directory is protected, so use the `sudo` command to add, modify,
    or delete files in this directory.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: '`/var/www`目录是静态网页的默认位置，还包括图像、字体、视频和声音等静态内容。任何位于该目录下的文件都可以通过Raspberry Pi的URL加文件名（或文件路径）在Web浏览器中显示。最初，该目录中只有一个文件`index.html`，在示例中其URL为`http://192.168.2.13/index.html`。由于`/var/www`目录受到保护，因此需要使用`sudo`命令来添加、修改或删除该目录中的文件。'
- en: In the default Apache HTTP web server configuration, dynamic web pages use the
    Common Gate Interface (CGI) and are located in the `/usr/lib/cgi-bin` directory.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 在默认的Apache HTTP Web服务器配置中，动态网页使用公共网关接口（CGI），并位于`/usr/lib/cgi-bin`目录下。
- en: Other servers
  id: totrans-275
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 其他服务器
- en: The Apache HTTP web server is not the only web server that runs on the Raspberry
    Pi; however, it is perhaps the most famous and full-featured open source web server
    available today. Since 2009, more than 100 million websites have been hosted by
    Apache HTTP web servers. Although robust and complete, the Apache HTTP web server
    can also be resource heavy, consuming more memory and compute power than other
    servers.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: Apache HTTP Web服务器并不是唯一在Raspberry Pi上运行的Web服务器；然而，它可能是当今最著名且功能最全的开源Web服务器。从2009年以来，超过一亿个网站通过Apache
    HTTP Web服务器托管。尽管功能强大且完整，但Apache HTTP Web服务器也比较占用资源，消耗的内存和计算能力超过其他服务器。
- en: '**lighttpd**'
  id: totrans-277
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '**lighttpd**'
- en: The lighttpd web server is lighter on resources than Apache, and has the potential
    to scale to a higher number of requests per second.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: lighttpd Web服务器比Apache占用的资源更少，且具有扩展到更高请求数的潜力。
- en: Originally designed as a proof-of-concept to handle 10,000 parallel connections
    on one server, lighttpd has since become a popular web server.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: lighttpd最初设计作为一个概念验证系统，用于处理单个服务器上的10,000个并行连接，此后成为了一个流行的Web服务器。
- en: The lighttpd web server can be installed with the command `apt-get install lighttpd`.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过命令`apt-get install lighttpd`来安装lighttpd Web服务器。
- en: '[PRE31]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Although lighttpd does use `/var/www` as the root directory of the web server,
    it does not run CGI dynamic web pages by default.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管lighttpd使用`/var/www`作为Web服务器的根目录，但默认情况下并不会运行CGI动态网页。
- en: The command `lighty-enable-mod cgi` is used to enable the lighttpd CGI module.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 命令`lighty-enable-mod cgi`用于启用lighttpd的CGI模块。
- en: '[PRE32]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The preceding example shows how to use the command `lighty-enable-mod` to enable
    CGI dynamic web pages.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 上述示例展示了如何使用命令`lighty-enable-mod`来启用CGI动态网页。
- en: The lighttpd CGI module expects the `cgi-bin` directory to be located in the
    root directory of the web server instead of in the `/usr/lib` directory. The command
    `ln –s` can be used to create a symbolic link from the web server's root directory
    to the default location for dynamic web pages (`/usr/lib/cgi-bin`).
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: lighttpd CGI模块要求`cgi-bin`目录位于Web服务器的根目录下，而不是位于`/usr/lib`目录中。可以使用命令`ln –s`从Web服务器的根目录创建一个符号链接，指向动态网页的默认位置(`/usr/lib/cgi-bin`)。
- en: '[PRE33]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: The lighthttp web server's configuration files are stored in the `/etc/lighttpd`
    directory, and its log files are written to the `/var/log/lighttpd` directory.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: lighttpd Web服务器的配置文件存储在`/etc/lighttpd`目录下，日志文件则写入`/var/log/lighttpd`目录。
- en: '**Nginx**'
  id: totrans-289
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '**Nginx**'
- en: Another popular modern web server is Nginx.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个流行的现代Web服务器是Nginx。
- en: Using an event-driven approach to handling requests, Nginx can provide more
    predictable performance under high loads than the Apache web server. Nginx also
    has a number of options for deploying web applications including modular support
    for the popular web framework Ruby on Rails.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 采用事件驱动方式处理请求，Nginx在高负载下能提供比Apache Web服务器更可预测的性能。Nginx还提供了多种部署Web应用的选项，包括对流行的Web框架Ruby
    on Rails的模块化支持。
- en: The Nginx web server can be installed with the command `apt-get install nginx`.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过命令`apt-get install nginx`来安装Nginx Web服务器。
- en: '[PRE34]'
  id: totrans-293
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The Nginx web server does not by default use the same root directory as the
    Apache HTTP or lighttpd web servers; instead, static web pages are by default
    stored in the `/usr/share/ngix/www` directory. The Nginx web server also does
    not support CGI; however, the Nginx web server can also produce dynamic web pages
    using FastCGI or Ruby Passenger.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: Nginx Web服务器默认不使用与Apache HTTP或lighttpd Web服务器相同的根目录；相反，静态网页默认存储在`/usr/share/nginx/www`目录中。Nginx
    Web服务器也不支持CGI；然而，Nginx Web服务器也可以使用FastCGI或Ruby Passenger生成动态网页。
- en: The Nginx web server's configuration files are stored in the `/etc/nginx` directory,
    and its log files are written to the `/var/log/nginx` directory.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: Nginx Web服务器的配置文件存储在`/etc/nginx`目录中，其日志文件写入`/var/log/nginx`目录。
- en: In addition to Apache, lighttpd, and Nginx, the Raspberry Pi can also run a
    number of lesser-known web servers including the AOL web server, monkey, and yaws.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 除了Apache、lighttpd和Nginx，Raspberry Pi还可以运行许多较不知名的Web服务器，包括AOL Web服务器、monkey和yaws。
- en: '[PRE35]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: In the preceding example, `apt-cache search` and `grep` are used to display
    a list of available HTTP web servers. Any of the listed web servers can be installed
    by using the `apt-get install` command (for example, `apt-get install monkey`).
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，`apt-cache search`和`grep`用于显示可用的HTTP Web服务器列表。可以通过`apt-get install`命令安装任何列出的Web服务器（例如，`apt-get
    install monkey`）。
- en: See also
  id: totrans-299
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**Apache HTTP Server Project** ([http://httpd.apache.org](http://httpd.apache.org)):
    The Apache web server website is the complete reference for the web server.'
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Apache HTTP 服务器项目** ([http://httpd.apache.org](http://httpd.apache.org)):
    Apache Web服务器的官方网站是Web服务器的完整参考资料。'
- en: '**lighttpd – fly light** ([http://www.lighttpd.net/](http://www.lighttpd.net/)):
    The lighttpd website has detailed documentation for the web server.'
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**lighttpd – 轻量飞速** ([http://www.lighttpd.net/](http://www.lighttpd.net/)):
    lighttpd官网提供了Web服务器的详细文档。'
- en: '**Nginx** ([http://nginx.org/en](http://nginx.org/en)): The Nginx website has
    more information for the web server.'
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Nginx** ([http://nginx.org/en](http://nginx.org/en)): Nginx的官方网站提供了有关Web服务器的更多信息。'
- en: '**bash – GNU Bourne-Again SHell** ([http://manpages.debian.net/cgi-bin/man.cgi?query=bash](http://manpages.debian.net/cgi-bin/man.cgi?query=bash)):
    The Debian manpage for `bash` is a reference for the Bash command language.'
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**bash – GNU Bourne-Again SHell** ([http://manpages.debian.net/cgi-bin/man.cgi?query=bash](http://manpages.debian.net/cgi-bin/man.cgi?query=bash)):
    Debian的`bash`手册页面是Bash命令语言的参考资料。'
- en: '**chmod – change file mode bits** ([http://manpages.debian.net/cgi-bin/man.cgi?query=chmod](http://manpages.debian.net/cgi-bin/man.cgi?query=chmod)):
    The Debian manpage for `chmod` details the command and its options.'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**chmod – 更改文件模式位** ([http://manpages.debian.net/cgi-bin/man.cgi?query=chmod](http://manpages.debian.net/cgi-bin/man.cgi?query=chmod)):
    Debian的`chmod`手册页面详细介绍了该命令及其选项。'
- en: '**date – print or set the system date and time** ([http://manpages.debian.net/cgi-bin/man.cgi?query=date](http://manpages.debian.net/cgi-bin/man.cgi?query=date)):
    The Debian manpage for `date` details the command and its options.'
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**date – 打印或设置系统日期和时间** ([http://manpages.debian.net/cgi-bin/man.cgi?query=date](http://manpages.debian.net/cgi-bin/man.cgi?query=date)):
    Debian的`date`手册页面详细介绍了该命令及其选项。'
- en: '**grep – print lines matching a pattern** ([http://manpages.debian.net/cgi-bin/man.cgi?query=grep](http://manpages.debian.net/cgi-bin/man.cgi?query=grep)):
    The Debian manpage for `grep` details the command and its options.'
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**grep – 打印匹配模式的行** ([http://manpages.debian.net/cgi-bin/man.cgi?query=grep](http://manpages.debian.net/cgi-bin/man.cgi?query=grep)):
    Debian的`grep`手册页面详细介绍了该命令及其选项。'
- en: '**ln -s – make links between files** ([http://manpages.debian.net/cgi-bin/man.cgi?query=ln](http://manpages.debian.net/cgi-bin/man.cgi?query=ln)):
    The Debian manpage for `ln -s` details the command and its options.'
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ln -s – 创建文件间的链接** ([http://manpages.debian.net/cgi-bin/man.cgi?query=ln](http://manpages.debian.net/cgi-bin/man.cgi?query=ln)):
    Debian的`ln -s`手册页面详细介绍了该命令及其选项。'
- en: '**AOL web server** ([http://www.aolserver.com](http://www.aolserver.com)):
    The AOL web server website.'
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AOL Web服务器** ([http://www.aolserver.com](http://www.aolserver.com)): AOL
    Web服务器的官方网站。'
- en: Installing a wiki (mediawiki)
  id: totrans-309
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装Wiki（mediawiki）
- en: This recipe installs and sets up the same wiki used by Wikipedia (MediaWiki).
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 本文档安装并设置与维基百科相同的Wiki系统（MediaWiki）。
- en: Wikis are useful collaborative environments for teams that share a continuously
    evolving set of documentation. Each team member can contribute to the creation
    and editing of pages within the wiki. The resulting pages of documentation stored
    in the wiki are the result of a group effort and reflect the team's combined knowledge.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: Wiki是一个有用的协作环境，适用于共享不断发展的文档集的团队。每个团队成员都可以参与创建和编辑Wiki中的页面。存储在Wiki中的最终文档页面是团队共同努力的结果，反映了团队的集体知识。
- en: This recipe is used to install the MediaWiki. This is the same wiki software
    used by Wikipedia. The Wikipedia website is hosted by a cluster of high-powered
    servers so that it can continuously serve millions of users. This recipe uses
    a single Raspberry Pi that has more than enough power to manage a wiki for a team
    or small office of collaborators.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方用于安装MediaWiki。这是维基百科使用的相同的wiki软件。维基百科网站由一群高性能服务器托管，以便能够不断为数百万用户提供服务。本配方使用的是单台树莓派，它完全有能力管理一个团队或小型办公室的wiki。
- en: After completing this recipe, you will have a wiki that is ready for collaboration.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此步骤后，你将拥有一个准备好协作的wiki。
- en: Getting ready
  id: totrans-314
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 材料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 已启动的树莓派的初始设置或基本网络设置。你还需要以`pi`用户身份登录（有关如何启动和登录，请参阅[第1章](ch01.html "第1章 安装与设置")，*安装与设置*，以及有关如何远程登录的说明，请参阅[第2章](ch02.html
    "第2章 管理")，*管理*）。
- en: This recipe does not require the desktop GUI and could either be run from the
    text-based console or from within an `LXTerminal`.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方不需要桌面GUI，可以从基于文本的控制台或`LXTerminal`中运行。
- en: If the Raspberry Pi's Secure Shell server is running, this recipe can be completed
    remotely using a Secure Shell client.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 如果树莓派的安全外壳服务器正在运行，可以使用安全外壳客户端远程完成此步骤。
- en: Once installed, the MediaWiki is accessed and configured from a web browser.
    Configuration does not need to be completed on the Raspberry Pi; it can be completed
    remotely from another computer on the same network as the Raspberry Pi.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，可以通过Web浏览器访问并配置MediaWiki。配置不需要在树莓派上完成；可以通过与树莓派在同一网络中的其他计算机远程完成。
- en: For better performance, the video memory of the Raspberry Pi should be set as
    low as possible, so that there is more memory available for MediaWiki (see the
    recipe Configuring memory usage in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for more information).
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 为了获得更好的性能，应将树莓派的视频内存设置为最低，以便有更多内存可用于MediaWiki（有关更多信息，请参阅[第2章](ch02.html "第2章
    管理")，*管理*中的配置内存使用配方）。
- en: How to do it...
  id: totrans-321
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The steps for installing the MediaWiki wiki server are:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 安装MediaWiki wiki服务器的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely.
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录到树莓派。
- en: Use the `apt-get install` command to install the `mediawiki` software package.
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`apt-get install`命令安装`mediawiki`软件包。
- en: '[PRE36]'
  id: totrans-325
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: The `apt-get` `install` command downloads and installs MediaWiki.
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install`命令下载并安装MediaWiki。'
- en: Note
  id: totrans-327
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The installation of `mediawiki` includes `apache2`, `mysql`, and `php5`.
  id: totrans-328
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`mediawiki`的安装包括`apache2`、`mysql`和`php5`。'
- en: The complete installation time will be at least 15 to 30 minutes.
  id: totrans-329
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 完整的安装时间将至少需要15至30分钟。
- en: During install, the `mysql` package will prompt for a new root password that
    should be used when managing the database. Enter a root password and repeat it
    on the next screen.![How to do it...](img/B04745_05_11.jpg)
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装过程中，`mysql`软件包会提示输入一个新的root密码，用于管理数据库。输入root密码并在下一个屏幕上重复输入该密码。![如何操作...](img/B04745_05_11.jpg)
- en: After accepting the root password for the `mysql` database (twice), the installation
    of `mediawiki` completes.
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在接受`mysql`数据库的root密码（两次输入）后，`mediawiki`的安装完成。
- en: Use the vi editor to edit the MediaWiki website configuration file `(/etc/mediawiki/apache.conf`).
  id: totrans-332
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用vi编辑器编辑MediaWiki网站的配置文件`(/etc/mediawiki/apache.conf)`。
- en: '[PRE37]'
  id: totrans-333
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The `vi` editor displays the contents of the configuration file. Instructions
    for using the editor can be found in the `vi` manpages (see the recipe *Reading
    the built-in documentation* in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration*).
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi`编辑器显示配置文件的内容。有关如何使用该编辑器的说明，请参阅`vi`的man手册（有关更多信息，请参阅[第2章](ch02.html "第2章
    管理")，*管理*中的*阅读内建文档*配方）。'
- en: '[PRE38]'
  id: totrans-335
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Uncomment the `Alias` for the MediaWiki website by removing the `#` from the
    beginning of the line.
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过删除行首的`#`来取消注释MediaWiki网站的`Alias`。
- en: '[PRE39]'
  id: totrans-337
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Save and close the file (`:wq`).
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并关闭文件（`:wq`）。
- en: Use the `apachectl restart` command to restart the web server.
  id: totrans-339
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`apachectl restart`命令重新启动Web服务器。
- en: '[PRE40]'
  id: totrans-340
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Once the Apache web server has restarted, the configuration of MediaWiki continues
    in the web browser.
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Apache web服务器重新启动后，在web浏览器中继续配置MediaWiki。
- en: Open a web browser (possibly on another computer) and browse to the URL of the
    MediaWiki, (`http://192.168.2.13/mediawiki/`).
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开一个web浏览器（可能在另一台计算机上），浏览到MediaWiki的URL（`http://192.168.2.13/mediawiki/`）。
- en: Note
  id: totrans-343
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The IP address (`192.168.2.13`) of your Raspberry Pi will be different. The
    `hostname -I` command can be used to display the IP address of the Raspberry Pi
    – see the *Remote access* recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for an example of using the `hostname -I` command.
  id: totrans-344
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Raspberry Pi的IP地址（`192.168.2.13`）将会不同。可以使用`hostname -I`命令显示Raspberry Pi的IP地址——参见[第2章](ch02.html
    "第2章。管理")中*远程访问*部分，以`hostname -I`命令的示例。
- en: '![How to do it...](img/B04745_05_12.jpg)'
  id: totrans-345
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![操作方法...](img/B04745_05_12.jpg)'
- en: The MediaWiki initial configuration page is displayed in the browser. Click
    the set up the wiki link to continue.![How to do it...](img/B04745_05_13.jpg)
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在浏览器中显示MediaWiki的初始配置页面。点击设置wiki链接以继续。![操作方法...](img/B04745_05_13.jpg)
- en: Choose the language to be used by MediaWiki. Click **Continue ->** for the next
    configuration page.
  id: totrans-347
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择MediaWiki要使用的语言。点击**继续 ->**进入下一个配置页面。
- en: Once the language has been set, MediaWiki runs a number of tests to determine
    if (and how) it can be set up on the Raspberry Pi.![How to do it...](img/B04745_05_14.jpg)
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 语言设置完成后，MediaWiki会运行一些测试，以确定是否（以及如何）可以在Raspberry Pi上设置。![操作方法...](img/B04745_05_14.jpg)
- en: The preceding image shows a web page verifying that the Raspberry Pi is ready
    for MediaWiki.
  id: totrans-349
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上图显示了验证Raspberry Pi准备好安装MediaWiki的网页。
- en: The message "**The environment has been checked. You can install MediaWiki**`.`"
    indicates MediaWiki is ready to be installed. (If you do not see this green message,
    click **Restart installation**.)
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 消息“**环境已检查。您可以安装MediaWiki**`.`”表明MediaWiki已准备安装。（如果您未看到此绿色消息，请点击**重新启动安装**。）
- en: Scroll to the bottom of the page. Click **Continue ->** to accept the license
    and continue the installation.![How to do it...](img/B04745_05_15.jpg)
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 滚动到页面底部。点击**继续 ->**接受许可证并继续安装。![操作方法...](img/B04745_05_15.jpg)
- en: The screenshot shows the copyright agreement that must be accepted to continue.
  id: totrans-352
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 截图显示了必须接受的版权协议。
- en: Once the license agreement has been accepted, configuration continues with the
    MySQL settings.
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受许可协议后，继续进行MySQL设置。
- en: Enter the password for the MySQL root user from Step 4.
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入第4步中MySQL根用户的密码。
- en: After the database name and root password for MySQL have been entered, configuration
    continues with some additional database settings for web access.
  id: totrans-355
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入数据库名称和MySQL根密码后，继续配置一些额外的数据库设置以进行web访问。
- en: Accept the defaults by clicking **Continue ->**.![How to do it...](img/B04745_05_16.jpg)
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**继续 ->**接受默认设置。![操作方法...](img/B04745_05_16.jpg)
- en: The preceding screenshot shows how the MySQL database settings are entered.
  id: totrans-357
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上述截图显示了如何输入MySQL数据库设置。
- en: '![How to do it...](img/B04745_05_17.jpg)'
  id: totrans-358
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![操作方法...](img/B04745_05_17.jpg)'
- en: The preceding screenshot accepts the default database settings.
  id: totrans-359
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上述截图接受了默认的数据库设置。
- en: After the default database settings have been accepted, configuration continues
    by entering the name of the wiki and the username and password for the Administrator
    Account.
  id: totrans-360
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受默认的数据库设置后，继续配置，输入wiki的名称以及管理员账户的用户名和密码。
- en: Enter a Name for the wiki. Enter a username and password for the MediaWiki Administrator
    Account. Click **Continue ->**.![How to do it...](img/B04745_05_18.jpg)
  id: totrans-361
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为wiki输入一个名称。输入MediaWiki管理员账户的用户名和密码。点击**继续 ->**。![操作方法...](img/B04745_05_18.jpg)
- en: The preceding screenshot shows the web page used to enter the Name of the wiki
    and the username and password for the Administrator Account.
  id: totrans-362
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上述截图显示了用于输入wiki名称以及管理员账户的用户名和密码的网页。
- en: After the wiki Name and the MediaWiki Administrator username and password have
    been entered, scroll to the bottom of the page.
  id: totrans-363
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入wiki名称和MediaWiki管理员用户名和密码后，滚动到页面底部。
- en: Choose **I'm bored already, just install the wiki**`.` and click **Continue
    ->**.![How to do it...](img/B04745_05_19.jpg)
  id: totrans-364
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**我已经厌倦了，直接安装wiki**`.` 并点击**继续 ->**。![操作方法...](img/B04745_05_19.jpg)
- en: The screenshot shows how to skip the optional configuration settings.
  id: totrans-365
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 截图显示了如何跳过可选的配置设置。
- en: MediaWiki uses the supplied configuration parameters to set up the database
    displaying a web page listing the completed installation steps.
  id: totrans-366
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: MediaWiki 使用提供的配置参数来设置数据库，并显示一个列出已完成安装步骤的网页。
- en: Click **Continue ->**. This step requires time to set up the database.![How
    to do it...](img/B04745_05_20.jpg)
  id: totrans-367
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **继续 ->**。此步骤需要一些时间来设置数据库。![如何操作...](img/B04745_05_20.jpg)
- en: This screenshot shows the list of completed installation steps.
  id: totrans-368
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此截图显示了已完成安装步骤的列表。
- en: After the displayed installation list has been accepted, a congratulation page
    is displayed saying that the installation is complete. However, the `LocalSettings.php`
    file still needs to be downloaded and installed.
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受显示的安装列表后，会显示一个祝贺页面，表示安装已完成。然而，`LocalSettings.php` 文件仍然需要下载和安装。
- en: Download the `LocalSettings.php` file.
  id: totrans-370
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下载 `LocalSettings.php` 文件。
- en: '![How to do it...](img/B04745_05_21.jpg)'
  id: totrans-371
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/B04745_05_21.jpg)'
- en: The screenshot shows the configuration file, **LocalSettings.php**, is complete.
  id: totrans-372
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 截图显示了配置文件 **LocalSettings.php** 已完成。
- en: Once the `LocalSettings.php` file has been downloaded, it needs to be moved
    to the root of the MediaWiki installation.
  id: totrans-373
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦下载了 `LocalSettings.php` 文件，它需要被移动到 MediaWiki 安装目录的根目录。
- en: Note
  id: totrans-374
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If the browser used for configuration was on another computer, the `LocalSettings.php`
    file will need to be copied to the Raspberry Pi.
  id: totrans-375
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果用于配置的浏览器在另一台计算机上，则需要将 `LocalSettings.php` 文件复制到 Raspberry Pi 上。
- en: '[PRE41]'
  id: totrans-376
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: In the preceding example, the `LocalSettings.php` file is copied from another
    computer (`golden-macbook`) to the MediaWiki directory `(/var/lib/mediawiki/`)
    on the Raspberry Pi and the file permissions are changed (`chmod a+r`) so that
    the MediaWiki can read the settings file.
  id: totrans-377
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在上面的例子中，`LocalSettings.php` 文件是从另一台计算机（`golden-macbook`）复制到 Raspberry Pi 上的
    MediaWiki 目录（`/var/lib/mediawiki/`）的，并且修改了文件权限（`chmod a+r`），以便 MediaWiki 可以读取该设置文件。
- en: After the `LocalSettings.php` file has been moved to the root of the MediaWiki
    installation, the MediaWiki is ready to use!
  id: totrans-378
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦 `LocalSettings.php` 文件被移动到 MediaWiki 安装的根目录，MediaWiki 就可以开始使用了！
- en: 'Browse to the MediaWiki URL on the Raspberry Pi: (`http://192.168.2.2/mediawiki/`)![How
    to do it...](img/B04745_05_22.jpg)'
  id: totrans-379
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览到 Raspberry Pi 上的 MediaWiki URL：（`http://192.168.2.2/mediawiki/`）![如何操作...](img/B04745_05_22.jpg)
- en: The MediaWiki is set up and running; however, it still needs to be customized
    for your team (by adding a custom team logo, fonts, and styles). Follow the `User's
    Guide` link for more information on customizing your installation and detailed
    instructions on how to use the MediaWiki.
  id: totrans-380
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: MediaWiki 已设置并运行；但是，它仍然需要根据您的团队进行定制（通过添加自定义团队徽标、字体和样式）。请按照 `用户指南` 链接获取有关自定义安装的更多信息，以及如何使用
    MediaWiki 的详细说明。
- en: How it works...
  id: totrans-381
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: At the beginning of this recipe, the MediaWiki software distribution package
    (`mediawiki`) is downloaded and installed using `apt-get install`. The MediaWiki
    installation includes the installation of Apache2, MySQL, and PHP5\. Each of these
    packages can also be installed separately to provide a web server (Apache2), a
    database (MySQL), or a web scripting language (PHP5).
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程的开始，MediaWiki 软件包（`mediawiki`）是通过 `apt-get install` 命令下载并安装的。MediaWiki 的安装包括
    Apache2、MySQL 和 PHP5 的安装。这些包也可以单独安装，用于提供 Web 服务器（Apache2）、数据库（MySQL）或 Web 脚本语言（PHP5）。
- en: The MediaWiki installation begins by installing Apache2, MySQL, and PHP5\. Neither
    the Apache2 installation nor the PHP5 installation requires any user input to
    complete successfully. However, the MySQL installation requires a password for
    the `root` user of the database.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: MediaWiki 的安装首先安装 Apache2、MySQL 和 PHP5。Apache2 安装和 PHP5 安装都不需要用户输入即可顺利完成。然而，MySQL
    安装需要为数据库的 `root` 用户设置密码。
- en: The MySQL administrative `root` password is for the setup and configuration
    of the MySQL database management server. It is not the same password used by the
    user `pi`. The security of the Raspberry Pi is improved, if the password for the
    user pi and the password for the database are different.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 管理员 `root` 密码用于设置和配置 MySQL 数据库管理服务器。它与用户 `pi` 使用的密码不同。如果用户 pi 和数据库的密码不同，将提升
    Raspberry Pi 的安全性。
- en: After the MySQL `root` password has been entered, the installation continues.
    The MySQL database is installed. The MediaWiki application files are installed.
    The Apache2 web server is installed and started. However, the Apache2 web server
    is not yet configured to host the MediaWiki.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 在输入 MySQL `root` 密码后，安装过程继续。MySQL 数据库被安装，MediaWiki 应用程序文件被安装，Apache2 Web 服务器被安装并启动。然而，Apache2
    Web 服务器尚未配置为托管 MediaWiki。
- en: The `vi` editor is used to edit the `apache.conf` configuration file and assign
    the MediaWiki a website. The configuration file is located in the MediaWiki configuration
    directory, `/etc/mediawiki/`, and is also linked to the web server configuration
    directory, `/etc/apache2/conf.d/`.
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `vi` 编辑器编辑 `apache.conf` 配置文件并为 MediaWiki 分配一个网站。配置文件位于 MediaWiki 配置目录 `/etc/mediawiki/`，并且也链接到
    web 服务器配置目录 `/etc/apache2/conf.d/`。
- en: The only line that needs to be changed in the Apache2 configuration file is
    the line that begins `#Alias`. The `#` at the beginning of the line turns the
    line into a comment. Comment lines are ignored when the Apache web server reads
    the configuration file. Removing the `#` from the beginning of the line will activate
    the MediaWiki the next time the web server is started.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 需要在 Apache2 配置文件中更改的唯一一行是以 `#Alias` 开头的那一行。行首的 `#` 将该行变成注释。Apache web 服务器在读取配置文件时会忽略注释行。删除行首的
    `#` 将激活 MediaWiki，下次启动 web 服务器时会生效。
- en: 'The Alias statement has two parameters: the website''s URL prefix `(/mediawiki`)
    and the location of the website''s application files `(/var/lib/mediawiki`). The
    URL prefix becomes part of the wiki''s URL (`http://192.168.2.13/mediawiki/`).
    Changing the URL prefix would also change the URL used to access the wiki. Changing
    the prefix to `/TeamWiki` would change the wiki''s URL to `http://192.168.2.2/TeamWiki/`.'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: Alias 语句有两个参数：网站的 URL 前缀 `(/mediawiki)` 和网站应用程序文件的位置 `(/var/lib/mediawiki)`。URL
    前缀成为维基的 URL 一部分（`http://192.168.2.13/mediawiki/`）。更改 URL 前缀也会改变访问维基所使用的 URL。将前缀更改为
    `/TeamWiki` 会将维基的 URL 改为 `http://192.168.2.2/TeamWiki/`。
- en: After the web server configuration file has been edited and the Alias line has
    been uncommented, the Apache web server is restarted with the `apachectl restart`
    command. This privileged command is used to restart the Apache web server.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 在编辑完 web 服务器配置文件并取消注释 Alias 行后，使用 `apachectl restart` 命令重启 Apache web 服务器。此特权命令用于重启
    Apache web 服务器。
- en: Restarting the web server forces it to reload its configuration files, including
    the MediaWiki's web server configuration file. Now that MediaWiki's alias has
    been uncommented, the MediaWiki website is available; however, the wiki's database
    still needs to be set up.
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 重启 web 服务器会强制它重新加载配置文件，包括 MediaWiki 的 web 服务器配置文件。现在 MediaWiki 的别名已经取消注释，MediaWiki
    网站已可用；然而，维基的数据库仍需设置。
- en: Once the MediaWiki website is running, a web browser (possibly on another computer)
    can be used to complete the wiki's database setup. The example URL is `http://192.168.2.13/mediawiki/`.
    The IP address of your Raspberry Pi will most likely be different.
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦 MediaWiki 网站运行，可以使用 web 浏览器（可能是在另一台计算机上）来完成维基的数据库设置。示例 URL 为 `http://192.168.2.13/mediawiki/`。你的
    Raspberry Pi 的 IP 地址很可能不同。
- en: The first page displayed by the MediaWiki says the `LocalSettings.php` file
    cannot be found. The link labeled **setup the wiki** leads to the web pages that
    are used to complete the setup of the wiki.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: MediaWiki 显示的第一页面提示找不到 `LocalSettings.php` 文件。标有 **setup the wiki** 的链接指向用于完成维基设置的网页。
- en: The first setup page is used to define the language used by the wiki administrator
    (**Your language**) and the language used by other wiki users (**Wiki language**).
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 第一设置页面用于定义维基管理员使用的语言（**Your language**）和其他维基用户使用的语言（**Wiki language**）。
- en: The next setup page shows the results of a system configuration examination
    and a license that must be accepted to complete the installation of MediaWiki.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 下一页的设置页面显示了系统配置检查的结果，并且必须接受一个许可证才能完成 MediaWiki 的安装。
- en: Then, the database settings are entered on the next page. The password entered
    earlier for the MySQL administrative `root` user should be entered here.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在下一页面输入数据库设置。之前为 MySQL 管理员 `root` 用户输入的密码应在此处再次输入。
- en: Some additional database settings appear on the next page. Accept the defaults.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 下一页显示了一些额外的数据库设置。接受默认设置即可。
- en: Finally, there is a setup page that asks for the wiki name and a username and
    password for the MediaWiki administrator. This new password is only used for configuring
    the wiki and is neither the MySQL administrative `root` password nor the password
    of the user `pi`.
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 最后有一个设置页面，要求输入维基名称以及 MediaWiki 管理员的用户名和密码。这个新密码仅用于配置维基，而不是 MySQL 管理员的 `root`
    密码，也不是用户 `pi` 的密码。
- en: At the bottom of the page is an opportunity to enter more configuration data.
    The example in the recipe chose **I'm bored already, just install the wiki.**
    and clicked **Continue ->** to complete the database installation.
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 页面底部有一个输入更多配置信息的机会。食谱中的示例选择了**我已经无聊了，直接安装Wiki吧。** 并点击**继续 ->** 完成数据库安装。
- en: After a status page is displayed, the last page of the setup triggers the download
    of the `LocalSettings.php` file, which is used to complete the installation of
    the wiki. If the file was downloaded on another computer, the `scp` command can
    be used to copy the file to the Raspberry Pi as shown in the example.
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 在显示状态页面后，设置的最后一页会触发`LocalSettings.php`文件的下载，该文件用于完成Wiki的安装。如果该文件是在另一台计算机上下载的，可以使用`scp`命令将文件复制到树莓派，具体示例如下。
- en: The `LocalSettings.php` file is a summary of the configuration parameters that
    were entered into the MediaWiki's setup pages. This file needs to be moved to
    the MediaWiki installation directory (`/var/lib/mediawiki/`) to complete the setup
    of the wiki.
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: '`LocalSettings.php` 文件是输入到MediaWiki安装页面的配置参数的总结。此文件需要移动到MediaWiki安装目录（`/var/lib/mediawiki/`）以完成Wiki的设置。'
- en: After the `LocalSettings.php` file has been moved to the MediaWiki installation
    directory, setup is complete and the MediaWiki **Main Page** is now displayed
    at the configured URL (`http://192.168.2.13/mediawiki/`). The wiki is up and running!
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 在将`LocalSettings.php`文件移动到MediaWiki安装目录后，设置完成，MediaWiki的**主页**现已显示在配置的URL（`http://192.168.2.13/mediawiki/`）上。Wiki已启动并运行！
- en: Click the **[edit]** link to change the content of the **Main Page**.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**[编辑]**链接以更改**主页**的内容。
- en: Some customization could still be done to personalize the wiki (for example,
    change the wiki logo); however, the general setup is complete and the wiki can
    now be used for collaboration.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 仍可以进行一些定制化以个性化Wiki（例如，改变Wiki的Logo）；不过，基本的设置已完成，Wiki现在可以用于协作。
- en: More information on using and customizing MediaWiki can be found by following
    the **User's Guide** link on the **Main Page** of the wiki.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 更多关于使用和定制MediaWiki的信息，可以通过点击Wiki**主页**上的**用户指南**链接来找到。
- en: See also
  id: totrans-405
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**MediaWiki** ([http://en.wikipedia.org/wiki/Mediawiki](http://en.wikipedia.org/wiki/Mediawiki)):
    This Wikipedia article is about the MediaWiki wiki server.'
  id: totrans-406
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**MediaWiki** ([http://en.wikipedia.org/wiki/Mediawiki](http://en.wikipedia.org/wiki/Mediawiki)):
    这篇维基百科文章介绍了MediaWiki wiki服务器。'
- en: '**apachectl – Apache HTTP server control interface** ([http://manpages.debian.net/cgi-bin/man.cgi?query=apachectl](http://manpages.debian.net/cgi-bin/man.cgi?query=apachectl)):
    The Debian manpage for `apachectl` has more about the command and its options.'
  id: totrans-407
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**apachectl – Apache HTTP服务器控制接口** ([http://manpages.debian.net/cgi-bin/man.cgi?query=apachectl](http://manpages.debian.net/cgi-bin/man.cgi?query=apachectl)):
    Debian的`apachectl`手册页提供了有关该命令及其选项的更多信息。'
- en: '**scp – secure copy (remote file copy program)** ([http://manpages.debian.net/cgi-bin/man.cgi?query=scp](http://manpages.debian.net/cgi-bin/man.cgi?query=scp)):
    The Debian manpage for `scp` has more details about the command and its options.'
  id: totrans-408
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**scp – 安全复制（远程文件复制程序）** ([http://manpages.debian.net/cgi-bin/man.cgi?query=scp](http://manpages.debian.net/cgi-bin/man.cgi?query=scp)):
    Debian的`scp`手册页提供了有关该命令及其选项的更多详细信息。'
- en: '**mv – move (rename) files** ([http://manpages.debian.net/cgi-bin/man.cgi?query=mv](http://manpages.debian.net/cgi-bin/man.cgi?query=mv)):
    The Debian manpage for `mv` has more details about the command and its options.'
  id: totrans-409
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**mv – 移动（重命名）文件** ([http://manpages.debian.net/cgi-bin/man.cgi?query=mv](http://manpages.debian.net/cgi-bin/man.cgi?query=mv)):
    Debian的`mv`手册页提供了有关该命令及其选项的更多详细信息。'
- en: '**chmod – change file mode bits** ([http://manpages.debian.net/cgi-bin/man.cgi?query=chmod](http://manpages.debian.net/cgi-bin/man.cgi?query=chmod)):
    The Debian manpage for `chmod` has more details about the command and its options.'
  id: totrans-410
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**chmod – 更改文件模式位** ([http://manpages.debian.net/cgi-bin/man.cgi?query=chmod](http://manpages.debian.net/cgi-bin/man.cgi?query=chmod)):
    Debian的`chmod`手册页提供了有关该命令及其选项的更多详细信息。'
- en: Creating a wireless access point with hostapd
  id: totrans-411
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用hostapd创建无线接入点
- en: This recipe sets up the Raspberry Pi as a wireless access point – as a hub that
    other wireless devices can use to connect to the local network – or to services
    that are running on the Raspberry Pi.
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 这个食谱将树莓派设置为无线接入点——作为一个可以让其他无线设备连接到本地网络的集线器——或者连接到树莓派上运行的服务。
- en: Out of the box, the Raspbian Linux distribution supports connecting the Raspberry
    Pi to an existing wireless network using a wireless USB adapter. This recipe goes
    beyond using the Raspberry Pi as a network client and instead configures the Raspberry
    Pi as a network hub for other wireless devices. If the Raspberry Pi is also connected
    to a local network via a TCP cable, the Raspberry Pi acts as wireless network
    router enabling other devices to connect to the local network through the Raspberry
    Pi.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Raspbian Linux 发行版支持通过无线 USB 适配器将 Raspberry Pi 连接到现有无线网络。本食谱超出了将 Raspberry
    Pi 作为网络客户端使用的范围，改为将 Raspberry Pi 配置为其他无线设备的网络中心。如果 Raspberry Pi 还通过 TCP 电缆连接到本地网络，则
    Raspberry Pi 将充当无线网络路由器，使其他设备能够通过 Raspberry Pi 连接到本地网络。
- en: Note
  id: totrans-414
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Not all wireless USB adapters support Access Point (AP) mode.
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有无线 USB 适配器都支持接入点（AP）模式。
- en: The recipe will test the wireless adapter to ensure that it supports AP mode.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱将测试无线适配器以确保其支持 AP 模式。
- en: After completing this recipe, you will be able to create a wireless network
    with the Raspberry Pi acting as a network hub.
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本食谱后，您将能够创建一个无线网络，使 Raspberry Pi 充当网络中心。
- en: Getting ready
  id: totrans-418
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 配料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个初步设置或基本网络配置的食谱，要求 Raspberry Pi 已经开机，并且您已经以 `pi` 用户身份登录（有关如何启动和登录，请参考 [第1章](ch01.html
    "第1章 安装与设置")，*安装与设置* 中的食谱；有关如何远程登录，请参考 [第2章](ch02.html "第2章 管理")，*管理* 中的食谱）。
- en: A supported wireless USB adapter.
  id: totrans-421
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个支持的无线 USB 适配器。
- en: This recipe does not require the desktop GUI and could either be run from the
    text-based console or from within an `LXTerminal`.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱不需要桌面 GUI，可以从文本控制台运行，或在 `LXTerminal` 内运行。
- en: If the Raspberry Pi's Secure Shell server is running and the Raspberry Pi is
    connected to the local network via a wired network connection, this recipe can
    be completed remotely using a Secure Shell client.
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 Raspberry Pi 的 Secure Shell 服务器正在运行，并且 Raspberry Pi 已通过有线网络连接到本地网络，则可以使用
    Secure Shell 客户端远程完成此食谱。
- en: The wireless connection will be reset during this recipe, so it is not recommended
    to log in remotely over a wireless connection during setup.
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: 在此食谱过程中，无线连接将被重置，因此不建议在设置期间通过无线连接远程登录。
- en: How to do it...
  id: totrans-425
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The steps for configuring the Raspberry Pi as a wireless access point are:'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 Raspberry Pi 作为无线接入点的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely.
  id: totrans-427
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录 Raspberry Pi。
- en: Use the `apt-get install` command to install the software packages `hostapd`,
    `udhcpd`, and `iw`.
  id: totrans-428
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `apt-get install` 命令安装软件包 `hostapd`、`udhcpd` 和 `iw`。
- en: '[PRE42]'
  id: totrans-429
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The `apt-get install` command downloads and installs the software packages `hostapd`,
    `udhcpd`, and `iw`.
  id: totrans-430
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install` 命令将下载并安装软件包 `hostapd`、`udhcpd` 和 `iw`。'
- en: Check the wireless USB adapter.
  id: totrans-431
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查无线 USB 适配器。
- en: Note
  id: totrans-432
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Check your wireless USB adapter for AP mode with this command:'
  id: totrans-433
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用以下命令检查您的无线 USB 适配器是否支持 AP 模式：
- en: '`sudo iw list | grep ''* AP''`'
  id: totrans-434
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`sudo iw list | grep ''* AP''`'
- en: If no lines are returned, the wireless adapter does not have AP mode.
  id: totrans-435
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果没有返回任何行，则表示无线适配器不支持 AP 模式。
- en: Use the `iw list` command (filtered with `grep`) to see if the wireless adapter
    supports Access Point (AP) mode.
  id: totrans-436
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `iw list` 命令（通过 `grep` 过滤）查看无线适配器是否支持接入点（AP）模式。
- en: '[PRE43]'
  id: totrans-437
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Display the nameserver address.
  id: totrans-438
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示名称服务器地址。
- en: Use the `cat` command to display the nameserver address stored in `/etc/resolve.conf`.
  id: totrans-439
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `cat` 命令显示存储在 `/etc/resolve.conf` 中的名称服务器地址。
- en: '[PRE44]'
  id: totrans-440
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: The DNS `nameserver` used by the Raspberry Pi is **192.168.2.1**.
  id: totrans-441
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Raspberry Pi 使用的 DNS `nameserver` 是 **192.168.2.1**。
- en: Configure the `udhcpd` server.
  id: totrans-442
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置 `udhcpd` 服务器。
- en: Use the `vi` editor to edit the `udhcpd` configuration file `/etc/udhcpd.conf`.
  id: totrans-443
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `vi` 编辑器编辑 `udhcpd` 配置文件 `/etc/udhcpd.conf`。
- en: '[PRE45]'
  id: totrans-444
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: The `vi` editor displays the contents of the configuration file. Instructions
    for using the editor can be found in the `vi` manpages (see the recipe *Reading
    the built-in documentation* in [Chapter 2](ch02.html "Chapter 2. Administration"),*Administration*).
  id: totrans-445
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器显示配置文件的内容。有关如何使用编辑器的说明，可以在 `vi` 手册页中找到（请参见 [第2章](ch02.html "第2章 管理")，*管理*
    中的食谱 *阅读内建文档*）。'
- en: '[PRE46]'
  id: totrans-446
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Change the network interface used by `udhcpd` by changing the line beginning
    with `interface` to read `interface wlan0`.
  id: totrans-447
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过将以 `interface` 开头的行更改为 `interface wlan0` 来更改 `udhcpd` 使用的网络接口。
- en: '[PRE47]'
  id: totrans-448
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: Change the example configuration of `udhcpd` by changing the section beginning
    with `#Examples` at the bottom of the file. Replace the example DNS address with
    the `nameserver` address used by your Raspberry Pi (`192.168.2.1,` from Step 5).
  id: totrans-449
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过更改以 `#Examples` 开头的部分来修改 `udhcpd` 的示例配置，替换示例 DNS 地址为你的 Raspberry Pi 使用的 `nameserver`
    地址（`192.168.2.1`，来自第 5 步）。
- en: '[PRE48]'
  id: totrans-450
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: Save the file and exit the editor (`:wq`).
  id: totrans-451
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Enable the udhcpd server.
  id: totrans-452
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用 udhcpd 服务器。
- en: '[PRE49]'
  id: totrans-453
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Use the `vi` editor to edit the `udhcpd` configuration file, `/etc/default/udhcpd`.
  id: totrans-454
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `vi` 编辑器编辑 `udhcpd` 配置文件，`/etc/default/udhcpd`。
- en: The `vi` editor displays the contents of the configuration file.
  id: totrans-455
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器显示配置文件的内容。'
- en: '[PRE50]'
  id: totrans-456
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Enable the udhcpd server by commenting out the line `DHCP_ENABLED="no"`. To
    comment out the line, place a `#` at the beginning of the line.
  id: totrans-457
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过注释掉行 `DHCP_ENABLED="no"` 来启用 udhcpd 服务器。要注释掉该行，请在行首添加 `#`。
- en: '[PRE51]'
  id: totrans-458
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Save the file and exit the editor (`:wq`).
  id: totrans-459
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Configure the hostapd server. Use the `vi` editor to create a new `hostapd`
    configuration file, `/etc/hostapd/hostapd.conf`.
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置 hostapd 服务器。使用 `vi` 编辑器创建新的 `hostapd` 配置文件（`/etc/hostapd/hostapd.conf`）。
- en: '[PRE52]'
  id: totrans-461
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The `vi` editor displays the empty configuration file.
  id: totrans-462
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器显示空的配置文件。'
- en: 'Add the following parameters to the hostapd configuration file:'
  id: totrans-463
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下参数添加到 hostapd 配置文件中：
- en: '[PRE53]'
  id: totrans-464
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: Save the file and exit the editor (`:wq`).
  id: totrans-465
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Enable the hostapd server. Use the `vi` editor to enable the `hostapd` service
    by editing the service default file (`/etc/default/hostapd`).
  id: totrans-466
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用 hostapd 服务器。使用 `vi` 编辑器编辑服务默认文件（`/etc/default/hostapd`）来启用 `hostapd` 服务。
- en: '[PRE54]'
  id: totrans-467
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: The `vi` editor displays the contents of the configuration file.
  id: totrans-468
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器显示配置文件的内容。'
- en: '[PRE55]'
  id: totrans-469
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Replace the line beginning with #`DAEMON_CONF` with the line `DAEMON_CONF="/etc/hostapd/hostapd.conf".`'
  id: totrans-470
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以 `#DAEMON_CONF` 开头的行替换为 `DAEMON_CONF="/etc/hostapd/hostapd.conf"`。
- en: '[PRE56]'
  id: totrans-471
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Save the file and exit the editor (`:wq`).
  id: totrans-472
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Configure IP forwarding. Use the `vi` editor to enable IP forwarding by editing
    the kernel parameters file, `/etc/sysctl.conf`.
  id: totrans-473
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置 IP 转发。使用 `vi` 编辑器编辑内核参数文件 `/etc/sysctl.conf` 来启用 IP 转发。
- en: '[PRE57]'
  id: totrans-474
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: The `vi` editor displays the contents of the configuration file.
  id: totrans-475
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器显示配置文件的内容。'
- en: '[PRE58]'
  id: totrans-476
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: The `vi` editor opens the kernel parameters file (`/etc/sysctl.conf`).
  id: totrans-477
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器打开内核参数文件（`/etc/sysctl.conf`）。'
- en: Uncomment the line beginning with `net.ipv4.ip_forward` by removing the `#`
    from the beginning of the line.
  id: totrans-478
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过删除行首的 `#` 来取消注释以 `net.ipv4.ip_forward` 开头的行。
- en: '[PRE59]'
  id: totrans-479
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Save the file and exit the editor (`:wq`).
  id: totrans-480
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Enable IP forwarding. Enable post forwarding by using the `echo` command to
    set the kernel parameter `/proc/sys/net/ipv4/ip_forward` to the value `"1"`.
  id: totrans-481
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用 IP 转发。通过使用 `echo` 命令将内核参数 `/proc/sys/net/ipv4/ip_forward` 设置为值 `"1"` 来启用转发。
- en: '[PRE60]'
  id: totrans-482
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: Use the `iptables` command to set up IP forwarding rules for network address
    translation and port forwarding.
  id: totrans-483
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `iptables` 命令为网络地址转换和端口转发设置 IP 转发规则。
- en: '[PRE61]'
  id: totrans-484
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Save the iptables configuration (`iptables-save`) and move the output file (`iptables.ipv4.net`)
    to the `/etc` configuration directory for use during system boot.
  id: totrans-485
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存 iptables 配置（`iptables-save`），并将输出文件（`iptables.ipv4.net`）移动到 `/etc` 配置目录中，以便在系统启动时使用。
- en: '[PRE62]'
  id: totrans-486
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: Give the wireless interface a static IP address. Use the `ifconfig` command
    to give the wireless network interface (`wlan0)` a static IP address (`192.169.0.1`).
  id: totrans-487
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给无线接口分配静态 IP 地址。使用 `ifconfig` 命令给无线网络接口（`wlan0`）分配静态 IP 地址（`192.169.0.1`）。
- en: '[PRE63]'
  id: totrans-488
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: Configure the network interface boot parameters. Use the vi editor to edit the
    network interface configuration file (`/etc/network/interfaces`).
  id: totrans-489
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置网络接口启动参数。使用 vi 编辑器编辑网络接口配置文件（`/etc/network/interfaces`）。
- en: '[PRE64]'
  id: totrans-490
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: The `vi` editor opens the network interface configuration file (`/etc/network/interfaces`).
  id: totrans-491
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi` 编辑器打开网络接口配置文件（`/etc/network/interfaces`）。'
- en: Change the file so that it only contains the following`:`
  id: totrans-492
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更改文件，使其仅包含以下内容`:`。
- en: '[PRE65]'
  id: totrans-493
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: Save the file and exit the editor (:wq).
  id: totrans-494
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Enable the wireless access point. Use the `update-rc.d` command to enable the
    `hostapd` and `udhcpd` services.
  id: totrans-495
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用无线接入点。使用 `update-rc.d` 命令启用 `hostapd` 和 `udhcpd` 服务。
- en: '[PRE66]'
  id: totrans-496
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: The Raspberry Pi is now configured to start the `hostapd` and `udhcpd` services
    during system boot.
  id: totrans-497
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Raspberry Pi 已配置为在系统启动时启动 `hostapd` 和 `udhcpd` 服务。
- en: Disable wpa_supplicant. Use the `mv` command to move the service definition
    file for WPA Supplicant (`fi.epitest.hostap.WPASupplicant.service`) out of the
    services directory (`/usr/share/dbus-1/system-services`).
  id: totrans-498
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 禁用wpa_supplicant。使用`mv`命令将WPA Supplicant的服务定义文件（`fi.epitest.hostap.WPASupplicant.service`）从服务目录（`/usr/share/dbus-1/system-services`）中移动出去。
- en: '[PRE67]'
  id: totrans-499
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Reboot: Reboot the system and the Raspberry Pi is a wireless access point!
    Look for the `Raspi_AP` network SSID and connect using the password (`Pr0t3ct3d`)
    that was defined in the hostapd configuration file (`/etc/hostapd/hostapd.conf`).'
  id: totrans-500
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启：重启系统，树莓派就变成了无线接入点！查找`Raspi_AP`网络SSID并使用在hostapd配置文件（`/etc/hostapd/hostapd.conf`）中定义的密码（`Pr0t3ct3d`）进行连接。
- en: How it works...
  id: totrans-501
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: 'The recipe starts by downloading and installing a wireless interface toolkit
    (`iw`), as well as two servers: a Wireless Access Point server (`hostapd`) and
    a DHCP server (`udhcpd`).'
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: 配方从下载并安装无线接口工具包（`iw`）开始，并安装两个服务器：无线接入点服务器（`hostapd`）和DHCP服务器（`udhcpd`）。
- en: Before configuration begins, the wireless USB adapter is tested for compatibility.
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置开始之前，需要测试无线USB适配器的兼容性。
- en: Check the wireless USB adapter
  id: totrans-504
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查无线USB适配器
- en: Not all wireless USB adapters support Access Point (AP) mode. The `iw list`
    command is used to list the wireless capabilities of any attached wireless devices.
    If AP mode is supported, it will be listed in the section `Supported interface
    modes`.
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有无线USB适配器都支持接入点（AP）模式。可以使用`iw list`命令列出任何连接的无线设备的无线功能。如果支持AP模式，它将在`Supported
    interface modes`部分中列出。
- en: The output of the `iw list` command is quite long. The `grep` command is used
    to filter the output of the `iw list` command. A pipe (`|`) is used to connect
    the output of the `iw list` command to the input of the `grep` command. The `grep`
    command limits the output of other commands using a regular expression filter
    (**'^[[:blank:]]*\* A'** – from the beginning of the line **^** any number of
    blanks **[[:blank:]]*** followed by an asterisk **\*** followed by a space and
    the capital letter **A**).
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: '`iw list`命令的输出非常长。`grep`命令用于过滤`iw list`命令的输出。管道符号（`|`）将`iw list`命令的输出连接到`grep`命令的输入。`grep`命令使用正则表达式过滤器限制其他命令的输出（**''^[[:blank:]]*\*
    A''** – 从行首**^**开始，任意数量的空白字符**[[:blank:]]***，然后是星号**\***，接着是空格和大写字母**A**）。'
- en: If the wireless adapter is not compatible with `hostapd`, the `iw list` command
    will display the message "`nl80211 not found.`" There may still be a chance for
    the adapter to work with `hostapd`; however, it requires recompiling `hostapd`
    with another driver (see references at the end of the chapter).
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 如果无线适配器与`hostapd`不兼容，`iw list`命令将显示信息"`nl80211 not found.`" 适配器仍然有可能与`hostapd`一起工作；不过，这需要使用另一种驱动程序重新编译`hostapd`（请参见本章末尾的参考资料）。
- en: Once the wireless adapter has been tested and shown to support AP mode, configuration
    of the Raspberry Pi continues.
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦无线适配器被测试并显示支持AP模式，接下来的配置将继续进行。
- en: Configure the DHCP server by using udhcpd
  id: totrans-509
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用udhcpd配置DHCP服务器
- en: The Dynamic Host Configuration Protocol (DHCP) server (udhcpd) assigns client
    computers network configuration information; such as the address of a DNS nameserver,
    an IP address, and a default route (or gateway). When this recipe is complete,
    the Raspberry Pi will configure its wireless clients using DCHP.
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 动态主机配置协议（DHCP）服务器（udhcpd）为客户端计算机分配网络配置信息；例如DNS名称服务器的地址、IP地址和默认路由（或网关）。完成此配方后，树莓派将使用DCHP配置其无线客户端。
- en: 'Three changes are made to the DHCP configuration file `(/etc/udhcpd.conf`):'
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 对DHCP配置文件`(/etc/udhcpd.conf)`进行三项更改：
- en: The wireless interface is selected (**wlan0**)
  id: totrans-512
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择无线接口（**wlan0**）
- en: The remaining flag is set to support embedded devices (for example, Raspberry
    Pi)
  id: totrans-513
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 剩余的标志被设置为支持嵌入式设备（例如树莓派）
- en: The default network parameters are defined for wireless clients
  id: totrans-514
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为无线客户端定义默认的网络参数
- en: 'The default network parameters are:'
  id: totrans-515
  prefs: []
  type: TYPE_NORMAL
  zh: 默认网络参数为：
- en: '**dns** – the DNS nameserver to use. The system DNS nameserver is defined in
    **/etc/resolv.conf** and is displayed in Step 5.'
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: '**dns** – 要使用的DNS名称服务器。系统的DNS名称服务器定义在**/etc/resolv.conf**中，并将在第5步中显示。'
- en: '**subnet**– how many IP addresses are part of the same network subnet. The
    value **255.255.255.0** is a net mask that matches computers with the same numbers
    in the first three bytes of the IP address.'
  id: totrans-517
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**子网**– 同一网络子网中的IP地址数量。值**255.255.255.0**是一个网络掩码，它使得具有相同前三个字节的IP地址的计算机能够相互通信。'
- en: '**router** – the static IP address of the Raspberry Pi''s wireless interface
    (**192.168.0.1**).'
  id: totrans-518
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**router** – 树莓派无线接口的静态 IP 地址（**192.168.0.1**）'
- en: '**domain**– the name of the network (**local**).'
  id: totrans-519
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**domain** – 网络名称（**local**）'
- en: '`lease` – how long a network address will be assigned to a specific computer
    (**864000** seconds or 10 days).'
  id: totrans-520
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lease` – 网络地址分配给特定计算机的时长（**864000** 秒或 10 天）'
- en: The **start** and **end** parameters at the top of the configuration file by
    default are set to the range of IP values from **192.168.0.20** to **192.168.0.254**.
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件顶部的 **start** 和 **end** 参数默认设置为 IP 地址范围从 **192.168.0.20** 到 **192.168.0.254**。
- en: If the Raspberry Pi will always be attached to a wired network that has a network
    timeserver, the remaining time flag does not need to be set.
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 如果树莓派始终连接到一个有网络时间服务器的有线网络，则无需设置剩余时间标志。
- en: After udhcpd has been configured, its boot script parameter file `(/etc/default/udhcpd`)
    also needs to be changed. The parameter **DHCP_ENABLED="no"** needs to be commented
    out (by placing a `#` at the beginning of the line), so that the DHCP server (`udhcpd`)
    is enabled.
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: 配置完成后，udhcpd 的启动脚本参数文件 `(/etc/default/udhcpd)` 也需要进行更改。需要将参数 **DHCP_ENABLED="no"**
    注释掉（通过在行首添加 `#`），以启用 DHCP 服务器（`udhcpd`）。
- en: Configure the Wireless Access Point server by using hostapd
  id: totrans-524
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 hostapd 配置无线接入点服务器
- en: The Wireless Access Point server (`hostapd`) manages the wireless connection
    between other wireless devices and the Raspberry Pi. This includes establishing
    a secure connection using an encryption protocol like Wi-Fi Protect Access (WPA);
    and setting the Service Set ID (SSID) and the pre-shared key (PSK).
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
  zh: 无线接入点服务器（`hostapd`）管理其他无线设备与树莓派之间的无线连接。这包括使用加密协议（如 Wi-Fi Protected Access，WPA）建立安全连接；设置服务集标识符（SSID）和预共享密钥（PSK）。
- en: 'The created **hostapd** configuration parameter file includes:'
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: 创建的 **hostapd** 配置参数文件包括：
- en: '**interface** – the wireless interface (**wlan0**)'
  id: totrans-527
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**interface** – 无线接口（**wlan0**）'
- en: '**ssid** – the network ID (**Raspi_AP**)'
  id: totrans-528
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ssid** – 网络 ID（**Raspi_AP**）'
- en: '**wpa_passphrase** – the passphrase or pre-shared key (`Pr0t3ct3d`)'
  id: totrans-529
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**wpa_passphrase** – 密码短语或预共享密钥（`Pr0t3ct3d`）'
- en: '**driver** – the wireless device driver (**nl80211**)'
  id: totrans-530
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**driver** – 无线设备驱动程序（**nl80211**）'
- en: '**hw_mode** – the hardware mode (**g**)'
  id: totrans-531
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**hw_mode** – 硬件模式（**g**）'
- en: '**channel** – the radio frequency channel (**6**)'
  id: totrans-532
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**channel** – 无线频率频道（**6**）'
- en: '**macaddr_acl** – access control list (**0**)'
  id: totrans-533
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**macaddr_acl** – 访问控制列表（**0**）'
- en: '**auth_algs** – the authorization algorithm to use (**1** – open auth)'
  id: totrans-534
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**auth_algs** – 要使用的授权算法（**1** – 开放认证）'
- en: '**ignore_broadcast_ssid** – enable broadcasting the network ID (**0** – don''t
    ignore broadcasting)'
  id: totrans-535
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ignore_broadcast_ssid** – 启用广播网络 ID（**0** – 不忽略广播）'
- en: '**wpa** – which version of WPA (**2**)'
  id: totrans-536
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**wpa** – WPA 的版本（**2**）'
- en: '**wpa_key_mgmt** – which key manages algorithm (**WPA-PSK**)'
  id: totrans-537
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**wpa_key_mgmt** – 管理算法的密钥（**WPA-PSK**）'
- en: '**wpa_pairwise** – WPA v1 data encryption (**TKIP**)'
  id: totrans-538
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**wpa_pairwise** – WPA v1 数据加密（**TKIP**）'
- en: '**rsn_pairwise** – WPA v2 data encryption (**CCMP**)'
  id: totrans-539
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rsn_pairwise** – WPA v2 数据加密（**CCMP**）'
- en: After **hostapd** has been configured, its boot script parameter file (`/etc/default/hostapd`)
    also needs to be changed. The parameter **DAEMON_CONF** needs to be set to the
    location of the `hostapd` configuration file `(/etc/hostapd/hostapd.conf`), so
    that the Wireless Access Point server is enabled.
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
  zh: 配置完成 **hostapd** 后，其启动脚本参数文件（`/etc/default/hostapd`）也需要更改。需要将参数 **DAEMON_CONF**
    设置为 `hostapd` 配置文件的位置 `(/etc/hostapd/hostapd.conf)`，以便启用无线接入点服务器。
- en: Set up IP Forwarding
  id: totrans-541
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置 IP 转发
- en: IP Forwarding is used to pass (forward) network traffic between network interfaces.
    In this recipe, IP Forwarding is used to pass network traffic between the wireless
    network and the wired network. Using IP Forwarding, the Raspberry Pi connects
    the clients of the wireless network to the wired network.
  id: totrans-542
  prefs: []
  type: TYPE_NORMAL
  zh: IP 转发用于在网络接口之间传递（转发）网络流量。在本食谱中，IP 转发用于在无线网络和有线网络之间传递网络流量。通过使用 IP 转发，树莓派将无线网络的客户端连接到有线网络。
- en: The first configuration step is to enable IP Forwarding in the Raspberry Pi's
    Linux kernel. The kernel parameters file `(/etc/sysctl.conf`) has an IP Forwarding
    entry (**net.ipv4.ip_forward=1**) that is by default commented out. Uncommenting
    this entry, by removing the **#** at the beginning of the line, enables IP Forwarding
    in the Linux kernel.
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步配置是启用树莓派 Linux 内核中的 IP 转发功能。内核参数文件 `(/etc/sysctl.conf)` 中有一项 IP 转发条目（**net.ipv4.ip_forward=1**），默认是被注释掉的。通过去掉行首的
    **#** 来取消注释，从而启用 Linux 内核中的 IP 转发功能。
- en: After IP Forwarding is enabled, the `iptables` command is used to define the
    net filter rules that determine which network packets are allowed to cross the
    Linux kernel's internal firewall. The Linux kernel's firewall organizes its rules
    into tables that define how network packets pass through the kernel. The `iptables`
    command is used to manage the rules stored in these tables.
  id: totrans-544
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 IP 转发后，`iptables` 命令用于定义网络过滤规则，决定哪些网络数据包可以穿过 Linux 内核的内部防火墙。Linux 内核的防火墙将规则组织成表，定义数据包如何通过内核。`iptables`
    命令用于管理存储在这些表中的规则。
- en: The first Linux kernel firewall rule define in this step is appended to the
    postprocessing rules (**-A POSTROUTING**) of the network address translation table
    (**-t nat**). This rule masquerades network packets (**MASQUERADE**) as they are
    passed to the wired network (**-o eth0**). The IP addresses of wireless network
    clients are translated into the IP address of the Raspberry Pi's wired network
    connection as they are passed to the wired network. This is how the network packets
    from multiple wireless network clients are translated so they can pass through
    the Raspberry Pi's single wired network connection.
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
  zh: 此步骤中定义的第一个 Linux 内核防火墙规则被添加到网络地址转换表（**-t nat**）的后处理规则中（**-A POSTROUTING**）。该规则在网络数据包（**MASQUERADE**）传递到有线网络（**-o
    eth0**）时进行伪装。无线网络客户端的 IP 地址在传递到有线网络时被转换为树莓派的有线网络连接的 IP 地址。这是如何将来自多个无线网络客户端的网络数据包转换，使它们能够通过树莓派的单个有线网络连接。
- en: The second rule is appended to the packet forwarding rules (**-A FORWARD**)
    of the filter table (the default table). This rule allows (**-j ACCEPT**) network
    packets to be forwarded (**-A FORWARDED**) from the wired network (**-i eth0**)
    to the wireless network (**-o wlan0**) when they are related to an established
    connection (**-m state –state RELATED,ESTABLISHED**).
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 第二条规则被添加到过滤表（默认表）的包转发规则中 (**-A FORWARD**)。该规则允许网络数据包（**-j ACCEPT**）从有线网络（**-i
    eth0**）转发到无线网络（**-o wlan0**），前提是它们与已建立的连接（**-m state –state RELATED,ESTABLISHED**）相关。
- en: The last `iptables` command rule in this step is appended to the forwarding
    rules of the filter table (**-A FORWARD**). This rule allows packets to pass from
    the wireless network (**-i wlan0**) to the wired network (**-o eth0**).
  id: totrans-547
  prefs: []
  type: TYPE_NORMAL
  zh: 此步骤中最后一条 `iptables` 命令规则被添加到过滤表的转发规则中（**-A FORWARD**）。该规则允许数据包从无线网络（**-i wlan0**）传递到有线网络（**-o
    eth0**）。
- en: The next command, `ifconfig wlan0`, sets the IP address of the Raspberry Pi's
    wireless network connection to **192.168.0.1**.
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
  zh: 下一条命令 `ifconfig wlan0` 将树莓派无线网络连接的 IP 地址设置为 **192.168.0.1**。
- en: Finally, the `iptables-save` command is used to save a copy of these rules in
    a configuration file `(/etc/iptables.ipv4.nat`) that can be used during boot.
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，`iptables-save` 命令用于将这些规则的副本保存在配置文件 `(/etc/iptables.ipv4.nat)` 中，以便在启动时使用。
- en: After this step is complete, the IP Forwarding rules have been defined and saved
    in a configuration file. The IP Forwarding rules are also active.
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此步骤后，IP 转发规则已定义并保存在配置文件中。IP 转发规则也已启用。
- en: Configure the boot parameters
  id: totrans-551
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置启动参数
- en: The network interfaces definitions used during boot are stored in a configuration
    file `(/etc/network/interfaces`). The file defines the network address, network
    mask, and the default route for each network interface.
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 启动时使用的网络接口定义存储在配置文件 `(/etc/network/interfaces)` 中。该文件定义了每个网络接口的网络地址、网络掩码和默认路由。
- en: 'The configuration file used in this recipe defines three network interfaces:'
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程中使用的配置文件定义了三个网络接口：
- en: '**lo** – the loopback network'
  id: totrans-554
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**lo** – 回环网络'
- en: '**eth0**– the wired network'
  id: totrans-555
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**eth0**– 有线网络'
- en: '**wlan0** – the wireless network'
  id: totrans-556
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**wlan0** – 无线网络'
- en: The loopback interface (**lo**) is loaded automatically (**auto**).
  id: totrans-557
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 回环接口（**lo**）会自动加载（**auto**）。
- en: The wired interface interface's (**eth0**) is configured dynamically using the
    DHCP protocol.
  id: totrans-558
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有线接口（**eth0**）使用 DHCP 协议动态配置。
- en: The wireless interface (**wlan0**) has a static definition (**static**) – it
    is in this file. The wireless interface's IP **address** is defined to be **192.168.0.1**.
    The interface's defined network mask (**255.255.255.0**) is big enough to support
    256 unique addresses on the same subnet.
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
  zh: 无线接口（**wlan0**）有一个静态定义（**static**）——它位于此文件中。无线接口的IP **地址** 被定义为 **192.168.0.1**。接口的网络掩码（**255.255.255.0**）足够大，可以支持同一子网中的
    256 个唯一地址。
- en: After the network interfaces are brought up (**up**), the IP Forwarding definitions
    `(/etc/iptables.ipv4.nat`) are restored (**iptables-restore**) that were saved
    earlier in this recipe (using **iptables-save**).
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: 在网络接口启动（**up**）后，之前保存在此配方中的IP转发定义 `(/etc/iptables.ipv4.nat)` 将被恢复（**iptables-restore**）（使用**iptables-save**保存）。
- en: Once the network interface definitions have been saved, the network can be started.
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦网络接口定义被保存，网络就可以启动了。
- en: '**Start the wireless access point**'
  id: totrans-562
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**启动无线接入点**'
- en: 'Now that the configuration files have been updated:'
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件已更新：
- en: wireless access point `(/etc/hostapd/hostapd.conf`)
  id: totrans-564
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无线接入点 `(/etc/hostapd/hostapd.conf)`
- en: dynamic host configuration protocol `(/etc/udhcpd.conf`)
  id: totrans-565
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 动态主机配置协议 `(/etc/udhcpd.conf)`
- en: network interfaces `(/etc/network/interfaces`)
  id: totrans-566
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络接口 `(/etc/network/interfaces)`
- en: IP Forwarding definitions `(/etc/iptables.ipv4.nat)`
  id: totrans-567
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IP转发定义 `(/etc/iptables.ipv4.nat)`
- en: The boot scripts for the wireless access point daemon (**hostapd**) and the
    dynamic host configuration protocol daemon (`udhcp`) can be enabled (`update-rc.d
    enable`).
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: 无线接入点守护进程（**hostapd**）和动态主机配置协议守护进程（`udhcp`）的启动脚本可以启用（`update-rc.d enable`）。
- en: The Raspberry Pi will now become a wireless access point every time it boots!
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: 树莓派现在每次启动时都会变成无线接入点！
- en: After the Raspberry Pi reboots, the wireless access point is ready to use! Wireless
    devices can now connect to the Raspberry Pi using your chosen SSID (`Raspi_AP`)
    and passphrase (`Pr0t3ct3d`).
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: 树莓派重启后，无线接入点已准备好使用！无线设备现在可以使用您选择的SSID（`Raspi_AP`）和密码（`Pr0t3ct3d`）连接到树莓派。
- en: There's more…
  id: totrans-571
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: Not all USB wireless adapters support AP mode
  id: totrans-572
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 并非所有USB无线适配器都支持AP模式
- en: There are a limited number of wireless USB adapters that can work with the Raspberry
    Pi and can also be configured as wireless access points. The links at the end
    of this chapter can be used to find current wireless USB adapters that can be
    used together with the Raspberry Pi to create a wireless access point (see *Other
    Resources*).
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: 有限数量的无线USB适配器可以与树莓派配合使用，并且可以配置为无线接入点。本章末尾的链接可以帮助您找到目前可以与树莓派一起使用的无线USB适配器，以创建无线接入点（请参见*其他资源*）。
- en: Some wireless USB adapters consume more power than the Raspberry Pi can support
    consistently on a continual basis. Connecting the wireless USB adapter to the
    Raspberry Pi indirectly via a USB hub will lead to better performance and reduce
    the likelihood that other USB devices (like the onboard network card!) will be
    starved for power.
  id: totrans-574
  prefs: []
  type: TYPE_NORMAL
  zh: 一些无线USB适配器的功耗超过了树莓派能持续支持的范围。通过USB集线器间接连接无线USB适配器到树莓派将带来更好的性能，并减少其他USB设备（如板载网卡！）因电力不足而无法正常工作的可能性。
- en: Wireless firewall, file server, or web server
  id: totrans-575
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 无线防火墙、文件服务器或网页服务器
- en: This recipe works well when combined with other recipes in this book.
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配方与本书中的其他配方结合使用时效果很好。
- en: Together with the file-sharing recipes in [Chapter 4](ch04.html "Chapter 4. File
    Sharing"), *File Sharing*, the Raspberry Pi could become a file server for both
    wired and wireless devices connected to the local network – for exchanging document
    and media files; or for backup and storage.
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: 与[第4章](ch04.html "第4章。文件共享")中的文件共享配方，*文件共享*，结合使用时，树莓派可以成为有线和无线设备都能连接到本地网络的文件服务器——用于交换文档和媒体文件；或用于备份和存储。
- en: When combined with other advanced networking recipes in this chapter, the Raspberry
    Pi could become a network firewall, protecting wireless access to a wired network;
    a teaching or support tool with remote access to desktop devices; a communication
    tool that serves web pages; or a collaboration tool that hosts wiki pages.
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
  zh: 当与本章中的其他高级网络配方结合使用时，树莓派可以成为一个网络防火墙，保护无线访问到有线网络；一个可以远程访问桌面设备的教学或支持工具；一个提供网页的通信工具；或一个托管wiki页面的协作工具。
- en: Within the Raspberry Pi and open source GNU Linux community, there are numerous
    other tools and applications that could be combined with this recipe to turn the
    Raspberry Pi into a dynamic network hub for wireless devices.
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
  zh: 在树莓派和开源GNU Linux社区中，有许多其他工具和应用程序可以与此配方结合使用，将树莓派转变为无线设备的动态网络中心。
- en: See also
  id: totrans-580
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: '**hostapd** ([http://en.wikipedia.org/wiki/Hostapd](http://en.wikipedia.org/wiki/Hostapd)):
    This Wikipedia article about hostapd describes the service in more detail.'
  id: totrans-581
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**hostapd** ([http://en.wikipedia.org/wiki/Hostapd](http://en.wikipedia.org/wiki/Hostapd))：这篇关于hostapd的维基百科文章更详细地描述了该服务。'
- en: '**hostapd: IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator**
    ([http://w1.fi/hostapd/](http://w1.fi/hostapd/)): The `hostapd` website is a complete
    reference for the server.'
  id: totrans-582
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**hostapd: IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS身份验证器** ([http://w1.fi/hostapd/](http://w1.fi/hostapd/)):
    `hostapd` 网站是服务器的完整参考。'
- en: '**Debian Linux Kernel Handbook** ([http://kernel-handbook.alioth.debian.org/](http://kernel-handbook.alioth.debian.org/)):
    The Debian Linux Kernel Handbook has more information about how iptables work.'
  id: totrans-583
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Debian Linux内核手册** ([http://kernel-handbook.alioth.debian.org/](http://kernel-handbook.alioth.debian.org/)):
    Debian Linux内核手册提供了有关iptables工作原理的更多信息。'
- en: '**Linux wireless** ([http://linuxwireless.org/](http://linuxwireless.org/)):
    The Linux Wireless website has more information on using wireless devices with
    Linux.'
  id: totrans-584
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Linux无线** ([http://linuxwireless.org/](http://linuxwireless.org/)): Linux无线网站有更多关于在Linux上使用无线设备的信息。'
- en: '**RPI-Wireless-Hotspot** ([http://elinux.org/RPI-Wireless-Hotspot](http://elinux.org/RPI-Wireless-Hotspot)):
    This is an article about wireless hotspots on the Embedded Linux website.'
  id: totrans-585
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**RPI无线热点** ([http://elinux.org/RPI-Wireless-Hotspot](http://elinux.org/RPI-Wireless-Hotspot)):
    这是一篇关于在嵌入式Linux网站上设置无线热点的文章。'
- en: '**USB Wi-Fi Adapters** ([http://elinux.org/RPi_VerifiedPeripherals#USB_Wi-Fi_Adapters](http://elinux.org/RPi_VerifiedPeripherals#USB_Wi-Fi_Adapters)):
    This is an article about Wi-Fi adapters on the Embedded Linux Wiki.'
  id: totrans-586
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**USB Wi-Fi适配器** ([http://elinux.org/RPi_VerifiedPeripherals#USB_Wi-Fi_Adapters](http://elinux.org/RPi_VerifiedPeripherals#USB_Wi-Fi_Adapters)):
    这是一篇关于嵌入式Linux Wiki中Wi-Fi适配器的文章。'
- en: '**Raspberry Pi Wi-Fi adapter testing** ([http://www.element14.com/community/docs/DOC-44703/l/raspberry-pi-wifi-adapter-testing](http://www.element14.com/community/docs/DOC-44703/l/raspberry-pi-wifi-adapter-testing)):
    This is an article about tested wireless adapters on the Element14 Community website.'
  id: totrans-587
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**树莓派Wi-Fi适配器测试** ([http://www.element14.com/community/docs/DOC-44703/l/raspberry-pi-wifi-adapter-testing](http://www.element14.com/community/docs/DOC-44703/l/raspberry-pi-wifi-adapter-testing)):
    这是一篇关于在Element14社区网站上测试过的无线适配器的文章。'
- en: Installing a network trace utility
  id: totrans-588
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装网络跟踪工具
- en: This recipe installs the network trace utility My traceroute (`mtr`).
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱安装网络跟踪工具My Traceroute（`mtr`）。
- en: The `mtr` utility is often used for network troubleshooting. The utility displays
    the route that network packets take between the Raspberry Pi and another computer.
    The display is refreshed continuously displaying the time it takes network packets
    to travel between each device along the route between the two computers. By use
    `mrt`, you can see which devices along the network route are the slowest.
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
  zh: '`mtr`工具通常用于网络故障排除。该工具显示树莓派和另一台计算机之间的网络数据包路由。显示会持续刷新，显示数据包在每个设备之间传输的时间。使用`mrt`时，你可以看到网络路由中哪些设备最慢。'
- en: After completing this recipe, you will be able to trace network packets with
    `mrt`.
  id: totrans-591
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本食谱后，你将能够使用`mrt`跟踪网络数据包。
- en: Getting ready
  id: totrans-592
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Ingredients:'
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
  zh: 材料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-594
  prefs: []
  type: TYPE_NORMAL
  zh: 树莓派的初始设置或基础网络设置已完成，树莓派已经开机。你也已经以`pi`用户登录（参见[第1章](ch01.html "第1章. 安装与设置")，*安装与设置*，了解如何启动和登录，以及[第2章](ch02.html
    "第2章. 管理")，*管理*，了解如何远程登录）。
- en: This recipe does not require the desktop GUI and could either be run from the
    text-based console or from within an `LXTerminal`.
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱不需要桌面GUI，可以通过基于文本的控制台或`LXTerminal`中运行。
- en: If the Raspberry Pi's Secure Shell server is running, this recipe can be completed
    remotely using a Secure Shell client.
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
  zh: 如果树莓派的安全外壳服务器正在运行，本食谱可以通过安全外壳客户端远程完成。
- en: How to do it...
  id: totrans-597
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The steps to installing a network trace utility are:'
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: 安装网络跟踪工具的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely.
  id: totrans-599
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到树莓派，可以是直接登录或远程登录。
- en: Use the `apt-get install` command to install the `mtr` package.
  id: totrans-600
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`apt-get install`命令来安装`mtr`软件包。
- en: '[PRE68]'
  id: totrans-601
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: The `apt-get install` command installs the software package `mrt`.
  id: totrans-602
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install`命令安装`mrt`软件包。'
- en: Use the `mrt` command to trace the network route between your Raspberry Pi and
    the Raspberry Pi Foundation website.
  id: totrans-603
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`mrt`命令来跟踪你的树莓派与树莓派基金会网站之间的网络路由。
- en: '[PRE69]'
  id: totrans-604
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: The `mrt` command displays the route.
  id: totrans-605
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`mrt`命令显示路由。'
- en: '[PRE70]'
  id: totrans-606
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: The display continuously refreshes until you press **q**.
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: 显示将持续刷新，直到你按下**q**。
- en: How it works...
  id: totrans-608
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: After logging in to the Raspberry Pi, this recipe installs the My traceroute
    software package (`mtr`).
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到 Raspberry Pi 后，本食谱安装 My Traceroute 软件包（`mtr`）。
- en: Then the newly installed `mtr` command is used to trace the network route between
    the author's Raspberry Pi located in San Mateo, California and the Raspberry Pi
    Foundation website that is hosted by Mythic-Beasts located in London, England.
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，使用新安装的 `mtr` 命令来追踪位于美国加利福尼亚州圣马特奥的作者 Raspberry Pi 与托管在英国伦敦 Mythic-Beasts 网站上的
    Raspberry Pi 基金会网站之间的网络路由。
- en: The *q* key is pressed to exit the command.
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: 按下 *q* 键可以退出命令。
- en: There's more...
  id: totrans-612
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: The `mtr` dynamically updates network statistics collected from devices along
    the route between a remote machine and the Raspberry Pi. In addition to displaying
    a list of devices along the route (**Host**), `mtr` also displays stats for **Packets**
    and **Pings**.
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
  zh: '`mtr` 动态更新从远程计算机到 Raspberry Pi 之间路径上设备收集的网络统计信息。除了显示路径上的设备列表（**主机**），`mtr`
    还显示 **数据包** 和 **Ping** 的统计信息。'
- en: The **Packets** stats show how many packets were sent (**Snt**) and how many
    packets were lost along the way (**Loss%**).
  id: totrans-614
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据包** 的统计信息显示了发送的数据包数量（**已发送**）和途中丢失的数据包数量（**丢失%**）。'
- en: The **Pings** stats show how long it takes a network packet to travel from the
    Raspberry Pi to each device along the route. The average (**Avg**), best (**Best**),
    and worst (**Wrst**) time are also shown along with the standard deviation (**StDev**).
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
  zh: '**Ping** 的统计信息显示了网络数据包从 Raspberry Pi 到路径上每个设备所需的时间。还显示了平均时间（**Avg**）、最佳时间（**Best**）、最差时间（**Wrst**）和标准偏差（**StDev**）。'
- en: See also
  id: totrans-616
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**MTR (My traceroute)** ([https://en.wikipedia.org/wiki/MTR_(software)](https://en.wikipedia.org/wiki/MTR_(software))):
    This Wikipedia article has more information about `mtr`, its history, and how
    it works.'
  id: totrans-617
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**MTR (My traceroute)** ([https://en.wikipedia.org/wiki/MTR_(software)](https://en.wikipedia.org/wiki/MTR_(software))):
    这篇维基百科文章提供了关于 `mtr`、其历史以及工作原理的更多信息。'
- en: '**MTR** ([https://www.bitwizard.nl/mtr/](https://www.bitwizard.nl/mtr/)): The
    homepage for MTR – My traceroute.'
  id: totrans-618
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**MTR** ([https://www.bitwizard.nl/mtr/](https://www.bitwizard.nl/mtr/)): MTR
    – My Traceroute 的主页。'
- en: '**mtr – a network diagnostic tool** ([http://manpages.debian.net/cgi-bin/man.cgi?query=mtr](http://manpages.debian.net/cgi-bin/man.cgi?query=mtr)):
    The Debian manpage for `mtr` describes the command and its options.'
  id: totrans-619
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**mtr – 网络诊断工具** ([http://manpages.debian.net/cgi-bin/man.cgi?query=mtr](http://manpages.debian.net/cgi-bin/man.cgi?query=mtr)):
    Debian 的 `mtr` 手册页描述了该命令及其选项。'
- en: '**mythic beasts – infrastructure** ([https://www.mythic-beasts.com/article/infrastructure](https://www.mythic-beasts.com/article/infrastructure)):
    This web page describes the hosing infrastructure used by the Raspberry Pi Foundation,
    including the location of its data centers.'
  id: totrans-620
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Mythic Beasts – 基础设施** ([https://www.mythic-beasts.com/article/infrastructure](https://www.mythic-beasts.com/article/infrastructure)):
    该网页描述了 Raspberry Pi 基金会使用的托管基础设施，包括其数据中心的位置。'
- en: Installing a network protocol analyzer
  id: totrans-621
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装网络协议分析工具
- en: This recipe installs the network protocol analyzer Wireshark.
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱安装网络协议分析器 Wireshark。
- en: The Wireshark network protocol analyzer lets you examine the traffic on your
    network at a microscopic level. This network tool can be used for live capture
    or offline analysis. Wireshark has a Graphical User Interface (GUI) and a TTY-mode
    utility (`tshark`).
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
  zh: Wireshark 网络协议分析器让你在微观层面上检查网络上的流量。这个网络工具可以用于实时捕获或离线分析。Wireshark 拥有图形用户界面（GUI）和
    TTY 模式工具（`tshark`）。
- en: Live data can be read from Ethernet, IEEE 802.11 (Wi-Fi), PPP/HDLC, ATM, Bluetooth,
    USB, Token Ring, Frame Relay, FDDI, and other low-level protocols. Decryption
    is supported for a number of higher-level protocols including IPsec, ISAKMP, Kerberos,
    SNMPv3, SSL/TLS, WEP, and WPA/WPA2\. Data can be read/written in many forms including
    tcpdump, Microsoft Network Monitor, Network General Sniffer, Sniffer Pro, NetXray,
    and many others.
  id: totrans-624
  prefs: []
  type: TYPE_NORMAL
  zh: 可以从以太网、IEEE 802.11（Wi-Fi）、PPP/HDLC、ATM、蓝牙、USB、令牌环、帧中继、FDDI 等低级协议中读取实时数据。支持对包括
    IPsec、ISAKMP、Kerberos、SNMPv3、SSL/TLS、WEP 和 WPA/WPA2 在内的多种高级协议进行解密。数据可以以多种形式读取/写入，包括
    tcpdump、Microsoft 网络监控器、Network General Sniffer、Sniffer Pro、NetXray 等。
- en: After completing this recipe, you will be able to analyze your network with
    `wireshark`.
  id: totrans-625
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本食谱后，你将能够使用 `wireshark` 分析你的网络。
- en: Note
  id: totrans-626
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This recipe is only a starting point for exploring network protocol analysis.
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱仅是探索网络协议分析的起点。
- en: Links to more detailed information can be found at the end of the recipe.
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
  zh: 更多详细信息的链接可以在本食谱的末尾找到。
- en: Getting ready
  id: totrans-629
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-630
  prefs: []
  type: TYPE_NORMAL
  zh: 配料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi`.
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
  zh: 一个已开启的 Raspberry Pi 的初始设置或基本网络设置。你已经以用户 `pi` 登录。
- en: This recipe requires the desktop GUI.
  id: totrans-632
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程需要桌面 GUI。
- en: If the Raspberry Pi's VNC server is running, this recipe can be completed remotely
    using a VNC client (see the *Remote access to the monitor* recipe earlier in this
    chapter).
  id: totrans-633
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 Raspberry Pi 的 VNC 服务器正在运行，则可以使用 VNC 客户端远程完成本教程（参见本章前面的 *远程访问显示器* 教程）。
- en: How to do it...
  id: totrans-634
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The steps to installing a network protocol analyzer are:'
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: 安装网络协议分析仪的步骤如下：
- en: Log in to the Raspberry Pi desktop GUI.
  id: totrans-636
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 Raspberry Pi 桌面 GUI。
- en: Use the `apt-get install` command to install the `wireshark` package.
  id: totrans-637
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `apt-get install` 命令安装 `wireshark` 包。
- en: '[PRE71]'
  id: totrans-638
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: The `apt-get install` command downloads and installs the `wireshark` software
    package.
  id: totrans-639
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`apt-get install` 命令用于下载并安装 `wireshark` 软件包。'
- en: Use the `dpkg-reconfigure` command to modify the default configuration for `wireshark`.
  id: totrans-640
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `dpkg-reconfigure` 命令修改 `wireshark` 的默认配置。
- en: '[PRE72]'
  id: totrans-641
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: Use the **<tab>** key to select the answer **<Yes>** and then press the **<enter>**
    key to update the package configuration.
  id: totrans-642
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 **<tab>** 键选择 **<是>** 答案，然后按 **<enter>** 键以更新软件包配置。
- en: Use the `usermod` command to add (`-a`) the user `pi` to the `wireshark` system
    group (`-G wireshark`).
  id: totrans-643
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `usermod` 命令将用户 `pi` 添加到 `wireshark` 系统组（`-G wireshark`）。
- en: '[PRE73]'
  id: totrans-644
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: Use the Desktop GUI menu to start the Wireshark application.![How to do it...](img/B04745_05_23.jpg)
  id: totrans-645
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用桌面 GUI 菜单启动 Wireshark 应用程序。![如何操作...](img/B04745_05_23.jpg)
- en: The Wireshark application is started.![How to do it...](img/B04745_05_24.jpg)
  id: totrans-646
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 Wireshark 应用程序。![如何操作...](img/B04745_05_24.jpg)
- en: Choose an interface from the menu and click **Start** to begin sniffing network
    packets.
  id: totrans-647
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从菜单中选择一个接口并点击 **开始** 以开始嗅探网络数据包。
- en: The Wireshark application displays detailed information about each network packet
    as they are captured (sniffed).![How to do it...](img/B04745_05_25.jpg)
  id: totrans-648
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Wireshark 应用程序会在捕获（嗅探）每个网络数据包时，显示详细信息。![如何操作...](img/B04745_05_25.jpg)
- en: Use the **File** menu or *Ctrl*+*Q* to quit.
  id: totrans-649
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 **文件** 菜单或 *Ctrl*+*Q* 来退出。
- en: How it works...
  id: totrans-650
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: After logging in to the Raspberry Pi, this recipe uses the `apt-get install`
    command to install the Wireshark network protocol analyzer (network packet sniffer).
  id: totrans-651
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到 Raspberry Pi 后，本教程使用 `apt-get install` 命令安装 Wireshark 网络协议分析仪（网络数据包嗅探器）。
- en: After the Wireshark application is installed, the `dpkg-reconfigure` command
    is used to change the default application configuration (**wireshark-common**)
    to allow non-superusers to capture network packets. By default, only superusers
    are allowed to capture network packets.
  id: totrans-652
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 Wireshark 应用程序后，使用 `dpkg-reconfigure` 命令更改默认应用程序配置（**wireshark-common**），允许非超级用户捕获网络数据包。默认情况下，只有超级用户才能捕获网络数据包。
- en: After the configuration change is accepted (**<Yes>**), members of the **wireshark**
    system group may also capture network packets.
  id: totrans-653
  prefs: []
  type: TYPE_NORMAL
  zh: 在接受配置更改（**<是>**）后，**wireshark** 系统组的成员也可以捕获网络数据包。
- en: Before the application is started, the user **pi** is added (**-a**) to the
    **wireshark** user group using the **usermod** command.
  id: totrans-654
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动应用程序之前，用户 **pi** 通过 **usermod** 命令被添加（`-a`）到 **wireshark** 用户组。
- en: The Wireshark command is started by selecting **Menu > Internet > Wireshark**
    from the Raspberry Pi desktop.
  id: totrans-655
  prefs: []
  type: TYPE_NORMAL
  zh: 通过选择 **菜单 > 网络 > Wireshark** 从 Raspberry Pi 桌面启动 Wireshark 命令。
- en: When the application is started, the Wireshark application main page is displayed.
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
  zh: 启动应用程序后，Wireshark 应用程序的主页面会显示。
- en: From the main page, it is possible to select which network interfaces will be
    sniffed (monitored for incoming/outgoing network packets). After the **Start**
    command is clicked, Wireshark starts capturing and displaying network packets.
  id: totrans-657
  prefs: []
  type: TYPE_NORMAL
  zh: 在主页面上，可以选择哪些网络接口将被嗅探（监控进出网络数据包）。点击 **开始** 命令后，Wireshark 开始捕获并显示网络数据包。
- en: The Wireshark application can be exited by selecting **File > Quit** from the
    menu bar, or by pressing **Control-Q**.
  id: totrans-658
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过从菜单栏选择 **文件 > 退出** 或按 **Control-Q** 来退出 Wireshark 应用程序。
- en: There's more...
  id: totrans-659
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: The Wireshark application is a free and open source network protocol analyzer
    popular for network troubleshooting, analysis, and education.
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: Wireshark 应用程序是一个免费的开源网络协议分析仪，广泛用于网络故障排除、分析和教育。
- en: Promiscuous mode
  id: totrans-661
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 混杂模式
- en: Wireshark puts the selected network interface(s) into promiscuous mode. In promiscuous
    mode, the interface listens for all network packets, including packets that are
    not destined for the Raspberry Pi. Wireshark can see all the network traffic on
    the network interface.
  id: totrans-662
  prefs: []
  type: TYPE_NORMAL
  zh: Wireshark 将选定的网络接口(s) 设置为混杂模式。在混杂模式下，接口会监听所有网络数据包，包括那些并非发送给 Raspberry Pi 的数据包。Wireshark
    能够看到网络接口上的所有网络流量。
- en: Terminal-based user interface
  id: totrans-663
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 基于终端的用户界面
- en: Wireshark also has a command-line utility, `tshark`, that outputs the packets
    it sniffs directly to the console. The `tshark` command is installed separately
    from Wireshark.
  id: totrans-664
  prefs: []
  type: TYPE_NORMAL
  zh: Wireshark 还有一个命令行工具 `tshark`，它将嗅探到的数据包直接输出到控制台。`tshark` 命令是与 Wireshark 分开安装的。
- en: '[PRE74]'
  id: totrans-665
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: When entered on the command line without options, tshark starts capturing the
    packets it can sniff on the default network interface (eth0).
  id: totrans-666
  prefs: []
  type: TYPE_NORMAL
  zh: 当在命令行中输入时，如果不带选项，tshark 会开始捕获它能够嗅探到的数据包，并且默认使用网络接口 (eth0)。
- en: '[PRE75]'
  id: totrans-667
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: The preceding example output from `tshark` shows some of the network packets
    captured when browsing the website [https://www.raspberrypi.org](https://www.raspberrypi.org).
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
  zh: 上述 `tshark` 示例输出显示了在浏览网站 [https://www.raspberrypi.org](https://www.raspberrypi.org)
    时捕获的一些网络数据包。
- en: Capture filters
  id: totrans-669
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 捕获过滤器
- en: Not all of the network packets passing across the Raspberry Pi's network interface
    are interesting. Both Wireshark and `tshark` can use capture filters to limit
    the number of packets that are captured and displayed.
  id: totrans-670
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有通过 Raspberry Pi 网络接口传输的网络数据包都是有趣的。Wireshark 和 `tshark` 都可以使用捕获过滤器来限制捕获和显示的数据包数量。
- en: In this example, the capture filter limits the display to SSL traffic.
  id: totrans-671
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，捕获过滤器将显示内容限制为 SSL 流量。
- en: '[PRE76]'
  id: totrans-672
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: The following example captures data from the wireless network (wlan0) and limits
    the display to HTTP traffic.
  id: totrans-673
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例捕获来自无线网络 (wlan0) 的数据，并将显示限制为 HTTP 流量。
- en: '[PRE77]'
  id: totrans-674
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: More examples of the use of capture filters, as well as more detail on the use
    of Wireshark and `tshark`, can be found in the following references.
  id: totrans-675
  prefs: []
  type: TYPE_NORMAL
  zh: 更多关于捕获过滤器使用的示例，以及有关 Wireshark 和 `tshark` 使用的更多细节，可以在以下参考资料中找到。
- en: See also
  id: totrans-676
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: '**Wireshark** ([https://www.wireshark.org](https://www.wireshark.org)): The
    home page for the Wireshark application has detailed documentation on how Wireshark
    can be used effectively.'
  id: totrans-677
  prefs: []
  type: TYPE_NORMAL
  zh: '**Wireshark** ([https://www.wireshark.org](https://www.wireshark.org))：Wireshark
    应用的主页上有关于如何有效使用 Wireshark 的详细文档。'
- en: '**Wireshark** ([https://en.wikipedia.org/wiki/Wireshark](https://en.wikipedia.org/wiki/Wireshark)):
    This Wikipedia article has more information about Wireshark, its history, and
    how it works.'
  id: totrans-678
  prefs: []
  type: TYPE_NORMAL
  zh: '**Wireshark** ([https://en.wikipedia.org/wiki/Wireshark](https://en.wikipedia.org/wiki/Wireshark))：这篇维基百科文章有关于
    Wireshark 的更多信息，包括它的历史和工作原理。'
- en: '**wireshark - interactively dump and analyze network traffic** ([http://manpages.debian.net/cgi-bin/man.cgi?query=wireshark](http://manpages.debian.net/cgi-bin/man.cgi?query=wireshark)):
    The Debian manpage for wireshark describes the command, its configuration, and
    its options.'
  id: totrans-679
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**wireshark - 交互式转储和分析网络流量** ([http://manpages.debian.net/cgi-bin/man.cgi?query=wireshark](http://manpages.debian.net/cgi-bin/man.cgi?query=wireshark))：Debian
    手册页描述了 wireshark 命令、其配置和选项。'
- en: '**tshark - dump and analyze network traffic** ([http://manpages.debian.net/cgi-bin/man.cgi?query=tshark](http://manpages.debian.net/cgi-bin/man.cgi?query=tshark)):
    The Debian manpage for `tshark` describes the command, its configuration, and
    options.'
  id: totrans-680
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**tshark - 转储和分析网络流量** ([http://manpages.debian.net/cgi-bin/man.cgi?query=tshark](http://manpages.debian.net/cgi-bin/man.cgi?query=tshark))：Debian
    手册页描述了 `tshark` 命令、其配置和选项。'
- en: '**wireshark-filter - Wireshark filter syntax and reference** ([http://manpages.debian.org/cgi-bin/man.cgi?query=wireshark-filter](http://manpages.debian.org/cgi-bin/man.cgi?query=wireshark-filter)):
    This Debian manpage describes Wireshark''s capture filters in detail.'
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
  zh: '**wireshark-filter - Wireshark 过滤器语法和参考** ([http://manpages.debian.org/cgi-bin/man.cgi?query=wireshark-filter](http://manpages.debian.org/cgi-bin/man.cgi?query=wireshark-filter))：这篇
    Debian 手册页详细描述了 Wireshark 的捕获过滤器。'
- en: '**CaptureFilters** ([https://wiki.wireshark.org/CaptureFilters](https://wiki.wireshark.org/CaptureFilters)):
    This website has a number of useful capture filter examples.'
  id: totrans-682
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CaptureFilters** ([https://wiki.wireshark.org/CaptureFilters](https://wiki.wireshark.org/CaptureFilters))：这个网站有许多有用的捕获过滤器示例。'
- en: '**Introduction to Wireshark** ([https://www.wireshark.org/video/wireshark/introduction-to-wireshark/](https://www.wireshark.org/video/wireshark/introduction-to-wireshark/)):
    This video is an excellent introduction to packet sniffing with Wireshark.'
  id: totrans-683
  prefs: []
  type: TYPE_NORMAL
  zh: '**Wireshark 介绍** ([https://www.wireshark.org/video/wireshark/introduction-to-wireshark/](https://www.wireshark.org/video/wireshark/introduction-to-wireshark/))：这段视频是一个很好的
    Wireshark 数据包嗅探入门。'
- en: Enabling the IPv6 network protocol
  id: totrans-684
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用 IPv6 网络协议
- en: This recipe configures your Raspberry Pi to support IPv6.
  id: totrans-685
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程配置您的树莓派以支持IPv6。
- en: The Internet Protocol's sixth version, IPv6, is intended to replace the current
    IPv4 protocol. IPv6 provides 8x10^28 more IP address than IPv4\. It is also a
    more stable, efficient, and secure protocol.
  id: totrans-686
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网协议的第六版IPv6旨在取代当前的IPv4协议。IPv6提供比IPv4多8x10^28个IP地址。它也是一个更稳定、更高效和更安全的协议。
- en: The majority of modern home network routers support both IPv4 and IPv6; however,
    not all of the older routers still in service support IPv6\. So, IPv6 is not enabled
    by default on the Raspberry Pi, which saves a bit of memory and processing power.
    To take full advantage of modern networking services, you can enable IPv6 on your
    Raspberry Pi.
  id: totrans-687
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数现代家用网络路由器都支持IPv4和IPv6；然而，并非所有仍在使用的旧路由器都支持IPv6。因此，树莓派默认情况下不启用IPv6，这样可以节省一些内存和处理能力。要充分利用现代网络服务，您可以在树莓派上启用IPv6。
- en: After completing this recipe, your Raspberry Pi will have IPv6 enabled.
  id: totrans-688
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本教程后，您的树莓派将启用IPv6。
- en: Getting ready
  id: totrans-689
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Ingredients:'
  id: totrans-690
  prefs: []
  type: TYPE_NORMAL
  zh: 配料：
- en: An Initial Setup or Basic Networking setup for the Raspberry Pi that has been
    powered on. You have also logged in as the user `pi` (see the recipes in [Chapter
    1](ch01.html "Chapter 1. Installation and Setup"), *Installation and Setup* for
    how to boot and log in and the recipes in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration* for how to log in remotely).
  id: totrans-691
  prefs: []
  type: TYPE_NORMAL
  zh: 一个已启动的树莓派的初步设置或基本网络设置。您还需要以用户`pi`登录（有关如何启动和登录的详细信息，请参见[第1章](ch01.html "第1章 安装与设置")，*安装与设置*，以及[第2章](ch02.html
    "第2章 管理")，*管理*中关于如何远程登录的教程）。
- en: This recipe does not require the desktop GUI and could either be run from the
    text-based console or from within an `LXTerminal`.
  id: totrans-692
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程不需要桌面图形界面，可以在基于文本的控制台或`LXTerminal`中运行。
- en: If the Raspberry Pi's Secure Shell server is running, this recipe can be completed
    remotely using a Secure Shell client.
  id: totrans-693
  prefs: []
  type: TYPE_NORMAL
  zh: 如果树莓派的安全外壳（SSH）服务器正在运行，可以通过安全外壳客户端远程完成本教程。
- en: How to do it...
  id: totrans-694
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The steps to installing a mesh network are:'
  id: totrans-695
  prefs: []
  type: TYPE_NORMAL
  zh: 安装网状网络的步骤如下：
- en: Log in to the Raspberry Pi either directly or remotely.
  id: totrans-696
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直接或远程登录树莓派。
- en: Use the `modprobe` command to enable the `ipv6` protocol.
  id: totrans-697
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`modprobe`命令启用`ipv6`协议。
- en: '[PRE78]'
  id: totrans-698
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: Use the `ifconfig` command to validate that all of the network interfaces now
    have IPv6 enabled (look for the `inet6 addr`).
  id: totrans-699
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`ifconfig`命令验证所有网络接口是否已启用IPv6（查找`inet6 addr`）。
- en: '[PRE79]'
  id: totrans-700
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE79]'
- en: The Raspberry Pi is now using IPv6! However, the `ipv6` module will not be automatically
    loaded at the next boot. Use the following steps to configure the module to load
    automatically.
  id: totrans-701
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 树莓派现在正在使用IPv6！然而，`ipv6`模块不会在下次启动时自动加载。请使用以下步骤将该模块配置为自动加载。
- en: Add the `ipv6` module to the bottom of the kernel's module configuration file,
    `/etc/modules`.
  id: totrans-702
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`ipv6`模块添加到内核模块配置文件`/etc/modules`的末尾。
- en: '[PRE80]'
  id: totrans-703
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: Use the `vi` command to edit the kernel module configuration file `/etc/modprobe.d/ipv6.conf`.
  id: totrans-704
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`vi`命令编辑内核模块配置文件`/etc/modprobe.d/ipv6.conf`。
- en: '[PRE81]'
  id: totrans-705
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE81]'
- en: The `vi` editor displays the contents of the configuration file. Instructions
    for using the editor can be found in the `vi` manpages (see the recipe *Reading
    the built-in documentation* in [Chapter 2](ch02.html "Chapter 2. Administration"),
    *Administration*).
  id: totrans-706
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`vi`编辑器显示配置文件的内容。使用该编辑器的说明可以在`vi`的手册页中找到（请参阅[第2章](ch02.html "第2章 管理")，*管理*中的教程*阅读内建文档*）。'
- en: '[PRE82]'
  id: totrans-707
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE82]'
- en: Change the word **off** at the end of the **alias net-pf-10** line to **on**,
    and delete the **alias ipv6** line as it is no longer true.
  id: totrans-708
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**alias net-pf-10**行末的**off**改为**on**，并删除**alias ipv6**行，因为它已经不再适用了。
- en: '[PRE83]'
  id: totrans-709
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE83]'
- en: Save the file and exit the editor (`:wq`).
  id: totrans-710
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并退出编辑器（`:wq`）。
- en: Finally, reboot the Raspberry Pi to use the new IPv6 configuration!
  id: totrans-711
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，重启树莓派以使用新的IPv6配置！
- en: '[PRE84]'
  id: totrans-712
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE84]'
- en: How it works...
  id: totrans-713
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: After logging in to the Raspberry Pi, this recipe uses the modprobe command
    to load the `ipv6` module. Simply loading the module enables IPv6 networking;
    however, the `ipv6` module will not be automatically loaded on the next reboot.
    The kernel's module configuration needs to be updated to enable an automatic load
    at boot.
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到树莓派后，本教程使用`modprobe`命令加载`ipv6`模块。简单地加载该模块即可启用IPv6网络；然而，`ipv6`模块不会在下次重启时自动加载。需要更新内核的模块配置以启用开机自动加载。
- en: The recipe uses the `echo` command running in a subshell (`sh –c`) to append
    (`>>`) the module name, `ipv6`, to the bottom of the `/etc/modules` configuration
    file. Adding the module name to the module configuration ensures that the module
    will be loaded at boot.
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
  zh: 该配方使用在子 shell 中运行的 `echo` 命令（`sh –c`）将模块名 `ipv6` 附加（`>>`）到 `/etc/modules` 配置文件的底部。将模块名添加到模块配置中可确保该模块在启动时加载。
- en: The recipe also uses the `vi` command to update the `/etc/modprobe/ipv6.conf`
    file, explicitly enabling (**on**) the complete IPv6 network protocol family (`net-pf-10`).
  id: totrans-716
  prefs: []
  type: TYPE_NORMAL
  zh: 该配方还使用 `vi` 命令更新 `/etc/modprobe/ipv6.conf` 文件，显式启用（**on**）完整的 IPv6 网络协议族（`net-pf-10`）。
- en: After the configuration is updated, the Raspberry Pi is rebooted.
  id: totrans-717
  prefs: []
  type: TYPE_NORMAL
  zh: 配置更新后，Raspberry Pi 会重启。
- en: There's more...
  id: totrans-718
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Internet Protocol version 6 not only has a larger address space but also more
    features.
  id: totrans-719
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网协议版本 6 不仅具有更大的地址空间，还有更多的功能。
- en: Privacy extensions
  id: totrans-720
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 隐私扩展
- en: 'IPv6 has two interesting privacy extensions: one that creates a new random
    address each time it''s rebooted, and another that continuously randomizes the
    address.'
  id: totrans-721
  prefs: []
  type: TYPE_NORMAL
  zh: IPv6 有两个有趣的隐私扩展：一个是在每次重启时创建一个新的随机地址，另一个则是持续地随机化地址。
- en: To enable the generation of a temporary random IPv6 address with each new boot,
    add the `net.ipv6.conf.iface.use_tempadd` Linux kernel parameter to the bottom
    of the `/etc/sysctl.conf` kernel configuration file.
  id: totrans-722
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用每次启动时生成一个临时随机 IPv6 地址，请将 `net.ipv6.conf.iface.use_tempadd` Linux 内核参数添加到
    `/etc/sysctl.conf` 内核配置文件的底部。
- en: To enable a continual refresh of the random IP address, add the kernel parameter
    `net.ipv6.conf.iface.temp_prefered_lft` to the bottom of the same file.
  id: totrans-723
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用随机 IP 地址的持续刷新，请将内核参数 `net.ipv6.conf.iface.temp_prefered_lft` 添加到同一文件的底部。
- en: The following example uses the `echo` command to append (`>>`) the two kernel
    configuration parameters to the bottom of the kernel configuration file, `/etc/sysctl.conf`.
    The IPv6 kernel parameter (`net.ipv6.conf`) for generating a temporary address
    (`use_tempadd`) is enabled (**2**) and the parameter for refreshing it (`temp_prefered_lft`)
    every two hours (**7200** seconds) is set for all interfaces. First, the `sudo
    sh` command is use to create a subshell with superuser privileges. After the kernel
    parameters are added, the subshell is exited (**exit**) and the superuser privileges
    are discarded.
  id: totrans-724
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例使用 `echo` 命令将两个内核配置参数附加（`>>`）到内核配置文件 `/etc/sysctl.conf` 的底部。IPv6 内核参数（`net.ipv6.conf`）用于生成临时地址（`use_tempadd`），并启用（**2**）每两小时刷新一次地址（`temp_prefered_lft`）（**7200**
    秒）的参数，适用于所有接口。首先，使用 `sudo sh` 命令创建一个具有超级用户权限的子 shell。内核参数添加完成后，退出（**exit**）子 shell
    并丢弃超级用户权限。
- en: '[PRE85]'
  id: totrans-725
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: Reboot the Raspberry Pi and the changes will be applied.
  id: totrans-726
  prefs: []
  type: TYPE_NORMAL
  zh: 重启 Raspberry Pi 后，变更将会生效。
- en: Use sysctl to change kernel parameters at runtime
  id: totrans-727
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 sysctl 在运行时更改内核参数
- en: The following example uses the `systctl` command to configure the extensions
    at runtime specifically for the interface `eth0`. However, the `/etc/sysctl.conf`
    will still need to be updated to automatically use them at boot.
  id: totrans-728
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例使用 `systctl` 命令专门为接口 `eth0` 配置扩展功能。但 `/etc/sysctl.conf` 仍需要更新，以确保启动时自动使用这些配置。
- en: '[PRE86]'
  id: totrans-729
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: See also
  id: totrans-730
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: '**IPv6** ([https://en.wikipedia.org/wiki/IPv6](https://en.wikipedia.org/wiki/IPv6)):
    This Wikipedia article has more information about Internet Protocol version 6.'
  id: totrans-731
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IPv6** ([https://en.wikipedia.org/wiki/IPv6](https://en.wikipedia.org/wiki/IPv6))：这篇维基百科文章提供了更多关于互联网协议版本
    6 的信息。'
- en: '**sysctl.conf – configure kernel parameters at runtime** ([http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl](http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl)):
    The Debian manpage for `sysctl` has limited information on the command.'
  id: totrans-732
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**sysctl.conf – 配置内核参数的运行时文件** ([http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl](http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl))：Debian
    的 `sysctl` 手册页面提供了有限的命令信息。'
- en: '**sysctl.conf – sysctl preload/configuration file** ([http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl.conf](http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl.conf)):
    The Debian manpage for `sysctl.conf` has limited information on the file format.'
  id: totrans-733
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**sysctl.conf – sysctl 预加载/配置文件** ([http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl.conf](http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl.conf))：Debian
    的 `sysctl.conf` 手册页面提供了有限的文件格式信息。'
