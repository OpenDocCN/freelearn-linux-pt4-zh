<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Windows Patching"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Windows Patching</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Configuring VCM to use Microsoft updates</li><li class="listitem" style="list-style-type: disc">An introduction to automated patching</li><li class="listitem" style="list-style-type: disc">Creating a patch assessment template</li><li class="listitem" style="list-style-type: disc">Windows patching – on demand</li><li class="listitem" style="list-style-type: disc">Windows patching – scheduled </li><li class="listitem" style="list-style-type: disc">Patching machines in multi-domain environments and workgroups</li><li class="listitem" style="list-style-type: disc">Patching VM templates</li><li class="listitem" style="list-style-type: disc">Patching reports</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec40"/>Introduction</h1></div></div></div><p>So far, we have covered how to deploy VCM on one or multiple tiers, how to configure it, and how to deploy agents on the machines we want to manage. In this chapter, we will have a look at patching Windows servers and desktops.</p><p>Even though all products go through rigorous quality tests, there are always some bugs left that can be exploited if they aren't fixed. Patch management comes into the picture to do this job. With the help of VCM, we can perform an automated, scheduled analysis of the infrastructure for missing patches and then deploy them as necessary. There are many tools in the market, such as Microsoft System Center Configuration Manager or BMC BSA, that can do this job, but the benefit of using VCM is that it's an integral part of the vRealize Operation suite, so you don't need to pay extra for VCM. It can not only patch Windows and Linux but can also be used to patch Unix and Mac OS. We can schedule the patching job, and VCM will perform the patching and update the status on the central console.</p><p>With the help of vRealize Automation and vRealize Orchestrator, we can automate the deployment of Windows patching. We can create a registry entry in the VM that will be captured by VCM while performing the collection, and based on that registry entry, the VM will be placed in the correct machine group, which is created for the sole purpose of patching the VMs on the same schedule.</p><p>In order to perform scheduled patching, we need to configure at least four jobs. The first one is the initial collection, which will collect status details against the <span class="strong"><strong>Patching - Windows Security Bulletins</strong></span> filter set. Once those details are in the VCM database, another job will start the initial assessment and check which patches are missing on the server. Once VCM has the details of which patches from the patch assessment template are missing on the server, it will start the actual patching job. After each patching job is finished, VCM starts its own data collection job to obtain the updated status of the server. Finally, we need to schedule a final assessment, which will update the patch status of the after patch deployment.</p></div></div>
<div class="section" title="Configuring VCM to use Microsoft updates"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec41"/>Configuring VCM to use Microsoft updates</h1></div></div></div><p>In this recipe, we will configure VCM to synchronize patch metadata with Microsoft so that we can select one or more patches and check the compliance of our infrastructure. If VCM detects non-compliance, we can deploy the patches.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec105"/>Getting ready</h2></div></div></div><p>We will need a fully deployed VCM server to work on this recipe. In order to use VCM for patching, we need Internet access to download patches from Microsoft onto the VCM Collector server. We should have proxy details available, such as IP address, port name, and user credentials. If you are on a secure network, make sure you have Internet access, at least to <a class="ulink" href="https://www.microsoft.com/">https://www.microsoft.com/</a> and <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>.</p><p>Firewall requirements are discussed in the <span class="emphasis"><em>vRealize Configuration Manager port and protocol summary</em></span> section of <a class="link" href="ch01.html" title="Chapter 1. Installing VCM">Chapter 1</a>, <span class="emphasis"><em>Installing VCM</em></span>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>Note that before you patch Windows Server 2008 and Windows 7 machines, you need to verify that the Windows Update service is running, which means that it is set to something other than <span class="strong"><strong>Disabled</strong></span>.</p></div></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec106"/>How to do it...</h2></div></div></div><p>To prepare for Microsoft patching, we will break the recipe into several steps. The proxy steps only need to be performed if you are using a proxy to access the Internet.</p><div class="section" title="Configuring a proxy"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec44"/>Configuring a proxy</h3></div></div></div><p>In a real-life scenario, the VCM server would need a proxy to access patching sites on the Internet; we need to update those settings in vRealize Configuration Manager. We can do that by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to VCM with admin privileges.</li><li class="listitem">Go to <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>General Settings</strong></span> | <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>Internet</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>HTTP Proxy Server</strong></span> and <span class="strong"><strong>Logon </strong></span>individually. Hit the <span class="strong"><strong>Edit</strong></span> button at the top and provide the proxy details.<div class="mediaobject"><img alt="Configuring a proxy" src="graphics/image_04_001.jpg"/></div></li><li class="listitem">Enter the credentials acquired in the <span class="strong"><strong>Getting Ready</strong></span> stage.<div class="mediaobject"><img alt="Configuring a proxy" src="graphics/image_04_002.jpg"/></div></li><li class="listitem">Hit <span class="strong"><strong>Next</strong></span> and then <span class="strong"><strong>Finish</strong></span>.</li></ol></div><p>Once we have filled in the proxy options, VCM can connect to the Internet and download Microsoft patches.</p><p>If you have direct access to the Internet, you don't need to fill in these details. You can skip this section. Once the proxy has been configured, we can set the frequency with which to check for updates and the languages we need to download the patches.</p><p>VCM will not download any patch on the collector unless it is required while deploying it on the managed machine and the administrator opts to download it. VCM only syncs metadata for Windows and Linux/Unix machines from <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>, and then, those details are presented to the VCM administrator as available patches for distribution.</p></div><div class="section" title="Downloading settings"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec45"/>Downloading settings</h3></div></div></div><p>The download settings are where we define the synchronization schedule and additional languages if required. Patches are available in various languages for the operating systems we have installed; here, we can choose the language required by our infrastructure. Microsoft patches are released every second Tuesday, also known as <span class="emphasis"><em>Patch Tuesday</em></span>, but there are patches that can be released out of band, so we can set the schedule to daily to make sure we don't miss those out-of-band patch details.</p><p>To configure download settings, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Settings </strong></span>| <span class="strong"><strong>General Settings</strong></span> | <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>Windows </strong></span>| <span class="strong"><strong>Bulletin and Updates</strong></span>.</li><li class="listitem">Change the schedule to suit your needs, or go with the defaults.</li></ol></div><p><span class="strong"><strong>Superseded Patches</strong></span></p><p>Some of these updates might <span class="emphasis"><em>supersede</em></span> previously installed updates, that is, Microsoft might re-release a patch or release a patch that supersedes/replaces a previous patch. The new version of the patch is the only one that needs to be installed.</p><p>An example would be Patch MS15-024 superseding Patch MS15-016, which in turn supersedes Patch MS14-085. This would mean that only Patch MS15-024 needs to be downloaded.</p><p>Microsoft's supersedence information can be found in the <span class="strong"><strong>Updates Replaced</strong></span> column of the <span class="strong"><strong>Affected Software</strong></span> table at the top of the security bulletins:</p><div class="mediaobject"><img alt="Downloading settings" src="graphics/image_04_003.jpg"/></div></div><div class="section" title="The network authority account"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec46"/>The network authority account</h3></div></div></div><p>As explained in the <span class="emphasis"><em>Service accounts</em></span> subsection of <a class="link" href="ch01.html" title="Chapter 1. Installing VCM">Chapter 1</a>, <span class="emphasis"><em>Installing VCM</em></span>, we need the network authority account. Now, we will associate those accounts with either machine groups or domains.</p><p>Start by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Network Authority</strong></span>.</li><li class="listitem">We now have the following options:<p><span class="strong"><strong>Available Domains Identified</strong></span></p><p>We added domains when we installed VCM. Have a look at step 19 of the <span class="emphasis"><em>Installing VCM – two-tier deployment</em></span> recipe from <a class="link" href="ch01.html" title="Chapter 1. Installing VCM">Chapter 1</a>, <span class="emphasis"><em>Installing VCM </em></span>for more details.</p><p><span class="strong"><strong>Available Accounts</strong></span></p><p>We assigned one network authority account during VCM deployment; have a look at step 17 of the <span class="emphasis"><em>Installing VCM – two-tier deployment</em></span> recipe from <a class="link" href="ch01.html" title="Chapter 1. Installing VCM">Chapter 1</a>, <span class="emphasis"><em>Installing VCM</em></span> for more details.</p><p><span class="strong"><strong>Assigned Accounts</strong></span></p><p>For this recipe, we will chose<span class="strong"><strong> Assigned Accounts</strong></span>.</p><p>To make it possible to patch machines in multiple domains, we need to assign available accounts to available domains or machine groups. To do this, go to <span class="strong"><strong>Assigned Accounts</strong></span> | <span class="strong"><strong>By Domain</strong></span> | <span class="strong"><strong>Active Directory</strong></span>.</p><p>The following screenshot shows the assigned network authority account for the <code class="literal">study.local</code> Active Directory domain:</p><div class="mediaobject"><img alt="The network authority account" src="graphics/image_04_004.jpg"/></div></li></ol></div></div><div class="section" title="Synchronizing patches with Microsoft"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec47"/>Synchronizing patches with Microsoft</h3></div></div></div><p>Once we have an Internet connection (either natively or using a proxy), we can synchronize patch metadata with Microsoft by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>Windows </strong></span>| <span class="strong"><strong>Bulletins </strong></span>| <span class="strong"><strong>By Bulletin</strong></span> and click on <span class="strong"><strong>Check for Update</strong></span>.<div class="mediaobject"><img alt="Synchronizing patches with Microsoft" src="graphics/image_04_005.jpg"/></div></li><li class="listitem">To monitor the status of the sync, go to <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>Job Management</strong></span> | <span class="strong"><strong>Windows </strong></span>| <span class="strong"><strong>Job Manager</strong></span> | <span class="strong"><strong>Running</strong></span>.</li><li class="listitem">Once the job is done, you can look at the bulletins under <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Bulletins </strong></span>| <span class="strong"><strong>By Bulletin</strong></span>, which can be used to create a patch assessment template.</li></ol></div><p>You will be able to see the patch details on the right-hand side now:</p><div class="mediaobject"><img alt="Synchronizing patches with Microsoft" src="graphics/image_04_006.jpg"/></div><p>In earlier releases of VCM, there was an issue with synchronization. Patches were not visible even after synchronization was complete. Here is the <span class="emphasis"><em>Knowledge Base</em></span> article for the resolution: <a class="ulink" href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2053975">
http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2053975
</a>. Fortunately, we don't need to do this in the latest version of VCM.</p></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec107"/>How it works...</h2></div></div></div><p>We are performing necessary initial configuration so that VCM can reach the Internet and synchronize patch metadata that can be used to check which patches are missing and which are not required on the machines in the infrastructure.</p><p>The proxy configuration in VCM is for the synchronization and downloading of patches once we start deploying them; they are downloaded to the collector server from the Internet.</p><div class="section" title="The download directory"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec48"/>The download directory</h3></div></div></div><p>The default download directory is <code class="literal">X:\Program Files (x86)VMware\VCM\WebConsole\L1033\Files\SUM Downloads</code>.</p><p>This directory is shared as <code class="literal">\\collector_name\cmfiles$\SUM Downloads</code>.</p><p>Note that if no Internet access is available, you must obtain the patches manually and store them in <code class="literal">\\collector_name\cmfiles$\SUM Downloads
</code> on the VCM Collector.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec108"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">More details about the network authority account can be found in the <span class="emphasis"><em>Adding a network authority account to manage machines in multiple domains</em></span> recipe from <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span></li></ul></div></div></div>
<div class="section" title="An introduction to automated patching"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec42"/>An introduction to automated patching</h1></div></div></div><p>Once we are finished with the preparation, we will have a look at how we can use VCM to automatically populate specific machine groups so that they can be patched automatically on a schedule. As discussed in the introduction of the chapter, if you are using vRealize Automation and vRealize Orchestrator to deploy new VMs, you can use them to create a registry entry that will be captured by VCM during the initial data collection. Based on that registry entry, individual VMs will be placed in their respective machine groups, which will be used for automated patching.</p><p>If you are not using an automated deploy tool to create registry entries, you have to devise a way to manually populate the machine groups every time a new machine/server is deployed.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec109"/>Getting ready</h2></div></div></div><p>Get help from a vRA and vRO expert, who will present an option on the portal for users when they request a machine; otherwise, create scripts that will add required registry entries to the managed machines.</p><p>For this recipe, we will do it manually in order to simulate the process.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec110"/>How to do it...</h2></div></div></div><p>An explanation of utilizing vRA and vRO for automated patching is out of the scope of this book; get in touch with your vRA and vRO experts for that.</p><p>An example script that can be used to add a registry entry is as follows. Each line represents a single script and will add required registry entry:</p><pre class="programlisting">REG ADD HKLM\Software\VCM-CookBook /v VCMPatchWindow /t REG_SZ /d "MW01" &#13;
REG ADD HKLM\Software\VCM-CookBook /v VCMPatchWindow /t REG_SZ /d "MW02" &#13;
REG ADD HKLM\Software\VCM-CookBook /v VCMPatchWindow /t REG_SZ /d "MW03" &#13;
REG ADD HKLM\Software\VCM-CookBook /v VCMPatchWindow /t REG_SZ /d "MW04" &#13;
</pre><p>You can use any tool to do this, or run them manually on each machine. We had a look at how this can be used to create a machine group in the <span class="emphasis"><em>Creating machine groups</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec111"/>How it works...</h2></div></div></div><p>It gives us a variable that will be used to create filters in machine groups, and then, those filters will make sure the machines in the respective machine groups can be patched on a schedule. To create a machine group based on this captured registry entry, have a look at the <span class="emphasis"><em>Creating machine groups</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec112"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">As mentioned in the recipe, have a look at <span class="emphasis"><em>Creating machine groups</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span></li><li class="listitem" style="list-style-type: disc">For setting up scheduled patching, go through the <span class="emphasis"><em>Windows patching – scheduled</em></span> recipe later in this chapter</li></ul></div></div></div>
<div class="section" title="Creating a patch assessment template"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec43"/>Creating a patch assessment template</h1></div></div></div><p>A patch assessment template is basically a list of patches grouped together, for example, all patches for Windows Server 2008, all security patches for a specific month, or only security updates for all Windows operating systems. We can create either a static template or a dynamic template. In a static template, we choose patches manually, while in a dynamic template, we define criteria based on the patch release date, severity of the patch, product, and so on.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec113"/>Getting ready</h2></div></div></div><p>Before starting this recipe, we need a fully functional VCM setup and to follow the steps mentioned in <span class="emphasis"><em>Configuring VCM to use Microsoft updates</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec114"/>How to do it...</h2></div></div></div><p>You are tasked with implementing your organization's patch policy for Windows servers, and your security team will test and provide you with a list of approved patches on a monthly basis. You need to create a patch template and make sure all your servers are patched according to approved patches.</p><p>To start with, you need to create a patch template and update it on a monthly basis. As you will get a list of approved patches, it's better you create a static template and keep adding patches every month.</p><p>To create the patch assessment template, follow this process:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">After logging in to VCM, go to <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Assessment Template</strong></span> and click on <span class="strong"><strong>Add</strong></span>. This will launch the wizard.</li><li class="listitem">Give a name, proper description, and, depending on your requirements, select <span class="strong"><strong>Dynamic Template</strong></span> or <span class="strong"><strong>Static Template</strong></span>.</li><li class="listitem">In our case, we need to select <span class="strong"><strong>Static Template</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_007.jpg"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Static Template</strong></span>, select the required patches and save the template.</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_008.jpg"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Dynamic Template</strong></span>, define criteria; VCM will then populate the patches on that basis.</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_009.jpg"/></div></li></ol></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>Note that once a template type is selected and saved, it cannot be changed to another type.</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec115"/>How it works...</h2></div></div></div><p>We cannot deploy patches without creating assessment templates; these will be used for assessing the status of the machines, checking missing patches, and then deploying them.</p><p>As explained, you can create a dynamic monthly template to assess and update Windows templates in vCenter, as those will be patched monthly and we don't need them to be assessed with a big, long assessment template.</p><p>We can create a big assessment template that can be used to scan and check the entire infrastructure with live machines and will include only those patches that are approved by the company's security team.</p><p>You should note that if some users with administrative access uninstall a patch, then this big assessment template comes in handy, as it will have the uninstalled patch listed, and then VCM will reinstall the patch.</p><p>Here is a comparison of the template types:</p><p><span class="strong"><strong>Dynamic template</strong></span>: This updates the patch list based on the conditions we provide while creating it. Refer to the previous screenshot: we have options to filter patches based on parameters such as <span class="strong"><strong>Bulletin Name</strong></span> or <span class="strong"><strong>Last X Days</strong></span>, so we can have a monthly assessment template ready for the current month; or by severity, so we can have security patches only.</p><p><span class="strong"><strong>Static template</strong></span>: This template does not update itself on its own; the administrator needs to log in to VCM to add/remove the patches from the list. If your security team releases a list of approved patches every month, you can create a master template and keep adding new patches, removing patches that are superseded, and keep an updated assessment template ready for deployment.</p><p>Every template has a unique ID associated with it in the VCM database; if we create a template, use it in deployment, delete it, and then recreate a template with the same name, then this newly created template will be treated as a different template by VCM and will not be used automatically in the deployment that had been using the old template.</p></div></div>
<div class="section" title="Windows patching &#x2013;&#xA0;on demand"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec44"/>Windows patching – on demand</h1></div></div></div><p>Once the patch assessment template is ready, we need to first assess machines for missing patches and then use that to patch them. The assessment will also be used to check patch compliance in the form of reports, which we will cover at the end of this chapter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec116"/>Getting ready</h2></div></div></div><p>We will need the VCM server connected to the Internet and configured as in the <span class="emphasis"><em>Configuring VCM to use Microsoft updates</em></span> and <span class="emphasis"><em>Creating a patch assessment template</em></span> recipes. We can either use the default machine groups created by VCM or create groups as necessary; the process was explained in the <span class="emphasis"><em>Creating machine groups</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec117"/>How to do it...</h2></div></div></div><p>We will use the default machine groups listed in the recipe just mentioned and will not create any new ones for now. So, we will start by logging in to VCM and following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>Windows </strong></span>| <span class="strong"><strong>Assessment Template</strong></span>.</li><li class="listitem">Select the assessment template, making sure the proper machine group is selected at the top (machine groups are used to filter selected machines instead of showing all the machines managed by VCM).</li><li class="listitem">If you click on the data grid, you will be able to see the status of all the machines on which the VCM agent is installed and which are a part of the selected machine group. If <span class="strong"><strong>Data Age</strong></span> is <span class="strong"><strong>N/A</strong></span>, then we need to perform a data collection for those machines. The following screenshot shows the <span class="strong"><strong>Suggested Patch</strong></span> value as <span class="strong"><strong>Must reassess - Machine Added After Assessment run</strong></span> for the <code class="literal">dc01</code> machine:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_010.jpg"/></div></li><li class="listitem">Simply select the machine(s) and click on <span class="strong"><strong>Collect</strong></span> in the top-left corner. This will launch a wizard; make sure all the required machine(s) are part of the <span class="strong"><strong>Selected</strong></span> box on the right-hand side.</li><li class="listitem">Select <span class="strong"><strong>Select a collection Filter set to apply to those machines</strong></span> and <span class="strong"><strong>do not Limit collection to Deltas</strong></span>; any priority is fine, so go with the default.</li><li class="listitem">Under <span class="strong"><strong>Filter Sets</strong></span>, select <span class="strong"><strong>Patching - Windows Security Bulletins</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_011.jpg"/></div><p>Make sure the job is completed successfully; it will take 10 minutes to add the details to the VCM database.</p></li><li class="listitem">Once the collection is complete, click on <span class="strong"><strong>Assess</strong></span>. This will check the patch status of each machine. The content of the assessment template will be checked against the managed machine's patch status. The results will then be presented with details of missing or installed patches.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_012.jpg"/></div></li><li class="listitem">After the assessment, you will be given options such as <span class="strong"><strong>I</strong></span><span class="strong"><strong>nstalling the missing patches</strong></span> or <span class="strong"><strong>No Affected Product Installed</strong></span>. To install missing patches, select them and click on <span class="strong"><strong>Deploy</strong></span>. This will again launch a wizard.</li><li class="listitem">On the first page, select the patches you want to deploy.</li><li class="listitem">In the next step, it will try to find the location of the patches. It will report whether the patch was found and include the bulletin number:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>
<span class="strong"><strong>Found on Collector</strong></span>
</em></span>: The Windows patch file was found in the download directory.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Found on the Internet</strong></span>: The Windows patch file was found on the download site and must be downloaded.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Not Found</strong></span>: The Windows patch file was not found on the Collector or the Internet.</li></ul></div></li><li class="listitem">We need to download a patch before installing, so select <span class="strong"><strong>Download Now</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>
<span class="strong"><strong>Download at run time</strong></span>
</em></span>: This pulls the patch down to the default download directory or the alternate local patch path when the patch is deployed. Because the deployment can be scheduled, you can run the deployment and download the files when heavy loads do not occur on your network.</li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>
<span class="strong"><strong>Download now</strong></span>
</em></span>: This pulls the patch files down to the default download directory or the alternate local patch path immediately. Depending on your network load and the number of files to download, you can download the patch files immediately.</li></ul></div></li><li class="listitem">As this is on-demand patching, select <span class="strong"><strong>Copy patches to target machines during deployment</strong></span> and <span class="strong"><strong>Run Action now</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_013.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>Reboot Options</strong></span> as required.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_014.jpg"/></div></li><li class="listitem">Download the patches, and the deployment will start.<p>The deployment can be monitored at <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Job Management</strong></span> | <span class="strong"><strong>Windows </strong></span>| <span class="strong"><strong>Job Manager</strong></span> | <span class="strong"><strong>Running</strong></span>.</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_015.jpg"/></div></li><li class="listitem">Once the patches are deployed on the target machine, it will display a message like this:</li></ol></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_016.jpg"/></div><p>After we have started the deployment, we probably want to monitor how it's going. To do so, click on <span class="strong"><strong>Jobs</strong></span> on the VCM console and follow the <span class="strong"><strong>Patching</strong></span> job. Once the patch has been deployed, we need to check the status being updated in VCM console, that is, earlier under <span class="strong"><strong>Suggested Patch</strong></span>, it showed <span class="strong"><strong>Install the Patch</strong></span>, and now, it should show <span class="strong"><strong>None (Patch Already Applied)</strong></span>. For that, go back to <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Assessment Template</strong></span> | &lt;The patch template you used at the start&gt; and start the collection. Once the collection is complete, perform an assessment (click on <span class="strong"><strong>Assess</strong></span> in the top menu), and a refresh will give you the desired result, that is, the status of the managed machines–whether the patch was deployed or the machine failed or is still waiting for a reboot (if not, set to reboot when deploying patches).</p><p>The following screenshot shows the status after running the assessment on a managed machine after patch deployment, reboot, and data collection:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_017.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note36"/>Note</h3><p>Note that VCM runs <span class="strong"><strong>Job Summary: Patching Automated Collection - Patching - Windows Security Bulletins</strong></span> to run a collection after patching, but it sometimes takes a while to run this collection. We can run the collection the same way we did at the start of the recipe and perform an assessment.</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec118"/>How it works...</h2></div></div></div><p>After the initial assessment, VCM identifies which patches are missing on the server, based on which it gives you the Suggested Patch advice, such as installing missing patches. You can choose to install missing patches. Now, VCM tries to find out whether the patch is available on the Collector server–downloaded for installation on another server–or is available on Internet; this is where proxy configuration comes in handy. If the patch is not available on the Collector server, it offers to download the patch.</p><p>Once the patch download is complete, it stages the patch on the managed machine and starts installing it. Once the patch installation is over and if the patch requires a reboot, depending upon the options we have selected, it will reboot the server. After the server is rebooted, it performs a post-patch collection and then updates the status to VCM regarding the patch we installed. If we perform another assessment after the patching and data collection, we can check the current status of the patch: it must be installed.</p></div></div>
<div class="section" title="Windows patching &#x2013;&#xA0;scheduled"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Windows patching – scheduled</h1></div></div></div><p>In the previous recipe, we deployed a patch on demand and found we need to run a few tasks to finish the job. We cannot afford to wait in front of the server every time to perform an on-demand patching; hence, what we can do is schedule patch deployment. Because the assessment is run only against data in the VCM database, we must collect patching data from managed machines before and after we run an assessment.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec119"/>Getting ready</h2></div></div></div><p>We will need a VCM server that has an Internet connection and has been through the earlier recipes, such as <span class="emphasis"><em>Prepare VCM for Windows patching</em></span> and <span class="emphasis"><em>Creating a patch assessment template</em></span>. For scheduled patches, it is recommended to have machine groups created before we start the process.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec120"/>How to do it...</h2></div></div></div><p>As seen in the previous recipe, we need to follow four steps to completely perform the patching job; hence, we will schedule four tasks for completing one single patch maintenance window.</p><p>The tasks will be as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Initial collection</strong></span>: Collecting patch status data from machines before patching</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Initial assessment</strong></span>: Comparing collected data against the assessment template before patching</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Deploying patches</strong></span>: Installing patches according to schedule</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Final assessment</strong></span>: Comparing collected data against the assessment template after patching</li></ul></div><p>This is a planned schedule that will look like this:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. no.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Name</strong></span></p>
</td><td>
<p><span class="strong"><strong>Schedule</strong></span></p>
</td><td>
<p><span class="strong"><strong>Reason</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p>Initial collection </p>
</td><td>
<p>First Sunday at 08:00 am</p>
</td><td>
<p>12 hours before the actual patch</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p>Initial assessment </p>
</td><td>
<p>First Sunday at 02:00 pm</p>
</td><td>
<p>6 hours before the actual patch</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p>Deploy patch</p>
</td><td>
<p>First Sunday at 08:00 pm</p>
</td><td>
<p>Scheduled patch maintenance window</p>
</td></tr><tr><td>
<p><span class="strong"><strong>4</strong></span></p>
</td><td>
<p>Final assessment</p>
</td><td>
<p>First Sunday at 11:00 pm</p>
</td><td>
<p>3 hours after patching to give time for automated collection (happens after 30 minutes of patching and reboot)</p>
</td></tr></tbody></table></div><div class="section" title="Initial collection"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec49"/>Initial collection</h3></div></div></div><p>We can't install a patch unless VCM knows whether it is required; in the initial collection, we will update the VCM database with this information. VCM creates a filter set called <span class="strong"><strong>Patching - Windows Security Bulletins</strong></span> and updates it after each new patch released by Microsoft.</p><p>In this example, we will use a machine group called <code class="literal">VCM-CookBook-MW01</code>, which we have created for this demonstration.</p><p>Follow these steps to start automatic Windows patch deployment configuration:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To perform initial collection, we need to log in to VCM with admin privileges and go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Job Manager</strong></span> | <span class="strong"><strong>Scheduled</strong></span>, click on <span class="strong"><strong>Add</strong></span>, and select <span class="strong"><strong>Collection</strong></span><span class="emphasis"><em>.</em></span></li><li class="listitem">Provide a proper name and add description.</li><li class="listitem">Make sure you select <span class="strong"><strong>Patching - Windows Security Bulletins</strong></span> as the <span class="strong"><strong>Filter Set</strong></span>.</li><li class="listitem">Select the correct machine group for this scheduled maintenance window.</li><li class="listitem">Provide a proper schedule, as described in the table at the start of this recipe.</li></ol></div><p>Once the initial collection against the required filter set has been scheduled, we can move to the next step, initial assessment<span class="emphasis"><em>.</em></span></p></div><div class="section" title="Initial assessment"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec50"/>Initial assessment</h3></div></div></div><p>The initial assessment involves checking the status of patches against the machines whose data has been collected in the previous step. We are giving 6 hours to VCM to properly collect the data from all the machines; hence, this job can be scheduled after 6 hours of initial data collection and 6 hours before actual patch time. Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Job Management</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Scheduled</strong></span> | <span class="strong"><strong>Assessment</strong></span> and click on <span class="strong"><strong>Add</strong></span>.</li><li class="listitem">Provide a proper job name related to the maintenance window and a proper description.</li><li class="listitem">Select the correct template.<div class="mediaobject"><img alt="Initial assessment" src="graphics/image_04_018.jpg"/></div></li><li class="listitem">Select an associated machine group.</li><li class="listitem">Select an appropriate schedule, as discussed at the start of this recipe.</li></ol></div></div><div class="section" title="Deploying patches"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec51"/>Deploying patches</h3></div></div></div><p>At this moment, the VCM server has information about which patches are missing on the machines that are a part of the machine group, and now, we can schedule the actual patch deployment task by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Automatic Deployment</strong></span>. Click on <span class="strong"><strong>Add</strong></span>.</li><li class="listitem">Select the correct machine group responding to the maintenance window.</li><li class="listitem">Select the required assessment template.</li><li class="listitem">On this page, select <span class="strong"><strong>Scheduled Automatic Deployment</strong></span><span class="strong"><strong> Run</strong></span> and, if your company policy approves, select <span class="strong"><strong>Reboot immediately after deployment</strong></span>.</li><li class="listitem">For <span class="strong"><strong>Threshold Data Age</strong></span>, we can go ahead with the default of <code class="literal">2</code>, as we have already scheduled jobs to collect data and perform the assessment 12 hours before the actual patch time.<div class="mediaobject"><img alt="Deploying patches" src="graphics/image_04_019.jpg"/></div></li><li class="listitem">Finally, select the schedule we decided on at the start of the recipe and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">We will be done with the third step once we click on <span class="strong"><strong>OK</strong></span>.</li></ol></div></div><div class="section" title="Final assessment"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec52"/>Final assessment</h3></div></div></div><p>So far, we have scheduled data collection and assessment and then done the actual patching. Now, we will schedule a task that will update the VCM database with these updates. In the previous recipe, we learned that after performing a patch deployment, when the machine reboots, VCM starts a collection job to collect details of the machine after patch installation. So, we just need to schedule an assessment the same way we did in the initial assessment step; we just need to make sure the name and description indicate that this is the final assessment and it is scheduled some time after the patch installation (3 hours, as decided at the start) to give some time to the VCM server to finish the job. Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Job Management</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Scheduled</strong></span> | <span class="strong"><strong>Assessment</strong></span> and click on <span class="strong"><strong>Add</strong></span>.</li><li class="listitem">Provide a proper job name related to the maintenance window and a proper description.</li><li class="listitem">Select the correct template.</li><li class="listitem">Select the associated machine group.</li><li class="listitem">Select the appropriate schedule, as discussed at the start.</li></ol></div><p>Once we are done with the final assessment, VCM will update the current details on the user interface and in the reports.</p></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec121"/>How it works...</h2></div></div></div><p>This makes life much easier for the admins, who are responsible for patching. All the activities required for patching can be and are scheduled so that admins don't need to sit in front of the VCM console and push patches.</p><p>We scheduled an initial collection, which used the <span class="strong"><strong>Patching - Windows Security Bulletins</strong></span> filter set, which made sure we have the latest details of the managed servers in the VCM database. Based on the data collected, we performed an initial assessment. This performed a check against the patching template and provided us with information about the patch requirements.</p><p>This is followed by actual patches being downloaded from the Internet if missing on the collector server and then being staged on the managed machine. Once the time is right, the VCM agent installs the patches and performs a reboot as configured. After the patches are installed, VCM initiates the data collection again using the same filter set, <span class="strong"><strong>Patching - Windows Security Bulletins</strong></span>, but this time, we have updated details as the patches have been installed now.</p><p>This updated information is added to the VCM database and used in the final assessment to obtain the status of the current patch.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec122"/>There's more...</h2></div></div></div><p>Apart from the regular options, there are some additional settings that you should pay attention to if you plan to manage a medium-to-large infrastructure.</p><p>Here are the details you need to configure your infrastructure. You need to log in with VCM admin privilege and go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>General Settings</strong></span> | <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Additional Settings</strong></span>.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. no.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Setting</strong></span></p>
</td><td>
<p><span class="strong"><strong>Explanation</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p>Automatic patch deployment - the threshold data age (days)</p>
</td><td>
<p>This sets the automatic patch deployment to trigger based on the threshold data age. When the data age of the patch bulletin is greater than the threshold data age, VCM does not deploy the patches. To update the data age for the patch bulletin, you must run a new collection and assessment.</p><p>
</p><p>The default is <code class="literal">2</code> days, which you can modify if required.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p>The timeout in minutes for the entire patch deployment job</p>
</td><td>
<p>The time for which to run the patch deployment job before the process times out.</p><p>
</p><p>The default is <code class="literal">60</code>; if you have large number of machines getting patched in one go, then this needs to be changed to a higher value, such as <code class="literal">120</code> or <code class="literal">180</code>, depending upon how many machines you have and the approved maintenance window.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p>The wait time (in minutes) before performing the post collection, for patches that require a reboot</p>
</td><td>
<p>This determines how long VCM will wait before collecting patch status data from rebooted managed machines after the patch deployment is finished.</p><p>
</p><p>The default is <code class="literal">30</code> minutes; if you think this is too much or too little, you can change it.</p>
</td></tr></tbody></table></div><div class="mediaobject"><img alt="There's more..." src="graphics/image_04_020.jpg"/></div><p>You need to log in with VCM admin privileges and go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>General Settings</strong></span> | <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Deployments</strong></span>.</p><p>Change the value of the maximum concurrent agent installs from <code class="literal">21</code> to a higher value.</p><p>If in the additional settings you have selected <code class="literal">60</code> minutes as the timeout in minutes for the entire patch deployment job and you have this maximum concurrent set to the default <code class="literal">21</code>, then there are chances that some machines might get a timeout and not get the patches deployed if you have a very large assessment template. This can create some issues, as we might have some machines without patches in a month.</p><div class="mediaobject"><img alt="There's more..." src="graphics/image_04_021.jpg"/></div></div></div>
<div class="section" title="Patching machines in multi-domain environments and workgroups"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec46"/>Patching machines in multi-domain environments and workgroups</h1></div></div></div><p>Typically, in medium-to-large organizations, more than one Active Directory domain exists. We can use VCM to patch servers in multiple domains. Here is what you need to do that.</p><p>Apart from multiple domains, there are machines that are part of none, or they are in a workgroup. To manage and patch the machines in a workgroup, you need a network authority account assigned to a machine group populated with machines in a workgroup.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec123"/>Getting ready</h2></div></div></div><p>We need to follow the <span class="emphasis"><em>Adding a network authority account to manage machines in multiple domains</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>, with correct domains and their respective NAA accounts for patching multi-domain servers.</p><p>For patching machines in a workgroup, we need to create a machine group with static memberships and add all machines that are not in the domain.</p><p>Open the necessary ports between the VCM server and the managed servers either in a workgroup or in another domain.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec124"/>How to do it...</h2></div></div></div><p>We will approach this recipe in two ways:</p><p>First, we will discuss multiple domains.</p><p>The first thing we need to do is configure all the required <span class="strong"><strong>Network Access Account</strong></span> (<span class="strong"><strong>NAA</strong></span>) accounts as per the <span class="emphasis"><em>Adding a network authority account to manage machines in multiple domains</em></span> recipe from <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>.</p><p>Then, you can follow the <span class="emphasis"><em>Windows patching – on demand</em></span> recipe from this chapter for on-demand patching or the <span class="emphasis"><em>Windows patching – scheduled</em></span> recipe for scheduled patching.</p><p>The second way is for workgroup servers.</p><p>We need to add an available account with a <code class="literal">.</code> (dot) domain and a username and password common to the workgroup machines. Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Network Authority</strong></span>, under <span class="strong"><strong>Available Accounts</strong></span> and click on <span class="strong"><strong>Add</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_022.jpg"/></div></li><li class="listitem">Once the accounts have been added, we need to associate them with the machine group created for workgroup machines.</li><li class="listitem">If there are no common accounts available, then we can add one account per server in following format. Here, <span class="strong"><strong>Domain </strong></span>is the name of the machine:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_023.jpg"/></div></li><li class="listitem">So now, go to <span class="strong"><strong>Assigned Accounts</strong></span> by <span class="strong"><strong>Machine Group</strong></span>, select a machine group for the workgroup machines, and assign the accounts added earlier.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_024.jpg"/></div></li></ol></div><p>As explained in the previous recipe, VCM tries all the accounts until it finds a working account; there is no problem in assigning all the accounts to the machine group.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note37"/>Note</h3><p>Note that we cannot have multiple accounts with the same account name and domain, so for the <code class="literal">.</code> (dot) domain, we can't have more than one administrator as a user registered in the available accounts.</p></div></div><p>There is another alternative: if, for some reason, you do not wish to assign all the accounts to the machine group, you can create network authority accounts and then assign one account to each machine, making sure that when adding the available account, the domain is defined as the machine name.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Once you have added the required accounts, go to <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Licensed Machines</strong></span> | <span class="strong"><strong>Licensed Windows Machines</strong></span>.</li><li class="listitem">Select the machine whose network authority account needs to be changed; click on the <span class="inlinemediaobject"><img alt="How to do it..." src="graphics/image_04_025.jpg"/></span>symbol in the menu, and it will launch the wizard.</li><li class="listitem">Make sure the machine whose NAA we are changing is available under <span class="strong"><strong>Selected</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_026.jpg"/></div></li><li class="listitem">Select the associated network authority account for this machine.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_027.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> and then complete the wizard.</li><li class="listitem">To make sure the account has been changed correctly, scroll to the extreme right and validate under the <span class="strong"><strong>Network Authority</strong></span> column for the machine.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_028.jpg"/></div></li></ol></div><p>After this change, we can successfully manage the machine from VCM, which includes collecting data, installing software and patches, and checking and enforcing compliance.</p><p>Then, you can follow either the <span class="emphasis"><em>Windows patching – on demand</em></span> or <span class="emphasis"><em>Windows patching – scheduled</em></span> recipes, based on your requirements.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec125"/>How it works...</h2></div></div></div><p>The defined network authority account will be used by VCM to manage the patching of the machines in the workgroup.</p></div></div>
<div class="section" title="Patching VM templates"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Patching VM templates</h1></div></div></div><p>It is essential that when VMs are first provisioned, the virtual machine template to be used is up to date. This will reduce the downtime for the end consumer of the VM when they come to patch, and reduce system-wide vulnerabilities.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec126"/>How to do it...</h2></div></div></div><p>Follow these steps to patch a VM template:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To patch a VM template, convert it into a VM, provide an IP, and make sure it can reach the VCM server.<p>The agent installer should be available on each template.</p></li><li class="listitem">Once the agent has been installed, license the machine in VCM and perform a collection.</li><li class="listitem">The machine should be a part of a machine group called <span class="strong"><strong>Template Patching</strong></span>. Perform on-demand patching.</li><li class="listitem">After patches have been installed and the VM rebooted and validated by VCM for the patch status, uninstall the agent.</li><li class="listitem">Purge the VM in VCM.</li><li class="listitem">Convert the VM back into a template.</li></ol></div></div><div class="section" title="How it works"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec127"/>How it works</h2></div></div></div><p>This is a completely manual process, where we convert the template in to a virtual machine, install the agent, and then install patches. After patching is over, we purge the machine from the VCM console after uninstalling the agent and finally convert the machine to a vCenter template.</p></div></div>
<div class="section" title="Patching reports"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Patching reports</h1></div></div></div><p>Once the infrastructure has been patched, what we need are fancy reports to show to the management that we are all green in terms of patching. VCM does not disappoint you when it comes to reports–there are multiple preconfigured reports, which can be either scheduled or run on demand and exported to multiple formats such as <code class="literal">.xls</code>, <code class="literal">.doc</code>, <code class="literal">.csv</code>, and <code class="literal">.pd</code>f.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec128"/>Getting ready</h2></div></div></div><p>We must have a compliance template ready before we can begin with the recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec129"/>How to do it...</h2></div></div></div><p>Once logged in to VCM, go to the reporting section.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Reports </strong></span>| <span class="strong"><strong>Machine Group Reports</strong></span> | <span class="strong"><strong>VCM Patching</strong></span>.<p>These are the default reports available in VCM for Windows patching:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Ser</strong></span></p>
</td><td>
<p><span class="strong"><strong>Name </strong></span></p>
</td><td>
<p><span class="strong"><strong>Description </strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p>VCM Patching Assessment Based</p>
</td><td>
<p>These reports use data generated by VCM patching assessments (on the VCM Patching slider) to generate their patch status results</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p>Patch Status Summary</p>
</td><td>
<p>This displays the patching status across the enterprise for Windows and Unix</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p>VCVP Windows Patch Status Details</p>
</td><td>
<p>This displays details of virtualization machines' Windows patch statuses</p>
</td></tr><tr><td>
<p><span class="strong"><strong>4</strong></span></p>
</td><td>
<p>Windows Patch Assessment by Bulletin Information</p>
</td><td>
<p>This enables VCM patching by bulletin</p>
</td></tr><tr><td>
<p><span class="strong"><strong>5</strong></span></p>
</td><td>
<p>Windows Patch Assessment by Product Information</p>
</td><td>
<p>This enables VCM patching by product information</p>
</td></tr><tr><td>
<p><span class="strong"><strong>6</strong></span></p>
</td><td>
<p>Windows Patch Assessment Results Details</p>
</td><td>
<p>This displays the details of the VCM patching assessment by machine, bulletin, or template</p>
</td></tr><tr><td>
<p><span class="strong"><strong>7</strong></span></p>
</td><td>
<p>Windows Patch Assessment Results Details By Bulletin</p>
</td><td>
<p>This displays Windows patch assessment results details grouped by bulletin</p>
</td></tr><tr><td>
<p><span class="strong"><strong>8</strong></span></p>
</td><td>
<p>Windows Patch Assessment Results Details By Machine</p>
</td><td>
<p>This displays Windows patch assessment results details grouped by machine</p>
</td></tr><tr><td>
<p><span class="strong"><strong>9</strong></span></p>
</td><td>
<p>Windows Patch Assessment Results Details By Template</p>
</td><td>
<p>This displays Windows patch assessment results details grouped by template</p>
</td></tr><tr><td>
<p><span class="strong"><strong>10</strong></span></p>
</td><td>
<p>Windows Patch Assessment Results Trends</p>
</td><td>
<p>This displays the trends for VCM patching assessment templates by day, week, month, or quarter</p>
</td></tr><tr><td>
<p><span class="strong"><strong>11</strong></span></p>
</td><td>
<p>Windows Patch Assessment Trends</p>
</td><td>
<p>This displays the trends for VCM patching assessments by day, week, month, or quarter</p>
</td></tr><tr><td>
<p><span class="strong"><strong>12</strong></span></p>
</td><td>
<p>Windows Patch Status</p>
</td><td>
<p>This displays the Windows patch status</p>
</td></tr><tr><td>
<p><span class="strong"><strong>13</strong></span></p>
</td><td>
<p>Windows Patch Status by Template Details</p>
</td><td>
<p>This provides the VCM patching patch status by template details</p>
</td></tr><tr><td>
<p><span class="strong"><strong>14</strong></span></p>
</td><td>
<p>Windows Patch Status by Template Summary</p>
</td><td>
<p>This provides the VCM patching patch status by template summary</p>
</td></tr><tr><td>
<p><span class="strong"><strong>15</strong></span></p>
</td><td>
<p>Windows Patch Status Details</p>
</td><td>
<p>This provides Windows patch status details</p>
</td></tr></tbody></table></div></li><li class="listitem">From the VCM console, select the report you want to run, and click on <span class="strong"><strong>Run</strong></span>; the wizard will start. Once the details are filled in, it will show the report. As discussed, the report can be exported into multiple formats to be used by the administrator.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_029.jpg"/></div></li><li class="listitem">The important thing we need to remember here is the machine group selection on the top; this filters the machines that will be included in the report.</li><li class="listitem">We can schedule reports as well. We will have more details about that in <a class="link" href="ch08.html" title="Chapter 8. Integration with vROps and Scheduling">Chapter 8</a>, <span class="emphasis"><em>Integration with vROps and Scheduling</em></span>, in the <span class="emphasis"><em>Scheduling reports</em></span> recipe.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_04_030.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec130"/>How it works...</h2></div></div></div><p>There is a big list of existing reports that we can run and export. We can even schedule those reports, and then, they can be either exported to a location or mailed to a specified e-mail id if working SMTP is configured.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec131"/>There's more...</h2></div></div></div><p>You can have a look at scheduling reports in the <span class="emphasis"><em>Scheduling patching reports</em></span> recipe of <a class="link" href="ch08.html" title="Chapter 8. Integration with vROps and Scheduling">Chapter 8</a>, <span class="emphasis"><em>Integration with vROps and Scheduling</em></span>.</p></div></div></body></html>