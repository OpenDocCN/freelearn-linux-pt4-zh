<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Integration with vROps and Scheduling"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Integration with vROps and Scheduling</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing and configuration of vROps Management Pack for VCM</li><li class="listitem" style="list-style-type: disc">Configuring vROps – VCM compliance mapping and scheduling</li><li class="listitem" style="list-style-type: disc">Scheduling OS and compliance data collection</li><li class="listitem" style="list-style-type: disc">Scheduling compliance</li><li class="listitem" style="list-style-type: disc">Scheduling reports</li><li class="listitem" style="list-style-type: disc">Scheduling vCenter collections</li><li class="listitem" style="list-style-type: disc">Scheduling vCenter discovery</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec79"/>Introduction</h1></div></div></div><p>We will be discussing two different topics in the chapter. First, we will install the VCM adapter in vROps and integrate them so that we can send compliance data from VCM to vROps.</p><p>Nobody likes to be in front of any console to do the work, and automation is the key to everything. In this chapter, we will take a look at the scheduler feature of VCM, such as scheduling jobs to collect the data from managed machines, pushing the compliance details to vROps, or exporting a report and saving it on a share or sending to someone on e-mail.</p><p>So, let's begin with vROps and VCM integration.</p></div></div>
<div class="section" title="Installing and configuration of vROps Management Pack for VCM"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec80"/>Installing and configuration of vROps Management Pack for VCM</h1></div></div></div><p>Integrating VCM with vROps provides compliance and event details from VCM to the vROps console. This means that you can have an idea about what's going on with a particular server when you are troubleshooting. An event can give information, such as when the server was rebooted, when the pathing was done, or when the software was installed from VCM. Apart from this, VCM can push compliance details about the managed machine with the mappings that have been created.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec227"/>Getting ready</h2></div></div></div><p>We will need a configured VCM that has compliance configuration completed, and a working vROps server where we have admin access. We will also need user credentials that can log in to VCM and have admin access in the VCM application. We need to download the latest VCM solution from <a class="ulink" href="https://solutionexchange.vmware.com/">
https://solutionexchange.vmware.com/
</a>.</p><p>vROps must be monitoring the same vCenter server that is managed by VCM.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec228"/>How to do it...</h2></div></div></div><p>In this recipe, we are going to install the VCM adapter for vROps. We will be logging into vROps and following the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to vROps with an admin account, or another account that has admin privileges, and go to <span class="strong"><strong>Solutions</strong></span>. Click on the green plus symbol under <span class="strong"><strong>Solutions</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_001.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Browse</strong></span> and go to the location where you have downloaded the VCM solution from the Internet and click on <span class="strong"><strong>Upload</strong></span>. You will then get a screen similar to the following screenshot:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_002.jpg"/></div></li><li class="listitem">Accept the unsigned solution warning if displayed by vROps.</li><li class="listitem">Accept the EULA.</li><li class="listitem">Let vROps complete the installation, and once done, click on <span class="strong"><strong>Finish</strong></span> to complete it.</li><li class="listitem">This completes the installation of the adapter. Now we need to configure the adapter instance.</li><li class="listitem">This time, under <span class="strong"><strong>Solutions</strong></span>, select <span class="strong"><strong>Management Pack for </strong></span><span class="strong"><strong>VCM</strong></span><span class="strong"><strong> for vSphere</strong></span> and click on the <span class="strong"><strong>Configure</strong></span> button at the top with two gears:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_003.jpg"/></div></li><li class="listitem">Provide the following details:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Display Name</strong></span>: This will be the name displayed for the adapter</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Description</strong></span>: Provide a good description so someone can understand what it is, when you are not around</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Host: </strong></span>This is the IP or name of the VCM database server (for single-tier, it's the VCM Collector server)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Port:</strong></span> This is the SQL port on the VCM server</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Name:</strong></span> This is the VCM database name; the default is <code class="literal">VCM</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Instance:</strong></span> If you have installed SQL as <span class="strong"><strong>Instance</strong></span>, provide the name that can be kept blank for default<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_004.jpg"/></div></li></ul></div></li><li class="listitem">Provide the following details for the <span class="strong"><strong>Manage Credential</strong></span> window:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Credential Name</strong></span>: This is a descriptive name for the credential</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Username</strong></span>: This is the database user account for the VCM database<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note59"/>Note</h3><p><span class="strong"><strong>Note</strong></span> that you have to create a dedicated service account in the Active Directory for this, and give this account an admin role in VCM.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Password</strong></span>: This is the password for the user account</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Authentication</strong></span>: This will be either SQL or Windows authentication (recommended)</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Windows Domain</strong></span>: In case of Windows authentication, provide the domain name, as shown in the following screenshot:</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_005.jpg"/></div></li><li class="listitem">After the information is provided, click on <span class="strong"><strong>Test Connection</strong></span>.</li><li class="listitem">Once the test is successful, click on <span class="strong"><strong>Save Settings</strong></span>. Don't worry about the advanced settings, you can keep the default settings for time being.</li><li class="listitem">Wait 2 minutes and check <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Cluster Management</strong></span> whether objects and metrics are collected:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_006.jpg"/></div></li></ol></div></div><div class="section" title="How it works"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec229"/>How it works</h2></div></div></div><p>Now we are ready to connect to the VCM database and fetch the required information to be displayed on the VCM console. vROps goes to the VCM database and starts collecting the required details, such as compliance score or events; these are posted on the vROps console:</p><div class="mediaobject"><img alt="How it works" src="graphics/image_08_007.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note60"/>Note</h3><p><span class="strong"><strong>Image Source</strong></span>: 
<a class="ulink" href="http://www.vmware.com">www.vmware.com</a>
</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec230"/>There's more...</h2></div></div></div><p>The account used for adapter configuration must not be the account that is used for an interactive user login. The adapter account frequently logs in and out of VCM. If you use it as an interactive account, you must regularly refresh the connection, which affects your VCM experience.</p></div></div>
<div class="section" title="Configuring vROps &#x2013; VCM compliance mapping and scheduling"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec81"/>Configuring vROps – VCM compliance mapping and scheduling</h1></div></div></div><p>Once VCM is integrated with vROps, we need to move ahead so that it can run the compliance and send the compliance score to be displayed on the vROps console. We will create a mapping in the VCM that will run the compliance check and update it with the details in vROps.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec231"/>Getting ready</h2></div></div></div><p>To perform this task, you should have completed the earlier recipe to install the management pack and configure it.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec232"/>How to do it...</h2></div></div></div><p>We need to log in to the VCM console with admin privileges in order to perform this recipe. Once logged in, follow the steps to complete the mapping:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Compliance</strong></span> | <span class="strong"><strong>Machine Group Compliance </strong></span>| <span class="strong"><strong>vCenter Operations Manager Badge</strong></span>| <span class="strong"><strong>Mapping</strong></span> and then click on <span class="strong"><strong>Add</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_008.jpg"/></div></li><li class="listitem">Give the proper name and description when the wizard starts:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Select Badge</strong></span>: <span class="strong"><strong>Risk Compliance</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Roll up Type</strong></span>: <span class="strong"><strong>Simple Percentage</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Select Group Context</strong></span>: As per the requirement</li></ul></div></li><li class="listitem">Select <span class="strong"><strong>Correct Machine Group</strong></span>.<p>When the mapping runs, it will run against all the machines that are part of this machine group.</p></li><li class="listitem">Select <span class="strong"><strong>Corresponding Compliance Template</strong></span>.<p>Select the template that is required to check compliance against the earlier selected machine group. You can select either a compliance template created for your organization or any standard template downloaded from the Internet.</p></li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span>. This will save the mapping.<p>Once the mapping is created, we need to run this so that the compliance score is calculated for the machines that are part of the machine group and then informed to vROps in order to be displayed on the vROps console.</p></li><li class="listitem">Select the mapping and then click on the <span class="strong"><strong>Run</strong></span> button at the top.</li><li class="listitem">It will first run the compliance check on the <span class="strong"><strong>Machine Group</strong></span>, and then when vROps updates the details via the management pack imported and configured as described in the <span class="emphasis"><em>Installing and configuration of vROps Management Pack for VCM</em></span> recipe, the status will be updated.<p>Depending upon how many machines you have in the machine group and the number of rules in the compliance template, it will take some time.</p></li><li class="listitem">To check the compliance tab on vROps, log in to the vROps console and navigate to <span class="strong"><strong>Environment</strong></span> | <span class="strong"><strong>vCenter Adapter </strong></span>| <span class="strong"><strong>Virtual Machines</strong></span> and then select <span class="strong"><strong>Machine Go to Analysis</strong></span> | <span class="strong"><strong>Compliance</strong></span>.<p>You will see the compliance status of the machine.</p><p>It will show the number of rules passed and failed and the compliance template used for checking the compliance along with the overall compliance status reported by VCM:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_009.jpg"/></div></li></ol></div><p>Once the mapping is done, we can schedule this mapping so that it will update vROps on schedule. Continue from where we left off:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Job Manager</strong></span> | <span class="strong"><strong>Scheduled</strong></span> and click on <span class="strong"><strong>Add</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>vCenter Operations Manager Compliance Badge Mapping Run</strong></span> on the <span class="strong"><strong>Job Type</strong></span> page of the wizard.</li><li class="listitem">Provide <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>description</strong></span>. You can be creative as there is a limit of characters for <span class="strong"><strong>Name</strong></span>, you can use any naming convention as all the scheduled job are going to land at the same place in VCM.</li><li class="listitem">Select the mapping that you want to schedule:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_010.jpg"/></div></li><li class="listitem">Select the schedule and click on <span class="strong"><strong>Finish</strong></span>. As this is related to compliance, make sure that this is scheduled after the OS and compliance data collection, as then we will have the latest data to run the compliance checks.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec233"/>How it works...</h2></div></div></div><p>To get the details, the vCenter server must be monitored by vROps and managed by VCM.</p><p>When we add and configure the VCM Management Pack, it fetches compliance details from the VCM and then displays it on the vROps console.</p><p>The VCM compliance data is based on compliance templates that are run against the data collected from the same vCenter Server objects that are monitored in vRealize Operations Manager. The templates are the configuration settings that must be present on a target object for it to be considered compliant with the template standards. The standards might be the VMware vSphere Hardening Guide, Payment Card Industry standards, Health Insurance Portability and Accountability Act, or other VMware or industry standards.</p><p>When we select the mapping, it will first run the compliance check with the selected template(s) and then update the compliance score on the vROps console. The score is visible on the <span class="strong"><strong>Analysis </strong></span>| <span class="strong"><strong>Compliance</strong></span> tab of the managed VM. The tab will display the compliance status against various templates (if configured), the percentage, the number of rules, and so on. Once we schedule it, the job will make sure that the compliance score is updated on the vROps console.</p></div></div>
<div class="section" title="Scheduling OS and compliance data collection"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec82"/>Scheduling OS and compliance data collection</h1></div></div></div><p><span class="strong"><strong>Collections</strong></span> are fetching the data as requested in the <span class="strong"><strong>Filter Set</strong></span> from the managed machines. As you know, VCM does not go to the managed machine each time it needs to process something against the managed machine such as <span class="strong"><strong>Patch</strong></span> or <span class="strong"><strong>Compliance</strong></span> status, it uses the data that is available in the database, and after processing the data, it gives a result, for example, whether a patch is required or not or what is the compliance level we are at.</p><p>If the data about the managed machine is not frequently updated, VCM processes stale data and we can have false positives or a very bad compliance score even though we are compliant.</p><p>To overcome this situation, we can go to the VCM console and start collecting the details on our own or schedule the job in the VCM and ask it to do it.</p><p>Continuous server management is based on the latest data that you collected from the target servers. Windows and Linux data appears in VCM and is available for several management actions, including <span class="strong"><strong>Console</strong></span> dashboards and reports, <span class="strong"><strong>Compliance Views</strong></span>, and <span class="strong"><strong>VCM Patching</strong></span>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec234"/>Getting ready</h2></div></div></div><p>We need a configured VCM where we have created all the required machine groups as described in the 
<span class="emphasis"><em>Creating a machine group </em></span>recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Y our Infrastructure</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec235"/>How to do it...</h2></div></div></div><p>To perform this recipe, login to VCM with the admin account and follow the steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Job Manager </strong></span>| <span class="strong"><strong>Scheduled</strong></span> and click on <span class="strong"><strong>Add</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_011.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>Collection</strong></span> on the <span class="strong"><strong>Job Type</strong></span> page of the wizard.</li><li class="listitem">Provide <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>Description</strong></span>. You can be creative as there is a limit of characters for the <span class="strong"><strong>Name</strong></span>, it will be better if you use a naming convention. Some examples are given in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span> as all the scheduled job are going to land at the same place in VCM:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_012.jpg"/></div></li><li class="listitem">Select the filter set as per the requirement. Also select if you want every scheduled collection to collect all the data or just the delta from the last collection. You can decide this based on how frequent you are collecting the data. If the frequency is too high and you have huge infrastructure to manage, you can opt for <span class="strong"><strong>Delta </strong></span>as that will be faster:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_013.jpg"/></div></li><li class="listitem">Select the machine group that you planned in the <span class="emphasis"><em>Getting ready</em></span> section:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_014.jpg"/></div></li><li class="listitem">Provide the schedule, this will vary as per your requirement and what exactly you are collecting, use your imagination to schedule this job <span class="strong"><strong>Daily</strong></span>, <span class="strong"><strong>Weekly</strong></span>, <span class="strong"><strong>Monthly</strong></span>, or <span class="strong"><strong>Once</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_015.jpg"/></div></li><li class="listitem">Confirm that there are no conflicts and click on <span class="strong"><strong>Finish</strong></span>.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec236"/>How it works...</h2></div></div></div><p>Basically, we are creating a scheduled task in SQL that will be triggered as per the schedule we have created. Then this will ask all the managed machines to provide the details as defined in the selected filter set. The data is stored in the VCM database and will be further used for various purposes, such as checking C<span class="strong"><strong>ompliance</strong></span>, P<span class="strong"><strong>atch Status</strong></span>, or G<span class="strong"><strong>et Reports</strong></span>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note61"/>Note</h3><p>Note that the displayed data is only as recent as the last time you collected it.</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec237"/>There's more...</h2></div></div></div><p>Collection filters control the data that is collected from managed entity by VCM. Typically, collection filters are twinned with a compliance template and collect only the data that the compliance template requires. For example, the ISO baseline filters-Windows collection set defines the extra information that is required to be imported to measure ISO 27001 compliance.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note62"/>Note</h3><p>Note that collections should be scheduled with additional collection filters for the compliance templates used. This process is the same as for Windows and Linux OS collections.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec238"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Before you start creating this scheduled task, make sure that you have created the required machine groups by following the recipe in the <span class="emphasis"><em>Creating a machine group </em></span>recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>.</li></ul></div></div></div>
<div class="section" title="Scheduling compliance"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec83"/>Scheduling compliance</h1></div></div></div><p>Compliance is an ongoing process and we need to check it at regular intervals to know exactly where we are and whether we need any remediation to be in good state. In the earlier recipe, we scheduled the data collection. Now is the time to consume the data.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec239"/>Getting ready</h2></div></div></div><p>We need to have the latest data available in our VCM database to be processed, so schedule the compliance check after few hours of data collection to give it some time to update the database.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec240"/>How to do it...</h2></div></div></div><p>To perform the following recipe, log in to VCM with the admin account and follow the steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Job Manager</strong></span>| <span class="strong"><strong>Scheduled</strong></span> and click on <span class="strong"><strong>Add</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_016.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>Compliance</strong></span> on the <span class="strong"><strong>Job Type</strong></span> page of the wizard.</li><li class="listitem">Provide <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>Description</strong></span>. You can be creative as there is a limit of characters for the <span class="strong"><strong>Name</strong></span>, you can use any naming convention as all the scheduled job are going to land at the same place in VCM:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_017.jpg"/></div></li><li class="listitem">Select the template that you want to check compliance for.</li><li class="listitem">There are some rules that can enforce the compliance, such as starting or stopping a service, that you can select here if you want to auto enforce the compliance.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note63"/>Note</h3><p>Note that only complex rules can be used to enforce compliance. When you enforce compliance, there are chances that it can break working configuration, for example, your security policy wants the Print Spooler service disabled, if you enforce the compliance, VCM will disable the service. However, if you have <span class="strong"><strong>Print Servers</strong></span> managed by VCM and not created exceptions in VCM, this may create issues.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_018.jpg"/></div></li><li class="listitem">Select the appropriate <span class="strong"><strong>Machine Group</strong></span>.</li><li class="listitem">Provide the schedule, schedule this after the collection job and make sure that you give some time for VCM to collect the data and insert it in the database.</li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span> to close the wizard:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_019.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec241"/>How it works...</h2></div></div></div><p>Every scheduled job is a scheduled job in VCM database, compliance job uses data from the VCM database for processing. Once the job is finished, it will update the compliance stats on the VCM console and then these can be exported in the form of a report, which can also be scheduled.</p></div></div>
<div class="section" title="Scheduling reports"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec84"/>Scheduling reports</h1></div></div></div><p>We don't want to sit in front of the VCM console to get the reports exported. We can schedule them and they can be in our inbox when we login. The patching and compliance reports can also be scheduled to be sent to the security officer to take a look at the infra. As they will be sent automatically, our admins can use this time to fix the actual issues than exporting and sending the reports.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec242"/>Getting ready</h2></div></div></div><p>Get a proper name ready for the scheduled report and create machine group against the report that should run. For compliance reports, make sure that a compliance check is already performed so that it can have some data in the report.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec243"/>How to do it...</h2></div></div></div><p>To perform this recipe, log in to VCM with admin account and follow the steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Job Manager </strong></span>| <span class="strong"><strong>Scheduled</strong></span> and click on <span class="strong"><strong>Add.</strong></span></li><li class="listitem">Check the screenshot from the earlier recipes</li><li class="listitem">Select <span class="strong"><strong>Run Report(s)</strong></span> on the <span class="strong"><strong>Job Type</strong></span> page of the wizard.</li><li class="listitem">Provide <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>description</strong></span> You can be creative, as there is a limit of characters for the <span class="strong"><strong>Name</strong></span>, you can use any naming convention as all the scheduled job are going to land at the same place in VCM:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_020.jpg"/></div></li><li class="listitem">On the <span class="strong"><strong>Report Folder</strong></span> page of the wizard, select the report you want to schedule. In this case, we are going to choose patching-related reports.</li><li class="listitem">Provide a location to save the exported reports that can be a shared location where all the reports are saved.</li><li class="listitem">Select <span class="strong"><strong>Select only certain s to run</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_021.jpg"/></div></li><li class="listitem">Select the reportreports to run: Select the reports you want to schedule, hover over the name of the eporreport to see full name on the top:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_022.jpg"/></div></li><li class="listitem">Click on the arrows in front of the report names to provide the input details, the details will change depending on the report you have selected in the earlier step:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_023.jpg"/></div></li><li class="listitem">Provide the format of the file you want, you can e-mail the report as well if you have SMTP configured and keep few copies of the report on SSRS:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_024.jpg"/></div></li><li class="listitem">Select the machine group against which you want to run the report.</li><li class="listitem">Select the schedule and click on <span class="strong"><strong>Finish</strong></span> to close the wizard.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec244"/>How it works...</h2></div></div></div><p>VCM goes to the database and prepares the requested report, then depending upon the option selected, it will either dump the report at a shared location in the requested format and/or mail to the configured e-mail IDs.</p><p>Make sure that you have scheduled the dependency task earlier and finished before starting this report, like in this case, you should configure the compliance check first, and once it is complete, you should schedule this report or configure patching report once the scheduled patching is finished.</p></div></div>
<div class="section" title="Scheduling vCenter collections"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec85"/>Scheduling vCenter collections</h1></div></div></div><p>To manage virtual machines, VCM must collect the virtual infrastructure data from the registered vCenters. We can directly add, license, and install agents on the machines added by vCenter collections.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec245"/>Getting ready</h2></div></div></div><p>Make sure that vCenter is added in VCM by following the <span class="emphasis"><em>Adding a vCenter server instance</em></span> recipe in  <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>. You have imported the compliance pack for vSphere 5.5 Hardening by following the <span class="emphasis"><em>Importing Compliance Packs</em></span> recipe from 
<a class="link" href="ch06.html" title="Chapter 6. Compliance Management">Chapter 6</a>, <span class="emphasis"><em>Compliance Management</em></span>
. Create a machine group that will include only vCenter Servers by following the <span class="emphasis"><em>Creating a machine group </em></span>recipe from <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec246"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Job Manager</strong></span>| <span class="strong"><strong>Scheduled</strong></span> and click on <span class="strong"><strong>Add</strong></span>. Check the screenshot from the earlier recipes.</li><li class="listitem">Select <span class="strong"><strong>Collection</strong></span> on the <span class="strong"><strong>Job Type</strong></span> page of the wizard.</li><li class="listitem">Provide <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>Description.</strong></span> You can be creative as there is a limit of characters for the <span class="strong"><strong>Name</strong></span>, you can use any naming convention as all the scheduled job are going to land at the same place in VCM.</li><li class="listitem">Select <span class="strong"><strong>VMware vSphere 5.5 Hardening Guide Filters</strong></span>. This collection filter set was downloaded when you prepared yourself in the getting ready section:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_025.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>vCenter Servers Machine Group</strong></span>. This machine group was configured when you prepared yourself in the getting ready section.</li><li class="listitem">Schedule the vCenter collection for a daily collection.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note64"/>Note</h3><p>Note that this means that any newly provisioned servers will be discovered daily. If you know the machines will be deployed frequently, and you want them to be discovered early, you can change the schedule according to your needs.</p></div></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec247"/>How it works...</h2></div></div></div><p>In this recipe, VCM collects data from the VCM servers that are added in VCM for management and then it makes new VMs available for agent installation by performing a discovery and management such as checking compliance and patching.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec248"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"> The <span class="emphasis"><em>Adding a vCenter server instance</em></span> recipe in  <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>: To make sure that vCenter is added in VCM</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Importing Compliance Packs</em></span> recipe from <a class="link" href="ch06.html" title="Chapter 6. Compliance Management">Chapter 6</a>, <span class="emphasis"><em>Compliance Management</em></span>: To import compliance pack for vSphere 5.5 Hardening</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Creating a machine group </em></span>recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>: To create a machine group this will include only vCenter Servers</li></ul></div></div></div>
<div class="section" title="Scheduling vCenter discovery"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec86"/>Scheduling vCenter discovery</h1></div></div></div><p><span class="strong"><strong>Discovery</strong></span> is used to identify if there are any new machines available that can be added to VCM for management. If we don't do it, then we need to manually add and license the machines to be managed.</p><p>VCM must discover machines in your environment before you can collect data from them. You can create a discovery rule to discover all machines or you can apply a filter to limit the machines that VCM discovers.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note65"/>Note</h3><p>Note that the vCenter discovery must occur after the vCenter Collection. This is counter-intuitive, but simply put, the vCenter discovery is finding new VMs that have come under the vCenter management through the vCenter collection.</p><p>
</p><p>Note that for servers and workstations, exceeding the limit on your license key produces warnings but does not restrict the VCM operation.</p></div></div><p>In this recipe, we are scheduling a vCenter discovery so that all the newly created VMs can be added, and agent can be installed and licensed in VCM.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec249"/>Getting ready</h2></div></div></div><p>Check whether you have enough licenses available to accommodate the newly added VMs, make sure that vCenter is added in VCM by following the recipe in the <span class="emphasis"><em>Adding a vCenter server instance</em></span> recipe in  <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>. You must have created a discovery rule by following the recipe in <span class="emphasis"><em>Adding a discovery rule</em></span> recipe in  <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>. You must have scheduled a vCenter collection before running this discovery. If you are exceeding the limit of your license key, add one by following the <span class="emphasis"><em>Applying a new license key</em></span> recipe in <a class="link" href="ch07.html" title="Chapter 7. Maintenance of VCM">Chapter
</a>

<a class="link" href="ch07.html" title="Chapter 7. Maintenance of VCM"> 7</a>, <span class="emphasis"><em>Maintenance of  VCM</em></span>

<span class="emphasis"><em>.</em></span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec250"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Job Manager </strong></span>| <span class="strong"><strong>Scheduled</strong></span> and click on <span class="strong"><strong>Add.</strong></span></li><li class="listitem">Check the screenshot from the earlier recipes</li><li class="listitem">Select <span class="strong"><strong>Discovery</strong></span> on the <span class="strong"><strong>Job Type</strong></span> page of the wizard.</li><li class="listitem">Provide <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>description.</strong></span> You can be creative as there is a limit of characters for the <span class="strong"><strong>Name</strong></span>, you can use any naming convention as all the scheduled job are going to land at the same place in VCM.</li><li class="listitem">Select the vCenter discovery rule created in the <span class="emphasis"><em>Adding a discovery rule</em></span> recipe in  <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_08_026.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> and select a daily schedule.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note66"/>Note</h3><p>Note that it is best to schedule the Discovery after the Collection. A two to three hour gap should be sufficient for most environments, but double-check the vCenter Collection job status for large environments.</p></div></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec251"/>How it works...</h2></div></div></div><p>A discovery rule is created; we are just asking VCM to run it on a schedule. If there are too many VM installations on daily basis, we can increase the frequency by selecting <span class="strong"><strong>Occurs Every XX hours</strong></span> and schedule accordingly. This will go in the database and check the details fetched by vCenter collections and add the newly created VMs in the licensed machines. If in the discovery rule we have selected to install the agent, then it will just follow the discovery and install the agent.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec252"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding a vCenter server instance</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>: To add a vCenter in VCM</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>
<span class="emphasis"><em>Adding a discovery rule</em></span>
</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a><span class="emphasis"><em>, <span class="emphasis"><em>Configuring VCM to Manage Your Infrastructure</em></span>:</em></span> To create a vCenter discovery rule to be used for this schedule</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Applying a new license key</em></span> recipe in <a class="link" href="ch07.html" title="Chapter 7. Maintenance of VCM">Chapter 7</a>, <span class="emphasis"><em>Maintenance of  VCM:</em></span> To add license key if you are exceeding the limit of your license key.</li></ul></div></div></div></body></html>