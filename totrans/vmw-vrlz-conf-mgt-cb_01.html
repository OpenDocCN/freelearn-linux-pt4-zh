<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Installing VCM"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Installing VCM</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Preparing our VCM deployment – installing SQL</li><li class="listitem" style="list-style-type: disc">Preparing our VCM deployment – installing and configuring IIS</li><li class="listitem" style="list-style-type: disc">Preparing our VCM deployment – configuring SSRS</li><li class="listitem" style="list-style-type: disc">Preparing our VCM deployment – installing other prerequisites</li><li class="listitem" style="list-style-type: disc">Installing VCM – single-tier deployment</li><li class="listitem" style="list-style-type: disc">Installing VCM – two-tier deployment</li><li class="listitem" style="list-style-type: disc">Installing VCM – three-tier deployment</li><li class="listitem" style="list-style-type: disc">VCM post-installation tasks – database fine-tuning</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec9"/>Introduction</h1></div></div></div><p>What is <span class="strong"><strong>vRealize Configuration Manager</strong></span> (<span class="strong"><strong>VCM</strong></span>) and what it can do for you?</p><p>vRealize Configuration Manager is a complete configuration management solution provided by VMware. This is a part of the vRealize Operations suite along with <span class="strong"><strong>vRealize Operations  Manager</strong></span>, <span class="strong"><strong>vRealize Hyperic</strong></span>, and <span class="strong"><strong>vRealize Infrastructure Navigator</strong></span>, to name a few. Being a part of the suite, VCM is responsible for compliance and patch management, these being its core functionalities.</p><p>VCM is a tool that collects data automatically from managed machines, which may be running Windows or Unix, and virtualization tools such as <span class="strong"><strong>vCenter</strong></span>, <span class="strong"><strong>vShield</strong></span>, and <span class="strong"><strong>vCloud Director</strong></span>, and based on that data, VCM can perform compliance checks and help you manage your virtual machines from the console.</p><p>VCM can perform the patching of managed machines, which may either be physical or virtual, and Windows and many flavors of Unix/Linux are supported, such as <span class="strong"><strong>Red Hat Enterprise  Linux</strong></span> (<span class="strong"><strong>RHEL</strong></span>), <span class="strong"><strong>SUSE</strong></span>, <span class="strong"><strong>CentOS</strong></span>, and <span class="strong"><strong>Mac OS</strong></span>. To patch these operating systems, we need a RHEL server acting as a patch repository. For non-windows servers, this RHEL patch repository downloads the patches, and all the managed machines can come and download them over HTTP, HTTPS, FTP, or NFS. VCM can patch all the supported versions of Windows.</p><p>You can download various compliance packs created by VMware and others. Just download and import them, and they will be ready for use with your managed machines. The packages include but are not limited to security best practices developed by the <span class="strong"><strong>Defense Information  Systems Agency</strong></span> (<span class="strong"><strong>DISA</strong></span>), the <span class="strong"><strong>National Institute of Standards and Technology</strong></span> (<span class="strong"><strong>NIST</strong></span>), the <span class="strong"><strong>Center for Internet Security</strong></span> (<span class="strong"><strong>CIS</strong></span>); regulatory mandates such as <span class="strong"><strong>Sarbanes-Oxley</strong></span> (<span class="strong"><strong>SOX</strong></span>), the <span class="strong"><strong>Payment Card Industry</strong></span> (<span class="strong"><strong>PCI</strong></span>) standard, the <span class="strong"><strong>Health Insurance Portability  and Accountability Act</strong></span> (<span class="strong"><strong>HIPAA</strong></span>), and the <span class="strong"><strong>Federal Information Security Management Act</strong></span> (<span class="strong"><strong>FISMA</strong></span>); and hardening guidelines from VMware and Microsoft.</p><p>You not only can check the compliance of your infrastructure but also enforce it to enhance your compliance score. Enforcing compliance means VCM can make necessary changes to the server to make it compliant.</p><p>This does not limit you from creating your own rules and compliance templates; you can either create a completely new rule or combine rules from various rulesets provided by VMware.</p><p>VCM can be used to install an operating system on bare metal, or you can deploy a virtual machine. You can use VCM to deploy applications on managed machines, which is limited to Windows. With features such as <span class="strong"><strong>VCM Remote Client</strong></span>, you can manage communication and management mechanisms for mobile Windows machines as they connect to and disconnect from the network.</p><p>With the <span class="strong"><strong>vRealize Operations</strong></span> (<span class="strong"><strong>vROps</strong></span>) <span class="strong"><strong>Manager</strong></span> Management Pack, you can push the compliance score of managed virtual machines to the vROps console. vROps is a monitoring solution from VMware used to monitor virtual infrastructure; pushing the compliance score to the console gives us the view of the infrastructure under one console. Also, if required, an alert can be configured if the score goes beyond a certain limit.</p><p>Along with all this, we can use VCM to manage <span class="strong"><strong>Active Directory</strong></span>. VCM for Active Directory collects Active Directory objects across domains and forests and displays them through a single console. The information is consolidated and organized under the Active Directory slider, allowing you to view your Active Directory structure, troubleshoot issues, detect changes, and ensure compliance.</p><div class="section" title="Understanding VCM components"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Understanding VCM components</h2></div></div></div><p>VCM is an application composed of multiple components, as described in the following figure:</p><div class="mediaobject"><img alt="Understanding VCM components" src="graphics/image_01_001.jpg"/></div><div class="section" title="The database server"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec0"/>The database server</h3></div></div></div><p>The database server contains the <code class="literal">VCM</code>, <code class="literal">VCM_Coll</code>, <code class="literal">VCM_Raw</code>, and <code class="literal">VCM_UNIX</code> databases. Using a shared SQL Server instance is supported by VCM. However, VCM makes heavy use of SQL Server for query and transaction processing. You must ensure that you have or can add enough capacity to a shared SQL Server instance so that VCM and any other databases on the shared server do not experience poor performance.</p><p>VCM operates with the Standard, Enterprise, or Datacenter editions of SQL Server. You must install the 64-bit SQL Server 2008 R2, 2012, or 2014 versions on the database server used by VCM.</p><p>The SQL Server license must include <span class="strong"><strong>SQL Server Reporting Services</strong></span> (<span class="strong"><strong>SSRS</strong></span>), which is used by VCM for the reporting feature.</p></div><div class="section" title="The VCM Collector server"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec1"/>The VCM Collector server</h3></div></div></div><p>The <span class="strong"><strong>VCM Collector</strong></span> is a standalone application that can run even when no other VCM components are active. This is particularly useful in the case of scheduled collections, because it means the VCM Portal does not have to be up and running. The Collector has all the necessary information and capabilities to perform the requested functions. You can stop the Collector and still look at data as the UI does not interact directly with the collector service; instead, it communicates with various executables that are installed on the same machine as the Collector.</p><p>Windows patches will be hosted on the VCM Collector as per the default configuration. Linux patches will be handled by the <span class="strong"><strong>Standby Continuous Replication</strong></span> (<span class="strong"><strong>SCR</strong></span>) server. We will have a look at Linux patching in 
<a class="link" href="ch03.html" title="Chapter 3. Linux Patching">Chapter 3</a>
, <span class="emphasis"><em>Linux Patching</em></span>.</p><p>Supported operating systems for installing the VCM Collector are Windows Server 2008 R2, 2012, or 2012 R2. The VCM Collector must be installed on a AD domain member.</p><p>We will discuss the installation of the VCM Collector server in multiple recipes in this chapter.</p></div><div class="section" title="The web server"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec2"/>The web server</h3></div></div></div><p>The web server contains web applications such as IIS and SSRS, other services, and VCM software components. Before you install VCM, you must configure the web server. The Windows machine that hosts the web components must be running <span class="strong"><strong>Internet Information  Services</strong></span> (<span class="strong"><strong>IIS</strong></span>) 7.5. Supported operating systems to install the web server to are Windows Server 2008 R2, 2012, or 2012 R2.</p><p>We will discuss the installation and configuration of the web server in the <span class="emphasis"><em>Preparing our VCM deployment - installing and configuring IIS</em></span> recipe.</p></div><div class="section" title="The managing agent"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec3"/>The managing agent</h3></div></div></div><p>We need to install an agent to manage the machines through VCM. In the case of vCenter Server, vCloud Director, and vCloud Networking and Security Manager, VCM uses an intermediary <span class="strong"><strong>managing agent</strong></span> for data collection. This intermediary collects data through the use of the vSphere VIMAPI, vCloud REST API, and vCloud Networking and Security Manager REST API, and it then passes it to VCM Server.</p><p>We need to install VCM agent 5.5 or higher on the system designated as being the managing agent. However, after the agent deployment, there is an additional step. Mutual two-way trust must be established with the system designated as the managing agent before the collection of any vCenter, vCloud Networking and Security, or vCloud Director data can be done.</p><p>The vCenter collection process via the managing agent is serial and very CPU intensive. For this reason, a separate managing agent is recommended for virtual infrastructures. If the number of vCenter or vCloud Server instances increases, the number of managing agents can be horizontally scaled.</p><p>We will see this in action in the <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage
Your Infrastructure</em></span>, in the <span class="emphasis"><em>Configuring a managing agent machine for virtual environment management</em></span> recipe.</p></div><div class="section" title="The SCR Tool"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec4"/>The SCR Tool</h3></div></div></div><p>To ensure that all patch dependencies are met when VCM deploys the patches, the SCR Tool downloads all of the necessary patches (except for patches that have been superseded by newer patches). VCM patching handles all the dependencies when the patches are deployed. If the patch was available when the SCR Tool was installed and configured, it would have been downloaded. If the patch was not available when the SCR Tool was last synchronized, it would not have been downloaded and hence not available for distribution to managed machines. If the patch is still available from the OS vendor, it will be available for download using the SCR Tool patch-replication process. The SCR server does not share or sync the details of the patches downloaded by it; VCM gets the details of the released patches from 
<a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>
. So, we need to make sure is fully synced with vendors such as RHEL or SUSE and has all the patches downloaded in the repository.</p><p>The SCR Tool is not used to run patch assessments or deployments. It also does not assess the machine configuration or the downloaded patch content that is used for patch deployment. That job is done by the VCM server.</p><p>The SCR Tool downloads the patch signature files and OS vendor patch content from the <span class="strong"><strong>content distribution network</strong></span> (<span class="strong"><strong>CDN</strong></span>) and downloads subscription-only content from the OS vendor's content web sites. We will look at this in more detail in 
<a class="link" href="ch03.html" title="Chapter 3. Linux Patching">Chapter 3</a>
, <span class="emphasis"><em>Linux Patching</em></span>.</p></div><div class="section" title="Distributed VCM deployment"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec5"/>Distributed VCM deployment</h3></div></div></div><p>Depending upon the size of the infrastructure you manage, VCM can be deployed in multiple ways.</p><p>If you plan to install VCM on two or three tiers, check out this link for how to size your hardware environment: 
<a class="ulink" href="http://kb.vmware.com/kb/2033894">http://kb.vmware.com/kb/2033894</a>
.</p><div class="section" title="Single-tier installation"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec0"/>Single-tier installation</h4></div></div></div><p>A single-tier installation can be used by organizations smaller than 2,000 managed servers and POC/pilot engagements.</p><p>All the components, such as the VCM Database server, web server, and the VCM Collector, are installed on the same server, like this:</p><div class="mediaobject"><img alt="Single-tier installation" src="graphics/image_01_002.jpg"/></div></div><div class="section" title="Two-tier installation"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec1"/>Two-tier installation</h4></div></div></div><p>A two-tier installation can be used by organizations where the number of managed servers is between 2,000 and 5,000.</p><p>In this deployment, we have the application server (Collector) and IIS on one machine, SQL Server instance on the other machine, and SSRS on either system, as shown here:</p><div class="mediaobject"><img alt="Two-tier installation" src="graphics/image_01_003.jpg"/></div></div><div class="section" title="Three-tier installation"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec2"/>Three-tier installation</h4></div></div></div><p>A three-tier installation can be used by organizations with more than 5,000 servers. It is constructed in this manner:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The application server (Collector), IIS, and SQL Server instance are on separate machines</li><li class="listitem" style="list-style-type: disc">SSRS can be either on the IIS or the SQL Server system</li></ul></div><p>This figure depicts a three-tier installation:</p><div class="mediaobject"><img alt="Three-tier installation" src="graphics/image_01_004.jpg"/></div></div></div></div><div class="section" title="Understanding the requirements of VCM"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Understanding the requirements of VCM</h2></div></div></div><p>Every software application we install has its own requirements for successful installation and functioning. VCM is no different. In this section, we will discuss the hardware and software requirements for getting VCM deployed.</p><div class="section" title="Software requirements"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec6"/>Software requirements</h3></div></div></div><p>We need the following software to install VCM:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Software component</strong></span></p>
</td><td>
<p><span class="strong"><strong>Versions supported</strong></span></p>
</td></tr><tr><td>
<p>Operating system for VCM Web, Collector, and Database server</p>
</td><td>
<p>Windows Server 2008 R2, Windows Server 2012, or Windows Server 2012 R2</p>
</td></tr><tr><td>
<p>SQL version</p>
</td><td>
<p>SQL Server 2008 R2, 2012, or 2014 Standard, Enterprise, or Datacenter Edition (64-bit)</p>
</td></tr><tr><td>
<p>SSRS version</p>
</td><td>
<p>SQL Server 2008 R2, 2012, or 2014 Reporting Services</p>
</td></tr><tr><td>
<p>OS for SCR*</p>
</td><td>
<p>RHEL 7.x</p>
</td></tr></tbody></table></div><p>(*SCR: software content repository. It is used to download and store patches for non-Windows operating systems)</p></div><div class="section" title="Minimum hardware requirements"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec7"/>Minimum hardware requirements</h3></div></div></div><p>Hosting the VCM has some hardware requirements as well, which are provided in the following tables:</p><p>Minimum hardware requirements to support 1-1,000 managed machines:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td>
</td><td>
<p><span class="strong"><strong>Single Tier</strong></span></p>
</td><td>
<p><span class="strong"><strong>2-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Database</strong></span></p>
</td><td>
<p><span class="strong"><strong>2-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Web/Collector</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Database</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Web</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Collector</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>RAM</strong></span></p>
</td><td>
<p>8 GB</p>
</td><td>
<p>8 GB</p>
</td><td>
<p>4 GB</p>
</td><td>
<p>8 GB</p>
</td><td>
<p>4 GB</p>
</td><td>
<p>4 GB</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Processor</strong></span></p>
</td><td>
<p>Dual Xeon or single dual-core 2 GHz</p>
</td><td>
<p>Dual Xeon or single dual-core 2 GHz</p>
</td><td>
<p>Dual Xeon or single dual-core 2 GHz</p>
</td><td>
<p>Dual Xeon or single dual-core 2 GHz</p>
</td><td>
<p>Single 2-GHz processor</p>
</td><td>
<p>Single 2-GHz processor</p>
</td></tr></tbody></table></div><p>Minimum hardware requirements to support 1,001-2,000 managed machines:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td>
</td><td>
<p><span class="strong"><strong>Single Tier</strong></span></p>
</td><td>
<p><span class="strong"><strong>2-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Database</strong></span></p>
</td><td>
<p><span class="strong"><strong>2-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Web/Collector</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Database</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Web</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Collector</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>RAM</strong></span></p>
</td><td>
<p>12 GB</p>
</td><td>
<p>12 GB</p>
</td><td>
<p>4 GB</p>
</td><td>
<p>12 GB</p>
</td><td>
<p>4 GB</p>
</td><td>
<p>4 GB</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Processor</strong></span></p>
</td><td>
<p>Quad Xeon or two dual-core 2 GHz</p>
</td><td>
<p>Quad Xeon or two dual-core 2 GHz</p>
</td><td>
<p>Quad Xeon or two dual-core 2 GHz</p>
</td><td>
<p>Quad Xeon or two dual-core 2 GHz</p>
</td><td>
<p>Single 2-GHz processor</p>
</td><td>
<p>Dual Xeon or single dual-core 2 GHz</p>
</td></tr></tbody></table></div><p>Minimum hardware requirements to support 2,001-5,000 managed machines:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td>
</td><td>
<p><span class="strong"><strong>Single Tier</strong></span></p>
</td><td>
<p><span class="strong"><strong>2-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Database</strong></span></p>
</td><td>
<p><span class="strong"><strong>2-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Web/Collector</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Database</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Web</strong></span></p>
</td><td>
<p><span class="strong"><strong>3-Tier</strong></span></p><p>
</p><p><span class="strong"><strong>Collector</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>RAM</strong></span></p>
</td><td>
<p>16 GB</p>
</td><td>
<p>16 GB</p>
</td><td>
<p>8 GB</p>
</td><td>
<p>16 GB</p>
</td><td>
<p>4 GB</p>
</td><td>
<p>8 GB</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Processor</strong></span></p>
</td><td>
<p>Eight-way Xeon or four dual-core 2 GHz</p>
</td><td>
<p>Eight-way Xeon or four dual-core 2 GHz</p>
</td><td>
<p>Dual Xeon or single dual-core 2 GHz</p>
</td><td>
<p>Eight-way Xeon or four dual-core 2 GHz</p>
</td><td>
<p>Single 2-GHz processor</p>
</td><td>
<p>Dual Xeon or single dual-core 2 GHz</p>
</td></tr></tbody></table></div></div><div class="section" title="Service accounts"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec8"/>Service accounts</h3></div></div></div><p>Let's look at the list of accounts and the privileges required for VCM to work properly.</p><p>You can reuse an account for more than one function, but dedicated accounts might be useful for troubleshooting and tracking.</p><p>The Collector, VCM Remote, Tomcat, and vSphere Client VCM plug-ins can be used from the same account. If you reuse one account, apply the permissions shown for the Collector service account.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Role</strong></span></p>
</td><td>
<p><span class="strong"><strong>Permissions</strong></span></p>
</td><td>
<p><span class="strong"><strong>Description</strong></span></p>
</td></tr><tr><td>
<p>VCM Administrator</p>
</td><td>
<p>(During installation only) Local admin access on the VCM Collector and Web server.</p><p>
</p><p>(During installation only) System admin access to the VCM SQL Server instance on the database server.</p><p>
</p><p>This must be an interactive account and separate from the other accounts in this table.</p>
</td><td>
<p>The VCM Administrator account is the login account used when installing VCM and possibly post installation for the administration and maintenance of VCM.</p>
</td></tr><tr><td>
<p>VCM Collector Service</p>
</td><td>
<p>Local admin access on the VCM Collector and Web servers.</p><p>
</p><p>This is not a domain administrator or interactive user account.</p>
</td><td>
<p>The Collector service account is the account under which the VCM Collector, VCM Database, and VCM Patch Management services run. During installation, VCM configures the Collector service account with DBO and bulk insert rights in SQL Server for the VCM databases.</p>
</td></tr><tr><td>
<p>VCM Remote Service</p>
</td><td>
<p>Local admin access on the VCM Web server.</p><p>
</p><p>This is not a domain administrator or interactive user account.</p>
</td><td>
<p>The VCM Remote service account is used by the VCM Remote client for anonymous access to the VCM Remote virtual directory on the Web server.</p>
</td></tr><tr><td>
<p>VCM Tomcat Service</p>
</td><td>
<p>Local admin access on the VCM Database server.</p><p>
</p><p>Public access on VCM databases.</p><p>
</p><p>This is not an interactive user account.</p>
</td><td>
<p>The Tomcat service account serves as the VCM application programming interface for SQL login to the E12VCM Database server.</p>
</td></tr><tr><td>
<p>vSphere Client VCM Plug-in Service</p>
</td><td>
<p>Local admin on the VCM Web server.</p><p>
</p><p>This is not an interactive user account.</p>
</td><td>
<p>The <span class="strong"><strong>vSphere Client VCM Plug-In</strong></span> (<span class="strong"><strong>VCVP</strong></span>) account provides vSphere access over HTTP to VCM managed machines.</p><p>
</p><p>The <span class="strong"><strong>VCM Advanced Installation</strong></span> option prompts for credentials for the VCVP account. Typical Installation does not.</p>
</td></tr><tr><td>
<p>VCM Default  Network Authority</p>
</td><td>
<p>Local admin access on Windows machines that VCM collects from using the DCOM agent.</p><p>
</p><p>Depending on the enterprise size and for convenience, a separate, domain administrator account with rights on the Windows machines.</p><p>
</p><p>This is not an interactive user account.</p>
</td><td>
<p>The network authority account is for data collection from DCOM Windows machines.</p>
</td></tr></tbody></table></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip3"/>Tip</h3><p><span class="strong"><strong>IMPORTANT</strong></span>: Never use the service accounts for logging in to the VCM Console or for any other purpose. Logging in to VCM using a service account can lead to unexpected or inconsistent behavior. Services that use the same account as a logged-in user might modify the logged-in user's current role or machine group or log the user out of the system.</p></div></div><p>If for some reason you don't get a local admin account to be used as the NAA, you need at least the privileges mentioned in the following table. For VCM to make changes on licensed machines, such as rebooting and managing audit settings, the account used to interact with the VCM agent needs the following permissions and rights on each licensed machine:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Action</strong></span></p>
</td><td>
<p><span class="strong"><strong>Required user right</strong></span></p>
</td></tr><tr><td>
<p>Emergency repair disk</p>
</td><td>
<p>Back up files and directories</p>
</td></tr><tr><td>
<p>NTFS permissions</p>
</td><td>
<p>Manage auditing and security logs</p>
</td></tr><tr><td>
<p>Reboot</p>
</td><td>
<p>Shut down the system, force shutdown from a remote system</p>
</td></tr><tr><td>
<p>Services change</p>
</td><td>
<p>Shut down the system</p>
</td></tr><tr><td>
<p>Share permissions</p>
</td><td>
<p>Manage auditing and security logs</p>
</td></tr></tbody></table></div><p>To check or set the appropriate rights on each machine, you can use either of these:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Local security policy</strong></span>: <span class="strong"><strong>Security Settings</strong></span> | <span class="strong"><strong>Local Policies</strong></span> | <span class="strong"><strong>User Rights Assignment</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Group Policy plugin</strong></span>: <span class="strong"><strong>Local Computer Policy</strong></span> | <span class="strong"><strong>Computer Configuration</strong></span> | <span class="strong"><strong>Windows Settings</strong></span> | <span class="strong"><strong>Security Settings</strong></span> | <span class="strong"><strong>Local Policies</strong></span> | <span class="strong"><strong>User Rights Assignment</strong></span></li></ul></div></div><div class="section" title="VCM databases"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec9"/>VCM databases</h3></div></div></div><p>There are four databases created by VCM; there is a list of them along with their purpose in the following table. The databases are created when we deploy VCM using the installer.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip4"/>Tip</h3><p>Make sure autogrowth is enabled on the databases.</p></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Database name</strong></span></p>
</td><td>
<p><span class="strong"><strong>Minimum size</strong></span></p>
</td><td>
<p><span class="strong"><strong>Purpose</strong></span></p>
</td></tr><tr><td>
<p><code class="literal">VCM</code></p>
</td><td>
<p>3 GB</p>
</td><td>
<p>This contains configuration data for the VCM application itself, collected data from Window systems and virtual infrastructure, change details from all systems, and results of patch and compliance assessments. The base name <code class="literal">VCM</code> is a default and may be changed.</p>
</td></tr><tr><td>
<p><code class="literal">VCM_Coll</code></p>
</td><td>
<p>1 GB</p>
</td><td>
<p>This provides operational state information for the Collector service and is mainly used to track details of running jobs and the last contact state of managed client systems.</p>
</td></tr><tr><td>
<p><code class="literal">VCM_Unix</code></p>
</td><td>
<p>1 GB</p>
</td><td>
<p>This contains the collected managed machine data gathered from any Linux, Unix, or Mac agents in the environment.</p>
</td></tr><tr><td>
<p><code class="literal">VCM_RAW</code></p>
</td><td>
<p>1 GB</p>
</td><td>
<p>To improve performance, this database temporarily holds collection data before it is transformed into the <code class="literal">VCM</code> and <code class="literal">VCM_UNIX</code> databases. The raw database should not be backed up or be included in maintenance plans.</p>
</td></tr></tbody></table></div></div><div class="section" title="OSes supported by VCM"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec10"/>OSes supported by VCM</h3></div></div></div><p>The list of OSes supported by VCM is as per the following table, but this is not a comprehensive list.</p><p>You can take a look at the <span class="emphasis"><em>Hardware and Operating System Requirements for VCM Managed Machines</em></span> chapter of the <span class="emphasis"><em>VMware vRealize Configuration Manager Installation Guide</em></span> (
<a class="ulink" href="http://www.vmware.com/pdf/vrealize-configuration-manager-58-installation-guide.pdf">http://www.vmware.com/pdf/vrealize-configuration-manager-58-installation-guide.pdf</a>
) for the complete list.</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Supported operating system</strong></span></p>
</td><td>
<p><span class="strong"><strong>Supported hardware platform</strong></span></p>
</td></tr><tr><td>
<p>Microsoft Windows Server 2003 SP2</p>
</td><td>
<p>x86 and x64</p>
</td></tr><tr><td>
<p>Microsoft Windows Server 2008 R2 Enterprise Gold</p>
</td><td>
<p>x64</p>
</td></tr><tr><td>
<p>Microsoft Windows 7 Enterprise Gold</p>
</td><td>
<p>x86 and x64</p>
</td></tr><tr><td>
<p>Microsoft Windows 8.1 Enterprise</p>
</td><td>
<p>x86 and x64</p>
</td></tr><tr><td>
<p>Microsoft Windows Server 2012 R2 Datacenter</p>
</td><td>
<p>x64</p>
</td></tr><tr><td>
<p>Red Hat Enterprise Linux 5.0-5.11, 6.0-6.5, and 7.0</p><p>
</p><p>(x64) Server, Desktop with Workstation, and Advanced Platform</p>
</td><td>
<p>x86 and x64</p>
</td></tr><tr><td>
<p>SUSE Linux Enterprise Server (SLES) 10.0-10.2 (up to agent version 5.5.0 only)</p><p>
</p><p>SUSE Linux Enterprise Server (SLES) 10.3-10.4, 11.0-11.3, and 12</p>
</td><td>
<p>x86 and x64</p>
</td></tr><tr><td>
<p>Windows 10</p>
</td><td>
<p>x86 and x64</p>
</td></tr></tbody></table></div></div><div class="section" title="vRealize Configuration Manager port and protocol summary"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec11"/>vRealize Configuration Manager port and protocol summary</h3></div></div></div><p>The following table shows the port and protocol requirements for proper functioning in the environment:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Source</strong></span></p>
</td><td>
<p><span class="strong"><strong>Target</strong></span></p>
</td><td>
<p><span class="strong"><strong>Port and protocol</strong></span></p>
</td><td>
<p><span class="strong"><strong>Description</strong></span></p>
</td></tr><tr><td>
<p>Managing agent</p>
</td><td>
<p>vCloud Management vCenter</p>
</td><td>
<p>HTTPS: 443</p>
</td><td>
<p>The web service connection to the vCenter API.</p><p>
</p><p>Valid credentials and certificate thumbprint are required.</p>
</td></tr><tr><td>
<p>Managing agent</p>
</td><td>
<p>vCloud vCenter</p>
</td><td>
<p>HTTPS: 443</p>
</td><td>
<p>The web service connection to the vCenter API.</p><p>
</p><p>Valid credentials and certificate thumbprint are required.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>VCM Database Server</p>
</td><td>
<p>SQL: 1433</p>
</td><td>
<p>Windows authenticated connection.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>VCM Database Server</p>
</td><td>
<p>DCOM: 135</p>
</td><td>
<p>DCOM is required between the Collector and the DB Server in a two-tier configuration so that the DB server can call back to the Collector at the end of various jobs.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>VCM Database Server</p>
</td><td>
<p>SMB: TCP ports 139 and 445</p>
</td><td>
<p>VCM creates a share to the DB server during installation.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>VCM Database Server</p>
</td><td>
<p>HTTP: 80</p>
</td><td>
<p>An SSRS connection from VCM Server to the DB SSRS instance.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>VCM Database Server</p>
</td><td>
<p>ICMP</p>
</td><td>
<p>Login details are not sent to the agent.</p><p>
</p><p>Mutual authentication is used and the agent runs under LocalSystem. Data is pulled back to the Collector over a new TLS session.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>Agent</p>
</td><td>
<p>HTTP: 26542</p>
</td><td>
<p>Login details are not sent to the agent.</p><p>
</p><p>Mutual authentication is used and the agent runs under LocalSystem. Data is pulled back to the Collector over a new TLS session.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>Agent</p>
</td><td>
<p>ICMP</p>
</td><td>
<p>Login details are not sent to the agent.</p><p>
</p><p>Mutual authentication is used and the agent runs under LocalSystem. Data is pulled back to the Collector over a new TLS session.</p>
</td></tr><tr><td>
<p>VCM Collector</p>
</td><td>
<p>Agent</p>
</td><td>
<p>SMB: TCP ports 139 and 445</p>
</td><td>
<p>This is a mapped driver for Windows patch downloads.</p>
</td></tr><tr><td>
<p>Agent software</p>
</td><td>
<p>RedHat Patch Server</p>
</td><td>
<p>HTTPS: 443/80</p>
</td><td>
<p>This depends on how you have configured Apache, which will be used to download patches from the patch repository.</p>
</td></tr></tbody></table></div></div><div class="section" title="Licensing"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Licensing</h3></div></div></div><p>vRealize Operations is available with two license models:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Per processor with unlimited VMs</strong></span>: For virtual environments with high consolidation ratios, vRealize Operations is available per processor as a part of VMware vRealize Suite, VMware vCloud Suite, and VMware vSphere with Operations Management.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Per virtual machine or physical server</strong></span>: For virtual environments with low consolidation ratios, vRealize Operations is also available à la carte in 25 VM or OS instance license packs.</li></ul></div><p>The new release, VCM 5.8.2, supports Hybrid Cloud Suite license keys, as VCM will not be part of vCloud Suite anymore. This keeps changing; you can contact VMware for current pricing details or check out more details here: 
<a class="ulink" href="https://www.vmware.com/products/vrealize-operations/pricing">https://www.vmware.com/products/vrealize-operations/pricing</a>
.</p></div></div></div></div>
<div class="section" title="Preparing our VCM deployment - installing SQL"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Preparing our VCM deployment - installing SQL</h1></div></div></div><p>VCM requires four databases on a dedicated SQL system. In this recipe, we will learn how to correctly install the SQL Server component.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Getting ready</h2></div></div></div><p>Depending upon the deployment type we choose, we will need either a dedicated SQL Server (two- and three-tier deployment) or we can use the Windows server used for the VCM Collector server (single-tier deployment).</p><p>We will need an operating system-Windows Server 2012 (or better)-and SQL 2012.</p><p>For proof of concept or testing purposes, you can use shared SQL; or else, use dedicated SQL.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How to do it...</h2></div></div></div><p>The steps to install SQL are the same for all the three types of VCM deployments–only the server will change depending upon the type of tier.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note5"/>Note</h3><p>As this is not a dedicated guide to installing and configuring SQL, we will not include all the screenshots; if you need further help, consult your DBA team for detailed instructions.</p></div></div><p>Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start the SQL installer.</li><li class="listitem">Under the installation menu, select <span class="strong"><strong>New SQL Server standalone installation or add features to an existing installation</strong></span>.</li><li class="listitem">Make sure all the setup support rules have been passed.</li><li class="listitem">Ignore product update errors if you do not have an Internet connection.</li><li class="listitem">Enter the product key.</li><li class="listitem">Accept the EULA.</li><li class="listitem">Under <span class="strong"><strong>Setup Role</strong></span>, select <span class="strong"><strong>SQL Server Feature Installation</strong></span>.</li><li class="listitem">Select the following features:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Instance Features</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database Engine Service</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Full-Text and Semantic Extractions for Search</strong></span></li></ul></div><p>
</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Reporting Service - Native</strong></span></li></ul></div><p>
</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Shared Features</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Documentation Components</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Management Tools - Basic</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Management Tools - Complete</strong></span></li></ul></div><p>
</p></li></ul></div><p>
</p></li></ul></div></li><li class="listitem">Choose the installation folder according to your server configuration.</li><li class="listitem">Make sure all the installation rules have been passed.</li><li class="listitem">Go with the default instance and again change the installation folder location if required.</li><li class="listitem">It is always better to use a service account to run SQL services, and you need to have a domain account if you will be installing a two- or three-tier VCM instance.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note6"/>Note</h3><p>In a multi-tier VCM deployment, the database is on a different server, and we need a domain service account so that SQL can communicate over the network.</p></div></div><p>Provide the correct service accounts to the SQL installation wizard.</p></li><li class="listitem">The collation setting supported by VCM is <code class="literal">SQL_Latin1_General_CP1_CI_AS</code>; make sure this is selected.</li><li class="listitem">Add the SQL admin group from Active Directory. Depending on company policy, enable <span class="strong"><strong>Mixed</strong></span> mode and provide the <code class="literal">SA</code> account with a password.</li><li class="listitem">For reporting services, we will be only installing SSRS and not configuring it.</li><li class="listitem">Follow the wizard and install SQL.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How it works...</h2></div></div></div><p>SQL will host all the four databases required for VCM. We don't need to create or configure any database right now; they will be created when we install VCM. We will need special permissions for SQL Server, as previously stated in the <span class="emphasis"><em>Service accounts</em></span> subsection.</p><p>Also, all activities such as compliance check and patch status for a machine are performed using the data available in the database, so this puts extra workload on the database, which highlights the need for a dedicated SQL Server. All the schedules are stored as SQL jobs in SQL, putting another layer of work pressure on the SQL Server.</p><p>VCM uses SSRS to host the reporting feature; we installed SSRS as well while deploying SQL, and in the following recipes we will configure it.</p></div></div>
<div class="section" title="Preparing our VCM deployment - installing and configuring IIS"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Preparing our VCM deployment - installing and configuring IIS</h1></div></div></div><p>Another important part after the SQL database is IIS. A VCM application is a web-based portal connected to a database, so all the actions are performed via the web interface, which needs IIS. In this recipe, we will install and configure IIS.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Getting ready</h2></div></div></div><p>Again, depending upon the type of VCM deployment, you either need dedicated servers (two- or three-tier) or a single VCM server (single-tier) installation. We will need Windows Server 2012 R2 to start with the recipe.</p><p>As seen in the first diagram in this chapter (in the <span class="emphasis"><em>Understanding VCM components</em></span> subsection) and the <span class="emphasis"><em>Distributed VCM deployment</em></span> subsection, the placement of IIS changes according to the type of deployment.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it...</h2></div></div></div><p>The web components of VCM Collector contain web applications such as IIS and SSRS, other services, and VCM software components. Before you install VCM, you must configure the web components of VCM Collector.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note7"/>Note</h3><p>We will cover the installation process on Windows 2012 R2. Installation on Windows 2008 might differ.</p></div></div><div class="section" title="Installing IIS"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Installing IIS</h3></div></div></div><p>Follow these steps to install IIS:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the IIS server and launch <span class="strong"><strong>Server Manager</strong></span>. Go to <span class="strong"><strong>Manage</strong></span> |<span class="strong"><strong>Add roles and features</strong></span>.</li><li class="listitem">Add the <span class="strong"><strong>Web Server (IIS)</strong></span> role.<div class="mediaobject"><img alt="Installing IIS" src="graphics/image_01_005.jpg"/></div></li><li class="listitem">Add the <span class="strong"><strong>.NET Framework 3.5</strong></span> feature.</li><li class="listitem">Add the following components:<div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. no.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Option</strong></span></p>
</td><td>
<p><span class="strong"><strong>Action</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p>Common HTTP features</p>
</td><td>
<p>Static Content</p><p>
</p><p>Default Document</p><p>
</p><p>Directory Browsing</p><p>
</p><p>HTTP Errors</p><p>
</p><p>HTTP Redirection</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p>Application development</p>
</td><td>
<p>ASP.NET</p><p>
</p><p>.NET Extensibility 3.5</p><p>
</p><p>.NET Extensibility 4.5</p><p>
</p><p>ASP</p><p>
</p><p>ASP .NET 3.5</p><p>
</p><p>ASP .NET 4.5</p><p>
</p><p>ISAPI Extensions</p><p>
</p><p>ISAPI Filters</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p>Health and diagnostics</p>
</td><td>
<p>HTTP Logging</p><p>
</p><p>Logging Tools</p><p>
</p><p>Request Monitor</p><p>
</p><p>Tracing</p>
</td></tr><tr><td>
<p><span class="strong"><strong>4</strong></span></p>
</td><td>
<p>Security</p>
</td><td>
<p>Basic Authentication</p><p>
</p><p>Windows Authentication</p><p>
</p><p>Digest Authentication</p><p>
</p><p>URL Authorization</p><p>
</p><p>Request Filtering</p><p>
</p><p>IP and Domain Restrictions</p>
</td></tr><tr><td>
<p><span class="strong"><strong>5</strong></span></p>
</td><td>
<p>Performance</p>
</td><td>
<p>Static Content Compression</p><p>
</p><p>Dynamic Content Compression</p>
</td></tr><tr><td>
<p><span class="strong"><strong>6</strong></span></p>
</td><td>
<p>Management tools</p>
</td><td>
<p>IIS Management Console</p><p>
</p><p>IIS Management Scripts and Tools</p><p>
</p><p>Management Service</p>
</td></tr></tbody></table></div></li><li class="listitem">Provide a path to the Windows 2012 ISO if required.</li><li class="listitem">Click on <span class="strong"><strong>Install</strong></span> and let the installation begin; follow the wizard and make sure the installation is successful.</li></ol></div></div><div class="section" title="Configuring IIS"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec14"/>Configuring IIS</h3></div></div></div><p>Once IIS has been installed, we need to configure it:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Start</strong></span> and go to <span class="strong"><strong>All Programs</strong></span> | <span class="strong"><strong>Administrative Tools</strong></span> | <span class="strong"><strong>Internet Information Services (IIS) Manager</strong></span>.</li><li class="listitem">Expand <span class="strong"><strong>&lt;server name&gt;</strong></span>, expand <span class="strong"><strong>Sites</strong></span>, and click on <span class="strong"><strong>Default Web Site</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Actions</strong></span> pane, under <span class="strong"><strong>Manage Web Site</strong></span> and <span class="strong"><strong>Browse Web Site</strong></span>, click on <span class="strong"><strong>Advanced Settings</strong></span>.</li><li class="listitem">Expand connection's<span class="strong"><strong> Limits</strong></span> and set <span class="strong"><strong>Connection Time-out (seconds)</strong></span> to <code class="literal">3600</code>.</li><li class="listitem">Click on <span class="strong"><strong>OK</strong></span></li></ol></div><div class="mediaobject"><img alt="Configuring IIS" src="graphics/5400_01_pg-22.jpg"/></div></div><div class="section" title="Configuring the IIS 7.5 default website"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec15"/>Configuring the IIS 7.5 default website</h3></div></div></div><p>IIS 7.5 provides a default website, which defines the default authentication settings for applications and virtual directories. Verify that the IIS 7.5 default website has the correct settings.</p><p>Follow these steps to configure IIS:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on Start and go to <span class="strong"><strong>All Programs</strong></span> | <span class="strong"><strong>Administrative Tools</strong></span> | <span class="strong"><strong>Internet Information Services (IIS) Manager</strong></span>.</li><li class="listitem">Expand <span class="strong"><strong>&lt;server name&gt;</strong></span>, expand <span class="strong"><strong>Sites</strong></span>, and click on <span class="strong"><strong>Default Web Site</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Default Web Site</strong></span> home pane, locate the IIS options.</li><li class="listitem">Double click on <span class="strong"><strong>Authentication</strong></span> and set the authentication settings as follows:</li></ol></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. no.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Option</strong></span></p>
</td><td>
<p><span class="strong"><strong>Action</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p><span class="strong"><strong>Anonymous Authentication</strong></span></p>
</td><td>
<p>Set to <span class="strong"><strong>Disabled</strong></span>.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p><span class="strong"><strong>ASP.NET Impersonation</strong></span></p>
</td><td>
<p>Set to <span class="strong"><strong>Disabled</strong></span>.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p><span class="strong"><strong>Basic Authentication</strong></span></p>
</td><td>
<p>Set to <span class="strong"><strong>Enabled</strong></span>.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>4</strong></span></p>
</td><td>
<p><span class="strong"><strong>Forms Authentication</strong></span></p>
</td><td>
<p>Set to <span class="strong"><strong>Disabled</strong></span></p>
</td></tr></tbody></table></div><p>Your screen should look like this:</p><div class="mediaobject"><img alt="Configuring the IIS 7.5 default website" src="graphics/5400_01_pg-23-1.jpg"/></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How it works...</h2></div></div></div><p>VCM uses IIS to host the web applications that present the data. The web applications relay the commands we give from the VCM console to the database, the operations are performed, and the end result is again presented on the console GUI. VCM creates multiple applications inside IIS that are required for VCM. <code class="literal">CMAppPool</code> and <code class="literal">CMServices</code> are IIS application pools used for VCM virtual directories and web services.</p></div></div>
<div class="section" title="Preparing our VCM deployment - configuring SSRS"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Preparing our VCM deployment - configuring SSRS</h1></div></div></div><p>SSRS is used by VCM for providing the reporting functionality.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Getting ready</h2></div></div></div><p>In this recipe, we will configure SSRS to be used by VCM; as this is not a dedicated SQL guide, it is recommended you consult your DBA team while configuring SSRS.</p><p>To avoid getting charged for multiple licenses of SQL, it is recommended you install SSRS on the same server as the database server, which is what we did when we installed SQL Server.</p><p>We will need SSRS installed on the database server before we start.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>How to do it...</h2></div></div></div><p>Connect to the database server with the service account credentials, launch <span class="strong"><strong>Reporting Service Configuration Manager</strong></span>, and follow the wizard:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the SQL Server instance where the reporting service is installed. Provide the correct server name and instance.</li><li class="listitem">On the <span class="strong"><strong>Service Account</strong></span> page, in this case, use the same service account which will be used by the VCM service. Click on <span class="strong"><strong>Apply</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_008.jpg"/></div></li><li class="listitem">On the <span class="strong"><strong>Web Service URL</strong></span> page, select port <code class="literal">80</code> and click on <span class="strong"><strong>Apply</strong></span>.</li><li class="listitem">Under <span class="strong"><strong>Database</strong></span>, click on <span class="strong"><strong>Change Database</strong></span> and follow another wizard to <span class="strong"><strong>Create a new report database</strong></span>. It involves these steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Create a new report server database</strong></span>.</li><li class="listitem">Under <span class="strong"><strong>Connect to the Database Server</strong></span>, provide these values:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Server Name</strong></span>: The SQL database server name</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Authentication Type</strong></span>: <span class="strong"><strong>Current User - Integrated Security</strong></span></li></ul></div></li><li class="listitem">Use the default database name and language.</li><li class="listitem">Under <span class="strong"><strong>Credentials</strong></span>, use <span class="strong"><strong>Service Credentials</strong></span>.</li><li class="listitem">Accept the summary, click on <span class="strong"><strong>Next</strong></span> and then on <span class="strong"><strong>Finish</strong></span> on the next page to complete the database creation.</li></ol></div></li><li class="listitem">For the <span class="strong"><strong>Report Manager URL</strong></span> tab, select <span class="strong"><strong>Virtual Directory: </strong></span><code class="literal">Reports</code> and click on <span class="strong"><strong>Apply</strong></span>.</li><li class="listitem">We don't need the rest of the parameters for VCM; you can check with your DBA team if they need to configure them and, if so, what the best options for you are.</li><li class="listitem">Write down the URL (we will need this when we install VCM).</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How it works...</h2></div></div></div><p>The report manager and web service URLs will be provided when we install VCM and will then be used by VCM to present reports via its console.</p><p>When we install VCM, the installer will create default reports on the SSRS instance that will be accessed by users when they start using VCM.</p></div></div>
<div class="section" title="Preparing our VCM deployment - installing other prerequisites"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Preparing our VCM deployment - installing other prerequisites</h1></div></div></div><p>There are a few other prerequisites that we need to install before we can actually start installing VCM. We will install them in this recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Getting ready</h2></div></div></div><p>We need Internet access to download the following installers if they are not already available. We need to install them on all the servers in the VCM hierarchy.</p><p>We need to install them in the same sequence, or else they won't get installed.</p><p>The following links are used in this book; they might change if you change the SQL version, such as those of <span class="strong"><strong>SQL Native Client</strong></span> and <span class="strong"><strong>SQL Command Line Utilities</strong></span>:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. no.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Description</strong></span></p>
</td><td>
<p><span class="strong"><strong>Download location</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p>SQL Native Client</p>
</td><td>
<p>
<a class="ulink" href="http://go.microsoft.com/fwlink/?LinkID=239648&amp;clcid=0x409">http://go.microsoft.com/fwlink/?LinkID=239648&amp;clcid=0x409</a>
</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p>SQL Command Line Utilities</p>
</td><td>
<p>
<a class="ulink" href="http://go.microsoft.com/fwlink/?LinkID=239650&amp;clcid=0x409">http://go.microsoft.com/fwlink/?LinkID=239650&amp;clcid=0x409</a>
</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p>SQLXML 4.0 SP1</p>
</td><td>
<p>
<a class="ulink" href="http://www.microsoft.com/en-us/download/details.aspx?id=30403">http://www.microsoft.com/en-us/download/details.aspx?id=30403</a>
</p>
</td></tr></tbody></table></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>How to do it...</h2></div></div></div><p>This is a very simple installation and you just need to click on <span class="strong"><strong>Next</strong></span> and <span class="strong"><strong>Finish</strong></span>.</p><p>Just follow the sequence and install all the three utilities. You must install them on all the servers, that is, if you are deploying a three-tier VCM installation, these three must be installed on all the three servers.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>How it works...</h2></div></div></div><p>These utilities are used by VCM to communicate with the SQL database. If they are not present on the server, then the foundation checker will fail and you will have to install them and start the installer again.</p></div></div>
<div class="section" title="Installing VCM - single-tier deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Installing VCM - single-tier deployment</h1></div></div></div><p>In this recipe, we will deploy vRealize Configuration Manager 5.8.2 on a Windows Server 2012 R2. As the title suggests, this is a single-tier installation; hence, all the VCM components will be installed on a single server. So, the VCM Database server, web server, and the VCM Collector components will reside on a single Windows Server 2008 R2, 2012, or 2012 R2 machine (in our case, Windows Server 2012 R2), which is referred to as the VCM Collector, as illustrated here:</p><div class="mediaobject"><img alt="Installing VCM - single-tier deployment" src="graphics/image_01_009-1.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>Getting ready</h2></div></div></div><p>In this case, we will need a single Windows Server 2012 R2 installation where we have already installed SQL, configured IIS, and installed all the prerequisites by following the previous recipes.</p><p>The VCM installer is available on 
<a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>
. You need to have an account on 
<a class="ulink" href="http://my.vmware.com">my.vmware.com</a>
 to download the installer.</p><p>You need to have all the required service accounts ready in Active Directory, and they should have the permissions described in the requirements document of VCM. The server should be a part of the Active Directory domain, and you must log in with an AD account that is a local administrator on the server.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How to do it...</h2></div></div></div><p>You need to log in with the account that you want to have VCM admin rights to, as the account that is used to install VCM gets full admin rights on the VCM application, so you can choose either your account or any specifically created VCM administrator account.</p><p>Download the installer from the Internet and copy it to the VCM server. Then, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Mount the ISO and start the installation wizard by double clicking on <code class="literal">setup.exe</code>. Select <span class="strong"><strong>Typical Installation</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_010.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note8"/>Note</h3><p><span class="strong"><strong>Typical Installation</strong></span>: This is mostly used for single- or two-tier installations and asks for less information.</p><p>
</p><p><span class="strong"><strong>Advanced Installation</strong></span>: This is mostly used for three-tier installations, as in this type, we need to spread the installation of the Collector and web server on different servers.</p></div></div></li><li class="listitem">Read and accept the license agreement and select "<span class="strong"><strong>I am an authorised agent and/or representative of the customer/end user"</strong></span> and <span class="strong"><strong>"I have read the terms and conditions stated above</strong></span>".</li><li class="listitem">It will perform the prerequisite checks and run a few tests for that; once the tests are complete, select <span class="strong"><strong>View full results of prerequisite check</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_011.jpg"/></div></li><li class="listitem">The results will be launched in Internet Explorer and check whether there are any errors and/or warnings; you can install if there are any warnings but can't proceed if there are errors.</li><li class="listitem">Once you see any error, you can drill down by clicking on the error link in the report; it will then tell you why you faced the error.</li></ol></div><p>In our case, we had not installed the <code class="literal">ServerSideIncludes</code> IIS role service, as shown in the following error report:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_012.jpg"/></div><p>After installing the missing component, we can resume the installer.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the next step, we need to provide the following details:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VCM Database Server (a local or a remote SQL Server instance)</strong></span>: The same server where we are installing as this is a single-tier installation.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> SQL Server Reporting Services WebService URL</strong></span>: You must have noted this down while configuring SSRS; if not, go and launch the SSRS configuration wizard to check the URL. The default is <code class="literal">http://&lt;Server-Name&gt;/ReportServer</code>.</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_013.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Validate...</strong></span> under SSRS Web service, and provide the following information:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Database Server</strong></span>: The hostname of the SSRS server</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Domain</strong></span>: The Active Directory domain</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> User Name</strong></span>: The account to be used to can connect to the SSRS instance</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Password</strong></span>: Password for the user</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Port</strong></span>: The port configured while configuring SSRS</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Virtual Directory</strong></span>: Configured while configuring SSRS</li></ul></div><p>Click on <span class="strong"><strong>Validate</strong></span> and make sure the validation is successful.</p><p>After you fill in the details, the screen should look like this:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_014.jpg"/></div></li><li class="listitem">Enter the license key, provide the service account username and password, and click on <span class="strong"><strong>Validate</strong></span>.</li><li class="listitem">Provide the installation path.</li><li class="listitem">Select <span class="strong"><strong>Use HTTPS. By default a self-signed certificate will be generated. Select an alternate certificate here.</strong></span><p>It will autogenerate a certificate; if you want, you can add your own certificate here:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_015.jpg"/></div><p>The installation can take upto an hour, depending upon the configuration of the server.</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_016.jpg"/></div></li><li class="listitem">Once it is complete, launch the console using <code class="literal">https://&lt;IP or Hostname of Collector&gt;/VCM</code>.</li><li class="listitem">As mentioned at the start of the recipe, only the account that has access to the VCM console is the one that is used for installation; we can add another users later.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_017.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Login</strong></span>, and you will be presented with the VCM console for the first time:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_018.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>How it works...</h2></div></div></div><p>We are installing VCM on a single server where we have already installed SQL, SSRS, and IIS. This console can then be used to manage the entire infrastructure. We will use this console to perform patching, checking compliance, publishing software exporting reports, and a lot more in the upcoming chapters.</p></div></div>
<div class="section" title="Installing VCM - two-tier deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Installing VCM - two-tier deployment</h1></div></div></div><p>As you now know, VCM depends on SQL, and if we have a medium-sized infrastructure, it becomes too much load–the SQL, SSRS, web, and Collector server components–to carry on a single server. We can split the load in two by moving SQL databases to a dedicated server and the web and Collector components on another server.</p><p>This is how the two-tier deployment will look:</p><div class="mediaobject"><img alt="Installing VCM - two-tier deployment" src="graphics/image_01_019-1.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>Getting ready</h2></div></div></div><p>We will need two servers; on one, SQL Server 2012 should be installed with SSRS, and SSRS should be configured as per previous recipes.</p><p>Install all the prerequisites on both the SQL and Collector servers. Have all the mentioned service accounts ready and firewall ports open wherever required.</p><p>Install and configure IIS as per the <span class="emphasis"><em>Preparing our VCM deployment - installing and configuring IIS</em></span> recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>How to do it...</h2></div></div></div><p>As this is a two-tier VCM deployment recipe, you must have guessed that we need to perform the installation on two servers–not exactly correct; we just need to install SQL, configure SSRS, and install the prerequisites on the SQL Server; all the action happens on the VCM Collector server.</p><p>Log in to the collector server with a domain account that has local admin privileges; this is the account on which you want to have admin access on the VCM application.</p><p>Copy the downloaded ISO to the server and mount it.</p><p>Start the installation by double-clicking on <code class="literal">setup.exe</code> on the installer disk, and follow the wizard to install VCM, like this:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In this recipe, we will choose <span class="strong"><strong>Advanced Installation</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> for the introduction page.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> for the patent information page.</li><li class="listitem">Read and accept the license agreement and select "<span class="strong"><strong>I am an authorised agent and/or representative of the customer/end user"</strong></span> and <span class="strong"><strong>"I have read the terms and conditions stated above</strong></span>".</li><li class="listitem">Under <span class="strong"><strong>Select Installation Type</strong></span>, select the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VMware vRealize Configuration Manager</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VCM Web Console</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VCM Collector Components</strong></span></li></ul></div><p>
</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Tools</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> ImportExport Utility</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Foundation Checker</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VMware VCM Package Manager for Windows</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VMware VCM Package Studio</strong></span></li></ul></div><p>
</p></li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_020.jpg"/></div></li><li class="listitem">The installer will perform a prerequisite check and present the results; after the checks are successful, click on <span class="strong"><strong>Next</strong></span>; if there are errors, click on <span class="strong"><strong>View Results</strong></span>, remedy any errors and warnings, and perform a recheck.</li><li class="listitem">Do not proceed further unless there are no errors; you can proceed if there are warnings, but it is not recommended. This is what a successful check looks like:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_021.jpg"/></div></li><li class="listitem">On the next page, enter the serial key.</li><li class="listitem">On the <span class="strong"><strong>Configure Components</strong></span> page, provide the hostname of the SQL Server and enter <code class="literal">VCM</code> as the database name; click on <span class="strong"><strong>Validate</strong></span>.<p>If the validation is successful, it will provide you with the path for the data and log files, along with the <span class="strong"><strong>Size</strong></span> and <span class="strong"><strong>Auto Grow</strong></span> options. You can go with the defaults.</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_022.jpg"/></div></li><li class="listitem">On the next page, provide the Tomcat service account and its password.</li><li class="listitem">On the next page, provide the URL in <span class="strong"><strong>WebService URL</strong></span>; credentials to validate the details include the <span class="strong"><strong>Domain</strong></span>, <span class="strong"><strong>User Name</strong></span>, and <span class="strong"><strong>Password</strong></span>. Click on <span class="strong"><strong>Validate</strong></span>. Accept the warning about insecure SRS, as we had configured it with port <code class="literal">80</code>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_023.jpg"/></div></li><li class="listitem">Provide the path to install the web console to.</li><li class="listitem">Provide a URL to the application; the default <code class="literal">/VCM</code> is a good option.<p>We can provide an SMTP address; the default is the collector server. If you don't know it now, it can be configured in the VCM console.</p></li><li class="listitem">Provide a path to install the collector component to, and accept the SSL3 warning.</li><li class="listitem">Provide a path to store the staging data to; this is the path where data is temporarily stored before being added to the database.</li><li class="listitem">Provide the details of the Collector service account. This account will be given rights to log in as a service; accept the confirmation dialog.</li><li class="listitem">Provide details of network authority accounts. We can add as many accounts as we want later, but we need at least one for the time being. More details about this can be found in the <span class="emphasis"><em>Service accounts</em></span> subsection of this chapter's introduction.</li><li class="listitem">The next page is about certificates. Click on <span class="strong"><strong>Generate</strong></span> and then on <span class="strong"><strong>Next</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_024.jpg"/></div></li><li class="listitem">On the next page, which lets you select domains to run the discovery, select specific NetBIOS and AD domains.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note9"/>Note</h3><p>If you have multiple AD or NetBIOS domains, it will take more than 24 hours to detect all the domains, and the installation could eventually fail. To avoid such a scenario, select a few domains to start with and add the rest of them once VCM is ready.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_025.jpg"/></div></li><li class="listitem">Provide details about the virtual directory and credentials to access it.</li><li class="listitem">Provide the credentials for the Virtualization Client plugin.</li><li class="listitem">On the next page, provide the path to install package manager components to.</li><li class="listitem">On the next page, provide the path to the local package cache.</li><li class="listitem">On the next page, provide the path to the software repository and local cache.</li><li class="listitem">Provide the name of the virtual directory.</li><li class="listitem">Provide the path to the Package Studio components.</li><li class="listitem">Finally, we will have reached the summary page; check the options and click on <span class="strong"><strong>Install</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_026.jpg"/></div></li><li class="listitem">Log in to the portal and make sure the installation was successful.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_01_027.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How it works...</h2></div></div></div><p>We installed VCM on two servers; we had already installed SQL and SSRS on the SQL Server, while IIS for the web and collector components are on the Collector server. The console can then be used to manage the infrastructure. We will use this console to perform patching, compliance checking, publishing software exporting reports, and a lot more in upcoming chapters.</p></div></div>
<div class="section" title="Installing VCM - three-tier deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Installing VCM - three-tier deployment</h1></div></div></div><p>So far, we have covered installing VCM on single and two-tier systems. There will be times when these are not sufficient, and you have a larger infrastructure to manage. To provide services to such large infrastructures, we can share the load across three tiers, namely, the database, web, and collector servers. In this recipe, we will install VCM on three different servers.</p><p>This is how the three-tier deployment will be configured:</p><div class="mediaobject"><img alt="Installing VCM - three-tier deployment" src="graphics/image_01_028.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>Getting ready</h2></div></div></div><p>We will need three different servers to install the database, web, and collector components of the VCM server to.</p><p>We need all the prerequisites installed on all three servers. We should have all the mentioned service accounts ready, and firewall ports should be open wherever required.</p><p>IIS needs to be configured on the web server only.</p><p>SQL Server must be installed and SSRS configured as per previous recipes.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>How to do it...</h2></div></div></div><p>Even though this is a three-tier installation, we don't need to do much on the SQL Server; in addition to installing SQL Server 2012, we need to install the SQL Native Client, SQL Command Line Utilities, and SQLXML 4.0 SP1.</p><p>We will look at the web and collector servers in detail.</p><p>Let's cover the web server first.</p><div class="section" title="Installing web components"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec16"/>Installing web components</h3></div></div></div><p>We need to log in to the web server with a domain account that has local administrative privileges. Mount the <code class="literal">VCM</code> ISO and double-click on <code class="literal">setup.exe</code> on the installer disk. Follow the steps in the wizard to install the web component of VCM, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Advanced Installation</strong></span>, as this is a three-tier installation.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> for the introduction page.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> for the patent information page.</li><li class="listitem">Read and accept the license agreement and select "<span class="strong"><strong>I am an authorized agent and/or representative of the customer/end user</strong></span>" and "<span class="strong"><strong>I have read the terms and conditions stated above</strong></span>".</li><li class="listitem">Under <span class="strong"><strong>Select Installation Type</strong></span>, select the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VMware vRealize Configuration Manager</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VCM Web Console</strong></span></li></ul></div><p>
</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Tools</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VMware VCM Package Manager for Windows</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VMware VCM Package Studio</strong></span></li></ul></div><p>
</p></li></ul></div><div class="mediaobject"><img alt="Installing web components" src="graphics/image_01_029.jpg"/></div></li><li class="listitem">Accept that you have intentionally chosen to split the installation by clicking on <span class="strong"><strong>OK</strong></span> in the dialog box that pops up.</li><li class="listitem">The installer will perform a prerequisite check and present the results. If the check is successful, click on <span class="strong"><strong>Next</strong></span>; if there are failures, click on <span class="strong"><strong>View Results</strong></span>, remedy any errors and warnings, and perform a recheck. Do not proceed further until there are zero errors.<div class="mediaobject"><img alt="Installing web components" src="graphics/image_01_030.jpg"/></div></li><li class="listitem">On the next page, enter the serial key.</li><li class="listitem">On the <span class="strong"><strong>Configure Components</strong></span> page, provide the hostname of the SQL Server and enter <code class="literal">VCM</code> as the database name; click on <span class="strong"><strong>Validate</strong></span>.<p>If the validation is successful, you will be provided with a path for the data and logfiles, along with the <span class="strong"><strong>Size</strong></span> and <span class="strong"><strong>Auto Grow</strong></span> options. You can go with the defaults.</p><div class="mediaobject"><img alt="Installing web components" src="graphics/image_01_031.jpg"/></div></li><li class="listitem">On the next page, provide the Tomcat service account details and its password.</li><li class="listitem">On the next page, provide the URL in <span class="strong"><strong>WebService URL</strong></span>. Credentials to validate the details include the <span class="strong"><strong>Domain</strong></span>, <span class="strong"><strong>User Name</strong></span>, and <span class="strong"><strong>Password</strong></span>. Click on <span class="strong"><strong>Validate</strong></span>. Accept the SRS insecure warning as we had configured it with port <code class="literal">80</code>.</li><li class="listitem">Provide the path to install the web console to.</li><li class="listitem">Provide the URL to the application; it's okay to use the default value.<p>We can provide an SMTP address. The default is the collector server. If you don't know it now, it can be configured in the VCM console.</p></li><li class="listitem">Provide the credentials for the Virtualization Client plugin.</li><li class="listitem">On the next page, provide the path to install the package manager components to.</li><li class="listitem">On the next page, provide the path to the local package cache.</li><li class="listitem">On the next page, provide the path to the software repository and local cache.</li><li class="listitem">Provide the name of the virtual directory.</li><li class="listitem">Provide the path for the Package Studio components.</li><li class="listitem">After this, you'll reach the summary page. Check the options and click on <span class="strong"><strong>Install</strong></span>.<div class="mediaobject"><img alt="Installing web components" src="graphics/image_01_032.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span> to exit the wizard.</li></ol></div><p>This completes the web component installation; now, we have to perform similar steps on the Collector server.</p></div><div class="section" title="Installing Collector server components"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec17"/>Installing Collector server components</h3></div></div></div><p>Once you are finished with the web server, log in to the Collector server with a domain account that has local administrative privileges. Copy the ISO of the VCM installer from the downloaded location and mount it.</p><p>Double-click on the <code class="literal">setup.exe</code> file from the installer media mounted, and follow these steps to complete the wizard.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start with <span class="strong"><strong>Advanced Installation</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> for the introduction page.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> for the patent information page.</li><li class="listitem">Read and accept the license agreement and select "<span class="strong"><strong>I am an authorized agent and/or representative of the customer/end user</strong></span>" and "<span class="strong"><strong>I have read the terms and conditions stated above</strong></span>".</li><li class="listitem">Under <span class="strong"><strong>Select Installation Type</strong></span>, select the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VMware vRealize Configuration Manager</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VCM Collector Components</strong></span></li></ul></div><p>
</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Tools</strong></span><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> ImportExport Utility</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Foundation Checker</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> VMware VCM Package Manager for Windows</strong></span></li></ul></div><p>
</p></li></ul></div><div class="mediaobject"><img alt="Installing Collector server components" src="graphics/image_01_033.jpg"/></div></li><li class="listitem">Accept that you have intentionally chosen to split the installation–click on <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">The installer will perform a prerequisite check and present the results. If the check is successful, click on <span class="strong"><strong>Next</strong></span>; if there are failures, click on <span class="strong"><strong>View Results</strong></span>, remedy any errors and warnings, and perform a recheck. Do not proceed further until there are zero errors.</li><li class="listitem">On the next page, enter the serial key.</li><li class="listitem">Provide the path to install the collector component to and accept the SSL3 warning.</li><li class="listitem">Specify the same database server and database name used when you installed the web components.</li><li class="listitem">Provide details of a Collector service account; this account will be given rights to log in as a service; accept the corresponding dialog box.</li><li class="listitem">Provide details of network authority accounts. We can add as many accounts as we want later, but we need at least one for the time being. More details about this can be found in the <span class="emphasis"><em>Service accounts</em></span> subsection of this chapter's introduction.</li><li class="listitem">The next page is for certificates; click on <span class="strong"><strong>Generate</strong></span> and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">On the next page, in order to select domains to run the discovery, select <span class="strong"><strong>Specific NetBIOS and AD domains</strong></span>.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>If you have multiple AD or NetBIOS domains, it will take more than 24 hours to detect all the domains, and the installation could eventually fail. To avoid such a scenario, select a few domains to start with and add the rest of them once VCM is ready.</p></div></div></li><li class="listitem">On the next page, provide the path to install package manager components to.</li><li class="listitem">On the next page, provide the path to the local package cache.</li><li class="listitem">You will now reach the summary page; check the options and click on <span class="strong"><strong>Install</strong></span>.<div class="mediaobject"><img alt="Installing Collector server components" src="graphics/image_01_034.jpg"/></div></li><li class="listitem">On the final page of the wizard, click on <span class="strong"><strong>Finish</strong></span> to close it and launch the VCM console.</li><li class="listitem">Once connected to the console, you will be able to notice the difference in single and two-tier deployments versus a three-tier deployment.<p>Earlier, our collector and web server were the same, but now, the Collector is different from the web server. Of course, this is expected as we just finished installing them separately.</p><div class="mediaobject"><img alt="Installing Collector server components" src="graphics/image_01_035.jpg"/></div></li></ol></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>How it works...</h2></div></div></div><p>For larger environments, such as where we need to manage more than 2,000 machines, it is recommended to have a three-tier deployment. Here, the Collector acts as middleware between the frontend IIS web component and the backend SQL database component. This distributes load between all the three components.</p><p>In a three-tier installation, when you want to connect to the VCM console, you need to use a web server and not a collector server. So, the link will be something like this:</p><p><code class="literal">https://&lt;Web Server IP/Hostname&gt;/VCM</code></p></div></div>
<div class="section" title="VCM post-installation tasks - database fine tuning"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>VCM post-installation tasks - database fine tuning</h1></div></div></div><p>VCM relies heavily on its SQL databases for operation. You must update the default settings in order to optimize SQL Server performance. We will create a maintenance plan for VCM databases.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>Getting ready</h2></div></div></div><p>Log in to SQL Server with an account that has SQL admin privileges.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec34"/>How to do it...</h2></div></div></div><p>We will perform the fine-tuning at three different levels, as detailed in the following subsections.</p><div class="section" title="SQL Server - database settings"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec18"/>SQL Server - database settings</h3></div></div></div><p>To ensure that VCM runs at peak performance and requires little operator intervention during its lifecycle, set up a routine maintenance plan. Take a look at the <span class="emphasis"><em>VCM Administration Guide</em></span>.</p><p>Open SQL Server Management Studio and connect to the VCM SQL Server instance. Then, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Right-click on the SQL instance that you installed and select <span class="strong"><strong>Properties</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Select a page</strong></span> area, select <span class="strong"><strong>Database Settings</strong></span>.</li><li class="listitem">Configure the following settings:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Default index fill factor</strong></span>: Set the fill factor to <code class="literal">80%</code> in order to keep 20% free space available in each index page</li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p><span class="strong"><strong>Note</strong></span>: This sets a percentage value for the amount of free space in each index page when the page is rebuilt. Set the fill factor to <code class="literal">80% </code>to keep 20% free space available in each index page. This setting is part of the SQL maintenance plan wizard. If you configure the default fill factor using this setting, keep space free in an index when you run a maintenance plan.</p></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Recovery interval (minutes)</strong></span>: Set the value to <code class="literal">5</code></li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p><span class="strong"><strong>Note</strong></span>: This configures the approximate amount of time that SQL Server takes to run the recovery process. The default setting is <code class="literal">0</code>, which causes SQL Server to adjust this value and base the values on the historical operation of the server. In large environments, the recovery interval can affect the overall performance of VCM. Because VCM constantly updates how it interacts with SQL Server to process activities whose intervals differ, such as an inspection request and a compliance run, the server expends a lot of time constantly adjusting this value. By setting the recovery interval to <code class="literal">5</code> minutes, SQL Server no longer needs to tune this value.</p></div></div></li><li class="listitem">Click on <span class="strong"><strong>OK</strong></span> to save the settings.</li></ol></div></div><div class="section" title="SQL Server - maintenance plan"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec19"/>SQL Server - maintenance plan</h3></div></div></div><p>To ensure that VCM runs at peak performance and requires little operator intervention during its lifecycle, you must set up a routine maintenance plan. VCM relies heavily on its SQL databases for operation.</p><p>The maintenance plan uses the automated maintenance functions on the SQL Server instances that host the VCM database.</p><p>On the VCM SQL Server instance, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Start</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>All Programs</strong></span> | <span class="strong"><strong>Microsoft SQL Server {version}</strong></span> | <span class="strong"><strong>SQL Server Management Studio</strong></span>.</li><li class="listitem">Expand the <span class="strong"><strong>Management</strong></span> folder, right-click on <span class="strong"><strong>Maintenance Plans</strong></span>, and select <span class="strong"><strong>Maintenance Plan Wizard</strong></span>.</li><li class="listitem">On the <span class="strong"><strong>Maintenance Plan Wizard</strong></span> page, click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">On the <span class="strong"><strong>Select Plan Properties</strong></span> page, enter a maintenance plan name, select <span class="strong"><strong>Single schedule for the entire plan or no schedul</strong></span>e, and click on <span class="strong"><strong>Change</strong></span>.</li><li class="listitem">On the <span class="strong"><strong>Job Schedule Properties - Maintenance Plan</strong></span> page, set the scheduling properties to run the maintenance plan when the SQL Server is idle or has low usage.</li><li class="listitem">Click on <span class="strong"><strong>OK</strong></span> to return to the <span class="strong"><strong>Select Plan Properties</strong></span> page, and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">On the <span class="strong"><strong>Select Maintenance Tasks</strong></span> page, select the following maintenance tasks and click on <span class="strong"><strong>Next</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Check Database Integrity</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Rebuild Index</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Update Statistics</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong> Clean Up History</strong></span></li></ul></div></li><li class="listitem">On the <span class="strong"><strong>Select Maintenance Task Order</strong></span> page, order the maintenance tasks and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">On the <span class="strong"><strong>Define Database Check Integrity Task</strong></span> page, define how the maintenance plan will check database integrity:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>Databases</strong></span> drop-down menu.</li><li class="listitem">Select the following databases and click on <span class="strong"><strong>OK</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">VCM</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VCM_Coll</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VCM_Raw</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VCM_UNIX</code></li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p><span class="strong"><strong>Note</strong></span>: You must select the <code class="literal">VCM_Raw</code> database, because it contains transient data that the other databases consume.</p></div></div></li><li class="listitem">Select <span class="strong"><strong>Include indexes</strong></span> and click on <span class="strong"><strong>Next</strong></span>.</li></ol></div></li><li class="listitem">On the <span class="strong"><strong>Define Rebuild Index Task</strong></span> page, define how the maintenance plan will rebuild the index:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>Databases</strong></span> drop-down menu.</li><li class="listitem">Select the following databases and click on <span class="strong"><strong>OK</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">VCM</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VCM_Coll</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VCM_UNIX</code></li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip14"/>Tip</h3><p><span class="strong"><strong>Note</strong></span>: Do not rebuild the index for the <code class="literal">VCM_Raw</code> database.</p></div></div></li><li class="listitem">In the <span class="strong"><strong>Advanced Options</strong></span> area, select <span class="strong"><strong>Sort results in tempdb</strong></span> and click on <span class="strong"><strong>Next</strong></span>.</li></ol></div></li><li class="listitem">On the <span class="strong"><strong>Define Update Statistics Task</strong></span> page, define how the maintenance plan will update database statistics:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>Databases</strong></span> drop-down menu.</li><li class="listitem">Select the following databases and click on <span class="strong"><strong>OK</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">VCM</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VCM_Coll</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VCM_UNIX</code></li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip15"/>Tip</h3><p><span class="strong"><strong>Note</strong></span>: Do not update statistics for the <code class="literal">VCM_Raw</code> database.</p></div></div></li></ol></div></li><li class="listitem">On the <span class="strong"><strong>Define History Cleanup Task</strong></span> page, define how the maintenance plan will clean up historical data from the SQL Server machine, and click on <span class="strong"><strong>Next</strong></span>:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Backup and restore history</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>SQL Server Agent job history</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Maintenance plan history</strong></span>.</li><li class="listitem">Set the cleanup task to remove historical data older than 4 months.</li></ol></div><p>
</p></li><li class="listitem">On the <span class="strong"><strong>Select Report Options</strong></span> page, save a report of the maintenance plan actions:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Write a report to a text file</strong></span>.</li><li class="listitem">Select a folder for the report and click <span class="strong"><strong>Next</strong></span>.</li></ol></div><p>
</p></li><li class="listitem">On the <span class="strong"><strong>Complete the Wizard</strong></span> page, verify your selections in the <span class="strong"><strong>Maintenance Plan Wizard</strong></span> summary, expand the selections to view the settings, and click on <span class="strong"><strong>Finish</strong></span>.</li><li class="listitem">When the <span class="strong"><strong>Maintenance Plan Wizard</strong></span> progress has finished, verify that each action was successful.</li></ol></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec35"/>How it works...</h2></div></div></div><p>In this recipe, we tried to make sure that our SQL Server for VCM is performing optimally and we don't need much operator intervention for VCM maintenance.</p><p>We scheduled a maintenance plan to keep our database clutter free and help it perform better.</p></div></div></body></html>