<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Deploying Servers on Ubuntu"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Deploying Servers on Ubuntu</h1></div></div></div><p>Hundreds of different services can be deployed on an Ubuntu Server, and each one of these services can be detailed in an entire book. In this chapter, we will have a look at the essentials of setting up and configuring some of the most common servers that system administrators need. Newbies will get a step-by-step guide, and advanced users will discover the Ubuntu approach towards servers. We will start with the deployment of the famous OpenSSH server. Then, we'll move on to set up a DNS server. After that, we will cover how to turn on a web and an e-mail server. Finally, we will cover how to deploy a database, DHCP, and file server.</p><p>The following topics are covered in the chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Deploying an OpenSSH server</li><li class="listitem" style="list-style-type: disc">Setting up a DNS server</li><li class="listitem" style="list-style-type: disc">Turning on a web server</li><li class="listitem" style="list-style-type: disc">Deploying a mail server</li><li class="listitem" style="list-style-type: disc">Setting up a database server</li><li class="listitem" style="list-style-type: disc">Setting up a DHCP server</li><li class="listitem" style="list-style-type: disc">Installing a file server</li></ul></div><div class="section" title="Deploying an OpenSSH server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Deploying an OpenSSH server</h1></div></div></div><p>Let's start with the most <a class="indexterm" id="id104"/>useful server that, according to me, every administrator should install on their server, irrespective of the aim of this server and the services that need to be put on it. It is the <span class="strong"><strong>OpenSSH</strong></span> <a class="indexterm" id="id105"/>server that allows you to remotely connect in a secure way to a server from a computer that can reach this server. The OpenSSH server is a set of tools that allow, besides the secure remote connection, a secure file transfer with the help of the scp protocol.</p><p>The OpenSSH server allows clients to connect using many authentication methods, such as a plain password, a public key, and kerberos tickets.</p><div class="section" title="Installing the OpenSSH server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec25"/>Installing the OpenSSH server</h2></div></div></div><p>We can install<a class="indexterm" id="id106"/> only the OpenSSH server, but in general, we need both the OpenSSH tools—a server and a client. We need a server to connect to the Ubuntu Server that we are working on from a reachable computer. We require a client to connect it to another server or computer.</p><p>Installing OpenSSH (the server and client) is quite easy. To install the OpenSSH client, you need to run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install openssh-client</strong></span>
</pre></div><p>For the OpenSSH server, we previously saw that we can install it by using the <code class="literal">tasksel</code> utility during the Ubuntu Server installation process, but if you forgot to do this in the preceding step, you need to run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install openssh-server</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>To install both the client and the server at once, you can simply run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install ssh</strong></span>
</pre></div></div></div></div><div class="section" title="Configuring the OpenSSH server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec26"/>Configuring the OpenSSH server</h2></div></div></div><p>The OpenSSH server is <a class="indexterm" id="id107"/>handled by the <code class="literal">sshd</code> daemon. Its configuration is located in the <code class="literal">/etc/ssh/sshd_config</code> file, which can be modified by editing it.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>A bad manipulation of this file can alter the SSH server work and break it. Therefore, it is better to start by performing a backup for this file and, as a security measurement, set the backup file as read-only by using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.original</strong></span>
<span class="strong"><strong>sudo chmod a-w /etc/ssh/sshd_config.original</strong></span>
</pre></div></div></div><p>Let's have a look at a couple of examples of what you can change by using this file. For the first example, find the port number. By default, <code class="literal">sshd</code> is listening on port <span class="emphasis"><em>22</em></span>. You can change this behavior and configure it to make it listen on port <span class="emphasis"><em>2233</em></span> by setting the value of the port directive to <span class="emphasis"><em>2233</em></span> inside this file. You will also find the <a class="indexterm" id="id108"/>
<span class="strong"><strong>HostKey</strong></span> directive, which allows us to set authentication keys paths. Another example is an instance where you would like to show the banner message that exists in the <code class="literal">/etc/issue.net</code> file as a pre-login message by commenting out the following line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>#Banner /etc/issue.net</strong></span>
</pre></div><p>If you would like to know more about the configuration directives that can be changed, and the eventual values and their use, just run the man <code class="literal">sshd_config</code> command.</p><p>After making <a class="indexterm" id="id109"/>modifications in the <code class="literal">/etc/ssh/sshd_config</code> file, you should save it and then restart the daemon by using the <code class="literal">sudo service ssh restart</code> command.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>Be careful when editing this file from a remote location, especially when the remote connection is the only way of reaching the server, because modifying this file can change the way it behaves when interacting with the network. Besides, in case there are some errors in this file and you restart the <code class="literal">sshd</code> daemon, the server may not start again and you will lose the connection on the server. Therefore, be careful and prepare your plan B (for example, having someone on site to reestablish the connection by restoring the original backup file).</p><p>Note that by running <code class="literal">/usr/bin/sshd -t</code>, you can test the <code class="literal">config</code> file before restarting the server and thus avoid the eventual problems that we talked about in the preceding section.</p></div></div></div></div></div>
<div class="section" title="Setting up a DNS server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Setting up a DNS server</h1></div></div></div><p>A <span class="strong"><strong>DNS</strong></span> is a <a class="indexterm" id="id110"/>
<span class="strong"><strong>domain name system</strong></span> server that answers queries about domain names by providing the relative IP address. It is a must for www working; without it, users will have to learn the IP addresses of every website that they want to visit and type them manually in their browser (or add them manually to host files), which is impossible.</p><p>There are a lot of programs that provide DNS services under Ubuntu, but the most common one is BIND.</p><div class="section" title="The BIND installation"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec27"/>The BIND installation</h2></div></div></div><p>If you missed<a class="indexterm" id="id111"/> installing BIND during the Ubuntu Server installation, you can do it now, and there is more than one way of doing that.</p><p>You can either use the <code class="literal">tasksel</code> utility, which will automatically install for you the two <code class="literal">bind9</code> and <code class="literal">bind9-doc</code> packages. Alternatively, you can use the <code class="literal">apt-get</code> tool, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install bind9 bind9-doc</strong></span>
</pre></div><p>Once the <a class="indexterm" id="id112"/>BIND packages are installed, it is fully configured and functional with the default parameters that allow it to work as a caching DNS for recursive queries. You can of course customize it to fit your needs. We will discuss how to do that in the following sections.</p><p>You can check BIND's status by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service bind9 status</strong></span>
</pre></div><p>In case it is not running, you can launch it by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service bind9 start</strong></span>
</pre></div><p>The output of this command is shown in the following screenshot:</p><div class="mediaobject"><img alt="The BIND installation" src="graphics/B04800_03_01.jpg"/></div><div class="section" title="Ubuntu's BIND conventions"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec05"/>Ubuntu's BIND conventions</h3></div></div></div><p>BIND files may have an <a class="indexterm" id="id113"/>organization in Ubuntu that is different from the ones in other distributions. The following are the basic files and directories:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/bind</code>: This is the main directory for the BIND configuration files. It also contains the <code class="literal">zone</code> files.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/bind/named.conf</code>: This is BIND's main configuration file. It includes scripts from other files, with the most notable ones being: <code class="literal">/etc/bind/named.conf.default-zones</code>, which contains a default zone such as local host; <code class="literal">/etc/bind/named.conf.local</code>, which contains zones added by the system administrator (use this file when you would like to add zones); and <code class="literal">/etc/bind/named.conf.options</code>, which contains additional options such as forwarders' addresses.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/bind/db.*</code>: The <a class="indexterm" id="id114"/>zone files, which contain information related to each zone, have the convention of starting with <code class="literal">db.</code>, and each file identifies a particular zone.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/init.d/bind9</code>: This is the file that contains the BIND startup parameters that are needed to launch the service.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/var/log/syslog</code>: By default, BIND uses this file to store its logs. This file contains the log of a lot of other services. So, if you would like to have only the BIND log, you can simply search for the named keyword using the <code class="literal">grep</code> command, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>grep named /var/log/syslog</strong></span>
</pre></div></li></ul></div></div></div><div class="section" title="Configuring BIND"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec28"/>Configuring BIND</h2></div></div></div><p>Configuring BIND<a class="indexterm" id="id115"/> is simple. It is always about creating new zones (or editing the existing ones). This is done by performing the following three steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Either create a zone file relative to the zone that needs to be added, or edit an existing one.</li><li class="listitem">Add a reference to the zone file in <code class="literal">/etc/bind/named.conf.local</code></li><li class="listitem">Reload the BIND service by using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service bind9 reload</strong></span>
</pre></div></li></ol></div></div><div class="section" title="Zone file configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec29"/>Zone file configuration</h2></div></div></div><p>The <a class="indexterm" id="id116"/>details related to a specific domain name are stored in a DNS server in an entity called <span class="strong"><strong>zone</strong></span>. Each zone is represented by a file under the <code class="literal">/etc/bind/ directory</code>. In this section, we will take a look at how to configure a DNS zone file.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>If you would like to get more information about this subject, a complete tutorial on zone files and their contents is available at <a class="ulink" href="http://www.slashroot.in/what-dns-zone-file-complete-tutorial-zone-file-and-its-contents">http://www.slashroot.in/what-dns-zone-file-complete-tutorial-zone-file-and-its-contents</a>.</p></div></div><p>The zone files <a class="indexterm" id="id117"/>have the same structure. So, an easy way of configuring a new zone is by copying an existing zone file (such as <code class="literal">/etc/bind/db.local</code>) and then modifying it as required.</p><p>By default, timers in the zone file are set in seconds. You can use other time units such as the day by adding the letter <code class="literal">d</code> to the value, the week by adding the letter <code class="literal">w</code>, the hour using the letter <code class="literal">h</code>, and so on.</p><p>The following are the most important fields in the zone file configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>SOA</strong></span>: <span class="strong"><strong>Start of Authority</strong></span>, this server is considered to be the best source of information</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>NS</strong></span>: This is the name servers for the zone file</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>A</strong></span>: This is IPv4 address</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>AAAA</strong></span>: This is IPv6 address</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>MX</strong></span>: This is the mail server</li></ul></div><p>You also need to configure a reversed DNS file for every zone that you create. The structure is also the same, so you can just copy one of the default reversed zones, such as <code class="literal">/etc/bind/db.127</code>.</p><p>To reference a zone file inside <code class="literal">/etc/bind/named.conf.local</code>, you need to just copy a sample of an existing reference and modify it. The following is an example that demonstrates this:</p><div class="informalexample"><pre class="programlisting">zone "localhost" {
  type master;
  file "/etc/bind/db.local";
};
zone "127.in-addr.arpa" {
  type master;
  file "/etc/bind/db.127";
};</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>When you reload BIND, it will take into consideration the modified zone file that has a higher serial number. So, be sure to increment the serial field in the zone file each time you modify it. If you don't do this, your modifications will be ignored. Most system administrators use the yyyyMMddHHmm format for this field.</p></div></div></div><div class="section" title="DNS redundancy"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec30"/>DNS redundancy</h2></div></div></div><p>DNS is a critical service<a class="indexterm" id="id118"/> for web and e-mail applications. So, it is important to have a redundancy of the main DNS server (called <span class="strong"><strong>salve</strong></span>), which has the same information as the <span class="strong"><strong>master</strong></span> DNS server.</p><p>To configure this, you have to add the salve server to the zone file in the master server by using the NS record. Then, when referencing the zone file, you should add the allow-transfer option to the zone definition inside the master DNS to allow the slave DNS to copy the data from it. You can also add the also-notify option so that the master DNS will notify the slave DNS for every modification inside that zone. On the other hand, in the slave server, the zone definition should contain the slave type and point to the master server. As an example, if we assume that the IP address of the master DNS is <span class="emphasis"><em>192.168.1.1 </em></span>and the IP address of the slave DNS is <span class="emphasis"><em>192.168.1.2</em></span>, we should get the following output:</p><p>On the <code class="literal">master</code> server you will find the following output:</p><div class="informalexample"><pre class="programlisting">zone "localhost" {
  type master;
  file "/etc/bind/db.local";
  allow-transfer { 192.168.1.2; };
  also-notify { 192.168.1.2; };
};
zone "127.in-addr.arpa" {
  type master;
  file "/etc/bind/db.127";
  allow-transfer { 192.168.1.2; };
  also-notify { 192.168.1.2; };
};</pre></div><p>On the <code class="literal">slave</code> server you will find the following output:</p><div class="informalexample"><pre class="programlisting">zone "localhost" {
  type slave;
  file "/etc/bind/db.local";
  masters { 192.168.1.1; };
};
zone "127.in-addr.arpa" {
  type slave;
  file "/etc/bind/db.127";
  masters { 192.168.1.1; };
};</pre></div></div><div class="section" title="DNS testing"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec31"/>DNS testing</h2></div></div></div><p>To test whether your <a class="indexterm" id="id119"/>DNS is working, you should request to server and check the correctness of the information. To do this, you should either use a computer in which you point your name server to this DNS, or simply add the IP address of that DNS server as a parameter.</p><p>The famous NsLookup tool<a class="indexterm" id="id120"/> is the simplest tool to test DNS and reverse DNS. There is also the <code class="literal">dig</code> utility, which gives a richer answer, and the host tool, which is similar to NsLookup.</p></div></div>
<div class="section" title="Turning on a web server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Turning on a web server</h1></div></div></div><p>There are a lot <a class="indexterm" id="id121"/>of open source web servers that we can deploy on the Ubuntu Server, such as Apache Tomcat, NGINX, and Jetty. Each web server should be installed and configured to deal with a specific programming language. We should also install its libraries, along with the installation and configuration of the database that is necessary for the web server. Instead of doing all of this, especially when you need a web server to deploy an application developed in PHP, Perl, or Python, the best choice is to install a LAMP server.</p><p>
<span class="strong"><strong>LAMP</strong></span> is the abbreviation for <a class="indexterm" id="id122"/>
<span class="strong"><strong>Linux Apache MySQL PHP</strong></span> (or sometimes <span class="strong"><strong>Perl</strong></span> or <span class="strong"><strong>Python</strong></span>). It is the de facto standard for a web server deployment based on a combination of the Apache web server program that is used with Perl, PHP, or Python for dynamic content handling, and a MySQL database on the backend, with all of these components running on a Linux server. It has become a common way of setting up a web server deployment under Linux. That's the reason why Ubuntu has grouped all the necessary packages together—to simplify using LAMP inside an Ubuntu Server.</p><div class="section" title="The LAMP Installation"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec32"/>The LAMP Installation</h2></div></div></div><p>There are a <a class="indexterm" id="id123"/>few different ways of setting up a web server on a default Ubuntu Server installation. Probably the easiest method is selecting the LAMP server during <a class="indexterm" id="id124"/>the initial installation, or afterwards with the <code class="literal">tasksel</code> tool. This will add the <code class="literal">apache2</code>, <code class="literal">apache2-mpm-prefork</code>, <code class="literal">mysql-server-5.6</code>, <code class="literal">mysql-client-5.6</code>, and <code class="literal">php5-mysql</code> packages along with all of their libraries and other dependencies. Alternatively, you can install each of these packages from the command line using the <code class="literal">apt-get install</code> tool.</p><p>During installation, the package manager will ask you to enter the root password of the MySQL database, as shown in the following screenshot:</p><div class="mediaobject"><img alt="The LAMP Installation" src="graphics/B04800_03_02.jpg"/></div><p>Entering the <a class="indexterm" id="id125"/>password is optional. You can keep it empty, but for security reasons it is recommended that you set a root password for the MySQL database. If you don't do that, anyone with an account on the server can access your database and read, alter, and even delete data.</p><p>After installing<a class="indexterm" id="id126"/> the LAMP server, there is an additional program that is very helpful and which can be installed. This program is called <a class="indexterm" id="id127"/>
<span class="strong"><strong>phpMyAdmin</strong></span>. It is a LAMP application that was specifically written for the administration of MySQL servers. It provides an easy graphical interface for database administration tasks that are written in PHP and which can be accessed via a web browser.</p><p>To install it, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install phpmyadmin</strong></span>
</pre></div><p>During installation, you will be asked to choose the web server that you want to configure for phpMyAdmin. In our case, it is <code class="literal">apache2</code>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="The LAMP Installation" src="graphics/B04800_03_03.jpg"/></div><p>You can test the <a class="indexterm" id="id128"/>LAMP server by using the IP address of the <a class="indexterm" id="id129"/>Ubuntu Server on your web browser. You should get the Apache2 default page. Also, you can test <code class="literal">phpmyadmin</code> by using <code class="literal">&lt;ubuntu-server-IP&gt;/phpmyadmin</code>. You will get the login interface (use the MySQL parameters to log in to <code class="literal">phpmyadmin</code>).</p><div class="section" title="Ubuntu's LAMP Conventions"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec06"/>Ubuntu's LAMP Conventions</h3></div></div></div><p>Like most other distributions, Ubuntu <a class="indexterm" id="id130"/>has certain conventions when it comes to the Apache administration. Configuration files are organized in a particular way, as are administrative tools and logs. If you aren't used to the way Debian and Ubuntu organize Apache, it is quite different from what you may have seen on other distributions. Here are the major file conventions for Apache:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2</code>: This directory contains all the Apache configuration files. Formerly, Apache was configured via one large <code class="literal">httpd.conf</code> file, which contained options, settings, and different virtual hosts. Actually, this file is empty because Ubuntu has moved away from the monolithic <code class="literal">httpd.conf</code> model and has split up its configuration across a number of files and subdirectories.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/apache2.conf</code>: This is the main Apache configuration file that is used by Ubuntu's Apache2 binary. The default <code class="literal">apache2.conf</code> file is heavily commented. So, it works well as a guide in and of itself to each configuration option and what it does.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/envvars</code>: This file contains the definition of the environment variables used by different scripts when Apache starts to define settings such as the location of the PID files.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/ports.conf</code>: This <a class="indexterm" id="id131"/>file is used to define which ports Apache listens on when it starts. The default settings make it listen on the standard port <span class="emphasis"><em>80,</em></span> and additionally on port <span class="emphasis"><em>443</em></span> when the SSL module is enabled.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/conf.d/</code>: This directory is listed as an included directory in the main <code class="literal">apache2.conf</code> file, which means that when Apache starts, it will also include the configuration files found in this directory and add them to the overall configuration. This directory is used for additional Apache options that an administrator (or a package) might want to add separately from the core <code class="literal">apache2.conf</code> file.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/mods-available/</code>: Ubuntu offers a simpler and more modular approach than the traditional way of adding modules. All the modules that are available on the system are represented within this directory by the .load and <code class="literal">.conf</code> files.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/mods-enabled/</code>: This directory basically contains symbolic links to the .load and .conf files in the <code class="literal">mods-enabled</code> directory. When Apache starts, it will scan this directory and load all the modules referenced within the directory. So for instance, if you want to enable the SSL module, you can run <code class="literal">sudo ln -s /etc/apache2/mod-available/ssl.load /etc/apache2/mods-enabled/ssl.load</code>. Ubuntu even provides tools to simplify this. To enable a module, just run <code class="literal">a2enmod</code>, followed by the module that you want to enable. For example, to enable the SSL module as we did previously, just run <code class="literal">sudo a2enmod ssl</code>. Likewise, there is an <code class="literal">a2dismod</code> program that will disable a module for you. It takes the same syntax as <code class="literal">a2enmod</code>. So, to disable SSL, execute <code class="literal">sudo a2dismod ssl</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/sites-available/</code>: Ubuntu organizes the Apache virtual hosts in a similar way to how it organizes modules. Under Ubuntu, every virtual host or site that is available to be served by Apache on this machine has its configuration in a separate file under sites-available.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/apache2/sites-enabled/</code>: Like <code class="literal">mods-enabled</code>, this directory contains symbolic links to configuration files in sites-available. So, when you want to add a new virtual host to Apache, just create a new configuration file for the host that contains a complete <code class="literal">&lt;VirtualHost&gt;</code> block under sites-available, and <span class="strong"><strong>symbolic link</strong></span> (<span class="strong"><strong>symlink</strong></span>) it here:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo ln -s /etc/apache2/sites-available/mysite /etc/apache2/sites-enabled/mysite</strong></span>
</pre></div><p>Alternatively, you can use the <code class="literal">a2ensite</code> script that works just like <code class="literal">a2enmod</code>. Just run <code class="literal">a2enmod</code> with the site that you wish to enable as an argument. To enable <code class="literal">mysite</code>, type <code class="literal">sudo a2ensite mysite</code>, and to disable it you can use <code class="literal">a2dissite</code>, as follows:</p><div class="informalexample"><pre class="programlisting">sudo a2dissite mysite</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">/var/www/</code>: This is <a class="indexterm" id="id132"/>the default document root for Apache. An HTML file that is readable by Apache and placed in this directory will be available once you point a web browser at the server. There is already a default <code class="literal">index.html</code> in this directory.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/usr/lib/cgi-bin/</code>: This is the default location for the CGI scripts. The scripts referenced on the web server by <code class="literal">/cgi-bin</code> will point here.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/var/log/apache2/</code>: This is the standard directory in which the Apache logs are stored. The <code class="literal">access.log</code> file contains information about the files that have been accessed on the web server, and the <code class="literal">error.log</code> file lists the Apache errors. In case you have trouble starting Apache, look in <code class="literal">error.log</code> for clues.</li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>To activate the new configuration, you need to run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service apache2 restart</strong></span>
</pre></div></div></div></div></div><div class="section" title="Apache management and testing"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec33"/>Apache management and testing</h2></div></div></div><p>In the <a class="indexterm" id="id133"/>following <a class="indexterm" id="id134"/>section, we will discover one of the most helpful <a class="indexterm" id="id135"/>Apache tools named <code class="literal">apache2ctl,</code> and some of its applications.</p><div class="section" title="apache2ctl"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec07"/>apache2ctl</h3></div></div></div><p>The <code class="literal">/usr/sbin/apache2ctl</code> program <a class="indexterm" id="id136"/>is the primary command-line program<a class="indexterm" id="id137"/> that you will use to manage Apache under Ubuntu. The syntax for the command is fairly straightforward. Run <code class="literal">apache2ctl</code> from the command line and pass a single command to it as an argument. The simple start, stop, and restart commands will, as you might imagine, start, stop, and restart the Apache process respectively. You can also achieve the same functionality with the <code class="literal">apache2 init</code> script. Therefore, the three commands that do the same thing are as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apache2ctl restart</strong></span>
<span class="strong"><strong>sudo /etc/init.d/apache2 restart</strong></span>
<span class="strong"><strong>sudo service apache2 restart</strong></span>
</pre></div></div><div class="section" title="Stopping Apache gracefully"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec08"/>Stopping Apache gracefully</h3></div></div></div><p>There is a<a class="indexterm" id="id138"/> potential risk associated with the <code class="literal">restart</code> and <code class="literal">stop</code> commands. When you restart or stop Apache with these commands, all the currently running Apache processes are killed, even if they are in the middle of serving files to a user. If you issue a <code class="literal">restart</code> command when a user is in the middle of loading a page, it will only load as much information as it currently has and then stop loading a page, thus forcing users to reload the page. To avoid this, <code class="literal">apache2ctl</code> has provided the <code class="literal">graceful</code> and <code class="literal">graceful-stop</code> commands.</p><p>These commands restart and stop Apache respectively, but when they do, they wait for each process to finish the outstanding requests first. On an active site, a graceful restart won't even be noticed by anyone using the service. In general, unless you know that a site is not actively serving traffic (or unless you don't care whether all the active connections are closed), you should use <code class="literal">graceful</code> and <code class="literal">graceful-stop</code>. The only exception is when you add new SSL certificates to a site or make other changes that do require a full Apache restart to take effect.</p></div><div class="section" title="Diagnostic apache2ctl commands"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec09"/>Diagnostic apache2ctl commands</h3></div></div></div><p>The other main commands<a class="indexterm" id="id139"/> for <code class="literal">apache2ctl</code> provide more diagnostic features. The first, <code class="literal">configtest</code>, will test the current Apache configuration files for errors. This can be very useful in case you decide to automate the deployment of Apache scripts. When you set up a script to deploy configuration files and restart Apache, a challenge that you may face is that in case you have made a mistake in the configuration files, Apache might not start a back up. If you deploy the same file to the entire web farm, you may potentially bring the entire web farm down with a single syntax error and a script that blindly deploys and restarts Apache. With <code class="literal">configtest</code>, you can set up logic in your deployment scripts that restarts Apache once a server has passed the <code class="literal">configtest</code> command.</p><p>As an Apache server gets traffic, you typically want to get diagnostic information from it, such as how many Apache processes are active, what those processes are doing, and how many open slots you still have available. The <code class="literal">status</code> and <code class="literal">fullstatus apache2ctl</code> commands provide you with a lot of great diagnostic data. The status command outputs a general-purpose overall status of the Apache server, including how long the server has been up, how many requests are active, and how many processes are idle. In addition to this, it outputs an ASCII art map of all the available processes with different letters representing different process states. The <code class="literal">fullstatus</code> command outputs similar information, with just more of it and in more detail.</p></div></div></div>
<div class="section" title="Deploying an e-mail server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Deploying an e-mail server</h1></div></div></div><p>Along with the<a class="indexterm" id="id140"/> Web, e-mail is probably the service that most people think of when they think of the Internet. Like web servers, e-mail servers have traditionally been pretty tricky to set up, and there are many guides and books on this subject. However, you will find that e-mail servers are pretty easy to set up and use under Ubuntu.</p><p>Installing an e-mail server requires you to manage the sending and receiving of e-mails. These two notions are important because they implement two different protocols—<span class="strong"><strong>SMTP</strong></span> to <a class="indexterm" id="id141"/>send, and <a class="indexterm" id="id142"/>
<span class="strong"><strong>POP</strong></span> or <span class="strong"><strong>IMAP</strong></span> <a class="indexterm" id="id143"/>to receive the messages.</p><p>When a user sends an e-mail it is in fact never in direct contact with the recipient. The e-mail goes through at least two servers that are, in order, the sending server (SMTP), called the <span class="strong"><strong>MTA</strong></span> (<span class="strong"><strong>Mail Transfer Agent</strong></span>), which<a class="indexterm" id="id144"/> sends it to the receiver server (POP or IMAP), called <a class="indexterm" id="id145"/>
<span class="strong"><strong>MDA</strong></span> (<span class="strong"><strong>Mail Delivery Agent</strong></span>), possibly transiting the e-mail via other SMTP servers as well. Then, the e-mail will wait on this last server until the recipient launches its e-mail client (such as Thunderbird), which will retrieve the message from the receiving server via one of the two POP or IMAP protocols.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>We can find all of these servers located on the same machine or different machines; it depends on the dimension of the e-mail server that you want to use.</p><p>Also note that to have a working e-mail server that sends and receives mails to and from the Internet, you should have a working DNS server with a valid domain name that you own.</p><p>If you would like to avoid assembling the different pieces of an e-mail server, and at the same time use a very powerful mailing server on Ubuntu, you can opt for a solution such as the famous Zimbra server. Explaining how to install and administrate Zimbra needs more than a section in a chapter. That's why I wrote a book about it named <span class="emphasis"><em>Learning Zimbra Server Essentials</em></span>, Packt Publishing, in October 2013 (for more information, visit <a class="ulink" href="https://www.packtpub.com/networking-and-servers/learning-zimbra-server-essentials">https://www.packtpub.com/networking-and-servers/learning-zimbra-server-essentials</a>). If you want, you can refer to it.</p></div></div><p>Now, let's discover how to handle every piece of the e-mail server.</p><div class="section" title="The MTA server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec34"/>The MTA server</h2></div></div></div><p>There are a<a class="indexterm" id="id146"/> lot of <a class="indexterm" id="id147"/>
<span class="strong"><strong>Mail Transfer Agent</strong></span> (<span class="strong"><strong>MTA</strong></span>s) that can be deployed on an Ubuntu Server, but the most famous MTA one is <a class="indexterm" id="id148"/>
<span class="strong"><strong>Postfix</strong></span>, because it is a good, secure, and an easy-to-administer e-mail server. Besides, it is the default e-mail server that Ubuntu uses when you select <span class="strong"><strong>Mail server</strong></span> in <code class="literal">tasksel</code>.</p><div class="section" title="Installing Postfix"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec10"/>Installing Postfix</h3></div></div></div><p>Postfix can<a class="indexterm" id="id149"/> be installed with the same methods that are used by many of the other services that I mentioned in this chapter. You can choose <span class="strong"><strong>Mail server</strong></span> either during the initial installation or when you run the <code class="literal">tasksel</code> program. Alternatively, you can use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install postfix</strong></span>
</pre></div><p>When you <a class="indexterm" id="id150"/>install Postfix, the installer will launch the initial Postfix configuration script. It is an interactive program that provides you with a few standard common e-mail server configurations. Based on your choice, it will propose a few more options so that at the end of this process, you should at least have a functional e-mail server.</p><p>First of all, it gives you an overview of the different configuration modes that you can adopt, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Installing Postfix" src="graphics/B04800_03_04.jpg"/></div><p>Then, it will <a class="indexterm" id="id151"/>give you the options to choose. In <a class="indexterm" id="id152"/>our case, we will choose <span class="strong"><strong>Internet site</strong></span>, as shown in the following screenshot, so that we can directly send and receive e-mails using SMTP:</p><div class="mediaobject"><img alt="Installing Postfix" src="graphics/B04800_03_05.jpg"/></div><p>Finally, it asks <a class="indexterm" id="id153"/>you about the domain name that you will use for this e-mail server. This is the domain name that you will use to send <a class="indexterm" id="id154"/>e-mails. In our case, we will choose <code class="literal">ubuntu-essentials.net</code>, which will allow us to send mail such as <code class="literal">contact@ ubuntu-essentials.net</code>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Installing Postfix" src="graphics/B04800_03_06.jpg"/></div><p>Keep in <a class="indexterm" id="id155"/>mind<a class="indexterm" id="id156"/> that although the e-mail server will function, you will need to perform some extra configurations if you want to add greylisting, spam/virus checking, IMAP or POP servers, or other advanced options.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>During the installation process, you will be asked for only a few details. Therefore, to complete the customization of the other necessary parameters, such as the trusted subnets, the default mailbox size, and the root address, you can run the following command after finishing the installation process and follow the given steps:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo dpkg-reconfigure postfix</strong></span>
</pre></div></div></div></div><div class="section" title="Managing Postfix "><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Managing Postfix </h3></div></div></div><p>There <a class="indexterm" id="id157"/>aren't too many surprises with<a class="indexterm" id="id158"/> Ubuntu's Postfix conventions. Most of the directories and files used by Postfix under Ubuntu follow the same structure on other platforms. For example, the <code class="literal">/etc/postfix/ directory</code> contains a majority of the Postfix configuration files, especially <code class="literal">/etc/postfix/main.cf</code>, where you can activate secure authentication using SSL, install TLS certificates for signature and encryption, and make use of a lot of other options. The <code class="literal">/var/spool/mail/</code> directory contains the users' mailboxes, and <code class="literal">/var/log/mail.*</code> are the log files.</p><p>The main<a class="indexterm" id="id159"/> tool that you will use to administer Postfix is aptly named postfix. It works much like <code class="literal">apache2ctl</code> in that it accepts a few different <a class="indexterm" id="id160"/>commands as arguments and can also be used as a substitute for the <code class="literal">init</code> script to start and stop the service. For instance, to stop Postfix and then start it again, type in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo postfix stop</strong></span>
<span class="strong"><strong>sudo postfix start</strong></span>
</pre></div><p>For other parameters and their explanation, you can get them from the <code class="literal">man</code> command via the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>man postfix</strong></span>
</pre></div><p>In addition to the Postfix command-line tool, Postfix provides a few other tools to help you with the administration of the services. The following are some of these tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">postqueue</code> command<a class="indexterm" id="id161"/> can be used by regular users to get information about the current e-mail queue.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">postsuper</code> command<a class="indexterm" id="id162"/> allows a superuser to perform privileged operations on a queue.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">postconf</code> command<a class="indexterm" id="id163"/> outputs every Postfix setting to the screen along with its value. This can be very useful in case you modify the main <code class="literal">config</code> file and you would like to get the active running configuration before reloading. So for example, if you want to see the current value of <code class="literal">myhostname</code> in the running <code class="literal">config</code> file, we just have to type the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo postconf | grep ^myhostname</strong></span>
</pre></div></li></ul></div></div></div><div class="section" title="The MDA server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec35"/>The MDA server</h2></div></div></div><p>Like for MTA, there <a class="indexterm" id="id164"/>is a lot of MDA software that exist under the official <a class="indexterm" id="id165"/>Ubuntu repositories and which differs in terms of complexity and functionalities besides the interoperability with other e-mail server components, such as Postfix. For this example, I will cover the Dovecot POP and IMAP servers, as they integrate well with Postfix, support Maildirs, and have a number of additional packages available that provide advanced features such as LDAP, MySQL, and Postgres support. The steps are pretty simple. They start with enabling Maildirs on Postfix and then installing Dovecot.</p><p>Maildir is a specific directory structure that is used to save e-mails instead of the traditional manner of using the <code class="literal">mbox</code> format. It should be enabled on Postfix by setting the <code class="literal">home_mailbox</code> variable inside the <code class="literal">/etc/postfix/main.cf</code> file, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>home_mailbox = Maildir/</strong></span>
</pre></div><p>Alternatively, to enable it, you can just run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo postconf -e 'home_mailbox = Maildir/'</strong></span>
</pre></div><p>You should<a class="indexterm" id="id166"/> of course reload <code class="literal">postfix</code> after this step by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo postfix reload</strong></span>
</pre></div><p>Then, move on to install Dovecot by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install dovecot-imapd dovecot-pop3d</strong></span>
</pre></div><p>This will install and enable POP, POP with SSL, IMAP, and IMAP with SSL.</p><p>After this, you <a class="indexterm" id="id167"/>can customize Dovecot by using the main <code class="literal">/etc/dovecot/dovecot.conf config</code> file. Don't forget to reload the daemon every time you modify the <code class="literal">config</code> file using the <code class="literal">sudo /etc/init.d/dovecot reload</code> command to implement the changes.</p><p>The next step is to tell Dovecot to use Maildirs and also let it know where it can find them on the system. To do this, check whether there is already an uncommented line that starts with <code class="literal">mail_location</code> (in the default installation, it's commented out). If it doesn't exist, then add the following line; if it does exist, then modify the <code class="literal">mail_location</code> line so that it looks like the following line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mail_location = maildir:~/Maildir</strong></span>
</pre></div><p>Then, reload Dovecot by using the <code class="literal">sudo /etc/init.d/dovecot reload</code> command. Now, you should be able to configure e-mail clients to point to the server and access their local e-mail.</p></div></div>
<div class="section" title="Filters and security for an e-mail server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Filters and security for an e-mail server</h1></div></div></div><p>Today, <span class="strong"><strong>Unsolicited Bulk Email</strong></span> (<span class="strong"><strong>UBE</strong></span>) <a class="indexterm" id="id168"/>represents one of the largest problems for e-mail servers. Also known as <a class="indexterm" id="id169"/>
<span class="strong"><strong>spam</strong></span>, such messages may also carry viruses and other forms of malware. To handle this issue, there <a class="indexterm" id="id170"/>are a lot of powerful utilities that can be installed on an Ubuntu Server and integrated with an e-mail server. The following is a list of the best utilities:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Amavisd-new</strong></span> is a<a class="indexterm" id="id171"/> generic scanner program. Its role<a class="indexterm" id="id172"/> is to call a certain number of content filtering tools such as antivirus, spam detection, and so on. You can install it by using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install amavisd-new.</strong></span>
</pre></div><p>To configure it, you have to first of all activate antivirus and anti-spam detection in Amavisd-new by editing the <code class="literal">/etc/amavis/conf.d/15-content_filter_mode</code> file and uncommenting <a class="indexterm" id="id173"/>some lines, as described in the file itself. To customize Amavisd-new, you can edit options in the <code class="literal">config</code> files under the <code class="literal">/etc/amavis/conf.d/</code> directory. Don't forget to restart the daemon by using the following command:</p><div class="informalexample"><pre class="programlisting">sudo service amavis restart</pre></div><p>For integration with Postfix, you have to enter the following command:</p><div class="informalexample"><pre class="programlisting">sudo postconf -e 'content_filter = smtp-amavis:[127.0.0.1]:10024'</pre></div><p>Then, edit <code class="literal">/etc/postfix/master.cf</code> by adding the following to the end of the file:</p><div class="informalexample"><pre class="programlisting">smtp-amavis   unix  smtp
-o smtp_data_done_timeout=1200
-o smtp_send_xforward_command=yes
-o disable_dns_lookups=yes
-o max_use=20
127.0.0.1:10025 inet   n  smtpd
-o content_filter=
-o local_recipient_maps=
-o relay_recipient_maps=
-o smtpd_restriction_classes=
-o smtpd_delay_reject=no
-o smtpd_client_restrictions=permit_mynetworks,reject
-o smtpd_helo_restrictions=
-o smtpd_sender_restrictions=
-o smtpd_recipient_restrictions=permit_mynetworks,reject
-o smtpd_data_restrictions=reject_unauth_pipelining
-o smtpd_end_of_data_restrictions=
-o mynetworks=127.0.0.0/8
-o smtpd_error_sleep_time=0
-o smtpd_soft_error_limit=1001
-o smtpd_hard_error_limit=1000
-o smtpd_client_connection_count_limit=0
-o smtpd_client_connection_rate_limit=0
-o receive_override_options=no_header_body_checks,no_unknown_recipient_checks,no_milters</pre></div><p>To <a class="indexterm" id="id174"/>prevent messages that are generated to report spam from being classified as spam, add the following two lines immediately below the pickup transport service:</p><div class="informalexample"><pre class="programlisting">-o content_filter=
-o receive_override_options=no_header_body_checks</pre></div><p>Finally, restart Postfix by using the following command:</p><div class="informalexample"><pre class="programlisting">sudo service postfix restart</pre></div><p>At this step, content filtering with spam and virus detection is enabled.</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Spamassassin</strong></span> is the <a class="indexterm" id="id175"/>most used open <a class="indexterm" id="id176"/>source anti-spam program in the world today. It uses a variety of mechanisms to filter e-mails based on message content. You can install it via the <code class="literal">sudo apt-get install spamassassin</code> command. To activate the <code class="literal">spamassassin</code> daemon, you have to change the value of the enabled parameter from <span class="emphasis"><em>0</em></span> to <span class="emphasis"><em>1</em></span> in the <code class="literal">/etc/default/spamassassin</code> file. Then, start the daemon by using the following command:<div class="informalexample"><pre class="programlisting">sudo service spamassassin start</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ClamAV</strong></span> is the <a class="indexterm" id="id177"/>most known open<a class="indexterm" id="id178"/> source antivirus application. You can install it by using the <code class="literal">sudo apt-get install clamav-daemon</code> command. The default configuration of ClamAV fits our needs. Therefore, we can start working with it. However, you can customize it by using the <code class="literal">config</code> files in <code class="literal">/etc/clamav</code>.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>You need to add the ClamAV and Amavis users to each other's groups in order for Amavisd-new to have appropriate access to scan files and prevent ownership issues from inhibiting scans, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo adduser clamav amavis</strong></span>
<span class="strong"><strong>sudo adduser amavis clamav</strong></span>
</pre></div></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Postgrey</strong></span> is<a class="indexterm" id="id179"/> a<a class="indexterm" id="id180"/> program that implements greylisting<a class="indexterm" id="id181"/> for the Postfix server. <span class="strong"><strong>Greylisting</strong></span> is a technique that helps you cut down on the amount of spam a server receives. You can install it by using the <code class="literal">sudo apt-get install postgrey</code> command. For its configuration, all that you have to do is modify the <code class="literal">smtpd_recipient_restrictions</code> option in Postfix's <code class="literal">main.cf</code> file to add the <code class="literal">localhost:10023</code> service.</li><li class="listitem" style="list-style-type: disc">The <a class="indexterm" id="id182"/><span class="strong"><strong>OpenDKIM</strong></span><a class="indexterm" id="id183"/> implements a <span class="strong"><strong>Sendmail Mail Filter</strong></span> (<span class="strong"><strong>Milter</strong></span>)<a class="indexterm" id="id184"/> for the <a class="indexterm" id="id185"/><span class="strong"><strong>DomainKeys Identified Mail</strong></span> (<span class="strong"><strong>DKIM</strong></span>) standard, and <code class="literal">python-postfix-policyd-spf</code> enables <a class="indexterm" id="id186"/><span class="strong"><strong>Sender Policy Framework</strong></span> (<span class="strong"><strong>SPF</strong></span>) to check it with Postfix. You can install OpenDKIM via the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install opendkim postfix-policyd-spf-python</strong></span>
</pre></div><p>To get more knowledge about this subject, visit <a class="ulink" href="https://mandrill.zendesk.com/hc/en-us/articles/205582267-What-are-SPF-and-DKIM-and-how-do-I-set-them-up-">https://mandrill.zendesk.com/hc/en-us/articles/205582267-What-are-SPF-and-DKIM-and-how-do-I-set-them-up-</a>.</p></li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Spamassassin</strong></span> process can be enhanced by using some optional packages that integrate with it, for better spam detection. We can install these packages by using the <code class="literal">sudo apt-get install pyzor razor</code> command. Spamassassin automatically detects optional components and will use these components if they are present. So, there is no need to configure <code class="literal">pyzor</code> and <code class="literal">razor</code>.</li><li class="listitem" style="list-style-type: disc">To filter e-mail attachments, we need the main filtering application's compression utilities, which can be installed by using the following command:<div class="informalexample"><pre class="programlisting">sudo apt-get install arj cabextract cpio lha nomarch pax rar unrar unzip zip</pre></div></li></ul></div><div class="section" title="Other facilities"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec36"/>Other facilities</h2></div></div></div><p>After installing an <a class="indexterm" id="id187"/>e-mail server, you can use it by configuring an e-mail client such as Thunderbird or Evolution. You can also access it via the Web if you have already installed a webmail client. There are a lot of webmail clients that you can install. All that you need is a working MTA and MDA, along with a web server. We have covered these topics in the previous sections. Then, you should install the webmail solution and configure it to work with your e-mail server. You can choose a solution from SquirrelMail, Horde, OpenWebMail, and Roundcube. As an example, we will install and configure Roundcube. To do this, you need to run the <code class="literal">sudo apt-get install roundcube-mysql roundcube</code> command. Then, edit the <code class="literal">/etc/roundcube/apache.conf</code> file and uncomment the following two lines:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Alias /roundcube/program/js/tiny_mce/ /usr/share/tinymce/www/</strong></span>
<span class="strong"><strong>Alias /roundcube /var/lib/roundcube</strong></span>
</pre></div><p>Finally, restart Apache by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service apache2 restart</strong></span>
</pre></div><p>You can now access your webmail via <code class="literal">&lt;domaine-name&gt;/roundcube</code>. In our case, it is <code class="literal">www.buntu-essentials.net/roundcube</code>.</p><p>You can also install a mass mailing manager (a mailing list manager), such as the famous mailman, and configure it to work with the e-mail server in a manner that is similar to how you installed and configured the webmail client.</p></div></div>
<div class="section" title="Setting up a database server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Setting up a database server</h1></div></div></div><p>Databases <a class="indexterm" id="id188"/>are also one of most used services that every system administrator deals with every day. With the Ubuntu Server, installing and managing databases is quite simple. We previously saw how to install a MySQL database within a LAMP server. In this section, we will see how to do that as a separate action. We will also see how to install and manage another commonly used Open Source database server named Postgres.</p><div class="section" title="The MySQL server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec37"/>The MySQL server</h2></div></div></div><p>It is <a class="indexterm" id="id189"/>easy to install the MySQL database on Ubuntu, just run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install mysql-server</strong></span>
</pre></div><p>You will be <a class="indexterm" id="id190"/>asked to enter the root password. You can leave it empty, but I recommend that you set one, and a good one (a strong password) is better.</p><p>For customization tasks, you can find the MySQL main configuration files under <code class="literal">/etc/mysql/</code>.</p><p>Ubuntu includes the <code class="literal">mysqladmin</code> tool to help you with MySQL administration. You can think of it as the <code class="literal">apache2ctl</code> program in that it accepts certain commands on the command line and then interacts with the <code class="literal">mysqld</code> process for you. For instance, to get the current status of your MySQL process, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo mysqladmin -p status</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>I used the <code class="literal">-p</code> argument in this command, which will tell <code class="literal">mysqladmin</code> to prompt me for the password on the command line. If you set a password for the root user, you will need to use <code class="literal">-p</code> with your commands. However, if you plan to run a batch of commands and don't want to enter the password every time, you can add the password to the <code class="literal">-p</code> option. So for instance, if the MySQL password was myP@ssword, type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo mysqladmin -p myP@ssword status</strong></span>
</pre></div></div></div><p>The<a class="indexterm" id="id191"/> <code class="literal">mysqladmin</code> manual page (type man mysqladmin on a console) lists the <a class="indexterm" id="id192"/>full set of commands.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>The easiest way to manage a MySQL database is by using the phpMyAdmin utility. Have a look at how to install and configure it in the section named <span class="emphasis"><em>Web Server </em></span>in this chapter.</p></div></div></div><div class="section" title="The Postgre server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec38"/>The Postgre server</h2></div></div></div><p>Even <a class="indexterm" id="id193"/>though MySQL has the reputation of being easy to use, PostgreSQL<a class="indexterm" id="id194"/> under Ubuntu is also simple to install and use. To install PostgreSQL, you can either select <span class="strong"><strong>PostgreSQL Server</strong></span> as you install Ubuntu or do so afterwards with <code class="literal">tasksel</code>, or use a package manager to install the <code class="literal">postgresql</code> package, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install postgresql</strong></span>
</pre></div><p>Once the <code class="literal">postgresql</code> package has been installed, the database service will start in the background and you can then set up your superuser account and create a database. The initial administration will be performed by the <code class="literal">postgres</code> user. So first, use <code class="literal">sudo</code> to become that user by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo -u postgres -s</strong></span>
</pre></div><p>Now, from this shell, you can create a new user account by using the <code class="literal">createuser</code> program. On the other hand, the <code class="literal">dropuser</code> command deletes users. Creating databases is done via the <code class="literal">createdb</code> program, and accessing the database is done via the <code class="literal">psql</code> command.</p><p>As with MySQL, there is a PHP-based administration tool called <span class="strong"><strong>phpPgAdmin</strong></span>. To install phpPgAdmin, you simply need to install the <code class="literal">phppgadmin</code> package, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install phppgadmin</strong></span>
</pre></div><p>The package will download all of its dependencies, including a web server, in case one is not already installed. Once the package is installed, create a symlink to its Apache configuration file under <code class="literal">/etc/apache2/sites-available</code> and then use <code class="literal">a2ensite</code> to enable the site, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo ln -s /etc/phppgadmin/apache.conf /etc/apache2/sites-available/phppgadmin</strong></span>
<span class="strong"><strong>sudo a2ensite phppgadmin</strong></span>
<span class="strong"><strong>sudo apache2ctl graceful</strong></span>
</pre></div></div></div>
<div class="section" title="Setting up a DHCP server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Setting up a DHCP server</h1></div></div></div><p>
<span class="strong"><strong>DHCP</strong></span> stands <a class="indexterm" id="id195"/>for <a class="indexterm" id="id196"/>
<span class="strong"><strong>Dynamic Host Control Protocol</strong></span>. With this protocol, a new host on the network can issue a request for IP information. The DHCP server will then provide the host with all the necessary information that it needs to communicate on the network, such as its IP address, netmask, the gateway, and the DNS servers that need to be used.</p><div class="section" title="Installing DHCP"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec39"/>Installing DHCP</h2></div></div></div><p>Installing a<a class="indexterm" id="id197"/> DHCP server under Ubuntu is an easy task, just type the following command and you will get the DHCP server installed:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install dhcp3-server</strong></span>
</pre></div></div><div class="section" title="Ubuntu DHCP Conventions"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec40"/>Ubuntu DHCP Conventions</h2></div></div></div><p>It just needs additional <a class="indexterm" id="id198"/>configuration to be useful; we will see this in this section:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/etc/dhcp3/dhcpd.conf</code>: This is the configuration file for the DHCP server. By default, it is a heavily commented file that should provide plenty of examples for you to work on.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/var/lib/dhcp3/dhcpd.leases</code>: This file contains the current list of DHCP leases that your server has handed out. If you are wondering which MAC address got a particular IP or when a particular lease will expire, look in this file.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/var/log/syslog</code>: DHCP uses the standard <code class="literal">syslog</code> file for all of its logs. Here, you will be able to find requests from the network for a DHCP request along with the DHCP server's reply.</li></ul></div></div><div class="section" title="Configuring DHCP"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Configuring DHCP</h2></div></div></div><p>Ubuntu <a class="indexterm" id="id199"/>provides a heavily commented DHCP configuration file that explains all the major options and gives a number of different configuration examples. For basic DHCP services, you generally want to set up one or possibly two scenarios—<span class="strong"><strong>dynamic DHCP</strong></span> <a class="indexterm" id="id200"/>and <a class="indexterm" id="id201"/>
<span class="strong"><strong>static DHCP</strong></span>. In a dynamic DHCP configuration, new hosts get assigned an IP out of a possible range of IPs. There's no guarantee that a host will get assigned the same IP every time. With static DHCP, you can bind a particular IP address to a host's MAC address and ensure that every time it shows up on the network, it will get the same IP. Dynamic DHCP is good for a simple, easy-to-maintain DHCP server, and static DHCP gives you many benefits of static IPs without nearly as many headaches. Plus with static IPs, if you do want to change the IP address of a host, you can do so in the <code class="literal">dhcpd.conf</code> file and reload DHCP instead of having to track down and change the host.</p><p>Now, to reload <a class="indexterm" id="id202"/>DHCP and enable my settings, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service dhcp3-server restart</strong></span>
</pre></div><p>In case you didn't make a syntax error, the DHCP server will stop and then start again. If there is an error in the file, it should output an error to the screen along with its location. A common error is a missing semicolon at the end of a particular line.</p></div></div>
<div class="section" title="Installing a file server"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Installing a file server</h1></div></div></div><p>This is the<a class="indexterm" id="id203"/> last section in this chapter. In this section, we will discover how to install and configure, on an Ubuntu Server, two of the most used file servers—<span class="strong"><strong>FTP</strong></span> and <span class="strong"><strong>Samba</strong></span>.</p><div class="section" title="The FTP server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec42"/>The FTP server</h2></div></div></div><p>The<a class="indexterm" id="id204"/> <code class="literal">vsftpd</code> is an<a class="indexterm" id="id205"/> FTP daemon available in Ubuntu. It is easy to install, set up, and maintain. To install <code class="literal">vsftpd</code>, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install vsftpd</strong></span>
</pre></div><p>The <code class="literal">/etc/vsftpd.conf</code> file contains the main configuration options for the FTP server. It is well commented. Therefore, you can edit it easily. After the <code class="literal">config</code> modification, you should restart the server by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo restart vsftpd</strong></span>
</pre></div><p>Connecting to the FTP server is quite easy. You can do so either by using the FTP command in the CLI of the customer machine or a client GUI program such as FileZilla.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>With FTP, data is transmitted unencrypted over the network. To transmit data securely, you can either use the FTPS protocol (FTP over SSL), or advantageously turn to <a class="indexterm" id="id206"/>
<span class="strong"><strong>SFTP</strong></span> (<span class="strong"><strong>SSH File Transfer Protocol</strong></span>).</p></div></div></div><div class="section" title="The Samba server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec43"/>The Samba server</h2></div></div></div><p>
<span class="strong"><strong>Samba</strong></span> is <a class="indexterm" id="id207"/>a program that implements SMB and CIFS, the Windows file-sharing protocols. As such, it's ideal as a platform to share file under Windows, since<a class="indexterm" id="id208"/> all the clients can access the server without additional software. Over time, Samba has grown to support advanced sections of Windows file sharing to a point where it can operate like any other Windows file server or <a class="indexterm" id="id209"/>
<span class="strong"><strong>Primary Domain Controller</strong></span> (<span class="strong"><strong>PDC</strong></span>).</p><p>To install Samba, you can either select the <span class="strong"><strong>Samba Server</strong></span> option during the Ubuntu installation or after the installation with the help of the <code class="literal">tasksel</code> program, or install the <code class="literal">samba</code>, <code class="literal">samba-doc</code>, <code class="literal">smbfs</code>, and <code class="literal">winbind</code> packages separately with the help of the package manager, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install samba samba-doc smbfs winbind</strong></span>
</pre></div><p>The <a class="indexterm" id="id210"/>Samba service will start automatically. By default, of course nothing too interesting will be shared. So, you will need to tweak Samba's configuration files before any directories are shared. The main configuration files are located under the <code class="literal">/etc/samba/</code> directory, especially the core configuration file named <code class="literal">/etc/samba/smb.conf</code>. This file is heavily commented, and it contains a number of different examples of how to set up shares, including a useful example configuration.</p><p>After installing and configuring the Samba server, go to another host on the network and attempt to connect to the Samba server. On an Ubuntu desktop, navigate to <span class="strong"><strong>Places</strong></span> | <span class="strong"><strong>Connect to Server</strong></span>. Then, select <span class="strong"><strong>Windows share</strong></span> from the <span class="strong"><strong>Service type</strong></span> drop-down menu. Finally, enter the IP address or hostname of the Samba server and then enter the name that you put between the brackets in the <code class="literal">smb.conf</code> file for the name of the share. Click on <span class="strong"><strong>Connect</strong></span>. Ubuntu will mount and display the mounted share on the desktop.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Summary</h1></div></div></div><p>In this chapter, we went in depth in terms of deploying services on an Ubuntu Server. We discussed how to install and configure some of the most used servers that every system administrator will usually deal with.</p><p>In the next chapter, we will move on to the security aspect of an Ubuntu Server.</p></div></body></html>