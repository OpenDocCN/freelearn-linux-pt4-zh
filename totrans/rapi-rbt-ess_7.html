<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Accessing Your Biped Remotely"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Accessing Your Biped Remotely</h1></div></div></div><p>Now that your biped is up and running, you'll want to able to send it on its way into the world, but still be able to monitor and control it remotely. This will help you in development as well as deployment and will open up all sorts of new scenarios and applications.</p><p>In this chapter, you will learn:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to add a wireless LAN dongle to your biped robot and set it up as a wireless access point</li><li class="listitem" style="list-style-type: disc">How to control your biped robot using this access and a joystick</li><li class="listitem" style="list-style-type: disc">How to use the <a id="id309" class="indexterm"/>wireless LAN connection to get <span class="strong"><strong>First Person Video</strong></span> (<span class="strong"><strong>FPV</strong></span>) back so that you can see what your biped robot is seeing</li></ul></div><div class="section" title="Adding a wireless dongle and creating an access point"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec37"/>Adding a wireless dongle and creating an access point</h1></div></div></div><p>In <a class="link" href="ch01.html" title="Chapter 1. Configuring and Programming Raspberry Pi">Chapter 1</a>, <span class="emphasis"><em>Configuring and Programming Raspberry Pi</em></span>, you learned how to add a wireless<a id="id310" class="indexterm"/> dongle and have the Raspberry Pi connect to your wireless <a id="id311" class="indexterm"/>network. This is a useful way to access the Raspberry Pi, but if you want to take your robot outside the coverage of your wireless LAN, you'll want to set it up as an access point.</p><p>The first step in doing this is to install the wireless LAN device. One device that is inexpensive <a id="id312" class="indexterm"/>and easy to configure is the Edimax Wifi Adapter device (the product information is available at <a class="ulink" href="http://www.edimax.com/edimax/merchandise/merchandise_detail/data/edimax/global/wireless_adapters_n150/ew-7811un">http://www.edimax.com/edimax/merchandise/merchandise_detail/data/edimax/global/wireless_adapters_n150/ew-7811un</a>). It is available at most online electronic outlets:</p><div class="mediaobject"><img src="graphics/B04591_07_01.jpg" alt="Adding a wireless dongle and creating an access point"/></div><p>Once <a id="id313" class="indexterm"/>you <a id="id314" class="indexterm"/>have installed the device and booted Raspberry Pi, type <code class="literal">lsusb</code> command. This should display something like the following screenshot:</p><div class="mediaobject"><img src="graphics/B04591_07_02.jpg" alt="Adding a wireless dongle and creating an access point"/></div><p>The Edimax device is listed in the set of devices connected to the USB port. Now, execute the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure that you have <code class="literal">hostapd</code> installed by typing <code class="literal">sudo apt-get install hostapd</code>. This application is a background application that controls the configuration of wireless on Raspberry Pi.</li><li class="listitem">The default version of <code class="literal">hostapd</code> unfortunately does not support the Edimax chipset by default. So, you'll need to download a version that does by typing <code class="literal">wget http://www.daveconroy.com/wp3/wp-content/uploads/2013/07/hostapd.zip</code>.</li><li class="listitem">Now, <a id="id315" class="indexterm"/>unzip this file by typing <code class="literal">unzip hostapd.zip</code>.</li><li class="listitem">Make <a id="id316" class="indexterm"/>a backup of your original <code class="literal">hostapd</code> application by typing <code class="literal">sudo mv /usr/sbin/hostapd /usr/sbin/hostapd.bak</code>. This way, you'll have it if you want to restore it later.</li><li class="listitem">Now, move the new version of <code class="literal">hostapd</code> to the proper directory by typing <code class="literal">sudo mv hostapd /usr/sbin/hostapd.edimax</code>.</li><li class="listitem">For the next step, type <code class="literal">sudo ln -sf /usr/sbin/hostapd.edimax /usr/sbin/hostapd</code>; this will create a soft link to the new file so that it will be executed as the <code class="literal">hostapd</code> application.</li><li class="listitem">Type <code class="literal">sudo chown root.root /usr/sbin/hostapd</code>, and this will change the owner and the group of this file to <code class="literal">root</code>.</li><li class="listitem">Type <code class="literal">sudo chmod 755 /usr/sbin/hostapd</code> to make this file executable to the owner.</li><li class="listitem">Now you will want to configure your wireless access point. Edit the file by typing <code class="literal">sudo emacs /etc/hostapd/hostapd.conf</code> so that it looks like the following screenshot:<div class="mediaobject"><img src="graphics/B04591_07_03.jpg" alt="Adding a wireless dongle and creating an access point"/></div></li><li class="listitem">You'll now want to edit the <code class="literal">/etc/network/interfaces</code> file, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/B04591_07_04.jpg" alt="Adding a wireless dongle and creating an access point"/></div></li><li class="listitem">This <a id="id317" class="indexterm"/>will<a id="id318" class="indexterm"/> set the address of the access point to <span class="strong"><strong>10.10.0.1</strong></span>.</li><li class="listitem">Now, type <code class="literal">sudo apt-get install isc-dhcp-server</code> to install a <code class="literal">dhcp</code> server so that devices that connect to it will be able to get a dynamic address.</li><li class="listitem">Now, edit the <code class="literal">/etc/dhcp/dhcpd.conf</code> and add these lines:<div class="mediaobject"><img src="graphics/B04591_07_05.jpg" alt="Adding a wireless dongle and creating an access point"/></div></li><li class="listitem">The <a id="id319" class="indexterm"/>next <a id="id320" class="indexterm"/>step is to edit the <code class="literal">/etc/default/hostapd</code> so that this will all start at power up by adding this line:<div class="mediaobject"><img src="graphics/B04591_07_06.jpg" alt="Adding a wireless dongle and creating an access point"/></div></li><li class="listitem">Now type the following two commands; <code class="literal">sudo update-rc.d hostapd enable</code> and <code class="literal">sudo update-rc.d isc-dhcp-server enable</code> and then reboot the Raspberry Pi.</li></ol></div><p>You <a id="id321" class="indexterm"/>should now be able to connect to your Raspberry Pi as a<a id="id322" class="indexterm"/> wireless access point.</p></div></div>
<div class="section" title="Adding a joystick remote control"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec38"/>Adding a joystick remote control</h1></div></div></div><p>Now <a id="id323" class="indexterm"/>that you can access your Raspberry Pi from a remote computer, you can SSH, just like you may have been doing with a wired connection, issue commands, and even control the biped using the remote computer. This introduces a number of different possibilities, one of which is to control your project with a joystick connected to the remote computer.</p><p>To add the game controller, you'll need to first find a game controller that can connect to your computer. If you are using Microsoft Windows as the OS on the host computer, pretty much any USB controller that can connect to a PC will work. The same type of controller also works if you are using Linux for the remote computer. In fact, you can use another Raspberry Pi as the remote computer.</p><p>Since the joystick will be connected to the remote computer, you'll need to run two programs: one on the remote computer and one on the Raspberry Pi on the biped robot. You'll also need a way to communicate between them. In the following example, you'll use the wireless LAN interface and a client-server model of communication. You'll run the server program on the remote computer, and the client program on the Raspberry Pi on the biped robot.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>For an <a id="id324" class="indexterm"/>excellent tutorial of this type of model and how it is used in a gaming application, see <a class="ulink" href="http://www.raywenderlich.com/38732/multiplayer-game-programming-for-teens-with-python">http://www.raywenderlich.com/38732/multiplayer-game-programming-for-teens-with-python</a>.</p></div></div><p>The first step is to simply plug in your USB game controller to the remote computer. Once you have the controller connected to the remote computer, you'll need to create a Python program on the Raspberry Pi that will take the signals sent from the remote computer client and send the control to the server running on Raspberry Pi so that you can send the correct signals to the servos on your biped.</p><p>Before you do this, you'll need to install the libraries on Raspberry Pi that will allow this to work. The first is a library called <code class="literal">pygame</code>. Install this by typing <code class="literal">sudo apt-get install python-pygame</code>. You'll also need to install a set of Python install tools by typing <code class="literal">sudo apt-get install python-setuptools</code>. Then, you'll need a LAN communication layer library<a id="id325" class="indexterm"/> called <code class="literal">PodSixNet</code>. This will allow the two applications, the client on the remote computer and the server running on Raspberry Pi, to communicate. To install this, follow <a id="id326" class="indexterm"/>the instructions at <a class="ulink" href="http://mccormick.cx/projects/PodSixNet/">http://mccormick.cx/projects/PodSixNet/</a>. Now you are ready to create the program on Raspberry Pi on the biped. The first part of the program is the Python functions<a id="id327" class="indexterm"/> from the program you created in <a class="link" href="ch03.html" title="Chapter 3. Motion for the Biped">Chapter 3</a>, <span class="emphasis"><em>Motion for the Biped</em></span>. In this section, you'll create a class called <code class="literal">QuadGame</code>. This class will take the inputs from the game controller connected to the server and turn them into commands that will be sent to the servo controller for your biped robot.</p><p>The<a id="id328" class="indexterm"/> following <a id="id329" class="indexterm"/>is <a id="id330" class="indexterm"/>a table of those controls:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Joystick control</p>
</th><th style="text-align: left" valign="bottom">
<p>Biped control</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Button 2</p>
</td><td style="text-align: left" valign="top">
<p>Robot home position</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button 1</p>
</td><td style="text-align: left" valign="top">
<p>Robot turn right</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button 3</p>
</td><td style="text-align: left" valign="top">
<p>Robot turn left</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Joystick Up</p>
</td><td style="text-align: left" valign="top">
<p>Robot walk forward</p>
</td></tr></tbody></table></div><p>Now, the following is the initial part of the code, the Python import statements:</p><div class="mediaobject"><img src="graphics/B04591_07_07.jpg" alt="Adding a joystick remote control"/></div><p>And the following is the <code class="literal">BoxesGame</code> class, the code that will respond to the joystick:</p><div class="mediaobject"><img src="graphics/B04591_07_08.jpg" alt="Adding a joystick remote control"/></div><p>This <a id="id331" class="indexterm"/>is the interesting part of the code. This code takes the input from the remote computer and translates it into action. The first <code class="literal">if</code> statement determines what type of data is being sent from the remote computer with the joystick attached. It can be a button press, where <code class="literal">data["type"] == 10</code>, and then the statement <code class="literal">data["info"]["button"] == 2</code> determines that <span class="strong"><strong>button 2</strong></span> has been pressed. In this case, this will send commands that will cause the robot to go to the home position. If the <code class="literal">if data["type"] == 7:</code>, then this is a joystick event, and the <code class="literal">if data["info"]["value"] &lt; - 0.9</code>, then this will determine that the joystick is in the up position and the robot should move forward.</p><p>The following is the final part of the joystick controller aspect of the client program for completeness:</p><div class="mediaobject"><img src="graphics/B04591_07_09.jpg" alt="Adding a joystick remote control"/></div><p>This final <a id="id332" class="indexterm"/>piece of code initializes the game loop, which loops while taking the inputs, sends them to the servo controller, and on to the flight controller.</p><p>You'll also need a server program running on the remote computer that will take the signals from the game controller and send them to the client. You'll be writing this code in Python using Python version 2.7, which can be installed from here. Additionally, you'll need to install the <code class="literal">pygame</code> library. If you are using Linux on the remote computer, then type <code class="literal">sudo apt-get install python-pygame</code>. If you are using Microsoft Windows on the remote <a id="id333" class="indexterm"/>machine, then follow the instructions at <a class="ulink" href="http://www.pygame.org/download.shtml">http://www.pygame.org/download.shtml</a>.</p><p>You'll also need the LAN communication layer described previously. You can find a version <a id="id334" class="indexterm"/>that will run on Microsoft Windows or Linux at <a class="ulink" href="http://mccormick.cx/projects/PodSixNet/">http://mccormick.cx/projects/PodSixNet/</a>. The following is a listing of the server code in two parts:</p><div class="mediaobject"><img src="graphics/B04591_07_10.jpg" alt="Adding a joystick remote control"/></div><p>This first <a id="id335" class="indexterm"/>part creates three classes:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first, class<code class="literal"> ClientChannel</code>, establishes a communication channel for your project.</li><li class="listitem">The second, class <code class="literal">BoxServer</code>, sets up a server so that you can communicate the joystick action to the Raspberry Pi on the biped.</li><li class="listitem">Finally, the third class, <code class="literal">Game</code> , just initializes a game that contains everything you'll need.</li></ol></div><p>The following is the latter part of the code:</p><div class="mediaobject"><img src="graphics/B04591_07_11.jpg" alt="Adding a joystick remote control"/></div><p>This<a id="id336" class="indexterm"/> part of the code initializes the joystick so that all the controls can be sent to the biped's Raspberry Pi.</p><p>You'll need to run these programs on both computers, entering the Internet address of the remote computer connected to the joystick. The following is what running the program on that computer will look like, before running the program on the remote computer:</p><div class="mediaobject"><img src="graphics/B04591_07_12.jpg" alt="Adding a joystick remote control"/></div><p>And the <a id="id337" class="indexterm"/>following is what the program will look like when run on the Raspberry Pi and connected to the robot:</p><div class="mediaobject"><img src="graphics/B04591_07_13.jpg" alt="Adding a joystick remote control"/></div><p>Finally, the following is what the program will look like on the remote computer when the robot's Raspberry Pi is up and connected:</p><div class="mediaobject"><img src="graphics/B04591_07_14.jpg" alt="Adding a joystick remote control"/></div><p>Now <a id="id338" class="indexterm"/>you can control you robot remotely using the joystick!</p></div>
<div class="section" title="Adding the capability to see remotely"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec39"/>Adding the capability to see remotely</h1></div></div></div><p>Your <a id="id339" class="indexterm"/>biped can now get information from your remote computer and respond to joystick key presses, but you may want to be able to see what the biped sees from its webcam. This is straightforward to configure with a webcam, vncserver, and the capability you used in <a class="link" href="ch06.html" title="Chapter 6. Adding Vision to Your Biped">Chapter 6</a>, <span class="emphasis"><em>Adding Vision to Your Biped</em></span>. Using this method, you can easily get a picture of what your biped is seeing, and it should be something like the following:</p><div class="mediaobject"><img src="graphics/B04591_07_15.jpg" alt="Adding the capability to see remotely"/></div><p>Now<a id="id340" class="indexterm"/> you can both see where your robot is going and control it via a joystick.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec40"/>Summary</h1></div></div></div><p>That's it, but really it is only the beginning. Your robot has some basic motions and some basic control capability, but now you should also have the knowledge and skills to take your biped robot much further. You can teach it how to dance, follow gestures, and almost anything that you can imagine.</p></div></body></html>