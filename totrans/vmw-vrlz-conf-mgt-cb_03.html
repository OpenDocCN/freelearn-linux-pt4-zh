<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Linux Patching"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Linux Patching</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing SCR prerequisites</li><li class="listitem" style="list-style-type: disc">Installing the SCR Tool</li><li class="listitem" style="list-style-type: disc">Setting up the SCR configuration file</li><li class="listitem" style="list-style-type: disc">Scheduling content downloads</li><li class="listitem" style="list-style-type: disc">Configuring Apache</li><li class="listitem" style="list-style-type: disc">Configuring patching repository options in VCM</li><li class="listitem" style="list-style-type: disc">Configuring staging options in VCM</li><li class="listitem" style="list-style-type: disc">Configuring the SCR Tool base path for the patching repository</li><li class="listitem" style="list-style-type: disc">Creating a patch assessment template</li><li class="listitem" style="list-style-type: disc">Deploying patches on Linux machines - on demand</li><li class="listitem" style="list-style-type: disc">Deploying patches on Linux machines - scheduled</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Introduction</h1></div></div></div><p>Before patching Linux/Unix or Macintosh, we need to configure a repository into which we can download the patches in vendor-provided format. Once they've been downloaded, we need to make them available for the machines we plan to patch. This is where the VMware <span class="strong"><strong>Software Content Repository</strong></span> (<span class="strong"><strong>SCR</strong></span>) tool comes into picture. SCR is a Java-based tool that is installed on a separate RHEL 7 VM. SCR downloads the patch signature files and OS vendor patch content from the <span class="strong"><strong>content distribution network</strong></span> (<span class="strong"><strong>CDN</strong></span>) and downloads subscription-only content from the OS vendor content websites.</p><p>Since the release of SCR 6.1, which was shipped with VCM 5.7.3, VMware supports the installation only on RHEL 7.x (refer to the VCM 7.5.3 release notes).</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>Note that you must have a basic understanding of RHEL 7 or basic Linux commands to work through this chapter.</p><p>
</p><p>Note that if you need to patch your RHEL 7 target machines, then you must have the new SCR Tool 6.1 version based on RHEL 7 Server (64-bit). However, VCM continues to support SCR Tool on RHEL 6 Server (64-bit) for patching earlier Linux platforms.</p></div></div><p>SCR is not involved in patch management, configuration, or deployment. It just acts as a repository that will be accessed by various methods such as HTTP, HTTPS, FTP, and NFS by the clients that need those patches. As a VCM administrator, we need to define the way in which the managed machines will access the content, such as downloading via HTTP, HTTPS, or NFS. We need to make the necessary changes on the SCR server, such as installing a web server to make patches available over HTTP, add proper certificates so that they can be accessed over HTTPS, and so on.</p><div class="section" title="How Linux patching works"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec68"/>How Linux patching works</h2></div></div></div><p>The following figure from the VMware documentation depicts how VCM works with SCR:</p><div class="mediaobject"><img alt="How Linux patching works" src="graphics/image_03_001.jpg"/></div><p>The following is the procedure of getting Linux patching working according to the previous figure:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We configure the SCR Tool on an RHEL machine (the biggest blue box); we can have several of them for load balancing.</li><li class="listitem">Patches are downloaded either via a CDN or from the vendor into respective configured folders on the SCR server.</li><li class="listitem">Meanwhile, VCM server (the biggest green box) checks the patch status of the managed Linux machines (the smaller green boxes). The VCM admin then decides which patches to install. VCM downloads patch bulletins from <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a> to get the latest information about the patches.</li><li class="listitem">Once the VCM administrator decides which patches to install, all the Unix/Linux machines reach the SCR server to get those patches.</li><li class="listitem">Managed machines install the patches and inform the VCM server about the latest status; based on this, if required, the VCM admin can take further action, for instance, troubleshooting and getting a patch installed if it failed to.</li></ol></div></div><div class="section" title="SCR VM requirements"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec69"/>SCR VM requirements</h2></div></div></div><p>Let's look at some values you should consider to plan for the SCR VM.</p><div class="section" title="Estimated required SCR storage by platform"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec32"/>Estimated required SCR storage by platform</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Supported platform</strong></span></p>
</td><td>
<p><span class="strong"><strong>Minimum storage required</strong></span></p><p>
</p><p><span class="strong"><strong>for patch content files and payload</strong></span></p>
</td></tr><tr><td>
<p>AIX</p>
</td><td>
<p>130 GB</p>
</td></tr><tr><td>
<p>CentOS</p>
</td><td>
<p>80 GB</p>
</td></tr><tr><td>
<p>HP-UX</p>
</td><td>
<p>15 GB</p>
</td></tr><tr><td>
<p>Mac OS X</p>
</td><td>
<p>210 GB</p>
</td></tr><tr><td>
<p>Oracle Enterprise Linux (OEL)</p>
</td><td>
<p>80 GB</p>
</td></tr><tr><td>
<p>RedHat</p>
</td><td>
<p>80 GB</p>
</td></tr><tr><td>
<p>Solaris</p>
</td><td>
<p>325 GB</p>
</td></tr><tr><td>
<p>SUSE</p>
</td><td>
<p>60 GB</p>
</td></tr></tbody></table></div></div><div class="section" title="SCR VM hardware requirements"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec33"/>SCR VM hardware requirements</h3></div></div></div><p>Here are the base hardware requirements for deploying SCR:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Hardware</strong></span></p>
</td><td>
<p><span class="strong"><strong>Specification</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>OS</strong></span></p>
</td><td>
<p>RHEL 7.x x86_64</p>
</td></tr><tr><td>
<p><span class="strong"><strong>HDD</strong></span></p>
</td><td>
<p>20 GB base OS + extra disk as per the previous table.</p><p>
</p><p>This needs to be mounted at <code class="literal">/opt/vcmpatches</code> on the server.</p><p>
</p><p>Follow the <a class="ulink" href="http://www.techotopia.com/index.php/Adding_a_New_Disk_Drive_to_an_RHEL_6_System">http://www.techotopia.com/index.php/Adding_a_New_Disk_Drive_to_an_RHEL_6_System</a> this is for RHEL 6 blog. This is for RHEL 6 but works well with RHEL 7.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Processor</strong></span></p>
</td><td>
<p>2 vCPUs if going for virtual</p>
</td></tr><tr><td>
<p><span class="strong"><strong>RAM</strong></span></p>
</td><td>
<p>4 GB</p>
</td></tr><tr><td>
<p><span class="strong"><strong>NIC</strong></span></p>
</td><td>
<p>1 GBps with Internet access</p>
</td></tr></tbody></table></div></div><div class="section" title="List of patch sites for SCR"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec34"/>List of patch sites for SCR</h3></div></div></div><p>This is the list of websites we need access to for downloading patches for the respective OSes:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Platform</strong></span></p>
</td><td>
<p><span class="strong"><strong>Download URL</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>All platforms</strong></span></p>
</td><td>
<p>
<a class="ulink" href="http://configuresoft.cdn.lumension.com/configuresoft">http://configuresoft.cdn.lumension.com/configuresoft</a>
</p><p>
</p><p>
<a class="ulink" href="http://novell.cdn.lumension.com/">http://novell.cdn.lumension.com/</a>
</p><p>
</p><p>
<a class="ulink" href="https://a248.e.akamai.net/f/60/59258/2d/">https://a248.e.akamai.net/f/60/59258/2d/</a>
</p><p>
</p><p>
<a class="ulink" href="http://vmware.cdn.lumension.com/">http://vmware.cdn.lumension.com/</a>
</p>
</td></tr><tr><td>
<p><span class="strong"><strong>CentOS</strong></span></p>
</td><td>
<p>
<a class="ulink" href="http://vault.centos.org">http://vault.centos.org</a>
</p><p>
</p><p>You can also use the mirrors returned from the Web service:</p><p>
</p><p>
<a class="ulink" href="http://mirrorlist.centos.org">http://mirrorlist.centos.org</a>
</p>
</td></tr><tr><td>
<p><span class="strong"><strong>RedHat</strong></span></p>
</td><td>
<p>
<a class="ulink" href="http://xmlrpc.rhn.redhat.com/XMLRPC">http://xmlrpc.rhn.redhat.com/XMLRPC</a>
</p>
</td></tr><tr><td>
<p><span class="strong"><strong>SUSE</strong></span></p>
</td><td>
<p>
<a class="ulink" href="https://you.novell.com/update/">https://you.novell.com/update/</a>
</p><p>
</p><p>
<a class="ulink" href="https://nu.novell.com/repo/$RCE/">https://nu.novell.com/repo/$RCE/</a>
</p>
</td></tr></tbody></table></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>Check <a class="ulink" href="http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf">http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf</a> for details of more OSes supported by SCR.</p></div></div></div></div></div></div>
<div class="section" title="Installing SCR prerequisites"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Installing SCR prerequisites</h1></div></div></div><p>As mentioned earlier, SCR is a Java-based tool, so it has some prerequisites, such as the latest JRE and JDK versions installed on the base OS. We will now check all the requirements that we need to get SCR going.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec70"/>Getting ready</h2></div></div></div><p>Before we start, we must have an RHEL 7 server deployed, the minimum install option of the RHEL installer installs the necessary features we need to start with. We will need to install Apache and a few other utilities, but those we can install later. The latest JRE and JDK RPMs can be downloaded from Oracle.com. We also need root credentials to install the patches.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec71"/>How to do it...</h2></div></div></div><p>Log in to the RHEL server with an SSH tool such as <span class="strong"><strong>PuTTY</strong></span> and go to the folder where the installers have been copied. Then, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Downloading</strong></span>:<p>Visit <a class="ulink" href="http://www.oracle.com/index.html">http://www.oracle.com/index.html</a> and download the latest RPMs for JRE and JDK for RHEL 7 x64.</p><p>Once the RPMs have been downloaded, you can use a tool such as <span class="strong"><strong>winscp</strong></span> to copy the installer to the SCR server.</p></li><li class="listitem"><span class="strong"><strong>Installing JDK using RPM</strong></span>:<p>Use the <code class="literal">cd</code> command to go to the folder where you have copied both the installers and run this command:</p><pre class="programlisting">
<span class="strong"><strong>rpm -ivh &lt;jdk Installer filename&gt;.rpm</strong></span>
</pre></li><li class="listitem"><span class="strong"><strong>Installing JRE</strong></span>:<p>Continue from where you left off earlier and run this command to install JRE:</p><pre class="programlisting">
<span class="strong"><strong>          rpm -ivh &lt;jre Installer filename&gt;.rpm</strong></span>
</pre></li><li class="listitem"><span class="strong"><strong>Verify the Java Cryptography Extension (JCE)</strong></span>:<p>By default, when you install the Java tool that comes with JCE, you don't need to separately install it again.</p><p>Run the following command to validate whether JCE has been installed:</p><pre class="programlisting">
<span class="strong"><strong>find / -iname US_export_policy.jar</strong></span>
</pre><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_002.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec72"/>How it works...</h2></div></div></div><p>As SCR is a Java-based tool, we need the latest JRE installed to make the tool work.</p><p>The minimum Java version you can safely install without worrying about breaking the application is JRE 8u72, which is what we will use in this book. The JCE is required for AIX, HP-UX, RedHat, Solaris, and SUSE. It encrypts passwords when we use third-party credentials in the properties files used to download patch content.</p><p>VCM downloads the metadata about the patches from <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>.</p><p>VCM is not at all aware what patches are available on the SCR server; it gets its data from <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>, and SCR gets its updates from other locations.</p><p>There is no synchronization between what is available on SCR and what is required on VCM, so it is recommended that you synchronize your SCR server overnight to make sure all the patches are downloaded and then start pushing the patches from VCM.</p></div></div>
<div class="section" title="Installing the SCR Tool"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Installing the SCR Tool</h1></div></div></div><p>In this recipe, we will install the SCR Tool on the RHEL VM we prepared earlier.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec73"/>Getting ready</h2></div></div></div><p>You should have made sure that all the prerequisites form the previous recipes have been met.</p><p>Download the latest version of SCR from <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>, at the time of writing, it was SCR 6.1.21. Copy the ZIP file to the <code class="literal">/tmp</code> directory of the SCR VM.</p><p>We also need login credentials for vendors such as RHEL and SUSE so that we can encrypt the password for later use in the configuration files.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec74"/>How to do it...</h2></div></div></div><p>Log in to the SCR VM with root credentials and follow these steps to install and perform base configuration of SCR.</p><div class="section" title="Installing SCR"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec35"/>Installing SCR</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the  <code class="literal">/opt/SCR</code> folder with this command:<pre class="programlisting">
<span class="strong"><strong>       mkdir /opt/SCR</strong></span>
</pre><p>From now on, we will refer to this location as <code class="literal">scr_root</code></p></li><li class="listitem">Unzip the SCR installation files:<pre class="programlisting">
<span class="strong"><strong>tar -zxvf /tmp/SCR-vmware-6.1.21.tar.gz -c /opt/SCR</strong></span>
</pre></li></ol></div></div><div class="section" title="Encrypting the password for the content repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec36"/>Encrypting the password for the content repository</h3></div></div></div><p>Continue from where we left off at step 2, and start the process of encrypting the password with the following commands:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <code class="literal">/opt/SCR/bin</code> using this command:<pre class="programlisting">
<span class="strong"><strong>       cd /opt/SCR/bin</strong></span>
</pre></li><li class="listitem">Run the script that will encrypt the password:<pre class="programlisting">
<span class="strong"><strong>./lumension_encryptor_tool.sh</strong></span>
</pre></li><li class="listitem">Provide the password (and confirm it).</li><li class="listitem">Copy the encrypted password string and keep it handy for the upcoming configuration steps in the following recipe.<div class="mediaobject"><img alt="Encrypting the password for the content repository" src="graphics/image_03_003.jpg"/></div></li></ol></div><p>Not only the vendor connection password, but also the proxy password, if required, needs to be encrypted in this way.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>Note that if you provide a non-encrypted password, SCR assumes it is encrypted and will fail to connect and download patches.</p></div></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec75"/>How it works...</h2></div></div></div><p>We are now getting ready by unzipping the installer and encrypting all the required passwords, such as the RedHat network access password, the password required to download content from SUSE, or the password required to get past our proxy.</p><p>We need to enter the password in the plaintext properties file used by SCR as configuration input when it starts downloading patches. If we enter our password unencrypted, then anyone with access to the file can read it. To avoid this situation, there is a script that encrypts the password, and we can provided this encrypted password in the configuration file.</p><p>These passwords can be set in a plaintext configuration file for further processing of SCR.</p><p>The SCR server must have execute permission for all of the repository application files in order to access and update the properties files. To provide those privileges, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">On the SCR server, change to the <code class="literal">scr_root</code> directory.</li><li class="listitem">To change the mode, run the <code class="literal">chmod -R a+x **/*</code> command.</li></ol></div></div></div>
<div class="section" title="Setting up the SCR configuration file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Setting up the SCR configuration file</h1></div></div></div><p>The meat of SCR is its configuration file; if we make a mistake here, we will never have those patches downloaded, and we can't have our SCR instance ready. Pay attention to what you choose; if a channel is not required, don't mention it the configuration file.</p><p>In this recipe, we will have a look at the various configuration options we have, what they mean, and how to configure them.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec76"/>Getting ready</h2></div></div></div><p>Follow the <span class="emphasis"><em>Installing SCR</em></span> recipe to install SCR and prepare the encrypted passwords.</p><p>Consult your OS support teams about which Linux/Unix OSes will be patched by VCM so that you can download those patches beforehand.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec77"/>How to do it...</h2></div></div></div><p>In this recipe, we will prepare for RedHat Linux patching; however, the same principle applies for all Linux operating systems.</p><p>The example properties files are available in the <code class="literal">scr_root/conf/ </code> directory.</p><p>If you have been following along properly so far, then the RHEL properties file will be at <code class="literal">/opt/SCR/redhat-rt.properties</code>.</p><p>As stated earlier, we want to configure a properties file that will be used by the SCR Tool to obtain configuration details and act accordingly.</p><p>To configure the file, open it with your favorite Linux editor.</p><p>The options that we will keep at their default values are not discussed here.</p><p>Here are the options to configure:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">platform</code><p>The <code class="literal">platform</code> parameter specifies the type of patch content to download.</p><pre class="programlisting">          platform=LINUX</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">arch</code><p>The <code class="literal">arch</code> parameter specifies valid architecture strings for the specified platform.</p><pre class="programlisting">          arch=X86, X86_64</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">dist</code><p>The <code class="literal">dist</code> parameter specifies the distribution of Linux. Multiple values must be comma separated without spaces.</p><pre class="programlisting">          dist=REDHAT</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">folder</code><p>The <code class="literal">folder</code> parameter specifies the <span class="strong"><strong>root folder</strong></span> where the SCR Tool output is stored. By default, this <code class="literal">folder</code> is  <code class="literal">/tmp/SCR/download</code>.</p><p>Change it to <code class="literal">folder=/opt/vcmpatches</code> (we have mounted our second HDD under this folder; if you don't understand this, consult your Linux admin)</p><p>The SCR Tool creates the subdirectory tree under the root output folder.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">thirdparty</code><p>Set the value to <code class="literal">true</code> to support third-party downloads for CentOS, Oracle Linux, RedHat, Solaris, and SUSE.</p><pre class="programlisting">          thirdparty=true or false</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">user</code><p>The <code class="literal">user</code> parameter specifies the user ID for third-party vendor downloads, such as SUSE or RHEL.</p><pre class="programlisting">          user=string</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">pwd</code><p>The <code class="literal">pwd</code> parameter specifies an encrypted password for the user id specified by the <code class="literal">user</code> parameter. Check the <span class="emphasis"><em>Installing SCR recipe</em></span> for more details.</p><pre class="programlisting">          pwd=[encrypted password string]</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">configlog</code><p>This parameter specifies an output file, which contains a list of parameters and values. These values reflect the parameter configuration used during the previous or current execution of the SCR Tool and can be used to troubleshoot problems.</p><pre class="programlisting">          configlog=config_log_file_path/filename.log</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">checkPayload</code><pre class="programlisting">          checkPayload=true or false</pre><p>Set this to <code class="literal">true</code>.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">dependencyCheck</code><p>This turns off dependent RPM downloads for Linux platforms.</p><pre class="programlisting">          dependencyCheck= Valid values (not case sensitive): NONE, DIRECT,&#13;
          and TRANSITIVE</pre><p>VMware recommends using <code class="literal">TRANSITIVE</code>, as this will download all the dependent patches.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">channels</code><p>Channels are basically versions of the Linux/Unix operating system; for example, in the case of RHEL, we either have <code class="literal">client-x</code>, <code class="literal">server-x</code>, or <code class="literal">workstation-x</code>.</p><p>An example for RedHat:</p><pre class="programlisting">          channels=es-4, server-5</pre><p>If you want to download patches only for RHEL 7, then select <code class="literal">server-7</code>. SCR will then download patches for any other version.</p><p>This is where you need to consult your Linux team about which OS versions they support to add only those as channels and avoid unnecessary patch download.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">downloadPayload</code><p>If the value is <code class="literal">true</code>, all patches are downloaded. If the value is <code class="literal">false</code>, only the patches with UIDs that are included in the cache request folder are downloaded. If the value is <code class="literal">false</code> and there is no cache request XML, the content is processed but no patches are downloaded.</p><pre class="programlisting">          downloadPayload=true or false</pre><p>It is recommended to keep this <code class="literal">true</code>.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">cacheRequestFolder</code><pre class="programlisting">          cacheRequestFolder=path/CacheRequest.xml&#13;
&#13;
          /opt/SCR/cacherequest</pre><p>The cache request XML file is used to limit the downloaded patches to only those for which you obtain UIDs from the <code class="literal">ecm_sysdat_patch_pls</code> table in the VCM database.</p><p>Even if you are not using this, don't hash out this option; or else, the patch download will fail.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">proxyServer</code><p>This specifies the proxy server IP address in your infrastructure for internet access.</p><pre class="programlisting">          proxyServer=IP_address</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">proxyPort</code><p>This specifies the proxy server port in your infrastructure for internet access.</p><pre class="programlisting">          proxyPort=port_number</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">proxyUser</code><p>This specifies the user ID for proxy server authentication, if applicable.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">proxyPwd</code><p>This specifies the encrypted password for the proxy server if you need a proxy user. This password is generated using the <code class="literal">lumension_encryptor_tool.sh</code> script, as explained in the earlier recipe.</p><pre class="programlisting">          proxyPwd=string</pre></li><li class="listitem" style="list-style-type: disc"><code class="literal">Certificate</code><p>Point this to the file containing your RedHat entitlement certificate. This file is created in <code class="literal">/etc/pki/entitlement</code> by the subscription manager when you attach a subscription to your registered RedHat system. The filename of the certificate varies but is always in the form <code class="literal">XXXXXXXXXXXXXXXXXXX.pem</code>, where <code class="literal">X</code> is a decimal digit.</p><p>If you attempt to download RedHat 7 RPMs without setting a certificate, the following error message appears:</p><pre class="programlisting">
<span class="strong"><strong>          java.lang.IllegalArgumentException: certificate cannot be null or&#13;
          not </strong></span>
<span class="strong"><strong>a file &#13;
</strong></span>
</pre><p>Example values for this parameter:</p><pre class="programlisting">
<span class="strong"><strong>          certificate=/etc/pki/entitlement/5280746408908734973.pem &#13;
          privateKey=/etc/pki/entitlement/5280746408908734973-key.pem</strong></span>
</pre></li></ul></div><p>The following command is used to register RHEL 7 with RedHat Subscription Management:</p><pre class="programlisting">
<span class="strong"><strong>subscription-manager register --username &lt;User_Name&gt; --password &lt;Pass_Word&gt; -auto-attach</strong></span>
</pre><p>This is the reason we can't use any other version of Linux as the SCR server.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>Most of these details have been taken from 
<a class="ulink" href="http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf">http://www.vmware.com/pdf/vrealize-configuration-manager-software-content-repository-tool-61-guide.pdf</a>.</p></div></div><p>Save the properties file.</p><p>There is another problem with this file; we need to copy the working <code class="literal">redhat-rt.properties</code> file to the <code class="literal">REDHAT-rt.properties</code> file, as it has been observed in error logs that VCM tries to find the file with uppercase <code class="literal">REDHAT</code> and it fails, and in Linux, <code class="literal">REDHAT-rt.properties</code> and <code class="literal">redhat-rt.properties</code> are two different files.</p><p>Once configured, the file looks something like this:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_004.jpg"/></div><p>Once the file has been saved, go to <code class="literal">/opt/SCR/bin</code> and run the following command:</p><pre class="programlisting">
<span class="strong"><strong>./startup.sh redhat-rt</strong></span>
</pre><p>Then, check the logfiles and the download folder; if there are no error logs in the logfile, then SCR will start synchronizing the patches.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec78"/>How it works...</h2></div></div></div><p>When we start downloading patches with the SCR Tool, it uses the information provided in the configuration file and then acts on it; for example, it will use the proxy provided in the configuration file and the credentials configured to authenticate.</p><p>It will use the folder path to download the patches and the credentials shared to authenticate with the OS vendor.</p><p>It will download only patches for the OS versions mentioned in the channel configuration; it might not download any patch if we configure the file like that, and we might get failures while performing the deployment with VCM.</p><p>The SCR Tool first attempts to download the payload from the CDN. If the patch is not found in the CDN, the SCR Tool downloads it from the vendor's website, such as RedHat, SUSE, or Solaris, using the credentials provided in the user and password parameters.</p><p>If something like that happens now, you know where to look first. The logfile location mentioned here comes in handy, assuming you have configured everything correctly. If SCR is not downloading the patches, have a look at the logfile generated at the location mentioned in the configuration file.</p><p>If you are new to Linux, then use a tool called winscp; this allows you to browse the Linux filesystem and manipulate files.</p><p>Open the logfile in winscp and look for something that tells you the system is getting registered to RHN in order to make sure everything is going well:</p><div class="mediaobject"><img alt="How it works..." src="graphics/image_03_005.jpg"/></div><p>We will look at a recipe on troubleshooting SCR download issues in <a class="link" href="ch09.html" title="Chapter 9. Troubleshooting VCM">Chapter 9</a>, <span class="emphasis"><em>Troubleshooting VCM</em></span>.</p></div></div>
<div class="section" title="Scheduling content downloads"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Scheduling content downloads</h1></div></div></div><p>OS vendors keep generating patches. We can't just log in to SCR and synchronize them manually; we can set a schedule and let SCR take care of downloading all the required patches.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec79"/>Getting ready</h2></div></div></div><p>The SCR VM must have access to the Internet and be configured as per the previous two recipes.</p><p>Configure the <code class="literal">redhat-rt.properties</code> file with the correct settings, such as user details for RHN and proxy details, and save it.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec80"/>How to do it...</h2></div></div></div><p>To set up the scheduling, we need to a create scripts that then can be run automatically.</p><p>Follow these steps to create the script and schedule it.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Once logged in to the SCR server, go to the location where SCR is installed (for us, it is <code class="literal">/opt/SCR</code>)</li><li class="listitem"><span class="strong"><strong>Copy the following content into the file</strong></span>:<pre class="programlisting">
<span class="strong"><strong>       vi /opt/SCR/bin/start_all_nix_replication.sh</strong></span>
</pre><p>press <span class="emphasis"><em>i</em></span></p><p>Enter or copy the following content:</p><pre class="programlisting">          #echo Running startup.sh hp-rt &#13;
          #./startup.sh hp-rt &#13;
          #echo Running startup.sh osx-rt &#13;
          #./startup.sh osx-rt &#13;
          echo Running startup.sh redhat-rt &#13;
          ./startup.sh redhat-rt             &#13;
          #echo Running startup.sh solaris-rt &#13;
          #./startup.sh solaris-rt &#13;
          #echo Running startup.sh suse-rt &#13;
          #./startup.sh suse-rt &#13;
</pre><p>Remove the <code class="literal">#</code> in front of the RedHat entry as we want to synchronize the patches for it, and if you have another version of Linux, do the same for that.</p><p>After you finished press [<span class="emphasis"><em>ESC</em></span>] and then <span class="emphasis"><em>:wq</em></span> to write the content and exit vi</p></li><li class="listitem"><span class="strong"><strong>Assign executable permissions to the created file:</strong></span><pre class="programlisting">
<span class="strong"><strong>       chmod +x  /opt/SCR/bin/start_all_nix_replication.sh </strong></span>
</pre><p>Once the script is ready, we need to schedule it.</p></li><li class="listitem"><span class="strong"><strong>Schedule a cron job to download it daily</strong></span>:<pre class="programlisting">
<span class="strong"><strong>       cd /etc/cron.daily &#13;
       touch /etc/cron.daily/SCR &#13;
       chmod +x /etc/cron.daily/SCR</strong></span>
</pre><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip27"/>Tip</h3><p>Note that the following script runs daily and synchronizes your patch content:</p><p>
</p><p><code class="literal">vim /etc/cron.daily/SCR</code></p></div></div></li><li class="listitem"><span class="strong"><strong>Add the following code to the file</strong></span>:<pre class="programlisting">
<span class="strong"><strong>       #!/bin/sh &#13;
       cd /opt/SCR/bin &#13;
       echo "### Get all new Unix content" &#13;
       ./start_all_nix_replication.sh </strong></span>
</pre></li></ol></div><p>The host machine must have execute permission for all of the repository application files in order to access and update the properties files. To grant this permission, you run a command on the host machine.</p><p>Change directory to the SCR root directory (<code class="literal">/opt/SCR</code>).</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip28"/>Tip</h3><p>Note that execute the following command in the <code class="literal">/opt/SCR</code> directory:
<code class="literal">
<span class="strong"><strong>cd /opt/SCR</strong></span>
</code>
<code class="literal">
<span class="strong"><strong>chmod -R a+x **/*</strong></span>
</code></p></div></div><p>Run the SCR file to create the directory structure:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Change directory to <code class="literal">/etc/cron.daily</code>.<pre class="programlisting">
<span class="strong"><strong>       cd /etc/cron.daily</strong></span>
</pre></li><li class="listitem">Run the SCR file to create the directory structure and download the content:<pre class="programlisting">
<span class="strong"><strong>       ./SCR</strong></span>
</pre></li><li class="listitem">Monitor the size for a while by running this:<pre class="programlisting">
<span class="strong"><strong>       du -sh /opt/vcmpatches</strong></span>
</pre></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec81"/>How it works...</h2></div></div></div><p>We create a daily schedule that will run at 12:00 am and will then use the configuration settings provided in the properties file and download the patches to the SCR server. The patches can then be used to deploy using VCM. Before starting to deploy patches with VCM, you must download them to the SCR server, as VCM will not know which patches are available and which are not.</p></div></div>
<div class="section" title="Configuring Apache"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Configuring Apache</h1></div></div></div><p>By now, we will have all the patches downloaded to the SCR server; now, we need a mechanism to make them available to the managed machines when they need them for installation.</p><p>We can configure a web server to distribute the patches from the SCR repository.</p><p>As discussed in the introduction, we can distribute the patches over HTTP/HTTPS; we will configure the Apache web server such that the folder containing patches (<code class="literal">/opt/vcmpatches</code>) will be available over HTTP. We will make the necessary changes in the VCM server to instruct the Linux/Unix machines to download patches according to our web server configuration.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec82"/>Getting ready</h2></div></div></div><p>As you have already registered your SCR server with the RedHat network, which is a prerequisite for downloading RHEL 7 patches, you have a repository ready to install Apache.</p><p><span class="strong"><strong>Security-Enhanced Linux</strong></span>
<span class="strong"><strong>(</strong></span>
<span class="strong"><strong>SELinux)</strong></span> should be disabled or configured such that we can connect on port <code class="literal">80</code> or <code class="literal">443</code>.</p><p>If you are not aware how this can be achieved, have a look at the following article:</p><p>
<a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/chap-Managing_Confined_Services-The_Apache_HTTP_Server.html#sect-Managing_Confined_Services-The_Apache_HTTP_Server-The_Apache_HTTP_Server_and_SELinux">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/chap-Managing_Confined_Services-The_Apache_HTTP_Server.html#sect-Managing_Confined_Services-The_Apache_HTTP_Server-The_Apache_HTTP_Server_and_SELinux</a>
</p><p>The firewall should be disabled or configured so that we can access patches over port <code class="literal">80</code>/<code class="literal">443</code>.</p><p>Have a look at this article for details on how to work with the RHEL firewall:</p><p>
<a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html</a>
</p><p>You could also use the following article for port 80 and make the necessary changes for port <code class="literal">443</code>:</p><p>
<a class="ulink" href="https://linuxconfig.org/how-to-open-http-port-80-on-redhat-7-linux-using-firewall-cmd">https://linuxconfig.org/how-to-open-http-port-80-on-redhat-7-linux-using-firewall-cmd</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec83"/>How to do it...</h2></div></div></div><p>This is a pretty long recipe, and we will break it into multiple sections, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">I<span class="emphasis"><em>nstalling Apache</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Configuring httpd.conf for Apache</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Configuring the .htaccess file</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Configuring HTTPS in Apache</em></span></li></ul></div><div class="section" title="Installing Apache"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec37"/>Installing Apache</h3></div></div></div><p>To make the patches available in our infrastructure, we can make the SCR server act as a web server and then configure it in VCM such that the managed machines access the patches over port <code class="literal">80</code> or <code class="literal">443</code> from the SCR server.</p><p>We will achieve this by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to SCR server with the root account.</li><li class="listitem">Install Apache:<pre class="programlisting">
<span class="strong"><strong>       # yum install httpd</strong></span>
</pre></li><li class="listitem">Make sure that httpd starts with the OS boot:<pre class="programlisting">
<span class="strong"><strong>       # systemctl enable httpd</strong></span>
</pre></li><li class="listitem">Start the httpd service now:<pre class="programlisting">
<span class="strong"><strong>       # systemctl start httpd.service</strong></span>
</pre></li></ol></div><p>Now, we need to configure the <code class="literal">httpd.conf</code> file, located in <code class="literal">/etc/https/conf</code>, to make Apache work as per our requirements.</p></div><div class="section" title="Configuring httpd.conf for Apache"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec38"/>Configuring httpd.conf for Apache</h3></div></div></div><p>The Apache configuration is stored in the <code class="literal">httpd.conf</code> file, located in <code class="literal">/etc/https/conf</code>. Continue with the following steps to make the necessary changes in the configuration file.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Before making changes to <code class="literal">httpd.conf</code>, we need to add a symbolic link between the folder we used to download the patches (<code class="literal">/opt/vcmpatches</code>) and the folder exposed under <code class="literal">httpd.conf</code> (<code class="literal">/var/www/html</code>).</li><li class="listitem">Log in to the SCR server with the root account.</li><li class="listitem">Go to <code class="literal">/var/www/html</code> using <code class="literal">cd /var/www/html</code>.</li><li class="listitem">Run the <code class="literal">ln -s /opt/vcmpatchs vcmpatches</code> command.</li><li class="listitem">Edit <code class="literal">httpd.conf</code>:<pre class="programlisting">
<span class="strong"><strong>       # vi /etc/httpd/conf/httpd.conf</strong></span>
</pre></li><li class="listitem">Enter <span class="emphasis"><em>I</em></span> to go into edit mode, and add the following line under the <code class="literal">AccessFileName</code> section:<pre class="programlisting">       AccessFileName /vcmpatches/.htaccess &#13;
</pre><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note29"/>Note</h3><p>Note that we will be creating this <code class="literal">.httaccess</code> file in the next section of this recipe.</p></div></div></li></ol></div></div><div class="section" title="Configuring the .htaccess file"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec39"/>Configuring the .htaccess file</h3></div></div></div><p>To make this secure, we can add a <code class="literal">.htaccess</code> file so that only configured users can access the patches.</p><p>Create and edit the <code class="literal">.htaccess</code> file at <code class="literal">/opt/vcmpatches</code>:</p><pre class="programlisting">
<span class="strong"><strong># vi /opt/vcmpatches/.htaccess</strong></span>
</pre><p>Add the following lines to the file:</p><pre class="programlisting">AuthType Basic &#13;
AuthName "Restricted Area" &#13;
AuthUserFile /opt/vcmpatches/.htpasswd &#13;
require valid-user &#13;
</pre><p>Now, create an encrypted password for the <code class="literal">httpuser</code> user:</p><pre class="programlisting">
<span class="strong"><strong>#  htpasswd -c /opt/vcmpatches/.htpasswd  httpuser</strong></span>
</pre><p>It will prompt you for a password; type the password you want to set.</p><p>This creates another file at the same location called <code class="literal">.htpasswd</code>, and it stores the encrypted password, which you can see using the following command:</p><pre class="programlisting">
<span class="strong"><strong># cat /opt/vcmpatches/.htpasswd &#13;
httpuser:$apr1$1UgtgyfY$ed2kr8fDOB7XVd6UoytgE0</strong></span>
</pre></div><div class="section" title="Configuring HTTPS in Apache"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec40"/>Configuring HTTPS in Apache</h3></div></div></div><p>The default installation of Apache will give us an HTTP connection to the patch repository. We need to create and configure a certificate in Apache so that our managed VMs can securely download the patches from the SCR server. To configure HTTPS, we follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Install Mod SSL</strong></span><p>In order to set up the self-signed certificate, we first have to be sure that Apache and Mod SSL are installed. You can install both with one command:</p><pre class="programlisting">
<span class="strong"><strong>          rpm -ivh mod_ssl-2.2.15-29.e16_4.x86_64.rpm</strong></span>
</pre></li><li class="listitem"><span class="strong"><strong>Create a new directory</strong></span><p>Next, we need to create a new directory, where we will store the server key and certificate:</p><pre class="programlisting">
<span class="strong"><strong>          mkdir /etc/httpd/ssl</strong></span>
</pre></li><li class="listitem"><span class="strong"><strong>Create a self-signed certificate</strong></span><p>When we request a new certificate, we can specify how long it should remain valid by changing the <code class="literal">1000</code> parameter to the number of days we prefer:</p><pre class="programlisting">
<span class="strong"><strong>          Openssl req -x509 -nodes -days 1000 -newkey rsa:2048 -keyout </strong></span>
<span class="strong"><strong>          /etc/httpd/ssl/apache.key -out /etc/httpd/ssl/apache.crt</strong></span>
</pre><p>With this command, we will both be creating the self-signed SSL certificate and the server key that protects it and placing both of them into the new directory. This command will prompt the terminal to display a list of fields that need to be filled in. The most important line is <span class="strong"><strong>Common Name.</strong></span> Enter your official domain name here or, if you don't have one yet, use your site's IP address.</p><p>You will be asked to enter information that will be incorporated into your certificate request.</p><p>Provide the following details:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Country Name (two-letter code)</strong></span>: <code class="literal">IN</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>State or province name (full name)</strong></span>: <code class="literal">Maharashtra</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Locality name (for example, a city)</strong></span>: <code class="literal">Pune</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Organization name (such as a company)</strong></span>: <code class="literal">VCM_Cookbook</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Organizational unit name (for example, a section)</strong></span>:  <code class="literal">Information Technology</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Common name (for example, a server FQDN or your name)</strong></span>: <code class="literal">VCMCookbook.com</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Email address</strong></span>: <code class="literal">Abhijeet@vcmcookbook.com</code></li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note30"/>Note</h3><p>Note that the example values need to be changed as per your infrastructure.</p></div></div></li><li class="listitem"><span class="strong"><strong>Set up the certificate</strong></span>:<p>We now have all of the required components of the finished certificate. The next thing to do is to set up the virtual hosts to display the new certificate.</p><p>Open up the SSL config file:</p><pre class="programlisting">
<span class="strong"><strong>          vi /etc/httpd/conf.d/ssl.conf</strong></span>
</pre><p>Now, add the following block of code to the file:</p><pre class="programlisting">          ## SSL Virtual Host Context &#13;
          &lt;VirtualHost *:443&gt; &#13;
              ServerAdmin root@localhost &#13;
              DocumentRoot /var/www/html &#13;
              ServerName SCR Server FQDN &#13;
              ServerAlias SCR Server hostname &#13;
              SSLEngine on &#13;
              SSLCertificateFile /etc/httpd/ssl/apache.crt &#13;
              SSLCertificateKeyFile /etc/httpd/ssl/apache.key &#13;
 &#13;
          &lt;/VirtualHost&gt; &#13;
          &lt;VirtualHost _default_:443&gt; &#13;
</pre></li><li class="listitem"><span class="strong"><strong>Restart Apache</strong></span>:<p>You are done. Restarting the Apache server will reload it with all of your changes in place.</p><pre class="programlisting">
<span class="strong"><strong>          #systemctl restart httpd.service</strong></span>
</pre></li></ol></div><p>After this, you should access the VCM patches folder over the network via a browser, and it should look something like the following screenshot.</p><p>When you access the link, it will ask for authentication. Use the <code class="literal">httpuser</code> user and password created in the earlier step.</p><div class="mediaobject"><img alt="Configuring HTTPS in Apache" src="graphics/image_03_006.jpg"/></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec84"/>How it works...</h2></div></div></div><p>Linux and Unix managed machines can use HTTP/HTTPS to retrieve patches directly from the RedHat Linux patching repository machine.</p><p>The VCM Collector orchestrates and coordinates the tasks required to download, stage, and deploy the patches and the custom predeployment, postdeployment, and reboot actions using the VCM agent installed on the patching repository machine and the VCM agent on the target managed machines.</p><div class="mediaobject"><img alt="How it works..." src="graphics/image_03_007-1.jpg"/></div><p>The patches are available on the SCR server, and with the help of the Apache server, we created a web server that will present the patches to the managed machines.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec85"/>There's more...</h2></div></div></div><p>Once this has been configured, we need to make the necessary configuration changes in the VCM console and add the staging option as HTTP and redirect the managed machines to the <code class="literal">/opt/vcmpatches</code> folder to download patches. We will do this in the following recipes, <span class="emphasis"><em>Configuring patching repository options in VCM</em></span> and <span class="emphasis"><em>Configuring staging options</em></span>.</p></div></div>
<div class="section" title="Configuring patching repository options in VCM"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Configuring patching repository options in VCM</h1></div></div></div><p>Once everything is configured and ready on the SCR front, we should start configuring the repository in VCM. This is where we set the machine (SCR server) that will act as the repository.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec86"/>Getting ready</h2></div></div></div><p>We should have finished all the previous recipes before we start this, as this is dependent on all of them. Install the VCM agent as described in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage </em></span>

<span class="emphasis"><em>Your Infrastructure</em></span>, in the <span class="emphasis"><em>Installing an agent on Linux servers</em></span> recipe, and perform an initial data collection for the SCR machine.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec87"/>How to do it...</h2></div></div></div><p>To set up a patch repository in VCM, log in to the VCM console and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Certificate</strong></span> and select the SCR server. Click on <span class="strong"><strong>Change Trust Status</strong></span> at the top of the screen.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_008.jpg"/></div></li><li class="listitem">In the wizard, select the SCR machine and tick the <span class="strong"><strong>Check to trust and uncheck to untrust the selected machine</strong></span> option.</li><li class="listitem">You should see a handshake sign in front of the SCR server.</li><li class="listitem">Now, keep the SCR machine selected and click on <span class="strong"><strong>Patching Repository</strong></span> at the top of the screen.</li><li class="listitem">Make sure the SCR server is selected and choose <span class="strong"><strong>Enable - Allow the selected machine to be </strong></span><span class="strong"><strong>
<span class="strong"><strong>used</strong></span> as Patch Repository</strong></span>. Click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span> to close the wizard.</li><li class="listitem">The end result should look something like this:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_009.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec88"/>How it works...</h2></div></div></div><p>We set the patching repository as the designated patch repository for all the Linux/Unix machines we will be managing. Now, VCM knows where to redirect the machines if they want to be patched; we need to perform further configuration changes such as setting the path from where the machines can download the patches, but that is for the next recipe.</p></div></div>
<div class="section" title="Configuring staging options in VCM"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Configuring staging options in VCM</h1></div></div></div><p>Staging options are where we set VCM to exactly redirect the VM to <code class="literal">https://&lt;SCR Server&gt;/&lt;Patch location&gt;</code>. So far, we have downloaded the patches and added a server as the repository, and now, we will set the name of the folder and configure machine group mappings to the staging options.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec89"/>Getting ready</h2></div></div></div><p>We are building on previous recipes, so before we go ahead with this recipe, we should have finished all of them. If there are any special machine groups required, then they should be ready before we start with this recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec90"/>How to do it...</h2></div></div></div><p>Log in to the VCM server console and follow these steps to configure patch staging:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as a VCM administrator in VCM console.</li><li class="listitem">Navigate to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>General Settings</strong></span> | <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>UNIX</strong></span> | <span class="strong"><strong>Patch Staging</strong></span>. Click on <span class="strong"><strong>Add</strong></span>.</li><li class="listitem">Give a name and add a description.</li><li class="listitem">Under <span class="strong"><strong>Repository Type</strong></span>, select <span class="strong"><strong>Obtain patches from the patching repository : &lt;Name of SCR server&gt;</strong></span>.</li><li class="listitem">On the next page, provide details as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Repository Path: </strong></span><code class="literal">/vcmpatches</code> (this is the relative path to which we have downloaded the patches)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Protocol:</strong></span> Choose <span class="strong"><strong>HTTPS</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Port:</strong></span> Type <code class="literal">443</code> unless you have made some changes in <code class="literal">httpd.conf</code> and are using some other port</li><li class="listitem" style="list-style-type: disc">Select credentials required</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Username :</strong></span><code class="literal">httpuser</code> (or any user set in the <code class="literal">.htaccess</code> file)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Password :</strong></span> A plaintext password (don't use an encrypted password here)</li></ul></div></li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span>.</li></ol></div><p>Now that we have set a staging option, we need to assign it to the machine groups so that the machines will know where to download the patches from.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>General </strong></span><span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Patching</strong></span> |<span class="strong"><strong>UNIX</strong></span> | <span class="strong"><strong>Machine Group Mapping</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Machine Group</strong></span> and click on <span class="strong"><strong>Edit</strong></span>.</li><li class="listitem">Set the patch path value to <span class="strong"><strong>Standard Deployment and Source</strong></span> for staged patches to<span class="strong"><strong> SCR-HTTP.</strong></span></li><li class="listitem">The protocol and path will populate automatically, that is, if you have not created the certificate, then it will assign port 80, and if you have secured your Apache setup by creating a self-signed certificate, then it will look like one of these:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">HTTP://scr:80/vcmpatches</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">HTTPS://scr:443/vcmpatches</code></li></ul></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> and <span class="strong"><strong>Finish</strong></span> to save the settings.</li><li class="listitem">Do this for all the machine groups that have Linux/Unix machines and will be patched with VCM.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec91"/>How it works...</h2></div></div></div><p>If we don't set staging options, then machine patching will fail as the machines won't know from where to get the installers. As a best practice, use HTTPS.</p></div></div>
<div class="section" title="Configuring the SCR Tool base path for the patching repository"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Configuring the SCR Tool base path for the patching repository</h1></div></div></div><p>The setting for the SCR Tool base path in VCM must point to the location where you installed the SCR Tool on the patching repository machine.</p><p>The base path directory contains directories for the SCR binary files, configuration files, and logs.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec92"/>Getting ready</h2></div></div></div><p>As usual, we are building a patching mechanism, so all previous recipes are important to continue with subsequent ones. The same is applicable for this recipe: complete all the previous recipes before starting this one.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec93"/>How to do it...</h2></div></div></div><p>In this recipe, we will make a few changes to the VCM configuration; just follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>General </strong></span><span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Patching</strong></span> |<span class="strong"><strong>UNIX</strong></span> | <span class="strong"><strong>Additional Settings</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Default Machine Group Mapping for Temporary files during patching</strong></span> and change it to a folder you know will have enough space to download the patches before installation.<p>How much space is enough will depend on how many patches are getting deployed.</p><p>If you have standard partitions across the entire Linux/Unix server, select a path where you will have enough space.</p><p>In our case, it is <code class="literal">/var/tmp</code>, as shown here:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_010.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> (not visible in the screenshot) and <span class="strong"><strong>Finish</strong></span> to close and save the setting.</li><li class="listitem">Next in the list is <span class="strong"><strong>Default UNIX&gt;Linux package Repository path</strong></span>.</li><li class="listitem">This is the path to which we are <span class="emphasis"><em>downloading the patches</em></span>; in our case, it is <code class="literal">/opt/vcmpatches</code>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_011.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> (not visible in the screenshot) and <span class="strong"><strong>Finish</strong></span> to close and save the setting.</li><li class="listitem">The final setting in the list is <span class="strong"><strong>Default UNIX/Linux package repository SCR base path</strong></span>.</li><li class="listitem">This is the location to which we <span class="emphasis"><em>untarred or installed the SCR files</em></span> downloaded from <a class="ulink" href="http://www.vmware.com">http://www.vmware.com</a>.</li><li class="listitem">In our case, it is <code class="literal">/opt/SCR</code>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_012.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> (not visible in the screenshot) and <span class="strong"><strong>Finish</strong></span> to close and save the setting.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec94"/>How it works...</h2></div></div></div><p>The details of each setting are explained there only; this basically makes sure of the location of the SCR file to locate the <code class="literal">properties</code> file which is in the <code class="literal">/opt/SCR/conf</code> folder.</p><p>To check the <code class="literal">manifest.pkl</code> file, which is available under the <code class="literal">/opt/vcmpatches</code> folder, this has all the RPMs listed.</p></div></div>
<div class="section" title="Creating a patch assessment template"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Creating a patch assessment template</h1></div></div></div><p>A patch assessment template is basically list of patches that will be installed on managed machines or will be used to check patch compliance against.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec95"/>Getting ready</h2></div></div></div><p>We need internet access on the Collector server to download patch metadata.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec96"/>How to do it...</h2></div></div></div><p>Log in to the VCM console and follow these steps to create the required assessment template:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>All UNIX/Linux Platforms</strong></span> | <span class="strong"><strong>Assessment </strong></span><span class="strong"><strong>Templates</strong></span> and click on <span class="strong"><strong>Add</strong></span>.</li><li class="listitem">Templates can be created under individual Unix/Linux platforms as well.</li><li class="listitem">Give the template a descriptive name and add a description.</li><li class="listitem">Select <span class="strong"><strong>Static</strong></span> as the type of template. Here is the difference between a static and dynamic template:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Static template:</strong></span> With this, we can choose which patches are to be included in the template.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Dynamic template:</strong></span> With this, VCM selects patches depending upon the query we set.</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_013.jpg"/></div></li><li class="listitem">If we selected a dynamic template, we have options to formulate queries, such as <span class="strong"><strong>OS Name</strong></span>, <span class="strong"><strong>OS Version</strong></span>, and <span class="strong"><strong>Severity</strong></span>, and we can create multiple queries and select the <span class="strong"><strong>and</strong></span>/<span class="strong"><strong>or </strong></span>operator.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note31"/>Note</h3><p>Note that you can have only one <span class="strong"><strong>and</strong></span>/<span class="strong"><strong>or </strong></span>operator for all queries.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_014.jpg"/></div></li><li class="listitem">If we select <span class="strong"><strong>S</strong></span><span class="strong"><strong>tatic</strong></span>, we are free to choose all the patches we want.</li><li class="listitem">There is a temporary filter we can apply to limit the number of patches to select from.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note32"/>Note</h3><p>Note that multiple product bulletins can be wrapped up in this way. VCM will only attempt to patch an affected product, that is, if a VM is running RedHat 6, then VCM will not attempt to apply RedHat 7 bulletins.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_015.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> once all the required patches have been selected.</li><li class="listitem">Close the wizard by clicking on <span class="strong"><strong>Finish.</strong></span></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec97"/>How it works...</h2></div></div></div><p>We cannot deploy patches without creating assessment templates; these will be used for assessing the status of the machines, checking missing patches, and then deploying them.</p><p>We cannot make sure whether the patch we are selecting in the template will be there on the SCR server, so to avoid failures, we should always download all the patches to the SCR server.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec98"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This patch assessment template will be used in <span class="emphasis"><em>Deploying patches on Linux machines – on demand</em></span> and <span class="emphasis"><em>Deploying patches on Linux machines – scheduled</em></span> recipes.</li></ul></div></div></div>
<div class="section" title="Deploying patches on Linux machines &#x2013; on demand"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Deploying patches on Linux machines – on demand</h1></div></div></div><p>This is what we're executing all these recipes for: patching servers. By this time, we will be ready to install the patches on the managed machines. We can either schedule the patch to be installed or we can install them on demand. In this recipe, we will install the missing patches directly from the console.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec99"/>Getting ready</h2></div></div></div><p>Make sure the VM you want to patch is trusted in VCM; if it isn't, follow the same steps we followed to trust the SCR server in the <span class="emphasis"><em>Configuring patching repository options in VCM</em></span> recipe.</p><p>We must have DNS resolution to and from the Linux machine to be patched and the SCR and VCM servers.</p><p>The managed machine must reach the VCM and SCR server on their IPs.</p><p>We should have performed a collection with the <span class="strong"><strong>Patching - Unix Assessment Result</strong></span> as the <span class="strong"><strong>Filter Set</strong></span> option, as explained in the <span class="emphasis"><em>Collecting data from managed machines</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Configuring VCM to Manage Your Infrastructure">Chapter 2</a>, <span class="emphasis"><em>Configuring VCM to Manage </em></span>
<span class="emphasis"><em>Your Infrastructure</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec100"/>How to do it...</h2></div></div></div><p>Log in to the VCM console with admin privileges and start installing patches by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Patching</strong></span> | <span class="strong"><strong>Red</strong></span><span class="strong"><strong>Hat</strong></span> | <span class="strong"><strong>Assessment</strong></span><span class="strong"><strong>Templates</strong></span> and select the assessment template you have created.</li><li class="listitem">Click on <span class="strong"><strong>View Report</strong></span> in the top corner.</li><li class="listitem">Once you see the report, drag <span class="strong"><strong>Recommended Action</strong></span> to the <span class="strong"><strong>Filter</strong></span> bar; now, the default view changes and you can see that it is arranged depending upon the <span class="strong"><strong>Recommended Action</strong></span>.</li><li class="listitem">Click on the small arrow in front of <span class="strong"><strong>Install Path</strong></span>, select the patch and hit <span class="strong"><strong>Deploy</strong></span> from the topmost menu.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_016.jpg"/></div></li><li class="listitem">Select the items and click on <span class="strong"><strong>include prerequisite patches</strong></span>.</li><li class="listitem">Validate the patches.</li><li class="listitem">Click on <span class="strong"><strong>advanced</strong></span> and check whether this interests you or your Linux admin.</li><li class="listitem">Confirm the patch deployment and select the staging option.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note33"/>Note</h3><p>Note that if the machine you want to patch belongs to a machine group that you did not assign a staging option to, you will see only one option enabled for you, that is, <span class="strong"><strong>None: Stage patches manually</strong></span>.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_017.jpg"/></div></li><li class="listitem">On the next page, choose whether you want to reboot the server.</li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span> to close the wizard.</li><li class="listitem">VCM will start installing the patch and you can check the status of the jobs it runs: all the three jobs–<span class="strong"><strong>Download</strong></span>, <span class="strong"><strong>Stage</strong></span>, and <span class="strong"><strong>Deployment–</strong></span>should end with a <span class="strong"><strong>Succeeded</strong></span> result.<p>If you chose to reboot the server, then after a reboot, check the status like we did in steps 3 and 4 of the recipe; it should say <span class="strong"><strong>Success</strong></span> and list the name of the path we just installed.</p><p>This is how it will look in the job history under <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Job </strong></span>| <span class="strong"><strong>Manager </strong></span>| <span class="strong"><strong>Other jobs</strong></span> | <span class="strong"><strong>Past 24 Hours</strong></span>:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_018.jpg"/></div></li><li class="listitem">You can check the status of the patch in the VCM console and it will show you that the patch has been installed. To check the status, go to <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>RedHat </strong></span>| <span class="strong"><strong>Assessment Template</strong></span> | "Template name ":<div class="mediaobject"><img alt="How to do it..." src="graphics/image_03_019.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec101"/>How it works...</h2></div></div></div><p>When we push the patch from the VCM console, it first assesses the machine to check whether the patch has been installed since the last assessment. If it is still required, then the patch that was staged at the location configured in the staging option gets installed, and then the VCM agent checks whether the patch was installed properly.</p><p>If we schedule a reboot after that, then another job is configured in VCM and it starts, depending upon the configuration we select when deploying the patch. If the patch installation takes more time than the scheduled fixed reboot time, then the reboot job fails.</p></div></div>
<div class="section" title="Deploying patches on Linux machines &#x2013; scheduled"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Deploying patches on Linux machines – scheduled</h1></div></div></div><p>When we performed on-demand patching, we made sure the infrastructure we set up for patching Linux or Unix machines was working fine. Now, we need to take this to the next level by performing all the stuff automatically. In this recipe, we will configure all the required jobs so that VCM will perform patching of Linux/Unix machines on schedule.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec102"/>Getting ready</h2></div></div></div><p>Preparation will be the same as earlier. Make sure the VM you want to patch is trusted in VCM; if it isn't, take the same steps we followed to trust the SCR server in the <span class="emphasis"><em>Configuring patching repository options in VCM</em></span> recipe.</p><p>We should have DNS resolution to and from the Linux machine to be patched and the SCR and VCM server.</p><p>The machine group where the VMs belong should have proper staging configured.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec103"/>How to do it...</h2></div></div></div><p>We now know patching Linux is a three-step process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Collecting the latest data with<span class="strong"><strong> Patching - Unix Assessment Result</strong></span> as the <span class="strong"><strong>Filter Se</strong></span>t option</li><li class="listitem" style="list-style-type: disc">Performing the actual patching</li><li class="listitem" style="list-style-type: disc">Again collecting the data (this is kind of optional as VCM also collects the data–it's just a precaution)</li></ul></div><p>So, let's begin by scheduling the required tasks in VCM so that our machines will get patched automatically:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. No.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Name</strong></span></p>
</td><td>
<p><span class="strong"><strong>Schedule</strong></span></p>
</td><td>
<p><span class="strong"><strong>Reason</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p>Initial collection</p>
</td><td>
<p>First Sunday 08:00 am</p>
</td><td>
<p>12 hours before the actual patch</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p>Deploying the patch</p>
</td><td>
<p>First Sunday 08:00 pm</p>
</td><td>
<p>Scheduled patch maintenance window</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p>Final assessment</p>
</td><td>
<p>First Sunday 11:00 pm</p>
</td><td>
<p>3 hours after patching to give time for automated collection (happens after 30 minutes of patching and reboot)</p>
</td></tr></tbody></table></div><div class="section" title="Step 1 – the initial collection"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec41"/>Step 1 – the initial collection</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the VCM console and go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Job</strong></span><span class="strong"><strong>Manager</strong></span> | <span class="strong"><strong>Scheduled</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Add</strong></span>, select <span class="strong"><strong>Collection</strong></span> once the wizard starts, and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Provide a proper name and description.</li><li class="listitem">Select <span class="strong"><strong>Patching - Unix Assessment Result</strong></span> as the <span class="strong"><strong>Filter Set</strong></span> option.</li><li class="listitem">Select the machine group you want to patch in this schedule.</li><li class="listitem">Select a schedule, preferably one upto 24 hours before the actual patching.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> and finally, after validating there are no conflicts, click on <span class="strong"><strong>Finish</strong></span>.</li><li class="listitem">This completes our first phase. The next is the actual patching schedule.</li></ol></div></div><div class="section" title="Step 2 – deploying the patch"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec42"/>Step 2 – deploying the patch</h3></div></div></div><p>To schedule patching, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Patching </strong></span>| <span class="strong"><strong>All</strong></span><span class="strong"><strong>Unix/Linux Platforms</strong></span> | <span class="strong"><strong>Automatic Deployment</strong></span></li><li class="listitem">Give the deployment a name and add a description.</li><li class="listitem">Select the <span class="strong"><strong>Machine Group</strong></span> we want to patch and whose data was collected in the earlier initial collection step.</li><li class="listitem">Select the <span class="strong"><strong>Assessment Template</strong></span> to deploy the patches with.</li><li class="listitem">On the next page, select the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Scheduled Automatic Deployment Run</strong></span></li><li class="listitem" style="list-style-type: disc">Depending upon the organization's policy, select whether you want to reboot or not.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Threshold Data Age</strong></span>: <code class="literal">2</code> days should be fine as we are performing the data collection for the past 24 hours. If the data is older than the number of configured days, the server will not be patched.</li></ul></div><div class="mediaobject"><img alt="Step 2 – deploying the patch" src="graphics/image_03_020.jpg"/></div></li><li class="listitem">Select the schedule and click on <span class="strong"><strong>Finish</strong></span> on the last page to save the scheduled patching.</li></ol></div></div><div class="section" title="Step 3 – final assessment"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec43"/>Step 3 – final assessment</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Once patching is done, VCM performs a collection with <span class="strong"><strong>Patching - Unix Assessment Result</strong></span> as the <span class="strong"><strong>Filter Set</strong></span> option. Still, we can schedule one more task to collect the details.</li><li class="listitem" style="list-style-type: disc">Follow the same steps we did for configuring prepatch data collection, but this time, change the name and the collection schedule so that this collection will start a few hours after the patching has finished.</li></ul></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec104"/>How it works...</h2></div></div></div><p>Basically, we are scheduling the things we were doing manually to save us some time and to not be awake at midnight to patch the server. VCM starts the scheduled jobs on time, collects the data, checks which patches are missing, installs them, and finally collects post-patch data so that when we run patch reports, we will have the latest status of the managed machine.</p><p>To check the reports, have a look at the <span class="emphasis"><em>Patching Reports</em></span> recipe in <a class="link" href="ch04.html" title="Chapter 4. Windows Patching">Chapter 4</a>, <span class="emphasis"><em>Windows Patching</em></span>. The only difference we can expect there is that the name is different; we need to replace Windows with Unix.</p></div></div></body></html>