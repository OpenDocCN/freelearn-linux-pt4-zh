<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;The Ubuntu Server Installation"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. The Ubuntu Server Installation</h1></div></div></div><p>This chapter will cover <a class="indexterm" id="id0"/>
<a class="indexterm" id="id1"/>how to install Ubuntu Server by using different methods. We will have a look at how to install Ubuntu Server in the manual and automated mode by using a simple or an advanced installation.</p><p>To reach this goal, we will follow this plan:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Preparation before the installation</li><li class="listitem" style="list-style-type: disc">The manual installation</li><li class="listitem" style="list-style-type: disc">The automated installation</li></ul></div><div class="section" title="Preparation before the installation"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Preparation before the installation</h1></div></div></div><p>In this<a class="indexterm" id="id2"/> section, we<a class="indexterm" id="id3"/> will take a quick look at the latest Ubuntu Server release news and then, we will make a list of all the system requirements.</p><div class="section" title="The latest Ubuntu release"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>The latest Ubuntu release</h2></div></div></div><p>Canonical, the<a class="indexterm" id="id4"/> company that produces Ubuntu, releases a new version every 6 months. Each release has a code with a <span class="emphasis"><em>YY.ZZ</em></span> pattern, where <span class="emphasis"><em>YY</em></span> is the year and <span class="emphasis"><em>ZZ</em></span> is the month.</p><p>I started writing this book just after Ubuntu 15.04 (Vivid Vervet) was released on April 23, 2015. Currently, there are two major releases—the LTS one that was released last year (<span class="strong"><strong>LTS</strong></span> stands for <span class="strong"><strong>long-term support</strong></span>), which is version 14.04, and the latest version 15.04. It is not a big deal if you choose either of these two versions to perform the tasks in the coming chapters, since it will make no difference. So, we decided to use the latest version as a reference for our samples, especially because the next LTS release will be based on it. (Note that only the LTS releases are supported for 5 years by Canonical, and the non-LTS releases have a support of only 9 months. That's why we normally choose the LTS versions for Ubuntu Server deployments.) When there is a notable difference between these two versions, we will mention it.</p><p>Now, let's take <a class="indexterm" id="id5"/>a look at some information related to the latest version:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It uses Linux kernel 3.19, which brings a lot of improvements in terms of performance as well as network facilities for both servers and cloud.</li><li class="listitem" style="list-style-type: disc">15.04 is the first Ubuntu version that features LXD.</li><li class="listitem" style="list-style-type: disc">It uses the latest versions of <a class="indexterm" id="id6"/>OpenStack, <span class="strong"><strong>LXC</strong></span> (<span class="strong"><strong>Linux Containers</strong></span>), LXD, Juju, libvirt, QEMU, Open vSwitch, Ceph, cloud-init, Docker, and HA-related package updates.</li><li class="listitem" style="list-style-type: disc">It replaced the service manager and the standard boot <code class="literal">upstart</code> with <code class="literal">systemd</code>.</li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>The <code class="literal">upstart</code> boot still exists under Ubuntu. You can use it by opening the <span class="strong"><strong>GRUB</strong></span> boot menu, choosing <span class="strong"><strong>Advanced options for Ubuntu</strong></span>, and then clicking on <span class="strong"><strong>Ubuntu, with Linux</strong></span> (upstart).</p><p>If you would like to switch permanently to the <code class="literal">upstart</code> boot, you can install the <code class="literal">upstart-sysv</code> package, which will remove <code class="literal">ubuntu-standard</code> and <code class="literal">systemd-sysv</code>.</p></div></div></div><div class="section" title="System requirements"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>System requirements</h2></div></div></div><p>System requirements <a class="indexterm" id="id7"/>depend on the services that may need to be deployed in the future and installed on the server. For demonstration/test purposes, we need a minimal configuration of 300 MHz CPU, 192 MB of RAM, and a 1.5 GB hard disk. This light configuration allows us to deploy Ubuntu Server on an old computer or even a little virtual machine. This limited footprint is basically due to the absence of the X Windows System (graphic interface), which is not needed in a server environment.</p><p>In a production environment, you should be careful about your actual needs in terms of resources (the CPU, RAM, and hard disk) and the estimation growth of those needs. To do this, you need to make a good measure of dimensions based on the services that you are going to deploy.</p><p>In the case of the samples in this book, we will use the 64-bit version of Ubuntu Server 15.04, and we will install it on a virtual box machine that has 1 GB of RAM and 2 TB of hard disk.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>Note that if you are using a used computer/server, you should back up your data before installing or upgrading Ubuntu. Partitioning tools used in the installation process are reliable and can be used for many years without any problems in general, but sometimes, they can perform catastrophic actions.</p></div></div></div><div class="section" title="Additional resources"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Additional resources</h2></div></div></div><p>This <a class="indexterm" id="id8"/>book comprises only the essentials. It contains exactly what you need to know to perform a specific task. If you need more information about and an in-depth understanding of Ubuntu, you can have a look at the official documentation by visiting <a class="ulink" href="https://help.ubuntu.com">https://help.ubuntu.com</a>.</p><p>You should download the CD image according to your system architecture. The whole list exists at <a class="ulink" href="http://releases.ubuntu.com/15.04/">http://releases.ubuntu.com/15.04/</a>.</p></div></div></div>
<div class="section" title="The manual installation"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>The manual installation</h1></div></div></div><p>In this<a class="indexterm" id="id9"/> section, we will have a look at how to install <a class="indexterm" id="id10"/>Ubuntu Server manually, either from the CD or the USB key. Here, we will only cover the installation from the CD; the same procedure applies for the installation from the USB key. In the latter case, you should configure your computer (using the BIOS interface) to boot from USB.</p><p>There is another way to manually install Ubuntu Server, which is via network, but since we will see this procedure in depth in the next <span class="strong"><strong>Automated installation</strong></span> section, we will not cover it here.</p><div class="section" title="A simple installation from a CD"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>A simple installation from a CD</h2></div></div></div><p>The<a class="indexterm" id="id11"/> procedure for installing Ubuntu from a CD is the same as that for most of the Linux distributions. So, if you are familiar with this, you can save time and move directly to the next section. If you are a newbie in this field, please follow this section closely, since the next sections (advanced installation and automated installation) will be based on this. Note that for Ubuntu Server edition, there is no graphical environment like the one in the desktop edition. So, you will need to use only the keyboard and not the mouse. The stepwise procedure to install Ubunto from CD is as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of all, download the installation CD image that matches your CPU architecture from the download page at <a class="ulink" href="http://releases.ubuntu.com/15.04/">http://releases.ubuntu.com/15.04/</a> and burn it on to an empty CD.</li><li class="listitem">Secondly, verify that your server BIOS is configured to boot on a CD-ROM drive; if this isn't the case, take care that you change it.</li><li class="listitem">Insert<a class="indexterm" id="id12"/> your CD in to the CD-ROM drive and boot it.</li><li class="listitem">Just after the boot process starts, you will be asked to select the installation language. Choose the one that you want. Don't worry if you choose some other language by mistake. You will soon learn how to change the settings.</li><li class="listitem">Now, you will get the following interface:<div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_01.jpg"/></div><p>You can see a lot of options that cater to your needs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you just press the <span class="emphasis"><em>Enter</em></span> key when selecting the default <span class="strong"><strong>Install Ubuntu Server</strong></span> option, you will start the installation process.</li><li class="listitem" style="list-style-type: disc">The second option, <span class="strong"><strong>Multiple server install with MAAS</strong></span>, will be covered later in the chapter when talking about virtualization and cloud.</li><li class="listitem" style="list-style-type: disc">Some <a class="indexterm" id="id13"/>people prefer starting with the third option, <span class="strong"><strong>Check disk for defects</strong></span>, to verify that the burn process of the ISO file on the CD was done correctly.</li><li class="listitem" style="list-style-type: disc">The fourth option, <span class="strong"><strong>Test memory</strong></span>, is very helpful, especially when your server starts crashing and you suspect a RAM-related problem.</li><li class="listitem" style="list-style-type: disc">You can use the fifth option, <span class="strong"><strong>Boot from first hard disk</strong></span>, to bypass the boot from the CD in case you forgot it by mistake in the CD-ROM driver.</li><li class="listitem" style="list-style-type: disc">Finally, the last option, <span class="strong"><strong>Rescue a broken system</strong></span>, turns a CD into a rescue disk that is useful for backup and recovery.</li><li class="listitem" style="list-style-type: disc">In most of the cases, all that you need to do is launch the installation by pressing the <span class="strong"><strong>Enter</strong></span> key when selecting the default <span class="strong"><strong>Install Ubuntu Server</strong></span> option, but there are some cases where you need some special options, either because of some specific hardware-related need of your machine, or because you need to customize the kernel parameters of the server for future use. For this purpose, Ubuntu gives you a lot of possibilities via the bottom menu on the boot splash screen, which can be accessed via the function keys.</li><li class="listitem" style="list-style-type: disc">If you press <span class="strong"><strong>F1</strong></span>, you will see an interactive help screen with documentation for the rest of the options.</li><li class="listitem" style="list-style-type: disc">If you accidentally chose the wrong language at the time of booting, press <span class="strong"><strong>F2</strong></span> to change it. The boot screen will automatically choose a keyboard mapping based on your language.</li><li class="listitem" style="list-style-type: disc">If you want a different mapping (for example, in my case, I am preparing screenshots for this book in English but I am using a French keyboard), press <span class="strong"><strong>F3</strong></span> to choose from a list of keyboard mapping options. The boot screen also has a lot of great accessibility options.</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>F4</strong></span> key displays a list of installation modes from which you can choose to install Ubuntu Server by using an OEM installation, a minimal system, and a minimal virtualization guest. The OEM installation is available for manufacturers. The minimal virtualization guest gives you an easy way to install a virtualized version of Ubuntu.</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>F5</strong></span> key <a class="indexterm" id="id14"/>shows an accessibility menu that allows you to choose a high-contrast screen, a screen magnifier, a screen reader, a braille terminal, keyboard modifiers, and even an on-screen keyboard.</li><li class="listitem" style="list-style-type: disc">The real power and control over the boot process is available once you press the <span class="strong"><strong>F6</strong></span> key. Here, you can see a menu of the common arguments that help the CD boot on difficult hardware. If you press the <span class="emphasis"><em>Esc</em></span> key, you will move from this menu to the boot prompt. You can type extra kernel boot parameters that you might need for your hardware, as shown in the following screenshot:</li></ul></div><div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_02.jpg"/></div></li><li class="listitem">Just after launching the installation process, you will be asked to choose the language of the installation procedure, which will be the default language of the server that you wish to install. Select the one that you want by using the up/down arrow keys on your keyboard and then press the <span class="emphasis"><em>Enter</em></span> key. You will also be asked for the location of the server (based on this, the system will fix the server time settings). Then, you have a choice of either letting the installer detect your keyboard layout, or you entering it manually.</li><li class="listitem">After performing <a class="indexterm" id="id15"/>these steps, the installer starts the installation process by detecting the hardware and loading some packages. Then, it moves on to configure the network settings by using <a class="indexterm" id="id16"/><span class="strong"><strong>DHCP</strong></span> (<span class="strong"><strong>Dynamic Host Configuration Protocol</strong></span>) and asking for the hostname that you would like to give to your server. If you wouldn't like to use DHCP for network configuration, choose <span class="strong"><strong>go back</strong></span> or simply press the <span class="emphasis"><em>Esc</em></span> button to go to the first interface of network configuration, where you will find the <span class="strong"><strong>Configure the network manually</strong></span> option, as shown in the following screenshot:<div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_03.jpg"/></div><p>By making this choice, you will be asked via different interfaces to enter your IP address, Netmask, the default Gateway, and DNS.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>Note that if you enter wrong information by mistake and you realize just after pressing the <span class="emphasis"><em>Enter</em></span> key, don't worry. You can go back easily to the previous interface and re-enter the correct data. All that you need to do is choose <span class="strong"><strong>Go Back</strong></span> or simply press the <span class="emphasis"><em>Esc</em></span> button.</p><p>Also note that this data is not a tattoo, and you can change it later. We will have a look at how to do this in the next chapter.</p></div></div></li><li class="listitem">At this point, we <a class="indexterm" id="id17"/>have almost finished the network settings part. We will be asked for the hostname in the next screen, and then we will move on to the user settings. First of all, you will be asked about the full username. Then, you will get an interface that asks for the Ubuntu username, which will be used for authentication with a proposition derived from the full username that you entered before. You can accept the proposition or modify it. Finally, you will be asked to enter and re-enter a password for this user. Be careful in this step because the keys entered will be hidden, as shown in the following screenshot. Therefore, it is important to remember the keys that you have entered:<div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_04.jpg"/></div><p>Next, you will be asked whether you would like to encrypt your home directory. Don't do that unless you know what you are doing. At the end of this step, you will be asked to check your time zone. Change it in case it is incorrect.</p></li><li class="listitem">Now, the most critical part of the installation arrives—partitioning! If you are using a new hard disk, you will see a screen, as shown in the following screenshot:<div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_05.jpg"/></div><p>If you <a class="indexterm" id="id18"/>are using a used hard disk, you will receive an interface that is a little different. It contains in general the same four options with the options related to the reuse of the existing partitions. The first three options are the recommended ones for a newbie. In our case, we will choose the <span class="strong"><strong>Guided—use entire disk and set up LVM</strong></span> option. The <span class="strong"><strong>Manual</strong></span> option will be covered in the <span class="strong"><strong>Advanced installation</strong></span> section.</p><p>On pressing the <span class="emphasis"><em>Enter</em></span> key, you will be taken to the next screen, where you will be asked to choose the disk that you would like to partition. You will then be taken to an interface, which will ask for your permission to write changes on the disk with the <span class="strong"><strong>No</strong></span> option selected. We of course need to make changes to the disk. We should just verify that we created a backup of our data on the disk before moving on. The next step is to select the <span class="strong"><strong>Yes</strong></span> option and press the <span class="emphasis"><em>Enter</em></span> key. Before you finish this step, you will be asked to enter the size of each volume group that you will be using for this partitioning. You can answer with a number followed by a symbol such as MB, GB, and TB, or simply use a percentage. Finally, you will get a summary of the partitioning<a class="indexterm" id="id19"/> step, which needs to be confirmed before it is applied, as shown in the following screenshot. Select the <span class="strong"><strong>Yes</strong></span> option and press the <span class="emphasis"><em>Enter</em></span> key:</p><div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_06.jpg"/></div></li><li class="listitem">At this point, the real installation process starts. During the installation, the installer needs only the CD, but if there is an Internet connection, it can be used to download software lists and install the latest updates. For that, it will ask you to either enter the proxy settings if you have one, or to keep this field empty.<p>After this step, the installer will start downloading the software list (we will cover this later in the next chapter). This step can take some time, depending on your Internet speed:</p><div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_07.jpg"/></div><p>After a few minutes, the installation process starts:</p><div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_08.jpg"/></div><p>During this step, you will be asked about the update policy. Personally, I recommend that you deactivate the automatic installation of updates. It is better when the administrator manages the installation of updates manually depending on the servers that are running on Ubuntu Server.</p></li><li class="listitem">One of the <a class="indexterm" id="id20"/>useful facilities that are given by the Ubuntu installer is the ability to choose to install server packages such as the SSH and DNS server. You can choose one of them by pressing the <span class="emphasis"><em>space bar</em></span>, and you can continue the installation process by pressing the <span class="emphasis"><em>Enter</em></span> key. In our case, we will decide not to install a server at this step. We will have a look at how to do this in a later chapter:<div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_09.jpg"/></div></li><li class="listitem">Finally, you<a class="indexterm" id="id21"/> will be asked to confirm the installation of the GRUB boot loader to the <a class="indexterm" id="id22"/><span class="strong"><strong>Master Boot Recorder</strong></span> (<span class="strong"><strong>MBR</strong></span>). Then, you will get the following notification at the end of the installation process:<div class="mediaobject"><img alt="A simple installation from a CD" src="graphics/B04800_01_10.jpg"/></div></li></ol></div></div><div class="section" title="Upgrading from an old release"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Upgrading from an old release</h2></div></div></div><p>In case <a class="indexterm" id="id23"/>you have an existing Ubuntu Server and you would like to upgrade it to the newest release, you can use the <code class="literal">do-release-upgrade</code> command. This command is a part of the <code class="literal">update-manager-core</code> package; it does not have any graphical dependencies and is installed by default.</p><p>You can check the options list associated with this command by running the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>do-release-upgrade --help</strong></span>
</pre></div><p>You will find the following options very useful:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">do-release-upgrade --check-dist-upgrade-only</code>: The <code class="literal">--check-dist-upgrade-only</code> option checks for a new version. If a new version is found, it is displayed as a result in the terminal. Once executed, this command performs only a verification job; no upgrade is made.</li><li class="listitem" style="list-style-type: disc"><code class="literal">do-release-upgrade --sandbox</code>: The <code class="literal">--sandbox</code> option is used to test an upgrade in a protected environment. This is particularly useful if you wish to test the deployment of an upgrade prior to its application in the production environment.</li><li class="listitem" style="list-style-type: disc"><code class="literal">do-release-upgrade</code>: The <code class="literal">do-release-upgrade</code> tool researches and makes an upgrade to the next LTS or stable version available, if it exists.</li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>The upgrade policy used by the <code class="literal">do-release-upgrade</code> tool is defined in the <code class="literal">/etc/update-manager/release-upgrades</code> file. The prompt variable at the end of the file indicates whether only the LTS versions will be considered or all the versions (the LTS ones as well as the regular ones) will be searched for when asking for an upgrade. The prompt variable can take as values <code class="literal">lts</code> for the LTS versions, <code class="literal">normal</code> for all versions, and <code class="literal">never</code> to never search for new versions.</p><p>You should <a class="indexterm" id="id24"/>only use the <code class="literal">Prompt=lts</code> mode when you are deploying a version of Ubuntu that is already an LTS. Otherwise, no new version will be detected by <code class="literal">do-release-upgrade</code>.</p></div></div></div></div>
<div class="section" title="The advanced installation"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>The advanced installation</h1></div></div></div><p>Much<a class="indexterm" id="id25"/> of the Ubuntu Server installation process fulfils a majority of user needs, and it is used in the same manner by most of the <a class="indexterm" id="id26"/>users (newbie or advanced), but the part that requires much more attention and which is customized by many advanced system administrators depending on their needs is the partitioning step. In this section, we will have a look at how to perform an advanced partitioning for a specific hard disk schema.</p><div class="section" title="Using RAID"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Using RAID</h2></div></div></div><p>The <a class="indexterm" id="id27"/>
<span class="strong"><strong>RAID</strong></span> technology (an acronym for <span class="strong"><strong>Redundant Array of Inexpensive Disks</strong></span>) refers to the techniques used to distribute data across <a class="indexterm" id="id28"/>multiple hard drives (creating a storage unit from several hard disks). The unit thus created has an improved fault tolerance (high availability) or a greater performance (the capacity/write speed). The <a class="indexterm" id="id29"/>distribution of data on several hard drives allows you to increase the safety and reliability of the associated services.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>For more information about this technology, you can take a tour at <a class="ulink" href="http://www.tldp.org/HOWTO/Software-RAID-HOWTO.html">http://www.tldp.org/HOWTO/Software-RAID-HOWTO.html</a>.</p></div></div><p>In this section, we <a class="indexterm" id="id30"/>will see how to install Ubuntu Server using two RAID1 partitions on two different hard disks, one for the <span class="strong"><strong>root</strong></span> and the other for <span class="strong"><strong>Swap</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <span class="strong"><strong>Partition disk</strong></span> step, select <span class="strong"><strong>manual</strong></span>. Then, select one by one all the disks that you want and which should be a part of the RAID partitions (in our case, only two disks). For each disk, create a new empty partition table on it.</li><li class="listitem">Select the free space on the first drive. Then, choose <span class="strong"><strong>Create a new partition</strong></span>. Set the size that you want for <span class="strong"><strong>Swap</strong></span>; it should be twice the RAM size and up to 2 GB. Then, choose <span class="strong"><strong>Primary</strong></span> and select <span class="strong"><strong>Beginning</strong></span>. The <span class="strong"><strong>physical volume for RAID</strong></span> option should be chosen in the <span class="strong"><strong>Use as:</strong></span> line. Finally, select <span class="strong"><strong>Done setting up partition</strong></span>.</li><li class="listitem">With the remaining free space, perform the same steps for the root partition. The only exception is that after setting the size, choose <span class="strong"><strong>Continue</strong></span> and then select <span class="strong"><strong>Primary</strong></span>. Also, select the <span class="strong"><strong>Bootable flag:</strong></span> line to change the value to <span class="strong"><strong>on</strong></span>.</li><li class="listitem">Return to the <span class="strong"><strong>Partition Disks</strong></span> step and select <span class="strong"><strong>Configure Software RAID</strong></span> at the beginning of the page. Then, choose <span class="strong"><strong>yes</strong></span> to write the modifications to disk.</li><li class="listitem">In the <span class="strong"><strong>Create MD device</strong></span> setup and for this example, choose <span class="strong"><strong>RAID1</strong></span>, but if you are applying another architecture, choose the one that fits your needs.</li><li class="listitem">Now, enter the number of hard drives that you have chosen for the array (in our case, we have two active devices). Then, select <span class="strong"><strong>Continue</strong></span>.</li><li class="listitem">Next, enter the number of spare devices (choose the default setting for RAID1, which is 0) and then select <span class="strong"><strong>Continue</strong></span>.</li><li class="listitem">At this step, choose the partitions that you wish to use. For the <span class="strong"><strong>Swap</strong></span> partition, choose <span class="strong"><strong>sda1</strong></span> and <span class="strong"><strong>sdb1</strong></span>. Select <span class="strong"><strong>Continue</strong></span> to go to the next step.</li><li class="listitem">Repeat steps 3 to 7 to prepare the root partition, and at the end, choose <span class="strong"><strong>sda2</strong></span> and <span class="strong"><strong>sdb2</strong></span>. Finally, select <span class="strong"><strong>Finish</strong></span>.</li></ol></div><p>We should now have a list of RAID devices and hard drives. The next remaining steps are required to format and set the mount point for the RAID devices. Deal with the RAID devices as a local hard disk; format and mount accordingly:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Getting back to the initial partitioning page again, we will see our newly created <span class="strong"><strong>RAID devices #0</strong></span> and <span class="strong"><strong>#1</strong></span> partitions.</li><li class="listitem">Under <a class="indexterm" id="id31"/>the <span class="strong"><strong>RAID1 device #0</strong></span> partition, select <span class="strong"><strong>#1</strong></span> and press the <span class="emphasis"><em>Enter</em></span> key.</li><li class="listitem">In the <span class="strong"><strong>Use as:</strong></span> file, select <span class="strong"><strong>swap area</strong></span> and then apply this partition by using the <span class="strong"><strong>Done setting up partition</strong></span> entry.</li><li class="listitem">Under the <span class="strong"><strong>RAID1 device #1</strong></span> partition, select <span class="strong"><strong>#1</strong></span> and press the <span class="emphasis"><em>Enter</em></span> key.</li><li class="listitem">In the <span class="strong"><strong>Use as:</strong></span> file, select <span class="strong"><strong>Ext4 journaling file system</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Mount point</strong></span> field, choose <span class="strong"><strong>/</strong></span> (the root file system). You can change the other options as you wish. Then, apply that partition by using the <span class="strong"><strong>Done setting up partition</strong></span> entry.</li><li class="listitem">Finally, select <span class="strong"><strong>Finish partitioning and write changes to disk</strong></span>.</li></ol></div><p>The <a class="indexterm" id="id32"/>installation process will then continue normally.</p></div><div class="section" title="Using LVM"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Using LVM</h2></div></div></div><p>
<span class="strong"><strong>LVM</strong></span> (<span class="strong"><strong>Logical Volume Manager</strong></span>) allows<a class="indexterm" id="id33"/> the<a class="indexterm" id="id34"/> creation and the management of logical volume on Linux. The use of logical volumes somehow replaces the disks' partitioning. This is a much more flexible system as it allows you, for instance, to reduce the size of a file system to expand another one regardless of their location on disks.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>For more information about this technology, you can take a tour at <a class="ulink" href="http://tldp.org/HOWTO/LVM-HOWTO/">http://tldp.org/HOWTO/LVM-HOWTO/</a>.</p></div></div><p>In this section, we will have a look at the partitioning step of Ubuntu Server installation process with the <span class="strong"><strong>/srv</strong></span> partition mounted on a LVM volume. This section will be divided into two parts—the first part is during the Ubuntu installation within only one <span class="strong"><strong>PV</strong></span> (<span class="strong"><strong>physical volume</strong></span>), <a class="indexterm" id="id35"/>which will be a part of the <a class="indexterm" id="id36"/>
<span class="strong"><strong>VG</strong></span> (<span class="strong"><strong>volume group</strong></span>), and the second part will be after the Ubuntu installation. While performing this process, we will demonstrate how to add a second PV to the VG:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <span class="strong"><strong>Partition disks</strong></span> screen, choose <span class="strong"><strong>Manual</strong></span>.</li><li class="listitem">Select the hard disk. Then, choose <span class="strong"><strong>Yes</strong></span> to confirm the <span class="strong"><strong>Create a new empty partition table on this device</strong></span> order.</li><li class="listitem">Next, create standard swap and / partitions with the file system that you want.</li><li class="listitem">For our <code class="literal">/srv</code> LVM partition, create a new logical partition and change the <span class="strong"><strong>Use as</strong></span> field to <span class="strong"><strong>physical volume for LVM</strong></span>. Then, select <span class="strong"><strong>Done setting up the partition</strong></span>.</li><li class="listitem">Now, choose <span class="strong"><strong>Configure the Logical Volume Manager</strong></span> and select <span class="strong"><strong>Yes</strong></span>.</li><li class="listitem">On the<a class="indexterm" id="id37"/> next screen and for <span class="strong"><strong>LVM configuration action</strong></span>, select <span class="strong"><strong>Create volume group</strong></span>. Name the VG (for example, vg01). Then, select the partition prepared for LVM and choose <span class="strong"><strong>Continue</strong></span>.</li><li class="listitem">Return<a class="indexterm" id="id38"/> to the <span class="strong"><strong>LVM configuration action</strong></span> page and select <span class="strong"><strong>Create logical volume</strong></span>. Choose the newly created VG and name the new LV. Then, choose a size and at the end, select <span class="strong"><strong>Finish</strong></span>. You will be taken to the main <span class="strong"><strong>Partition Disks</strong></span> page again.</li><li class="listitem">Now, let's add a file system to our new LVM. To do this, select the partition under the LVM that you created and set up the file system that you want and choose <span class="strong"><strong>/srv</strong></span> as the mount point. Next, select <span class="strong"><strong>Done setting up the partition</strong></span>.</li><li class="listitem">Finally, apply the <span class="strong"><strong>Finish partitioning and write changes to disk</strong></span> order. Then, confirm the changes and continue your installation.</li></ol></div><p>Now, we will continue with the second part that started after the Ubuntu Server installation and which covers adding a second hard disk, creating a PV, adding it to the existing VG, extending LV with the srv command, and finally extending the file system. In this part, we will use a second hard disk named <code class="literal">/dev/sdb</code>, and we will use it entirely as a PV. You can configure and use as much of PV as you want:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of all, create the PV using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo pvcreate /dev/sdb</strong></span>
</pre></div></li><li class="listitem">Next, extend the VG (called <code class="literal">vg01</code> in our example), as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo vgextend vg01 /dev/sdb</strong></span>
</pre></div></li><li class="listitem">Use the <code class="literal">vgdisplay</code> command to find out the size that you can allocate (for free physical extents, see the <span class="strong"><strong>Free PE / size</strong></span> line). We will assume in our example a free size of 511 PE (which is equivalent to 2 GB with a size of 4 MB PE), and we will use the entire available free space.</li><li class="listitem">We can now use the PE to extend the LV via the following command (there are other methods, but they are beyond the scope of this book):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo lvextend /dev/vg01/srv -l +511</strong></span>
</pre></div></li><li class="listitem">We used the <code class="literal">-l</code> option here to extend the LV using PE. If you want to extend using MB, GB, and TB, you can use the <code class="literal">-l</code> option.</li><li class="listitem">Before expanding an <code class="literal">ext3</code> or <code class="literal">ext4</code> file system, it is recommended that you unmount it before hand (as best practice). In case you want to reduce an LV, it will be mandatory to unmount it. The following commands unmount the partition and then check it:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo umount /srv</strong></span>
<span class="strong"><strong>sudo e2fsck -f /dev/vg01/srv</strong></span>
</pre></div></li><li class="listitem">Finally, you <a class="indexterm" id="id39"/>can resize the file system by using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo resize2fs /dev/vg01/srv</strong></span>
</pre></div></li><li class="listitem">Now, you <a class="indexterm" id="id40"/>can mount the partition and check its new size using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mount /dev/vg01/srv /srv &amp;&amp; df -h /srv</strong></span>
</pre></div></li></ol></div></div></div>
<div class="section" title="The automated installation"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>The automated installation</h1></div></div></div><p>Sometimes, we<a class="indexterm" id="id41"/> have a large number of servers to install. In this case, the manual installation will take a lot of time to perform a <a class="indexterm" id="id42"/>repetitive task. To solve this problem, there is the automation installation, or what we call the network boot.</p><p>For this, we need a machine equipped with a DHCP server and a TFTP server that will provide us the services and configuration files that we need for the system to be installed.</p><div class="section" title="The PXE process"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>The PXE process</h2></div></div></div><p>The<a class="indexterm" id="id43"/> client computer (our future server) will boot<a class="indexterm" id="id44"/> its network interface in the <span class="strong"><strong>PXE</strong></span> (<span class="strong"><strong>Preboot Execution Environment</strong></span>) mode. Then, the DHCP present on the network will send it the <code class="literal">pxelinux.0</code> file; this will be explained later. Thus, the client computer accesses the <code class="literal">pxelinux.cfg</code> configuration file via TFTP, which contains the necessary information required to launch the installation process.</p><div class="section" title="The PXE installation procedure"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>The PXE installation procedure</h3></div></div></div><p>Let's start<a class="indexterm" id="id45"/> with the server installation:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of all, install the DHCP server by using the <code class="literal">sudo apt-get install isc-dhcp-server -y</code> command, and then configure it by using the <code class="literal">/etc/default/isc-dhcp-server</code> file to use the network that you want for listening (such as <code class="literal">eth0</code>).<p>In the <code class="literal">/etc/dhcp/dhcpd.conf</code> file, you should configure some parameters such as the subnet and the address range. Then, restart it by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service isc-dhcp-server restart</strong></span>
</pre></div></li><li class="listitem">After this, install<a class="indexterm" id="id46"/> the following packages that are necessary if you wish to set up the PXE environment:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install apache2 tftpd-hpa inetutils-inetd</strong></span>
</pre></div><p>Now, it is time to configure the TFTP service. To do this, add the following two lines to the <code class="literal">/etc/default/tftpd-hpa</code> file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>RUN_DAEMON="yes"</strong></span>
<span class="strong"><strong>OPTIONS="-l -s /var/lib/tftpboot"</strong></span>
</pre></div><p>Also, add the following line at the end of the <code class="literal">/etc/inetd.conf file</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>tftp    dgram   udp    wait    root    /usr/sbin/in.tftpd /usr/sbin/in.tftpd -s /var/lib/tftpboot</strong></span>
</pre></div><p>Then, reboot the service using the <code class="literal">sudo /etc/init.d/tftpd-hpa restart</code> command.</p></li><li class="listitem">Now, we need to copy the installation files to the PXE server. In our example, I used the ISO image that I have in my home directory. First of all, mount it by using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo mount loop /home/abdelmonam/ubuntu-15.04-server-amd64.iso /mnt</strong></span>
</pre></div><p>Then, copy the required files to the server by using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>cd /mnt</strong></span>
<span class="strong"><strong>sudo cp -fr install/netboot/* /var/lib/tftpboot/</strong></span>
<span class="strong"><strong>sudo mkdir /var/www/Ubuntu</strong></span>
<span class="strong"><strong>sudo cp -fr /mnt/* /var/www/ubuntu/</strong></span>
</pre></div><p>After doing this, modify the <code class="literal">/var/lib/tftpboot/pxelinux.cfg/default</code> PXE config file by adding the following lines at the end:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>label linux</strong></span>
<span class="strong"><strong>kernel ubuntu-installer/amd64/linux</strong></span>
<span class="strong"><strong>append ks=http://192.168.1.1/ks.cfg vga=normal initrd=ubuntu-installer/amd64/initrd.gz</strong></span>
<span class="strong"><strong>ramdisk_size=16432 root=/dev/rd/0 rw  --</strong></span>
</pre></div><p>Be careful when adding the IP address.</p></li><li class="listitem">The last <a class="indexterm" id="id47"/>step required to set up the PXE server is to add the following lines at the end of the <code class="literal">/etc/dhcp/dhcpd.conf</code> file:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>allow booting;</strong></span>
<span class="strong"><strong>allow bootp;</strong></span>
<span class="strong"><strong>option option-128 code 128 = string;</strong></span>
<span class="strong"><strong>option option-129 code 129 = text;</strong></span>
<span class="strong"><strong>next-server 192.168.1.1;</strong></span>
<span class="strong"><strong>filename "pxelinux.0";</strong></span>
</pre></div><p>Then, reboot the DHCP server by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo service isc-dhcp-server restart</strong></span>
</pre></div></li></ol></div><p>Let's move on to the client configuration. In our case, I used a <code class="literal">virtualbox</code> instance to test this kind of installation:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the virtual machine with the characteristics that you want via the <code class="literal">virtualbox</code> manager.</li><li class="listitem">Then, go to the <span class="strong"><strong>Settings</strong></span> of the machine and select the <span class="strong"><strong>System</strong></span> tab. In the <span class="strong"><strong>Boot Order</strong></span> part, deselect all options and select <span class="strong"><strong>Network</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="The PXE installation procedure" src="graphics/B04800_01_11.jpg"/></div></li><li class="listitem">Select<a class="indexterm" id="id48"/> the <span class="strong"><strong>Network</strong></span> tab and configure the network adaptor to act as a bridge.</li><li class="listitem">Finally, start your VM. You will see the following interface:<div class="mediaobject"><img alt="The PXE installation procedure" src="graphics/B04800_01_12.jpg"/></div></li></ol></div><p>Enjoy watching the<a class="indexterm" id="id49"/> server installation if you were doing it locally from a CD.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>The PXE installation can be used to install a lot of machines in parallel as well as to install Ubuntu Server on machines without a CD-ROM driver.</p><p>The installation process will be entirely automated if you combine the PXE method with a <code class="literal">kickstart</code> and/or <code class="literal">preseed</code> file. A good starting point for working with <code class="literal">kickstart</code> is <a class="ulink" href="https://help.ubuntu.com/community/KickstartCompatibility">https://help.ubuntu.com/community/KickstartCompatibility</a>.</p></div></div></div></div><div class="section" title="Additional resources"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Additional resources</h2></div></div></div><p>Since this <a class="indexterm" id="id50"/>book consists of the essentials for the Ubuntu Server, we can't cover topics in depth. Therefore, here are some useful links that will help you go as far as you want in this subject:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For details regarding the installation of the Ubuntu desktop from a PXE server, visit <a class="ulink" href="https://help.ubuntu.com/community/Installation/LocalNet">https://help.ubuntu.com/community/Installation/LocalNet</a>. You can use the same procedure to install Ubuntu Server.</li><li class="listitem" style="list-style-type: disc">To learn how to prepare a PXE server that allows you to boot multiple distributions (Ubuntu, Debian, Fedora, CentOS, and openSUSE), visit <a class="ulink" href="https://help.ubuntu.com/community/PXEInstallMultiDistro">https://help.ubuntu.com/community/PXEInstallMultiDistro</a>.</li><li class="listitem" style="list-style-type: disc">For those of you searching for how to set up a MAAS server that will deploy a Ubuntu system through <code class="literal">netboot</code>, a very good guide is available at <a class="ulink" href="http://maas.ubuntu.com/docs/install.html">http://maas.ubuntu.com/docs/install.html</a>.</li></ul></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Summary</h1></div></div></div><p>In this chapter, we had a look at how to install Ubuntu Server in different modes—manually and automated—with the help of a simple or an advanced installation.</p><p>Now, we can start managing our server, which is the subject that we will cover in the next chapter.</p></div></body></html>