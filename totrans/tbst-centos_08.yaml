- en: Chapter 8. Troubleshooting Database Services
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Database services play a vital role within today's corporate infrastructure,
    and yet this chapter is not aimed at programmers, database administrators, or
    developers. Instead, the following pages will take the alternative point of view
    in order to develop the conversation for system administrators and troubleshooters
    who are primarily working with CentOS 7\. So, let's begin our journey by looking
    at some of the more common problems associated with databases as a whole in order
    to provide a troubleshooter's guide to MariaDB, MySQL, and PostgreSQL.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will:'
  prefs: []
  type: TYPE_NORMAL
- en: Learn how to get up-and-running with MariaDB on CentOS 7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Learn how to reset and recover a lost password for the root user with MariaDB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Learn how to tune both MariaDB and MySQL server with `mysqltuner`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Discover how to run metrics across the MariaDB and MySQL servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Learn how to remove MariaDB and return to the MySQL server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Learn how to install and configure PostgreSQL on CentOS 7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting up-and-running with MariaDB
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In the latest release of CentOS, you will find that MariaDB has replaced MySQL.
    It is correct to say that there are similarities between the two database systems,
    but it is also important to recognize that they are both very different systems.
    Based on this premise, a typical issue often begins at the point of installation,
    where the following message may prove to be more than uncomfortable:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'In this case, your first action is to verify what is currently installed. This
    can be achieved by running one or more of the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: However, given that the output will seem to be misleading to the untrained eye,
    this issue provides a point of confusion, and it happens as a result of trying
    to run the MySQL installation and startup commands. Yes, it is an easy mistake
    to make, and the most effective means of troubleshooting this issue is to explore
    the correct way of installing MariaDB.
  prefs: []
  type: TYPE_NORMAL
- en: 'To install MariaDB, you should use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'To start the MariaDB service, simply execute the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The output of which will result in:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'To complete the installation, you should now run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Remember, you have not set a password at this stage. So, when prompted, just
    press the *return* key to signify that there is no current password and complete
    the secure installation process by following the prompts as required. As an addition
    to this, you may also see the following error message:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: This message can be safely ignored as it represents an outstanding bug associated
    with Fedora 19 (see the references at the end of this chapter for Red Hat Bugzilla
    - Bug 1020055).
  prefs: []
  type: TYPE_NORMAL
- en: 'The complete `mysql_secure_installation` procedure runs as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'From this point on, everything should feel familiar once again and you can
    begin by checking the status of MariaDB at any time with the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Resetting and recovering a root password with MariaDB
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The act of resetting a root password provides true currency for a system troubleshooter.
    It can happen—and yes, it does happen more times than you can imagine—but by following
    the next few steps, a crisis can be averted.
  prefs: []
  type: TYPE_NORMAL
- en: 'To begin, you will need to stop the MariaDB service like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'The next step is to activate "safe mode" in the following way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Now run the following sequence to access the MySQL console and connect to the
    database:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'At this point, we now want to create a new password for the root user, flush
    the new privileges, and exit the MySQL console like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Having completed these steps, you can either reboot the server or simply stop
    and start the MariaDB service in the following way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, you can now access the database with the new root user credentials
    by typing:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: Tuning MariaDB and MySQL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The MYSQL tuner is a useful package that connects to a running instance of your
    database service and provides a series of configuration recommendations based
    on the current workload. Naturally, such a tool will not always provide the perfect
    answer for your system, but you should allow the database system to run for one
    or more days under a typical workload before introducing a modified configuration.
  prefs: []
  type: TYPE_NORMAL
- en: 'To install the `mysqltuner` package (part of the EPEL repository), you should
    type this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'To run the `mysqltuner` package from the command line, you can use the following
    syntax at any time:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, depending on your system configuration and hardware, the output of `mysqltuner`
    will look similar to this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: The `mysqltuner` package is designed to enable you to make ongoing adjustments
    to the performance and stability of your MySQL installation. Much of the output
    is verbose, and it shows you the current configuration variables along with an
    array of current status data that results in a summary of some general performance
    recommendations.
  prefs: []
  type: TYPE_NORMAL
- en: 'It is advisable that you allow the database to run under typical conditions
    for at least 24 hours before any changes are made. However, should you wish to
    take advantage of one or more of these recommendations, then you can add them
    to, or integrate them with, your existing MySQL configuration file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: Upon completion, you will be required to restart the database service in question
    in order to take advantage of the changes made.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can do this by typing the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'Then confirm the database status using this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'The output of which may look similar to this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: Remember, as system requirements and database needs change on an ongoing basis,
    you can keep running `mysqltuner` as often you like in order to see whether further
    recommendations have been made.
  prefs: []
  type: TYPE_NORMAL
- en: Obtaining metrics from MariaDB and MySQL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Metrics not only enable you to build a character analysis of your database
    server, but they can provide evidence of an unexpected behavior. For the troubleshooter,
    this type of data is important and that can be obtained by running the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'The output will provide the following information:'
  prefs: []
  type: TYPE_NORMAL
- en: '`Uptime`: This value represents the number of seconds the database server has
    been running.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Threads`: This value indicates the number of connected clients.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Questions`: This value indicates the number of queries served since the database
    server was started.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Slow queries`: This value indicates the number of queries that have exceeded
    the `long_query_time`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Opens`: This value indicates the number of tables that have been served to
    clients.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Flush tables`: This value indicates the number of flush requests served by
    the database server. This includes the `flush`, `refresh`, and `reload` commands.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Open tables`: This value indicates the number of tables that are currently
    open.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Queries per second avg`: This value indicates the number of queries the database
    server receives per second.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'However, as the preceding command is quite slim on detail, greater detail can
    be obtained by using the following syntax:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: 'An alternative or real-time approach can be obtained by using the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: Note the use of the `-i` option. This indicates that a 10-second pause will
    take place before the command will refresh. Based on this, you can establish a
    real-time monitor of the database server events, thereby enabling you to identify,
    capture, and kill any queries that can be slowing down the system as a whole.
  prefs: []
  type: TYPE_NORMAL
- en: Returning to MySQL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In some environments, you will want CentOS 7 to use MySQL as opposed to installing
    MariaDB. To do this, you will need to ensure that MariaDB is not installed, which
    can be done by running the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'You should now check to confirm whether it has been removed using the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: To begin the installation of MySQL, you should download the YUM repository configuration
    file from [http://dev.mysql.com/downloads/repo/yum/](http://dev.mysql.com/downloads/repo/yum/).
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, you will not need an account to download this file, but for those of you
    who do not want to tour the Oracle website, at the time of writing this book it
    is possible to bypass the preceding process and use the following syntax:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: 'You can then run the appropriate installation command like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: 'Ensure that the MySQL daemon is enabled to start on boot by running this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: 'You can now start the server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, run the MySQL secure installation routine in the usual way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, rerunning the following command will confirm that the process was
    successful:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: Installing and configuring PostgreSQL 9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: PostgreSQL is fast, robust, cross-platform, and maintains an excellent pedigree.
    However, in order to troubleshoot when or where an irregular or unexpected event
    took place, it is always best to begin by remembering how this database service
    is installed.
  prefs: []
  type: TYPE_NORMAL
- en: 'To begin this process, we must add the relevant repository in the following
    way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 'You should always confirm that you are downloading the appropriate version
    by visiting the repository itself but, having completed this step, you can now
    install PostgreSQL like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'At this stage, you may want to make some configuration changes to PostgreSQL.
    To begin, open the following file in your favorite text editor like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: 'The preceding configuration is verbose, and in most cases, you will be simply
    uncommenting lines or substituting the relevant values to suit your environment.
    For example, to make the PostgreSQL database server listen on a specific IP address,
    you will have to uncomment the following line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: 'Then you can change this to suit the IP address of your choice like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: 'However, depending on what flavor of Linux you come from, in instances where
    you may or may not be looking for the `tcpip_socket` parameter, you should use
    the following syntax instead:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: 'Taking this one step further, you should also spend time making relevant changes
    to the other settings found within this file. This can include the port used,
    the maximum number of connections supported, authentication timeout, resource
    usage, and the many more features afforded by PostgreSQL before opening the following
    file in order to adjust network access to the database server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: 'For example, if you want to provide local network access for an entire IP range
    (for example, 192.168.1.0/24), you can use the following syntax:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: 'Alternatively, for peace of mind, you can use the following syntax to achieve
    a similar result with slightly less typing:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: 'So, having completed the preceding steps to enable PostgreSQL at boot, you
    must type:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: 'To initialize the database server, you must type this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, if you want to access the database server, you must switch to the
    predefined PostgreSQL user account like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: 'Then you can proceed to connect to the PostgreSQL database in the following
    way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, by using the following expression, you will be able to review the full
    list of `psql` commands available to you in order that you can begin adding users
    and templates, and creating databases:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: 'For example, to quit the `psql` console at any time, use the following syntax:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, having returned to the standard bash console, you can confirm PostgreSQL
    connectivity at any time by customizing the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: 'Alternatively, you can use the `ps` command like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: From installation and optimization to recovering a lost password for the root
    user, in this chapter we have highlighted a number of issues related to the process
    of troubleshooting both MariaDB and PostgreSQL. As was stated at the outset, there
    was no intention to deal with specific programming or development issues, but
    as these database systems can be found throughout the enterprise, it is expected
    that you will be dealing with them; in this respect, we have discussed a range
    of topics that will provide a useful starting point when troubleshooting almost
    any database service.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will further the theme of the book and discuss a unique
    approach to troubleshooting web services.
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The MySQL project home page: [http://dev.mysql.com/](http://dev.mysql.com/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'MySQL YUM downloads: [http://dev.mysql.com/downloads/repo/yum/](http://dev.mysql.com/downloads/repo/yum/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The MariaDB project home page: [https://mariadb.org/en/](https://mariadb.org/en/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'MariaDB FAQ: [https://mariadb.com/kb/en/mariadb/faq/](https://mariadb.com/kb/en/mariadb/faq/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Installing MariaDB with Yum: [https://mariadb.com/kb/en/mariadb/yum/](https://mariadb.com/kb/en/mariadb/yum/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Red Hat Bugzilla – Bug 1020055, [https://bugzilla.redhat.com/show_bug.cgi?id=1020055](https://bugzilla.redhat.com/show_bug.cgi?id=1020055)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The MySQLTuner home page: [http://mysqltuner.com](http://mysqltuner.com)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The MySQLTuner GitHub home page: [https://github.com/major/MySQLTuner-perl](https://github.com/major/MySQLTuner-perl)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Benchmarking MariaDB-5.3.4: [https://blog.mariadb.org/benchmarking-mariadb-5-3-4/](https://blog.mariadb.org/benchmarking-mariadb-5-3-4/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Troubleshooting problems – starting the MySQL server: [http://dev.mysql.com/doc/refman/5.1/en/starting-server.html](http://dev.mysql.com/doc/refman/5.1/en/starting-server.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'MariaDB versus MySQL – compatibility: [https://mariadb.com/kb/en/mariadb/mariadb-vs-mysql-compatibility/](https://mariadb.com/kb/en/mariadb/mariadb-vs-mysql-compatibility/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'PostgreSQL 9.3.6 documentation: [http://www.postgresql.org/docs/9.3/static/index.html](http://www.postgresql.org/docs/9.3/static/index.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'PostgreSQL client authentication: [http://www.postgresql.org/docs/9.3/static/client-authentication.html](http://www.postgresql.org/docs/9.3/static/client-authentication.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'PostgreSQL database roles: [http://www.postgresql.org/docs/9.3/static/user-manag.html](http://www.postgresql.org/docs/9.3/static/user-manag.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'PostgreSQL repositories: [http://yum.postgresql.org/repopackages.php](http://yum.postgresql.org/repopackages.php)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
