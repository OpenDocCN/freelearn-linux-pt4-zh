<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Configuring VCM to Manage Your Infrastructure"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Configuring VCM to Manage Your Infrastructure</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Adding a vCenter Server instance</li><li class="listitem" style="list-style-type: disc">Adding a vCloud Director and vShield instance</li><li class="listitem" style="list-style-type: disc">Collecting data from managed machines</li><li class="listitem" style="list-style-type: disc">Adding a discovery rule</li><li class="listitem" style="list-style-type: disc">Adding a network authority account to manage machines in multiple domains</li><li class="listitem" style="list-style-type: disc">Configuring a managing agent machine for virtual environment management</li><li class="listitem" style="list-style-type: disc">Installing an agent on Windows servers</li><li class="listitem" style="list-style-type: disc">Installing an agent on Linux servers</li><li class="listitem" style="list-style-type: disc">Creating machine groups</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Introduction</h1></div></div></div><p>Once VCM has been installed, we need to configure it to make it work for our environment; the default configurations need to be changed for environment-specific changes. To manage our infrastructure, we need to install agents on the Windows and Linux servers. This can be achieved in many ways, such as installing via scripts or, if we are using automation to deploy the machines, we could use that itself or push it to the servers identified by VCM.</p><p>We need to add vCenter, vCloud, and vShield server instances to VCM so that we can start utilizing the details available in those systems, such as machines and vApps deployed, which can be used to create various reports. Also, the captured details include the virtual machines deployed in the infrastructure, which can be used by VCM to deploy agents and bring them under management.</p><p>We need to create various machine groups; a machine group is basically a collection of machines that can be grouped into a single entity for various purposes, such as patching, reporting, and checking compliance.</p><p>In this chapter, we will start configuring VCM so that it is ready for day-to-day operations.</p><p>Let's begin.</p></div></div>
<div class="section" title="Adding a vCenter Server instance"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Adding a vCenter Server instance</h1></div></div></div><p>Before we start managing our virtual infrastructure, we need to add the components to VCM. We will start adding them in the following recipes, starting with vCenter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>Getting ready</h2></div></div></div><p>We will need a user with administrative access to the vCenter instance that we want to add to VCM as well as its <span class="strong"><strong>fully qualified domain name</strong></span> (<span class="strong"><strong>FQDN</strong></span>) or IP address.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>How to do it...</h2></div></div></div><p>To add the vCenter instance to VCM, log in to the VCM server UI and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to VCM with an administrative account.</li><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Licensed Machines</strong></span> |<span class="strong"><strong> Licensed Virtual Environments</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/5400_02_pg-2.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Add Machines</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Basic</strong></span> on the first page of the wizard.</li><li class="listitem">Enter the hostname (not FQDN here) for the machine name, select <span class="strong"><strong>Domain</strong></span> from the dropdown which the machine belongs to, select <span class="strong"><strong>DNS</strong></span> for <span class="strong"><strong>Type</strong></span>, and <span class="strong"><strong>vCenter Windows</strong></span> for <span class="strong"><strong>Machine Type</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Add</strong></span>, and then click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Finish </strong></span>to close the wizard.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>With these steps, we added the vCenter instance to VCM, but we still need to configure it so that we can collect the details.</p></div></div></li><li class="listitem">Now, select the vCenter instance we just added and click on <span class="strong"><strong>Configure Settings</strong></span>.</li><li class="listitem">In this wizard, select the vCenter instance.</li><li class="listitem">Provide the following information:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Managing Agent</strong></span>: Your Collector server</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Port</strong></span>: <code class="literal">443</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>User ID</strong></span>: A user with administrative access to vCenter</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Password</strong></span>: The password for the user; enter it twice to confirm</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ignore untrusted SSL Certificate</strong></span>: <span class="strong"><strong>Yes</strong></span></li></ul></div></li><li class="listitem">Click on <span class="strong"><strong>Next </strong></span>once all the details have been filled in.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_002.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p><span class="strong"><strong>Note</strong></span>: The user must have a vCenter Server administrative role or a read-only role. However, you cannot run actions with a read-only role.</p></div></div></li><li class="listitem">Click on <span class="strong"><strong>Finish </strong></span>to close the wizard.</li><li class="listitem">There should be a green circle in front of the vCenter instance's name on the VCM console.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>How it works...</h2></div></div></div><p>We are adding vCenter to VCM so that we can collect information about all the ESXi hosts in the instance, all the virtual machines, and so on, and based on this information, we can create compliance checks for our virtual infrastructure, discover the virtual machines as managed machines in VCM so that we can install agents, and collect information about them as well.</p><p>VCM collects the following information from vCenter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">vCenter Summary</li><li class="listitem" style="list-style-type: disc">vCenter Custom Information</li><li class="listitem" style="list-style-type: disc">vCenter Guests</li><li class="listitem" style="list-style-type: disc">vCenter Hosts</li><li class="listitem" style="list-style-type: disc">vCenter Host Profiles</li><li class="listitem" style="list-style-type: disc">vCenter Inventory</li><li class="listitem" style="list-style-type: disc">vCenter Networking</li><li class="listitem" style="list-style-type: disc">vCenter Settings</li><li class="listitem" style="list-style-type: disc">vCenter Resource Pools</li><li class="listitem" style="list-style-type: disc">vCenter Roles</li></ul></div></div></div>
<div class="section" title="Adding a vCloud Director and vShield instance"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Adding a vCloud Director and vShield instance</h1></div></div></div><p>There are three virtual elements that can be managed by VCM: vCenter, vShield, and vCloud. In the previous recipe, we added vCenter. In this one, we will continue with <span class="strong"><strong>vShield</strong></span> and <span class="strong"><strong>vCloud Director</strong></span> (<span class="strong"><strong>vCD</strong></span>).</p><p>VMware vShield is a suite of virtual security appliances built for VMware vCenter Server integration. A vShield security group is a logical trust zone that you create and assign resources to for vShield protection.</p><p>By adding vCloud to VCM, you can use the vCloud Director properties to create machine groups and so on.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>Getting ready</h2></div></div></div><p>We will need the IP address of the vShield Manager and vCloud Director instances and a user account with administrative privileges.</p><p>Before adding vShield, you must collect data for your vCenter instance, as described in the next recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>How to do it...</h2></div></div></div><p>We will split this recipe into two sections, as follows.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Adding a vShield instance</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Adding a vCloud Director instance</em></span></li></ul></div><div class="section" title="Adding a vShield instance"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec20"/>Adding a vShield instance</h3></div></div></div><p>This is a bit different than adding vCenter. After adding a vCenter instance and collecting data from it, VCM identifies the vShield VM and it makes it available on the VCM console for configuration, so we don't need to perform any additional steps as we did for vCenter; we just need to configure it, which we will do as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Licensed Machines</strong></span> | <span class="strong"><strong>Licensed Virtual Environments</strong></span>.</li><li class="listitem">Select the vShield device identified by VCM, and click on <span class="strong"><strong>Configure Settings</strong></span>.<div class="mediaobject"><img alt="Adding a vShield instance" src="graphics/image_02_003.jpg"/></div></li><li class="listitem">Make sure the vShield instance is selected in the wizard launched.</li><li class="listitem">Provide information as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Managing Agent</strong></span>: Your Collector server</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Port</strong></span>: <code class="literal">443</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>User ID</strong></span>: A user with administrative access to vShield</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Password</strong></span>: The password for the user; enter it twice to confirm it</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ignore untrusted SSL Certificate</strong></span>: <span class="strong"><strong>Yes</strong></span></li><li class="listitem" style="list-style-type: disc">Provide the name of the vCenter Server instance this vShield instance is responsible for</li></ul></div><div class="mediaobject"><img alt="Adding a vShield instance" src="graphics/image_02_004.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p><span class="strong"><strong>Note</strong></span>: The user must have a vShield Manager administrative role or an unrestricted read-only role.</p></div></div></li><li class="listitem">Click on <span class="strong"><strong>Finish </strong></span>to close the wizard.</li></ol></div><p>Once again, you should see a green circle in front of the vShield instance you just configured.</p><p>If there isn't one, make sure you have provided the correct username and password.</p></div><div class="section" title="Adding a vCloud Director instance"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec21"/>Adding a vCloud Director instance</h3></div></div></div><p>Log in to VCM server and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Licensed Machines</strong></span> | <span class="strong"><strong>Licensed Virtual Environments</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Add Machines</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Basic</strong></span> from the first page of the wizard.</li><li class="listitem">Enter your hostname in <span class="strong"><strong>Machine Name</strong></span>, select <span class="strong"><strong>Domain</strong></span> from the dropdown that the machine belongs to, select <span class="strong"><strong>DNS</strong></span> as <span class="strong"><strong>Type</strong></span> and <span class="strong"><strong>vCloud Director</strong></span> as <span class="strong"><strong>Machine Type</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Add</strong></span>, and then click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span> to end the wizard.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>With these steps, we added the vCloud instance to VCM, but we still need to configure it so that we can collect the details.</p></div></div></li><li class="listitem">Now, select the vCloud Director instance we just added and click on <span class="strong"><strong>Configure Settings</strong></span>.</li><li class="listitem">In this wizard, select the vCloud Director machine.</li><li class="listitem">Provide information as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Managing Agent</strong></span>: Your Collector server</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Port</strong></span>: <code class="literal">443</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>User ID</strong></span>: A user with administrative access to vCloud Director</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Local user in the format <code class="literal">user@System</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Password</strong></span>: The password for the user; enter it again to confirm it</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ignore untrusted SSL Certificate</strong></span>: <span class="strong"><strong>Yes</strong></span></li></ul></div><div class="mediaobject"><img alt="Adding a vCloud Director instance" src="graphics/image_02_005.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Finish</strong></span> to close the wizard.</li><li class="listitem">There should be a green circle in front of the vCloud Director instance's name on the VCM console.</li></ol></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>How it works...</h2></div></div></div><p>We make information available in the vShield instance, that is, security groups and its members exposed to VCM. The details are stored in the VCM database as well and can be used when required.</p><p>After adding and performing a collection, we have the following information from the vCloud Director database in the VCM console:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">vCloud Director Organizations</li><li class="listitem" style="list-style-type: disc">vCloud Director virtual machines and vApps</li><li class="listitem" style="list-style-type: disc">vCloud Director organization catalogs</li><li class="listitem" style="list-style-type: disc">vCloud Director Virtual datacenters (vDCs) and networks</li><li class="listitem" style="list-style-type: disc">vCloud Director Organizations Users</li><li class="listitem" style="list-style-type: disc">vCloud Director Organizations Groups</li><li class="listitem" style="list-style-type: disc">vCloud Director Organizations Settings</li></ul></div><p>This information can be used to create machine groups based on vCloud organizations in order to manage them accordingly.</p></div></div>
<div class="section" title="Collecting data from managed machines"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Collecting data from managed machines</h1></div></div></div><p>Once we are done adding and configuring virtual environments, we can start collecting data, which can be further used to check compliance, create necessary machine groups, export reports, and so on.</p><p>We need to collect data from virtual environments as well as from all the machines that we plan to manage, that is, Windows or Linux servers.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>Getting ready</h2></div></div></div><p>All the servers we want to manage should be added to the VCM console, either by following earlier recipes for virtual infrastructures or by installing agents by following the recipes in this chapter.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How to do it...</h2></div></div></div><p>We will split this recipe into two sections:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Collecting data from virtual infrastructures</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Collecting data from managed machines</em></span></li></ul></div><div class="section" title="Collecting data from virtual infrastructures"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec22"/>Collecting data from virtual infrastructures</h3></div></div></div><p>To collect all data off a vCenter, vShield Manager, or vCD instance, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to VCM and follow the steps to collect virtual infrastructure data.</li><li class="listitem">You can be anywhere in the VCM console; make sure the machine group is <span class="strong"><strong>All Machines</strong></span> (to understand more about machine groups, have a look at the <span class="emphasis"><em>Creating machine groups</em></span> recipe), and click on <span class="strong"><strong>Collect</strong></span> in the top-left corner.</li><li class="listitem">This will launch a wizard; select <span class="strong"><strong>Machine Data</strong></span> under <span class="strong"><strong>Collection Type</strong></span>.</li><li class="listitem">Select the machines you want to collect data from, in this case, any or all of vCenter, vShield, and vCloud servers. Select them and make sure they are on the right-hand side, and then click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Select Data Types</strong></span> to collect from these machines.<div class="mediaobject"><img alt="Collecting data from virtual infrastructures" src="graphics/image_02_006.jpg"/></div></li><li class="listitem">Under <span class="strong"><strong>Data Types</strong></span>, tick each checkbox underneath <span class="strong"><strong>Virtualization</strong></span>:<div class="mediaobject"><img alt="Collecting data from virtual infrastructures" src="graphics/image_02_007.jpg"/></div></li><li class="listitem">Make sure there are no conflicts, and click on <span class="strong"><strong>Finish</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Jobs</strong></span> in the left-hand corner of the VCM console.</li><li class="listitem">Make sure the job to collect the data has completed successfully.</li></ol></div></div><div class="section" title="Collecting data from managed machines"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec23"/>Collecting data from managed machines</h3></div></div></div><p>In this subsection, we will collect data from managed machines, such as Windows and Linux servers. Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to VCM and follow the steps to collect virtual infrastructure data.</li><li class="listitem">You can be anywhere in the VCM console; make sure the machine group is <span class="strong"><strong>All Machines</strong></span> (to understand more about machine groups, have a look at the <span class="emphasis"><em>Creating machine groups</em></span> recipe) and click on <span class="strong"><strong>Collect</strong></span> in the top-left corner.</li><li class="listitem">This will launch a wizard; select <span class="strong"><strong>Machine Data</strong></span> under <span class="strong"><strong>Collection Type</strong></span>.</li><li class="listitem">On the next page, select the machine/machines whose data you want to collect. The machines must be on the right-hand side.</li><li class="listitem">You have two options for deciding how data will be collected: based on the data type or based on the collection filter set.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p><span class="strong"><strong>Note</strong></span>: If you select data type then you are presented with options to select from various entities of the OS such as accounts, account policies, disk space, device drives, and so on that are relevant to the OS of the machine we selected.
If you select filter sets, VCM has precreated sets of filters, which can be used to collect data from the managed machine. The filter sets can be created manually, while installing VCM, or when you import any compliance template.</p></div></div><div class="mediaobject"><img alt="Collecting data from managed machines" src="graphics/image_02_008.jpg"/></div></li><li class="listitem">Depending upon what you select, the next page will differ.</li><li class="listitem">For the <span class="strong"><strong>Data Types</strong></span> window, select individual data types or select all of them.<div class="mediaobject"><img alt="Collecting data from managed machines" src="graphics/image_02_009.jpg"/></div></li><li class="listitem">For the <span class="strong"><strong>Filter Sets</strong></span> window, select the appropriate filter set to collect the data.<div class="mediaobject"><img alt="Collecting data from managed machines" src="graphics/image_02_010.jpg"/></div></li><li class="listitem">Make sure there are no conflicts, and close the wizard. It will start a collection job, and VCM will go to the specified machines and collect details either according to data types or selected filter sets.</li></ol></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>How it works...</h2></div></div></div><p>In the previous recipes, we added vCenter, vCD, and vShield Manager; now, we need the data to import into all those elements. By performing a collection, we are adding the details available on those systems to VCM so that we can have a single interface where we can see all the details.</p><p>The details fetched from those systems have been mentioned in the earlier recipes. When VCM performs a collection operation, it goes into each application's database, pulls all the relevant information, and then places it in its own database. For example, when we perform a vCenter collection, it collects details about all the VMs, ESXi hosts, their versions, snapshot details for VMs, VM configuration, and so on. All the data is presented in the VCM console under <span class="strong"><strong>Console</strong></span> | <span class="strong"><strong>Virtual Environments</strong></span>.</p><p>In case of vCD, VCM fetches information about the vApps, VMs, catalogs, local users, groups, and so on.</p><p>This information can then be exported via reports, used for compliance checks. This can also be used in creating dynamic filters for creating machine groups.</p><p>Details captured from managed machines such as Windows and Linux servers will be used in analyzing their current compliance and patch status.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>There's more...</h2></div></div></div><p>Have a look at the following article by VMware if you want details about filter sets:</p><p><a class="ulink" href="https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminSettingsCollFltr.htm">https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminSettingsCollFltr.htm</a></p></div></div>
<div class="section" title="Adding a discovery rule"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Adding a discovery rule</h1></div></div></div><p>VCM must discover machines in your environment before you can collect data from them. You can create a <span class="strong"><strong>discovery rule</strong></span> to discover all machines, or you can apply a filter to limit the machines that VCM discovers. Discovery rules are used to discover managed machines automatically.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>Getting ready</h2></div></div></div><p>You must have configured and collected data from vCenter and vCloud to add a database discovery rule.</p><p>You must license the virtual environments and Windows, Unix, and Linux machines to use for data collection. When you license these virtual or physical machines, they appear in the <span class="strong"><strong>Licensed Machines</strong></span> list.</p><p>VCM can discover machines from Active Directory, browse lists, domain controllers, databases, or by IP address.</p><p>We will perform database discovery in this recipe; you can check remaining options in your lab.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>How to do it...</h2></div></div></div><p>We will configure VCM to discover vCenter VMs by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to VCM as an administrative user.</li><li class="listitem">Go to <span class="strong"><strong>Administrator</strong></span> | <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Discovery Rule</strong></span>; click on the green plus button to add a new discovery rule.</li><li class="listitem">This will launch a wizard; provide a name and description.</li><li class="listitem">Select the <span class="strong"><strong>By DB Discovery:</strong></span> checkbox.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_011.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>vCenter Guest Systems</strong></span> under <span class="strong"><strong>Discovery Query</strong></span>.</li><li class="listitem">The other two options are using vCloud Director or directly from the host.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_012.jpg"/></div></li><li class="listitem">On the next page, select/fill in options according to this table:<div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Option</strong></span></p>
</td><td>
<p><span class="strong"><strong>Description</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>Machine Name Format</strong></span></p>
</td><td>
<p>The format for VCM to display guest machines. You can select the <span class="strong"><strong>NetBIOS</strong></span>, <span class="strong"><strong>DNS</strong></span>, or <span class="strong"><strong>VM/vCenter</strong></span> name format.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Domain Name</strong></span></p>
</td><td>
<p>The domain under which to add the new machine. This domain is the same as the <span class="strong"><strong>Domain Name</strong></span> property when you add machines using manual discovery.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Domain Type</strong></span></p>
</td><td>
<p>Select one out of <span class="strong"><strong>Active Directory</strong></span>, <span class="strong"><strong>DNS</strong></span>, or <span class="strong"><strong>NetBIOS</strong></span> domain types.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Protocol</strong></span></p>
</td><td>
<p>Select <span class="strong"><strong>DCOM</strong></span> or <span class="strong"><strong>HTTP</strong></span>.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>HTTP Port (default used if blank)</strong></span></p>
</td><td>
<p>This uses the HTTP listener on the target machine. The listener is configured to listen on the designated port. Port <code class="literal">26542</code> is the default setting. Accepted port values range from <code class="literal">1</code> to <code class="literal">65535</code>. Other applications must not use this port.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Use a proxy server</strong></span></p>
</td><td>
<p><span class="strong"><strong>No</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>Connection String</strong></span></p>
</td><td>
<p>This is the address of the virtual machine to contact. This address can differ from the address that resolves by machine name from DNS or other name-resolution systems. Use this address when VCM must contact a vApp virtual machine through a Network Address Translation (<span class="strong"><strong>NAT</strong></span>) address.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>ESX Host Name Filter</strong></span></p>
</td><td>
<p>This filters the query to ESX host machine names in the virtual environment based on the information you type.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>VM Guest Name Filter</strong></span></p>
</td><td>
<p>This filters the query to guest VM names on the ESX host machine in the virtual environment based on the information you type.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Guest DNS Name Filter</strong></span></p>
</td><td>
<p>This filters the query to domain name servers based on the information you type.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Guest OS Name Filter</strong></span></p>
</td><td>
<p>This filters the query to the guest operating systems in the virtual environment based on the information you type.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>Power State</strong></span></p>
</td><td>
<p>This filters the query to the state of the guest virtual machine in the virtual environment based on the information you type.</p>
</td></tr></tbody></table></div><p>After you make appropriate selections as described in the table, your screen should look like this:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_013.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>Yes</strong></span> to start the discovery once the rule creation is over, and if you want, you can select <span class="strong"><strong>License</strong></span> and install <span class="strong"><strong>Agent</strong></span> on <span class="strong"><strong>Discovered Machines</strong></span>.</li><li class="listitem">Click <span class="strong"><strong>Finish</strong></span> to close the wizard.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>How it works...</h2></div></div></div><p>As this is a query run against the VCM database, we must perform a collection against at least one vCenter Server before we run this discovery rule.</p><p>VCM adds the machines either to the available machines in the machine manager if you choose not to license the machine; and if you choose to license it as part of the discovery rule, then they go to either licensed Windows or Unix machines.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>There's more...</h2></div></div></div><p>This is the table describing all the available methods taken from the VCM help document on <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. No.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Method</strong></span></p>
</td><td>
<p><span class="strong"><strong>Description</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p><span class="strong"><strong>By Active Directory</strong></span></p>
</td><td>
<p>This discovers all the machines that have an account on the selected AD domain. The discovery process identifies machines based on the current domain controller data.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p><span class="strong"><strong>By Browse List</strong></span></p>
</td><td>
<p>This discovers all the machines that have the <span class="strong"><strong>Computer Browser</strong></span> service turned on. When the rule discovers machines through the browse list, VCM returns the NetBIOS domain name for each machine.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p><span class="strong"><strong>By Domain Controller</strong></span></p>
</td><td>
<p>This discovers all the machines that have an account on the selected domain. When the domain controller performs a periodic update, existing machines might not appear, while deleted machines might.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>4</strong></span></p>
</td><td>
<p><span class="strong"><strong>By IP Address</strong></span></p>
</td><td>
<p>This discovers all the machines in your network that exist in specific IP address ranges. Discovered machines appear in the list of available machines.</p>
</td></tr><tr><td>
<p><span class="strong"><strong>5</strong></span></p>
</td><td>
<p><span class="strong"><strong>By DB Discovery</strong></span></p>
</td><td>
<p>This discovers machines based on the SQL query used for the discovery rule. This discovery type uses data that VCM has already collected from other sources as the basis for finding new systems to manage. You can discover vCD-managed virtual machines, virtual machine guests, and virtual machine hosts.</p>
</td></tr></tbody></table></div><p>Refer here for more:</p><p><a class="ulink" href="https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminMachMngrDiscAECWiz.htm">https://www.vmware.com/support/vcm/doc/help/vcm581/Content/Core_CS/AdminMachMngrDiscAECWiz.htm</a></p></div></div>
<div class="section" title="Adding a network authority account to manage machines in multiple domains"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Adding a network authority account to manage machines in multiple domains</h1></div></div></div><p>For medium to large infrastructures, there are always multiple Active Directory domains available. We can use VCM to manage servers in multiple domains. This recipe explains what you need to do for that.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>Getting ready</h2></div></div></div><p>There should be a proper name resolution. If there is a firewall in between, then the ports stated in the first chapter must be open.</p><p>We need a <span class="strong"><strong>network authority account</strong></span> per domain in order to manage the machines in that domain and VCM functions such as collecting data, patching, and so on.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec51"/>How to do it...</h2></div></div></div><p>We need to add the domains and network authority account and finally associate them with one another.</p><p>Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Network Authority</strong></span></p><p>We have three options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Available Domains</strong></span> (identified while performing the installation); we can add new ones if required</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Available Accounts</strong></span> (we assigned one NAA while performing VCM deployment)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Assigned Accounts</strong></span></li></ul></div><div class="section" title="Available Domains"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec24"/>Available Domains</h3></div></div></div><p>Domains are identified in one of the steps when we perform the VCM server installation; now, we can add extra domains. Click on <span class="strong"><strong>Add</strong></span> under <span class="strong"><strong>Available Domains</strong></span>, and provide the domain <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>Type</strong></span>.</p><div class="mediaobject"><img alt="Available Domains" src="graphics/image_02_014.jpg"/></div></div><div class="section" title="Available Accounts"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec25"/>Available Accounts</h3></div></div></div><p>Under <span class="strong"><strong>Available Accounts</strong></span>, we can see which network authority accounts are available and then add any extra accounts or remove unwanted ones.</p><div class="mediaobject"><img alt="Available Accounts" src="graphics/image_02_015.jpg"/></div></div><div class="section" title="Assigned Accounts"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec26"/>Assigned Accounts</h3></div></div></div><p>This is the place where we associate available accounts with available domains.</p><p>Go to <span class="strong"><strong>Assigned Accounts</strong></span> | <span class="strong"><strong>By Domain</strong></span> | <span class="strong"><strong>Active Directory</strong></span>, and then click on <span class="strong"><strong>Edit Assigned Accounts</strong></span> and associate the available accounts with this domain.</p><div class="mediaobject"><img alt="Assigned Accounts" src="graphics/image_02_016.jpg"/></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec52"/>How it works...</h2></div></div></div><p>Basically, by following this process, we assigned an account that has local admin privileges or the rights explained in the first chapter to all the machines in the respective domain that will be managed by VCM.</p><p>We can assign as many accounts as required. When a VCM function is started, assigned accounts will be tried in the specified order. When something starts a subsequent time, the last successfully used account will be used first. Accounts are listed in the order in which they are assigned, from top to bottom.</p><p>If a machine is in multiple lists (such as a domain and a machine group), the authority account that will be used to contact it will be in the following order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The last account that worked</li><li class="listitem" style="list-style-type: disc">The accounts assigned to the domain</li><li class="listitem" style="list-style-type: disc">The accounts assigned any machine group (including the default <span class="strong"><strong>All Machines</strong></span> group) to which the machine belongs</li></ul></div><p>We need to do this for Windows only, as in the case of Linux, we need to accept the certificate in the VCM console. Unless we accept the certificate, we will not be able to patch the Linux machine from VCM. To accept the certificate, on the VCM console, go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Certificates</strong></span>, select the machine, and click on <span class="strong"><strong>Change Trust Status</strong></span>. Follow the wizard, and you will see a handshake symbol in front of the machine. This will allow you to patch the Linux machine from the VCM console. The steps to perform this action are a part of the next recipe.</p></div></div>
<div class="section" title="Configuring a managing agent machine for virtual environment management"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Configuring a managing agent machine for virtual environment management</h1></div></div></div><p>Managing agents are systems that manage the communication between the collector and the virtual environment we manage via VCM, that is, vCenter Server, vCD, and vShield Manager. In this recipe, we will assign a system the role of a management agent.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec53"/>Getting ready</h2></div></div></div><p>We need to have the version 5.5 or later agent installed on the machine and data collected from it, which will be designated as the managing agent. Refer to the next recipe.</p><p>The managing agent machines must have the version 5.5 or later agent installed.</p><p>We can designate any server that can communicate with VCM as well as vCD, vShield, and vCenter Server as a managing agent.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec54"/>How to do it...</h2></div></div></div><p>Log in to VCM and follow these steps to designate a managing agent and then change it to a managed virtual environment:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Certificates</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_017.jpg"/></div></li><li class="listitem">Select the machine that you want to designate as a managing agent.</li><li class="listitem">Select <span class="strong"><strong>Change Trust Status</strong></span>.</li><li class="listitem">Check to trust or uncheck to untrust the selected machines box, click on <span class="strong"><strong>Next</strong></span>, and click on <span class="strong"><strong>Finish</strong></span> on the next page to complete the wizard.</li><li class="listitem">Select the machine again and click on <span class="strong"><strong>Managing Agent</strong></span> in the top menu.</li><li class="listitem">Select <span class="strong"><strong>Enable</strong></span>, click on <span class="strong"><strong>Next</strong></span>, and then click on <span class="strong"><strong>Finish</strong></span> on the next page to complete the wizard.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p><span class="strong"><strong>Note</strong></span>: The choice of managing agent solely depends on the size of the infrastructure you manage; you can use your collector as a managing agent, or you can use another Windows machine. If your individual vCenter instance manages between 1 to 30 hosts and a maximum of 1,000 guests, then you can use the collector as your managing agent. Otherwise, designate a dedicated managing agent.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_018.jpg"/></div></li><li class="listitem">The selected server will become the managing agent now.</li><li class="listitem">Once the managing agent has been designated, we can change it for the managed virtual environment.</li><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Licensed Machines</strong></span> | <span class="strong"><strong>Licensed Virtual Environments</strong></span>. Select the machine whose managing agent you want to change, and click on <span class="strong"><strong>Configure Settings</strong></span>.</li><li class="listitem">Select the machine added if required.</li><li class="listitem">On the top, there is a dropdown to select either of the available managing agents. Change to a new one and click on <span class="strong"><strong>Next</strong></span> (not visible in the screenshot), and click on <span class="strong"><strong>Finish</strong></span> on next page to close the wizard.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_019.jpg"/></div></li><li class="listitem">Repeat steps 8 through 10 for the remaining virtual environments in the infrastructure.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec55"/>How it works...</h2></div></div></div><p>The managing agents are systems that manage the communication between the collector and the virtual environment using the VMware APIs of the various products. They must be configured to manage secure communication between virtual environment instances and the collector.</p><p>It is recommended that VCM collector act as the managing agent if any of the vCenter instances it is managing has 1 to 30 hosts and upto 1,000 guests. The default managing agent is the Collector server, but as the workload increases, we can start adding them. In this recipe, we looked at designating a managed machine to a managed agent.</p><p>We are designating another server to communicate with the virtual environment so that some of the work can be offloaded from VCM Collector. The server must have connectivity to the virtual environment servers and VCM Collector.</p></div></div>
<div class="section" title="Installing an agent on Windows servers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Installing an agent on Windows servers</h1></div></div></div><p>Before we start managing any machine, we need to install an agent on it. This can be done in multiple ways, such as pushing it from the VCM console, installing it manually, or installing it with a script.</p><p>In this recipe, we will have a look at installing the agent manually and with a script on a Windows server.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec56"/>Getting ready</h2></div></div></div><p>Prepare a server to install the agent; the installer is available on the VCM Collector server, at <code class="literal">X:\Program Files (x86)\Vmware\VCM\AgentFiles</code> and the certificate is available at <code class="literal">X:\Program Files (x86)\Vmware\VCM\CollectorData</code>, where <code class="literal">X</code> is the drive where VCM is installed.</p><p>Copy the installer and certificate on a shared location from where it can be copied to the server where we want to install it.</p><p>We need administrative access on the server where we will be installing the agent.</p><p>The local firewall should be disabled (not recommended) or port <code class="literal">26542</code> must be open between the managed machine and VCM Collector.</p><p>For an agent push, we need the machines to be registered as licensed machines on the VCM console and the network authority account to be a part of the local administrators group, and port <code class="literal">26542</code> should be open on the machine where we are pushing the agent.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec57"/>How to do it...</h2></div></div></div><p>We will split this recipe into three sections, as follows</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Manual agent installation</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Agent push from the console</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Licensing Windows machines</em></span></li></ul></div><div class="section" title="Manual agent installation"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec27"/>Manual agent installation</h3></div></div></div><p>Log in to the server with an administrative account, copy the installer with a certificate locally, and follow this process:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start <code class="literal">VCMAgentInstall.exe</code>.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span>, again on <span class="strong"><strong>Next</strong></span>, and on the destination location screen, continue with the default <code class="literal">C:\Windows\CMAgent</code> value.</li><li class="listitem">Select <span class="strong"><strong>Allow HTTP</strong></span>, and go with the default port, <code class="literal">26542</code>.</li><li class="listitem">On this page, browse to the location where the certificate is copied.</li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> three more times, and it will start installing the agent.</li><li class="listitem">Once the agent has been installed, log in to VCM console.</li><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Licensed Machines</strong></span> | <span class="strong"><strong>Licensed Windows Machines</strong></span>, and click on <span class="strong"><strong>Add Machine</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Basic</strong></span> and select automatically license machines.</li><li class="listitem">Provide details about the machine where you installed the agent, as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Provide the hostname for the <span class="strong"><strong>Machine Name</strong></span> parameter</li><li class="listitem" style="list-style-type: disc">Select the domain from the dropdown which the machine belongs to</li><li class="listitem" style="list-style-type: disc">Select <span class="strong"><strong>DNS</strong></span> as <span class="strong"><strong>Type</strong></span></li><li class="listitem" style="list-style-type: disc">Select <span class="strong"><strong>Windows Server</strong></span> as <span class="strong"><strong>Machine Type</strong></span></li></ul></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> and then on <span class="strong"><strong>Finish</strong></span> to close the wizard.</li><li class="listitem">Once the machine has been added to VCM, we need to hit the R<span class="strong"><strong>efresh</strong></span> button on the console and click on <span class="strong"><strong>Collect</strong></span> to start data collection.</li><li class="listitem">Monitor the data collection job, and finally, we are done with adding a machine to VCM.</li></ol></div></div><div class="section" title="Agent push from the console"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec28"/>Agent push from the console</h3></div></div></div><p>The machine should be in the VCM console either by running a discovery rule or adding it manually. Now, we can perform a push of the agent from the console.</p><p>Log in to the VCM console and follow these steps to install the agent on the machine:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Licensed Machines</strong></span> | <span class="strong"><strong>Licensed Windows Machines</strong></span>, and select the machine which you want to add the agent to.</li><li class="listitem">Click on <span class="strong"><strong>Install</strong></span> in the menu.<div class="mediaobject"><img alt="Agent push from the console" src="graphics/image_02_020.jpg"/></div></li><li class="listitem">The wizard will open. Make sure the machine appears in the <span class="strong"><strong>Selected</strong></span> box.</li><li class="listitem">On the next page, set the following values:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Install At:</strong></span> Keep this default.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Install From:</strong></span> Keep this default.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Options:</strong></span> Select <span class="strong"><strong>HTTP</strong></span> and set the port to <code class="literal">26542</code>. Keep the rest default.</li></ul></div><div class="mediaobject"><img alt="Agent push from the console" src="graphics/image_02_021.jpg"/></div></li><li class="listitem">On the schedule screen, select <span class="strong"><strong>Run Now</strong></span>.</li><li class="listitem">Confirm the selection and click on <span class="strong"><strong>Finish</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Jobs</strong></span> to see whether the job is successful, and after that, go back to the console, scroll to the right, and check whether the machine has its agent state changed from <span class="strong"><strong>Unknown</strong></span> to <span class="strong"><strong>Current Agent</strong></span> and shows its agent version as <span class="strong"><strong>5.8.2</strong></span>.</li><li class="listitem">Once the machine has its agent installed, perform an initial collection.</li></ol></div></div><div class="section" title="Licensing Windows machines"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec29"/>Licensing Windows machines</h3></div></div></div><p>We will perform the following steps to license a managed machine. The steps are the same for Windows and Linux/Unix machines.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the VCM console with an admin account.</li><li class="listitem">Click on <span class="strong"><strong>Administration</strong></span>.</li><li class="listitem">Go to <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Available Machines</strong></span>.</li><li class="listitem">Select the Windows machines to license.</li><li class="listitem">Click on <span class="strong"><strong>License</strong></span>.</li></ol></div><p>Follow the wizard to finish licensing the machine, and if the available number is below zero and in red, contact VMware to purchase more licenses.</p></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec58"/>How it works...</h2></div></div></div><p>With this recipe, we are making sure that the machine we want to manage has an agent installed, is licensed in VCM, and that we have performed the data collection.</p><p>VCM has enough information about managed machines to start deploying software; put the machine in the correct machine group. We can perform further specific collections to find out the compliance status or patching status, and based on that, we can fix the machine or install missing patches.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec59"/>There's more...</h2></div></div></div><p>We can install the agent with a script.</p><p>Here is the code for the script:</p><pre class="programlisting">
<span class="strong"><strong>cd C:\VCM_Agent &#13;
CMAgentInstall.exe /s INSTALLPATH=C:\Windows\CMAgent PORT=26542 CERT=C:\VCM_Agent\VMware_VCM_Enterprise_Certificate_E5D8927D-A9A7-43E8-8E6F-5C88D1E40F12.pem &#13;
</strong></span>
</pre><p>Here is what the options stand for:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Sr. No.</strong></span></p>
</td><td>
<p><span class="strong"><strong>Option</strong></span></p>
</td><td>
<p><span class="strong"><strong>Description</strong></span></p>
</td></tr><tr><td>
<p><span class="strong"><strong>1</strong></span></p>
</td><td>
<p><code class="literal">C:\VCM_Agent</code></p>
</td><td>
<p>The location where the BAT file, installer, and certificate are copied</p>
</td></tr><tr><td>
<p><span class="strong"><strong>2</strong></span></p>
</td><td>
<p><code class="literal">CMAgentInstall.exe</code></p>
</td><td>
<p>The VCM agent installer</p>
</td></tr><tr><td>
<p><span class="strong"><strong>3</strong></span></p>
</td><td>
<p><code class="literal">/s</code></p>
</td><td>
<p>Option for a silent installation</p>
</td></tr><tr><td>
<p><span class="strong"><strong>4</strong></span></p>
</td><td>
<p><code class="literal">INSTALLPATH</code></p>
</td><td>
<p>The location to install the VCM agent on the server</p>
</td></tr><tr><td>
<p><span class="strong"><strong>5</strong></span></p>
</td><td>
<p><code class="literal">PORT</code></p>
</td><td>
<p>The port for the VCM agent to communicate</p>
</td></tr><tr><td>
<p><span class="strong"><strong>6</strong></span></p>
</td><td>
<p><code class="literal">CERT</code></p>
</td><td>
<p>The VCM Enterprise certificate path</p>
</td></tr></tbody></table></div><p>Just run the batch file and then follow steps 6 to 11 to complete the agent installation.</p><p>You can also use the <code class="literal">PowerCLI</code> commands <code class="literal">Copy.VMGuestFile</code> and <code class="literal">Invoke-VMSCript</code> to automate the deployment.</p></div></div>
<div class="section" title="Installing an agent on Linux servers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Installing an agent on Linux servers</h1></div></div></div><p>We need an agent to manage Linux/Unix machines; in this recipe, we will install it manually on a Linux machine.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec60"/>Getting ready</h2></div></div></div><p>In case of a Linux installer, make sure that it is copied from the same VCM server where the managed machine will get managed, as VCM certificates are embedded in the installer. If we use an installer from another VCM server and then try to manage it from a different server, it will fail.</p><p>Copy the correct installer from the VCM server to the Linux server.</p><p>Install the prerequisites and verify that the <code class="literal">glibc.i686</code>, <code class="literal">net-tools</code>, and <code class="literal">redhat-lsb-core</code> packages have been installed on the target machine.</p><p>Open port <code class="literal">26542</code> if a firewall is enabled.</p><p>We need the root password of the machine where the agent will be installed.</p><p>The agent is available at <code class="literal">X: \Program Files (x86)\VMware\VCM\Installer\Packages\CMAgent.5.8.2.linux
</code> on the VCM Collector server. We don't need to copy the certificate the way we did in Windows as the certificate is built into the installer.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec61"/>How to do it...</h2></div></div></div><p>Follow the steps to install the agent on a Linux machine:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy the installer with <code class="literal">scp</code> or <code class="literal">winscp</code> on the server.</li><li class="listitem">Log in to the Linux server as root.</li><li class="listitem">Run <code class="literal">chmod u+x CMAgent.5.8.2.linux</code>.</li><li class="listitem">Run <code class="literal">
./CMAgent.5.8.2.linux
</code>.</li><li class="listitem">Copy the modified and <code class="literal">savedcsi.config
</code> file to the extracted location.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>
<span class="strong"><strong>Note:</strong></span>
<code class="literal">csi.config</code>
 is a configuration file used by the VCM agent to install the agent.</p><p>
</p><p>More details about the configuration options can be found at <a class="ulink" href="https://www.vmware.com/support/vcm/doc/help/vcm581/Content/NIX/CM_Ref_UNIX_csi_config_options.htm">https://www.vmware.com/support/vcm/doc/help/vcm581/Content/NIX/CM_Ref_UNIX_csi_config_options.htm</a>.There are lots of options available to configure the <code class="literal">csi.config</code> file.</p><p>
</p><p>We need to set <code class="literal">CSI_AGENT_RUN_OPTION = daemon</code> to start this as a daemon; for the rest, you can consult with your Linux admin and decide.</p></div></div><p>An example: <code class="literal">
# cp /&lt;Shared_location&gt; csi.config /&lt;extractedlocation&gt;/CSIInstall/csi.config
</code>.</p></li><li class="listitem">Once this is done, run the installer script using <code class="literal">./CSIInstall/InstallCMAgent -s</code>.<p>Once the agent has been installed, follow the previous recipe from step 6 onward; just change the location from 
<span class="strong"><strong>Licensed Windows Machines</strong></span> to <span class="strong"><strong>Licensed UNIX Machines</strong></span>, and when entering details, set <span class="strong"><strong>Machine Type</strong></span> as <span class="strong"><strong>Red Hat Server</strong></span> or any other, depending upon the OS and as per the following screenshot:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_022.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec62"/>How it works...</h2></div></div></div><p>We added the agent to the Linux/Unix machines as well so that we can collect the details of the managed machines; then, those details will be used to check compliance and patch status.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec63"/>There's more...</h2></div></div></div><p>We can create a preconfigured <code class="literal">csi-config</code> file and copy it to <code class="literal">/opt/CMAgent</code> along with the installer.</p><p>Copy the content of the following script into a <code class="literal">.sh</code> file.</p><p>Give it execute permission: <code class="literal">chmod CMAgentInstall.sh 755</code>.</p><p>Then, run the <code class="literal">./CMAgentInstall.sh</code> command.</p><pre class="programlisting">
<span class="strong"><strong>IPTABLES="/sbin/iptables" &#13;
grep -i suse /etc/issue &gt;/dev/null || rc=$? &#13;
if [ $rc -ne 0 ]; then &#13;
  IPTABLES="/usr/sbin/iptables" &#13;
fi &#13;
 &#13;
${IPTABLES}-save &gt; /opt/APPL/iptables.CMAgent.preinstall &#13;
${IPTABLES} -I INPUT -m state --state NEW -p tcp --dport 26542 -j ACCEPT &#13;
 &#13;
grep -i suse /etc/issue &gt;/dev/null || rc=$? &#13;
if [ $rc -ne 0 ]; then &#13;
  /sbin/SuSEfirewall2 open EXT TCP 26542 &#13;
else &#13;
  grep -i maipo /etc/redhat-release &gt;/dev/null || rc=$? &#13;
  if [ $rc -ne 0 ]; then &#13;
    /sbin/firewall-cmd --zone=public --add-port=26542/tcp --permanent &#13;
  else &#13;
    /sbin/service iptables save &#13;
  fi &#13;
fi &#13;
 &#13;
cd /opt; /opt/APPL/CMAgent.5.8.2.Linux &#13;
cp /opt/CMAgent/csi.config.CMAgent /opt/CSIInstall/csi.config &#13;
/opt/CSIInstall/InstallCMAgent -s &#13;
</strong></span>
</pre><p>The script identifies the OS of the machine and, based on that, opens port <code class="literal">26542</code> on the local firewall. Then, it copies the preconfigured <code class="literal">csi.config</code> file and, finally, installs the agent from the <code class="literal">/opt/CSIInstall</code> folder.</p></div></div>
<div class="section" title="Creating machine groups"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Creating machine groups</h1></div></div></div><p>Machine/virtual object groups are used to organize managed machines and virtual objects into small logical groups. There are default groups available from VCM when it is deployed (more details are in the <span class="emphasis"><em>There's More...</em></span> section).</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec64"/>Getting ready</h2></div></div></div><p>As an administrator, you must have some idea of which machine you should put together. You can use this concept and create machine groups as per your requirement.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec65"/>How to do it...</h2></div></div></div><p>Once you have a basic understanding of what you want to achieve with the group, log in to the VCM console and follow the steps detailed shortly.</p><p>We will create a machine group that will include all the machines that are a part of the <code class="literal">Study.local</code> Active Directory group, and it will keep on adding machines as soon as a new machine is added to VCM from the same domain.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Machine/Virtual Object Group</strong></span> | <span class="strong"><strong>All Machines</strong></span> and click on <span class="strong"><strong>Add Group</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_023.jpg"/></div></li><li class="listitem">Provide a name and proper description, and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Membership Type</strong></span> as <span class="strong"><strong>Dynamic</strong></span> or <span class="strong"><strong>Static</strong></span>.</li><li class="listitem">In our case, we are going ahead with <span class="strong"><strong>Dynamic</strong></span>, so click on <span class="strong"><strong>Finish</strong></span> on the next page to complete the wizard.</li><li class="listitem">Follow step 1 again, but this time, go to the machine group we just created. Click on the group and then click on <span class="strong"><strong>Filters</strong></span>. This is where we will define the criteria to add machines to this group.</li><li class="listitem">Under <span class="strong"><strong>Filters</strong></span>, click on <span class="strong"><strong>Add Filter</strong></span>.</li><li class="listitem">Provide a meaningful name and description, and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Now, all the details we collected from vCenter, vCloud, and all the managed machines are available here to filter.</li><li class="listitem">Your imagination is the limit for creating filters, and you can use all the information you can gather from VCM. In our case, we have selected Machines as the data type; this is where your experience and expectations will meet together to make the exact machine group you want.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_024.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>Basic</strong></span> under <span class="strong"><strong>Rule Type</strong></span>.</li><li class="listitem">Now, add your condition, such as <span class="strong"><strong>Domain Name</strong></span><span class="strong"><strong>=</strong></span><code class="literal">'STUDY'</code>.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_025.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span>, and then click on <span class="strong"><strong>Finish</strong></span> to close the wizard.</li><li class="listitem">Now, go to the machine group, and a refresh will give you all the machines that are a part of the <code class="literal">STUDY</code> domain.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_02_026.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec66"/>How it works...</h2></div></div></div><p>When you work with managed machines, you can create static groups, where members are selected manually, or dynamic groups, where filters dynamically determine membership. Machines can belong to multiple groups.</p><p>You set the active machine group on the main toolbar, and you can define a machine filter with the options to the right of the textbox, as shown in this screenshot. A machine group filter further limits the selected machine group.</p><div class="mediaobject"><img alt="How it works..." src="graphics/image_02_027.jpg"/></div><p>In all nodes except those in the <span class="strong"><strong>Administration</strong></span> slider, an active machine group limits the displayed data to the managed machines defined in the selected machine group.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec67"/>There's more...</h2></div></div></div><p>This is the list of default groups created with an installation of VCM:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p><span class="strong"><strong>Name </strong></span></p>
</td><td>
<p><span class="strong"><strong>Description </strong></span></p>
</td></tr><tr><td>
<p>All machines</p>
</td><td>
<p>All the licensed machines in VCM</p>
</td></tr><tr><td>
<p>AD auto-created</p>
</td><td>
<p>Active Directory auto-created machine groups</p>
</td></tr><tr><td>
<p>All Unix machines</p>
</td><td>
<p>All Unix machines</p>
</td></tr><tr><td>
<p>All VM guest machines</p>
</td><td>
<p>All managed VM guests from managed vCenter, vCloud, and vShield environments</p>
</td></tr><tr><td>
<p>All VM guest Unix machines</p>
</td><td>
<p>All VM guest Unix machines</p>
</td></tr><tr><td>
<p>All VM guest Windows machines</p>
</td><td>
<p>All VM guest Windows machines</p>
</td></tr><tr><td>
<p>All VM host machines</p>
</td><td>
<p>All VM host machines</p>
</td></tr><tr><td>
<p>All Windows machines</p>
</td><td>
<p>All Windows machines</p>
</td></tr></tbody></table></div><div class="section" title="Dynamic groups"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec30"/>Dynamic groups</h3></div></div></div><p>In dynamic groups, we define single or multiple filters, and based on the filters, the group is populated. If we are defining multiple filters, then a logical <code class="literal">AND</code> operation is performed on them.</p><p>Your imagination is the limit, considering the amount of data you have in VCM and all that of it is available to play with while creating filters for groups.</p></div><div class="section" title="Static groups"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec31"/>Static groups</h3></div></div></div><p>In static groups, we define the members when we create the group, and then, we need to update them as and when required. There are no filters associated with them.</p><p>The best use case is creating a static group for all the vCenter Server instances, as we won't be adding members on a daily basis, and if we add anyone, we can add them manually.</p></div></div></div></body></html>