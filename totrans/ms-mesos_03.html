<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Getting Started with Mesos"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Getting Started with Mesos</h1></div></div></div><p>This chapter covers how to manually set up and run a Mesos cluster on the public cloud (AWS, GCE, and Azure) as well as on a private datacenter (on the premises), and it also discusses the various debugging methods and explores how to troubleshoot the Mesos setup in detail.</p><p>In this chapter, we will explore the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to launch instances (virtual machines) on public cloud platforms, such as AWS, GCE, and Azure, and we will cover setting up Mesos on top of this</li><li class="listitem" style="list-style-type: disc">How to install a Mesos cluster on a private datacenter</li><li class="listitem" style="list-style-type: disc">How to troubleshoot and debug commonly encountered issues faced during the setup process</li></ul></div><div class="section" title="Virtual Machine (VM) instances"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Virtual Machine (VM) instances</h1></div></div></div><p>An instance is a <span class="strong"><strong>virtual machine (VM)</strong></span>, which is hosted on a cloud provider's infrastructure. Instances<a class="indexterm" id="id215"/> can run Linux and Windows Server images that are provided by your cloud provider or any customized versions of the same. You can also build and run images of other operating<a class="indexterm" id="id216"/> systems. Most cloud providers, such as <span class="strong"><strong>Google Compute Engine (GCE)</strong></span>, <span class="strong"><strong>Amazon Web Services</strong></span> (<span class="strong"><strong>AWS</strong></span>), <span class="strong"><strong>Microsoft Azure</strong></span>, and so on, also let <a class="indexterm" id="id217"/>you specify the machine <a class="indexterm" id="id218"/>properties of your instances, such as the amount of RAM and number of CPUs required, which are based on the type of machine that you use. In the following section, we'll take a look at how to set up Mesos on public cloud platforms.</p></div></div>
<div class="section" title="Setting up a multi-node Mesos cluster on Amazon Web Services (AWS)"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Setting up a multi-node Mesos cluster on Amazon Web Services (AWS)</h1></div></div></div><p>Please<a class="indexterm" id="id219"/> refer to <a class="ulink" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html</a>.</p><p>As the name implies, Amazon <a class="indexterm" id="id220"/>Web Services (AWS) is a cloud computing platform provided by Amazon. This<a class="indexterm" id="id221"/> comprises a wide range of web services operating from 11 physical world regions, which can be<a class="indexterm" id="id222"/> accessed remotely. This offers services with usage-based pricing; all of this can be used under one<a class="indexterm" id="id223"/> account including<a class="indexterm" id="id224"/> <span class="strong"><strong>EC2</strong></span> (computing or processing), <span class="strong"><strong>S3</strong></span> (storage), <span class="strong"><strong>CloudWatch</strong></span>, <span class="strong"><strong>RDS</strong></span>, <span class="strong"><strong>DynamoDB</strong></span>, <span class="strong"><strong>EBS</strong></span>, and<a class="indexterm" id="id225"/> so on.</p><p>AWS gives you <a class="indexterm" id="id226"/>a free tier<a class="indexterm" id="id227"/> to get you started with Amazon EC2 services. Once you sign up, you will be able to launch a<a class="indexterm" id="id228"/> <span class="strong"><strong>micro machine</strong></span> (a small <a class="indexterm" id="id229"/>machine with 700 MB of memory) and run this for a year almost free of cost. You will have to pay for other services, such as launching a bigger machine, or using their storage service, such as Amazon S3. You can find the updated pricing information on the official website.</p><p>
<span class="strong"><strong>Account Signup and Creation</strong></span>: Head to <a class="ulink" href="http://aws.amazon.com">http://aws.amazon.com</a>, click on <span class="strong"><strong>Sign Up</strong></span>, and follow the instructions to create an<a class="indexterm" id="id230"/> account in AWS. One of the steps requires phone verification. Once the signup process is complete, you will get a confirmation e-mail with the account number specified inside it. Make a note of this as this will be required in the next steps.</p><p>
<span class="strong"><strong>Key Pairs</strong></span>: By default, AWS uses the public key authentication to log in to your Linux instances, as this is more secure. You can choose the key pair while you launch the instance from a drop-down list, or you can create a new one at the time of launching the instance. If you haven't created a key pair already, you can create one using the Amazon EC2 console. Note that you will need key pair for each region, separately.</p><p>
<span class="strong"><strong>Security Groups</strong></span>: Security groups act as a firewall for associated instances. They can control both inbound and outbound traffic on your instance. You will have to enable the rule to accept the connections from your <span class="strong"><strong>IP</strong></span> address to the <span class="strong"><strong>SSH</strong></span> port for you to log in to the machine. You can <a class="indexterm" id="id231"/>also add or remove as many rules as you wish; for example, <span class="strong"><strong>HTTP</strong></span> and <span class="strong"><strong>HTTPS</strong></span> can be<a class="indexterm" id="id232"/> accessed from anywhere, but SSH connections should only be accessed from your IP address.</p><div class="section" title="Instance types"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec35"/>Instance types</h2></div></div></div><p>Virtual servers or<a class="indexterm" id="id233"/> machines on AWS are also known as instances. Amazon EC2 provides a wide selection of optimized instance types that are geared towards different requirements. Instance types come with a variety of resource (storage, RAM, CPU, and network capacity) options, providing users with the flexibility to select the right mix for their particular use case. Each instance type includes one or more instance sizes, which permits the scaling of your resources to the requirements of your target workload.</p><p>Instance types are grouped based on the resource type that the application seeks to leverage the most; for example, general purpose (for applications that require an even mix of all resources), computer<a class="indexterm" id="id234"/> optimized (for CPU-intensive workloads), GPU instances (for applications requiring GPU capabilities), memory optimized (for tasks that need a lot of memory), storage optimized (for applications that deal with large volumes of data), and micro instances (for quick trials or lightweight applications). Instances are created from preconfigured templates with OS and other common software that is already installed, called <a class="indexterm" id="id235"/>
<span class="strong"><strong>Amazon Machine Images</strong></span> (<span class="strong"><strong>AMI</strong></span>). AMIs are either provided by AWS, or they can be obtained through the AWS Marketplace. Users can also create and share their own AMIs with a wider community.</p><div class="section" title="Launching instances"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec28"/>Launching instances</h3></div></div></div><p>There are multiple<a class="indexterm" id="id236"/> ways that an instance can be launched on AWS. Here, we will use the common option of launching via the Amazon EC2 console using a selected Amazon Machine Image. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the Amazon EC2 console.</li><li class="listitem">Click on the <span class="strong"><strong>Launch Instance</strong></span> button from the console as depicted in the following diagram:<div class="mediaobject"><img alt="Launching instances" src="graphics/B05186_03_01.jpg"/></div></li><li class="listitem">Choose <span class="strong"><strong>64-bit Ubuntu 14.04 LTS AMI</strong></span> from the <span class="strong"><strong>Choose an Amazon Machine Image (AMI)</strong></span> page, as follows:<div class="mediaobject"><img alt="Launching instances" src="graphics/B05186_03_02.jpg"/></div></li><li class="listitem">On the <span class="strong"><strong>Choose an Instance Type</strong></span> page, select the required instance, which is based on resource requirements (CPU, memory, and so on). For our Mesos cluster, we <a class="indexterm" id="id237"/>will use <span class="strong"><strong>m4.xlarge</strong></span> instances having <span class="strong"><strong>4</strong></span> cores and <span class="strong"><strong>16</strong></span> GB of memory on each node:<div class="mediaobject"><img alt="Launching instances" src="graphics/B05186_03_03.jpg"/></div></li><li class="listitem">On the <span class="strong"><strong>Configure Instance Details</strong></span> page, change the following settings; choose the number of instances as <code class="literal">4</code> (as we are launching a four node cluster):<div class="mediaobject"><img alt="Launching instances" src="graphics/B05186_03_04.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Configure Security Group</strong></span>, add Mesos Web UI port <span class="strong"><strong>5050</strong></span> as <span class="strong"><strong>Custom TCP Rule</strong></span>, and make that sure you set <span class="strong"><strong>My IP </strong></span>as the<span class="strong"><strong> Source</strong></span> address. This <a class="indexterm" id="id238"/>option will restrict any other connections, other than your IP address, from attempting to connect to your network:<div class="mediaobject"><img alt="Launching instances" src="graphics/B05186_03_05.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Review Instance Launch</strong></span><a class="indexterm" id="id239"/>. We can skip adding storage and tagging instances for now: <div class="mediaobject"><img alt="Launching instances" src="graphics/B05186_03_06.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Launch</strong></span>.</li><li class="listitem">Now, you will be prompted to choose the private key to log in to the machines. You can either choose <span class="strong"><strong>Create a new key pair</strong></span> or use the existing one, and then the machines will be launched:<div class="mediaobject"><img alt="Launching instances" src="graphics/B05186_03_07.jpg"/></div></li><li class="listitem">Click on the<a class="indexterm" id="id240"/> <span class="strong"><strong>Download Key Pair</strong></span> button and the key pair named <code class="literal">mesos-cluster.pem</code> will be downloaded to your machine. You can use this file to SSH into the machines that you are launching in AWS.</li></ol></div></div></div><div class="section" title="Installing Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec36"/>Installing Mesos</h2></div></div></div><p>Now log in to all <a class="indexterm" id="id241"/>machines:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ssh -i  mesos-cluster.pem ec2-54-221-197-122.compute-1.amazonaws.com (master)</strong></span>
<span class="strong"><strong>ssh -i  mesos-cluster.pem ec2-54-221-196-123.compute-1.amazonaws.com (slave1)</strong></span>
<span class="strong"><strong>ssh -i  mesos-cluster.pem ec2-54-221-198-125.compute-1.amazonaws.com (slave2)</strong></span>
<span class="strong"><strong>ssh -i  mesos-cluster.pem ec2-54-221-198-130.compute-1.amazonaws.com (slave3)</strong></span>
</pre></div><p>Let's call the first machine from the preceding list as our master machine and rest of them as <code class="literal">slave1</code>, <code class="literal">slave2</code>, <code class="literal">slave3</code> for the rest of this chapter.</p><p>Now, we can install the dependency libraries and software packages on all four machines by typing in the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># Following command is used to update the packages.</strong></span>
<span class="strong"><strong>$ sudo apt-get update</strong></span>

<span class="strong"><strong># We will require JDK for deploying java projects over mesos, use the following command to install java. Here we are using Java version 7.</strong></span>
<span class="strong"><strong>$ sudo apt-get install -y openjdk-7-jdk</strong></span>

<span class="strong"><strong># This step is necessary only if you are building from the git repository. It will install the autotools.</strong></span>
<span class="strong"><strong>$ sudo apt-get install -y autoconf libtool</strong></span>

<span class="strong"><strong># Now we can install the dependencies for the mesos project.</strong></span>
<span class="strong"><strong>$ sudo apt-get -y install build-essential python-dev python-boto libcurl4-nss-dev libsasl2-dev maven libapr1-dev libsvn-dev</strong></span>
</pre></div><p>Now, our <a class="indexterm" id="id242"/>environment is ready, and we can start building the Mesos binary.</p><p>You can build the Mesos binary from the master machine and then copy the build to the slave machines instead of building from all the machines.</p></div><div class="section" title="Downloading Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec37"/>Downloading Mesos</h2></div></div></div><p>There are two different <a class="indexterm" id="id243"/>ways that you can get Mesos:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Download the latest <a class="indexterm" id="id244"/>stable release from Apache (Recommended) at <a class="ulink" href="http://mesos.apache.org/downloads/">http://mesos.apache.org/downloads/</a>. At the time of writing this book, the latest version of Mesos is 0.25.0:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ wget http://www.apache.org/dist/mesos/0.25.0/mesos-0.25.0.tar.gz</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ tar -zxf mesos-0.25.0.tar.gz</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ mv mesos-0.25.0 mesos</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">Clone the Mesos git repository (Advanced Users Only):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ git clone https://git-wip-us.apache.o</strong></span>
<span class="strong"><strong>rg/repos/asf/mesos.git</strong></span>
</pre></div></li></ul></div></div><div class="section" title="Building Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec38"/>Building Mesos</h2></div></div></div><p>We can build Mesos as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># Change working directory.</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ cd mesos</strong></span>

<span class="strong"><strong># This step is only required if you are building from the gitrepository, or else you can skip this step.</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ ./bootstrap</strong></span>

<span class="strong"><strong># Create a build directory. This will contain the compiled Mesosbinaries. It is a good practice to create the build directory.</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ mkdir build</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ cd build</strong></span>

<span class="strong"><strong># Now we can trigger the "configure build" command and "make" commandfollowed by it. This step is time consuming and can take some time to get executed</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ ../configure</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ make</strong></span>
<span class="strong"><strong>In order to speed up the building and reduce verbosity of the logs, you can append-j &lt;number of cores&gt; V=0 to make:</strong></span>
<span class="strong"><strong># Once the make command is executed, you can test the make by issuing the following command.</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ make check</strong></span>
<span class="strong"><strong># The following step is optional, you can use it if you are installing it system wide. </strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ make install</strong></span>
</pre></div><p>Now, we can <a class="indexterm" id="id245"/>copy the build directory from the Mesos master machine to <code class="literal">slave1</code>, <code class="literal">slave2</code>, and <code class="literal">slave3</code> machines:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ rsync -za mesos ip-10-155-18-107:</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ rsync -za mesos ip-10-155-18-109:</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~$ rsync -za mesos ip-10-155-18-110:</strong></span>
</pre></div><p>Start the Mesos master, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@ip-10-155-18-106:~/mesos/build$ ./bin/mesos-master.sh --work_dir=/var/lib/mesos</strong></span>
</pre></div><p>Start the Mesos slaves:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@ip-10-155-18-107:~/mesos/build$ ./bin/mesos-slave.sh --master=mesos-master:5050</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-109:~/mesos/build$ ./bin/mesos-slave.sh --master=mesos-master:5050</strong></span>
<span class="strong"><strong>ubuntu@ip-10-155-18-110:~/mesos/build$ ./bin/mesos-slave.sh --master=mesos-master:5050</strong></span>
</pre></div><p>The Mesos Web UI runs on port <code class="literal">5050</code> on the master machine, and this is where the installation completion status can be checked.</p><p>To do this, type in the<a class="indexterm" id="id246"/> following URL in your web browser:</p><p>
<code class="literal">http://ec2-54-221-197-122.compute-1.amazonaws.com:5050</code>
</p><p>And the Mesos UI will appear as follows:</p><div class="mediaobject"><img alt="Building Mesos" src="graphics/B05186_03_08.jpg"/></div></div><div class="section" title="Using mesos-ec2 script to launch many machines at once"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec39"/>Using mesos-ec2 script to launch many machines at once</h2></div></div></div><p>Mesos provides<a class="indexterm" id="id247"/> scripts to create Mesos clusters of various configurations on EC2. The <code class="literal">mesos-ec2</code> script, which is located in the <code class="literal">ec2</code> directory allows launching, running jobs, and tearing down the Mesos clusters. Note that we can use this script even without building Mesos, but you will require Python (&gt;=2.6). We can manage multiple clusters using different names.</p><p>We will need an AWS key pair to use the ec2 script, and our access and secret key, which we created in the preceding steps:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@local:~ $ export AWS_ACCESS_KEY_ID=&lt;your-access-key&gt;</strong></span>
<span class="strong"><strong>ubuntu@local:~ $ export AWS_SECRET_ACCESS_KEY=&lt;your-secret-key&gt;</strong></span>
</pre></div><p>Now, we can use the EC2 scripts that are provided with Mesos to launch a new cluster using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@local:~/mesos/ec2 $ ./mesos-ec2 -k &lt;your-key-pair&gt; -i &lt;your-identity-file&gt; -s 10 launch mesos-cluster</strong></span>
</pre></div><p>This will launch a cluster named <code class="literal">mesos-cluster</code> with ten slaves. Once the scripts are done, this will also print the Mesos Web UI link in the form of <code class="literal">&lt;master-hostname&gt;:8080</code>. We can confirm that the cluster is up by going to the web interface.</p><p>The script provides a<a class="indexterm" id="id248"/> number of options, a few of which are listed in the following table. We can list all the available options of the script by running <code class="literal">mesos-ec2 --help</code>:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Command</p>
</th><th style="text-align: left" valign="bottom">
<p>Use</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--slave</code> or <code class="literal">–s</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a class="indexterm" id="id249"/>number of slaves in the cluster</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--key-pair</code> or <code class="literal">-k</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a class="indexterm" id="id250"/> the SSH key pair for authentication</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--identity-file</code> or <code class="literal">–i</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a class="indexterm" id="id251"/>SSH identity file used to log in to the instances</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--instance-type</code> or <code class="literal">–t</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a<a class="indexterm" id="id252"/> slave instance type, and this must be 64-bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--ebs-vol-size</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a class="indexterm" id="id253"/>size of an EBS volume, which is used to store the persistent HDFS data</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--master-instance-type</code> or <code class="literal">–m</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a master<a class="indexterm" id="id254"/> instance type, and this is must be 64-bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--zone</code> or <code class="literal">-z</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a class="indexterm" id="id255"/>Amazon availability zone to launch instances</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--resume</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This flag<a class="indexterm" id="id256"/> resumes the installation from the previous run</p>
</td></tr></tbody></table></div><p>We can use the login action to log in to the launched cluster by providing a cluster name, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@local:~/mesos/ec2 $ ./mesos-ec2 -k &lt;your-key-pair&gt; -i &lt;your-identity-file&gt; login mesos-cluster</strong></span>
</pre></div><p>The script also sets up an HDFS instance, which can be used via commands in the <code class="literal">/root/ephemeral-hdfs/</code> directory.</p><p>Finally, we can terminate a cluster using the following command. Be sure to copy any important data before terminating the cluster:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ubuntu@local:~/mesos/ec2 $ ./mesos-ec2 destroy ec2-test</strong></span>
</pre></div><p>The script also supports advanced functionalities, such as pausing and restarting clusters with EBS-backed instances. The Mesos documentation is a great source of information for any clarification. It is worth mentioning that Mesosphere (<a class="ulink" href="http://mesosphere.com">http://mesosphere.com</a>) also <a class="indexterm" id="id257"/>provides you with an easy way of creating an elastic Mesos cluster on Amazon EC2, Google Cloud, and other platforms and provides commercial support for Mesos.</p></div></div>
<div class="section" title="Setting up a multi-node Mesos cluster on Google Compute Engine (GCE)"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Setting up a multi-node Mesos cluster on Google Compute Engine (GCE)</h1></div></div></div><p>
<span class="strong"><strong>Google Compute Engine</strong></span> (<span class="strong"><strong>GCE</strong></span>) is Google's <span class="strong"><strong>Infrastructure as a Service</strong></span> (<span class="strong"><strong>IaaS</strong></span>) offering, which allows<a class="indexterm" id="id258"/> users to run their <a class="indexterm" id="id259"/>computational <a class="indexterm" id="id260"/>workloads on virtual servers that are part of the same infrastructure that powers services, such as Gmail, YouTube, and Google's search engine.</p><div class="section" title="Introduction to instance types"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec40"/>Introduction to instance types</h2></div></div></div><p>Machine types determine the virtualized hardware resources that are available to your instances, such as the<a class="indexterm" id="id261"/> amount of memory, virtual CPU, and the persistent disk limits an instance will have. A single virtual CPU maps to a single hardware hyper-thread on the host CPU that is running your instance.</p><p>Machine types are divided into different classes, and they are managed by the Google Compute Engine. Each machine type has its own pricing and is billed separately. For pricing information, review the price sheet.</p><p>Available machine types include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Standard machine types</li><li class="listitem" style="list-style-type: disc">High-CPU machine types</li><li class="listitem" style="list-style-type: disc">High-memory machine types</li><li class="listitem" style="list-style-type: disc">Shared-core machine types</li></ul></div></div><div class="section" title="Launching machines"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Launching machines</h2></div></div></div><p>The easiest way to <a class="indexterm" id="id262"/>get started with Google Compute Engine is to create a virtual machine instance in the browser tool that Google Cloud Platform offers, the Google Developers<a class="indexterm" id="id263"/> Console, which can be found at <a class="ulink" href="https://console.developers.google.com">https://console.developers.google.com</a>.</p><div class="section" title="Set up a Google Cloud Platform project"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec29"/>Set up a Google Cloud Platform project</h3></div></div></div><p>We need to set up a<a class="indexterm" id="id264"/> Google Cloud Platform project before we begin to launch the machines:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the Google Developers Console. When prompted, select an existing project or create a new project.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>The name you use must be between 1 and 63 characters with a lowercase letter as the first character. You can use a dash, lowercase letter, or digit for the remaining characters, but the last character cannot be a dash. Also, you should be aware that some resource identifiers (such as project IDs) might be retained beyond the life of your project. For this reason, avoid storing sensitive information in resource identifiers.</p></div></div></li><li class="listitem">Follow the prompts to set up<a class="indexterm" id="id265"/> billing. If you are new to the Google Cloud Platform, you have free trial credit to pay for your instances.</li></ol></div></div></div><div class="section" title="Create the network and firewall rules"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec42"/>Create the network and firewall rules</h2></div></div></div><p>After you set up <a class="indexterm" id="id266"/>your project and billing, go to the <span class="strong"><strong>Networking</strong></span> section in the Developers Console:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Create network</strong></span> to create<a class="indexterm" id="id267"/> your first network and name it <code class="literal">mesos-network</code>:<div class="mediaobject"><img alt="Create the network and firewall rules" src="graphics/B05186_03_09.jpg"/></div></li><li class="listitem">Once the <a class="indexterm" id="id268"/>network is added, click on the network and click on the <span class="strong"><strong>Add Firewall Rules</strong></span> button.</li><li class="listitem">Add the rules to <a class="indexterm" id="id269"/>open TCP 22 and 5050 ports, this is usually a semicolon separated list consisting of <code class="literal">protocol:port</code>:<div class="mediaobject"><img alt="Create the network and firewall rules" src="graphics/B05186_03_10.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Create</strong></span>.</li></ol></div></div><div class="section" title="Create the instances"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec43"/>Create the instances</h2></div></div></div><p>After you set up <a class="indexterm" id="id270"/>your project and billing, go to the <span class="strong"><strong>VM instances</strong></span> section in the Developers Console:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Create a new instance</strong></span> to create your first instance.</li><li class="listitem">Set the <span class="strong"><strong>Name</strong></span> field of your instance to <code class="literal">mesos-master</code>.</li><li class="listitem">Under <span class="strong"><strong>Boot disk</strong></span>, click on <span class="strong"><strong>Change</strong></span> and select an <span class="strong"><strong>Ubuntu 14.04 LTS</strong></span> boot disk image if this is not already specified by default. Compute Engine has several other operating systems for you to choose from, but we will use Ubuntu for this example. Save your changes:<div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_11.jpg"/></div></li><li class="listitem">Click on<a class="indexterm" id="id271"/> <span class="strong"><strong>Networking</strong></span> and choose <span class="strong"><strong>mesos-network</strong></span>, which we created in an earlier step.</li><li class="listitem">Click on <span class="strong"><strong>Create</strong></span> to create your instance. The page automatically refreshes after the instance starts.</li></ol></div><p>Once we launch the <code class="literal">mesos-master</code> machine, now repeat the preceding steps three times to start our <code class="literal">mesos-slave1</code>, <code class="literal">mesos-slave2</code>, and for our cluster:</p><div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_12.jpg"/></div></div><div class="section" title="Installing Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Installing Mesos</h2></div></div></div><p>By this point, you<a class="indexterm" id="id272"/> will have three machines up and running in the Google Compute Cloud named <code class="literal">mesos-master</code>, <code class="literal">mesos-slave1</code>, and <code class="literal">mesos-slave2</code>:</p><div class="mediaobject"><img alt="Installing Mesos" src="graphics/B05186_03_13.jpg"/></div><p>Now, log in to all three machines:</p><div class="informalexample"><pre class="programlisting">mesos-master: ssh 146.148.62.84
mesos-slave1:  ssh 104.197.92.182
mesos-slave2:  ssh 104.197.92.145</pre></div><p>Now, we can install the dependency libraries and software packages on all three machines by typing in the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># Update the packages.</strong></span>
<span class="strong"><strong>$ sudo apt-get update</strong></span>
<span class="strong"><strong># Install the latest OpenJDK.</strong></span>
<span class="strong"><strong>$ sudo apt-get install -y openjdk-7-jdk</strong></span>
<span class="strong"><strong># Install autotools (Only necessary if building from git repository).</strong></span>
<span class="strong"><strong>$ sudo apt-get install -y autoconf libtool</strong></span>
<span class="strong"><strong># Install other Mesos dependencies.</strong></span>
<span class="strong"><strong>$ sudo apt-get -y install build-essential python-dev python-boto libcurl4-nss-dev libsasl2-dev maven libapr1-dev libsvn-dev</strong></span>
</pre></div><p>Now, our environment is ready, and we can start building the Mesos binary.</p><p>You can build<a class="indexterm" id="id273"/> the Mesos binary from the master machine, and then copy the build to the slave machines instead of building from all the machines.</p></div><div class="section" title="Downloading Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec45"/>Downloading Mesos</h2></div></div></div><p>Follow the steps<a class="indexterm" id="id274"/> from the corresponding <span class="emphasis"><em>Downloading Mesos</em></span> subsection under the <span class="emphasis"><em>Setting up a multi-node Mesos cluster on Amazon Web Services (AWS)</em></span> section to download and extract Mesos on the master machine.</p></div><div class="section" title="Building Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec46"/>Building Mesos</h2></div></div></div><p>Building Mesos is<a class="indexterm" id="id275"/> discussed in the corresponding AWS section. You can follow the instructions listed there to build Mesos on the master machine.</p><p>We can now make sure that the installation is complete by looking at the Mesos Web UI running on port <code class="literal">5050</code> on the master machine.</p><p>Open your browser and head to the following URL:</p><p>
<code class="literal">http://146.148.62.84:5050</code>
</p><p>And the Mesos Web UI will appear as follows:</p><div class="mediaobject"><img alt="Building Mesos" src="graphics/B05186_03_14.jpg"/></div></div></div>
<div class="section" title="Setting up a multi-node Mesos cluster on Microsoft Azure"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Setting up a multi-node Mesos cluster on Microsoft Azure</h1></div></div></div><p>Microsoft Azure is a cloud<a class="indexterm" id="id276"/> computing platform<a class="indexterm" id="id277"/> and infrastructure, which is created by Microsoft to build, deploy, and manage applications and services<a class="indexterm" id="id278"/> through a <a class="indexterm" id="id279"/>global network of Microsoft-managed and Microsoft partner-hosted datacenters. For more information check out <a class="ulink" href="https://azure.microsoft.com">https://azure.microsoft.com</a>.</p><div class="section" title="Introduction to instance types"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec47"/>Introduction to instance types</h2></div></div></div><p>Virtual machines <a class="indexterm" id="id280"/>are available in two tiers: basic and standard. Both types offer a choice of sizes, but the basic tier doesn't provide some capabilities, such as load-balancing and autoscaling, which are available in the standard tier. The standard tier of sizes consists of different series: A, D, DS, G, and GS.</p></div><div class="section" title="Launching machines"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec48"/>Launching machines</h2></div></div></div><p>To get started with <a class="indexterm" id="id281"/>development or test in the cloud, you will need an active Microsoft Azure subscription. If you <a class="indexterm" id="id282"/>don't currently have a subscription, you can get a free one-month trial with $200 that you can spend on whatever Azure services you want to use:</p><div class="mediaobject"><img alt="Launching machines" src="graphics/B05186_03_15.jpg"/></div><p>Once you sign-up for Azure, visit the management portal to launch the instances. Azure management portal is<a class="indexterm" id="id283"/> available at the following URL: <a class="ulink" href="https://manage.windowsazure.com">https://manage.windowsazure.com</a>
</p><div class="section" title="Create a cloud service"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec30"/>Create a cloud service</h3></div></div></div><p>A cloud service in<a class="indexterm" id="id284"/> Azure gives you a public endpoint to access all the services (VMs and so on) that are running within the cloud service. An endpoint would look something like the following:</p><div class="informalexample"><pre class="programlisting">the-name-you-give.cloudapp.net (e.g: mesos-cluster.cloudapp.net)</pre></div><p>Following are the steps to create a cloud service:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>CLOUD SERVICES</strong></span> option from the left-hand side menu panel:<div class="mediaobject"><img alt="Create a cloud service" src="graphics/B05186_03_16.jpg"/></div></li><li class="listitem">Choose <span class="strong"><strong>NEW</strong></span>, then click on <span class="strong"><strong>CLOUD SERVICE</strong></span>, and then click on <span class="strong"><strong>QUICK CREATE</strong></span>:<div class="mediaobject"><img alt="Create a cloud service" src="graphics/B05186_03_17.jpg"/></div><p>We used the name <code class="literal">mesos-cluster</code>; hence, the public endpoint to access this service will become <code class="literal">mesos-cluster.cloudapp.net</code>.</p></li><li class="listitem">Click on <span class="strong"><strong>Create</strong></span><a class="indexterm" id="id285"/><span class="strong"><strong> Cloud Service</strong></span>. Once you create the cloud service, you can see it, as follows:<div class="mediaobject"><img alt="Create a cloud service" src="graphics/B05186_03_18.jpg"/></div></li></ol></div></div><div class="section" title="Create the instances"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec31"/>Create the instances</h3></div></div></div><p>Once you have the <a class="indexterm" id="id286"/>cloud service ready, the next thing that you need to do is to start the Virtual machines for our Mesos cluster:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>NEW</strong></span>, then choose <span class="strong"><strong>COMPUTE</strong></span>, and then choose <span class="strong"><strong>VIRTUAL MACHINE</strong></span>:<div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_19.jpg"/></div></li><li class="listitem">Click on <a class="indexterm" id="id287"/><span class="strong"><strong>FROM GALLERY</strong></span>; this options gives us better choices and controls over the machine.</li><li class="listitem"><span class="strong"><strong>Choose an Image</strong></span> and click on <span class="strong"><strong>UBUNTU</strong></span>, and then choose the <span class="strong"><strong>Ubuntu Server 14.04 LTS</strong></span> image from the list and click on <span class="strong"><strong>Next</strong></span>:<div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_20.jpg"/></div></li><li class="listitem"><span class="strong"><strong>Virtual Machine Naming</strong></span>: In this step, you will name your virtual machine. This name will be the hostname of the machine that you are about to launch, so we will name it <code class="literal">mesos-master</code>. Choose the <span class="strong"><strong>SIZE</strong></span> as <span class="strong"><strong>D3 (which is the 4 cores 14GB Memory machine)</strong></span> and type in the password, which you will use to log in to the machine. Now, click on <span class="strong"><strong>Next</strong></span>:<div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_21.jpg"/></div></li><li class="listitem"><span class="strong"><strong>Virtual Machine Configuration</strong></span>: In this step you will choose the<span class="strong"><strong> mesos-cluster</strong></span> cloud <a class="indexterm" id="id288"/>service, which we created earlier. Thus, the very machine that you will be launching for this exercise will fall under the <code class="literal">mesos-cluster</code> cloud service:<div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_22.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> and hit the <span class="strong"><strong>Finish</strong></span> button:<div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_23.jpg"/></div></li></ol></div><p>Now, follow the same steps to launch <code class="literal">mesos-slave1</code> and <code class="literal">mesos-slave2</code>.</p><p>One thing to note<a class="indexterm" id="id289"/> here is that for every new machine that you are going to launch, if you want to access any of these machines from outside of the <code class="literal">mesos-cluster</code> endpoint, you will have to configure the SSH ports, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <span class="strong"><strong>Virtual machine configuration</strong></span> Step, under <span class="strong"><strong>ENDPOINTS</strong></span>, change the <span class="strong"><strong>PUBLIC PORT</strong></span> value to another number:<div class="mediaobject"><img alt="Create the instances" src="graphics/B05186_03_24.jpg"/></div></li><li class="listitem">Let's say the <code class="literal">mesos</code>-<code class="literal">master</code> public port was <code class="literal">22</code>; this means that suppose we perform the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ssh mesos-cluster.cloudapp.net -p 22</strong></span>
</pre></div></li><li class="listitem">This will log in to the <code class="literal">mesos-master</code> machine. Now if you want to log in to <code class="literal">mesos-slave1</code>, then you will <a class="indexterm" id="id290"/>configure the public port as <code class="literal">44</code> so that you can log in to <code class="literal">mesos-slave1</code>, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ssh mesos-cluster.cloudapp.net -p 44</strong></span>
</pre></div></li></ol></div></div></div><div class="section" title="Configuring the network"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec49"/>Configuring the network</h2></div></div></div><p>For security reasons, whenever you deploy a machine in the cloud, always make sure that you have opened up<a class="indexterm" id="id291"/> the necessary ports to the public.</p><p>Apart from the SSH port, we also need to open up the Mesos UI port, which runs on <code class="literal">5050</code>. To do this, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From the Azure console, click on the <span class="strong"><strong>mesos-master</strong></span> machine under the VMs provisioned and click on the <span class="strong"><strong>End Points</strong></span>.</li><li class="listitem">Now click on the <span class="strong"><strong>ADD</strong></span> button to add a specific port:<div class="mediaobject"><img alt="Configuring the network" src="graphics/B05186_03_25.jpg"/></div></li><li class="listitem">Choose the <span class="strong"><strong>ADD A STAND-ALONE ENDPOINT</strong></span> option and click on <span class="strong"><strong>Next</strong></span>:<div class="mediaobject"><img alt="Configuring the network" src="graphics/B05186_03_26.jpg"/></div></li><li class="listitem">Name this <code class="literal">mesos-ui</code>, choose <span class="strong"><strong>TCP</strong></span> from the protocol list, and use <code class="literal">5050</code> as <span class="strong"><strong>PUBLIC PORT</strong></span>. This<a class="indexterm" id="id292"/> will allow you to access it with <code class="literal">http://mesos-cluster.cloudapp.net:5050</code> and assign port <code class="literal">5050</code> as <span class="strong"><strong>PRIVATE PORT</strong></span>. Click on the <span class="strong"><strong>Finish</strong></span> button:<div class="mediaobject"><img alt="Configuring the network" src="graphics/B05186_03_27.jpg"/></div></li></ol></div></div><div class="section" title="Installing Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec50"/>Installing Mesos</h2></div></div></div><p>By this point, you <a class="indexterm" id="id293"/>will have three machines up and running in the Azure cloud named <code class="literal">mesos-master</code>, <code class="literal">mesos-slave1</code>, and <code class="literal">mesos-slave2</code>:</p><div class="mediaobject"><img alt="Installing Mesos" src="graphics/B05186_03_28.jpg"/></div><p>Now, log in to all three machines:</p><div class="informalexample"><pre class="programlisting">mesos-master: ssh mesos-cluster.cloudapp.net
mesos-slave1:  ssh mesos-cluster.cloudapp.net -p 23
mesos-slave2:  ssh mesos-cluster.cloudapp.net -p 24</pre></div><p>It is ideal to use an advanced Linux Terminal, such <a class="indexterm" id="id294"/>as <span class="strong"><strong>terminator</strong></span> or <span class="strong"><strong>xterm,</strong></span> to work on multiple machines <a class="indexterm" id="id295"/>because these terminals support broadcasting the command. You can type the command on a single window, and it will be executed on all three machines at once, thereby reducing configuration work:</p><div class="mediaobject"><img alt="Installing Mesos" src="graphics/B05186_03_29.jpg"/></div><p>Now, we can install the dependency libraries and software packages on all three machines by typing in the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># Update the packages.</strong></span>
<span class="strong"><strong>$ sudo apt-get update</strong></span>

<span class="strong"><strong># Install the latest OpenJDK.</strong></span>
<span class="strong"><strong>$ sudo apt-get install -y openjdk-7-jdk</strong></span>

<span class="strong"><strong># Install autotools (Only necessary if building from git repository).</strong></span>
<span class="strong"><strong>$ sudo apt-get install -y autoconf libtool</strong></span>

<span class="strong"><strong># Install other Mesos dependencies.</strong></span>
<span class="strong"><strong>$ sudo apt-get -y install build-essential python-dev python-botolibcurl4-nss-dev libsasl2-dev maven libapr1-dev libsvn-dev</strong></span>
</pre></div><p>Now, our environment is ready, and we can start building the Mesos binary. You can build the Mesos binary<a class="indexterm" id="id296"/> from the master machine and then copy the build to the slave machines instead of building from all the machines.</p></div><div class="section" title="Downloading Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec51"/>Downloading Mesos</h2></div></div></div><p>Follow the steps from<a class="indexterm" id="id297"/> the corresponding <span class="emphasis"><em>Downloading Mesos</em></span> subsection under the <span class="emphasis"><em>Setting up a multi-node Mesos cluster on Amazon Web Services (AWS)</em></span> section to download and extract Mesos on the master machine.</p></div><div class="section" title="Building Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec52"/>Building Mesos</h2></div></div></div><p>Building Mesos is discussed in<a class="indexterm" id="id298"/> the corresponding <span class="emphasis"><em>Building Mesos</em></span> subsection under the <span class="emphasis"><em>Setting up a multi-node Mesos cluster on Amazon Web Services (AWS)</em></span> section. You can follow the instructions listed there to build Mesos on the master machine.</p><p>Once we build this, then we can copy the build directory from the <code class="literal">mesos-master</code> machine to the <code class="literal">mesos-slave1</code> and <code class="literal">mesos-slave2</code> machines:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mesos-master:~$ rsync -za mesos mesos-slave1:</strong></span>
<span class="strong"><strong>mesos-master:~$ rsync -za mesos mesos-slave2:</strong></span>
</pre></div></div><div class="section" title="Starting mesos-master"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec53"/>Starting mesos-master</h2></div></div></div><p>Issue the following <a class="indexterm" id="id299"/>command from the master machine to start <code class="literal">mesos-master</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mesos-master:~/mesos/build$ ./bin/mesos-master.sh --work_dir=/var/lib/mesos</strong></span>
</pre></div><p>After the command, you can see the following logs appearing in the Terminal:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>I1108 08:26:52.525831 13306 main.cpp:229] Build: 2015-11-08 07:26:59 by akhld</strong></span>
<span class="strong"><strong>I1108 08:26:52.526072 13306 main.cpp:231] Version: 0.25.0</strong></span>
<span class="strong"><strong>I1108 08:26:52.526406 13306 main.cpp:252] Using 'HierarchicalDRF' allocator</strong></span>
<span class="strong"><strong>I1108 08:26:52.623775 13306 leveldb.cpp:176] Opened db in 97.107324ms</strong></span>
<span class="strong"><strong>I1108 08:26:52.712013 13306 leveldb.cpp:183] Compacted db in 88.081084ms</strong></span>
<span class="strong"><strong>I1108 08:26:52.712218 13306 leveldb.cpp:198] Created db iterator in 72800ns</strong></span>
<span class="strong"><strong>I1108 08:26:52.712327 13306 leveldb.cpp:204] Seeked to beginning of db in 25401ns</strong></span>
<span class="strong"><strong>I1108 08:26:52.712745 13306 leveldb.cpp:273] Iterated through 3 keys in the db in 342201ns</strong></span>
<span class="strong"><strong>I1108 08:26:52.713101 13306 replica.cpp:744] Replica recovered with log positions 5 -&gt; 6 with 0 holes and 0 unlearned</strong></span>
<span class="strong"><strong>I1108 08:26:52.716048 13321 recover.cpp:449] Starting replica recovery</strong></span>
<span class="strong"><strong>I1108 08:26:52.716660 13306 main.cpp:465] Starting Mesos master</strong></span>
<span class="strong"><strong>……….</strong></span>
<span class="strong"><strong>I1108 08:26:52.776047 13306 master.cpp:376] Master 090c9618-090f-49bd-aa95-265ec5f423d5 (100.73.76.103) started on 100.73.76.103:5050</strong></span>
</pre></div><p>The output here<a class="indexterm" id="id300"/> lists the build version, various configurations that the master has used, and the master ID of the cluster. The slave process should be able to connect to the master. The slave process can specify the IP address or the hostname of the master by the <code class="literal">--master</code> option.</p></div><div class="section" title="Start mesos-slaves"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec54"/>Start mesos-slaves</h2></div></div></div><p>Issue the following<a class="indexterm" id="id301"/> commands on the slave machines to start the slave service:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mesos-slave1:~/mesos/build$ ./bin/mesos-slave.sh --master=mesos-master:5050</strong></span>
<span class="strong"><strong>mesos-slave1:~/mesos/build$ ./bin/mesos-slave.sh --master=mesos-master:5050</strong></span>

<span class="strong"><strong>I1108 08:31:18.733666 26975 main.cpp:185] Build: 2015-11-08 07:26:59 by akhld</strong></span>
<span class="strong"><strong>I1108 08:31:18.734257 26975 main.cpp:187] Version: 0.25.0</strong></span>
<span class="strong"><strong>I1108 08:31:18.734724 26975 containerizer.cpp:143] Using isolation: posix/cpu,posix/mem,filesystem/posix</strong></span>
<span class="strong"><strong>I1108 08:31:18.747735 26975 main.cpp:272] Starting Mesos slave</strong></span>
<span class="strong"><strong>I1108 08:31:18.748929 26975 slave.cpp:190] Slave started on 1)@100.73.76.129:5051</strong></span>
</pre></div><p>This output confirms the connection to the master and lists the slave resources. Now, the cluster is running with two slaves and is ready to run the frameworks.</p><p>We can now make sure<a class="indexterm" id="id302"/> that the installation is complete by looking at the Mesos Web UI running on port <code class="literal">5050</code> on the master machine.</p><p>Open your browser and head on to the following URL: <code class="literal">http://mesos-cluster.cloudapp.net:5050</code>:</p><div class="mediaobject"><img alt="Start mesos-slaves" src="graphics/B05186_03_30.jpg"/></div></div><div class="section" title="Mesos commands"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec55"/>Mesos commands</h2></div></div></div><p>If you look into the <code class="literal">bin</code> directory of Mesos, you can find the following executables, which can be used for <a class="indexterm" id="id303"/>various operations as listed here:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Command</p>
</th><th style="text-align: left" valign="bottom">
<p>Use</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-local.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command<a class="indexterm" id="id304"/> launches an in-memory cluster within a single process.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-tests.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id305"/>command runs the Mesos test case suite.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a <a class="indexterm" id="id306"/>wrapper script, which is used to launch the Mesos commands. Running without any arguments shows all the available commands.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">gdb-mesos-*</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command<a class="indexterm" id="id307"/> launches the corresponding processes in debugging mode using <code class="literal">gdb</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">lldb-mesos-*</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id308"/>command launches the corresponding processes in debugging mode using <code class="literal">lldb</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">valgrind-mesos-*</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command<a class="indexterm" id="id309"/> launches the corresponding Valgrind instrumentation framework.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-daemon.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command<a class="indexterm" id="id310"/> starts/stops a Mesos daemon process.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-start-cluster.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command <a class="indexterm" id="id311"/>starts the Mesos cluster on nodes in the <code class="literal">[install-prefix]/var/mesos/deploy/masters</code> and <code class="literal">[install-prefix]/var/mesos/deploy/slaves</code> files.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-stop-cluster.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a class="indexterm" id="id312"/> command stops<a class="indexterm" id="id313"/> the Mesos cluster on nodes in the <code class="literal">[install-prefix]/var/mesos/deploy/masters</code> and <code class="literal">[install-prefix]/var/mesos/deploy/slaves</code> files.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-start-masters.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command starts<a class="indexterm" id="id314"/> the Mesos masters on nodes listed in the masters file.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-stop-masters.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command<a class="indexterm" id="id315"/> stops the Mesos masters on nodes listed in the masters file.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-start-slaves.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a class="indexterm" id="id316"/>command starts the Mesos slaves on nodes listed in the slaves file.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mesos-stop-slaves.sh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This command<a class="indexterm" id="id317"/> stops the Mesos slaves on nodes listed in the slaves file.</p>
</td></tr></tbody></table></div></div><div class="section" title="Testing the installation"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec56"/>Testing the installation</h2></div></div></div><p>We can now test the installation of our cluster by running the simple examples (C++, Java, and Python) that are<a class="indexterm" id="id318"/> shipped with Mesos:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># Run C++ framework (Exits after successfully running some tasks.).</strong></span>
<span class="strong"><strong>mesos-master:~/mesos/build$ ./src/examples/test-framework --master=mesos-master:5050</strong></span>
</pre></div><p>The output will be as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>I1108 09:26:45.512217 23136 sched.cpp:164] Version: 0.25.0</strong></span>
<span class="strong"><strong>I1108 09:26:45.524862 23156 sched.cpp:262] New master detected at master@100.73.76.103:5050</strong></span>
<span class="strong"><strong>I1108 09:26:45.527117 23156 sched.cpp:272] No credentials provided. Attempting to register without authentication</strong></span>
<span class="strong"><strong>  I1108 09:26:45.531708 23157 sched.cpp:641] Framework registered with 5f18729d-c83a-4264-a50b-bd972b2d10f3-0006</strong></span>
<span class="strong"><strong>Registered!</strong></span>
<span class="strong"><strong>Received offer 5f18729d-c83a-4264-a50b-bd972b2d10f3-O11 withcpus(*):4; mem(*):13000; disk(*):23976; ports(*):[31000-32000]</strong></span>
<span class="strong"><strong>Launching task 0 using offer 5f18729d-c83a-4264-a50b-bd972b2d10f3-O11</strong></span>
<span class="strong"><strong>Launching task 1 using offer 5f18729d-c83a-4264-a50b-bd972b2d10f3-O11</strong></span>
<span class="strong"><strong>Launching task 2 using offer 5f18729d-c83a-4264-a50b-bd972b2d10f3-O11</strong></span>
<span class="strong"><strong>Launching task 3 using offer 5f18729d-c83a-4264-a50b-bd972b2d10f3-O11</strong></span>
<span class="strong"><strong>Received offer 5f18729d-c83a-4264-a50b-bd972b2d10f3-O12 withcpus(*):4; mem(*):13000; disk(*):23976; ports(*):[31000-32000]</strong></span>
<span class="strong"><strong>Launching task 4 using offer 5f18729d-c83a-4264-a50b-bd972b2d10f3-O12</strong></span>
<span class="strong"><strong>Task 4 is in state TASK_RUNNING</strong></span>
<span class="strong"><strong>Task 0 is in state TASK_RUNNING</strong></span>
<span class="strong"><strong>Task 1 is in state TASK_RUNNING</strong></span>
<span class="strong"><strong>Task 4 is in state TASK_FINISHED</strong></span>
<span class="strong"><strong>Task 2 is in state TASK_RUNNING</strong></span>
<span class="strong"><strong>Task 3 is in state TASK_RUNNING</strong></span>
<span class="strong"><strong>Task 0 is in state TASK_FINISHED</strong></span>
<span class="strong"><strong>Task 1 is in state TASK_FINISHED</strong></span>
<span class="strong"><strong>Task 2 is in state TASK_FINISHED</strong></span>
<span class="strong"><strong>Task 3 is in state TASK_FINISHED</strong></span>
<span class="strong"><strong>I1108 09:26:45.719132 23154 sched.cpp:1771] Asked to stop the driver</strong></span>
<span class="strong"><strong>I1108 09:26:45.719321 23154 sched.cpp:1040] Stopping framework '5f18729d-c83a-4264-a50b-bd972b2d10f3-0006'</strong></span>
<span class="strong"><strong>I1108 09:26:45.720949 23136 sched.cpp:1771] Asked to stop the driver </strong></span>
</pre></div><div class="mediaobject"><img alt="Testing the installation" src="graphics/B05186_03_31.jpg"/></div><p>You can also<a class="indexterm" id="id319"/> look at the status of the tasks from the Web UI:</p><div class="mediaobject"><img alt="Testing the installation" src="graphics/B05186_03_32.jpg"/></div><div class="informalexample"><pre class="programlisting"># Run Java framework (Exits after successfully running some tasks)mesos-master:~/mesos/build$ ./src/examples/java/test-framework mesos-master:5050
# Run Python framework (Exits after successfully running some tasks)
mesos-master:~/mesos/build$ ./src/examples/python/test-framework mesos-master:5050</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>To build the<a class="indexterm" id="id320"/> example frameworks, make sure that you build the test suite by performing the following:</p><div class="informalexample"><pre class="programlisting">make check</pre></div></div></div></div></div>
<div class="section" title="Setting up a multi-node Mesos cluster on your private datacenter"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Setting up a multi-node Mesos cluster on your private datacenter</h1></div></div></div><p>In this section, we<a class="indexterm" id="id321"/> will explain how to get Mesos up and running on your fully-managed datacenter. For the sake of <a class="indexterm" id="id322"/>simplicity, let's assume you have a datacenter having three machines, and you are going to set up Mesos on top<a class="indexterm" id="id323"/> of these. Let's also assume your datacenter <a class="indexterm" id="id324"/>VMs are running the <span class="strong"><strong>CentOS 6.6</strong></span> Linux distribution.</p><p>Consider that the following machines are opted in to install Mesos:</p><div class="informalexample"><pre class="programlisting">machine-a : 192.168.1.10
machine-b : 192.168.1.11
machine-c : 192.168.1.12</pre></div><p>We will choose <code class="literal">machine-a</code> as the Mesos master machine for our cluster and <code class="literal">machine-b</code>, <code class="literal">machine-c</code> will be running the slave processes.</p><div class="section" title="Installing Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec57"/>Installing Mesos</h2></div></div></div><p>Below are the steps for installing a multi-node Mesos cluster on your private datacenter.</p><div class="section" title="Preparing the environment"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec32"/>Preparing the environment</h3></div></div></div><p>We need to install all the<a class="indexterm" id="id325"/> dependencies and libraries for Mesos to run on the CentOS machines. For this to happen we<a class="indexterm" id="id326"/> need to log in to all three machines and type in the following commands:</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Note that the following are the instructions for stock CentOS 6.6. If you are using a different OS, please<a class="indexterm" id="id327"/> install the packages accordingly.</p></div></div><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># Issue the following command to install the wget command for your centos machine</strong></span>
<span class="strong"><strong>$ sudo yum install -y tar wget</strong></span>
<span class="strong"><strong># We will need c++11 support which is available in the devtoolset-2. For that you will have to add it to the repo and then issue theinstallation command as follows:</strong></span>
<span class="strong"><strong>$ sudo wget -O /etc/yum.repos.d/slc6-devtoolset.repohttp://linuxsoft.cern.ch/cern/devtoolset/slc6-devtoolset.repo# Import the CERN GPG key.</strong></span>
<span class="strong"><strong>$ sudo rpm --importhttp://linuxsoft.cern.ch/cern/centos/7/os/x86_64/RPM-GPG-KEY-cern</strong></span>
<span class="strong"><strong># Fetch the Apache Maven repo file.</strong></span>
<span class="strong"><strong>$ sudo wget http://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo -O /etc/yum.repos.d/epel-apache-maven.repo</strong></span>
<span class="strong"><strong># 'Mesos &gt; 0.21.0' requires 'subversion &gt; 1.8' devel package, </strong></span>
<span class="strong"><strong># which is not available in the default repositories.</strong></span>
<span class="strong"><strong># Add the WANdisco SVN repo file: '/etc/yum.repos.d/wandisco-svn.repo' with content:</strong></span>
<span class="strong"><strong>[WANdiscoSVN]</strong></span>
<span class="strong"><strong>name=WANdisco SVN Repo 1.8</strong></span>
<span class="strong"><strong>enabled=1</strong></span>
<span class="strong"><strong>baseurl=http://opensource.wandisco.com/centos/6/svn-1.8/RPMS/$basearch/</strong></span>
<span class="strong"><strong>gpgcheck=1</strong></span>
<span class="strong"><strong>gpgkey=http://opensource.wandisco.com/RPM-GPG-KEY-WANdisco</strong></span>

<span class="strong"><strong># Now we can install the development tools which will contain the utilities like make for your our installation</strong></span>
<span class="strong"><strong>$ sudo yum groupinstall -y "Development Tools"</strong></span>
<span class="strong"><strong># Install 'devtoolset-2-toolchain' which includes GCC 4.8.2 and related packages.</strong></span>
<span class="strong"><strong>$ sudo yum install -y devtoolset-2-toolchain</strong></span>
<span class="strong"><strong># Now we can install the mesos related dependency for centos.</strong></span>
<span class="strong"><strong>$ sudo yum install -y apache-maven python-devel java-1.7.0-openjdk-devel zlib-devel libcurl-devel openssl-develcyrus-sasl-devel cyrus-sasl-md5 apr-devel subversion-devel apr-util-devel</strong></span>
<span class="strong"><strong># Now we can enable the devtoolset for the shell.</strong></span>
<span class="strong"><strong>$ scl enable devtoolset-2 bash</strong></span>
<span class="strong"><strong>$ g++ --version</strong></span>
<span class="strong"><strong># At this point make sure we get the gcc+ version &gt; 4.8.</strong></span>
</pre></div></div></div><div class="section" title="Downloading Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec58"/>Downloading Mesos</h2></div></div></div><p>Follow the steps from the corresponding <a class="indexterm" id="id328"/>
<span class="emphasis"><em>Downloading Mesos</em></span> subsection under the <span class="emphasis"><em>Setting up a multi-node Mesos cluster on Amazon Web Services (AWS)</em></span> section to download and extract Mesos on the master machine.</p></div><div class="section" title="Building Mesos"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec59"/>Building Mesos</h2></div></div></div><p>We can follow the steps <a class="indexterm" id="id329"/>as mentioned in the previous section to build Mesos on the master machine.</p><p>Now, we can copy the build directory from <code class="literal">machine-a</code> to <code class="literal">machine-b</code> and <code class="literal">machine-c</code> from the master machine:</p><div class="informalexample"><pre class="programlisting">machine-a:~$ rsync -za mesos machine-b:
machine-a:~$ rsync -za mesos machine-c:</pre></div></div><div class="section" title="Starting mesos-master"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec60"/>Starting mesos-master</h2></div></div></div><p>Issue the following <a class="indexterm" id="id330"/>command from the master machine to start <code class="literal">mesos-master</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>machine-a:~/mesos/build$ ./bin/mesos-master.sh --work_dir=/var/lib/mesos --ip=192.168.1.10</strong></span>
</pre></div></div><div class="section" title="Starting mesos-slaves"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec61"/>Starting mesos-slaves</h2></div></div></div><p>Now, we can<a class="indexterm" id="id331"/> issue the following command from the slave machines to start the slave services:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>machine-b:~/mesos/build$ ./bin/mesos-slave.sh --  master=192.168.1.10:5050</strong></span>
<span class="strong"><strong>machine-c:~/mesos/build$ ./bin/mesos-slave.sh --  master=192.168.1.10:5050</strong></span>
</pre></div><p>We can now make sure the installation is complete by looking at the Mesos Web UI running on port <code class="literal">5050</code> on the master machine.</p><p>Open your browser and head on to the following URL: <code class="literal">http://192.168.1.10:5050</code>:</p><div class="mediaobject"><img alt="Starting mesos-slaves" src="graphics/B05186_03_33.jpg"/></div></div><div class="section" title="Automating the process when you have many machines"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec62"/>Automating the process when you have many machines</h2></div></div></div><p>We can repeat the <a class="indexterm" id="id332"/>previous procedure to manually start <code class="literal">mesos-slave</code> on each of the slave nodes to set up the cluster, but this is labor-intensive and error-prone for large clusters. Mesos includes a set of scripts in the <code class="literal">deploy</code> folder that can be used to deploy Mesos on a cluster. These scripts rely on SSH to perform the deployment.</p><p>We will set up a cluster with 10 slave nodes (<code class="literal">slave1</code>, <code class="literal">slave2</code>, <code class="literal">slave10</code>) and a master node (master).</p><p>Let's configure our cluster to make sure that they have connectivity between them after installing all the prerequisites on all the nodes. The following commands will generate an SSH key and will copy them to all the slaves:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>master:~ $ ssh-keygen -f ~/.ssh/id_rsa -P ""</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave1</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave2</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave3</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave4</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave5</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave6</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave7</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave8</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave9</strong></span>

<span class="strong"><strong>master:~ $ ssh-copy-id -i ~/.ssh/id_rsa.pub slave10</strong></span>
</pre></div><p>We need to copy the Mesos build to all the nodes at the same location, as in the master:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>master:~ $ scp –R build slave1:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave2:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave3:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave4:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave5:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave6:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave7:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave8:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave9:[install-prefix]</strong></span>
<span class="strong"><strong>master:~ $ scp –R build slave10:[install-prefix]</strong></span>
</pre></div><p>Create a masters file in the <code class="literal">[install-prefix]/var/mesos/deploy/masters</code> directory with an editor of your choice to list the masters one per line, which in our case will be only the following one:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>master:~ $ cat [install-prefix]/var/mesos/deploy/masters</strong></span>
<span class="strong"><strong>master</strong></span>
</pre></div><p>Similarly, the<a class="indexterm" id="id333"/> slaves file will list all the nodes that we want to be Mesos slaves:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>master:~ $ cat [install-prefix]/var/mesos/deploy/slaves</strong></span>
<span class="strong"><strong>slave1</strong></span>
<span class="strong"><strong>slave2</strong></span>
<span class="strong"><strong>slave3</strong></span>
<span class="strong"><strong>slave4</strong></span>
<span class="strong"><strong>slave5</strong></span>
<span class="strong"><strong>slave6</strong></span>
<span class="strong"><strong>slave7</strong></span>
<span class="strong"><strong>slave8</strong></span>
<span class="strong"><strong>slave9</strong></span>
<span class="strong"><strong>slave10</strong></span>
</pre></div><p>Now, we can start the cluster with the <code class="literal">mesos-start-cluster</code> script and use <code class="literal">mesos-stop-cluster</code> to stop it:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>master:~ $ mesos-start-cluster.sh</strong></span>
</pre></div><p>This in turn calls <code class="literal">mesos-start-masters</code> and <code class="literal">mesos-start-slaves</code> that will start the appropriate processes on the master and slave nodes. The script looks for any environment <a class="indexterm" id="id334"/>configurations in <code class="literal">[install-prefix]/var/mesos/deploy/mesos-deploy-env.sh</code>. Also, for better configuration management, the master and slave configuration options can be specified in separate files in <code class="literal">[install-prefix]/var/mesos/deploy/mesos-master-env.sh</code> and <code class="literal">[install-prefix]/var/mesos/deploy/mesos-slave-env.sh</code>.</p></div></div>
<div class="section" title="Debugging and troubleshooting"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Debugging and troubleshooting</h1></div></div></div><p>In this section, we<a class="indexterm" id="id335"/> will look at how to troubleshoot and debug the common issues<a class="indexterm" id="id336"/> faced during setup.</p><div class="section" title="Handling missing library dependencies"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec63"/>Handling missing library dependencies</h2></div></div></div><p>Sometimes, when you try to build Mesos on a brand new Linux VM, it may throw up errors in the configure step. An example is a missing <code class="literal">libz-dev</code> package:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>configure: error: cannot find libz</strong></span>
<span class="strong"><strong>-------------------------------------------------------------------</strong></span>
<span class="strong"><strong>libz is required for Mesos to build.</strong></span>
<span class="strong"><strong>-------------------------------------------------------------------</strong></span>
</pre></div><p>Whenever you<a class="indexterm" id="id337"/> find an error such as the preceding one or something similar to a missing package, the next thing that you need to do is to install these missing packages and execute the <code class="literal">configure</code> command again.</p><p>Here, to resolve the<a class="indexterm" id="id338"/> missing <code class="literal">libz</code> library, you will have to type in the following on the <span class="emphasis"><em>Ubuntu</em></span> machine:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get install libz-dev</strong></span>
</pre></div><p>For <span class="emphasis"><em>CentOS</em></span> flavors, the command will be as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ yum install zlib-devel</strong></span>
</pre></div></div><div class="section" title="Issues with directory permissions"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec64"/>Issues with directory permissions</h2></div></div></div><p>If Mesos is trying to write to <code class="literal">/var/lib/mesos</code> and if you missed assigning the correct permissions over the<a class="indexterm" id="id339"/> directory, this will end up with the following error:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mkdir: cannot create directory '/var/lib/mesos': Permission denied</strong></span>
</pre></div><p>To overcome such issues, you will have to assign proper permission to this directory with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo chown `whoami` /var/lib/mesos</strong></span>
</pre></div></div><div class="section" title="Missing Mesos library (libmesos*.so not found)"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec65"/>Missing Mesos library (libmesos*.so not found)</h2></div></div></div><p>Whenever you get <span class="strong"><strong>libmesos*.so file not found</strong></span>, then the best thing you can do is to <span class="emphasis"><em>copy</em></span> the <code class="literal">libmesos*.so</code> from<a class="indexterm" id="id340"/> your Mesos installation to the <code class="literal">/lib</code> directory.</p><p>An example of <a class="indexterm" id="id341"/>such an error is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/home/akhld/mesos/build/src/.libs/test-executor: error while loading shared libraries: libmesos-0.25.0.so: cannot open shared object file: No such file or directory</strong></span>
</pre></div></div><div class="section" title="Debugging a failed framework"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec66"/>Debugging a failed framework</h2></div></div></div><p>Sometimes, if your<a class="indexterm" id="id342"/> cluster is not configured properly or you have a buggy framework, then it will not succeed in its execution. In such a situation, you can open up the Mesos web interface and click on the failed <span class="strong"><strong>Framework</strong></span> under the <span class="strong"><strong>Frameworks</strong></span> tab, as follows:</p><div class="mediaobject"><img alt="Debugging a failed framework" src="graphics/B05186_03_34.jpg"/></div><p>Here, you can see<a class="indexterm" id="id343"/> the tasks marked as <span class="strong"><strong>KILLED</strong></span> for some reason, and your next step is to find out why.</p><div class="section" title="Understanding the Mesos directory structure"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec33"/>Understanding the Mesos directory structure</h3></div></div></div><p>On every slave machine, by<a class="indexterm" id="id344"/> default, the Mesos work directory lies under <code class="literal">/tmp/mesos</code>, and under <code class="literal">/tmp/mesos/slaves/</code> will have <code class="literal">slave id</code>, which will keep track of the frameworks running under it inside the <code class="literal">frameworks</code> directory. The framework will contain the number of attempts that it made to execute the given job, and each run attempt's information will be logged in the <code class="literal">runs</code> directory. You can find the errors and standard output from the <code class="literal">stderr</code> and <code class="literal">stdout</code> files located under the runs. </p><p>Here's an example directory structure with a single executor instance and multiple frameworks:</p><div class="mediaobject"><img alt="Understanding the Mesos directory structure" src="graphics/B05186_03_35.jpg"/></div><p>Now, to track down our<a class="indexterm" id="id345"/> issue, you need to go to the corresponding framework ID and look in the <code class="literal">stderr</code> file, which will log the exact issue that this framework was facing.</p><p>Let's take the following example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cat /tmp/mesos/slaves/63088700-3d5d-4490-a3df-a3f85fe62a01-S1/frameworks/ed4b8897-6c4b-4b14-8575-4a828731785d-0001/executors/default/runs/latest/stderr </strong></span>
<span class="strong"><strong>  /var/lib/mesos/: Permission denied</strong></span>
</pre></div><p>Now that you know the issue is with the directory permission, you can fix this using the steps described in the previous section.</p></div></div><div class="section" title="Mesos slaves are not connecting with Mesos masters"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec67"/>Mesos slaves are not connecting with Mesos masters</h2></div></div></div><p>Issues such as<a class="indexterm" id="id346"/> slaves failing to connect with the master can be resolved in two ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Looking at the slave console logs.<p>You can look at the console logs while the slave tries to connect to the master, and this will show connection failure messages, such as <span class="strong"><strong>Operation timed out</strong></span>, <span class="strong"><strong>Connection refused</strong></span>, <span class="strong"><strong>Network unreachable</strong></span>, and so on.</p></li><li class="listitem" style="list-style-type: disc">Making sure that the <a class="indexterm" id="id347"/>master and slaves bind to the correct network interface.<p>Make sure that your master and slaves bind to the correct network interface; it is always safer to use <code class="literal">--ip</code> option to ensure this.</p></li></ul></div></div><div class="section" title="Launching multiple slave instances on the same machine"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec68"/>Launching multiple slave instances on the same machine</h2></div></div></div><p>If you try to<a class="indexterm" id="id348"/> launch multiple slave processes on the same machine, then you will end up with the following exception:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Failed to initialize, bind: Address already in use [98]</strong></span>
</pre></div><p>If you need to launch more slave instances on a single machine, there is a way to accomplish this.</p><p>You can run one more slave but you have to specify a port and a different <code class="literal">workdir</code> using the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>./mesos-slave.sh --master=&lt;ipaddr&gt;:&lt;port&gt; --ip=&lt;ip of slave&gt; --work_dir=&lt;work_dir other than that of a running slave&gt; --port=&lt;another_port&gt;</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>Can Mesos <code class="literal">master</code> and <code class="literal">slave</code> nodes be deployed on the same machines?</p><p>You can definitely run <code class="literal">master</code> and multiple <code class="literal">slave</code> processes on the same node. You can even run multiple <code class="literal">master</code> and <code class="literal">slave</code> processes on the same node, provided that you give them each unique ports, but this works best only for a test cluster.</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Summary</h1></div></div></div><p>In this chapter, we saw how to manually set up and run a Mesos cluster on the public cloud (AWS, GCE, and Azure) as well as on a private datacenter (on the premises). We also discussed common errors that are faced during the setup process and how these can be debugged and resolved efficiently.</p><p>In the next chapter, we will explore important scheduling and management frameworks, such as Marathon and Chronos, that often go hand in hand with Mesos and are integral components of the Mesos ecosystem.</p></div></body></html>