- en: Chapter 9. Troubleshooting VCM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting tools - EcmDebugEventViewer
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting tools - Job Manager | History
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting tools - Machine Collection Status
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting agent communication issues
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting agent upgrade issues
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting SCR download issues
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting VCM console login failure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting vCenter and vCloud data collection issues
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Troubleshooting the Recommended Action: Investigate Issue Linux server patch
    error'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting not being able to see any jobs on the console
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Troubleshooting not being able to see the Monthly option on the Schedule Job
    page
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Troubleshooting is the process of identifying the source of a problem and eliminating
    it. To start troubleshooting, you start with the most obvious possible problem
    and then pinpoint the exact issue. Doing this requires two things: experience
    of the entity you are troubleshooting and good tools to look at details such as
    logs and error codes.'
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we will talk about both. In the first three recipes, you will
    be introduced to the tools, as they are necessary to gain some expertise in VCM
    troubleshooting, and then, we will look at some general issues and their solutions.
  prefs: []
  type: TYPE_NORMAL
- en: The troubleshooting tools we will cover include **EcmDebugEventViewer.exe**,
    **VCM logs**, **Job Manager | History**, and the **SQL log viewer**. If you are
    good with SQL, you can try SQL trace as well.
  prefs: []
  type: TYPE_NORMAL
- en: The general issues include issues with data collection, issues faced during
    patching, and issues with agent communication.
  prefs: []
  type: TYPE_NORMAL
- en: Agent communication messages are too cryptic; they say **Pingfailed** for every
    issue, You need to check what exactly went wrong.
  prefs: []
  type: TYPE_NORMAL
- en: So, let's get started with troubleshooting VCM.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting tools – EcmDebugEventViewer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can use the EcmDebugEventViewer tool to have a closer look at all the events
    that are stored in the VCM database. This will help you find event errors for
    your environment.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We need access to the VCM OS with admin rights.
  prefs: []
  type: TYPE_NORMAL
- en: The tool is called EcmDebugEventViewer.exe. It is a standalone executable available
    in `C:\Program Files (x86)\VMware\VCM\Tools` (if you installed VCM with defaults).
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This recipe splits is in two parts: starting and filtering.'
  prefs: []
  type: TYPE_NORMAL
- en: Accessing events
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The tool can be launched from its own location, or you can copy the `.exe` file
    anywhere and start. Follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Connect to your VCM OS with administrator rights.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open an Explorer window and browse to `X:\Program Files (x86)\VMware\VCM\Tools`
    (*X* is the drive where you installed VCM).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on **EcmDebugEventViewer.exe** and select **Run as Administrator**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You are now presented with a blank screen. You can choose from three possibilities:
    **Database**, **Collector DB**, or **Open File** to open a saved `.dbe` file.
    For this example, select **Database**.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Press *F5*; it will fetch the content of the logs from the database.![Accessing
    events](img/image_09_001.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click on a line to open more details. The following screenshot shows
    an error message that the VCM server is unable to resolve the mail server.![Accessing
    events](img/image_09_002.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can use the **Up** and **Down** buttons on the details windows to see other
    log entries.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Close** to close the event details.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Filtering events
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'As there are lots of entries, you might want to reduce the amount by deploying
    a filer. Continue with these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Click on **Filter settings** and then define a filtering criteria, such as the
    source or type of the message, as shown in the following screenshot:![Filtering
    events](img/image_09_003.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can also select the specific timeframes that should be shown. Click on **Date/Time**
    in the top menu and modify the duration, as shown in the following screenshot.![Filtering
    events](img/image_09_004.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can export the selected logs by going to **File | Save As dbe**. This will
    save all the lines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To save only selected lines, select the lines and then go to **File | Save Selected
    As dbe.**
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This concludes our overview of the EcmDebugEventViewer tool.
  prefs: []
  type: TYPE_NORMAL
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can open the main `VCM` database as well as the `VCM_Coll` database or any
    saved files.
  prefs: []
  type: TYPE_NORMAL
- en: When you are troubleshooting VCM issues, this is the first place to start. Always
    select the main VCM database as it contains the collected system data from the
    VCM agents along with all the processes it is performing.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take an example:'
  prefs: []
  type: TYPE_NORMAL
- en: You are trying to patch a Linux machine and it is failing, and it is giving
    you the PingFailed error code. You check and find that you are able to ping the
    managed Linux machine and you can Telnet to the port-everything with regards to
    communication with the Linux machine is working fine. The small catch here is
    that VCM first tries to communicate with the SCR server on port `26542`, and if
    that is not accessible for any reason, it just gives you a cryptic PingFailed
    error. Now, if you start the ECMDebug tool, and you have already enabled the debug
    log level to info, you can see that it is trying to communicate with the SCR server
    and failing there.
  prefs: []
  type: TYPE_NORMAL
- en: On further troubleshooting, you find that the agent was not communicating for
    some reason. After restarting it, you can proceed with patching.
  prefs: []
  type: TYPE_NORMAL
- en: The next option is the VCM collection database. The `VCM_Coll` database contains
    information about the UI, such as Collector settings and options. To be frank,
    I have hardly used it, so I don't really have a use case.
  prefs: []
  type: TYPE_NORMAL
- en: The last option is opening a DBE file. The VCM agent also saves its own logs
    in the `.dbe` file format, so to troubleshoot agent issues, you can copy the file
    from an agent to the server and read it, or someone can send you a saved `.dbe`
    file from their VCM installation, and after going through the file, you can provide
    suggestions. When you work with VMware, they will ask you to generate this `.dbe`
    file and send it to them so that they can review it and get back with some solution.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting tools – Job Manager | History
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The History tool is built in to VCM. With this tool, you can look at the status
    of the jobs completed earlier, and it gives you the logs to further troubleshoot.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You will need access to the VCM console and basic understanding of VCM to roam
    around the console.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To look at details about the jobs completed earlier, launch the VCM console
    and go to **Administration **| **Job Manager** | **History**.
  prefs: []
  type: TYPE_NORMAL
- en: 'You have four options here: **Instant Collections**, **Scheduled Collections**,
    **Other Jobs**, and **VCM remote**. If you are not troubleshooting collection
    issues, then you most probably need to go to **Other jobs** and select the job
    in the top-left pane, and the details will be visible in the bottom pane.'
  prefs: []
  type: TYPE_NORMAL
- en: Select **Job History** and click on **View Details**. If the job had multiple
    machines, you will get an option to choose either of them, and then you can see
    what went wrong.
  prefs: []
  type: TYPE_NORMAL
- en: In the following screenshot, when we hover over **Status**, we can see that
    there is something wrong with **Mutual authentication**.
  prefs: []
  type: TYPE_NORMAL
- en: We can use the M**enu** option at the top to copy the data, and it can then
    can be used to search on the Internet or provide an exact log to VMware for further
    troubleshooting.
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_09_005.jpg)'
  prefs: []
  type: TYPE_IMG
- en: VCM Job Manager | History
  prefs: []
  type: TYPE_NORMAL
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Every time VCM performs a scheduled or on-demand job, it is captured at this
    location; you can have a look at them and see whether they failed or were successful.
    If they fail, it will give you errors, which you can use for further troubleshooting.
  prefs: []
  type: TYPE_NORMAL
- en: When you click on a job and select **View Details**, it will give you a popup
    to either have a look at the selected machine or all machines. You have an option
    to resubmit the job from here.
  prefs: []
  type: TYPE_NORMAL
- en: Let's have a look at a real-life experience. We were not able to patch a Linux
    server. We had configured the SCR server and VCM as expected, but it was still
    failing. After checking the logs here, we found that VCM is looking for a file
    called `REDHAT-rt.ptoperties`, while as per the documentation, we had configured
    file called `redhat-rt.properties`. After correcting the name of the file (to
    capital letters), we were able to patch the server.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting tools – Machine Collection Status
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Machine Collection Status** in the VCM console is where you can see what
    data is collected from which server and whether it is a full collection or a delta.
    This can come in handy when you are troubleshooting data collection issues.'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You will need access to the VCM console and basic understanding of VCM to roam
    around the console.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Go to **Administration **| **Machines Manager | Machine Collection Status**.
  prefs: []
  type: TYPE_NORMAL
- en: As mentioned, we can have a look at what data was collected, which filter set
    was used, and which filters were successful in obtaining the data.
  prefs: []
  type: TYPE_NORMAL
- en: Let's assume you are creating a machine group with a specific dynamic rule and
    the machines are not getting populated, perhaps because the datatype you are using
    for filtering was not collected.
  prefs: []
  type: TYPE_NORMAL
- en: You are running a report for compliance and see **Data not Available** for performing
    the compliance test; as stated, perhaps the data was not collected.
  prefs: []
  type: TYPE_NORMAL
- en: You can see the details by applying lots of filters in the console, as this
    will be a large table to look at if you have a big infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_09_006.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Machine collection logs in VCM under Administration
  prefs: []
  type: TYPE_NORMAL
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When we collect data from managed machines, what we collect and when we made
    the collection is logged there.
  prefs: []
  type: TYPE_NORMAL
- en: We were working with an RHEL 7 machine to collect the data. The job was successful,
    but when we tried patching the server, it did not show the status, that is, whether
    the patch is required or not. When we checked in the Machine Collection Status
    tool, we did not find our machine, which means that details were not getting captured.
    After checking the logs, we concluded that the VCM collector was not able to capture
    details. After resolving the issue with the machine, we performed another collect
    operation and found that the details are available and the machine is listed in
    Machine Collection Status.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting agent communication issues
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now, we will have a look at multiple issues faced with agent communication and
    how they can be resolved.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this recipe, we will have a look at the following issues:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Issue 01: Mutual Authentication failed*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Issue 02: Rethrown certificate issue*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Issue 03: PingFailed*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Issue 04: CredentialsFailed*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Issue 01: Mutual Authentication failed'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Mutual authentication failure may happen after an upgrade. When you try to
    collect data, it fails with the error, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Issue 01: Mutual Authentication failed](img/image_09_007.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'VCM agent communication issue : **Mutual Authentication Failed**'
  prefs: []
  type: TYPE_NORMAL
- en: You can see the error under **Administration **| **Job Manager **| **Instant
    Collection**.
  prefs: []
  type: TYPE_NORMAL
- en: Then, select the appropriate subsection. After that, select the **Job** in the
    top-left pane, and you'll be able to see the details in the bottom-left pane.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To resolve the issue, follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Select the machine for which you are not able to collect data.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Re-establish Mutual Authentication** (the handshake symbol on the
    menu bar).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the machine or machines that are facing the issue.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on **Finish** to close the wizard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Confirm that the issue was resolved by performing the collection again.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Issue 02: Rethrown certificate issue'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Agent-server communication is based on the certificate we use while installing
    the agent; if the certificate on the agent does not match the certificate on the
    server, then you will get the following error message:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Issue 02: Rethrown certificate issue](img/image_09_008.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'VCM agent communication: the rethrown certificate issue'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To resolve the issue, do the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Reinstall the agent with the correct certificate and perform the collection
    again.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the case of a Linux server, use the installer from the correct VCM server,
    as the certificate is embedded in the installer.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Issue 03: PingFailed'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This issue could be because of many things:'
  prefs: []
  type: TYPE_NORMAL
- en: DNS resolution for the managed machine is not working
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The firewall is blocking port 26542 (either on the agent or between the server
    and agent)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The service is not running
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The agent is not installed
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The machine is powered off
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There are issues in routing; hence, the machine IP is not reachable
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Issue 03: PingFailed](img/image_09_009.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'VCM agent communication issue: PingFailed'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To resolve the issue, follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Make sure the managed machine is powered on.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Ping the managed machine with the hostname or FQDN and see whether the IP is
    resolved.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Use the following commands:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Make sure the latter two hostnames resolve the same IP, and the first command
    gives the correct hostname. It has been observed that sometimes the name resolution
    does not work as intended and needs corrections.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Trace the IP from the VCM server to check whether the machine can be reached
    from the VCM server and there are no routing issues; if there are any, add the
    required routes.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Use the following command to do this:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'From the managed server, run this command:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You must be able to reach from both the sides.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Check the Telnet port 26542 from the VCM server; if it isn't working, check
    the local firewall on the managed machine. If that is disabled as well, check
    with the networking and security teams whether there is a firewall between the
    managed machine and VCM server and whether it has port 26542 open.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'From the VCM server, try following command:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: For more on the required ports, have a look at the *Understanding the requirements
    of VCM* section of [Chapter 1](ch01.html "Chapter 1. Installing VCM"), *Installing
    VCM*.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Check the firewall on the local server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This should either be disabled or should have the required ports open.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'The procedure is different for Windows and Linux. Have a look at the following
    articles:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**For Windows**: [https://technet.microsoft.com/en-us/library/cc753558.aspx](https://technet.microsoft.com/en-us/library/cc753558.aspx)'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**For RedHat**: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-Firewalls-Common_IPTables_Filtering.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-Firewalls-Common_IPTables_Filtering.html)'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Check whether CMAgent is installed. This can be done in multiple ways:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**For Windows**:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Check whether the CMagnet service is available.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Check whether the `C:\Windows\CMAgent` folder is present and is not empty.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Check whether CMAgent is listed in **Add/Remove Programs**.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '**For Linux**:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Run `netstat -an | grep 26542`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Make sure the service is listening on port `26542`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Check whether the service is running by executing this command:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'The command should return `tcp 0 0 :csi-agent *: LISTEN`.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Monitor processes with the top utility. If the top utility is installed and
    available, you can use it to monitor processes. Here''s how:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Start the top utility.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Type `u`.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: At the **Which User (Blank for All):** prompt, type the user account that the
    agent is installed as ( `csi_acct` ).
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Type `s`.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: At the D**elay between updates:** prompt, type `1`.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Check whether the CMAgent service is running.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Follow the OS-specific actions to check the status.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**For Windows**:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Run `services.msc` and make sure the **CM Socket Listener** service has been
    started.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**For Linux**:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Log in to the managed server with root privileges.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Go to `/etc/init.d`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Execute `./csi-service status` and make sure it is running.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Issue 04: CredentialsFailed'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As shown in the following screenshot, you might get an error called **CredentialsFailed**.
    This happens when the network authority account configured for the managed machine
    does not have rights on the managed machine.
  prefs: []
  type: TYPE_NORMAL
- en: Chances are, the machine you are managing is either from another domain or in
    a workgroup, and you did not add the required credentials as the network authority
    account.
  prefs: []
  type: TYPE_NORMAL
- en: '![Issue 04: CredentialsFailed](img/image_09_010.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'VCM agent communication issue: **CredentialsFailed**'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Have a look at the *Patching machines in multi-domain environments and workgroups*
    recipe in [Chapter 4](ch04.html "Chapter 4. Windows Patching"), *Windows Patching*,
    and the *Adding a network authority account to manage machines in multiple domains *recipe
    in  [Chapter 2](ch02.html "Chapter 2. Configuring VCM to Manage Your Infrastructure"), *Configuring 
    VCM to Manage Your Infrastructur*e, then add the appropriate network authority
    account for the managed machine and try collection again.
  prefs: []
  type: TYPE_NORMAL
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We discussed multiple issues here: VCM must communicate with the agents if
    we want to manage them. VCM agent communication is based on the certificate on
    the server; if that is not as expected, then the server won''t communicate, and
    we need to replace that by reinstalling the agent with the correct certificate.'
  prefs: []
  type: TYPE_NORMAL
- en: We need to make sure that we can resolve the hostname of the managed machine
    and connect on port 26542, so open firewall ports in between.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting agent upgrade issues
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After upgrading VCM to version 5.8.1, you might face some issues while upgrading
    the agent to the latest version. The upgrade fails, but if you choose **Install **
    **with Remove Current version** from the VCM console, then the agent gets installed/upgraded
    to the latest version.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that this issue has been resolved in the latest version of VCM at the time
    of writing this book, that is, VCM 5.8.2\. This is applicable only if you are
    upgrading to VCM 5.8.1.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When you select a machine on the VCM console, choose the Upgrade option, and
    run the job, it should fail while creating the service on the managed machines
    and throw an error as per the following code, which is present in `C:\Windows\CMAgent`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the 5.8.1 release, VMware promoted the HTTP listener module, which stops
    the listener service before upgrading while the Collector is waiting for it. The
    Collector contacts the agent for the upgrade status when the listener is being
    upgraded. As a result, the collector receives a ping failed response, and it signals
    the collector to FAIL the upgrade job.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following setting allows the collector to fall back to DCOM when the HTTP
    connection fails:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the following query in the SQL management server while selecting VCM as
    the database:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Also, correct the module filename of `ECMSocketListenerService` using this
    query:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Restart the SSRS and VCM collector service.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After that, you can upgrade the agent from the console.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting SCR download issues
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As you know, SCR is a tool that is used to synchronize patches for Linux/Unix
    operating systems from vendor sites to local repositories. Sometimes, the synchronization
    fails and can't download content from vendor sites.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We are able to log in to the RedHat portal with the same account, but the patch
    download fails with an error. When we try to synchronize patches with vendors
    (in this case, RedHat) from SCR, it throws an error, as shown in the following
    code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: As it indicates an issue with login, the first suspect is, as always, the account
    used to synchronize the repository with RHN. We can log in with the same account
    on RHN, and if we try changing to another account, the problem still persists.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The resolution for this is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Resynchronize the SCR Tool with the RedHat repository.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select the SCR Tool output folder and delete all of the `SystemId*.xml` files:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Take a backup of the files by running the following command for each file:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The path to the `unix` folder is located in the `properties` file and is defined
    using the `folder=value` parameter.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: For example, `folder=/PatchRepo/Repos`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Run the replication process manually or allow it to run on schedule:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'The XML files will be created at the earlier location (`/PatchRepo/Repos`)
    and the synchronization will also start:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The real problem was that the source machine information was changed or deleted
    on the **Red Hat Network** (**RHN**).
  prefs: []
  type: TYPE_NORMAL
- en: When we delete the XML files and restart the synchronization, the machine information
    is updated again and we are allowed to download patches from RHN.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting VCM console login failure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You are trying to log in to VCM and it throws an error: **Your ID is disabled**.'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You will need access to SQL server to resolve the issue.
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/image_09_011.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Consider this: you do not have anyone who can help you enable the ID or, even
    worse, you were setting up the VCM and still haven''t added anyone, so yours is
    the only account that can log in and make the necessary settings.'
  prefs: []
  type: TYPE_NORMAL
- en: No worries; we have a solution.
  prefs: []
  type: TYPE_NORMAL
- en: You will need SQL Managemnt Studio and access to your SQL server that holds
    the VCM DB.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to unlock the user:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to the VCM SQL server and launch SQL Management Studio.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select VCM as the database and run the first query:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: This will show all the users with their login IDs.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Note the login ID for the user you were trying and run the following query:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '`X` is the login ID of the user you noted earlier.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The login is now enabled. Try logging in to the VCM console, and if you were
    the only administrator, start adding others.
  prefs: []
  type: TYPE_NORMAL
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: VCM stores all the information about everything it does in the SQL database.
    In this case, we found that the account we were trying to log in to was locked
    and needed a reset.
  prefs: []
  type: TYPE_NORMAL
- en: After running the first SQL query, we checked the status of the account in the
    database, and as it was locked (that is, `login_active = 0`), we ran another query
    and enabled the account, that is, `login_active = 1`.
  prefs: []
  type: TYPE_NORMAL
- en: After that, we can log in to the VCM console.
  prefs: []
  type: TYPE_NORMAL
- en: It is recommended to have an AD group added to the VCM for administration purposes
    as described in the *Managing users* recipe in [Chapter 7](ch07.html "Chapter 7. Maintenance
    of VCM"), *Maintenance of  VCM*.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting vCenter and vCloud data collection issues
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The issue: when trying to collect data from vCenter and vCloud Director, the
    operation fails.'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You should have the following problem: when you try to collect data from either
    vCenter or vCloud Director, it either fails or you are not able to see any details
    in the VCM console, under **Console **| **Virtual Environments**.'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There could be few reasons for this.
  prefs: []
  type: TYPE_NORMAL
- en: 'The details of the error or failure can be seen with the **EcmDebugEventViewer**
    tool or in **Job manager | History**; based on the error codes, you can try any
    or all of the following solutions:'
  prefs: []
  type: TYPE_NORMAL
- en: The credentials set while configuring vCenter and/or vCloud may not be right;
    try changing them.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The certificate thumbprint set while configuring vCenter and/or vCloud may not
    be correct.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If this is the case, then under **Job manager | History**, VCM will show the
    configured thumbprint and expected thumbprint; you can copy the expected thumbprint.
    Make sure it's correct, and then, change the wrong certificate thumbprint.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: As you know, we have filter sets, and most of the time, we choose the default
    filter set for performing collection. Validate the default filter set and see
    whether it has all the vCenter and/or vCloud-related filters present; if not,
    add them and perform a collection.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The setting is available under **Administration**|**Collection Filters**| **Filter
    Sets**. Select **Default Filter**, click on **Edit**, and add any missing vCenter
    and/or vCloud filters, as shown in the following screenshot.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'You can define a filter to limit the filters with criteria like in the screenshot:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_09_012.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: This will limit the filters to only vCenter, vCloud, and vShield. Make sure
    these are part of the default filter set; if not, then use the down arrow to add
    all of them to the default filter, and click on **Next**. Complete the wizard
    and then perform a collection for vCenter, vCloud, and/or vShield. It will work.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it...](img/image_09_013.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Modifying the default filter set
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: VCM uses filter sets, and those include filters to collect data from various
    managed objects. Filters define what data needs to be collected, such as operating
    system name, some registry value, or file permissions. There are thousands of
    filters available, and not all filters are used in one filter set. We have a default
    filter set, which includes filters for all the managed machine types, such as
    vCenter, vCloud Director, Windows, and Linux. Sometimes, certain required filters
    go missing from the filter set. We then need to add them back so that the next
    time we use them to collect details, VCM will know what data needs to be collected.
  prefs: []
  type: TYPE_NORMAL
- en: In this troubleshooting recipe, we did the same thing and added missing filters
    to the default filter set.
  prefs: []
  type: TYPE_NORMAL
- en: 'Troubleshooting the Recommended Action: Investigate Issue Linux server patch
    error'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'When trying to patch a Linux server, you might get a message saying **Recommended
    Action: Investigate Issue** and hence are not able to patch the server.'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The error will look like the following screenshot. The recommended action is
    **Investigate Issue**:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/B05400_09_15.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To resolve the issue, follow these steps on the VCM database:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run this SQL query to know the `machine_id` for which it shows **Investigate
    Issue**:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The machine name is the name of the service creating issues.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Update the timestamp for that `machine_id` value using the following query:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Carry out another assessment on that machine, and it will tell you that patches
    are required.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Troubleshooting not being able to see any jobs on the console
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The issue: VCM is not running or showing any jobs. When jobs are started manually,
    they are not being executed, rendering VCM close to useless.'
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When we run any job such as data collection, patching, or compliance checks,
    they might not start and be absent from the **Jobs** window. Because of this,
    there is no update in the VCM database, you can't patch a managed machine, and
    compliance checks can't be executed.
  prefs: []
  type: TYPE_NORMAL
- en: We need access to the SQL server hosting the VCM database.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Here is the resolution. To determine whether the SQL Server Service Broker
    is enabled, run the following script in SQL Server using SQL Server Management
    Studio:'
  prefs: []
  type: TYPE_NORMAL
- en: Launch SQL Server Management Studio and create a new query, as follows.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Check whether the value of `is_broker_enabled` is `0` (zero) for the VCM database,
    and re-enable the SQL Server Service Broker by running the following script in
    SQL Server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Here, `db-name` is the name of your VCM database. The database name is VCM by
    default.
  prefs: []
  type: TYPE_NORMAL
- en: How it works
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: With Service Broker, a feature in Microsoft SQL Server, internal or external
    processes can send and receive guaranteed, asynchronous messages. Messages can
    be sent to a queue in the same database as the sender, to another database in
    the same SQL Server instance, or to another SQL Server instance either on the
    same server or on a remote server. We fixed the broken broker service on the VCM
    database so that it can function again.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting not being able to see the Monthly option on the Schedule Job
    page
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Sometimes, it may happen that when we are trying to schedule something in VCM,
    when we are about to complete the wizard, on the schedule page, the **Monthly**
    option is disabled (grayed out), and we can't set a monthly schedule.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The **Monthly** scheduling option is disabled, as shown here**:**
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/image_09_015.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The monthly scheduling option is **disabled** if the time zone setting of the
    VCM user launching the console is different from the VCM database's time zone
    setting.
  prefs: []
  type: TYPE_NORMAL
- en: Make sure the time zone of the machine that is used to connect to the VCM server
    is the same as the VCM database server's.
  prefs: []
  type: TYPE_NORMAL
