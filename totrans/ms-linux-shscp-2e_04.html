<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Creating Code Snippets</h1>
                </header>
            
            <article>
                
<p>Now we can write our conditional tests to make decisions. After your hands become faster in coding, you will need to save some code pieces for later use, so how to save time and effort when writing scripts?</p>
<p>If you like using the command line, but also like some of the features associated with using graphical <strong>integrated development environments</strong> (<strong>IDEs</strong>), then this chapter may reveal some new ideas to you. We can create shortcuts for commonly used script elements using the vi or vim text editors from the command line.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Abbreviations</li>
<li>Using code snippets</li>
<li>Creating snippets using VS Code</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>The source code for this chapter can be downloaded from here:</p>
<p><a href="https://github.com/PacktPublishing/Mastering-Linux-Shell-Scripting-Second-Edition/tree/master/Chapter04">https://github.com/PacktPublishing/Mastering-Linux-Shell-Scripting-Second-Edition/tree/master/Chapter04</a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Abbreviations</h1>
                </header>
            
            <article>
                
<p>We have already taken one short sojourn into the <kbd>~/.vimrc</kbd> file and we will now revisit this file to look at abbreviations or <kbd>abbr</kbd> controls. This file acts as the run control mechanism for the vim text editor, which is likely to be installed on your Linux distribution. Older distributions or Unix variants may have the original vi text editor and will make use of the <kbd>~/.exrc</kbd> file. If you are uncertain of the identity of your version of vi and the correct run control file to use, simply enter the <kbd>vi</kbd> command. If a blank page opens, it is indeed vi. However, if a new blank document opens with the vim splash screens, then you are using the improved vim or vi.</p>
<p>Abbreviations allow for a shortcut string to be used in place of a longer string. These abbreviations can be set during a vim session from the last line mode but <span>are often set in the control file. The shebang can be easily represented by an abbreviation, as follows:</span></p>
<pre class="CodeEndPACKT"><span><strong>abbr _sh #!/bin/bash</strong><br/></span></pre>
<p class="NormalPACKT"><span>The basic syntax of an abbreviation is shown in the following command:</span></p>
<pre class="CodeEndPACKT"><strong><span>abbr &lt;shortcut&gt;&lt;string&gt;<br/></span></strong></pre>
<p>Using this abbreviation, we just need to type <kbd>_sh</kbd> while in the edit mode. On pressing the <em>Enter</em> key after the shortcut code, the full text for the shebang is printed. In reality, pressing any key after the <kbd>abbr</kbd> code will expand the shortcut, not just pressing the <em>Enter</em> key. Simple elements like this can add a lot to the experience of using vim as our text editor. The following screenshot shows the updated <kbd>~/.vimrc</kbd> file:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-46 image-border" src="assets/18a71227-66b4-4c86-92c2-be640ebb9c92.png" style="width:33.17em;height:9.75em;"/></div>
<p>We are not limited to the single abbreviation code, as we can add more <kbd>abbr</kbd> entries, for example, to support the shebang for Perl scripts at the line:</p>
<pre class="CodeEndPACKT"><strong><span>abbr _pl #!/usr/bin/perl<br/></span></strong></pre>
<p>The use of the underscore is not required, but the aim is to keep the shortcut code unique and not to have a typed error. We are also not limited to a single line, although this is where abbreviations are most used. Consider the following abbreviation for an <kbd>if</kbd> statement:</p>
<pre class="CodeEndPACKT"><strong><span>abbr _if if [-z $1];then&lt;CR&gt;echo "&gt; $0 &lt;name&gt;&lt;CR&gt;exit 2&lt;CR&gt;fi</span></strong></pre>
<p>Although this does work, the formatting of the <kbd>if</kbd> statement will not be perfect and multiline abbreviations are far from ideal. This is where we may consider using code snippets that we have prepared in advance.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using code snippets</h1>
                </header>
            
            <article>
                
<div>
<p>All we mean by the term <em>code snippets</em> is a prepared code that we can read into our current script. This is especially easy with vim being able to read the contents of other text files during editing:</p>
<pre class="CodePACKT"><span>ESC<br/></span><span>:r &lt;path-and-filename&gt;</span></pre>
<p>For example, if we need to read the contents of a file called <kbd>if</kbd> located in <kbd>$HOME/snippets</kbd>, we will use the following key sequences in vim:</p>
<pre class="CodePACKT"><span>ESC<br/></span><span>:r $HOME/snippets/if</span></pre>
<p class="NormalPACKT"><span>The contents of this file are read into the current document below the current cursor position. In this way, we can make the code snippets as complex as we need and maintain the correct indentations to aide readability and consistency.</span></p>
<p class="NormalPACKT"><span>So, we will make it our duty to always create a snippets directory in our <kbd>home</kbd> directory:</span></p>
<pre class="CommandLineEndPACKT"><strong><span class="CodeHighlightedPACKT"><span>$ mkdir -m 700 $HOME/snippets</span></span></strong></pre>
<p>It is not required to share the directory, so it is good practice to set the mode to <kbd>700</kbd> or private to the user when it is being created.</p>
<p>When creating snippets, it is your choice to use a pseudo-code or real examples. My preference is to use real examples that are edited to reflect the requirements of the recipient script. The contents of a simple <kbd>if</kbd> snippet will be as follows:</p>
</div>
<pre class="CodePACKT"><span>if [ -z $1 ] ; then<br/></span>   echo "Usage: $0 &lt;name&gt;"<br/>   exit 2<br/>fi</pre>
<p>This gives us the layout to create an <kbd>if</kbd> statement with a practical example. In this case, we check to see whether <kbd>$1</kbd> is unset and send an error to the user before exiting the script. The key is in keeping the snippet short to limit the changes that need to be made but make it easily understood and expandable as required.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Bringing color to the Terminal</h1>
                </header>
            
            <article>
                
<p>If we are to display text messages to the users and operators executing the scripts, we can provide colors to help in message interpretation. Using red as a synonym for errors and green to indicate success makes it easier to add functionality to our scripts. Not all but certainly a vast majority of Linux Terminals support color. The built-in command <kbd>echo</kbd>, when used with the <kbd>-e</kbd> option, can display color to users.</p>
<p>To display a text in red, we can use the <kbd>echo</kbd> command as follows:</p>
<pre class="CommandLineEndPACKT"><strong><span class="CodeHighlightedPACKT"><span>$ echo -e "\033[31mError\033[0m"</span></span></strong></pre>
<p class="NormalPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><span>The following screenshot shows both the code and the output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-47 image-border" src="assets/3756bd4f-60e1-4b74-a125-7bc0accd7f75.png" style="width:29.50em;height:2.58em;"/></div>
<p>The red text will bring immediate attention to the text and the potential failure of the script execution. The use of color in this way adheres to the <span>basic principles of application design</span>. If you find the code cumbersome, then simply use friendly variables to represent the colors and the reset code.</p>
<p>In the previous code, we used red and the final reset code to set the text back to the shell default. We could easily create variables for these color codes and others:</p>
<pre class="CodePACKT"><span>RED="\033[31m"<br/></span><span>GREEN="\033[32m"<br/></span><span>BLUE="\033[34m"<br/></span><span>RESET="\033[0m"</span></pre>
<div class="packt_tip">
<p>The <kbd>\033</kbd> value is the escape character and <kbd>[31m</kbd> is the color code for red.</p>
</div>
<p class="NormalPACKT"><span>We need to take care while using variables, to ensure that they are properly delimited from the text. Modifying the earlier example, we can see how this is easily achieved:</span></p>
<pre class="CommandLineEndPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><strong><span class="CodeHighlightedPACKT"><span>$ echo -e ${RED}Error$RESET"</span></span></strong></pre>
<div class="packt_tip">
<p>We use the brace brackets to ensure that the <kbd>RED</kbd> variable is identified and separated from the <kbd>Error</kbd> word.</p>
</div>
<p>Saving the variable definitions to the <kbd>$HOME/snippets/color</kbd> file will allow them to be used in other scripts. Interestingly, we don't need to edit this script; we can use the command <kbd>source</kbd> to read these variables definitions into the script at runtime. Within the recipient script, we need to add the following line:</p>
<pre><strong>source $HOME/snippets/color</strong></pre>
<p>Using the shell built-in <kbd>source</kbd> command will read the color variables into the script that is executing at runtime. The following screenshot shows a modified version of the <kbd>hello5.sh</kbd> script that we now call <kbd>hello7.sh</kbd>, which makes use of these colors:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-48 image-border" src="assets/9aa3334f-1525-472a-86f4-10a53c330ed5.png" style="width:40.92em;height:15.83em;"/></div>
<p class="NormalPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><span>We can see the effect this has when we execute the script. In the following screenshot, you will see the execution and output both with and without a supplied parameter:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-49 image-border" src="assets/71142b64-9bff-498c-82f2-2c13189ee3bf.png" style="width:21.50em;height:5.92em;"/></div>
<p>We can easily identify the success and failure of the script through the color-coded output; the green <kbd>Hello fred</kbd> where we supply the parameter, and the red <kbd>Usage</kbd> statement where we have not provided the required name.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating snippets using VS Code</h1>
                </header>
            
            <article>
                
<p>For those who love graphical IDEs, you can use VS Code as an editor for your shell scripts. We used it as a debugger in <a href="f439f212-0f5f-4c9d-abdb-9f9b8c199a78.xhtml" target="_blank">Chapter 1</a>, <em>The What and Why of Scripting with Bash</em>. Now we will see one of its capabilities as an editor.</p>
<p>You can create your own snippets in VS Code as follows.</p>
<p>Navigate to <span class="packt_screen">File</span> | <span class="packt_screen">Preferences</span> | <span class="packt_screen">User Snippets</span>.</p>
<p>Then start to type <kbd>shell</kbd>. This will open the <kbd>shellscript.json</kbd> file.</p>
<p>The file has two brackets ready to enter your snippets between them:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-721 image-border" src="assets/d01fff83-5f0a-42a7-aea0-6e15120a8809.png" style="width:43.83em;height:30.25em;"/></div>
<div>
<p class="NormalPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><span>To create a snippet, type the following between the brackets on the file:</span></p>
<pre>"Print a welcome message": {<br/>   "prefix": "welcome",<br/>   "body": [<br/>         "echo 'Welcome to shell scripting!' "<br/>   ],<br/>   "description": "Print welcome message"<br/>  }</pre></div>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-51 image-border" src="assets/9400bc9c-4f58-43f0-bb77-33d4d76e651b.png" style="width:45.17em;height:31.17em;"/></div>
<p>You can use the following template and modify it based on your needs.</p>
<p>Try to use prefixes different to the shell scripting keywords to avoid confusion.</p>
<p>When you open any <kbd>.sh</kbd> file and start to type <kbd>welcome</kbd>, the autocompletion will show you the snippet we have just created:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-52 image-border" src="assets/f87376e6-2924-4f8e-9b50-79fc8ba9e4de.png" style="width:46.50em;height:34.92em;"/></div>
<div>
<p class="NormalPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><span>You can use any prefix you want; in our case, we used <kbd>welcome</kbd> so the autocompletion starts with it.</span></p>
<p class="NormalPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><span>You can add many lines to your snippet body:</span></p>
<pre>"Print to a welcome message": {<br/>    "prefix": "welcome",<br/>    "body": [<br/>      "echo 'Welcome to shell scripting!' ",<br/>      "echo 'This is a second message'"<br/>    ],<br/>    "description": "Print welcome message"<br/>  }</pre></div>
<p>You can use placeholders in your snippet body to simplify code editing.</p>
<p>Placeholders are written like this:</p>
<pre><strong>$1, $2, etc,</strong></pre>
<p>Modify the previous snippet and add a placeholder like this:</p>
<pre>"Print a welcome message": {<br/>  "prefix": "welcome",<br/>  "body": [<br/>    "echo 'Welcome to shell scripting! $1' "<br/>  ],<br/>  "description": "Print welcome message"<br/>  }</pre>
<p>When you start to type <kbd>welcome</kbd> and after you choose the snippet, you will notice that the cursor will stop at the exact position of the placeholder waiting for your input.</p>
<p>You can use choices if you forget what to type in these editable places:</p>
<pre>  "Print to a welcome message": {<br/>    "prefix": "welcome",<br/>    "body": [<br/>      "echo 'Welcome to shell scripting! ${1|first,second,third|}' "<br/>    ],<br/>    "description": "Print welcome message"<br/>  }</pre>
<p>After you choose this snippet in your code and hit <em>Enter</em>, you should see the cursor waiting for your input with your choices:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-53 image-border" src="assets/24439a99-2597-4a4b-991c-13a3279e1e97.png" style="width:60.75em;height:32.33em;"/></div>
<div>
<p class="NormalPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><span>That's very helpful!</span></p>
<p class="NormalPACKT" style="margin: 3.0pt 0cm .0001pt 0cm"><span>Also, you can add a default value for the placeholder so this value will be written if you hit <em>Tab</em>:</span></p>
<pre>"Print a welcome message": {<br/>  "prefix": "welcome",<br/>  "body": [<br/>    "echo 'Welcome to shell scripting! ${1:book}' "<br/>  ],<br/>  "description": "Print welcome message"<br/>  }</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>To any administrator, script reuse will always be upmost in the quest for efficiency. Using vim at the command line can make for very quick and effective editing of a script and we can save typing in the use of abbreviations. These are best set within a user's personal <kbd>.vimrc</kbd> file and are defined with the <kbd>abbr</kbd> control. Beyond abbreviations, we can see the sense in using code snippets. These are pre-prepared blocks of code that can be read into the current script.</p>
<p>Also, we had a look at the value in using color at the command line where a script will provide feedback. In the first look, these color codes are not the friendliest, but we can simplify the process by using variables. We created variables with color codes and saved them to a file and by using source command, these variables will be available to our current environment.</p>
<p>Finally, we saw how to create code snippets using VS Code and how to add placeholders to simplify our code editing.</p>
<p>In the next chapter, we will look at other mechanisms that we can use to write test expressions simplifying the use of integers and variables.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>The following code creates a snippet which prints one line. How do you make the snippet with choices?</li>
</ol>
<pre style="padding-left: 60px">"Hello message": {<br/>  "prefix": "hello",<br/>  "body": [<br/>    "echo 'Hello $1' "<br/>  ],<br/>  "description": "Hello message"<br/>  }</pre>
<p style="padding-left: 60px"/>
<ol start="2">
<li>Which command <span>should</span><span> </span><span>you use to make your code snippets available for your use in the shell?</span></li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>Please see the following for further reading relating to this chapter:</span></p>
<ul>
<li><a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets">https://code.visualstudio.com/docs/editor/userdefinedsnippets</a></li>
<li><a href="https://brigade.engineering/sharpen-your-vim-with-snippets-767b693886db">https://brigade.engineering/sharpen-your-vim-with-snippets-767b693886db</a></li>
</ul>


            </article>

            
        </section>
    </body></html>