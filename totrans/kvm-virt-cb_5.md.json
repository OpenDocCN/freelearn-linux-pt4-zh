["```\nroot@kvm:~# virsh nodecpustats --percent\nusage: 0.0%\nuser: 0.0%\nsystem: 0.0%\nidle: 100.0%\niowait: 0.0%\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh nodememstats\ntotal : 131918328 KiB\nfree : 103633700 KiB\nbuffers: 195532 KiB\ncached : 25874840 KiB\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh domstate kvm1\nrunning\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh vcpucount --current kvm1 --live\n1\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh vcpuinfo kvm1\nVCPU: 0\nCPU: 29\nState: running\nCPU time: 118.8s\nCPU Affinity: yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh cpu-stats --total kvm1\nTotal:\ncpu_time 175.003045493 seconds\nuser_time 2.610000000 seconds\nsystem_time 7.510000000 seconds\n root@kvm:~#\n\n```", "```\nroot@kvm:~# virsh dominfo kvm1\nId: 30\nName: kvm1\nUUID: bd167199-c1c4-de7e-4996-43a7f197e565 OS Type: hvm\nState: running\nCPU(s): 1\nCPU time: 175.6s Max memory: 1048576 KiB\nUsed memory: 1048576 KiB\nPersistent: yes\nAutostart: disable Managed save: no\nSecurity model: none\nSecurity DOI: 0\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh dommemstat --live kvm1\nactual 1048576\nswap_in 0\nrss 252684\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh domblklist kvm1\nTarget Source\n------------------------------------------------\nhda /var/lib/libvirt/images/kvm1.img\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh domblkinfo --device hda kvm1\nCapacity: 8589934592\nAllocation: 2012381184\nPhysical: 2012381184\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh domblkerror kvm1\nNo errors found\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh domblkstat --device hda --human kvm1\nDevice: hda\nnumber of read operations: 42053\nnumber of bytes read: 106145280\nnumber of write operations: 10648\nnumber of bytes written: 96768000\nnumber of flush operations: 4044\ntotal duration of reads (ns): 833974071\ntotal duration of writes (ns): 1180545967\ntotal duration of flushes (ns): 3458623200\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# pgrep -lfa kvm1\n32332 /usr/bin/qemu-system-x86_64 -name kvm1 -S -machine pc-            i440fx-trusty,accel=kvm,usb=off -m 1024 -realtime mlock=off -smp    1,sockets=1,cores=1,threads=1 -uuid bd167199-c1c4-de7e-4996-43a7f197e565 -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/kvm1.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -boot strict=on -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -drive file=/var/lib/libvirt/images/kvm1.img,if=none,id=drive-ide0-0-0,format=raw -device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=1 -netdev tap,fd=24,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:55:9b:d6,bus=pci.0,addr=0x3 -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -vnc 146.20.141.158:0 -device cirrus-vga,id=video0,bus=pci.0,addr=0x2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x4\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh qemu-monitor-command kvm1 --hmp \"info\"\ninfo balloon -- show balloon information\ninfo block [-v] [device] -- show info of one block device or all block devices (and details of images with -v option)\ninfo block-jobs -- show progress of ongoing block device operations\ninfo blockstats -- show block device statistics\ninfo capture -- show capture information\ninfo chardev -- show the character devices\ninfo cpus -- show infos for each CPU\ninfo cpustats -- show CPU statistics\ninfo history -- show the command line history\ninfo irq -- show the interrupts statistics (if available)\ninfo jit -- show dynamic compiler info\ninfo kvm -- show KVM information\ninfo mem -- show the active virtual memory mappings\ninfo mice -- show which guest mouse is receiving events\ninfo migrate -- show migration status\ninfo migrate_cache_size -- show current migration xbzrle cache size\ninfo migrate_capabilities -- show current migration capabilities\ninfo mtree -- show memory tree\ninfo name -- show the current VM name\ninfo network -- show the network state\ninfo numa -- show NUMA information\ninfo pci -- show PCI info\ninfo pcmcia -- show guest PCMCIA status\ninfo pic -- show i8259 (PIC) state\ninfo profile -- show profiling information\ninfo qdm -- show qdev device model list\ninfo qtree -- show device tree\ninfo registers -- show the cpu registers\ninfo roms -- show roms\ninfo snapshots -- show the currently saved VM snapshots\ninfo spice -- show the spice server status\ninfo status -- show the current VM status (running|paused)\ninfo tlb -- show virtual to physical memory mappings\ninfo tpm -- show the TPM device\ninfo trace-events -- show available trace-events & their state\ninfo usb -- show guest USB devices\ninfo usbhost -- show host USB devices\ninfo usernet -- show user network stack connection states\ninfo uuid -- show the current VM UUID\ninfo version -- show the version of QEMU\ninfo vnc -- show the vnc server status\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh qemu-monitor-command kvm1 --hmp \"info network\"\nnet0: index=0,type=nic,model=rtl8139,macaddr=52:54:00:55:9b:d6\n \\ hostnet0: index=0,type=tap,fd=24\n\nroot@kvm:~#\n\n```", "```\n root@kvm:~# mkdir -p /var/lib/libvirt/qemu/channel/target\n root@kvm:~# chown libvirt-qemu:kvm   \n            /var/lib/libvirt/qemu/channel/ -R\n root@kvm:~#\n\n```", "```\nroot@kvm:~# virsh edit kvm1\n...\n <devices>\n ...\n <channel type='unix'>\n <source mode='bind' path='/var/lib/libvirt/qemu/channel/target/kvm1.org.qemu.guest_agent.0'/>\n <target type='virtio' name='org.qemu.guest_agent.0'/>\n <alias name='channel0'/>\n <address type='virtio-serial' controller='0' bus='0' port='1'/>\n </channel>\n ...\n </devices>\n...\n\nDomain kvm1 XML configuration edited.\nroot@kvm:~#\n\n```", "```\n root@kvm:~# virsh destroy kvm1\n Domain kvm1 destroyed\n\n root@kvm:~# virsh start kvm1\n Domain kvm1 started\n\n root@kvm:~#\n\n```", "```\nroot@kvm:~# virsh console kvm1\nConnected to domain kvm1\nEscape character is ^]\n\nroot@debian:~# apt update && apt install qemu-guest-agent\n...\nroot@debian:~# service qemu-guest-agent start\nroot@debian:~# service qemu-guest-agent status\n● qemu-guest-agent.service - LSB: QEMU Guest Agent startup script\n Loaded: loaded (/etc/init.d/qemu-guest-agent)\n Active: active (running) since Wed 2017-04-19 14:44:08 CDT; 33min ago\n Process: 397 ExecStart=/etc/init.d/qemu-guest-agent start (code=exited, status=0/SUCCESS)\n CGroup: /system.slice/qemu-guest-agent.service\n └─425 /usr/sbin/qemu-ga --daemonize -m virtio-serial -p /dev/virti...\n\nApr 19 14:44:08 debian systemd[1]: Starting LSB: QEMU Guest Agent startup s.....\nApr 19 14:44:08 debian systemd[1]: Started LSB: QEMU Guest Agent startup script.\nHint: Some lines were ellipsized, use -l to show in full.\nroot@debian:~#\n\n```", "```\nroot@kvm:~# ls -la /var/lib/libvirt/qemu/channel/target/\ntotal 8\ndrwxr-xr-x 2 libvirt-qemu kvm 4096 Apr 19 19:43 .\ndrwxr-xr-x 3 libvirt-qemu kvm 4096 Apr 19 19:43 ..\nsrwxr-xr-x 1 libvirt-qemu kvm 0 Apr 19 19:43 kvm1.org.qemu.guest_agent.0\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh qemu-agent-command kvm1 --pretty --cmd '{\"execute\": \"guest-info\"}'\n{\n \"return\": {\n \"version\": \"2.1.2\",\n \"supported_commands\": [\n {\n \"enabled\": true,\n \"name\": \"guest-set-vcpus\",\n \"success-response\": true\n },\n {\n \"enabled\": true,\n \"name\": \"guest-get-vcpus\",\n \"success-response\": true\n },\n {\n \"enabled\": true,\n \"name\": \"guest-network-get-interfaces\",\n \"success-response\": true\n },\n ...\n ]\n }\n}\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh qemu-agent-command kvm1 --pretty --cmd '{\"execute\": \"guest-get-vcpus\"}'\n{\n \"return\": [\n {\n \"online\": true,\n \"can-offline\": false,\n \"logical-id\": 0\n }\n ]\n}\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# apt-get install -y redis-server\n...\nroot@kvm:~# redis-cli ping\nPONG\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# apt-get install -y rabbitmq-server\n...\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# rabbitmqctl add_vhost /sensu\nCreating vhost \"/sensu\" ...\n...done.\nroot@kvm:~# rabbitmqctl add_user sensu secret\nCreating user \"sensu\" ...\n...done.\nroot@kvm:~# rabbitmqctl set_permissions -p /sensu sensu \".*\" \".*\" \".*\"\nSetting permissions for user \"sensu\" in vhost \"/sensu\" ...\n...done.\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# wget -q https://sensu.global.ssl.fastly.net/apt/pubkey.gpg -O- | apt-key add -\nOK\nroot@kvm:~# echo \"deb https://sensu.global.ssl.fastly.net/apt sensu main\" | tee /etc/apt/sources.list.d/sensu.list\ndeb https://sensu.global.ssl.fastly.net/apt sensu main\nroot@kvm:~# apt-get update\n...\nroot@kvm:~# apt-get install -y sensu\n...\nroot@kvm:~# \n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat api.json\n{\n \"api\": {\n \"host\": \"localhost\",\n \"bind\": \"0.0.0.0\",\n \"port\": 4567\n }\n}\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat transport.json\n{\n \"transport\": {\n \"name\": \"rabbitmq\",\n \"reconnect_on_error\": true\n }\n}\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat rabbitmq.json\n{\n \"rabbitmq\": {\n \"host\": \"0.0.0.0\",\n \"port\": 5672,\n \"vhost\": \"/sensu\",\n \"user\": \"sensu\",\n \"password\": \"secret\"\n }\n}\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat redis.json\n{\n \"redis\": {\n \"host\": \"localhost\",\n \"port\": 6379\n }\n}\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat client.json\n{\n \"client\": {\n \"name\": \"ubuntu\",\n \"address\": \"127.0.0.1\",\n \"subscriptions\": [\n \"base\"\n ],\n \"socket\": {\n \"bind\": \"127.0.0.1\",\n \"port\": 3030\n }\n }\n}\n\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# apt-get install -y uchiwa\n...\nroot@kvm:/etc/sensu/conf.d\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat /etc/sensu/uchiwa.json\n{\n \"sensu\": [\n {\n \"name\": \"KVM guests\",\n \"host\": \"localhost\",\n \"ssl\": false,\n \"port\": 4567,\n \"path\": \"\",\n \"timeout\": 5000\n }\n ],\n \"uchiwa\": {\n \"port\": 3000,\n \"stats\": 10,\n \"refresh\": 10000\n }\n}\n\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/sensu-server start\n * Starting sensu-server [ OK ]\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/sensu-api start\n * Starting sensu-api [ OK ]\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/sensu-client start\n * Starting sensu-client [ OK ]\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/uchiwa restart\nuchiwa started.\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# virsh console kvm1\nConnected to domain kvm1\nEscape character is ^]\n\nroot@debian:~# wget -q https://sensu.global.ssl.fastly.net/apt/pubkey.gpg -O- | apt-key add -\nOK\nroot@debian:~# echo \"deb https://sensu.global.ssl.fastly.net/apt sensu main\" | tee /etc/apt/sources.list.d/sensu.list\ndeb https://sensu.global.ssl.fastly.net/apt sensu main\nroot@debian:~# apt install apt-transport-https\nroot@debian:~# apt update && apt install sensu\n...\nroot@debian:~# cd /etc/sensu/conf.d/\nroot@debian:/etc/sensu/conf.d# cat client.json\n{\n \"client\": {\n \"name\": \"monitor_kvm\",\n \"address\": \"10.10.10.92\",\n \"subscriptions\": [\"base\"]\n }\n}\n\nroot@debian:/etc/sensu/conf.d# cat rabbitmq.json\n{\n \"rabbitmq\": {\n \"host\": \"10.10.10.1\",\n \"port\": 5672,\n \"vhost\": \"/sensu\",\n \"user\": \"sensu\",\n \"password\": \"secret\"\n }\n}\n\nroot@debian:/etc/sensu/conf.d# cat transport.json\n{\n \"transport\": {\n \"name\": \"rabbitmq\",\n \"reconnect_on_error\": true\n }\n}\n\nroot@debian:/etc/sensu/conf.d#\n\n```", "```\nroot@debian:/etc/sensu/conf.d# /etc/init.d/sensu-client start\nStarting sensu-client:.\nroot@debian:/etc/sensu/conf.d#\n\n```", "```\nroot@debian:/etc/sensu/conf.d# apt install rubygems\n...\nroot@debian:/etc/sensu/conf.d# gem search sensu | grep plugins | grep memory\nsensu-plugins-memory (0.0.2)\nsensu-plugins-memory-checks (2.1.0)\nroot@debian:/etc/sensu/conf.d#\nroot@debian:/etc/sensu/conf.d# gem install sensu-plugins-memory-checks\n...\nroot@debian:/etc/sensu/conf.d# /etc/init.d/sensu-client restart\nconfiguration is valid\nStopping sensu-client:.\nStarting sensu-client:.\noot@debian:/etc/sensu/conf.d# /usr/local/bin/check-memory-percent.rb -w 80 -c 9\nMEM OK - system memory usage: 11%\nroot@debian:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat check_memory.json\n{\n \"checks\": {\n \"memory_check\": {\n \"command\": \"/usr/local/bin/check-memory-percent.rb -w 80 -c 90\",\n \"subscribers\": [\"base\"],\n \"handlers\": [\"default\"],\n \"interval\": 300\n }\n }\n}\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/uchiwa restart Killing uchiwa (pid 15350) with SIGTERM\nWaiting uchiwa (pid 15350) to die...\nWaiting uchiwa (pid 15350) to die...\nuchiwa stopped.\nuchiwa started.\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/sensu-server restart\nconfiguration is valid\n * Stopping sensu-server [ OK ]\n * Starting sensu-server [ OK ]\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/sensu-api restart\nconfiguration is valid\n * Stopping sensu-api [ OK ]\n * Starting sensu-api [ OK ]\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cat check_kvm_instance_status.json\n{\n \"checks\": {\n \"check_kvm_instance_status\": {\n \"command\": \"check_kvm_instance_status.sh -n kvm1\",\n \"standalone\": true,\n \"subscribers\": [\"base\"],\n \"interval\": 60\n }\n }\n}\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# cd ../plugins/\nroot@kvm:/etc/sensu/plugins# cat check_kvm_instance_status.sh\n#!/bin/bash\n# Checks if a KVM instance is running\n\nusage()\n{\n echo \"Usage: `basename $0` -n|--name kvm1\"\n exit 2\n}\n\nsanity_check()\n{\n if [ \"$INSTANCE_NAME\" == \"\" ]\n then\n usage\n fi\n}\n\nreport_result()\n{\n if [ \"$INSTANCE_STATE\" == \"shut off\" ]\n then\n echo \"CRITICAL - KVM instance $INSTANCE_NAME is not running\"\n exit 2\n else\n echo \"OK - KVM instance $INSTANCE_NAME is running\"\n exit 0\n fi\n}\n\ncheck_instance_state()\n{\n declare -g INSTANCE_STATE=\"shut off\"\n\n INSTANCE_STATE=$(sudo /usr/bin/virsh domstate $INSTANCE_NAME)\n}\n\nmain()\n{\n sanity_check\n check_instance_state\n report_result\n}\n\nwhile [[ $# > 1 ]]\ndo\n key=$1\n\n case $key in\n -n|--name)\n INSTANCE_NAME=$2\n shift\n ;;\n *)\n usage\n ;;\n esac\n shift\ndone\n\nmain\n\nroot@kvm:/etc/sensu/plugins#\n\n```", "```\nroot@kvm:/etc/sensu/plugins# chmod u+x check_kvm_instance_status.sh\nroot@kvm:/etc/sensu/plugins# chown sensu:sensu check_kvm_instance_status.sh\nroot@kvm:/etc/sensu/plugins# echo \"sensu ALL=(ALL) NOPASSWD:ALL\" > /etc/sudoers.d/sensu\nroot@kvm:/etc/sensu/plugins# sudo -u sensu ./check_kvm_instance_status.sh --name kvm1\nOK - KVM instance kvm1 is running\nroot@kvm:/etc/sensu/plugins# virsh destroy kvm1\nDomain kvm1 destroyed\n\nroot@kvm:/etc/sensu/plugins# sudo -u sensu ./check_kvm_instance_status.sh --name kvm1\nCRITICAL - KVM instance kvm1 is not running\nroot@kvm:/etc/sensu/plugins# virsh start kvm1\nDomain kvm1 started\n\nroot@kvm:/etc/sensu/plugins#\n\n```", "```\nroot@kvm:/etc/sensu/conf.d# /etc/init.d/sensu-client restart\nconfiguration is valid\n * Stopping sensu-client [ OK ]\n * Starting sensu-client [ OK ]\nroot@kvm:/etc/sensu/conf.d# cat /var/log/sensu/sensu-client.log | grep check_kvm_instance_status\n{\"timestamp\":\"2017-04-20T17:37:48.409805+0000\",\"level\":\"warn\",\"message\":\"loading config file\",\"file\":\"/etc/sensu/conf.d/check_kvm_instance_status.json\"}\n{\"timestamp\":\"2017-04-20T17:38:16.746861+0000\",\"level\":\"info\",\"message\":\"publishing check result\",\"payload\":{\"client\":\"ubuntu\",\"check\":{\"command\":\"check_kvm_instance_status.sh -n kvm1\",\"standalone\":true,\"subscribers\":[\"base\"],\"interval\":60,\"name\":\"check_kvm_instance_status\",\"issued\":1492709896,\"executed\":1492709896,\"duration\":0.016,\"output\":\"OK - KVM instance kvm1 is running\\n\",\"status\":0}}}\nroot@kvm:/etc/sensu/conf.d#\n\n```", "```\nroot@kvm:~# mkdir backup_kvm1 && cd backup_kvm1\nroot@kvm:~/backup_kvm1#\n\n```", "```\nroot@kvm:~/backup_kvm1# virsh dumpxml kvm1 | grep \"source file\"\n <source file='/var/lib/libvirt/images/kvm1.img'/>\nroot@kvm:~/backup_kvm1#\n\n```", "```\nroot@kvm:~/backup_kvm1# virsh dumpxml kvm1 > kvm1.xml\nroot@kvm:~/backup_kvm1#\n\n```", "```\nroot@kvm:~/backup_kvm1# virsh destroy kvm1\nDomain kvm1 destroyed\n\nroot@kvm:~/backup_kvm1# cp /var/lib/libvirt/images/kvm1.img .\nroot@kvm:~/backup_kvm1# ls -lah\ntotal 2.4G\ndrwxr-xr-x 2 root root 4.0K Apr 20 18:37 .\ndrwx------ 7 root root 4.0K Apr 20 18:36 ..\n-rwxr-xr-x 1 root root 8.0G Apr 20 18:37 kvm1.img\n-rw-r--r-- 1 root root 3.0K Apr 20 18:36 kvm1.xml\nroot@kvm:~/backup_kvm1#\n\n```", "```\nroot@kvm:~/backup_kvm1# tar jcvf kvm1_backup.tar.bz .\n./\n./kvm1.img\n./kvm1.xml\nroot@kvm:~/backup_kvm1# rm kvm1.img kvm1.xml\nroot@kvm:~/backup_kvm1#\n\n```", "```\nroot@kvm:~/backup_kvm1# rsync -vaz kvm1_backup.tar.bz kvm2:/tmp\nsending incremental file list\nkvm1_backup.tar.bz\n\nsent 842,977,610 bytes received 35 bytes 26,761,195.08 bytes/sec\ntotal size is 845,671,214 speedup is 1.00\nroot@kvm:~/backup_kvm1#\n\n```", "```\nroot@kvm2:~# cd /tmp/\nroot@kvm2:/tmp# tar jxfv kvm1_backup.tar.bz\n./\n./kvm1.img\n./kvm1.xml\nroot@kvm2:/tmp#\n\n```", "```\nroot@kvm2:/tmp# cp kvm1.img /var/lib/libvirt/images/\nroot@kvm2:/tmp# virsh define kvm1.xml\nDomain kvm1 defined from kvm1.xml\n\nroot@kvm2:/tmp# virsh list --all | grep kvm1\n - kvm1 shut off\nroot@kvm2:/tmp#\n\n```", "```\nroot@kvm:~# qemu-img info kvm1.qcow2\nimage: kvm1.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 2.4G\ncluster_size: 65536\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# qemu-img create -f qcow2 -b /var/lib/libvirt/images/kvm1_copy.qcow2 /var/lib/libvirt/images/kvm1_copy_2.qcow2\nFormatting '/var/lib/libvirt/images/kvm1_copy_2.qcow2', fmt=qcow2 size=8589934592 backing_file='/var/lib/libvirt/images/kvm1_copy.qcow2' encryption=off cluster_size=65536 lazy_refcounts=off\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# qemu-img info kvm1_copy.qcow2\nimage: kvm1_copy.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 196K\ncluster_size: 65536\nbacking file: /var/lib/libvirt/images/kvm1.qcow2\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# qemu-img create -f qcow2 -b /var/lib/libvirt/images/kvm1_copy.qcow2 /var/lib/libvirt/images/kvm1_copy_2.qcow2\nFormatting '/var/lib/libvirt/images/kvm1_copy_2.qcow2', fmt=qcow2 size=8589934592 backing_file='/var/lib/libvirt/images/kvm1_copy.qcow2' encryption=off cluster_size=65536 lazy_refcounts=off\nroot@kvm:~# qemu-img info /var/lib/libvirt/images/kvm1_copy_2.qcow2\nimage: /var/lib/libvirt/images/kvm1_copy_2.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 196K\ncluster_size: 65536\nbacking file: /var/lib/libvirt/images/kvm1_copy.qcow2\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# qemu-img info --backing-chain /var/lib/libvirt/images/kvm1_copy_2.qcow2\nimage: /var/lib/libvirt/images/kvm1_copy_2.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 196K\ncluster_size: 65536\nbacking file: /var/lib/libvirt/images/kvm1_copy.qcow2\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\n\nimage: /var/lib/libvirt/images/kvm1_copy.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 196K\ncluster_size: 65536\nbacking file: /var/lib/libvirt/images/kvm1.qcow2\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\n\nimage: /var/lib/libvirt/images/kvm1.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 2.4G\ncluster_size: 65536\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\nroot@kvm:~# \n\n```", "```\nroot@kvm:~# virsh snapshot-create kvm1\nDomain snapshot 1492797458 created\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# ls -la /var/lib/libvirt/qemu/snapshot/\ntotal 12\ndrwxr-xr-x 3 libvirt-qemu kvm 4096 Apr 21 14:05 .\ndrwxr-x--- 6 libvirt-qemu kvm 4096 Apr 21 14:04 ..\ndrwxr-xr-x 2 root root 4096 Apr 21 17:57 kvm1\nroot@kvm:~# ls -la /var/lib/libvirt/qemu/snapshot/kvm1/\ntotal 12\ndrwxr-xr-x 2 root root 4096 Apr 21 17:57 .\ndrwxr-xr-x 3 libvirt-qemu kvm 4096 Apr 21 14:05 ..\n-rw------- 1 root root 3089 Apr 21 17:57 1492797458.xml\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# cat /var/lib/libvirt/qemu/snapshot/kvm1/1492797458.xml\n<!--\nWARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE\nOVERWRITTEN AND LOST. Changes to this xml configuration should be made using:\n virsh snapshot-edit\nor other application using the libvirt API.\n-->\n\n<domainsnapshot>\n <name>1492797458</name>\n <state>running</state>\n <creationTime>1492797458</creationTime>\n <memory snapshot='internal'/>\n <disks>\n <disk name='hda' snapshot='internal'/>\n </disks>\n <domain type='kvm'>\n <name>kvm1</name>\n ...\n </domain>\n <active>1</active>\n</domainsnapshot>\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# qemu-img info /var/lib/libvirt/images/kvm1.qcow2\nimage: /var/lib/libvirt/images/kvm1.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 2.4G\ncluster_size: 65536\nSnapshot list:\nID TAG         VM SIZE   DATE                   VM CLOCK\n1  1492797458  155M      2017-04-21 17:57:38    03:41:16.790\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh domblklist kvm1\nTarget  Source\n------------------------------------------------\nhda     /var/lib/libvirt/images/kvm1.qcow2\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-create-as kvm1 kvm1_ext_snapshot \"Disk only external snapshot for kvm1\" --disk-only --diskspec hda,snapshot=external,file=/var/lib/libvirt/images/kvm1_disk_external.qcow2\nDomain snapshot kvm1_ext_snapshot created\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# qemu-img info /var/lib/libvirt/images/kvm1_disk_external.qcow2\nimage: /var/lib/libvirt/images/kvm1_disk_external.qcow2\nfile format: qcow2\nvirtual size: 8.0G (8589934592 bytes)\ndisk size: 196K\ncluster_size: 65536\nbacking file: /var/lib/libvirt/images/kvm1.qcow2\nbacking file format: qcow2\nFormat specific information:\n compat: 1.1\n lazy refcounts: false\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list kvm1\n Name                 Creation Time               State\n------------------------------------------------------------\n 1492797458           2017-04-21 17:57:38 +0000   running\n kvm1_ext_snapshot    2017-04-21 18:08:49 +0000   disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list --disk-only kvm1\n Name                Creation Time              State\n------------------------------------------------------------\n kvm1_ext_snapshot   2017-04-21 18:08:49 +0000  disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list --internal kvm1\n Name         Creation Time              State\n------------------------------------------------------------\n 1492797458   2017-04-21 17:57:38 +0000  running\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list --external kvm1\n Name Creation Time State\n------------------------------------------------------------\n kvm1_ext_snapshot 2017-04-21 18:08:49 +0000 disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list --tree kvm1\n1492797458\n |\n +- kvm1_ext_snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list kvm1\n Name                Creation Time              State\n------------------------------------------------------------\n 1492797458          2017-04-21 17:57:38 +0000  running\n kvm1_ext_snapshot   2017-04-21 18:08:49 +0000  disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-info kvm1 --snapshotname 1492797458\nName: 1492797458\nDomain: kvm1\nCurrent: no\nState: running\nLocation: internal\nParent: -\nChildren: 1\nDescendants: 1\nMetadata: yes\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-info kvm1 --snapshotname kvm1_ext_snapshot\nName: kvm1_ext_snapshot\nDomain: kvm1\nCurrent: yes\nState: disk-snapshot\nLocation: external\nParent: 1492797458\nChildren: 0\nDescendants: 0\nMetadata: yes\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-dumpxml kvm1 --snapshotname kvm1_ext_snapshot --security-info\n<domainsnapshot>\n <name>kvm1_ext_snapshot</name>\n <description>Disk only external snapshot for kvm1</description>\n <state>disk-snapshot</state>\n <parent>\n <name>1492797458</name>\n </parent>\n <creationTime>1492798129</creationTime>\n <memory snapshot='no'/>\n <disks>\n <disk name='hda' snapshot='external' type='file'>\n <driver type='qcow2'/>\n <source file='/var/lib/libvirt/images/kvm1_disk_external.qcow2'/>\n </disk>\n </disks>\n <domain type='kvm'>\n <name>kvm1</name>\n ...\n <devices>\n <emulator>/usr/bin/qemu-system-x86_64</emulator>\n <disk type='file' device='disk'>\n <driver name='qemu' type='qcow2'/>\n <source file='/var/lib/libvirt/images/kvm1.qcow2'/>\n <target dev='hda' bus='ide'/>\n <address type='drive' controller='0' bus='0' target='0' unit='0'/>\n </disk>\n ...\n </devices>\n <seclabel type='none'/>\n </domain>\n</domainsnapshot>\n\n```", "```\nroot@kvm:~# virsh snapshot-list kvm1\n Name                Creation Time              State\n------------------------------------------------------------\n 1492797458          2017-04-21 17:57:38 +0000  running\n kvm1_ext_snapshot   2017-04-21 18:08:49 +0000  disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-edit kvm1 --snapshotname kvm1_ext_snapshot --rename\n<domainsnapshot>\n <name>kvm1_ext_snapshot_renamed</name>\n <description>Disk only external snapshot for kvm1</description>\n ...\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list kvm1\n Name                       Creation Time             State\n------------------------------------------------------------\n 1492797458                 2017-04-21 17:57:38 +0000 running\n kvm1_ext_snapshot_renamed  2017-04-21 18:08:49 +0000 disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh console kvm1\nConnected to domain kvm1\nEscape character is ^]\n\nroot@debian:~# touch SNAPSHOT\nroot@debian:~#\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-create kvm1\nDomain snapshot 1492802417 created\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-info kvm1 --snapshotname 1492802417\nName: 1492802417\nDomain: kvm1\nCurrent: yes\nState: running\nLocation: internal\nParent: 1492797458\nChildren: 0\nDescendants: 0\nMetadata: yes\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh console kvm1\nConnected to domain kvm1\nEscape character is ^]\n\nroot@debian:~# rm -f SNAPSHOT\nroot@debian:~#\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-revert kvm1 --snapshotname 1492802417\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh console kvm1\nConnected to domain kvm1\nEscape character is ^]\n\nroot@debian:~# ls -la SNAPSHOT\n-rw-r--r-- 1 root root 0 Apr 21 14:08 SNAPSHOT\nroot@debian:~#\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list kvm1\n Name                      Creation Time             State\n------------------------------------------------------------\n 1492797458                2017-04-21 17:57:38 +0000 running\n 1492802417                2017-04-21 19:20:17 +0000 running\n kvm1_ext_snapshot_renamed 2017-04-21 18:08:49 +0000 disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-delete kvm1 --snapshotname 1492802417\nDomain snapshot 1492802417 deleted\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-list kvm1\n Name                       Creation Time             State\n------------------------------------------------------------\n 1492797458                 2017-04-21 17:57:38 +0000 running\n kvm1_ext_snapshot_renamed  2017-04-21 18:08:49 +0000 disk-snapshot\n\nroot@kvm:~#\n\n```", "```\nroot@kvm:~# virsh snapshot-delete kvm1 --current\nDomain snapshot 1492797458 deleted\n\nroot@kvm:~#\n\n```"]