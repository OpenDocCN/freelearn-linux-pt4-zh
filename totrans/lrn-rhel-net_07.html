<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Implementing Windows Shares with Samba 4" id="aid-1P71O1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Implementing Windows Shares with Samba 4</h1></div></div></div><p>Almost certainly, your Linux devices will not be running autonomously, and other operating systems will co-exist with them. No matter where your infrastructure is located, the likelihood is that you will need to interoperate with Windows systems at the very least. This is true just as much in the home environment as it's in the enterprise. Considering the home market, how many people do you know that use Windows desktops and have a Linux server as a central file store. Remember that the Linux server may be embedded into <span class="strong"><strong>Network Attached </strong></span>
<a id="id266" class="indexterm"/>
<span class="strong"><strong>Storage</strong></span> (<span class="strong"><strong>NAS</strong></span>), a device that you bought from the high street. Within enterprises, large and small, Microsoft's Active Directory is a very prevalent identity store that shares user accounts across a range of systems.</p><p>To help integrate RHEL 7 into your Windows environment, we will use this chapter to provide you with the basics on the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Overview of Samba and Samba services</li><li class="listitem">Overview of the lab environment </li><li class="listitem">Configuring time and DNS</li><li class="listitem">Managing Samba services</li><li class="listitem">Samba client on RHEL 7</li><li class="listitem">Configuring file shares on Samba</li><li class="listitem">Troubleshooting Samba</li></ul></div><div class="section" title="An overview of Samba and Samba services"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec54"/>An overview of Samba and Samba services</h1></div></div></div><p>When investigating <a id="id267" class="indexterm"/>our main services and using Samba, we will need to install the <code class="literal">samba</code> package; this package can be installed as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo yum install -y samba</strong></span>
</pre></div><p>With the package installed, the following services are added to our system:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For file and print sharing, we have the <code class="literal">smbd</code> service. For this service, we will need to open TCP ports <code class="literal">139</code> and <code class="literal">445</code>.</li><li class="listitem">If we need to respond to legacy NetBIOS names requests, we will need to start the <code class="literal">nmbd</code> service. We will need this for older clients, such as Windows 95, 98, and ME. Windows 2000 and XP clients can make use of this network browsing protocol as well. Should we need this service, which somehow I doubt, we will need to open the UDP port <code class="literal">137</code>.</li></ul></div><p>If you want to join a Windows <a id="id268" class="indexterm"/>domain, then you can add client tools packages such as <code class="literal">samba-winbind</code> or <code class="literal">sssd-common</code>.</p><p>If you use the <code class="literal">firewall-cmd</code> command, adding the Samba service will enable three ports for you. To add the Samba service to a firewall, we will use the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo firewall-cmd --permanent --add-service=samba</strong></span>
<span class="strong"><strong>$ sudo firewall-cmd --reload</strong></span>
<span class="strong"><strong>$ sudo firewall-cmd --list-services</strong></span>
</pre></div><p>The last command is for information purposes only and is not required to set the firewall rule.</p></div></div>
<div class="section" title="An overview of the lab environment" id="aid-1Q5IA1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec55"/>An overview of the lab environment </h1></div></div></div><p>For demonstrations <a id="id269" class="indexterm"/>is this chapter, we will use two virtual machines running in an <span class="strong"><strong>Oracle VirtualBox</strong></span> virtualization environment.</p><p>We have a Microsoft Server 2008R2 Active Directory Domain Controller with the <code class="literal">192.168.0.252</code> IP address and the RHEL 7.1 host with the <code class="literal">192.168.0.69</code> IP address.</p></div>
<div class="section" title="Configuring time and DNS" id="aid-1R42S1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec56"/>Configuring time and DNS</h1></div></div></div><p>Although if we are <a id="id270" class="indexterm"/>using the RHEL host for a simple file and print sharing purpose, then obtaining an accurate time and DNS are not too much of an issue; however, we are most <a id="id271" class="indexterm"/>likely going to need to bring the RHEL server to an Active Directory domain so that we can make use of single sign-on. Users will be able to access their shares using the same credentials as they use in the Active Directory, rather than having a user account and password on the RHEL server.</p><p>In this chapter, we will just look at file sharing, and in <a class="link" title="Chapter 8. Integrating RHEL 7 into Microsoft Active Directory Domains" href="part0068.xhtml#aid-20R681">Chapter 8</a>, <span class="emphasis"><em>Integrating RHEL 7 into Microsoft Active Directory Domains</em></span>, we bring the server to the AD domain.</p><p>In <a class="link" title="Chapter 3. Configuring Key Network Services" href="part0027.xhtml#aid-PNV62">Chapter 3</a>, <span class="emphasis"><em>Configuring Key Network Services</em></span>, we configured time services. Now, let's look at how to set our <code class="literal">chronyd</code> time source to the Active Directory time server. If we are using NTP, then set the NTP time source to the Active Directory server. Alternatively, ensure that the Active Directory time source is set to the same time source that you use for your RHEL host.</p><p>To configure the time <a id="id272" class="indexterm"/>source on the Windows 2008R2 Active Directory Server, you will need to open an administrative Command Prompt and type the following <a id="id273" class="indexterm"/>commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>c:\&gt; net stop w32time</strong></span>
<span class="strong"><strong>c:\&gt; w32tm /config /syncfromflags:manual /manualpeerlist:"uk.pool.ntp.org"</strong></span>
<span class="strong"><strong>c:\&gt; w32tm /config /reliable:yes</strong></span>
<span class="strong"><strong>c:\&gt; net start w32time</strong></span>
<span class="strong"><strong>c:\&gt; w32tm /config /update</strong></span>
<span class="strong"><strong>c:\&gt; w32tm /resync</strong></span>
<span class="strong"><strong>c:\&gt; w32tm /query /status</strong></span>
</pre></div><p>The output from the final status subcommand is shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00274.jpeg" alt="Configuring time and DNS"/></div><p style="clear:both; height: 1em;"> </p><p>I feel having accurate time on the network is a must, no matter you intend joining a domain or not.</p><p>To join the Active Directory domain, we must be able to resolve the service records that locate domain controllers. The easiest way to achieve this is to point the DNS resolvers of RHEL to the Active Directory Servers that host the DNS. I have just one domain controller and this is a DNS server as well. To ensure that we resolve these names correctly, we write to configuration files for interfaces on RHEL 7. On my system, these are as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/etc/sysconfig/network-scripts/ifcfg-eno1677736</strong></span>
<span class="strong"><strong>/etc/sysconfig/network-scripts/ifcfg-eno33554992</strong></span>
</pre></div><p>Ensure that the DNS1 entry point to the Active Directory domain controller and <code class="literal">PEERDNS=yes</code> is set in both files. Alternatively, configure the <code class="literal">/etc/resolv.conf</code> file with the settings of a name server and ensure that the <code class="literal">PEERDNS=no</code> attribute is set in all the interface files.</p><p>The following screenshot shows the first configuration option with the setting made in the interface file only:</p><div class="mediaobject"><img src="../Images/image00275.jpeg" alt="Configuring time and DNS"/></div><p style="clear:both; height: 1em;"> </p><p>With this set in both interface files, (if you have two NICSNICs), you can simply restart the <code class="literal">NetworkManager</code> service as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo systemctl restart NetworkManager</strong></span>
</pre></div><p>To test the configuration, you can try to resolve the name servers for your Active Directory domain hosted in DNS. For the book, we simply use <code class="literal">example.com</code>. To resolve this domain from the RHEL 7 host, we run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ dig -t ns example.com</strong></span>
</pre></div><p>The <code class="literal">dig</code> command looks <a id="id274" class="indexterm"/>for records of the <code class="literal">ns</code> type or name servers from the <a id="id275" class="indexterm"/>
<code class="literal">example.com</code> domain. The output should be similar to the following screenshot:</p><div class="mediaobject"><img src="../Images/image00276.jpeg" alt="Configuring time and DNS"/></div><p style="clear:both; height: 1em;"> </p></div>
<div class="section" title="Managing Samba services"><div class="titlepage" id="aid-1S2JE2"><div><div><h1 class="title"><a id="ch07lvl1sec57"/>Managing Samba services</h1></div></div></div><p>To access the <a id="id276" class="indexterm"/>resources of Samba, a user needs a POSIX (Linux) user account available to them and a Samba account. The POSIX account can be an ordinary account within the <code class="literal">/etc/passwd</code> file or this account can be centralized in LDAP or an Active Directory. When a POSIX account is enabled for Samba, additional attributes that are required by Windows systems are added to the user account. To enable an existing POSIX account with Samba, we can use the <code class="literal">/bin/pdbedit</code> command. This can work with Samba accounts in the following account stores:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <code class="literal">/etc/samba/smbpasswd</code> file</li><li class="listitem">The <code class="literal">tdbsam</code> database located at <code class="literal">/var/lib/samba/private/passdb.tdb</code> (this is the default samba account store)</li><li class="listitem">The OpenLDAP directory services</li></ul></div><p>As existing domain accounts have the required attributes for Samba, there is no requirement to enable those accounts for Samba.</p><p>Firstly, we will list all existing Samba enabled accounts. Of course, we have only installed Samba and not enabled any other account. Also, we only have local accounts in the <code class="literal">/etc/passwd</code> file because the RHEL server is currently not part of a domain or LDAP:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo pdbedit -L</strong></span>
</pre></div><p>There should be no <a id="id277" class="indexterm"/>output to this command because we don't have any Samba enabled accounts. If you run a command as a standard user without errors, you will see permission violations while trying to access a database.</p><p>We will now enable the exiting account for <code class="literal">root</code> and the standard user: <code class="literal">andrew</code>. We will not only create an account and enable it for Samba, but also add attributes that are stored in the assigned Samba account's backend. In the default case, this is the <code class="literal">tdbsam</code> database. To enable these two accounts, use the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo pdbedit -a -u root</strong></span>
<span class="strong"><strong>$ sudo pdbedit -a -u andrew</strong></span>
</pre></div><p>You will be prompted for a new Samba password for each account. Ideally, this should be different to their POSIX password. The truncated output after enabling the Samba account for <code class="literal">andrew</code> is shown in the following command line screenshot:</p><div class="mediaobject"><img src="../Images/image00277.jpeg" alt="Managing Samba services"/></div><p style="clear:both; height: 1em;"> </p><p>Magically, when we run the list of accounts, we will be able to see these two accounts:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo pdbedit -L</strong></span>
</pre></div><p>The output should be similar to the following screenshot, adjusting the account names to match your own:</p><div class="mediaobject"><img src="../Images/image00278.jpeg" alt="Managing Samba services"/></div><p style="clear:both; height: 1em;"> </p><p>You can use the <code class="literal">-L</code> option <a id="id278" class="indexterm"/>with <code class="literal">-v</code> for a verbose output similar to the information you see when enabling an account.</p><p>The main configuration file for Samba is <code class="literal">/etc/samba/smb.conf</code>. This file is segmented into sections and each section (with the exception of [global]) defines some form of shared resources. Each section is denoted with the section name in square brackets <code class="literal">[]</code>. In addition to the <code class="literal">[global]</code> section, there are two other special sections. These sections are defined in the following list:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">[global]</code>: Attributes set within the global section refer to the Samba server as a whole rather than a particular shared resource.</li><li class="listitem"><code class="literal">[homes]</code>: The presence of this section allows users to connect to their own home directory easily and on the fly without any additional administrative effort to share a user's home directory. This can work without the need for the username and account name to be the same as the home directory name. The user: <code class="literal">andrew</code> will connect to his home share on the server in a manner similar to the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>//&lt;server-name or IP&gt;/andrew</strong></span>
</pre></div><p>The home directory attribute from the user account will be read and then the user will be connected to their assigned home directory.</p></li><li class="listitem"><code class="literal">[printers]</code>: The presence of this section allows local printers to be shared automatically with no further administrative effort. A user will use the following URL to connect to a printer:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>//&lt;server-name or IP&gt;/&lt;printer-name&gt;</strong></span>
</pre></div></li></ul></div><p>You will find the <code class="literal">/etc/samba/smb.conf</code> file heavily commented with some comments with the <code class="literal">#</code> symbol and others with the semicolon (<code class="literal">;</code>) symbol. Both are valid comments, but its inconsistency is a little annoying.</p><p>If you would like to create a backup and remove empty and commented lines, try to run the following command from the <code class="literal">/etc/samba</code> directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo sed -i.bak  '/^\s*[;#]/d;/^$/d;' smb.conf</strong></span>
</pre></div><p>The regular expression that we use to search for lines to delete is a little more complex than normal, but it still does an amazing job for us. There are two expressions for <code class="literal">sed</code> in the example, <code class="literal">/^\s*[;#]/d</code>.</p><p>The preceding expression will delete commented lines from the file.</p><p>We look for lines with (<code class="literal">^</code>) and any whitespace character (<code class="literal">\s</code>). Additionally, using <code class="literal">*</code>, we check for zero or more <a id="id279" class="indexterm"/>whitespace characters. In this way, we are allowing an optional whitespace character at the start of the line, but it must be followed by <code class="literal">;</code> or <code class="literal">#</code> (<code class="literal">[;#]</code>) symbol. In simple English, this expands to lines that are commented, regardless of whether they start with a space/tab character or directly with a comment. The search string is delimited between the two <code class="literal">/</code> characters, and the <code class="literal">d</code> command is used to delete matching lines that follow:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/^$/d</strong></span>
</pre></div><p>The preceding expression deletes blank or empty lines from a file.</p><p>The effect that this has is that it reduces the line count of the file from 320 lines to 20 lines in seconds. We keep the original file as a backup, that is, <code class="literal">smb.conf.bak</code>.</p><p>A simple <code class="literal">[global]</code> section may look similar to the following screenshot:</p><div class="mediaobject"><img src="../Images/image00279.jpeg" alt="Managing Samba services"/></div><p style="clear:both; height: 1em;"> </p><p>These settings are detailed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">workgroup = MYGROUP</code>: This denotes the NetBIOS workgroup to join in the Network Neighborhood view.</li><li class="listitem"><code class="literal">server string = Samba Server Version %v</code>: This appears as a description next to the server name within a network view. The <code class="literal">%v</code> variable will display the Samba version; in our case, this is <code class="literal">4.1.2</code>.</li><li class="listitem"><code class="literal">log file = /var/log/samba/log.%m</code>: This specifies the path to the log file; the <code class="literal">%m</code> variable is the machine name (hostname).</li><li class="listitem"><code class="literal">max log size = 50</code>: This specifies the maximum size in KB for the log file before it is rotated.</li><li class="listitem"><code class="literal">idmap config * : backend = tdb</code>: This is the mapping mechanism to map POSIX user IDs and group ID to <span class="strong"><strong>SIDs</strong></span> (<span class="strong"><strong>Security Identifiers</strong></span>).</li><li class="listitem"><code class="literal">cups options = raw</code>: These are the printer settings that tell the cupsCUPS process to send the job directly to the printer rather than trying to interpret it. It will have already <a id="id280" class="indexterm"/>been processed by a Windows printer driver and needs no further processing.</li></ul></div><p>You can also use directives to control which hosts or networks can access the system with <code class="literal">hosts allow</code> and <code class="literal">hosts deny</code> directives. For example, the following attribute settings within the <code class="literal">[global]</code> section <a id="id281" class="indexterm"/>will only allow access to any share to the given network. The <code class="literal">127.0.0.1</code> host will always have access unless explicitly denied. Either of the following methods are correct, allowing access to <code class="literal">192.168.0.0/24</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hosts allow = 192.168.0.</strong></span>
</pre></div><p>OR:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>hosts allow = 192.168.0.0/255.255.255.0</strong></span>
</pre></div><p>These <code class="literal">host allow</code> settings and their sibling <code class="literal">host deny</code> settings can also be managed at the share level, but <code class="literal">[global]</code> settings will take precedence over anything configured at the share level.</p><p>If changes are made to a running configuration, then we can run a preflight check to test the integrity of our changes before restarting the service. To do this, we use the <code class="literal">testparm</code> command. We run this simply as root, as shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo testparm</strong></span>
</pre></div><p>The <code class="literal">nmb</code> and <code class="literal">smb</code> services are managed independently. We can start and enable the Samba file server with the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo systemctl enable smb</strong></span>
<span class="strong"><strong>$ sudo systemctl start smb</strong></span>
</pre></div><p>As the <code class="literal">[homes]</code> section <a id="id282" class="indexterm"/>is configured by default, we are now ready to test the system.</p></div>
<div class="section" title="The Samba client on RHEL 7" id="aid-1T1401"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec58"/>The Samba client on RHEL 7</h1></div></div></div><p>Currently, my <a id="id283" class="indexterm"/>firewall service is disabled, so I do not need to be concerned <a id="id284" class="indexterm"/>with the firewall; however, I will only need to add in the TCP port <code class="literal">445</code> and <code class="literal">139</code> or the <code class="literal">samba</code> service.</p><p>If we install the Samba client package, we can list all the shares available to a given user. This is shown in the following command extract:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo yum install -y samba-client</strong></span>
<span class="strong"><strong>$ smbclient -U andrew -L //localhost</strong></span>
</pre></div><p>Once the Samba client is installed, we can use it to log in as <code class="literal">andrew</code>; we will be prompted for the password and to list shares on the localhost. We should see the listed home directory coming from the <code class="literal">[homes]</code> special share section. This is always there by default. We will see the output as expected, not the share name <code class="literal">andrew</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00280.jpeg" alt="The Samba client on RHEL 7"/></div><p style="clear:both; height: 1em;"> </p><p>Of course, we can leave it here and hide the fact that there are some SELinux traps with the current setup. We can connect to a share, but SELinux will prevent access to the users' home directories. While <a class="link" title="Chapter 10. Securing the System with SELinux" href="part0084.xhtml#aid-2G3F81">Chapter 10</a>, <span class="emphasis"><em>Securing the System with SELinux</em></span>, will look at SELinux in more detail, we can simply and securely gain access to shares by one simple Boolean change. Firstly, we will test the current configuration. SELinux is in the enforcing mode and the firewall is not running. To mount the Samba share, we can use the following command written as a single line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo mount -t cifs -o username=andrew,password=Password1 //192.168.0.69/andrew /mnt</strong></span>
</pre></div><p>We do not need to include the password in mount options; if we don't, we will be prompted for the user's Samba password during the mount process. This should succeed, but if we try to access the mount target (in this case <code class="literal">/mnt</code>), we will be denied access. To overcome this, we can <a id="id285" class="indexterm"/>interrogate the SELinux configuration for Samba <a id="id286" class="indexterm"/>home directories. The following command illustrates how this is achieved:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ getsebool samba_enable_home_dirs</strong></span>
</pre></div><p>In Samba, the default configuration settings are turned <code class="literal">off</code> and <code class="literal">as</code> such prevents access to the <code class="literal">home</code> directory. We enable the Samba service using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo setsebool -P samba_enable_home_dirs on</strong></span>
</pre></div><p>With Boolean enabled, we gain immediate access to a share. There is no requirement to unmount and remount the home directory. The <code class="literal">-P</code> option makes this change permanent so that we can be assured that the change persists until we need to disable the setting, and the system is still secured with SELinux.</p><p>To see a list of SELinux, Samba Booleans, and their settings, you can use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ getsebool -a | grep samba</strong></span>
</pre></div><p>Of course, we can also connect to a share from a Windows device provided we have the correct credentials. The following screenshot shows the mapped drive from the Windows 2008R2 server connected to Andrew's home directory:</p><div class="mediaobject"><img src="../Images/image00281.jpeg" alt="The Samba client on RHEL 7"/></div><p style="clear:both; height: 1em;"> </p></div>
<div class="section" title="Configuring file shares in Samba" id="aid-1TVKI1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec59"/>Configuring file shares in Samba</h1></div></div></div><p>We have seen the <a id="id287" class="indexterm"/>major feature of file sharing that Samba enables with the user's home directories. Although this feature is enabled by default, we will <a id="id288" class="indexterm"/>also need to create our own file shares by adding our own sections to <code class="literal">smb.conf</code>. On the Red Hat server, we have the <code class="literal">/data</code> directory that we worked with during <code class="literal">btrfs</code> in <a class="link" title="Chapter 5. Implementing btrfs" href="part0039.xhtml#aid-1565U1">Chapter 5</a>, <span class="emphasis"><em>Implementing btrfs</em></span>. If we need to share this to our Windows-based clients, then Samba is the tool we will use.</p><p>We can edit the <code class="literal">smb.conf</code> file with root privileges and add a new section to the configuration. The attributes that we use in the section control the access and use of the share. At the very least, we require the path attribute for the share to be meaningful. For a full list of options, the <code class="literal">man</code> pages for the <code class="literal">smb.conf</code> file will help. The following screenshot shows the share definition that we have added for the <code class="literal">/data</code> directory on the server:</p><div class="mediaobject"><img src="../Images/image00282.jpeg" alt="Configuring file shares in Samba"/></div><p style="clear:both; height: 1em;"> </p><p>The read list restricts reading data from the share to listed users; in this case, we add a group. The <code class="literal">@</code> symbol denotes a group within the list.</p><p>We still need to work with SELinux a little here by changing the SELinux context of the <code class="literal">/data</code> directory and its contents. We can achieve this with the <code class="literal">chcon</code> command for the changed context:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo chcon -R -t samba_share_t /data</strong></span>
</pre></div><p>Do not forget to test the configuration using <code class="literal">testparm</code>; if all is okay, we can restart the <code class="literal">smb</code> service as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo systemctl restart sm</strong></span>
<span class="strong"><strong>b</strong></span>
</pre></div><p>Now, we can browse and <a id="id289" class="indexterm"/>access the Samba shares that we have defined. Using the Windows 2008R2 server, we can now browse the network <a id="id290" class="indexterm"/>and see the <code class="literal">home</code> directory for <code class="literal">andrew share</code> and <code class="literal">data share</code>. The following screenshot shows this:</p><div class="mediaobject"><img src="../Images/image00283.jpeg" alt="Configuring file shares in Samba"/></div><p style="clear:both; height: 1em;"> </p><p>We can see why Samba is such an important tool in small and large environments; file sharing is just so simple and integrates into our existing infrastructure.</p></div>
<div class="section" title="Troubleshooting Samba" id="aid-1UU541"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec60"/>Troubleshooting Samba</h1></div></div></div><p>If we are having <a id="id291" class="indexterm"/>problems with Samba, we can always check the output from the <code class="literal">testparm</code> command again and ensure that we have not missed anything vital. We can check which setting is valid from the man pages for <code class="literal">smb.conf</code> should be concerned over some settings.</p><p>We can also check the log files. These are located in the <code class="literal">/var/log/samba/</code> directory.</p><p>There will be logs that represent client access, as shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>log.&lt;client ip-address&gt;</strong></span>
</pre></div><p>OR:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>log.&lt;client-hostname&gt;</strong></span>
</pre></div><p>There will also be the <code class="literal">log.smbd</code> daemon log.</p><p>If you need more details on the daemon log, set the log level attribute in the <code class="literal">[global]</code> section of the <code class="literal">smb.conf</code> as follows<code class="literal">:</code>
</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>log level = 3</strong></span>
</pre></div><p>This raises the verbosity of logging, which may help. We suggest not leaving the level set this high and removing the <a id="id292" class="indexterm"/>setting when it's no longer required. The log level can be configured from <code class="literal">0</code> to <code class="literal">10</code>, where <code class="literal">0</code> is low and <code class="literal">10</code> is high, but level <code class="literal">3</code> is as verbose as most people will need.</p></div>
<div class="section" title="Summary" id="aid-1VSLM1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec61"/>Summary</h1></div></div></div><p>In this chapter, we looked at how to share filesystems with Windows clients without the need to disable SELinux. I do hope that you appreciate its importance and see the ease of leaving SELinux in place once we are aware of its basics.</p><p>Although we did not implement the firewall in this chapter, we did again review the <code class="literal">firewalld</code> settings to make this happen. Firewalling with <code class="literal">firewalld</code> is covered in <a class="link" title="Chapter 11. Network Security with firewalld" href="part0090.xhtml#aid-2LQIK1">Chapter 11</a>, <span class="emphasis"><em>Network Security with firewalld</em></span>.</p><p>In the next chapter, we will look at how to integrate RHEL 7 into a Windows Active Directory domain.</p></div></body></html>