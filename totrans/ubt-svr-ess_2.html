<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Configuring and Administering Ubuntu Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Configuring and Administering Ubuntu Server</h1></div></div></div><p>After installing the Ubuntu Server, you will need to administrate it. If you are a newbie, this chapter is mandatory for you. So follow it to the letter. If you are an advanced Linux user who has experience working with other distributions, you can consider the experience of trying a new distribution similar to that of driving a new car. The car certainly has a steering wheel, a gas pedal, and a brake, but it still takes you a minute to adjust the mirrors, find out where the gauges and controls are, and adjust the seat until you feel comfortable. Think of this chapter as that minute or two behind the wheel of a new car.</p><p>To reach this goal, we will follow this plan:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Administering using the command line</li><li class="listitem" style="list-style-type: disc">The package management of an Ubuntu Server</li><li class="listitem" style="list-style-type: disc">The network configuration for an Ubuntu Server</li><li class="listitem" style="list-style-type: disc">Performing essential system administration tasks</li></ul></div><div class="section" title="Administering using the command line"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec13"/>Administering using the command line</h1></div></div></div><p>Entire <a class="indexterm" id="id51"/>books have been written on command-line tools and how to use them effectively. In this section, we will have a look at the essentials one that we need. If you are an experienced administrator, feel free to skip to the next section. Just keep in mind the following note, that's all.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>Note that unlike other Linux distributions, Ubuntu doesn't allow the use of the super user as a root by default; it is disabled for security reasons. So, when you would like to run a command with the root privileges, you should run it with the <code class="literal">sudo</code> keyword before doing so. You will be asked to enter your password (the one that you used when installing the Ubuntu Server). For example, if you would like to edit the <code class="literal">/etc/hosts</code> file, run the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ sudo vi /etc/hosts</strong></span>
<span class="strong"><strong>[sudo] password for abdelmonam:</strong></span>
</pre></div><p>If you would like to activate the root account (which is not recommended) or allow other users to run <code class="literal">sudo</code>, you can follow the detailed tutorial at. <a class="ulink" href="https://help.ubuntu.com/community/RootSudo">https://help.ubuntu.com/community/RootSudo</a>.</p></div></div><p>Now, let's<a class="indexterm" id="id52"/> start with what I consider to be the most important command for a Linux administrator—<code class="literal">man</code>, or the interface for online reference manuals. It gives you the necessary information about any command that you would like to use (if it is documented of course, which is true in most cases). We use it by typing the <code class="literal">man</code> keyword just before the command that we would like to be informed about. We use arrows keys to navigate, the <code class="literal">/</code> character to perform a search, the <span class="emphasis"><em>Enter</em></span> key to view the next line, the <span class="emphasis"><em>spacebar</em></span> to view the next page, and the <span class="emphasis"><em>q</em></span> character to quit the interface. For example, the following screenshot shows what you will see when you run the <code class="literal">man ls</code> command:</p><div class="mediaobject"><img alt="Administering using the command line" src="graphics/B04800_02_01.jpg"/></div><p>The <code class="literal">man</code> pages are grouped together in sections, with one section per topic. For example, the <code class="literal">man</code> pages in the first section are executable programs or <code class="literal">shell</code> commands, the ones in section 2 are <a class="indexterm" id="id53"/>
<span class="strong"><strong>system calls</strong></span> (functions provided by the kernel), and so on. You can see all the sections on running the <code class="literal">man man</code> command.</p><p>Another useful command is <code class="literal">apropos</code>, which shows the section and <code class="literal">man</code> page where the word in the parameter <a class="indexterm" id="id54"/>was found. For example, when searching the <code class="literal">man</code> pages/sections in which the <code class="literal">pwd</code> command exists, we use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ apropos pwd</strong></span>
<span class="strong"><strong>lckpwdf (3)          - get shadow password file entry</strong></span>
<span class="strong"><strong>pwd (1)              - print name of current/working directory</strong></span>
<span class="strong"><strong>pwdx (1)             - report current working directory of a process</strong></span>
<span class="strong"><strong>ulckpwdf (3)         - get shadow password file entry</strong></span>
<span class="strong"><strong>unix_chkpwd (8)      - Helper binary that verifies the password of the current user</strong></span>
</pre></div><p>Let's consider a case where a command exists under more than one section, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ apropos smbpasswd</strong></span>
<span class="strong"><strong>smbpasswd (5)        - The Samba encrypted password file</strong></span>
<span class="strong"><strong>smbpasswd (8)        - change a user's SMB password</strong></span>
</pre></div><p>You can view the information related to this section by using <code class="literal">man &lt;the_section_number&gt; &lt;the_command&gt;</code> (for example, <code class="literal">man 5 smbpasswd</code>). Alternatively, use <code class="literal">man -a &lt;the_command&gt;</code> if you would like to see all the <code class="literal">man</code> page sections in succession for that command (for example, <code class="literal">man -a smbpasswd</code>). If you omit the section number, <code class="literal">man</code> will return the <code class="literal">man</code> page from the first section that it finds.</p><p>The <code class="literal">ls</code> command lists files and directories under the path passed in the parameter (the actual <code class="literal">.</code> directory is the default choice). Some options are very helpful. For example, with the <code class="literal">-a</code> option, we can list the cached items. With the <code class="literal">-l</code> option, we can get additional information such as the file size and permissions:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ ls -la /etc/systemd/</strong></span>
<span class="strong"><strong>total 48</strong></span>
<span class="strong"><strong>drwxr-xr-x  5 root root 4096 Jun  2 17:30 .</strong></span>
<span class="strong"><strong>drwxr-xr-x 93 root root 4096 Jun  2 17:40 ..</strong></span>
<span class="strong"><strong>-rw-r--r--  1 root root  720 Apr 18 22:11 bootchart.conf</strong></span>
<span class="strong"><strong>-rw-r--r--  1 root root  970 Apr 18 22:11 journald.conf</strong></span>
<span class="strong"><strong>-rw-r--r--  1 root root  966 Apr 18 22:11 logind.conf</strong></span>
<span class="strong"><strong>drwxr-xr-x  2 root root 4096 Apr 18 22:11 network</strong></span>
<span class="strong"><strong>-rw-r--r--  1 root root  589 Apr 18 22:11 resolved.conf</strong></span>
<span class="strong"><strong>drwxr-xr-x 13 root root 4096 Jun  2 17:38 system</strong></span>
<span class="strong"><strong>-rw-r--r--  1 root root 1471 Apr 18 22:11 system.conf</strong></span>
<span class="strong"><strong>-rw-r--r--  1 root root  607 Apr 18 22:11 timesyncd.conf</strong></span>
<span class="strong"><strong>drwxr-xr-x  2 root root 4096 Apr 18 22:11 user</strong></span>
<span class="strong"><strong>-rw-r--r--  1 root root 1127 Apr 18 22:11 user.conf</strong></span>
</pre></div><p>The <code class="literal">pwd</code> command gives the current path (working directory).</p><p>The <code class="literal">history</code> command lists the last commands that you ran.</p><p>The <code class="literal">chmod</code> command allows you to change file permissions. Use it carefully, especially when you use the <code class="literal">*</code> magic card instead of a filename coupled with the <code class="literal">-R</code> option that runs it recursively. From the same family, we will find the <code class="literal">chown</code> and <code class="literal">chgrp</code> commands, which allow you to change the owner and group of a file respectively.</p><p>The <code class="literal">top</code> command <a class="indexterm" id="id55"/>gives you a list of the processes that are running on your Ubuntu Server; they are sorted by the CPU usage. This list is updated in real time, and it is limited by the size of the screen. If you want to see the whole list of the processes that are running on the system, you can run the famous <code class="literal">ps -ef | less</code> command. Here, we pipe the result of this command by using the <code class="literal">|</code> character as an input to the <code class="literal">less</code> command to see the result output page by page, <code class="literal">less</code> works like the famous <code class="literal">more</code> command. Besides, it allows you to surf forward and backward.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>Note that piping (using the <code class="literal">|</code> character) is a mechanism used to optimize commands output by passing the output of the first command (the command before the <code class="literal">|</code> character) as an input to the second command (the command after the <code class="literal">|</code> character). We can use a cascade of pipes using the <code class="literal">|</code> character in a single command line.</p></div></div><p>There are some useful shortcuts in the server environment (no graphic interface), such as <span class="emphasis"><em>Ctrl+C</em></span>, which is used to quit a command that is not responding (or is simply taking too long to complete), <span class="emphasis"><em>Ctrl+D</em></span>, which is used to send the <a class="indexterm" id="id56"/>
<span class="strong"><strong>end of file</strong></span> (<span class="strong"><strong>EOF</strong></span>) signal to a command, and finally <span class="emphasis"><em>Ctrl+Z</em></span>, which is used to stop the command that is running in the foreground (on the console). Even though it does stop the command, it does not terminate it. Instead, it is just paused. We can resume it easily either in the background via the <code class="literal">bg</code> command or again in the foreground with the <code class="literal">fg</code> command. To do this, you need the job number associated with the program that you want to start again. You can get a list of the job numbers by using the <code class="literal">jobs</code> command.</p><p>For file management, you will need to use <code class="literal">mkdir</code> for directory creation, <code class="literal">cd</code> to enter a directory, <code class="literal">touch</code> to create a file, and <code class="literal">cat</code> to view its contents. For directory/file management, you can use <code class="literal">cp</code> for copy, <code class="literal">rm</code> for remove, and <code class="literal">mv</code> for move/rename.</p><p>To edit a file, you can use either of the two famous editors, <code class="literal">vi</code> or <code class="literal">vim</code>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>Note that these are the most useful CLI commands. In the following sections and chapters in this book, we will have a look at other commands. An explanation for each of the commands will be given every time we need them. In case you would like to take advantage of a specific command, you can use the <code class="literal">man</code> command, as seen previously.</p></div></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>If you would like to learn more about Linux <span class="strong"><strong>command line</strong></span> (<span class="strong"><strong>CLI</strong></span>), I recommend that you refer to the book available at <a class="ulink" href="http://linuxcommand.org/tlcl.php">http://linuxcommand.org/tlcl.php</a>.</p><p>It is mandatory to know the basics of the <code class="literal">vi</code>/<code class="literal">vim</code> editors when you are working in a server environment. Learning how to use <code class="literal">vi</code> is beyond the scope of this book. So, you have to make some effort to do it yourself. For more help, you can find good basic training for the <code class="literal">vi</code> editor at <a class="ulink" href="http://www.cs.colostate.edu/helpdocs/vi.html">http://www.cs.colostate.edu/helpdocs/vi.html</a>.</p></div></div></div></div>
<div class="section" title="The package management for an Ubuntu Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>The package management for an Ubuntu Server</h1></div></div></div><p>Ubuntu, like<a class="indexterm" id="id57"/> other Debian-based systems, uses the Debian package format, such as <code class="literal">.deb</code> packages. I prefer using a <code class="literal">.deb</code> package when <a class="indexterm" id="id58"/>installing software instead of <code class="literal">tarball</code> archives because on one hand, unlike the case with <code class="literal">tarball</code>, we can get traceability for every piece of software installed on your system with <code class="literal">.deb</code> packages. On the other hand, because only a <code class="literal">.deb</code> package can request the package database on your server via the package manager and get information about the installed and available packages on your system, the package manager takes care of installing the missing dependencies automatically.</p><div class="section" title="Package repositories"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec17"/>Package repositories</h2></div></div></div><p>Ubuntu packages <a class="indexterm" id="id59"/>exist in repositories, which are collections of packages, in a pre-compiled binary format that can be located either on different medias, such as CD-ROMs, or on the Internet. There are four official repositories provided by Canonical (the company that created Ubuntu):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">main</code>: This is<a class="indexterm" id="id60"/> the repository that contains software<a class="indexterm" id="id61"/> distributed under a completely free license and supported by the Ubuntu team.</li><li class="listitem" style="list-style-type: disc"><code class="literal">restricted</code>: This <a class="indexterm" id="id62"/>is the repository that contains<a class="indexterm" id="id63"/> software that may not be under a completely free license but is supported by the Ubuntu team, such as drivers for specific hardware components.</li><li class="listitem" style="list-style-type: disc"><code class="literal">universe</code>: This <a class="indexterm" id="id64"/>repository contains most of the <a class="indexterm" id="id65"/>open source software available in the Linux world and which exists under licenses that may not be as free as the others. Software in this repository is not supported by the Ubuntu team.</li><li class="listitem" style="list-style-type: disc"><code class="literal">multiverse</code>: Here, you<a class="indexterm" id="id66"/> will find software that does <a class="indexterm" id="id67"/>not meet the free concept standards of software. Software in this repository is not supported by the Ubuntu team.</li></ul></div><p>There are a lot of other repositories. Many of them are owned by software editors and contain packages related to their products. Most of them are provided by the community and exist under the <a class="indexterm" id="id68"/>
<span class="strong"><strong>Personal Package Archives</strong></span> (<span class="strong"><strong>PPA</strong></span>) which is a repository software for Ubuntu (visit <a class="ulink" href="https://launchpad.net/ubuntu/+ppas">https://launchpad.net/ubuntu/+ppas</a> for more information).</p><p>The managing of repositories on your Ubuntu Server is done in the <code class="literal">/etc/apt/sources.list</code> file. Here's a sample of this file from a fresh Ubuntu Server installation:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ cat /etc/apt/sources.list</strong></span>
<span class="strong"><strong>#</strong></span>

<span class="strong"><strong># deb cdrom:[Ubuntu-Server 15.04 _Vivid Vervet_ - Release amd64 (20150422)]/ vivid main restricted</strong></span>

<span class="strong"><strong>#deb cdrom:[Ubuntu-Server 15.04 _Vivid Vervet_ - Release amd64 (20150422)]/ vivid main restricted</strong></span>

<span class="strong"><strong># See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to</strong></span>
<span class="strong"><strong># newer versions of the distribution.</strong></span>
<span class="strong"><strong>deb http://tn.archive.ubuntu.com/ubuntu/ vivid main restricted</strong></span>
<span class="strong"><strong>deb-src http://tn.archive.ubuntu.com/ubuntu/ vivid main restricted</strong></span>

<span class="strong"><strong>## Major bug fix updates produced after the final release of the</strong></span>
<span class="strong"><strong>## distribution.</strong></span>
<span class="strong"><strong>deb http://tn.archive.ubuntu.com/ubuntu/ vivid-updates main restricted</strong></span>
<span class="strong"><strong>deb-src http://tn.archive.ubuntu.com/ubuntu/ vivid-updates main restricted</strong></span>

<span class="strong"><strong>## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</strong></span>
<span class="strong"><strong>## team. Also, please note that software in universe WILL NOT receive any</strong></span>
<span class="strong"><strong>## review or updates from the Ubuntu security team.</strong></span>
<span class="strong"><strong>deb http://tn.archive.ubuntu.com/ubuntu/ vivid universe</strong></span>
<span class="strong"><strong>deb-src http://tn.archive.ubuntu.com/ubuntu/ vivid universe</strong></span>
<span class="strong"><strong>deb http://tn.archive.ubuntu.com/ubuntu/ vivid-updates universe</strong></span>
<span class="strong"><strong>deb-src http://tn.archive.ubuntu.com/ubuntu/ vivid-updates universe</strong></span>

<span class="strong"><strong>## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</strong></span>
<span class="strong"><strong>## team, and may not be under a free licence. Please satisfy yourself as to</strong></span>
<span class="strong"><strong>## your rights to use the software. Also, please note that software in</strong></span>
<span class="strong"><strong>## multiverse WILL NOT receive any review or updates from the Ubuntu</strong></span>
<span class="strong"><strong>## security team.</strong></span>
<span class="strong"><strong>deb http://tn.archive.ubuntu.com/ubuntu/ vivid multiverse</strong></span>
<span class="strong"><strong>deb-src http://tn.archive.ubuntu.com/ubuntu/ vivid multiverse</strong></span>
<span class="strong"><strong>deb http://tn.archive.ubuntu.com/ubuntu/ vivid-updates multiverse</strong></span>
<span class="strong"><strong>deb-src http://tn.archive.ubuntu.com/ubuntu/ vivid-updates multiverse</strong></span>

<span class="strong"><strong>## N.B. software from this repository may not have been tested as</strong></span>
<span class="strong"><strong>## extensively as that contained in the main release, although it includes</strong></span>
<span class="strong"><strong>## newer versions of some applications which may provide useful features.</strong></span>
<span class="strong"><strong>## Also, please note that software in backports WILL NOT receive any review</strong></span>
<span class="strong"><strong>## or updates from the Ubuntu security team.</strong></span>
<span class="strong"><strong>deb http://tn.archive.ubuntu.com/ubuntu/ vivid-backports main restricted universe multiverse</strong></span>
<span class="strong"><strong>deb-src http://tn.archive.ubuntu.com/ubuntu/ vivid-backports main restricted universe multiverse</strong></span>

<span class="strong"><strong>deb http://security.ubuntu.com/ubuntu vivid-security main restricted</strong></span>
<span class="strong"><strong>deb-src http://security.ubuntu.com/ubuntu vivid-security main restricted</strong></span>
<span class="strong"><strong>deb http://security.ubuntu.com/ubuntu vivid-security universe</strong></span>
<span class="strong"><strong>deb-src http://security.ubuntu.com/ubuntu vivid-security universe</strong></span>
<span class="strong"><strong>deb http://security.ubuntu.com/ubuntu vivid-security multiverse</strong></span>
<span class="strong"><strong>deb-src http://security.ubuntu.com/ubuntu vivid-security multiverse</strong></span>

<span class="strong"><strong>## Uncomment the following two lines to add software from Canonical's</strong></span>
<span class="strong"><strong>## 'partner' repository.</strong></span>
<span class="strong"><strong>## This software is not part of Ubuntu, but is offered by Canonical and the</strong></span>
<span class="strong"><strong>## respective vendors as a service to Ubuntu users.</strong></span>
<span class="strong"><strong># deb http://archive.canonical.com/ubuntu vivid partner</strong></span>
<span class="strong"><strong># deb-src http://archive.canonical.com/ubuntu vivid partner</strong></span>
</pre></div><p>After <a class="indexterm" id="id69"/>modifying the sources list file, update the packages database using the <code class="literal">sudo apt-get update</code> command. We will have a look at how to work with the <code class="literal">apt</code> tool in the next section.</p></div><div class="section" title="Package management utilities"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec15"/>Package management utilities</h2></div></div></div><p>In Ubuntu, there<a class="indexterm" id="id70"/> are a few package management utilities, especially in a non-graphical environment such as those of most server installations. In the following section, you will discover the three most used tools—<code class="literal">dpkg</code>, <code class="literal">aptitude</code> and <code class="literal">apt</code>—besides the famous <code class="literal">tasksel</code> utility.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>Note that working with more than one package management database can be confusing. I recommend that you choose one package management system to work with and stick to it. For the rest of this book, we will use <code class="literal">apt</code>.</p></div></div><div class="section" title="The dpkg tool"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec02"/>The dpkg tool</h3></div></div></div><p>This<a class="indexterm" id="id71"/> tool<a class="indexterm" id="id72"/> is used to manage (install, remove, and build) local <code class="literal">.deb</code> packages from a CD-ROM or some other disk storage. It doesn't automatically download and install packages from repositories and manage dependencies.</p><p>The <code class="literal">dpkg</code> tool is powerful. It can be used when working with locally installed packages. For example, it helps you list all the packages installed on your system, even the ones installed with other utilities, such as <code class="literal">apt</code>. To see that, you should run the command <code class="literal">dpkg -l</code> (because the output of this command is a huge list you can run <code class="literal">dpkg -l</code> command less to check them page per page). The following is the result of <code class="literal">dpkg -l | less</code> on our server:</p><div class="mediaobject"><img alt="The dpkg tool" src="graphics/B04800_02_02.jpg"/></div><p>The<a class="indexterm" id="id73"/> <code class="literal">dpkg</code> command <a class="indexterm" id="id74"/>can also list the different files installed with a specific package. In this case, we should use the <code class="literal">-l</code> option, with the name of the package as a parameter. As shown in the following screenshot, we listed the files installed with the <code class="literal">isc-dhcp-common</code> package:</p><div class="mediaobject"><img alt="The dpkg tool" src="graphics/B04800_02_03.jpg"/></div><p>On the other hand, we can check for a specific file within the package that it was installed in by using the <code class="literal">-S</code> option. As shown in the following screenshot, the <code class="literal">/usr/bin/omshell</code> file was installed with the <code class="literal">isc-dhcp-common</code> package:</p><div class="mediaobject"><img alt="The dpkg tool" src="graphics/B04800_02_04.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>Note that many files are automatically generated during package installation, and even though they are on the file system, <code class="literal">dpkg -S</code> may not know which package they belong to.</p></div></div><p>With <code class="literal">dpkg</code>, we can install the local <code class="literal">.deb</code> packages by using the <code class="literal">-i</code> option:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo dpkg -i &lt;file_name.deb&gt;</strong></span>
</pre></div><p>We can also remove packages by using the <code class="literal">-r</code> option, but it is not recommended because <code class="literal">dpkg</code> doesn't handle dependencies. If you use <code class="literal">dpkg</code> to remove a specific package that one or more programs depend on, you may break those programs.</p></div><div class="section" title="The aptitude tool"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec03"/>The aptitude tool</h3></div></div></div><p>The <a class="indexterm" id="id75"/>
<code class="literal">aptitude</code> tool is based on <a class="indexterm" id="id76"/>
<span class="strong"><strong>apt</strong></span> (<span class="strong"><strong>Advanced Packaging Tool</strong></span>), which will be discussed later in this chapter, but this tool is more user-friendly. You<a class="indexterm" id="id77"/> can use aptitude either with the <code class="literal">search</code> keyword to search for a specific word in the package description database, or with the <code class="literal">show</code> keyword to display a lot of useful information about a specific package. However, the most helpful use of <code class="literal">aptitude</code> is that you can launch it without a keyword and you will get a menu-driven text-based frontend for <code class="literal">apt</code>. This interface is suitable for server environments (usually non graphical tool). It helps users perform a lot of tasks automatically.</p><p>When you execute the <code class="literal">sudo aptitude</code> command, you will see the following interface:</p><div class="mediaobject"><img alt="The aptitude tool" src="graphics/B04800_02_05.jpg"/></div><p>You can view the <code class="literal">Package</code> menu by using the <span class="emphasis"><em>Ctrl+T</em></span> shortcut and navigate by using the arrow keys, as shown in the following screenshot:</p><div class="mediaobject"><img alt="The aptitude tool" src="graphics/B04800_02_06.jpg"/></div><p>You can<a class="indexterm" id="id78"/> also <a class="indexterm" id="id79"/>use <code class="literal">aptitude</code> as a command-line interface (a non-menu-driven interface) in a way that is similar to how you use <code class="literal">apt</code> as a command-line interface. For example, you can use <code class="literal">sudo aptitude install bind9</code> to install the <code class="literal">bind9</code> DNS server.</p></div><div class="section" title="The apt tools"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec04"/>The apt tools</h3></div></div></div><p>The <a class="indexterm" id="id80"/>
<code class="literal">apt</code> is used to download and install packages <a class="indexterm" id="id81"/>from online repositories. The <code class="literal">apt</code> commands (<code class="literal">apt-get</code>, <code class="literal">apt-cache</code>, and so on) are normally used to work with online software. However, they can also be used to install packages locally.</p><p>The <code class="literal">apt-cache</code> command allows you to manipulate the apt package cache. The <code class="literal">apt-cache</code> command does not modify the state of the system, but it does provide functions with which to search and generate useful output from the package metadata. For example, with the <code class="literal">search</code> keyword, you can search for a word in the package description database. With the <code class="literal">show</code> keyword, you can show the details of a specific package.</p><p>The <code class="literal">apt-get</code> tool<a class="indexterm" id="id82"/> is powerful. It performs a lot of functions, such as installing new package, upgrading an old package, updating the package database, and even upgrading the entire Ubuntu Server.</p><p>To install a new package, all you need to do is run the package with the <code class="literal">install</code> keyword. For example, to install the <code class="literal">apache2</code> web server, you should run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install apache2</strong></span>
</pre></div><p>You can of course remove it using the following command:</p><div class="informalexample"><pre class="programlisting">sudo apt-get remove apache2</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>Note that with the <code class="literal">--purge</code> option, you can also remove configuration files. So use it carefully.</p></div></div><p>We can <a class="indexterm" id="id83"/>install and remove a whole list of packages at the same time. Just write the packages' names, with the names separated by spaces.</p><p>A common use of <code class="literal">apt-get</code> is updating a software database after the modification of the source list file. To do this, execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get update</strong></span>
</pre></div><p>Over time, a lot of packages will have newer versions. Therefore, an <code class="literal">upgrade</code> operation is needed to keep your Ubuntu Server up-to-date, especially when talking about security updates. The <code class="literal">apt-get</code> tool allows us to do this by using the following command (after updating the database, as discussed before):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get upgrade.</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>Note that in general, after a new installation, the first thing that we need to do is upgrade all the software of the system by running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get update &amp;&amp; sudo apt-get upgrade</strong></span>
</pre></div></div></div><p>For more information about <code class="literal">apt-get</code>, you can refer to the man pages or use the <code class="literal">help</code> keyword, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ apt-get help</strong></span>
<span class="strong"><strong>apt 1.0.9.7ubuntu4 for amd64 compiled on Apr  7 2015 14:42:59</strong></span>
<span class="strong"><strong>Usage: apt-get [options] command</strong></span>
<span class="strong"><strong>  apt-get [options] install|remove pkg1 [pkg2 ...]</strong></span>
<span class="strong"><strong>  apt-get [options] source pkg1 [pkg2 ...]</strong></span>

<span class="strong"><strong>apt-get is a simple command line interface for downloading and</strong></span>
<span class="strong"><strong>installing packages. The most frequently used commands are update</strong></span>
<span class="strong"><strong>and install.</strong></span>

<span class="strong"><strong>Commands:</strong></span>
<span class="strong"><strong>  update - Retrieve new lists of packages</strong></span>
<span class="strong"><strong>  upgrade - Perform an upgrade</strong></span>
<span class="strong"><strong>  install - Install new packages (pkg is libc6 not libc6.deb)</strong></span>
<span class="strong"><strong>  remove - Remove packages</strong></span>
<span class="strong"><strong>  autoremove - Remove automatically all unused packages</strong></span>
<span class="strong"><strong>  purge - Remove packages and config files</strong></span>
<span class="strong"><strong>  source - Download source archives</strong></span>
<span class="strong"><strong>  build-dep - Configure build-dependencies for source packages</strong></span>
<span class="strong"><strong>  dist-upgrade - Distribution upgrade, see apt-get(8)</strong></span>
<span class="strong"><strong>  dselect-upgrade - Follow dselect selections</strong></span>
<span class="strong"><strong>  clean - Erase downloaded archive files</strong></span>
<span class="strong"><strong>  autoclean - Erase old downloaded archive files</strong></span>
<span class="strong"><strong>  check - Verify that there are no broken dependencies</strong></span>
<span class="strong"><strong>  changelog - Download and display the changelog for the given package</strong></span>
<span class="strong"><strong>  download - Download the binary package into the current directory</strong></span>

<span class="strong"><strong>Options:</strong></span>
<span class="strong"><strong>  -h  This help text.</strong></span>
<span class="strong"><strong>  -q  Loggable output - no progress indicator</strong></span>
<span class="strong"><strong>  -qq No output except for errors</strong></span>
<span class="strong"><strong>  -d  Download only - do NOT install or unpack archives</strong></span>
<span class="strong"><strong>  -s  No-act. Perform ordering simulation</strong></span>
<span class="strong"><strong>  -y  Assume Yes to all queries and do not prompt</strong></span>
<span class="strong"><strong>  -f  Attempt to correct a system with broken dependencies in place</strong></span>
<span class="strong"><strong>  -m  Attempt to continue if archives are unlocatable</strong></span>
<span class="strong"><strong>  -u  Show a list of upgraded packages as well</strong></span>
<span class="strong"><strong>  -b  Build the source package after fetching it</strong></span>
<span class="strong"><strong>  -V  Show verbose version numbers</strong></span>
<span class="strong"><strong>  -c=? Read this configuration file</strong></span>
<span class="strong"><strong>  -o=? Set an arbitrary configuration option, eg -o dir::cache=/tmp</strong></span>
<span class="strong"><strong>See the apt-get(8), sources.list(5) and apt.conf(5) manual</strong></span>
<span class="strong"><strong>pages for more information and options.</strong></span>
<span class="strong"><strong>This APT has Super Cow Powers.</strong></span>
</pre></div></div></div><div class="section" title="Adding software collections using tasksel"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>Adding software collections using tasksel</h2></div></div></div><p>The <code class="literal">tasksel</code> tool <a class="indexterm" id="id84"/>provides you with the <a class="indexterm" id="id85"/>possibility<a class="indexterm" id="id86"/> of installing new software and configuring them at the same time—either by using default values, or by asking you to enter the appropriate values. As a result, you will get the software that you want to install working and ready to use without any need for additional customization (you can of course reconfigure it as you want later).</p><p>You may remember that during the installation of software, we saw an interface that which asked us to <a class="indexterm" id="id87"/>install some servers (such as DNS, mail, web, and so on). This task can be accomplished with the help of <code class="literal">tasksel</code>. We can launch the same menu interface at any time by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo tasksel</strong></span>
</pre></div><p>The output of this command is as follows:</p><div class="mediaobject"><img alt="Adding software collections using tasksel" src="graphics/B04800_02_07.jpg"/></div><p>Use the arrow keys to navigate between the collections, press the <span class="emphasis"><em>spacebar</em></span> to select the software that you want to install (you will see an asterisk to the left of the software), press the <span class="emphasis"><em>Tab</em></span> key to navigate to the <span class="strong"><strong>OK</strong></span> button, and press the <span class="emphasis"><em>Enter</em></span> key to launch the installation.</p><p>If you would like to know which packages will be installed for a specific task, you can run, for the example of the <code class="literal">lamp</code> web server, the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ tasksel --task-packages lamp-server</strong></span>
<span class="strong"><strong>libmysqlclient18</strong></span>
<span class="strong"><strong>apache2</strong></span>
<span class="strong"><strong>php5-cli</strong></span>
<span class="strong"><strong>libapache2-mod-php5</strong></span>
<span class="strong"><strong>apache2.2-common</strong></span>
<span class="strong"><strong>apache2-utils</strong></span>
<span class="strong"><strong>php5-common</strong></span>
<span class="strong"><strong>php5-mysql</strong></span>
<span class="strong"><strong>mysql-server</strong></span>
<span class="strong"><strong>apache2.2-bin</strong></span>
<span class="strong"><strong>mysql-client-5.5</strong></span>
<span class="strong"><strong>mysql-server-5.5</strong></span>
<span class="strong"><strong>perl-modules</strong></span>
<span class="strong"><strong>perl</strong></span>
<span class="strong"><strong>mysql-server-core-5.5</strong></span>
<span class="strong"><strong>mysql-client-core-5.5</strong></span>
<span class="strong"><strong>ssl-cert</strong></span>
<span class="strong"><strong>apache2-mpm-prefork</strong></span>
<span class="strong"><strong>mysql-common</strong></span>
</pre></div></div></div>
<div class="section" title="The network configuration for an Ubuntu Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>The network configuration for an Ubuntu Server</h1></div></div></div><p>To cover <a class="indexterm" id="id88"/>all the aspects of network configuration for a Linux system administrator, we need huge books. So, in this little section, we will<a class="indexterm" id="id89"/> cover only the essential topics that every Ubuntu Server administrator will need to set up and change the network settings.</p><div class="section" title="The configuration files"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>The configuration files</h2></div></div></div><p>In this <a class="indexterm" id="id90"/>section, we will have a look at the core files for the network settings for the Ubuntu Server.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>Note that after modifying any of these files, you should restart the network process by typing in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo /etc/init.d/networking restart</strong></span>
</pre></div></div></div><p>Unlike Red Hat manners, Ubuntu and all the Debian-based distributions use a unique file to configure all the network interfaces; this file is named <code class="literal">/etc/network/interfaces</code>. In general, for Ubuntu servers, you will find the loopback and Ethernet interfaces. For loopback interfaces (127.0.0.1), its configuration is standard and doesn't need any modification from your side. For Ethernet interfaces, you will (in most of the cases when you are dealing with servers) find more than one interface. They are generally named <code class="literal">ethX</code>, where <code class="literal">X</code> is a number starting from <span class="emphasis"><em>0</em></span> and which is incremented according to the interface number.</p><p>An Ethernet interface is configured in either the DHCP or static mode. If it is the DHCP mode, we will find the following lines in <code class="literal">/etc/network/interfaces</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>auto eth0</strong></span>
<span class="strong"><strong>iface eth0 inet dhcp</strong></span>
</pre></div><p>Here, the <a class="indexterm" id="id91"/>line containing the <code class="literal">auto</code> keyword means that this interface should be automatically brought up when a computer boots up.</p><p>If it is in the static mode, you will find the output that looks like the following lines:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>iface eth0 inet static</strong></span>
<span class="strong"><strong>address 192.168.1.58</strong></span>
<span class="strong"><strong>netmask 255.255.255.0</strong></span>
<span class="strong"><strong>gateway 192.168.1.1</strong></span>
</pre></div><p>These fields are simple and pretty self-explanatory.</p><p>Another important network configuration file is <code class="literal">/etc/resolv.conf</code>, which contains the DNS list used by your server. If you are using DHCP, the content of this file will be set automatically. You can edit it by adding your own/favorite DNS servers in the following format:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>nameserver 192.168.1.11</strong></span>
<span class="strong"><strong>nameserver 192.168.1.12</strong></span>
</pre></div><p>The order of the DNS servers in this list will be followed when processing a DNS request.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>Note that in general, we edit DNS servers using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo vi /etc/resolv.conf</strong></span>
</pre></div><p>However, starting from Ubuntu 12.04 and later, you should use the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo vi /etc/resolvconf/resolv.conf.d/base</strong></span>
</pre></div></div></div><p>The <code class="literal">/etc/hosts</code> file is also one of the core network setting files. By default, it contains the loopback and local host addresses, but you can add to it another address/hostname pair. It will be used before checking the DNS. It is also useful when you want to assign an IP address to a hostname even if your DNS is down. This file is also used by a lot of services. We will have a look at this in the next chapter.</p></div><div class="section" title="The network utilities"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec21"/>The network utilities</h2></div></div></div><p>In this <a class="indexterm" id="id92"/>section, we will take a look at a set of networking programs that an administrator on an Ubuntu Server should be aware of.</p><p>The first two that you should know about are <code class="literal">ifup</code> and <code class="literal">ifdown</code>, which are used to put up interfaces and take them down respectively. You should use them with the name of the interface in the parameter.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Be careful when you take down an interface. You may potentially disrupt any services on the system. Furthermore, if you are connected to the system via SSH and you take down the main interface on the system, you will disconnect yourself from SSH.</p></div></div><p>Another important tool is <code class="literal">ifconfig</code>, which gives you detailed information about interfaces, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ ifconfig</strong></span>
<span class="strong"><strong>eth0  Link encap:Ethernet  HWaddr 08:00:27:74:26:9b</strong></span>
<span class="strong"><strong>      inet addr:192.168.1.58  Bcast:192.168.1.255  Mask:255.255.255.0</strong></span>
<span class="strong"><strong>      inet6 addr: fe80::a00:27ff:fe74:269b/64 Scope:Link</strong></span>
<span class="strong"><strong>      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</strong></span>
<span class="strong"><strong>      RX packets:3182 errors:0 dropped:0 overruns:0 frame:0</strong></span>
<span class="strong"><strong>      TX packets:758 errors:0 dropped:0 overruns:0 carrier:0</strong></span>
<span class="strong"><strong>      collisions:0 txqueuelen:1000</strong></span>
<span class="strong"><strong>      RX bytes:296560 (296.5 KB)  TX bytes:117994 (117.9 KB)</strong></span>

<span class="strong"><strong>lo    Link encap:Local Loopback</strong></span>
<span class="strong"><strong>      inet addr:127.0.0.1  Mask:255.0.0.0</strong></span>
<span class="strong"><strong>      inet6 addr: ::1/128 Scope:Host</strong></span>
<span class="strong"><strong>      UP LOOPBACK RUNNING  MTU:65536  Metric:1</strong></span>
<span class="strong"><strong>      RX packets:176 errors:0 dropped:0 overruns:0 frame:0</strong></span>
<span class="strong"><strong>      TX packets:176 errors:0 dropped:0 overruns:0 carrier:0</strong></span>
<span class="strong"><strong>      collisions:0 txqueuelen:0</strong></span>
<span class="strong"><strong>      RX bytes:14144 (14.1 KB)  TX bytes:14144 (14.1 KB)</strong></span>
</pre></div><p>The <code class="literal">ifconfig</code> command also allows you to configure interfaces, put them up, and take them down. You can take a look at its potential via <code class="literal">man ifconfig</code>.</p><p>Another important networking program is the <code class="literal">route</code> command. As with <code class="literal">ifconfig</code>, this command can be used to both see and set network settings (network routes in this case). It is used to manage routes on your server (such as to list, add, remove, and so on). Let's take a look at the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ route</strong></span>
<span class="strong"><strong>Kernel IP routing table</strong></span>
<span class="strong"><strong>Destination  Gateway      Genmask      Flags Metric Ref    Use Iface</strong></span>
<span class="strong"><strong>default      192.168.1.1  0.0.0.0       UG    0      0        0 eth0</strong></span>
<span class="strong"><strong>192.168.1.0  *            255.255.255.0  U    0      0        0 eth0</strong></span>
</pre></div><p>In the same<a class="indexterm" id="id93"/> context of routing configuration, there is the famous <code class="literal">traceroute6</code> command, which gives you the path followed by packets <code class="literal">egressing</code> from your server until their destination.</p><p>The <code class="literal">ethtool</code>  command is a program that manipulates the Ethernet card settings, such as port speed, auto-negotiation, the duplex mode, and Wake-on-LAN. You can install it by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install ethtool</strong></span>
</pre></div><p>To check the <code class="literal">ethtool</code> options, you have to run either <code class="literal">man ethtool</code> or <code class="literal">ethtool -h | less</code>.</p></div></div>
<div class="section" title="Performing essential system administration tasks"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Performing essential system administration tasks</h1></div></div></div><p>In this<a class="indexterm" id="id94"/> section, we <a class="indexterm" id="id95"/>will explore a useful set of Ubuntu Server administration tasks such as monitoring and processes management.</p><div class="section" title="Monitoring resources"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/>Monitoring resources</h2></div></div></div><p>For a <a class="indexterm" id="id96"/>system administrator, monitoring tasks are the most important because they allow us to keep our system robust and prevent incidents. The Ubuntu Server has a powerful set of monitoring tools that cover CPU usage, hard disks, virtual memory, and so on.</p><p>Some tools come with Ubuntu straight out of the box, while others need to be installed. The <code class="literal">sysstat</code> package contains some of them. You need to install it by using the command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo apt-get install sysstat</strong></span>
</pre></div><p>One of the most important resources that an Ubuntu Server administrator should permanently monitor is the memory use, because running out of memory will negatively affect system performance.</p><p>You can use the <code class="literal">free</code> and <code class="literal">top</code> commands to see basic information about the use of your RAM and swap. To get more detailed information about your server memory use, you can refer to the <code class="literal">vmstat</code> command. The <code class="literal">slabtop</code> command is useful in case you would like to show how much memory the kernel (the slab cache) of your server is consuming.</p><p>As seen earlier, the <code class="literal">top</code> command is used to watch the currently running processes. By default, those processes are sorted by the CPU usage. You can also use <code class="literal">top</code> to keep a tab on your memory usage in a screen-oriented way. When top is running, just press <span class="emphasis"><em>Shift+m</em></span>, and the running processes will be sorted by the memory use (so that you can examine which processes are consuming memory the most).</p><p>Another <a class="indexterm" id="id97"/>important system resource that an Ubuntu Server administrator monitors is the CPU usage. The <code class="literal">vmstat</code> command that we previously talked about can produce basic statistics related to CPU usage, such as system activity, user activity, the I/O wait time, the idle time, and so on. If you want more detailed reports of CPU utilization, you can use the <code class="literal">iostat</code> command that comes with the <code class="literal">sysstat</code> package, which was installed at the beginning of this section.</p><p>For example, here's how the CPU statistics are shown every 5 seconds:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ iostat -c 5</strong></span>
<span class="strong"><strong>Linux 3.19.0-15-generic (abdelmonam-tactic)  2015-06-13  _x86_64_ (1 CPU)</strong></span>

<span class="strong"><strong>avg-cpu:  %user   %nice  %system  %iowait  %steal   %idle</strong></span>
<span class="strong"><strong>          24,27   0,08   5,17     0,94     0,00     69,55</strong></span>

<span class="strong"><strong>avg-cpu:  %user   %nice %system %iowait  %steal   %idle</strong></span>
<span class="strong"><strong>          24,45   0,00  3,41    0,25     0,00     71,89</strong></span>

<span class="strong"><strong>avg-cpu:  %user   %nice %system %iowait  %steal   %idle</strong></span>
<span class="strong"><strong>          24,66    0,00    3,11    0,15    0,00   72,08</strong></span>

<span class="strong"><strong>avg-cpu:  %user   %nice %system %iowait  %steal   %idle</strong></span>
<span class="strong"><strong>          28,17   0,00  3,39    0,10     0,00     68,34</strong></span>

<span class="strong"><strong>avg-cpu:  %user   %nice %system %iowait  %steal   %idle</strong></span>
<span class="strong"><strong>          23,97   0,00  2,65    0,41     0,00     72,98</strong></span>

<span class="strong"><strong>avg-cpu:  %user   %nice %system %iowait  %steal   %idle</strong></span>
<span class="strong"><strong>          25,08   0,00  3,13    0,21     0,00     71,59</strong></span>

<span class="strong"><strong>avg-cpu:  %user   %nice %system %iowait  %steal   %idle</strong></span>
<span class="strong"><strong>          25,56   0,00  3,46    0,00     0,00     70,99</strong></span>
</pre></div><p>An alternative to <code class="literal">iostat</code> in terms of viewing CPU usage information as well as other performance-related items is the <code class="literal">dstat</code> command, which comes with the <code class="literal">dstat</code> package. The <code class="literal">dstat</code>  command has some advantages over other tools, such as the simplicity and clarity of information shown, and the use of colors. To install this tool, install the <code class="literal">dstat</code> package using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get install dstat</strong></span>
</pre></div><p>Here is an example of <code class="literal">dstat</code> displaying CPU information:</p><div class="mediaobject"><img alt="Monitoring resources" src="graphics/B04800_02_08.jpg"/></div><p>As discussed<a class="indexterm" id="id98"/> previously, the <code class="literal">top</code> command allows you to specifically find out which processes are consuming processing time the most. By default, the sorting order is based on CPU usage, but if you change it for some reason (like we did before when we changed it so that it was based on memory usage), you can revert to the default sorting order by using the <span class="emphasis"><em>Shift+p</em></span> command when <code class="literal">top</code> is running.</p><p>Commands such as <code class="literal">du</code> and <code class="literal">df</code> allow you get basic information about storage space available to your Ubuntu Server. For more details about how your storage devices are performing, you can use commands such as <code class="literal">vmstat</code> and <code class="literal">iostat</code>.</p><p>Let's have a look at the capacity of the <code class="literal">vmstat</code> command by using it to list statistics related to your disks. Here's an example of using <code class="literal">vmstat</code> to view information about the disk read and write statistics using the -d option:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ vmstat -d</strong></span>
</pre></div><div class="informalexample"><pre class="programlisting">disk--------reads-------- ---------writes-------- -----IO------
     total merged sectors ms  total  merged  sectors  ms  cur  sec
ram0  0     0      0       0   0      0       0        0   0     0
ram1  0     0      0       0   0      0       0        0   0     0
ram2  0     0      0       0   0      0       0        0   0     0
ram3  0     0      0       0   0      0       0        0   0     0
ram4  0     0      0       0   0      0       0        0   0     0
ram5  0     0      0       0   0      0       0        0   0     0
ram6  0     0      0       0   0      0       0        0   0     0
ram7  0     0      0       0   0      0       0        0   0     0
ram8  0     0      0       0   0      0       0        0   0     0
ram9  0     0      0       0   0      0       0        0   0     0
ram10 0     0      0       0   0      0       0        0   0     0
ram11 0     0      0       0   0      0       0        0   0     0
ram12 0     0      0       0   0      0       0        0   0     0
ram13 0     0      0       0   0      0       0        0   0     0
ram14 0     0      0       0   0      0       0        0   0     0
ram15 0     0      0       0   0      0       0        0   0     0
loop0 0     0      0       0   0      0       0        0   0     0
loop1 0     0      0       0   0      0       0        0   0     0
loop2 0     0      0       0   0      0       0        0   0     0
loop3 0     0      0       0   0      0       0        0   0     0
loop4 0     0      0       0   0      0       0        0   0     0
loop5 0     0      0       0   0      0       0        0   0     0
loop6 0     0      0       0   0      0       0        0   0     0
loop7 0     0      0       0   0      0       0        0   0     0
sr0   0     0      0       0   0      0       0        0   0     0
sr1   0     0      0       0   0      0       0        0   0     0
sda   6742  89   493438  73140 732   969    43336   17552  0    37</pre></div><p>Another useful<a class="indexterm" id="id99"/> command in terms of file system management is <code class="literal">lsof</code>. It allows you to find out what files and directories are actually open on your storage devices. One of the most common cases where you need to use this command is when you are trying to unmount a file system that keeps telling you that it is busy. In this case, you can evaluate which open file is preventing the unmounting, decide if you want to stop the process holding that file open, and perform the unmounting of the file system again.</p></div><div class="section" title="Processes management"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/>Processes management</h2></div></div></div><p>As<a class="indexterm" id="id100"/> discussed before, the <code class="literal">ps</code> and <code class="literal">top</code> commands allow us to show a lot of information related to the running processes. In this section, we will examine other commands that allow us to manage processes.</p><p>When you are running <code class="literal">top</code>, you can perform a lot of actions besides sorting. For example, you can type the letter <span class="emphasis"><em>k</em></span> followed by a signal number (for example, 9 or 15) and the PID, which sends that signal to the process that has this PID. You can also use the letter <span class="emphasis"><em>n</em></span> to change the priority of one process.</p><p>Another way to change the priority of a running process is via the <code class="literal">renice</code> command. If you want to change the default priority or set a higher or lower priority at the time of launching a process, you can use the nice command.</p><p>Another <a class="indexterm" id="id101"/>way that can be used to change how a running process behaves is to send a signal to that process. Commands such as <code class="literal">kill</code>, <code class="literal">pkill</code>, and <code class="literal">killall</code> can be used to send signals to running processes. We can represent signals by numbers (the famous ones are 9 and 15) and strings (such as SIGKILL and SIGTERM).</p></div><div class="section" title="Scheduling the processes that need to be run"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Scheduling the processes that need to be run</h2></div></div></div><p>Commands <a class="indexterm" id="id102"/>associated with the <code class="literal">cron</code> facility can be used to make a command run at a specific time (including now) so that it is not connected to the current shell. The <code class="literal">at</code> command runs a command at the time you set. For example, if you want to run a command in 1 minute, all you need is to run the <code class="literal">at now +1 min</code> command. Then, when you get the at prompt, you write the command, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>at&gt; your_command</strong></span>
</pre></div><p>After this, press <span class="emphasis"><em>Enter</em></span>. You will get the at prompt again. You can enter another command or number of commands that you want, with each one on a line. Then, type enter. Finally, run the <span class="emphasis"><em>Ctrl+d</em></span> shortcut to close the at prompt.</p><p>In the same manner, you can type <code class="literal">at now +7 days</code> to run a command after 7 days. Alternatively, if you would like to execute a command at a specific date, you can run <code class="literal">at</code> followed by the date in the <code class="literal">dd/mm/yy</code> format.</p><p>If you want to check the list (queue) of the at jobs that were set to run after you finish entering the commands, as discussed previously, you have to run the <code class="literal">atq</code> command. If you are a new user, you can see your own queued at jobs. Only the root user can see everyone's queued <code class="literal">at</code> jobs. The <code class="literal">atrm</code> command, followed by the job number (given <code class="literal">at</code> the creation step or via the <code class="literal">atq</code> command), is used to delete an <code class="literal">at</code> job from the queue.</p><p>The <code class="literal">at</code> command is used to queue up a command that is supposed to run only once. If you want to set up commands so that they run repeatedly, you can use the <code class="literal">cron</code> facility, which allows you to script the <code class="literal">cron</code> jobs scheduled in the <code class="literal">crontab</code> files. Generally, there is one system <code class="literal">crontab</code> file (which is <code class="literal">/etc/crontab</code>), but each user can create their personal <code class="literal">crontab</code> file that allows them to launch commands <code class="literal">at</code> the times that they choose. To create a personal <code class="literal">crontab</code> file, you need to type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>crontab -e</strong></span>
</pre></div><p>The <code class="literal">crontab -e</code> command opens the <code class="literal">crontab</code> file in case it exists, or it creates a new one using a text editor from your choice:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>abdelmonam@abdelmonam-tactic:~$ crontab -e</strong></span>
<span class="strong"><strong>no crontab for abdelmonam - using an empty one</strong></span>

<span class="strong"><strong>Select an editor.  To change later, run 'select-editor'.</strong></span>
<span class="strong"><strong>  1. /bin/ed</strong></span>
<span class="strong"><strong>  2. /bin/nano        &lt;---- easiest</strong></span>
<span class="strong"><strong>  3. /usr/bin/emacs23</strong></span>
<span class="strong"><strong>  4. /usr/bin/vim.tiny</strong></span>

<span class="strong"><strong>Choose 1-4 [2]:</strong></span>
</pre></div><p>In a <code class="literal">crontab</code> file, each <a class="indexterm" id="id103"/>job is represented by a single line that determines when to run the job, followed by the command that needs to be run. For the <code class="literal">times</code> fields, they are in the following order: <span class="strong"><strong>minute</strong></span> (<span class="strong"><strong>m</strong></span>), <span class="strong"><strong>hour</strong></span> (<span class="strong"><strong>h</strong></span>), <span class="strong"><strong>day of month</strong></span> (<span class="strong"><strong>dom</strong></span>), <span class="strong"><strong>month</strong></span> (<span class="strong"><strong>mon</strong></span>), and <span class="strong"><strong>day of the week</strong></span> (<span class="strong"><strong>dow</strong></span>). You can use <code class="literal">*</code> in these fields (for <code class="literal">any</code>).</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>The following are the fields from left to right: minute (0 to 59), hour (0 to 23), date of the month (0 to 31), month (0 to 12 or Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, or Dec), and day of the week (0 to 7 or Sun, Mon, Tue, Wed, Thu, Fri, or Sat). An asterisk (*) in a field means that any value for that field can be matched.</p></div></div><p>You can use a single value for each field or more than one. For example, for the <code class="literal">dow</code> field, you can use the <span class="strong"><strong>Mon</strong></span>, <span class="strong"><strong>Fri</strong></span> value to run a job at every beginning and end of the week (every <span class="strong"><strong>Monday</strong></span> and <span class="strong"><strong>Friday</strong></span>). Providing another example, for the <code class="literal">mon</code> field, a value of 1,4,7,10 means that the job will be launched in the first month of each quarter (January, April, July, and October).</p><p>The output of the <code class="literal">crontab</code> jobs (including errors) is sent via an e-mail to the user belongs to the <code class="literal">crontab</code> file (unless redirected).</p><p>To list the contents of your <code class="literal">crontab</code> file, you should run <code class="literal">crontab –l</code>, and to delete your <code class="literal">crontab</code> file, you should run <code class="literal">crontab -r</code>.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Summary</h1></div></div></div><p>In this chapter, we saw different aspects of configuring and administering the Ubuntu Server system. We were introduced to CLI using network settings, package management, and administration tasks.</p><p>In the next chapter, we will start a new part of this book, which involves service creation and management.</p></div></body></html>