<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Software Provisioning for Windows"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Software Provisioning for Windows</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing a software repository on Windows</li><li class="listitem" style="list-style-type: disc">Deploying additional components on agents</li><li class="listitem" style="list-style-type: disc">Creating software packages</li><li class="listitem" style="list-style-type: disc">Publishing software packages to a repository</li><li class="listitem" style="list-style-type: disc">Adding a repository to VCM</li><li class="listitem" style="list-style-type: disc">Adding repository sources to package managers</li><li class="listitem" style="list-style-type: disc">Deploying a package</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec49"/>Introduction</h1></div></div></div><p>VCM's software provisioning provides tools, resources, and mechanisms for creating and managing packages for the software you plan to distribute and finally installing the software on managed machines. VCM's software distribution works only with Windows and not other OSes.</p><p>In this chapter, we will be looking at a software provisioning overview and the steps required for installing software on managed machines via VCM.</p><p>Software provisioning is the process by which we can create software packages, publish those packages to repositories, and then install them on target machines.</p><p>To support the provisioning process, the VCM software provisioning components consist of the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Software package repositories</li><li class="listitem" style="list-style-type: disc">Package manager</li><li class="listitem" style="list-style-type: disc">VMware vCenter Configuration Manager Package Studio</li></ul></div><div class="section" title="The Windows software repository"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec132"/>The Windows software repository</h2></div></div></div><p>The Windows software repository is the shared location to which packages are published by <span class="strong"><strong>Package Studio</strong></span> and the location from which package manager downloads packages for installation.</p></div><div class="section" title="Package manager for Windows"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec133"/>Package manager for Windows</h2></div></div></div><p>Package manager is the application installed on each machine to manage the installation and removal of the software contained in packages. Package manager is configured to use one or more repositories as a source for packages.</p><p>This figure shows the relationship between the VCM Collector server, software repositories, and package manager instances:</p><div class="mediaobject"><img alt="Package manager for Windows" src="graphics/image_05_001.jpg"/></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note38"/>Note</h3><p>The definitions and figure are taken from the vCenter Configuration Manager administration guide (<a class="ulink" href="http://www.vmware.com/pdf/vcenter-configuration-manager-57-administration-guide.pdf">http://www.vmware.com/pdf/vcenter-configuration-manager-57-administration-guide.pdf</a>).</p></div></div></div><div class="section" title="VMware vCenter Configuration Manager Package Studio"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec134"/>VMware vCenter Configuration Manager Package Studio</h2></div></div></div><p>Package Studio is the application used to build software packages for installation on target Windows servers and workstations.</p><p>A software package provides the files and metadata necessary to install and remove programs. One of the most useful features of a package is the metadata regarding dependencies, conflicts, and other relationships, which are not represented by software installation files. This metadata is used to determine whether the necessary dependencies are in place so that an installation is successful, and if not, what is necessary to make it successful.</p><p>After a package has been created and is ready for distribution, it is published to a software repository. We then use package manager to download the package from the repository to the local machine and install it on Windows systems.</p></div></div></div>
<div class="section" title="Installing a software repository on Windows"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec50"/>Installing a software repository on Windows</h1></div></div></div><p>The software repository is installed on at least one Windows machine in the infrastructure, and Package Studio needs to be on the same machine, with the repository being installed before installing Package Studio.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec135"/>Getting ready</h2></div></div></div><p>As the repositories are installed on the Collector server by default, if we need another repository, then we need to install another Windows server with IIS. IIS requirements are the same as that of the Collector server, mentioned in <a class="link" href="ch01.html" title="Chapter 1. Installing VCM">Chapter 1</a>, <span class="emphasis"><em>Installing VCM</em></span>, in the <span class="emphasis"><em>Preparing our VCM deployment - installing and configuring IIS</em></span> recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec136"/>How to do it...</h2></div></div></div><p>To deploy a software repository on any other server, follow this process:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we locate <code class="literal">Repository.msi</code> at the following location:<pre class="programlisting">
<span class="strong"><strong>
X:\Program Files (x86)\VMware\VCM\AgentFiles\Products (on the VCM &#13;
       collector Server)
</strong></span>
</pre></li><li class="listitem">When we double-click on the <code class="literal">Repository.msi</code> file, it will launch the wizard, and after accepting the EULA and selecting the installation location, it will ask you to provide a virtual directory:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_002.jpg"/></div><p>We can either go with the default name or change it.</p></li><li class="listitem">Follow the wizard to finish the installation.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec137"/>How it works...</h2></div></div></div><p>A repository is used by Package Studio to store created packages that will be used to provision the managed machines. We can create multiple repositories and keep them close to the managed machines to avoid bandwidth consumption over WAN; also, local provisioning will be much faster.</p><p>As repositories will be used to store the installer, you need to provision enough disk space, depending on how many and which applications you are planning to distribute. This acts like a file server, from where all the VCM-managed machines will copy the packages and then install them. A server with two vCPUs and 8 GB of RAM should be enough to cater to the needs of a dedicated software repository.</p></div></div>
<div class="section" title="Deploying additional components on agents"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec51"/>Deploying additional components on agents</h1></div></div></div><p>Package manager, which is installed on the target machines, manages the installation of software packages. It does not contain the software packages, only pointers to the packages in the repository sources of which it is aware. When directed to install, the package is copied from the repository to the <code class="literal">cratecache</code> folder on the target machines. Package manager unzips the files to the <code class="literal">%TMP%</code> directory and runs the configured installation.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note39"/>Note</h3><p>This is applicable for VCM 5.7.3 or earlier; ignore this if you are already at 5.8.0 or later.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec138"/>Getting ready</h2></div></div></div><p>For this recipe, we need a working VCM server and managed machines where VCM agents are installed.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec139"/>How to do it...</h2></div></div></div><p>We will follow the process to check whether agent extensions for provisioning are installed or not. If they aren't, we will install them.</p><p>This only applies to VCM 5.7.3 or earlier. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Once logged in to VCM with admin privileges, go to <span class="strong"><strong>Administration </strong></span>| <span class="strong"><strong>Machines Manager</strong></span> | <span class="strong"><strong>Licensed Machines</strong></span> | <span class="strong"><strong>Licensed Windows Machines</strong></span>.</li><li class="listitem">In the data grid, locate the machines on which you are verifying the existence of the necessary agent extensions, and verify that the <span class="strong"><strong>Agent Ext. For Prov. Version </strong></span>column contains a value of 5.3 or later.</li><li class="listitem">You need to scroll right to see the <span class="strong"><strong>Agent Ext. for Prov. Version</strong></span> column:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_003.jpg"/></div></li><li class="listitem">If it does not, you need to either install or upgrade the VCM agent from the VCM console. Follow the <span class="emphasis"><em>Upgrading VCM agents</em></span> recipe from <a class="link" href="ch07.html" title="Chapter 7. Maintenance of VCM">Chapter 7</a>, <span class="emphasis"><em>Maintenance of VCM.</em></span></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec140"/>How it works...</h2></div></div></div><p>Agent extensions for provisioning are required to be installed on the managed machine where we need to provision the software. By following this process, we make sure they are there, and if they're missing, we take the necessary action to install them.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>Note that package manager is installed on target machines while the VCM agent version 5.3 or later <span class="emphasis"><em>is installed from the Collector.</em></span></p></div></div></div></div>
<div class="section" title="Creating software packages"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec52"/>Creating software packages</h1></div></div></div><p>Package Studio is the application used to build software packages for installation on target Windows machines managed by VCM.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note41"/>Note</h3><p>Note that the software we want to create a package for must be able to install and uninstall without user interaction. This is referred to as <span class="strong"><strong>quiet or silent installation</strong></span>. Typically, command-line options are used.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec141"/>Getting ready</h2></div></div></div><p>Before we start with this, we need a completely installed VCM server and the package manager tool installed in order to create the package.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec142"/>How to do it...</h2></div></div></div><p>In this recipe, we will create a package for <code class="literal">WinRAR.exe</code>, downloaded from 

<a class="ulink" href="http://www.rarlab.com/">http://www.rarlab.com</a>.</p><p>To do so, follow these steps.</p><p>Start VMware vCenter Configuration Manager Package Studio. Go to <span class="strong"><strong>Start </strong></span>| <span class="strong"><strong>VMware vCenter Configuration Manager</strong></span> | <span class="strong"><strong>Package Studio</strong></span>
.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note42"/>Note</h3><p>Note that for running Package Studio on a Windows 2008 server, we must run the application as an administrator.</p></div></div><p>Click on <span class="strong"><strong>Manage Packages</strong></span>, and configure the package contents based on the options in the following tabs:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Properties</strong></span> and type a <span class="strong"><strong>Name</strong></span>, <span class="strong"><strong>Version</strong></span>, and <span class="strong"><strong>Description</strong></span>, and select the <span class="strong"><strong>Architecture</strong></span>. These fields are required. You have the option of updating the other fields, depending on you requirements:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_004.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Files</strong></span>, import the installation files, and configure the command, as follows:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Select Folder</strong></span> and go to the location where the installer is kept.</li><li class="listitem">Click on <span class="strong"><strong>Import</strong></span> Files.</li><li class="listitem">Click on <span class="strong"><strong>Set Command</strong></span>, and then, in the <span class="strong"><strong>Command</strong></span> textbox, a command will be created. In our case, it will be <code class="literal">winrar-x64-530.exe</code>.</li></ol></div><p>Provide any additional arguments; in this case, 
<code class="literal">/s</code> is used for a silent installation of winrar.</p><p>You can get the required options from the vendor of the software you are trying to install, or you can visit sites such as 
<a class="ulink" href="http://www.itninja.com/">
www.itninja.com
</a>.</p><p>Refer to the blog at 
<a class="ulink" href="http://www.itninja.com/question/what-switches-to-use-with-exe-files-in-silent-mode">
http://www.itninja.com/question/what-switches-to-use-with-exe-files-in-silent-mode
</a>
.</p></li><li class="listitem">We have two options: <span class="strong"><strong>Installation </strong></span>or <span class="strong"><strong>Removal</strong></span>. In this case, we will choose <span class="strong"><strong>Installation</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_005.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Save </strong></span>to save the project file so that, if required, we can come back and edit it:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_006.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Generate</strong></span>; this will generate a <code class="literal">.crate</code> file, which will be used to provision winrar on managed machines:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_007.jpg"/></div></li></ol></div><p>This is how we can create a software package that can be used for provisioning.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec143"/>How it works...</h2></div></div></div><p>By following this recipe, we can create a software package in a VCM-recognized format (<code class="literal">.crate</code>), which will be published on multiple repositories and then downloaded and processed by the VCM agents on the managed machines in order to install the actual software.</p></div></div>
<div class="section" title="Publishing software packages to a repository"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Publishing software packages to a repository</h1></div></div></div><p>In the previous recipe, we created a package in the <code class="literal">.crate</code> format. The first thing to do after this is distribute the package to the repositories and from there to the managed machines' temporary folders to get it installed.</p><p>Now, we will publish the package we created in the previous recipe to the repositories for further processing.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec144"/>Getting ready</h2></div></div></div><p>We need a package created in Package Studio, such as the one we created in the previous recipe, and a repository installed by following the 
<span class="emphasis"><em>Installing a software repository on Windows</em></span>
 recipe in order to complete this recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec145"/>How to do it...</h2></div></div></div><p>We can continue where we left off in the previous recipe or relaunch Package Studio and open the previously created project file.</p><p>Follow these steps to publish the package to your repository:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>Manage Repositories</strong></span> button on the left-hand side. Once on the <span class="strong"><strong>Repository </strong></span>page, click on <span class="strong"><strong>Add Platform</strong></span>. Basically, this is how we can determine which package goes in which folder. These platforms and sections are assigned to managed machines (or package manager in the following recipes).<p>We can create multiple platforms, such as Windows Server 2008 or Windows Server 2012:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_008.jpg"/></div></li><li class="listitem">Each platform has multiple sections; we can add any number of sections and name them as we want. It is recommended you name them x86 and x64 to categorize your software accordingly:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_009.jpg"/></div></li><li class="listitem">Once the sections have been added, select the appropriate section - either <code class="literal">x86</code> or <code class="literal">x64</code> - and hit <span class="strong"><strong>Publish Package</strong></span>. Browse to the location of the <code class="literal">.crate</code> file and select it:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_010.jpg"/></div><p>
</p></li><li class="listitem">Choose the section(s):<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_011.jpg"/></div></li><li class="listitem">We are now good to go:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_012.jpg"/></div></li></ol></div><p>You can check whether the package has been published or not by doing either or both of the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <code class="literal">X:\Program Files(x86)\VMware\VCM\Tools\Repository\Crates\</code>.<p>You will find a folder with a single-letter name. The letter will be the first letter of our <code class="literal">.crate</code> file.</p><p>There, you will find a <code class="literal">.crate</code> file ready for deployment:</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_013.jpg"/></div></li><li class="listitem">From Internet Explorer, go to <code class="literal">
http://&lt;Repository Server name/ IP&gt;/SoftwareRepository/Crates/X</code>.<p>Again, <span class="emphasis"><em>X</em></span> is a letter, which is the first letter of the <code class="literal">.crate</code> filename.</p><div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_014.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec146"/>How it works...</h2></div></div></div><p>In this recipe, VCM copies the <code class="literal">.crate</code> files to the proper locations on the repository server so that they can be accessed by package manager when it tries to deploy the published package.</p><p>
<span class="strong"><strong>About platforms</strong></span>: The platform value can be used to define the operating system architecture on which the package can be installed. We can create and use platforms to help manage our software package distribution based on the operating system platforms on which they can be installed. When we use a greater level of specificity, it results in smaller groups of packages and increases the predictability of which packages are installed.</p><p>
<span class="strong"><strong>About sections</strong></span>: Sections are used to further refine how your packages are organized on each platform. They are used to specify the repository sources for package manager, allowing us to control which packages are available to which machines. How you use sections can be adapted to your particular business needs. The following are examples of how you can use sections:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Line-of-business groups</strong></span>: Marketing, sales, HRD, and engineering</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Development state</strong></span>: Development, acceptance, and production</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>IT software management structure</strong></span>: Software publishers, departments, and business groups</li></ul></div></div></div>
<div class="section" title="Adding a repository to VCM&#xA0;"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Adding a repository to VCM </h1></div></div></div><p>Once a package has been created and published on the repository, we need to assign the repository to managed machines so that they can download and install the package.</p><p>To view information about packages and package manager in VCM, we must collect package manager data from managed machines.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec147"/>Getting ready</h2></div></div></div><p>We need the agents ready with package manager installed, that is, we need to follow the 
<span class="emphasis"><em>Deploying additional components on agents</em></span>
 recipe, and the repository should be published with the software we plan to provision by following the previous recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec148"/>How to do it...</h2></div></div></div><p>This is a two-step process. In the first step, we will collect data from all the managed machines that need the software to be provisioned and check their status, and in the second step, we will collect data from the repository servers to check which packages are available for provisioning.</p><div class="section" title="Collecting software provisioning package manager data"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec53"/>Collecting software provisioning package manager data</h3></div></div></div><p>We need to run this against all the machines on which we need to provision the software and on which package manager has been installed. Follow these steps to collect data:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Once logged in to VCM as an administrator, click on <span class="strong"><strong>Collect </strong></span>in the top-left corner of the VCM console:<div class="mediaobject"><img alt="Collecting software provisioning package manager data" src="graphics/image_05_015.jpg"/></div></li><li class="listitem">This will launch the wizard; select <span class="strong"><strong>Machine Data</strong></span>, and in the next step, select all the machines from which you need to collect the details.</li><li class="listitem">Under <span class="strong"><strong>Data Types</strong></span>, make sure <span class="strong"><strong>Software Provisioning - Package Managers</strong></span> has been selected:<div class="mediaobject"><img alt="Collecting software provisioning package manager data" src="graphics/image_05_016.jpg"/></div><p>Make sure there are no conflicts, and let the job finish.</p></li><li class="listitem">You can go to <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Job</strong></span><span class="strong"><strong>Manager</strong></span> | <span class="strong"><strong>History</strong></span> | <span class="strong"><strong>Instant</strong></span><span class="strong"><strong>Collection</strong></span> | <span class="strong"><strong>Past 24 Hours</strong></span> and check for the job status. It should be successful. You can look at more details by clicking on <span class="strong"><strong>View Details</strong></span>:<div class="mediaobject"><img alt="Collecting software provisioning package manager data" src="graphics/image_05_017.jpg"/></div></li><li class="listitem">Once the data has been collected, the details can be viewed by going to <span class="strong"><strong>Console | </strong></span><span class="strong"><strong>Operating </strong></span><span class="strong"><strong>System | </strong></span><span class="strong"><strong>Windows | </strong></span><span class="strong"><strong>Software </strong></span><span class="strong"><strong>Provisioning | </strong></span><span class="strong"><strong>Package </strong></span><span class="strong"><strong>Manager</strong></span>:<div class="mediaobject"><img alt="Collecting software provisioning package manager data" src="graphics/image_05_018.jpg"/></div></li></ol></div></div><div class="section" title="Collecting software repository data"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec54"/>Collecting software repository data</h3></div></div></div><p>Collect the repository data to identify which software packages are in which repositories. From the collected information, you can determine which repositories to assign to machines based on the available packages.</p><p>We need to run this against the machines that have software repositories created.</p><p>The process is similar to the previous step, but with two differences:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We run this against all the repository servers</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Data Types</strong></span> value is changed to <span class="strong"><strong>Software Provisioning - Repositories</strong></span></li></ul></div><div class="mediaobject"><img alt="Collecting software repository data" src="graphics/image_05_019.jpg"/></div><p>You can go to 
<span class="strong"><strong>Administration | </strong></span>
<span class="strong"><strong>Job Manager | </strong></span>
<span class="strong"><strong>History | </strong></span>
<span class="strong"><strong>Instant </strong></span>
<span class="strong"><strong>Collection | </strong></span>
<span class="strong"><strong>Past </strong></span>
<span class="strong"><strong>24 </strong></span>
<span class="strong"><strong>Hours </strong></span>
and check the status of the job. It should be successful:</p><div class="mediaobject"><img alt="Collecting software repository data" src="graphics/image_05_020.jpg"/></div><p>This is how it looks under 
<span class="strong"><strong>Console | Operating System | Windows |Software Provisioning | Package Manager | Repositories.</strong></span></p><div class="mediaobject"><img alt="Collecting software repository data" src="graphics/image_05_021.jpg"/></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec149"/>How it works...</h2></div></div></div><p>In this two-step process, we are collecting data both from the managed machines and software repositories. In the first step, we collect details from all the managed machines to obtain the data about packages and package manager in VCM.</p><p>In the second step, we collect the repository data to identify which software packages are in which repositories. This information comes in handy when we need to assign repositories to machines based on the availability of packages.</p></div></div>
<div class="section" title="Adding repository sources to package manager"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec55"/>Adding repository sources to package manager</h1></div></div></div><p>Repository sources are the locations from where package manager will be able to download and install packages. We need to manually define those locations in the package manager (managed machines), and we can define more than one. Then, VCM package manager will follow its process to download the packages.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec150"/>Getting ready</h2></div></div></div><p>We need the repository published to VCM, by following the <span class="emphasis"><em>Adding a repository to VCM</em></span> recipe, and package manager data collected, in order to assign repositories to it.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec151"/>How to do it...</h2></div></div></div><p>Adding a source gives the package manager instance on the selected machines access to the packages available in a specified section. The sources are numbered by priority. When you add a new one, you can specify whether to add it to the beginning or to the end of the list. You can also remove sources.</p><p>By following these steps, we can add sources to package manager:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log on to VCM Server with administrative privileges and go to <span class="strong"><strong>Console</strong></span> |
 <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Operating </strong></span><span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Software </strong></span><span class="strong"><strong>Provisioning</strong></span> | <span class="strong"><strong>Package </strong></span><span class="strong"><strong>Managers</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Add Source</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_022.jpg"/></div><p>This will launch a wizard.</p></li><li class="listitem">On the <span class="strong"><strong>Select Machines</strong></span> page, verify that the machines displayed in the lower pane are the machines to which you want to add the source, and click on Next.</li><li class="listitem">On the <span class="strong"><strong>Browse Source</strong></span> page, select <span class="strong"><strong>VCM Managed Repositories</strong></span>, select the repository, and click on <span class="strong"><strong>OK</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_023.jpg"/></div><p>If there are multiple repositories, either select <span class="strong"><strong>Add source at the beginning of existing source lists</strong></span> or <span class="strong"><strong>Add source at the end of the existing source lists</strong></span>, depending on the proximity between package manager and the repository.</p></li><li class="listitem">Verify that the platform name and the section name are exactly the same as those used in the repository when publishing the package:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_024.jpg"/></div></li><li class="listitem">On the <span class="strong"><strong>Schedule </strong></span>page, select one of the scheduling options and configure it as needed.</li><li class="listitem">On the <span class="strong"><strong>Confirmation </strong></span>page, review the information and click on <span class="strong"><strong>Finish</strong></span>.</li><li class="listitem">The added source is displayed in the <span class="strong"><strong>Package Managers – Sources</strong></span> data grid.<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_025.jpg"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec152"/>How it works...</h2></div></div></div><p>Instead of depending on the location from where package manager downloads published packages, we simply assign the repositories and decide the order of the locations from which they can be fetched.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec153"/>There's more...</h2></div></div></div><p>Once a repository has been added to package manager, the only thing left is to install the package.</p></div></div>
<div class="section" title="Deploying a package"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec56"/>Deploying a package</h1></div></div></div><p>Finally, we are ready to deploy the package–in other words, we are ready to provision the software.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec154"/>Getting ready</h2></div></div></div><p>We need to complete all the previous recipes in this chapter in order to work on this recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec155"/>How to do it...</h2></div></div></div><p>To provision the software on managed machines, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log on to VCM Server with administrative privileges and go to <span class="strong"><strong>Console</strong></span> | <span class="strong"><strong>Windows </strong></span>| <span class="strong"><strong>Operating System</strong></span> | <span class="strong"><strong>Software Provisioning</strong></span> | <span class="strong"><strong>Package Managers</strong></span> | <span class="strong"><strong>Packages</strong></span>.</li><li class="listitem">Select the package you want to install and click on <span class="strong"><strong>Install Package</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_026.jpg"/></div></li><li class="listitem">Follow the wizard and add more machines on which you want to install the selected package (winrar in our case) if required, or click on <span class="strong"><strong>Next</strong></span>:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_027.jpg"/></div></li><li class="listitem">As we have not signed the package, accept the warning and allow the unsigned package:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_028.jpg"/></div></li><li class="listitem">Schedule the action or select <span class="strong"><strong>Run Action Now</strong></span>.</li><li class="listitem">Accept the confirmation, and you are good to go:<div class="mediaobject"><img alt="How to do it..." src="graphics/image_05_029.jpg"/></div></li></ol></div><p>This will start the package installation process immediately if you selected <span class="strong"><strong>Run Action Now</strong></span> or at a later time if you set a schedule.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec156"/>How it works...</h2></div></div></div><p>If you have followed everything, then you will have understood the relationship between various VCM components for software provisioning, created and published a software repository, created and published a software package, and added the repository source to package manager.</p><p>Let's look at the final step of installing a package.</p><p>The <code class="literal">.crate</code> file is copied to <code class="literal">C:\Program Files (x86)\VMware\VCM\Tools\Cratecache</code> on the managed machine:</p><div class="mediaobject"><img alt="How it works..." src="graphics/image_05_030.jpg"/></div><p>From here, package manager unzips the <code class="literal">.crate</code> file and uses the installation command and the arguments provided while creating the package to install the application.</p><p>The application can be seen installed in <span class="strong"><strong>Programs and Features</strong></span>:</p><div class="mediaobject"><img alt="How it works..." src="graphics/image_05_031.jpg"/></div><p>This concludes our exploration of software provisioning using VCM.</p></div></div></body></html>