- en: Chapter 2. Networking
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第2章。网络
- en: 'This chapter contains the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包含以下示例：
- en: Setting a static IP address
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置静态 IP 地址
- en: Binding multiple addresses to a single Ethernet device
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将多个地址绑定到单个以太网设备
- en: Bonding two Ethernet devices
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绑定两个以太网设备
- en: Configuring the network firewall with FirewallD
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 FirewallD 配置网络防火墙
- en: Configuring the network firewall using iptables
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 iptables 配置网络防火墙
- en: Installing a DHCP server
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 DHCP 服务器
- en: Configuring an NFS server to share a filesystem
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 NFS 服务器以共享文件系统
- en: Configuring an NFS client to use a shared filesystem
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 NFS 客户端以使用共享文件系统
- en: Serving Windows shares with Samba
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Samba 服务 Windows 共享
- en: Introduction
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: The recipes in this chapter cover various networking tasks that should prove
    useful to you as a CentOS administrator. You'll learn how to configure a static
    IP address, bind multiple addresses to a single Ethernet device, and bond two
    devices together. You'll also see how to configure the system's firewall using
    FirewallD and iptables, and how to set up a DHCP server to distribute IP addresses,
    which allows other computers using dynamic networking configurations to access
    the network. The remaining recipes will teach you how to set up centralized file
    storage using NFS and Samba.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的示例涵盖各种网络任务，这些任务对 CentOS 管理员应该很有用。您将学习如何配置静态 IP 地址，将多个地址绑定到单个以太网设备，并将两个设备绑定在一起。您还将了解如何使用
    FirewallD 和 iptables 配置系统防火墙，以及如何设置 DHCP 服务器以分发 IP 地址，从而允许使用动态网络配置的其他计算机访问网络。其余示例将教您如何使用
    NFS 和 Samba 设置集中式文件存储。
- en: Setting a static IP address
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置静态 IP 地址
- en: This recipe shows you how to configure a static IP address. Unless you configured
    a static address during installation, CentOS uses the Dynamic Host Configuration
    Protocol (DHCP) to obtain an IP address to communicate across the network. Using
    a dynamically assigned address is fine for most desktop and laptop systems, but
    those that host e-mail servers, file sharing and print services, and web servers
    should have an address that doesn't change. The static address provides a stable,
    known location on the network where users can access a system's services.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 此示例向您展示如何配置静态 IP 地址。除非在安装过程中配置了静态地址，否则 CentOS 使用动态主机配置协议（DHCP）获取 IP 地址以跨网络进行通信。对于大多数桌面和笔记本系统来说，使用动态分配的地址是可以接受的，但是那些托管电子邮件服务器、文件共享和打印服务以及
    Web 服务器的系统应具有不变的地址。静态地址为用户提供了网络上的稳定、已知位置，用户可以访问系统的服务。
- en: Getting ready
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection and administrative
    privileges provided by logging in with the `root` account. It assumes that your
    primary Ethernet device is named `enp0s3` and is currently configured with DHCP.
    If your device is named differently, substitute its name appropriately in the
    following commands.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 此示例要求 CentOS 系统具有正常的网络连接，并通过使用 `root` 帐户登录来提供管理员权限。假设您的主要以太网设备命名为 `enp0s3` 并且当前配置为
    DHCP。如果您的设备名称不同，请在以下命令中适当替换其名称。
- en: How to do it...
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'Follow these steps to configure a static IP address:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤配置静态 IP 地址：
- en: 'Open the Ethernet device''s configuration file, found under `/etc/ sysconfig/network-scripts`,with
    your text editor:'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用文本编辑器打开以太网设备的配置文件，位于 `/etc/ sysconfig/network-scripts` 下：
- en: '[PRE0]'
  id: totrans-20
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Change the value of `BOOTPROTO` to none:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `BOOTPROTO` 的值更改为 none：
- en: '[PRE1]'
  id: totrans-22
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'At the end of the file, add the `IPADDR`, `NETMASK`, and `BROADCAST` entries
    to set the desired IP address. Assign them values that properly reflect your network:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文件末尾添加 `IPADDR`、`NETMASK` 和 `BROADCAST` 条目以设置所需的 IP 地址。分配适当反映您网络的值：
- en: '[PRE2]'
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![How to do it...](img/image_02_001.jpg)'
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何做…](img/image_02_001.jpg)'
- en: The interface is configured with a static IP address
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 接口配置为静态 IP 地址
- en: Save your changes and close the file.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存更改并关闭文件。
- en: 'Open the `/etc/sysconfig/network` file using your editor:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用文本编辑器打开 `/etc/sysconfig/network` 文件：
- en: '[PRE3]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Add a `GATEWAY` entry to identify your network''s gateway:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加 `GATEWAY` 条目以标识您网络的网关：
- en: '[PRE4]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Save your changes and close the file.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存更改并关闭文件。
- en: 'Restart the networking service for the configuration changes to take effect:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新启动网络服务以使配置更改生效：
- en: '[PRE5]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: How it works...
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: In this recipe, you learned how to assign a static IP address to an Ethernet
    device. It assumed the name of your primary Ethernet device to be `enp0s3`, thus
    `ifcfg-enp0s3` would be the name of the device's configuration file. If your device
    is named differently (for example, `eth0`, `eno1677`, and so on) then you need
    to adjust the recipe's directions accordingly.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，你学习了如何为以太网设备分配静态IP地址。假设你主要的以太网设备名称为`enp0s3`，因此设备的配置文件名称为`ifcfg-enp0s3`。如果你的设备名称不同（例如，`eth0`、`eno1677`等），则需要相应调整教程中的指示。
- en: First, we changed the value for `BOOTPROTO` from `dhcp`, the protocol used to
    obtain an IP address dynamically, to `none` since we are setting the address ourselves.
    Then we added the `IPADDR`, `NETMASK`, and `BROADCAST` entries to provide the
    details of the static IP address. Next, we specified the network's default gateway
    using `GATEWAY` in `/etc/ sysconfig/network`. This allows us to route traffic
    beyond the local subnetwork.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将`BOOTPROTO`的值从`dhcp`（用于动态获取IP地址的协议）更改为`none`，因为我们是手动设置地址。然后我们添加了`IPADDR`、`NETMASK`和`BROADCAST`条目，以提供静态IP地址的详细信息。接下来，我们通过`GATEWAY`在`/etc/sysconfig/network`中指定了网络的默认网关。这使得我们能够将流量路由到本地子网之外。
- en: 'After you restart the networking service, you can confirm the new address using
    the `ip` command. `ip addr show` will display information about the current state
    of your system''s network devices:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 重启网络服务后，你可以使用`ip`命令确认新的地址。`ip addr show`将显示当前系统网络设备的状态信息：
- en: '![How it works...](img/image_02_002.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![它是如何工作的...](img/image_02_002.jpg)'
- en: ip addr show displays your system's networking information
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '`ip addr show`命令显示系统的网络信息。'
- en: See also
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: For more information on configuring network settings in CentOS, refer to the
    *Configure IP Networking* chapter in the RHEL 7 Networking Guide ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_IP_Networking.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_IP_Networking.html)).
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于在CentOS中配置网络设置的信息，请参考RHEL 7网络指南中的*配置IP网络*章节 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_IP_Networking.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_IP_Networking.html))。
- en: Binding multiple addresses to a single Ethernet device
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将多个地址绑定到单一以太网设备
- en: This recipe shows you how to bind multiple IP addresses to a single Ethernet
    device. The ability to assign more than one address to the same device can be
    useful-the most obvious benefit is that you don't need to procure multiple Ethernet
    cards. The cost of hardware has dropped substantially, but IT budgets still run
    tight. Perhaps a less obvious benefit, but one more valuable, is the greater flexibility
    it gives when configuring network services. Different services, such as e-mail
    and websites, can run on the same system but be accessed using different addresses.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程展示了如何将多个IP地址绑定到单个以太网设备。将多个地址分配给同一设备的能力非常有用——最明显的好处是你无需购买多个以太网卡。虽然硬件成本已经大幅下降，但IT预算依然紧张。也许一个不那么显而易见，但更有价值的好处是，它在配置网络服务时提供了更大的灵活性。不同的服务，例如电子邮件和网站，可以在同一系统上运行，但可以使用不同的地址进行访问。
- en: Getting ready
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection. It assumes
    that your primary Ethernet device is `enp0s3` and is configured with a static
    IP address. You'll also need administrative privileges provided by logging in
    with the `root` account.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程需要一个有工作网络连接的CentOS系统。假设你的主要以太网设备为`enp0s3`并配置了静态IP地址。你还需要通过以`root`账户登录来获得管理员权限。
- en: How to do it...
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to bind multiple addresses to the same Ethernet device:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤将多个地址绑定到同一以太网设备：
- en: 'Make a copy of the device''s configuration file:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制设备的配置文件：
- en: '[PRE6]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Open the new file with your text editor:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用文本编辑器打开新文件：
- en: '[PRE7]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Delete the `UUID` entry entirely. If a `HWADDR` entry exists, delete that also.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完全删除`UUID`条目。如果存在`HWADDR`条目，也删除它。
- en: 'Update the `NAME` and `DEVICE` values:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更新`NAME`和`DEVICE`的值：
- en: '[PRE8]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Change the value of `IPADDR` to the IP address you wish to use:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`IPADDR`的值更改为你希望使用的IP地址：
- en: '[PRE9]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Save your changes and close the file.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存更改并关闭文件。
- en: 'Restart the networking service for the configuration changes to take effect:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启网络服务以使配置更改生效：
- en: '[PRE10]'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: How it works...
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In this recipe, you learned how to assign multiple IP addresses to the same
    Ethernet device. We made a copy of one of the original network configuration files,
    taking care to name it appropriately to create a virtual adapter, and edited its
    configuration details. Since the name of the first device's configuration is `ifcfg-enp0s3`,
    the new file is named `ifcfg-enp0s3:1` to create the first virtual adapter associated
    with that device. If you want to add more adapters (assign more IP addresses),
    repeat the steps using incrementing numbers, for example, `enp0s3:2`, `enp0s3:3`,
    and so on.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，您学会了如何为同一以太网设备分配多个 IP 地址。我们复制了其中一个原始网络配置文件，并且小心地命名它，以便创建一个虚拟适配器，并编辑其配置细节。由于第一个设备的配置文件名为`ifcfg-enp0s3`，因此新文件命名为`ifcfg-enp0s3:1`，用以创建与该设备相关联的第一个虚拟适配器。如果您想添加更多适配器（分配更多
    IP 地址），请按照步骤递增命名，例如`enp0s3:2`、`enp0s3:3`等。
- en: 'In the configuration file, we removed the `HWADDR` and `UUID` entries since
    they are not needed for a virtual adapter. Then we updated the `DEVICE` and `NAME`
    entries to give the adapter its own identify, and, of course, we updated the `IPADDR`
    entry to assign its IP address:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置文件中，我们移除了`HWADDR`和`UUID`条目，因为虚拟适配器不需要这些条目。然后，我们更新了`DEVICE`和`NAME`条目，以便给适配器分配一个唯一的标识，当然，我们还更新了`IPADDR`条目来分配其
    IP 地址：
- en: '![How it works...](img/image_02_003.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![它是如何工作的...](img/image_02_003.jpg)'
- en: Multiple IP addresses are bound to an Ethernet device via a virtual adapter
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 多个 IP 地址通过虚拟适配器绑定到一个以太网设备
- en: See also
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Refer to the following resources for more information on binding multiple addresses
    to the same Ethernet device:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下资源以获取更多关于将多个地址绑定到同一以太网设备的信息：
- en: Create Multiple IP Addresses to One Single Network Interface ([http://www.tecmint.com/create-multiple-ip-addresses-to-one-single-network-interface](http://www.tecmint.com/create-multiple-ip-addresses-to-one-single-network-interface))
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为单个网络接口创建多个 IP 地址 ([http://www.tecmint.com/create-multiple-ip-addresses-to-one-single-network-interface](http://www.tecmint.com/create-multiple-ip-addresses-to-one-single-network-interface))
- en: Assign Multiple IP Addresses To Single Network Interface Card On CentOS 7 ([http://www.unixmen.com/linux-basics-assign-multiple-ip-addresses-single-network-interface-card-centos-7](http://www.unixmen.com/linux-basics-assign-multiple-ip-addresses-single-network-interface-card-centos-7))
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将多个 IP 地址分配给 CentOS 7 上的单个网络接口卡 ([http://www.unixmen.com/linux-basics-assign-multiple-ip-addresses-single-network-interface-card-centos-7](http://www.unixmen.com/linux-basics-assign-multiple-ip-addresses-single-network-interface-card-centos-7))
- en: Adding Secondary IP Addresses ([https://dbiers.me/adding-secondary-ip-addresses-centosrhel/](https://dbiers.me/adding-secondary-ip-addresses-centosrhel/))
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加次要 IP 地址 ([https://dbiers.me/adding-secondary-ip-addresses-centosrhel/](https://dbiers.me/adding-secondary-ip-addresses-centosrhel/))
- en: Bonding two Ethernet devices
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 绑定两个以太网设备
- en: In this recipe, you'll learn how to combine multiple Ethernet devices as a single
    network device in a configuration known as channel bonding. Channel bonding allows
    us to bind multiple devices together so that they appear as a single interface
    to servers running on the CentOS system. Its purpose is to improve your system's
    overall network performance and provide redundancy if one of the network devices
    fails.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，您将学习如何将多个以太网设备组合为一个网络设备，这种配置被称为通道绑定。通道绑定允许我们将多个设备绑定在一起，使它们在 CentOS 系统上运行的服务器中表现为一个单一的接口。其目的是提升系统的整体网络性能，并在其中一个网络设备发生故障时提供冗余。
- en: Getting ready
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with at least two Ethernet devices. It
    assumes that your primary Ethernet device is `enp0s3`. If your device is named
    differently, substitute the name appropriately in the recipe's commands. You'll
    also need administrative privileges provided by logging in with the `root` account.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程要求使用至少有两个以太网设备的 CentOS 系统。假设您的主以太网设备是`enp0s3`。如果您的设备名称不同，请在命令中适当替换设备名称。您还需要通过以`root`账户登录来获得管理员权限。
- en: How to do it...
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to bond two Ethernet devices:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤将两个以太网设备绑定在一起：
- en: 'Install the `bind-utils` and `ethtool` packages:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装`bind-utils`和`ethtool`包：
- en: '[PRE11]'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Create a new configuration file for the bonded interface:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为绑定接口创建一个新的配置文件：
- en: '[PRE12]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Add the following lines to the file, substituting values for `IPADDR`, `NETMASK`,
    and `BROADCAST` that are appropriate for your network:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向文件中添加以下行，替换适合您网络的`IPADDR`、`NETMASK`和`BROADCAST`值：
- en: '[PRE13]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Save your changes and close the configuration file.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存您的更改并关闭配置文件。
- en: 'Open the configuration file of the first device you wish to bond:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开您希望绑定的第一个设备的配置文件：
- en: '[PRE14]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Make sure `BOOTPROTO` is set to `none` and `ONBOOT` is set to `yes`. Then remove
    the `IPADDR`, `NETMASK`, and `BROADCAST` entries if they exist.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保`BOOTPROTO`设置为`none`，`ONBOOT`设置为`yes`。然后，如果存在，删除`IPADDR`、`NETMASK`和`BROADCAST`条目。
- en: 'Add the `SLAVE` and `MASTER` entries at the end of the file:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文件末尾添加`SLAVE`和`MASTER`条目：
- en: '[PRE15]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Save your changes and close the configuration file.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存更改并关闭配置文件。
- en: Repeat steps 5-8 for each additional device you want to bond.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对每个额外要绑定的设备，重复步骤5-8。
- en: 'Create the configuration file used by the kernel to control how the bonding
    interface should behave:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建配置文件，用于让内核控制绑定接口的行为：
- en: '[PRE16]'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Add the following lines to the file:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下行添加到文件中：
- en: '[PRE17]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Save your changes and close the file.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存更改并关闭文件。
- en: 'Register the bonding module with the system''s kernel:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用系统内核注册绑定模块：
- en: '[PRE18]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Restart networking services for the changes to take effect:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新启动网络服务以使更改生效：
- en: '[PRE19]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: How it works...
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'We began by creating a configuration file for the bonding interface at `/etc/sysconfig/
    network-scripts/ifcfg-bond0`. `BOOTPROTO` was set to `none` because the IP address
    is set statically, `DEVICE` gives a name to the interface, `USERCTL` was set to
    `no` to prohibit nonadministrative users from bringing the interface up and down,
    and `ONBOOT` was set to `yes` so that the interface will be automatically activated.
    We also gave the IP address information with `IPADDR`, `NETMASK`, and `BROADCAST`:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先在`/etc/sysconfig/network-scripts/ifcfg-bond0`创建了一个绑定接口的配置文件。`BOOTPROTO`设置为`none`，因为
    IP 地址是静态设置的，`DEVICE`为接口命名，`USERCTL`设置为`no`，禁止非管理员用户启动和关闭该接口，`ONBOOT`设置为`yes`，使得接口在启动时自动激活。我们还使用`IPADDR`、`NETMASK`和`BROADCAST`提供了
    IP 地址信息：
- en: '[PRE20]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Then we updated the configuration files for each device we want to bond. We
    made sure `BOOTPROTO` was set to `none` and there was no address information since
    the device will no longer need its own IP address. Adding the `SLAVE` and `MASTER`
    entries, we identified the device as being bound to the new `bond0` device:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们更新了每个我们想要绑定的设备的配置文件。我们确保`BOOTPROTO`设置为`none`，并且没有地址信息，因为该设备不再需要自己的 IP 地址。通过添加`SLAVE`和`MASTER`条目，我们将设备标识为绑定到新的`bond0`设备：
- en: '[PRE21]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: By performing these steps, we have created a new virtual device known as the
    bonding master that will use our real Ethernet devices as slaves. If one slave
    device fails, the other slave will still be active, providing redundancy.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行这些步骤，我们创建了一个新的虚拟设备，称为绑定主设备，该设备将使用我们的实际以太网设备作为从设备。如果一个从设备失败，另一个从设备仍然处于活动状态，从而提供冗余。
- en: 'Next, we created a new configuration file with our preferences for the kernel
    bonding module. The module is the kernel implementation of the bonding device
    and is responsible for coordinating the physical devices:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们创建了一个新的配置文件，包含我们对内核绑定模块的偏好。该模块是绑定设备的内核实现，负责协调物理设备：
- en: '[PRE22]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '`miimon=100` specifies that MII link monitoring will occur every `100` milliseconds
    to verify that the physical devices are active. `mode=5` represents a basic configuration
    that doesn''t require any specific type of network switch support. It allows outgoing
    traffic to be distributed according to the current load on each slave device.
    There are five other modes which give you plenty of options in configuring how
    the devices work together, although you should be aware that some modes may require
    specific hardware support. Refer to [http://wiki.centos.org/TipsAndTricks/BondingInterfaces](http://wiki.centos.org/TipsAndTricks/BondingInterfaces)
    for more information.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '`miimon=100`指定每`100`毫秒进行MII链路监控，以验证物理设备是否处于活动状态。`mode=5`表示一种基本配置，不需要任何特定类型的网络交换机支持。它允许根据每个从设备的当前负载分配外发流量。还有五种其他模式，提供了丰富的选项来配置设备如何协同工作，尽管需要注意的是某些模式可能需要特定硬件支持。更多信息请参考[http://wiki.centos.org/TipsAndTricks/BondingInterfaces](http://wiki.centos.org/TipsAndTricks/BondingInterfaces)。'
- en: 'After making changes to the device''s configuration files, we registered the
    bonding kernel module using `modprobe`:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 修改设备的配置文件后，我们使用`modprobe`注册了绑定内核模块：
- en: '[PRE23]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![How it works...](img/image_02_004.jpg)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![它是如何工作的...](img/image_02_004.jpg)'
- en: Two Ethernet devices are bound with the same IP addresses through the bonding
    adapter
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 通过绑定适配器将两个以太网设备绑定到相同的 IP 地址
- en: See also
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: For more information on bonding Ethernet devices CentOS, refer to the *Configure
    Network Bonding* chapter in the RHEL 7 Networking Guide ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_Network_Bonding.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_Network_Bonding.html)).
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 有关在CentOS中绑定以太网设备的更多信息，请参考RHEL 7《网络配置指南》中的*配置网络绑定*章节([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_Network_Bonding.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Configure_Network_Bonding.html))。
- en: Configuring the network firewall with FirewallD
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用FirewallD配置网络防火墙
- en: Now you'll learn how to configure the networking firewall using FirewallD. Starting
    with CentOS 7, FirewallD replaces iptables as the default firewall configuration
    utility (although iptables is still used behind the scenes by FirewallD). Based
    on which zones and services you configure, you can increase the network security
    of your server by controlling what traffic is allowed or disallowed to and from
    the system.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你将学习如何使用FirewallD配置网络防火墙。从CentOS 7开始，FirewallD取代iptables作为默认的防火墙配置工具（尽管iptables仍在FirewallD背后使用）。根据你配置的区域和服务，你可以通过控制允许或禁止进出系统的流量，来增强服务器的网络安全性。
- en: Getting ready
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection. You'll
    also need administrative privileges provided by logging in with the `root` account.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程需要一个具有有效网络连接的CentOS系统。你还需要通过使用`root`账户登录获得的管理员权限。
- en: How to do it...
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 怎么做...
- en: 'This collection of commands will show you how to perform several basic configuration
    tasks using FirewallD''s command-line client, `firewall-cmd`:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令集将向你展示如何使用FirewallD的命令行客户端`firewall-cmd`执行几项基本配置任务：
- en: 'To identify the currently active zones and which Ethernet devices are assigned
    to them, use the `--get-active-zones` flag:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要识别当前活动的区域及其分配的以太网设备，请使用`--get-active-zones`标志：
- en: '[PRE24]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'To temporarily change which zone a device is assigned to, use the `--zone`
    argument to specify the target zone and `--change-interface` to specify the Ethernet
    device:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要临时更改设备分配到的区域，请使用`--zone`参数指定目标区域，并使用`--change-interface`指定以太网设备：
- en: '[PRE25]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'To permanently assign a device to a zone, add a `ZONE` entry to the device''s
    configuration file. This change will not take effect until the service has been
    restarted:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要永久将设备分配到某个区域，请将`ZONE`条目添加到设备的配置文件中。此更改在服务重启之前不会生效：
- en: '[PRE26]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'To identify the current configuration for a zone, use the `--zone` argument
    to specify the target zone and include `--list-all`:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要识别某个区域的当前配置，请使用`--zone`参数指定目标区域，并加上`--list-all`：
- en: '[PRE27]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'To allow traffic through the firewall, use the `--add-service` or `--add-port`
    arguments:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要允许流量通过防火墙，请使用`--add-service`或`--add-port`参数：
- en: 'Traffic for common services and protocols such as HTTP and SMTP can be allowed
    by name. The following adds the `http` service which opens port `80` (the port
    used by Apache and other HTTP servers):'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 可以通过名称允许常见服务和协议的流量，如HTTP和SMTP。以下命令添加了`http`服务，它会打开端口`80`（该端口由Apache和其他HTTP服务器使用）：
- en: '[PRE28]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Traffic can always be allowed directly given the port and network protocol.
    The following opens port 8080 to TCP traffic, another port commonly used to serve
    web content:'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 流量总是可以根据端口和网络协议直接允许。以下命令打开端口8080以允许TCP流量，这是另一个常用于提供网页内容的端口：
- en: '[PRE29]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'To disallow traffic that is currently allowed through the firewall, use the
    `--remove-service` or `--remove-port` arguments:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要禁止当前允许通过防火墙的流量，请使用`--remove-service`或`--remove-port`参数：
- en: '[PRE30]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'To reload the firewall after making a change, use `--reload  `:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在更改后重新加载防火墙，请使用`--reload`：
- en: '[PRE31]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: How it works...
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The default installation of FirewallD makes several preconfigured zones available,
    for example, `public`, `dmz`, `work`, `home`, and `trusted`. Different interfaces
    can be assigned to different zones and have different rules applied. To see all
    of the available zones and their configuration, we can invoke `firewall-cmd` with
    the `--list-all-zones` flag:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: FirewallD的默认安装提供了几个预配置的区域，例如`public`、`dmz`、`work`、`home`和`trusted`。不同的接口可以分配到不同的区域，并应用不同的规则。要查看所有可用区域及其配置，可以使用`firewall-cmd`加上`--list-all-zones`标志：
- en: '[PRE32]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Most updates made to the firewall rules will take effect immediately but are
    temporary. We saw this earlier when we had to update the device''s configuration
    file and restart the service to make a zone change permanent. This lets us experiment
    with different settings before finalizing the configuration. When configuring
    services and ports, the `--permanent` flag is used to make the changes permanent.
    If you don''t provide the flag, the changes will take effect immediately but will
    only be temporary (not persist across a system reboot or restart of the firewall
    service):'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数对防火墙规则的更新会立即生效，但它们是临时的。我们之前看到过，当我们需要更新设备的配置文件并重启服务以使区域更改生效时，设置的更改是临时的。这使得我们可以在最终确定配置之前对不同的设置进行实验。当配置服务和端口时，使用`--permanent`标志使更改永久生效。如果未提供该标志，更改将立即生效，但仅是临时性的（在系统重启或防火墙服务重启时不会保留）：
- en: '[PRE33]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Named services are preconfigured port settings that are common to a specific
    network service and are available for our convenience. For example, SSH traffic
    commonly consists of TCP packets destined for port 22, so the `ssh` service reflects
    this. In the examples, we used the `http` service, which configured port 80, the
    standard port used to serve web pages. While assigning the port directly has the
    same effect, services provide convenient, human-readable names and should be used
    when possible. To get a list of all available services, use `--get-services`:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 命名服务是预配置的端口设置，通常用于特定的网络服务，并且为了方便使用而提供。例如，SSH流量通常由面向端口22的TCP数据包组成，因此`ssh`服务反映了这一点。在示例中，我们使用了`http`服务，它配置了端口80，这是用于提供网页的标准端口。虽然直接分配端口也能达到相同效果，但服务提供了便于人类阅读的名称，应该在可能的情况下使用。要获取所有可用服务的列表，可以使用`--get-services`：
- en: '[PRE34]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '![How it works...](img/image_02_005.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![工作原理...](img/image_02_005.jpg)'
- en: firewall-cmd is a command-line client for configuring firewall rules
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: firewall-cmd是一个命令行客户端，用于配置防火墙规则
- en: Note
  id: totrans-147
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Named services are defined as XML files under `/usr/lib/firewalld/services`.
    If you want to allow access for some traffic but a service isn't defined, and
    you would prefer to perform the configuration using a service instead of the port
    and protocol for the sake of readability, you can create a new service file in
    this directory. Copy an existing file as your starting point and modify it to
    suit your needs.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 命名服务被定义为`/usr/lib/firewalld/services`目录下的XML文件。如果你想允许某些流量访问，但没有定义相应的服务，并且为了可读性你希望使用服务而不是端口和协议进行配置，你可以在该目录中创建一个新的服务文件。可以复制一个现有文件作为起点，并根据需要进行修改。
- en: See also
  id: totrans-149
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: 'For more information on working with FirewallD, refer to the following resources:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 有关使用FirewallD的更多信息，请参阅以下资源：
- en: 'RHEL 7 Migration Planning Guide: Security and Access Control ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_%20Linux/7/html/Migration_Planning_Guide/sect-Red_Hat_Enterprise_%20Linux-Migration_Planning_Guide-Security_and_Access_%20Control.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_%20Linux/7/html/Migration_Planning_Guide/sect-Red_Hat_Enterprise_%20Linux-Migration_Planning_Guide-Security_and_Access_%20Control.html))'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7迁移规划指南：安全性和访问控制 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_%20Linux/7/html/Migration_Planning_Guide/sect-Red_Hat_Enterprise_%20Linux-Migration_Planning_Guide-Security_and_Access_%20Control.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_%20Linux/7/html/Migration_Planning_Guide/sect-Red_Hat_Enterprise_%20Linux-Migration_Planning_Guide-Security_and_Access_%20Control.html))
- en: FirewallD ([http://fedoraproject.org/wiki/FirewallD](http://fedoraproject.org/wiki/FirewallD))
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FirewallD ([http://fedoraproject.org/wiki/FirewallD](http://fedoraproject.org/wiki/FirewallD))
- en: How To Set Up a Firewall Using FirewallD on CentOS 7 ([https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7))
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何在CentOS 7上使用FirewallD设置防火墙 ([https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7))
- en: Configuring the network firewall using iptables
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用iptables配置网络防火墙
- en: In this recipe, you'll learn how to replace FirewallD with the iptables service
    and perform basic firewall configurations. iptables was the default method for
    managing the firewall's settings in CentOS prior to version 7\. Some administrators
    might prefer iptables because it's within their comfort level or maybe they have
    several older servers running in the data center and they want to maintain similarity
    as much as possible.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，你将学习如何用 iptables 服务替代 FirewallD 并执行基本的防火墙配置。iptables 是 CentOS 7 版本之前管理防火墙设置的默认方法。一些管理员可能偏爱
    iptables，因为它更符合他们的使用习惯，或者他们可能在数据中心有多台旧服务器，并希望尽可能保持一致性。
- en: Getting ready
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection. You'll
    also need administrative privileges provided by logging in with the `root` account.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程要求系统为 CentOS，并且需要有效的网络连接。你还需要通过以 `root` 账户登录来获取管理员权限。
- en: How to do it...
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following steps will allow you to replace FirewallD with the iptables service:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助你用 iptables 服务替换 FirewallD：
- en: 'Stop the FirewallD service and disable it:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 停止并禁用 FirewallD 服务：
- en: '[PRE35]'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Install the `iptables-services` package which contains the service:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装包含该服务的 `iptables-services` 包：
- en: '[PRE36]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Start the service and register it so that it will start automatically when
    the system is booted:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动服务并注册，使其在系统启动时自动启动：
- en: '[PRE37]'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The following collection of commands will show you how to perform several basic
    configuration tasks using `iptables`:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令集合将展示如何使用 `iptables` 执行几个基本配置任务：
- en: 'Use the `-L` flag to print the current configuration. Add the `--line-numbers`
    flag to display each rule''s ID number alongside it:'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `-L` 标志打印当前配置。添加 `--line-numbers` 标志来显示每条规则的 ID 编号：
- en: '[PRE38]'
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Use the following command to allow TCP traffic on port 80 from the `enp0s3`
    interface through the firewall:'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用以下命令允许来自 `enp0s3` 接口的 TCP 流量通过防火墙进入 80 端口：
- en: '[PRE39]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'To remove the rule that allows TCP traffic on port 80, execute `iptables -L
    --line-numbers` to find the rule''s ID and then use the following (replace `##`
    with the rule''s ID):'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要删除允许 TCP 流量通过 80 端口的规则，请执行 `iptables -L --line-numbers` 查找规则的 ID，然后使用以下命令（将
    `##` 替换为规则的 ID）：
- en: '[PRE40]'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Reload iptables after making configuration changes for them to be in effect:'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在配置更改后重新加载 iptables，使其生效：
- en: '[PRE41]'
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: How it works...
  id: totrans-175
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'To replace FirewallD with the iptables service to manage the network firewall,
    we first stopped and disabled the FirewallD service; we don''t want multiple firewall
    daemons running since it would lead to conflicts. FirewallD uses iptables behind
    the scenes so iptables is already installed, but the iptables service isn''t.
    So, next we installed the `iptables-services` package:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 为了用 iptables 服务替代 FirewallD 来管理网络防火墙，我们首先停止并禁用了 FirewallD 服务；我们不希望运行多个防火墙守护进程，因为这会导致冲突。FirewallD
    在后台使用 iptables，因此 iptables 已经安装，但 iptables 服务没有安装。所以，接下来我们安装了 `iptables-services`
    包：
- en: '[PRE42]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'We then saw how to perform basic configurations to allow and disallow traffic.
    For example, the recipe presented the command to add a rule that allows TCP traffic
    through port `80`:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 接着我们看到如何执行基本的配置来允许或拒绝流量。例如，本教程展示了添加允许通过 80 端口的 TCP 流量的命令：
- en: '[PRE43]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: The `-A` argument indicates that we wish to add a firewall rule and is followed
    by the rule type. Possible values are `INPUT`, `OUTPUT`, and `FORWARD`, which
    apply to incoming traffic, outgoing traffic, and traffic that is routed, respectively
    (if the system is configured as a router, for example). Since `INPUT` is specified,
    our rule applies to incoming traffic on port `80`.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '`-A` 参数表示我们希望添加一条防火墙规则，并紧跟规则类型。可选值包括 `INPUT`、`OUTPUT` 和 `FORWARD`，分别适用于进入流量、离开流量和路由流量（例如，如果系统被配置为路由器）。由于指定了
    `INPUT`，我们的规则适用于端口 `80` 上的进入流量。'
- en: The `-i` argument specifies the network interface that is monitored by the rule.
    In this case, the rule applies to `enp0s3`. Then, `--dport` specifies the traffic's
    destination port, in this case port `80`, and `-p` specifies the transport protocol,
    for example, either TCP or UDP.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '`-i` 参数指定了规则所监控的网络接口。在这个例子中，规则应用于 `enp0s3`。然后，`--dport` 指定了流量的目标端口，在此情况下是端口
    `80`，`-p` 指定了传输协议，例如 TCP 或 UDP。'
- en: The `-j` argument is the target action for **jump to**. With iptables, rules
    are strung together to make chains of filtering logic. Imagine iptables checking
    traffic against each rule we've specified; if the first rule doesn't match, it
    goes on to check the next rule, and the next, until a match is found. When the
    matching rule is found, iptables stops checking and *jumps *to the desired state.
    Possible states are `ACCEPT` to accept the traffic, `REJECT` to actively deny
    the connection, and `DROP` to silently ignore it.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '`-j` 参数是 **跳转到** 的目标动作。使用 iptables 时，规则被串联在一起形成过滤逻辑链。可以想象 iptables 会依次检查流量是否符合每个规则；如果第一个规则不匹配，它会继续检查下一个规则，直到找到匹配的规则为止。当找到匹配规则时，iptables
    停止检查并 *跳转* 到所需状态。可能的状态有 `ACCEPT` 以接受流量，`REJECT` 以主动拒绝连接，`DROP` 以静默忽略。'
- en: 'We also saw how to display the rules that are currently defined using the `-L`
    flag and that using `--line-numbers` will display an identifier alongside each
    rule:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还了解了如何使用 `-L` 标志显示当前定义的规则，以及使用 `--line-numbers` 显示标识符，便于与每条规则一起显示：
- en: '[PRE44]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '![How it works...](img/image_02_006.jpg)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![它是如何工作的...](img/image_02_006.jpg)'
- en: iptables accepts or denies traffic based on the configured rules
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: iptables 根据配置的规则接受或拒绝流量
- en: 'Knowing a rule''s identifier is convenient if we want to delete it. By providing
    `-D`, the rule type (`INPUT`, `OUTPUT`, or `FORWARD`), and the ID, we can succinctly
    remove a rule from the chain:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 知道规则的标识符很方便，如果我们想删除它。通过提供 `-D`、规则类型（`INPUT`、`OUTPUT` 或 `FORWARD`）和 ID，我们可以简洁地从链中删除规则：
- en: '[PRE45]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Alternatively, you can respecify the entire rule while substituting `-A` with
    `-D` to delete it:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，您可以重新指定整个规则，同时将 `-A` 替换为 `-D` 以删除它：
- en: '[PRE46]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: See also
  id: totrans-191
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Refer to the following resources for more information on working with iptables:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅以下资源，获取更多关于使用 iptables 的信息：
- en: How to Migrate from FirewallD to iptables on CentOS 7 ([https://www.digitalocean.com/community/tutorials/how-to-migrate-from-firewalld-to-iptables-on-centos-7](https://www.digitalocean.com/community/tutorials/how-to-migrate-from-firewalld-to-iptables-on-centos-7))
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何从 FirewallD 迁移到 CentOS 7 上的 iptables ([https://www.digitalocean.com/community/tutorials/how-to-migrate-from-firewalld-to-iptables-on-centos-7](https://www.digitalocean.com/community/tutorials/how-to-migrate-from-firewalld-to-iptables-on-centos-7))
- en: How to List and Delete iptables Firewall Rules ([https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules](https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules))
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何列出和删除 iptables 防火墙规则 ([https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules](https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules))
- en: 25 Most Frequently Used Linux iptables Rules ([http://www.thegeekstuff.com/2011/06/iptables-rules-examples](http://www.thegeekstuff.com/2011/06/iptables-rules-examples))
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 25 个最常用的 Linux iptables 规则 ([http://www.thegeekstuff.com/2011/06/iptables-rules-examples](http://www.thegeekstuff.com/2011/06/iptables-rules-examples))
- en: Drop versus reject ([http://www.chiark.greenend.org.uk/~peterb/network/drop-vs-reject](http://www.chiark.greenend.org.uk/~peterb/network/drop-vs-reject))
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 丢弃与拒绝 ([http://www.chiark.greenend.org.uk/~peterb/network/drop-vs-reject](http://www.chiark.greenend.org.uk/~peterb/network/drop-vs-reject))
- en: Installing a DHCP server
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 DHCP 服务器
- en: This recipe will show you how to set up your own DHCP server on CentOS. DHCP
    is used to assign IP addresses and other network configuration details on demand
    to a client. While a system configured with a static IP address will already know
    all the necessary networking details, a system configured to use DHCP broadcasts
    a request on the network and waits to receive a response from the DHCP server.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 本文将向您展示如何在 CentOS 上设置自己的 DHCP 服务器。DHCP 用于根据需求分配 IP 地址和其他网络配置信息给客户端。虽然配置了静态 IP
    地址的系统已经知道所有必要的网络配置信息，但配置为使用 DHCP 的系统会在网络上广播请求，并等待 DHCP 服务器的响应。
- en: Getting ready
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection. You'll
    also need administrative privileges provided by logging in with the `root` account.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 本文要求使用一个具有有效网络连接的 CentOS 系统。您还需要通过 `root` 账户登录来获得管理权限。
- en: Note
  id: totrans-201
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Only one DHCP server should be running on the network to prevent clients from
    receiving conflicting responses that can result in network instability. Many routers
    already have a DHCP service running on them, so check for this on your own network
    before proceeding.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 网络中应该只有一个 DHCP 服务器在运行，以防止客户端收到冲突的响应，导致网络不稳定。许多路由器已经在运行 DHCP 服务，因此在继续之前请先检查您自己的网络。
- en: How to do it...
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行...
- en: 'Follow these steps to set up a DHCP server:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤设置 DHCP 服务器：
- en: 'Install the `dhcp` package:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 `dhcp` 软件包：
- en: '[PRE47]'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Copy the example configuration file provided by the package to serve as the
    starting point of your server''s configuration:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制包提供的示例配置文件，作为服务器配置的起点：
- en: '[PRE48]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Open the configuration file using your text editor:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用文本编辑器打开配置文件：
- en: '[PRE49]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Modify the configuration with values that make sense for your environment.
    In particular, you''ll want to address the following options: `domain-name` and
    `domain-name-servers`, `subnet`, the `dynamic-bootp` range, `broadcast-address`,
    and `routers`. Here is an example configuration for a network of two subnets:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据您的环境修改配置，特别是您需要处理以下选项：`domain-name` 和 `domain-name-servers`，`subnet`，`dynamic-bootp`
    范围，`broadcast-address` 和 `routers`。以下是一个包含两个子网的网络配置示例：
- en: '[PRE50]'
  id: totrans-212
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Save your changes and close the file.
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存更改并关闭文件。
- en: 'Start the `dhcp` service and enable it to start at system boot:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 `dhcp` 服务并启用它在系统启动时自动启动：
- en: '[PRE51]'
  id: totrans-215
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Open ports `67` and `68` in the system''s firewall to allow traffic:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在系统的防火墙中打开端口 `67` 和 `68` 以允许流量：
- en: '[PRE52]'
  id: totrans-217
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: How it works...
  id: totrans-218
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: A system configured to use DHCP will broadcast a request and wait to receive
    a response from the DHCP server. The server's response lets the client know which
    IP address, netmask, gateway information, and so on to use on the network. DHCP-provisioned
    addresses are usually leased, which means that after a set amount of time they
    expire and the client needs to send another request. The DHCP server, in addition
    to handing out connection details, must keep track of the addresses that have
    already been leased so that a client doesn't receive an address that's already
    in use by another system.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 配置为使用 DHCP 的系统将广播请求，并等待接收来自 DHCP 服务器的响应。服务器的响应告诉客户端使用哪个 IP 地址、子网掩码、网关信息等来连接网络。DHCP
    提供的地址通常是租用的，这意味着在设定的时间后，它们会过期，客户端需要重新发送请求。除了分发连接详细信息外，DHCP 服务器还必须跟踪已经租出的地址，以免客户端收到其他系统已经使用的地址。
- en: 'We began by installing the `dhcpd` package, which contains the server and example
    configuration files. Copying the example configuration to use as a starting point
    for our own saves us from having to draft the entire configuration from scratch:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先安装了 `dhcpd` 包，该包包含服务器和示例配置文件。复制示例配置文件作为我们自己配置的起点，可以避免从头编写整个配置：
- en: '[PRE53]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: In the configuration file, there are several places where you need to provide
    values that make sense for your network. The minimal configuration file provided
    as an illustration in the recipe reflects a network divided into two subnets.
    The first subnet is `192.168.56.0/25` and the second is `192.168.56.128/25`. Each
    subnet has its own declaration.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置文件中，有几个地方需要提供适合您网络的值。作为示例的最小配置文件反映了一个划分为两个子网的网络。第一个子网是 `192.168.56.0/25`，第二个是
    `192.168.56.128/25`。每个子网都有自己的声明。
- en: 'Examining the first subnet declaration, the subnet''s ID is `192.168.56.0`
    with a netmask of `255.255.255.128`. The `range` option will restrict the DHCP
    server in assigning IP addresses in the range of `192.168.56.110` to `120` (the
    other addresses are still valid and are available for static assignment). Subsequent
    `option` entries provide the subnet''s broadcast-address and gateway, and override
    the domain name and nameservers defined globally:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 检查第一个子网声明，子网的 ID 为 `192.168.56.0`，子网掩码为 `255.255.255.128`。`range` 选项将限制 DHCP
    服务器在 `192.168.56.110` 到 `120` 范围内分配 IP 地址（其他地址仍然有效，并可用于静态分配）。后续的 `option` 条目提供子网的广播地址和网关，并覆盖全局定义的域名和
    DNS 服务器：
- en: '[PRE54]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Configuring a DHCP server properly requires an understanding of computer networking.
    It is a complex topic and, as such, we can''t discuss every option in detail.
    I advise you to read the manual page for `dhcpd.conf` for extra guidance. The
    page can be accessed using the `man` command:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 正确配置 DHCP 服务器需要理解计算机网络。它是一个复杂的话题，因此我们无法详细讨论每个选项。我建议您阅读 `dhcpd.conf` 的手册页，以获得额外的指导。可以使用
    `man` 命令访问该页面：
- en: '[PRE55]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: '![How it works...](img/image_02_007.jpg)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![工作原理...](img/image_02_007.jpg)'
- en: The configuration file for dhcpd is documented in a manual page
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: dhcpd 的配置文件在手册页中有文档说明。
- en: 'Once the DHCP server was configured and running, we then needed to poke a hole
    in the firewall to allow requests and responses to flow freely. DHCP requests
    occur using UDP and ports `57` and `58` (you can allow them using the service
    defined for FirewallD):'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦 DHCP 服务器配置并运行，我们就需要在防火墙中开一个孔，以允许请求和响应自由流动。DHCP 请求使用 UDP 和端口 `57` 和 `58`（可以通过为
    FirewallD 定义的服务来允许它们）：
- en: '[PRE56]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: See also
  id: totrans-231
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'For more information on setting up a DHCP server, refer to the following resources:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 有关设置 DHCP 服务器的更多信息，请参考以下资源：
- en: The `dhcpd.conf` manual page (`man 5 dhcpd.conf`)
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dhcpd.conf` 手册页（`man 5 dhcpd.conf`）'
- en: 'RHEL 7 Networking Guide: DHCP Servers ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-DHCP_Servers.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-DHCP_Servers.html))'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7 网络指南：DHCP 服务器 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-DHCP_Servers.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-DHCP_Servers.html))
- en: 'Quick Start: Setup CentOS 7 as a DHCP Server ([www.yoyoclouds.com/2015/01/quick-start-setup-centos-7-as-dhcp.html](http://www.yoyoclouds.com/2015/01/quick-start-setup-centos-7-as-dhcp.html))'
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 快速入门：设置 CentOS 7 作为 DHCP 服务器 ([www.yoyoclouds.com/2015/01/quick-start-setup-centos-7-as-dhcp.html](http://www.yoyoclouds.com/2015/01/quick-start-setup-centos-7-as-dhcp.html))
- en: Subnet Calculator ([www.subnet-calculator.com](http://www.subnet-calculator.com/))
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 子网计算器 ([www.subnet-calculator.com](http://www.subnet-calculator.com/))
- en: Configuring an NFS server to share a filesystem
  id: totrans-237
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 NFS 服务器以共享文件系统
- en: Network File System (NFS) is a protocol for a distributed filesystem. That is,
    we can store files to a directory on a remote server and clients can mount the
    share. The remote directory will appear to the client as if it were local, although
    all data saved to it resides on the server. This recipe shows you how to configure
    NFS on a server and expose the storage as a network share. (The next recipe will
    show you how to configure NFS on a client.)
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 网络文件系统（NFS）是一种分布式文件系统协议。也就是说，我们可以将文件存储到远程服务器上的某个目录中，客户端可以挂载该共享目录。远程目录在客户端看起来就像本地目录一样，尽管所有保存到该目录的数据实际上都存储在服务器上。本食谱展示了如何在服务器上配置
    NFS 并将存储暴露为网络共享。（下一个食谱将展示如何在客户端配置 NFS。）
- en: Getting ready
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection. You'll
    also need administrative privileges provided by logging in with the `root` account.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱需要一个具有有效网络连接的 CentOS 系统。你还需要通过以 `root` 账户登录获得管理员权限。
- en: How to do it...
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to set up an NFS server:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤设置 NFS 服务器：
- en: 'Install the `nfs-utils` and `libnfsidmap` packages:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 `nfs-utils` 和 `libnfsidmap` 包：
- en: '[PRE57]'
  id: totrans-244
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Create a globally accessible directory which will serve as the root of the
    file share:'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个全局可访问的目录，作为文件共享的根目录：
- en: '[PRE58]'
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Open /`etc/exports` and add the following entry to mark the directory for export
    by NFS. When done, save and close the file:'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 /`etc/exports` 文件，并添加以下条目以标记要通过 NFS 导出的目录。完成后，保存并关闭文件：
- en: '[PRE59]'
  id: totrans-248
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: The `exports` file is very picky. Make sure there's no space between the network
    and the parenthesized options as well as no spaces around the commas that separate
    the options.
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`exports` 文件非常挑剔。确保网络和括号选项之间没有空格，选项之间的逗号周围也没有空格。'
- en: 'Start the necessary services and register them so that they will start when
    the server boots:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动必要的服务并注册它们，以便在服务器启动时自动启动：
- en: '[PRE60]'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Open ports `111`, `2048`, and `2049` in the firewall to allow traffic through:'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在防火墙中打开端口 `111`、`2048` 和 `2049` 以允许流量通过：
- en: '[PRE61]'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: How it works...
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In this recipe, you learned how to set up a shared network directory using NFS.
    After installing the appropriate packages, we created the shared directory, registered
    it to be exported, and started the necessary system services.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，你学会了如何使用 NFS 设置共享网络目录。在安装适当的包后，我们创建了共享目录，注册它以供导出，并启动了必要的系统服务。
- en: '`/etc/exports` is the configuration file that manages which filesystems are
    exported and how. We added an entry that identified the directory we want to export,
    followed by which clients they are exported to and the options that govern how
    the export will be treated:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '`/etc/exports` 是管理导出文件系统及其方式的配置文件。我们添加了一个条目，标识了我们要导出的目录，接着列出了它们导出的客户端以及管理导出处理方式的选项：'
- en: '[PRE62]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'In the example, we make the share available to `192.168.56.0/24`, in other
    words, any host on the network. Alternatively, you can share the directory a single
    host or a range of hosts. An entry that shares the directory with a specific host
    looks like the following:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例中，我们将共享目录提供给 `192.168.56.0/24`，换句话说，网络上的任何主机。或者，你也可以将目录共享给单个主机或一系列主机。共享目录给特定主机的条目如下所示：
- en: '[PRE63]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: The `rw++` option allows both read and write access to the share. `sync` flushes
    any changes to a file immediately to disk. While writing to disk might make access
    to the file slower at times, the delay won't be noticeable unless your system
    is under high load, and it would seem like a fair trade-off for the safety that
    immediate flushes provide in the event of a crash.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '`rw++`选项允许对共享文件夹进行读写访问。`sync`选项则会立即将文件的所有更改刷新到磁盘。虽然写入磁盘可能会导致文件访问变慢，但除非系统负载过高，否则延迟几乎不会被察觉，这对于在崩溃时能提供即时刷新的安全性来说，是一种值得的折衷。'
- en: NFS will effectively squash the root user's ownership when `root_squash` is
    provided by changing the owner to `nfsnobody`. This is a security measure that
    mitigates the risk of a root user on the client system attempting to write a file
    to the share with root ownership (otherwise a malicious user could store a file
    and mark it executable where it might be run with root privileges). If you want
    to squash the ownership of all files to `nfsnobdy`, you can use the `all_squash`
    option.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 当提供`root_squash`选项时，NFS将有效地将根用户的所有权压缩为`nfsnobody`，这是一项安全措施，可以减少客户端系统上的根用户尝试以根权限将文件写入共享的风险（否则，恶意用户可以存储一个文件并将其标记为可执行，从而可能以根权限运行）。如果你想将所有文件的所有权压缩为`nfsnobody`，可以使用`all_squash`选项。
- en: NFS relies on a few other services, which is why we also enabled rpcbind and
    opened firewall ports for rpcbind and mountd. NFS works on top of the Remote Procedure
    Call (RPC) protocol, and rcpind is responsible for mapping the RPC-based services
    to their ports. An incoming connection from a client first hits the rpcbind service,
    providing an RPC identifier. Rpcbind resolves the identifier to a particular service
    (NFS in this case) and redirects the client to the appropriate port. There, mountd
    handles the request to determine whether the requested share is exported and whether
    the client is allowed to access it.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: NFS依赖于其他一些服务，因此我们还启用了rpcbind并为rpcbind和mountd打开了防火墙端口。NFS基于远程过程调用（RPC）协议工作，而rpcbind负责将基于RPC的服务映射到其端口。来自客户端的传入连接首先会触及rpcbind服务，提供一个RPC标识符。rpcbind将该标识符解析为特定服务（此处为NFS），并将客户端重定向到相应的端口。在那里，mountd处理请求，以确定请求的共享是否已导出，以及客户端是否被允许访问该共享。
- en: See also
  id: totrans-263
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Refer to the following resources for more information about configuring an
    NFS server:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 参考以下资源获取有关配置NFS服务器的更多信息：
- en: The Network Filesystem ([http://www.tldp.org/LDP/nag/node140.html](http://www.tldp.org/LDP/nag/node140.html))
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络文件系统 ([http://www.tldp.org/LDP/nag/node140.html](http://www.tldp.org/LDP/nag/node140.html))
- en: 'RHEL 7 Storage Administration Guide: NFS Server Configuration ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-serverconfig.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-serverconfig.html))'
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7 存储管理指南：NFS 服务器配置 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-serverconfig.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-serverconfig.html))
- en: How to setup NFS Server on CentOS 7 ([http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html](http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html))
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何在CentOS 7上设置NFS服务器 ([http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html](http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html))
- en: Configuring an NFS client to use a shared filesystem
  id: totrans-268
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置NFS客户端以使用共享文件系统
- en: This recipe continues where the previous recipe left off, showing you how to
    configure NFS on a client system.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程接续上一个教程，向你展示如何在客户端系统上配置NFS。
- en: Getting ready
  id: totrans-270
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a CentOS system with a working network connection. It assumes
    that an NFS server has been configured as explained in the previous recipe. You'll
    also need administrative privileges provided by logging in with the `root` account.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程需要一台具有正常网络连接的CentOS系统，假设你已经按照上一个教程配置了NFS服务器。你还需要通过`root`账户登录来获得管理员权限。
- en: How to do it...
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Follow these steps to configure an NFS client:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤配置NFS客户端：
- en: 'Install the `nfs-utils` and `libnfsidmap` packages:'
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装`nfs-utils`和`libnfsidmap`包：
- en: '[PRE64]'
  id: totrans-275
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Create the directory which will serve as the mount point for the remote filesystem:'
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建将作为远程文件系统挂载点的目录：
- en: '[PRE65]'
  id: totrans-277
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Start the `rpcbind` service and register it so that it will start when the
    server boots:'
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动`rpcbind`服务并注册，以确保服务器启动时该服务也会启动：
- en: '[PRE66]'
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'Mount the NFS share to the mount point:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 NFS 共享挂载到挂载点：
- en: '[PRE67]'
  id: totrans-281
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: How it works...
  id: totrans-282
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'Like the server side, the client side of NFS relies on RPC. So, we started
    and enabled the rpcbind service. The `mount` command is then used to mount the
    remote share:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 与服务器端类似，NFS 客户端依赖于 RPC。因此，我们启动并启用了 rpcbind 服务。然后，使用 `mount` 命令挂载远程共享：
- en: '[PRE68]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: The `-t` argument indicates the share's filesystem type, which, of course is, `nfs`.
    The location of the remote share is also provided, the IP address of the server
    and the directory of the shared data separated by a colon. Finally, the mount
    target is given.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: '`-t` 参数表示共享的文件系统类型，当然是 `nfs`。还需要提供远程共享的位置，服务器的 IP 地址和共享数据的目录，以冒号分隔。最后，指定挂载目标。'
- en: 'To manually unmount the share, the `umount` command is used with the mount
    point:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 要手动卸载共享，使用 `umount` 命令并指定挂载点：
- en: '[PRE69]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'We can also configure the system to mount the NFS share automatically at boot
    time. Open `/etc/fstab` using your editor and add the following line:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以配置系统在启动时自动挂载 NFS 共享。使用编辑器打开 `/etc/fstab` 文件，并添加以下行：
- en: '[PRE70]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'The share will be automatically mounted when the system boots. Since `mount`
    can look up information in `/etc/fstab`, the invocation to mount the share manually
    becomes much simpler once it''s registered in this manner. You can now mount the
    share manually by providing just the `mount`:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 共享将在系统启动时自动挂载。由于 `mount` 可以在 `/etc/fstab` 中查找信息，因此一旦以这种方式注册，手动挂载共享的调用变得更加简便。现在，你只需提供
    `mount` 即可手动挂载共享：
- en: '[PRE71]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: See also
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Refer to the following resources for more information about configuring an
    NFS client:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 有关配置 NFS 客户端的更多信息，请参考以下资源：
- en: The `mount` manual page (`man 8 mount`)
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mount` 手册页（`man 8 mount`）'
- en: Setting up an NFS Client ([http://www.tldp.org/HOWTO/NFS-HOWTO/client.html](http://www.tldp.org/HOWTO/NFS-HOWTO/client.html))
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 NFS 客户端 ([http://www.tldp.org/HOWTO/NFS-HOWTO/client.html](http://www.tldp.org/HOWTO/NFS-HOWTO/client.html))
- en: 'RHEL 7 Storage Administration Guide: NFS Client Configuration ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-clientconfig.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-clientconfig.html))'
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RHEL 7 存储管理指南：NFS 客户端配置 ([https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-clientconfig.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/nfs-clientconfig.html))
- en: How to setup NFS Server on CentOS 7 ([http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html](http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html))
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何在 CentOS 7 上设置 NFS 服务器 ([http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html](http://www.itzgeek.com/how-tos/linux/centos-how-tos/how-to-setup-nfs-server-on-centos-7-rhel-7-fedora-22.html))
- en: Serving Windows shares with Samba
  id: totrans-298
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Samba 提供 Windows 共享
- en: In this recipe, you will learn how to serve a Windows share from a CentOS system
    using Samba. Like NFS, a Windows share is a directory on a remote server that
    a client may access to store files. Samba is a server that understands the SMB
    protocol used by Windows so that it can export directories that a Windows client
    can mount.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，你将学习如何使用 Samba 从 CentOS 系统共享 Windows 共享目录。与 NFS 类似，Windows 共享是远程服务器上的一个目录，客户端可以访问该目录来存储文件。Samba
    是一个理解 Windows 使用的 SMB 协议的服务器，使其能够导出 Windows 客户端可以挂载的目录。
- en: Getting ready
  id: totrans-300
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: This recipe requires a CentOS system with a working network connection. You'll
    also need administrative privileges provided by logging in with the `root` account.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程要求使用具有有效网络连接的 CentOS 系统。你还需要通过以 `root` 账户登录来获取管理员权限。
- en: 'The name of your Windows workgroup is needed to configure Samba properly. Before
    you begin, on your Windows system in your network, run `net config workstation`
    and record the `Workstation domain` value:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 Samba 时需要提供 Windows 工作组的名称。在开始之前，在 Windows 系统的网络中运行 `net config workstation`
    并记录 `Workstation domain` 值：
- en: '![Getting ready](img/image_02_008.jpg)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
  zh: '![准备就绪](img/image_02_008.jpg)'
- en: net config workstation displays information about the Windows system's workgroup
    and domain
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '`net config workstation` 显示有关 Windows 系统的工作组和域的信息'
- en: How to do it...
  id: totrans-305
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to set up Samba to share directories with Windows systems:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤设置 Samba 以与 Windows 系统共享目录：
- en: 'Install the `samba` package:'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 `samba` 包：
- en: '[PRE72]'
  id: totrans-308
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Create a dedicated group for Samba users:'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为 Samba 用户创建一个专用组：
- en: '[PRE73]'
  id: totrans-310
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'Create the directory which will serve as the root of the file share. Set its
    group ownership to the new Samba users group:'
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建将作为文件共享根目录的目录。将其组所有权设置为新的 Samba 用户组：
- en: '[PRE74]'
  id: totrans-312
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Open Samba''s configuration file using your text editor:'
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用文本编辑器打开 Samba 的配置文件：
- en: '[PRE75]'
  id: totrans-314
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Update the `workgroup` parameter in the `[global]` section to match the Windows
    workgroup name. Feel free to review the other parameters in the configuration
    file as each is clearly documented with helpful comments:'
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更新 `[global]` 部分中的 `workgroup` 参数，以匹配 Windows 工作组名称。可以查看配置文件中的其他参数，因为每个参数都进行了详细的注释：
- en: '[PRE76]'
  id: totrans-316
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'At the end of the configuration file, add the following content:'
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在配置文件的末尾添加以下内容：
- en: '[PRE77]'
  id: totrans-318
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE77]'
- en: Save your changes and close the file.
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存更改并关闭文件。
- en: 'Start the necessary services and register them so that they will start when
    the server boots:'
  id: totrans-320
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动必要的服务并注册它们，以便它们在服务器启动时自动启动：
- en: '[PRE78]'
  id: totrans-321
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'Open ports `137`-`139` and `445` to allow the network traffic:'
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开端口 `137`-`139` 和 `445`，以允许网络流量：
- en: '[PRE79]'
  id: totrans-323
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'For each user who will connect to the share, assign them to the users group
    and register the password they will use:'
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于每个将连接到共享的用户，将其分配到用户组并注册他们将使用的密码：
- en: '[PRE80]'
  id: totrans-325
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: How it works...
  id: totrans-326
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: In this recipe, you learned how to install and configure Samba to share a directory
    which a Windows client can access.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，你学会了如何安装和配置 Samba，以共享 Windows 客户端可以访问的目录。
- en: We started by doing a bit of research using the `net config` command to discover
    the Windows workgroup that our client belongs to. This is important because two
    systems on the same network but identifying themselves as part of different workgroups
    will not be able to communicate with one another. In the example, the workgroup's
    name was simply `WORKGROUP`.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先使用 `net config` 命令进行了一些研究，发现了我们的客户端所属的 Windows 工作组。这很重要，因为同一网络中的两个系统，如果它们属于不同的工作组，将无法相互通信。在本例中，工作组的名称是
    `WORKGROUP`。
- en: Next, we installed the `samba` package and created a special group named `smbgroup`.
    We'll configure Samba so that any user account on the CentOS system will be able
    to access the share as long as it's assigned to the `smbgroup` group. Then we
    created the directory we would be sharing and set its group ownership to the new
    group.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们安装了 `samba` 包，并创建了一个名为 `smbgroup` 的特殊组。我们将配置 Samba，使得 CentOS 系统上的任何用户帐户，只要其属于
    `smbgroup` 组，就可以访问共享。然后，我们创建了要共享的目录，并将其组所有权设置为新组。
- en: We then edited Samba's configuration file, specifying the name of the Windows
    workgroup we looked up earlier for the `workgroup` value, and added a section
    to define the new share. We restricted the share so that only authenticated users
    belonging to `smbgroup` can access it by setting `guest ok` to `no` and `valid
    users` to `@smbgroup`. The `writable` entry allows users to create and update
    files on the share (otherwise the files would be read-only), and the `create mask`
    entry was used to specify the default file permissions that new files will be
    assigned in the Linux filesystem. The name `share` within brackets not only starts
    that configuration section but also serves as the name the share will be exported
    as (that is, `\\192.168.56.100\share`). You can export multiple shares as long
    as each name is distinct.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 我们编辑了 Samba 的配置文件，为 `workgroup` 值指定了我们之前查找的 Windows 工作组名称，并添加了一个部分来定义新的共享。我们通过将
    `guest ok` 设置为 `no` 和 `valid users` 设置为 `@smbgroup` 来限制共享访问权限，确保只有属于 `smbgroup`
    的认证用户才能访问该共享。`writable` 条目允许用户在共享上创建和更新文件（否则文件将是只读的），而 `create mask` 条目用于指定新文件在
    Linux 文件系统中分配的默认文件权限。括号中的 `share` 名称不仅开始了该配置部分，而且还作为共享导出的名称（即 `\\192.168.56.100\share`）。只要每个名称都唯一，你可以导出多个共享。
- en: For each user account that will be used to connect to the share, we made sure
    it belonged to the `smbgroup` and used the `smbpasswd` command to specify a password
    the account would use to authenticate its SMB sessions. This password is maintained
    separately from the system's credentials and is valid only for authenticating
    to Samba, so a password different from the account's login password should be
    chosen.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个将用于连接共享的用户帐户，我们确保它属于 `smbgroup`，并使用 `smbpasswd` 命令指定该帐户将用于认证其 SMB 会话的密码。此密码与系统的凭据分开维护，仅用于对
    Samba 进行身份验证，因此应该选择一个与帐户登录密码不同的密码。
- en: 'Managing Samba users is done using `smbpasswd`. The `-a` flag adds an entry
    in Samba''s account database, and we can delete a user from the database using
    the `-x` flag:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 管理 Samba 用户可以使用`smbpasswd`。`-a`选项会在 Samba 的账户数据库中添加一个条目，而我们可以使用`-x`选项从数据库中删除用户：
- en: '[PRE81]'
  id: totrans-333
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'On the Windows system, you can use the `net use` command to map the remote
    share to a drive letter. Once it''s mapped, the drive appears in the list of available
    drives:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows 系统上，你可以使用`net use`命令将远程共享映射到驱动器字母。一旦映射完成，该驱动器将出现在可用驱动器列表中：
- en: '[PRE82]'
  id: totrans-335
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'Alternatively, you can map the drive through the Windows GUI, navigating through
    `Computer` | `Map network drive` | `Map network drive` in File Explorer while
    the **This PC** bookmark is selected:'
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你可以通过 Windows 图形界面来映射驱动器，路径是：`计算机` | `映射网络驱动器` | `映射网络驱动器`，在文件资源管理器中选择**此电脑**书签：
- en: '![How it works...](img/image_02_009.jpg)'
  id: totrans-337
  prefs: []
  type: TYPE_IMG
  zh: '![工作原理...](img/image_02_009.jpg)'
- en: The Samba share is available as a network mapped drive
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: Samba 共享可以作为网络映射驱动器使用
- en: See also
  id: totrans-339
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'For more information on working with Samba, refer to the following resources:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 有关使用 Samba 的更多信息，请参考以下资源：
- en: The `smb.conf` manual page (`man 5 smb.conf`)
  id: totrans-341
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`smb.conf` 手册页（`man 5 smb.conf`）'
- en: Using Samba on CentOS With Windows 7/8 ([https://rcollier.me/2013/07/30/using-samba-on-centos-with-windows-78/](https://rcollier.me/2013/07/30/using-samba-on-centos-with-windows-78/))
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 CentOS 上使用 Samba 与 Windows 7/8 ([https://rcollier.me/2013/07/30/using-samba-on-centos-with-windows-78/](https://rcollier.me/2013/07/30/using-samba-on-centos-with-windows-78/))
- en: Install And Configure Samba Server In CentOS 7 ([http://www.unixmen.com/install-configure-samba-server-centos-7](http://www.unixmen.com/install-configure-samba-server-centos-7))
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 CentOS 7 中安装和配置 Samba 服务器 ([http://www.unixmen.com/install-configure-samba-server-centos-7](http://www.unixmen.com/install-configure-samba-server-centos-7))
