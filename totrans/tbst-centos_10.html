<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Troubleshooting DNS Services"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Troubleshooting DNS Services</h1></div></div></div><p>As the Domain Name System (DNS) is <a id="id429" class="indexterm"/>probably the most influential technology in the world of IT, at some point in your career you should expect that it will be presented to you as an ongoing issue that needs to be managed and resolved. DNS servers come in various forms, and your level of control may vary depending on the type of infrastructure you have access to but, regardless of this, the issues will undoubtedly remain the same, in whole or part.</p><p>Having already reviewed the virtue of <code class="literal">dig</code> and the various other networking tools, in the final few pages of this book we will now discuss the process of troubleshooting CentOS 7 with specific regard to monitoring issues related to DNS as a function of the overall system health check.</p><p>In this chapter, we will:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learn how to change the hostname of the system using <code class="literal">hostnamectl</code> and managing the <code class="literal">fqdn</code> with <code class="literal">/etc/hosts</code></li><li class="listitem" style="list-style-type: disc">Learn how to perform a few basic system and BIND-based sanity checks before hitting the panic button</li><li class="listitem" style="list-style-type: disc">Learn how to monitor bandwidth with <code class="literal">iftop</code></li><li class="listitem" style="list-style-type: disc">Learn how to flush the cache</li></ul></div><div class="section" title="Changing the hostname and managing the FQDN"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec90"/>Changing the hostname and managing the FQDN</h1></div></div></div><p>Changing<a id="id430" class="indexterm"/> the hostname of an authoritative or a recursive (caching) server may not necessarily be a DNS issue (per se), but,<a id="id431" class="indexterm"/> as a<a id="id432" class="indexterm"/> rule of thumb, the hostname of your system is inextricably linked to the DNS as a function<a id="id433" class="indexterm"/> of the overall system in question; for this reason, we will now review the procedure to change the hostname of the host system.</p><p>To review the current hostname, you can use the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># hostnamectl status</strong></span>
</pre></div><p>However, you can choose to view the static, transient, or pretty name with one of the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># hostnamectl status --static</strong></span>
<span class="strong"><strong># hostnamectl status --transient</strong></span>
<span class="strong"><strong># hostnamectl status --pretty</strong></span>
</pre></div><p>Based on this, to<a id="id434" class="indexterm"/> change the hostname you<a id="id435" class="indexterm"/> should <a id="id436" class="indexterm"/>use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># hostnamectl set-hostname &lt;new-host-name&gt;</strong></span>
</pre></div><p>Alternatively, you <a id="id437" class="indexterm"/>can choose to update the static hostname with this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># hostnamectl --static set-hostname &lt;new-host-name&gt;</strong></span>
</pre></div><p>Having completed this action, the hostname change will be applied to the kernel automatically without any need to reboot. Subsequently, any change to the hostname must be reflected in the system's networking configuration.</p><p>To do this, you will have to check and confirm <code class="literal">/etc/hosts</code> is up-to-date by typing:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nano /etc/hosts</strong></span>
</pre></div><p>A typical post-installation (or default) file will look like this:</p><div class="informalexample"><pre class="programlisting">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</pre></div><p>To proceed, simply change the file to read as follows by substituting the relevant values that suit your system configuration:</p><div class="informalexample"><pre class="programlisting">127.0.0.1       localhost localhost.localdomain localhost4 localhost4.localdomain4
192.168.1.183   &lt;servername&gt;.&lt;domain-name&gt;.&lt;tld&gt; &lt;server-name&gt;
::1             localhost localhost.localdomain localhost6 localhost6.localdomain6</pre></div><p>For example, if your server name is <code class="literal">centos7</code> (hostname) and it is on the <code class="literal">centos.local</code> domain, then your file will look like this:</p><div class="informalexample"><pre class="programlisting">127.0.0.1       localhost localhost.localdomain localhost4 localhost4.localdomain4
192.168.1.200   centos7.centos.local centos7
::1             localhost localhost.localdomain localhost6 localhost6.localdomain6</pre></div><p>Once this is complete, you can confirm the hostname by typing this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># hostname</strong></span>
</pre></div><p>Then you can confirm and print the current FQDN by typing the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># hostname –f</strong></span>
</pre></div><p>However, if you <a id="id438" class="indexterm"/>discover <a id="id439" class="indexterm"/>that the new <a id="id440" class="indexterm"/>hostname has not been accepted or updated, then simply type the following command to resolve any outstanding issues:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl restart systemd-hostnamed</strong></span>
</pre></div><p>You can then<a id="id441" class="indexterm"/> confirm these changes by running <code class="literal">ping</code> on the server in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># ping –c 4 &lt;hostname&gt;</strong></span>
</pre></div><p>Based on the preceding example, if you run:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># ping –c 4 centos</strong></span>
</pre></div><p>The output of <code class="literal">ping</code> should now show the FQDN like this:</p><div class="informalexample"><pre class="programlisting">PING centos7.centos.local (192.168.1.200) 56(84) bytes of data.
64 bytes from centos7.centos.local (192.168.1.183): icmp_seq=1 ttl=64 time=0.048 ms
64 bytes from centos7.centos.local (192.168.1.183): icmp_seq=2 ttl=64 time=0.057 ms
64 bytes from centos7.centos.local (192.168.1.183): icmp_seq=3 ttl=64 time=0.038 ms
64 bytes from centos7.centos.local (192.168.1.183): icmp_seq=4 ttl=64 time=0.094 ms</pre></div></div></div>
<div class="section" title="Performing system sanity checks with BIND"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec91"/>Performing system sanity checks with BIND</h1></div></div></div><p>DNS failures <a id="id442" class="indexterm"/>can be the result of some fairly innocuous issues that arise due to fundamental <a id="id443" class="indexterm"/>configuration <a id="id444" class="indexterm"/>flaws or recent changes (and updates) to a system. This type of event can happen and, for this reason, it is always useful to run through a checklist of sanity checks before you hit the panic button.</p><p>So, by starting with a basic tool such as <code class="literal">ping</code>, <code class="literal">nslookup</code>, or <code class="literal">dig</code>, you can begin testing for areas of concern. For example, you can use <code class="literal">telnet</code> like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># telnet &lt;remote-server-address&gt; 53</strong></span>
</pre></div><p>The <code class="literal">telnet</code> command is a nice and easy tool to use, and if the connection is refused or takes too long, then you can rule out the possibility of RDNS errors by simply renaming the reverse DNS file and trying again.</p><p>Now, if you do this, make sure that the forward DNS remains functional and reattempts a telnet connection. If this works, you will know that the RDNS is at fault and you can double-check this by confirming the forward zones with <code class="literal">nslookup</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nslookup &lt;remote-server-address&gt;</strong></span>
</pre></div><p>However, if you<a id="id445" class="indexterm"/> are <a id="id446" class="indexterm"/>still unable to connect, then you should restore the RDNS file, check your firewall configuration (and <code class="literal">SELinux</code>, if used), and then use the following command to view the current status of port 53:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># netstat -tulpn | grep :53</strong></span>
</pre></div><p>If you are still <a id="id447" class="indexterm"/>encountering difficulties, then you should also check the log files like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># tail -f /var/log/messages</strong></span>
</pre></div><p>Now confirm the status of the named service:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># ps ax | grep named</strong></span>
</pre></div><p>However, it is far more informative if you use the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl status named</strong></span>
</pre></div><p>The output of this command may begin with the following notice before listing any current resolving errors:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>named.service - Berkeley Internet Name Domain (DNS)</strong></span>
<span class="strong"><strong>   Loaded: loaded (/usr/lib/systemd/system/named.service; disabled)</strong></span>
<span class="strong"><strong>   Active: active (running) since Sun 2015-05-03 07:55:14 EDT; 16s ago</strong></span>
<span class="strong"><strong>  Process: 2853 ExecStart=/usr/sbin/named -u named $OPTIONS (code=exited, status=0/SUCCESS)</strong></span>
<span class="strong"><strong>  Process: 2851 ExecStartPre=/usr/sbin/named-checkconf -z /etc/named.conf (code=exited, status=0/SUCCESS)</strong></span>
<span class="strong"><strong> Main PID: 2855 (named)</strong></span>
<span class="strong"><strong>   CGroup: /system.slice/named.service</strong></span>
<span class="strong"><strong>   └─2855 /usr/sbin/named -u named</strong></span>

<span class="strong"><strong>May 03 07:55:15 centos7 named[2855]: error (network unreachable) resolving 'pdns196.ultradns.info/AAAA/IN': 2001:500:49::1#53</strong></span>
<span class="strong"><strong>May 03 07:55:15 centos7 named[2855]: error (network unreachable) resolving 'pdns196.ultradns.info/A/IN': 2001:500:1b::1#53</strong></span>
<span class="strong"><strong>May 03 07:55:15 centos7 named[2855]: error (network unreachable) resolving 'pdns196.ultradns.info/AAAA/IN': 2001:500:1b::1#53</strong></span>
<span class="strong"><strong>May 03 07:55:15 centos7 named[2855]: error (network unreachable) resolving 'ns1.isc.ultradns.net/AAAA/IN': 2610:a1:1014::e8#53</strong></span>
<span class="strong"><strong>May 03 08:55:15 centos7 named[2855]: error (network unreachable) resolving './DNSKEY/IN': 2001:7fd::1#53</strong></span>
<span class="strong"><strong>May 03 08:55:15 centos7 named[2855]: error (network unreachable) resolving './NS/IN': 2001:7fd::1#53</strong></span>
<span class="strong"><strong>May 03 08:55:15 centos7 named[2855]: error (network unreachable) resolving './DNSKEY/IN': 2001:dc3::35#53</strong></span>
<span class="strong"><strong>May 03 08:55:15 centos7 named[2855]: error (network unreachable) resolving './NS/IN': 2001:dc3::35#53</strong></span>
</pre></div><p>If all is well, the <a id="id448" class="indexterm"/>next step will be to check your zone files for errors:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># named-checkconf /etc/named.conf</strong></span>
</pre></div><p>Remember, if no errors are found, then no output will be provided. However, if you do encounter an error, depending on the system in question, the output may look like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/etc/named.conf:106: missing ';' before 'zone'</strong></span>
</pre></div><p>Moving beyond this, you <a id="id449" class="indexterm"/>can also use the provided package called <code class="literal">named-checkzone</code> to check and confirm the overall <a id="id450" class="indexterm"/>integrity and syntax of a zone file. It works by creating a false load situation and thereby runs the same validation rules as it would before it is loaded into the system. In this way, it makes a remarkably reliable approach to confirming new zone files before adding them to a production server.</p><p>To use <code class="literal">named-checkzone</code>, you have to type:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># named-checkzone localhost /var/named/&lt;filename&gt;</strong></span>
</pre></div><p>Alternatively, you can check a specific hostname with:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># named-checkzone &lt;hostname&gt; /var/named/&lt;filename&gt;</strong></span>
</pre></div><p>On the other hand, if you are in a situation where no nameserver is currently configured or the nameserver is found to be inaccessible, the first port of call is to check the system's resolver in order to confirm that it is configured correctly by opening the following file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nano /etc/resolv.conf</strong></span>
</pre></div><p>Having opened this file, you will notice that the first entry should point to the primary or master nameserver followed by an entry for the secondary or slave nameserver. Generally speaking, you should expect to see at least two nameservers, but three is also common. Depending on the system's configuration, an example of <code class="literal">/etc/resolv.conf</code> may look like this:</p><div class="informalexample"><pre class="programlisting">search local
    nameserver XXX.XXX.XXX.XXX
    nameserver XXX.XXX.XXX.XXX</pre></div><p>For example, if you were using Google's DNS, then the primary nameserver will be 8.8.8.8 and the secondary nameserver will be 8.8.4.4. Consequently, your file will look like this:</p><div class="informalexample"><pre class="programlisting">search local
    nameserver 8.8.8.8
    nameserver 8.8.4.4</pre></div><p>On the off chance that the <a id="id451" class="indexterm"/>system is using <code class="literal">127.0.0.1</code> or <code class="literal">localhost</code> as the primary or sole nameserver, then you should also expect to find forwarders<a id="id452" class="indexterm"/> being used in the main DNS configuration file. The exact nature of how this is to be done will depend on what DNS application you are currently using. However, in the case of <code class="literal">BIND</code>, this would be found within the <code class="literal">options</code> section of <code class="literal">/etc/named.conf</code> as follows:</p><div class="informalexample"><pre class="programlisting">forwarders {
XXX.XXX.XXX.XXX;
XXX.XXX.XXX.XXX;
};</pre></div><p>Moreover, while you <a id="id453" class="indexterm"/>are reviewing the <code class="literal">BIND</code> configuration file, you should also ensure that recursion is disabled in order to reduce recursive queries, and thereby protect the system from the risk of <code class="literal">DDoS Amplication</code> attacks like this:</p><div class="informalexample"><pre class="programlisting">allow-transfer     { 127.0.0.1; XXX.XXX.XXX.XXX; };
recursion no;</pre></div><p>Now, confirm that BIND is actually listening on port 53:</p><div class="informalexample"><pre class="programlisting">listen-on port 53 { 127.0.0.1; XXX.XXX.XXX.XXX; };</pre></div><p>Remember, when you are testing DNS, you should ensure that port 53 is open on both UDP and TCP ports. This is because UDP queries larger than 512 bytes can be truncated and TCP is used as a failover solution. So, remember to check the firewall configuration in order to see whether you need to make any required changes; and if you do, remember to restart the firewall.</p><p>Having done this, you can then check the current status of <code class="literal">BIND</code> by typing this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl status named</strong></span>
</pre></div><p>Then, start or stop the service as required by using one or more of the following system commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl start named</strong></span>
<span class="strong"><strong># systemctl restart named</strong></span>
<span class="strong"><strong># systemctl stop named</strong></span>
</pre></div><p>Following this, and based on the assumption that the zone files are not only correct (including the forward and reverse zones), but also maintain the correct permissions, you should also check <code class="literal">/etc/hosts</code> in order to confirm that the appropriate configuration is available to the system.</p><p>To do this, open <code class="literal">/etc/hosts</code> in your <a id="id454" class="indexterm"/>favorite text editor like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nano /etc/hosts</strong></span>
</pre></div><p>An example of this file looks like this:</p><div class="informalexample"><pre class="programlisting">127.0.0.1       localhost.localdomain localhost
XXX.XXX.XXX.XXX	&lt;servername&gt;.&lt;domainname&gt;.&lt;tld&gt;  &lt;servername&gt;
::1             localhost6.localdomain6 localhost6</pre></div><p>If you need to add any <a id="id455" class="indexterm"/>specific or dedicated IP address to the host file, then simply add them underneath the first three lines like this:</p><div class="informalexample"><pre class="programlisting">127.0.0.1       localhost.localdomain localhost
XXX.XXX.XXX.XXX	&lt;servername&gt;.&lt;domainname&gt;.&lt;tld&gt;  &lt;servername&gt;
::1             localhost6.localdomain6 localhost6


XXX.XXX.XXX.XXX        live.intranet.local
XXX.XXX.XXX.XXX        staging.intranet.local
XXX.XXX.XXX.XXX        production.intranet.local</pre></div><p>Finally, you <a id="id456" class="indexterm"/>should also check and confirm the configuration for your Ethernet device, which can be accessed by opening the relevant Ethernet connection at <code class="literal">/etc/sysconfig/network-scripts</code>. As you can see, this configuration file often indicates a preference for a specific <code class="literal">Gateway</code>, <code class="literal">DNS</code>, and <code class="literal">Domain</code> setting. In this respect, ensuring that these settings are accurate can be seen as good practice.</p><p>As shown here, based on the previous example, the output of <code class="literal">cat /etc/sysconfig/network-scripts/ifcfg-eth0</code> may look like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>TYPE=Ethernet</strong></span>
<span class="strong"><strong>BOOTPROTO=none</strong></span>
<span class="strong"><strong>DEFROUTE=yes</strong></span>
<span class="strong"><strong>IPV4_FAILURE_FATAL=no</strong></span>
<span class="strong"><strong>IPV6INIT=yes</strong></span>
<span class="strong"><strong>IPV6_AUTOCONF=yes</strong></span>
<span class="strong"><strong>IPV6_DEFROUTE=yes</strong></span>
<span class="strong"><strong>IPV6_FAILURE_FATAL=no</strong></span>
<span class="strong"><strong>NAME=eth0</strong></span>
<span class="strong"><strong>UUID=30420474-a7c9-4ea1-97b2-17f3b3a104cc</strong></span>
<span class="strong"><strong>ONBOOT=yes</strong></span>
<span class="strong"><strong>HWADDR=00:1C:42:1F:E6:BA</strong></span>
<span class="strong"><strong>IPADDR0= XXX.XXX.XXX.XXX</strong></span>
<span class="strong"><strong>PREFIX0= XXX.XXX.XXX.XXX</strong></span>
<span class="strong"><strong>GATEWAY0= XXX.XXX.XXX.XXX</strong></span>
<span class="strong"><strong>DNS1= XXX.XXX.XXX.XXX</strong></span>
<span class="strong"><strong>DNS2= XXX.XXX.XXX.XXX</strong></span>
<span class="strong"><strong>DOMAIN=local</strong></span>
<span class="strong"><strong>IPV6_PEERDNS=yes</strong></span>
<span class="strong"><strong>IPV6_PEERROUTES=yes</strong></span>
</pre></div><p>In this example, it is<a id="id457" class="indexterm"/> important to remember that the DNS entries must be added if the system uses the CentOS Network Manager. Moreover, as<a id="id458" class="indexterm"/> this only shows a single Ethernet interface, if the system in question has multiple NICs, then do make sure that this checklist includes the additional Ethernet configuration files.</p><p>Finally, if you do <a id="id459" class="indexterm"/>make any network changes, run the following command to ensure the new settings take effect:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl restart network</strong></span>
</pre></div><p>Now, where <code class="literal">XXX.XXX.XXX.XXX</code> is the IP address of the nameserver in question, having run through these basic sanity checks, you should be able to perform or reconfirm your system's configuration by running a successful <code class="literal">nslookup</code> request like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># nslookup www.google.com XXX.XXX.XXX.XXX</strong></span>
</pre></div><p>Alternatively, you can use <code class="literal">dig</code> in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># dig www.google.com XXX.XXX.XXX.XXX</strong></span>
</pre></div><p>So, having checked the key components of the system and made sure that the firewall is not blocking any important UDP and TCP traffic, you should be confident that any nonrecursive issues or warnings reported at this stage will (more than likely) be based on a specific configuration issue related to the DNS application itself.</p></div>
<div class="section" title="Monitoring bandwidth with iftop"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec92"/>Monitoring bandwidth with iftop</h1></div></div></div><p>A poorly <a id="id460" class="indexterm"/>configured or troublesome DNS server can result in a variety of issues that includes the failure of application <a id="id461" class="indexterm"/>servers and an overall network slowdown. However, before we dive into the inner workings of DNS, it is important to realize that network slowdowns can be attributed to various causes; and with this in mind, it is often a good idea to refer to a package known as <code class="literal">iftop</code>.</p><p>As discussed in a previous chapter, you will notice that <code class="literal">iftop</code> is similar to the <code class="literal">top</code> command, but unlike the <code class="literal">top</code> command, you will discover that its purpose is to remain specifically interested in measuring the bandwidth of network connections between the host server and an external reference point (IP address).</p><p>To install this <a id="id462" class="indexterm"/>package, you will need the EPEL repository and, after you have enabled this repository by reading the instructions from a previous chapter, <code class="literal">iftop</code> can be installed with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># yum install iftop</strong></span>
</pre></div><p>Running the basic package needs no arguments. In fact, a typical <code class="literal">iftop</code> session can be started with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># iftop</strong></span>
</pre></div><p>Otherwise, on servers with multiple Ethernet interfaces, where <code class="literal">X</code> is the name assigned to your Ethernet interface, you can use the following argument to display the results for a specific device:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># iftop -i ethX</strong></span>
</pre></div><p>By default, <code class="literal">iftop</code> will <a id="id463" class="indexterm"/>attempt to resolve all IP addresses into hostname, but you can avoid this with the <code class="literal">-n</code> option like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># iftop -n -i ethX</strong></span>
</pre></div><p>Moreover, given that the default display is used to show the overall bandwidth between hosts, a useful feature is to swap this display to show the ports that each host is using for communication purposes. To do this, simply use the <span class="emphasis"><em>P</em></span> key during an <code class="literal">iftop</code> session to toggle between displaying all ports and the standard bandwidth readouts.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p><span class="strong"><strong>Other useful keyboard shortcuts include:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use the <span class="emphasis"><em>T</em></span> key to toggle between display types</li><li class="listitem" style="list-style-type: disc">Use the <span class="emphasis"><em>Shift </em></span>+ <span class="emphasis"><em>P</em></span> key to pause a current display</li><li class="listitem" style="list-style-type: disc">Use the <span class="emphasis"><em>J</em></span> and <span class="emphasis"><em>K</em></span> keys to scroll the display</li></ul></div></div></div><p>As the display screen is relatively verbose and self-explanatory, I will not detail the package itself. However, in certain situations, you should be aware that you can use <code class="literal">iftop</code> to investigate the flow of packets across a network range by initializing the appropriate filter like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># iftop -F 192.168.1.0/255.255.255.0 -i eth0</strong></span>
</pre></div><p>You can choose to show the results for a specific port with the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># iftop -i eth0 -f 'port http'</strong></span>
</pre></div><p>Alternatively, rather than displaying the results in bits per second, using the <code class="literal">-B</code> option in the following way the display will now show bandwidth rates in bytes per second:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># iftop -B -F 192.168.1.0/255.255.255.0 -i eth0</strong></span>
</pre></div><p>Remember, the art of troubleshooting is based on the ability to identify the cause as quickly as possible. It is true that network slowdowns can be caused by misconfigured or troublesome DNS issues, but<a id="id464" class="indexterm"/> it is also true to say that DNS can be wrongly accused and that such issues can be the result of bandwidth. So, by using this small, but incredibly useful package, you may have saved yourself a lot of time and effort and made a permanent fix to what was previously assumed to be a DNS issue.</p><p>You can learn more about <code class="literal">iftop</code> by typing:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># man iftop</strong></span>
</pre></div></div>
<div class="section" title="Flushing the cache"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec93"/>Flushing the cache</h1></div></div></div><p>The <a id="id465" class="indexterm"/>Time to Live (TTL) factor can also have a bearing on the issues at hand. In instances where a simple dig request will show that <a id="id466" class="indexterm"/>the nameserver displays a different record to the local DNS, then (beyond waiting for the automated update to take place) a different course of action is to flush the cache.</p><p>In the case of BIND, it is simply a matter of restarting the service like this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl restart named</strong></span>
</pre></div><p>However, without being so drastic, you can also use the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># rndc flush</strong></span>
</pre></div><p>Then run a service status check:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># systemctl status named</strong></span>
</pre></div><p>In this respect, you should now see the following notices:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>received control channel command 'flush'</strong></span>
<span class="strong"><strong>flushing caches in all views succeeded</strong></span>
</pre></div><p>Alternatively, you can target a specific domain with the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># rndc flushname google.com</strong></span>
</pre></div><p>And, having run the <code class="literal">systemctl status named</code> command, you will see the following reports:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>received control channel command 'flushname google.com'</strong></span>
<span class="strong"><strong>flushing name 'google.com' in all cache views succeeded</strong></span>
</pre></div><p>Now, in the case of propagating immediate changes to local desktop clients, you will need to close all running applications, and then follow one of these procedures.</p><p>For Windows users, simply open Command Prompt and use:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># ipconfig /flushdns</strong></span>
</pre></div><p>For Mac OS-X 10.10, open Terminal <a id="id467" class="indexterm"/>and <a id="id468" class="indexterm"/>use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># sudo discoveryutil udnsflushcaches</strong></span>
</pre></div><p>For Mac OS-X 10.5.2 to 10.6, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># dscacheutil -flushcache</strong></span>
</pre></div><p>For older versions of OS-X, use this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># lookupd -flushcache</strong></span>
</pre></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec94"/>Summary</h1></div></div></div><p>The purpose of this chapter was not necessarily to tackle the issues associated with DNS configuration, as there are many books that deal with this subject comprehensively. However, it was engendered to approach the subject of DNS in relation to it being a function of the services available on a network. The consequence of this was to illustrate a few basic techniques associated with the art of troubleshooting an authoritative or caching domain nameserver that may be exhibiting difficulties during the performance of its role.</p><p>So, from changing the hostname to checking the bandwidth, flushing the cache to running some standard sanity checks, you should be aware that troubleshooting is not always about installing and configuring packages. In many respects, very few professional troubleshooters will find themselves building a system from scratch, but they will be asked to fix an apparent issue that, in the context of this book, is typically something more immediate, if not intrinsic to the network environment as a whole.</p></div>
<div class="section" title="References"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec95"/>References</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Red Hat customer portal: <a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/</a></li><li class="listitem" style="list-style-type: disc">The iftop Wikipedia home page: <a class="ulink" href="http://en.wikipedia.org/wiki/Iftop">http://en.wikipedia.org/wiki/Iftop</a></li><li class="listitem" style="list-style-type: disc">The Domain Name System Security Extensions Wikipedia home page: <a class="ulink" href="http://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions">http://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions</a></li><li class="listitem" style="list-style-type: disc">The BIND project home page: <a class="ulink" href="https://www.isc.org/downloads/bind/">https://www.isc.org/downloads/bind/</a></li><li class="listitem" style="list-style-type: disc">The BIND Wikipedia home page: <a class="ulink" href="http://en.wikipedia.org/wiki/BIND">http://en.wikipedia.org/wiki/BIND</a></li><li class="listitem" style="list-style-type: disc">The RHEL customer portal – Chapter 19: <a class="ulink" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/ch-bind.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/ch-bind.html</a></li></ul></div></div></body></html>