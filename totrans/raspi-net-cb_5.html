<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Advanced Networking"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Advanced Networking</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Configuring a static IP address</li><li class="listitem" style="list-style-type: disc">Creating a firewall with <code class="literal">ufw</code></li><li class="listitem" style="list-style-type: disc">Remote access to a desktop session (<code class="literal">xrdp</code>)</li><li class="listitem" style="list-style-type: disc">Remote access to the monitor (<code class="literal">x11vnc</code>)</li><li class="listitem" style="list-style-type: disc">Installing a web server (<code class="literal">apache</code>, <code class="literal">lighttpd</code>, <code class="literal">nginx</code>)</li><li class="listitem" style="list-style-type: disc">Installing a wiki (<code class="literal">mediawiki</code>)</li><li class="listitem" style="list-style-type: disc">Creating a wireless access point with <code class="literal">hostapd</code></li><li class="listitem" style="list-style-type: disc">Installing a network trace utility</li><li class="listitem" style="list-style-type: disc">Installing a network protocol analyzer</li><li class="listitem" style="list-style-type: disc">Enabling the IPv6 network protocol</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec44"/>Introduction</h1></div></div></div><p>The advanced networking recipes in this chapter are not specific to the Raspberry Pi. However, they demonstrate some of the advanced capabilities of the Raspberry Pi.</p><p>The recipes in this chapter should generally work with any Linux computer. The installation instructions, however, are specific to Linux operating systems that are Debian based, like the Raspbian Linux distribution used in this book. </p><p>After completing the recipes in this chapter, you will have configured a static IP address for your Raspberry Pi; learned to protect your Raspberry Pi with a firewall; connected to the Raspberry Pi desktop remotely; installed a web server and a wiki; set up a wireless access point; and analyzed network packets.</p></div></div>
<div class="section" title="Configuring a static IP address"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec45"/>Configuring a static IP address</h1></div></div></div><p>This <a class="indexterm" id="id358"/>recipe configures a Raspberry Pi so that it has a static IP address. </p><p>A static IP address, unlike the dynamic addresses provided by a <span class="strong"><strong>DHCP</strong></span> (<span class="strong"><strong>Dynamic Host Configuration Protocol</strong></span>) server, does not change. Network servers on a wired network connection (for example, web servers, wikis, and wireless access points) generally have static IP <a class="indexterm" id="id359"/>addresses to provide a consistent telephone-number-like reference for use by its network clients (for example, web browsers, mobile phones, and other Internet devices). Servers that have a static IP address are easier to find.</p><p>After completing this recipe, you will be able to configure a static network IP address.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec157"/>Getting ready</h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>This recipe does not require the desktop GUI and could either be run from the text-based console or from within an <code class="literal">LXTerminal</code>.</p><p>If the Raspberry Pi's Secure Shell server is running, this recipe can be completed remotely using a Secure Shell client.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec158"/>How to do it...</h2></div></div></div><p>The steps to configuring a static IP address are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely.</li><li class="listitem">Use the <code class="literal">hostname –I </code>command to display the Raspberry Pi's current IP address.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>hostname -I</strong></span>
192.168.2.13

pi@raspberrypi ~ $</pre></div></li><li class="listitem">Use the output of the <code class="literal">route</code> command filtered through the <code class="literal">awk</code> command to determine the IP address of the default network gateway.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>route -n | awk '/^0/ { print $2 }'</strong></span>
192.168.2.1

pi@raspberrypi ~ $ 

Use the output of the route command filtered through the awk command to determine the network mask for the local network.
pi@raspberrypi ~ $ <span class="strong"><strong>route -n | awk '/^[1-9]/ { print $3 }'</strong></span>
255.255.255.0

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Use the <code class="literal">vi</code> command to edit the network interface configuration file (<code class="literal">/etc/network/interface)</code>. <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/network/interfaces</strong></span></pre></div></li><li class="listitem">The <code class="literal">vi</code> editor <a class="indexterm" id="id360"/>displays the contents of the configuration file. Instructions for using the editor can be found in the <code class="literal">vi</code> manpages (see the recipe <span class="emphasis"><em>Reading the built-in documentation</em></span> in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span>).<div class="informalexample"><pre class="programlisting">auto lo
iface lo inet loopback

auto eth0
allow-hotplug eth0
iface eth0 inet manual

auto wlan0
allow-hotplug wlan0
iface wlan0 inet manual
wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf

auto wlan1
allow-hotplug wlan1
iface wlan1 inet manual
wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf

~ 
~ 
"/etc/network/interfaces" 17 lines, 295 characters</pre></div></li><li class="listitem">Change the word <span class="strong"><strong>manual</strong></span> at the end of the line starting with <code class="literal">iface eth0</code> to <code class="literal">static</code>.<div class="informalexample"><pre class="programlisting">iface eth0 inet <span class="strong"><strong>static</strong></span></pre></div></li><li class="listitem">Add the following lines after the line starting with <code class="literal">iface eth0</code> using the current IP address (<code class="literal">192.168.2.13</code>), the default network gateway (<code class="literal">192.168.2.1</code>), and network mask (<code class="literal">255.255.255.0</code>) from steps 2, 3 and 4:<div class="informalexample"><pre class="programlisting">    address 192.168.2.13
    netmask 255.255.255.0
    gateway 192.168.2.1</pre></div></li><li class="listitem">After editing, the file should look something like this:<div class="informalexample"><pre class="programlisting">auto lo
iface lo inet loopback

auto eth0
allow-hotplug eth0
iface eth0 inet static
    address 192.168.2.13
    netmask 255.255.255.0
    gateway 192.168.2.1

auto wlan0
allow-hotplug wlan0
iface wlan0 inet manual
wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf

auto wlan1
allow-hotplug wlan1
iface wlan1 inet manual
wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf

~ 
~ 
"/etc/network/interfaces" 20 lines, 370 characters</pre></div></li><li class="listitem">Save<a class="indexterm" id="id361"/> the file and exit the editor (<code class="literal">:wq</code>).</li><li class="listitem">Finally, reboot the Raspberry Pi to use the new static IP address!<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo reboot</strong></span>

Broadcast message from root@raspberrypi (pts/0) (Mon Aug 10 23:23:29 2015):
The system is going down for reboot NOW!
pi@raspberrypi ~ $ Connection to 192.168.2.13 closed by remote host.
Connection to 192.168.2.13 closed.</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec159"/>How it works...</h2></div></div></div><p>After logging in to the Raspberry Pi, this recipe first discovers the necessary network configuration parameters needed to configure a static IP address, then it uses those parameters to modify the network interface configuration file.</p><p>The <code class="literal">hostname -I</code> command is used to display the Raspberry Pi's current IP address (<code class="literal">192.168.2.13</code>).</p><p>The output of the <code class="literal">route</code> command, filtered by the <code class="literal">awk</code> command, displays the IP address of the default network gateway (<span class="strong"><strong>192.168.2.1</strong></span>) and the network mask of the local network (<span class="strong"><strong>255.255.255.0</strong></span>). The output of <span class="strong"><strong>route</strong></span> is piped (<span class="strong"><strong>|</strong></span>) through <code class="literal">awk</code> so that <span class="strong"><strong>awk</strong></span> can extract information specific to this recipe and discard the rest.</p><p>Unfiltered, the <code class="literal">route</code>
<span class="strong"><strong> </strong></span>command displays more information than is needed for this recipe.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>route -n</strong></span>
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.2.1     0.0.0.0         UG    202    0        0 eth0
192.168.2.0     0.0.0.0         255.255.255.0   U     202    0        0 eth0

pi@raspberrypi ~ $ </pre></div><p>The <code class="literal">awk</code> command <span class="strong"><strong>'/^0/ { print $2 }'</strong></span> limits its output to those lines beginning with a <code class="literal">0</code> (<span class="strong"><strong>/^0/</strong></span>) and for those limited lines prints the second field (<span class="strong"><strong>$2</strong></span>). The result is the IP address of the default gateway (<span class="strong"><strong>192.168.2.1</strong></span>).</p><p>And the <code class="literal">awk</code> command <span class="strong"><strong>'/^[1-9]/ { print $3 }'</strong></span> limits the output that has been piped (<span class="strong"><strong>|</strong></span>) into it to those lines<a class="indexterm" id="id362"/> beginning with a digit other than zero (<span class="strong"><strong>/^[1-9]/</strong></span>) and for those lines prints the third field (<span class="strong"><strong>$3</strong></span>). The result is the network mask (<span class="strong"><strong>255.255.255.0</strong></span>) for the local network.</p><p>More information about <code class="literal">awk</code> and the <code class="literal">awk</code> command language can be found in the <code class="literal">awk</code> manpages (see the recipe Reading the built-in documentation in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span>).</p><p>After discovering the current IP address, the default gateway, and the network mask, the recipe modifies the network interface configuration file (<code class="literal">/etc/network/interfaces</code>) to include the discovered parameters. </p><p>The wired network interface (<span class="strong"><strong>iface eth0</strong></span>) is set to <span class="strong"><strong>static</strong></span> and the configuration parameters <span class="strong"><strong>address</strong></span>, <span class="strong"><strong>gateway</strong></span>, and <span class="strong"><strong>netmask</strong></span> are added using the parameter values discovered earlier. </p><p>After the configuration file is saved, the Raspberry Pi is rebooted with its new IP address.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec160"/>There's more...</h2></div></div></div><p>In most networks, both at home and at work, (DHCP) servers are used to dynamically assign IP addresses to client computers and devices. Because the DHCP servers are responsible for IP address assignment, they usually need additional configuration to reserve static IP addresses so that they are not accidentally assigned to another client device or computer.</p><p>In order to configure the DHCP server, you will need the hardware address of the Raspberry Pi's wired network interface. The <code class="literal">ifconfig</code> command can be used to display a lot of useful network information. This combination of <code class="literal">ifconfig</code> and an <code class="literal">awk</code> filter can be used to display just the hardware address of the network interface.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>ifconfig | awk '/^eth0/ { print $5 }'</strong></span>
b8:27:eb:3f:aa:0c

pi@raspberrypi ~ $ </pre></div><div class="mediaobject"><img alt="There's more..." src="graphics/B04745_05_01.jpg"/></div><p>In the<a class="indexterm" id="id363"/> preceding screenshot, a local home network gateway is being configured, setting the <span class="strong"><strong>Reserved IP Address</strong></span> to <span class="strong"><strong>192.168.2.13</strong></span> for the exclusive use of the <span class="strong"><strong>raspberry-pi</strong></span> computer. </p><p>The <span class="strong"><strong>MAC Address</strong></span> (<span class="strong"><strong>b8:27:eb:3f:aa:0c</strong></span>) is the unique number assigned to this specific Raspberry Pi's network interface.</p><p>After this configuration is saved, the IP address <span class="strong"><strong>192.168.2.13</strong></span> will be reserved for the exclusive use of the <span class="strong"><strong>raspberry-pi</strong></span> computer.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec161"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Dynamic Host Configuration Protocol</strong></span> (<a class="ulink" href="http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol</a>): This Wikipedia article <a class="indexterm" id="id364"/>describes the DHCP protocol, its history, and how it works.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>hostname – show or set the system's hostname</strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=hostname">http://manpages.debian.net/cgi-bin/man.cgi?query=hostname</a>): The Debian manpage for <code class="literal">hostname</code> describes <a class="indexterm" id="id365"/>the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>route – show/manipulate the IP routing table</strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=route">http://manpages.debian.net/cgi-bin/man.cgi?query=route</a>): The Debian manpage for <code class="literal">route</code> describes the <a class="indexterm" id="id366"/>command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ifconfig – configure network interfaces </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=ifconfig">http://manpages.debian.net/cgi-bin/man.cgi?query=ifconfig</a>): The Debian manpage for <code class="literal">ifconfig</code> describes<a class="indexterm" id="id367"/> the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>interfaces – network interface configuration for ifup and ifdown</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=interfaces">http://manpages.debian.net/cgi-bin/man.cgi?query=interfaces</a>): The Debian manpage for <code class="literal">interfaces</code> describes<a class="indexterm" id="id368"/> the configuration<a class="indexterm" id="id369"/> file and its parameters.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>awk – pattern-directed scanning and processing language</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=awk">http://manpages.debian.net/cgi-bin/man.cgi?query=awk</a>): The Debian<a class="indexterm" id="id370"/> manpage for <code class="literal">awk</code> describes the command and the <code class="literal">awk</code> command language.</li></ul></div></div></div>
<div class="section" title="Creating a firewall with ufw"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Creating a firewall with ufw</h1></div></div></div><p>This <a class="indexterm" id="id371"/>recipe uses a simple, yet powerful command-line tool (<code class="literal">ufw</code>) to configure a firewall. </p><p>This<a class="indexterm" id="id372"/> recipe can be used to completely block network access to the Raspberry Pi. It can also be used to configure the Uncomplicated Firewall (<code class="literal">ufw</code>) to allow access through the firewall to specific applications (for example, web servers). </p><p>After completing this recipe, you will be able to protect network access to your Raspberry Pi using a firewall.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec162"/>Getting ready </h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>This recipe does not require the desktop GUI and could either be run from the text-based console or from within an <code class="literal">LXTerminal</code>.</p><p>If the Raspberry Pi's Secure Shell server is running, this recipe can be completed remotely using a Secure Shell client.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec163"/>How to do it...</h2></div></div></div><p>The steps<a class="indexterm" id="id373"/> for creating a firewall with <code class="literal">ufw</code> are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log<a class="indexterm" id="id374"/> in to the Raspberry Pi either directly or remotely.</li><li class="listitem">Use the <code class="literal">apt-get install</code> command to install the <code class="literal">ufw</code> software package.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install ufw</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  ufw
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 166 kB of archives.
After this operation, 708 kB of additional disk space will be used.
Get:1 http://mirrordirector.raspbian.org/raspbian/ wheezy/main ufw all 0.31.1-2 [166 kB]
Fetched 166 kB in 2s (65.6 kB/s)
Preconfiguring packages ...
Selecting previously unselected package ufw.
(Reading database ... 83839 files and directories currently installed.)
Unpacking ufw (from .../archives/ufw_0.31.1-2_all.deb) ...
Processing triggers for man-db ...
Setting up ufw (0.31.1-2) ...

Creating config file /etc/ufw/before.rules with new version

Creating config file /etc/ufw/before6.rules with new version

Creating config file /etc/ufw/after.rules with new version

Creating config file /etc/ufw/after6.rules with new version

pi@raspberrypi ~ $</pre></div></li><li class="listitem">The <code class="literal">apt-get install</code> command downloads and installs <code class="literal">ufw</code>. The installation of <code class="literal">ufw</code> includes a default set of firewall rules.</li><li class="listitem">Use the <code class="literal">ufw allow</code> command to add the <code class="literal">ssh</code> protocol to the list of allowed protocols in the firewall rules.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw allow ssh</strong></span>
Rules updated

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Use the <code class="literal">ufw enable</code> command to turn on the firewall.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw enable</strong></span>
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The firewall rules are enabled immediately and also on startup!</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec164"/>How it works...</h2></div></div></div><p>After logging in to the Raspberry Pi, this recipe uses the <code class="literal">apt-get install</code> command to download and install the Uncomplicated Firewall (<span class="strong"><strong>ufw</strong></span>). </p><p>Then, a firewall rule is defined to permit remote access to the Raspberry Pi using the Secure Shell (<code class="literal">ssh</code>) protocol (<code class="literal">ufw allow ssh</code>). </p><p>Finally, the firewall is turned on (<code class="literal">ufw enable</code>).</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec165"/>There's more...</h2></div></div></div><p>The <a class="indexterm" id="id375"/>Uncomplicated Firewall (<code class="literal">ufw</code>) is a command-line tool for <a class="indexterm" id="id376"/>defining firewall rules. The <code class="literal">ufw</code> command is not actually a firewall. There is no extra firewall server installed. The Linux kernel can be used as a firewall.</p><p>The <code class="literal">ufw</code> command is just used to configure firewall rules. The rule definitions are stored in the <code class="literal">/etc/ufw</code> directory; however, those definition files should not be modified directly. Modifying those files correctly is the purpose of the <code class="literal">ufw</code> command.</p><div class="section" title="Don't forget to enable remote access"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec40"/>Don't forget to enable remote access</h3></div></div></div><p>In the <a class="indexterm" id="id377"/>preceding recipe, after the <code class="literal">ufw</code> command is installed and before the firewall is enabled, a new firewall rule, allow SSH access (<code class="literal">ufw</code>) <code class="literal">allow ssh</code>, is added to the rule definitions. Without this rule, the next attempt to connect remotely via <code class="literal">ssh</code> would fail.</p><div class="informalexample"><pre class="programlisting">golden-imac:~ golden$ <span class="strong"><strong>ssh pi@192.168.2.13</strong></span>
ssh: connect to host 192.168.2.13 port 22: Operation timed out

golden-imac:~ golden$ </pre></div><p>In this example, the <code class="literal">ssh</code> command fails because there is no firewall rule permitting Secure Shell access to the Raspberry Pi.</p></div><div class="section" title="Disabling the firewall"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec41"/>Disabling the firewall</h3></div></div></div><p>The <a class="indexterm" id="id378"/>firewall rules defined using <code class="literal">ufw</code> will not prevent a user from logging in locally using a keyboard and display connected directly to the Raspberry Pi. </p><p>If <code class="literal">ufw</code> is preventing remote access, log in directly to the Raspberry Pi and then use the command: <code class="literal">ufw disable</code> to disable the firewall rules.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw disable</strong></span>
Firewall stopped and disabled on system startup

pi@raspberrypi ~ $ </pre></div></div><div class="section" title="Allowing a file server through the firewall"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec42"/>Allowing a file server through the firewall</h3></div></div></div><p>If the <a class="indexterm" id="id379"/>Raspberry Pi has been set up as a file server (see <a class="link" href="ch04.html" title="Chapter 4. File Sharing">Chapter 4</a>, <span class="emphasis"><em>File Sharing</em></span>), use the firewall rule <code class="literal">ufw allow cifs </code>to allow the SMB (CIFS) protocol through the firewall.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw allow cifs</strong></span>
Rules updated

pi@raspberrypi ~ $ </pre></div></div><div class="section" title="Allowing a web server through the firewall"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec43"/>Allowing a web server through the firewall</h3></div></div></div><p>Similarly, if<a class="indexterm" id="id380"/> the Raspberry Pi has been set up as a local web server (see the next recipe in this chapter), use the firewall rule <code class="literal">ufw allow http </code>to allow the HTTP protocol through the firewall.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw allow http</strong></span>
Rules updated

pi@raspberrypi ~ $ </pre></div></div><div class="section" title="Application rules"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec44"/>Application rules</h3></div></div></div><p>The<a class="indexterm" id="id381"/> Uncomplicated Firewall has predefined rules for a number of application protocols, in addition to network protocols. The applications currently recognized by <code class="literal">ufw</code> can be displayed with the command <code class="literal">ufw app list</code>.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw app list</strong></span>
Available applications:
  AIM
  Bonjour
  CIFS
  DNS
  Deluge
  IMAP
  IMAPS
  IPP
  KTorrent
  Kerberos Admin
  Kerberos Full
  Kerberos KDC
  Kerberos Password
  LDAP
  LPD
  MSN
  MSN SSL
  Mail submission
  NFS
  OpenSSH
  POP3
  POP3S
  PeopleNearby
  SMTP
  SSH
  Socks
  Telnet
  Transmission
  Transparent Proxy
  VNC
  WWW
  WWW Cache
  WWW Full
  WWW Secure
  XMPP
  Yahoo
  qBittorent
  svnserve
pi@raspberrypi ~ $ </pre></div><p>Enable all<a class="indexterm" id="id382"/> the defined network connections for one of the preceding applications using the command <code class="literal">ufw allow</code> and disable them using the command <code class="literal">ufw deny</code>. </p><p>The <code class="literal">ufw app info</code> command will display the application's configuration.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw app info "WWW Full"</strong></span>
Profile: WWW Full
Title: Web Server (HTTP,HTTPS)
Description: Web Server (HTTP,HTTPS)

Ports:
  80,443/tcp

pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw allow "WWW Full"</strong></span>
Rule added

pi@raspberrypi ~ $ </pre></div><p>The preceding example shows that the application configuration for <span class="strong"><strong>"WWW Full"</strong></span> includes both the <span class="strong"><strong>HTTP</strong></span> port (<span class="strong"><strong>80</strong></span>) and the <span class="strong"><strong>HTTPS</strong></span> port (<span class="strong"><strong>443</strong></span>). By using the <span class="strong"><strong>"WWW Full"</strong></span> application profile, network access to both web server ports can be allowed (denied or rejected) using a single firewall rule.</p></div><div class="section" title="Resetting the firewall rules"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec45"/>Resetting the firewall rules</h3></div></div></div><p>By <a class="indexterm" id="id383"/>default, the <code class="literal">ufw</code> rules deny all network access to the Raspberry Pi. However, also by default, the firewall rules are not enabled. </p><p>Use the command <code class="literal">ufw reset</code> to return the firewall rules to their defaults – no remote access at all with the firewall disabled. </p><p>After resetting the default rules, the firewall can then be re-enabled with the command <code class="literal">ufw enable</code>.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec166"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Uncomplicated Firewall (ufw) </strong></span>(<a class="ulink" href="http://en.wikipedia.org/wiki/Uncomplicated_Firewall">http://en.wikipedia.org/wiki/Uncomplicated_Firewall</a>): This Wikipedia<a class="indexterm" id="id384"/> article about the Uncomplicated Firewall explains how it works.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ufw – program for managing a netfilter firewall</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=ufw">http://manpages.debian.net/cgi-bin/man.cgi?query=ufw</a>): The Debian<a class="indexterm" id="id385"/> manpage for <code class="literal">ufw</code> describes the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iptables – administration tool for IPv4 packet filtering and NAT</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=iptables">http://manpages.debian.net/cgi-bin/man.cgi?query=iptables</a>): The Debian manpage for <code class="literal">iptables</code> describes<a class="indexterm" id="id386"/> in more detail how to configure the Linux kernel's built-in firewall.</li></ul></div></div></div>
<div class="section" title="Remote access to a desktop session (xrdp)"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec47"/>Remote access to a desktop session (xrdp)</h1></div></div></div><p>This<a class="indexterm" id="id387"/> recipe enables remote access to a Raspberry Pi desktop session using <code class="literal">xrdp</code>. </p><p>Using<code class="literal"> xrdp</code>, teachers, support engineers, and hobbyists can create a new desktop session on the Raspberry Pi remotely from another computer. The newly created desktop session is separate from the desktop session currently displayed on the monitor attached to the Raspberry Pi. This private session is perfect for installing updates or performing other background tasks that should not interrupt the desktop session currently displayed on the Raspberry Pi's monitor.</p><p>After completing this recipe, you will be able to use <code class="literal">xrdp</code> to create a new remote desktop session on the Raspberry Pi.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec167"/>Getting ready </h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>Running this application requires the desktop GUI. Use <code class="literal">raspi-config</code> to configure the Raspberry Pi to automatically boot with the desktop GUI (see Chapter 2, <span class="emphasis"><em>Administration</em></span>).</p><p>The installation portion of this recipe does not require the desktop and can be run from the text-based console (or from within an LXTerminal). </p><p>If the Raspberry Pi's Secure Shell server is running, this recipe can be completed remotely using a Secure Shell client.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec168"/>How to do it...</h2></div></div></div><p>The steps for connecting to the Raspberry Pi desktop remotely are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely. If you<a class="indexterm" id="id388"/> are using the Raspberry Pi desktop, open an LXTerminal window.</li><li class="listitem">Use the <code class="literal">apt-get install</code> command to install the <code class="literal">xrdp</code> software package.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y xrdp</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following extra packages will be installed:
  tightvncserver xfonts-base
Suggested packages:
  tightvnc-java
The following NEW packages will be installed:
  tightvncserver xfonts-base xrdp
0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.
Need to get 7,219 kB of archives.
After this operation, 11.5 MB of additional disk space will be used.
Get:1 http://mirrordirector.raspbian.org/raspbian/ wheezy/main tightvncserver armhf 1.3.9-6.4 [786 kB]
Get:2 http://mirrordirector.raspbian.org/raspbian/ wheezy/main xfonts-base all 1:1.0.3 [6,181 kB]
Get:3 http://mirrordirector.raspbian.org/raspbian/ wheezy/main xrdp armhf 0.5.0-2 [252 kB]
Fetched 7,219 kB in 3s (2,000 kB/s)
Selecting previously unselected package tightvncserver.
(Reading database ... 83956 files and directories currently installed.)
Unpacking tightvncserver (from .../tightvncserver_1.3.9-6.4_armhf.deb) ...
Selecting previously unselected package xfonts-base.
Unpacking xfonts-base (from .../xfonts-base_1%3a1.0.3_all.deb) ...
Selecting previously unselected package xrdp.
Unpacking xrdp (from .../xrdp_0.5.0-2_armhf.deb) ...
Processing triggers for man-db ...
Processing triggers for fontconfig ...
Setting up tightvncserver (1.3.9-6.4) ...
update-alternatives: using /usr/bin/tightvncserver to provide /usr/bin/vncserver (vncserver) in auto mode
update-alternatives: using /usr/bin/Xtightvnc to provide /usr/bin/Xvnc (Xvnc) in auto mode
update-alternatives: using /usr/bin/tightvncpasswd to provide /usr/bin/vncpasswd (vncpasswd) in auto mode
Setting up xfonts-base (1:1.0.3) ...
Setting up xrdp (0.5.0-2) ...
[....] Generating xrdp RSA keys......
Generating 512 bit rsa key...

ssl_gen_key_xrdp1 ok

saving to /etc/xrdp/rsakeys.ini

done (done).
[ ok ] Starting Remote Desktop Protocol server : xrdp sesman.

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The <code class="literal">apt-get install</code> command downloads and installs <code class="literal">xrdp</code>.Installation of the software package includes starting the <code class="literal">xrdp</code> service.</li><li class="listitem">Use a <span class="strong"><strong>RDP</strong></span> (<span class="strong"><strong>Remote Desktop Protocol</strong></span>) client (such as Microsoft's Remote Desktop Connection) to connect to the <a class="indexterm" id="id389"/>Raspberry Pi using its IP address (<span class="strong"><strong>192.168.2.13</strong></span>).<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_02.jpg"/></div><p>The <a class="indexterm" id="id390"/>preceding screenshot shows how to connect to the Raspberry Pi using Microsoft's Remote Desktop Connection for Mac.</p></li><li class="listitem">Once connected, the <code class="literal">xrdp</code> session manager (<code class="literal">sesman</code>) displays a login screen.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_03.jpg"/></div><p>The preceding image shows how to start a remote desktop session with the Raspberry Pi using <code class="literal">xrdp</code>.</p></li><li class="listitem">Log in to the <code class="literal">xrdp</code> session: Choose <code class="literal">sesman-Xvnc</code> as the Module. Use the same username (<code class="literal">pi</code>) and password (<code class="literal">raspberry</code>) that you use to log in via the console (or via ssh).</li><li class="listitem">After a successful login, the Raspberry Pi desktop is displayed.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_04.jpg"/></div><p>The<a class="indexterm" id="id391"/> preceding screenshot shows a remote connection to the Raspberry Pi desktop via an RDP connection (client resolution was set to 640x480).</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec169"/>How it works...</h2></div></div></div><p>After logging in to the Raspberry Pi, the <code class="literal">xrdb</code> software package is downloaded and installed using <code class="literal">apt-get install</code>. The installation includes starting <code class="literal">xrdb</code> and the desktop session manager (<code class="literal">sesman</code>). </p><p>After <code class="literal">sesman</code> has started, a remote session to the Raspberry Pi can be created from another computer that has an RDP client installed. </p><p>The example in the recipe uses Microsoft's Remote Desktop Connection for Mac. The Microsoft RDP client prompts for the <span class="strong"><strong>Computer</strong></span>. Enter the Raspberry Pi's IP address (<span class="strong"><strong>192.168.2.13</strong></span>) to create a remote connection.</p><p>After the remote connection is made, an RDP session is created (<span class="strong"><strong>Login to xrdp</strong></span>) by logging in to <code class="literal">xrdp</code> with the same username and password that is used to log in directly to the Raspberry Pi via <code class="literal">ssh</code> or directly via the GUI desktop.</p><p>Once the<a class="indexterm" id="id392"/> username and password have been entered correctly, a new desktop session is created. This new desktop session is not the same as the session running on the monitor connected directly to the Raspberry Pi. It is a new desktop session.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec170"/>There's more...</h2></div></div></div><p>The Remote Desktop Protocol (RDP) is a client-server protocol developed by Microsoft. The <code class="literal">xrdp</code> client is used to display the graphical user interface sent by an RDP server. The Microsoft RDP client (<code class="literal">mstsc.exe</code>) is included in every Windows version since XP.</p><p>The <code class="literal">xrdp</code> software package also includes the TightVNC server (<code class="literal">tightvncsever</code>) that communicates via the <span class="strong"><strong>Virtual Network Computing</strong></span> (<span class="strong"><strong>VNC</strong></span>) protocol – another graphical desktop <a class="indexterm" id="id393"/>sharing protocol. A number of open source and proprietary clients exist for both the RDP and VNC remote desktop protocols, including clients for mobile devices and tablet PCs.</p><p>The remote desktop connection displays the Raspberry Pi desktop in much the same way, as the desktop would be seen, if the Raspberry Pi were connected directly to a display. There are some exceptions. </p><div class="section" title="No streaming video (or Minecraft)"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec46"/>No streaming video (or Minecraft)</h3></div></div></div><p>The <a class="indexterm" id="id394"/>most noticeable limitation that a remote display has is not being able to display streaming video. Most video streaming applications stream directly to the video frame buffer, the part of memory that is shared with the display. So, the video is streamed directly to the display and bypasses the desktop. Because the video bypasses the desktop, it is also not sent to the remote desktop.</p><p>The Minecraft game for the Raspberry Pi also accesses the video frame buffer directly. So, like video streaming, Minecraft cannot be played through a remote desktop session.</p></div><div class="section" title="It's not the display"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec47"/>It's not the display</h3></div></div></div><p>Each<a class="indexterm" id="id395"/> remote desktop session is a separate desktop session. It is not the same desktop session that is displayed on the monitor directly connected to the Raspberry Pi. </p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec171"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Remote Desktop Protocol</strong></span> (<a class="ulink" href="http://en.wikipedia.org/wiki/Remote_Desktop_Protocol">http://en.wikipedia.org/wiki/Remote_Desktop_Protocol</a>): This Wikipedia<a class="indexterm" id="id396"/> article describes the Remote Desktop Protocol (RDP).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Comparison of remote desktop software </strong></span>(<a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_remote_desktop_software">http://en.wikipedia.org/wiki/Comparison_of_remote_desktop_software</a>): This <a class="indexterm" id="id397"/>Wikipedia article compares remote desktop software.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>xrdp – a Remote Desktop Protocol (RDP) server </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=xrdp">http://manpages.debian.net/cgi-bin/man.cgi?query=xrdp</a>): The Debian <a class="indexterm" id="id398"/>manpage for <code class="literal">xrdp</code> has more details about the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>sesman – an xrdp(8) session manager </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=sesman">http://manpages.debian.net/cgi-bin/man.cgi?query=sesman</a>): The Debian <a class="indexterm" id="id399"/>manpage for <code class="literal">sesman</code> has more details about the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>xrdp – an open source remote desktop protocol (rdp) server</strong></span> (<a class="ulink" href="http://www.xrdp.org/">http://www.xrdp.org/</a>): The <a class="indexterm" id="id400"/>xrdp website has more details about this RDP server.</li></ul></div></div></div>
<div class="section" title="Remote access to the monitor (x11vnc)"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec48"/>Remote access to the monitor (x11vnc)</h1></div></div></div><p>This<a class="indexterm" id="id401"/> recipe enables remote access to the Raspberry Pi's monitor using <code class="literal">xrdp</code>. </p><p>Using<code class="literal"> x11vnc</code>, teachers, support engineers, and hobbyists can access the desktop session currently displayed on the monitor attached to the Raspberry Pi. Teachers can use the remote desktop access to help students complete an assignment. Remote support engineers can help a Raspberry Pi user debug, install, or configure software. And, hobbyists can use <code class="literal">xrdp</code> to access the Raspberry Pi attached to the living room TV from another room.</p><p>After completing this recipe, you will be able to use <code class="literal">xrdp</code> to remotely access the desktop session currently displayed on the Raspberry Pi's monitor.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec172"/>Getting ready </h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>Running this application requires the desktop GUI. Use <code class="literal">raspi-config</code> to configure the Raspberry Pi to automatically boot with the desktop GUI (see <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span>).</p><p>The <a class="indexterm" id="id402"/>installation portion of this recipe does not require the desktop and can be run from the text-based console (or from within an LXTerminal). </p><p>If the Raspberry Pi's Secure Shell server is running, the installation portion of this recipe can also be completed remotely using a Secure Shell client (see <code class="literal">ssh</code> recipe in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span>).</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec173"/>How to do it...</h2></div></div></div><p>The steps for connecting to the Raspberry Pi desktop remotely are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely. If you are using the Raspberry Pi desktop, open an LXTerminal.</li><li class="listitem">Use the <code class="literal">apt-get install</code> command to install the <code class="literal">x11vnc</code> package.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y x11vnc</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following extra packages will be installed:
  libvncserver0 tcl tk x11vnc-data
Suggested packages:
  libvncserver0-dbg
The following NEW packages will be installed:
  libvncserver0 tcl tk x11vnc x11vnc-data
0 upgraded, 5 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/1,841 kB of archives.
After this operation, 3,192 kB of additional disk space will be used.
Selecting previously unselected package libvncserver0:armhf.
(Reading database ... 84404 files and directories currently installed.)
Unpacking libvncserver0:armhf (from .../libvncserver0_0.9.9+dfsg-1+deb7u1_armhf.deb) ...
Selecting previously unselected package tcl.
Unpacking tcl (from .../archives/tcl_8.5.0-2.1_all.deb) ...
Selecting previously unselected package tk.
Unpacking tk (from .../archives/tk_8.5.0-2.1_all.deb) ...
Selecting previously unselected package x11vnc-data.
Unpacking x11vnc-data (from .../x11vnc-data_0.9.13-1_all.deb) ...
Selecting previously unselected package x11vnc.
Unpacking x11vnc (from .../x11vnc_0.9.13-1_armhf.deb) ...
Processing triggers for man-db ...
Processing triggers for desktop-file-utils ...
Setting up libvncserver0:armhf (0.9.9+dfsg-1+deb7u1) ...
Setting up tcl (8.5.0-2.1) ...
update-alternatives: using /usr/bin/tclsh-default to provide /usr/bin/tclsh (tclsh) in auto mode
Setting up tk (8.5.0-2.1) ...
update-alternatives: using /usr/bin/wish-default to provide /usr/bin/wish (wish) in auto mode
Setting up x11vnc-data (0.9.13-1) ...
Setting up x11vnc (0.9.13-1) ...

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The <code class="literal">apt-get install</code> command downloads and installs <code class="literal">x11vnc</code>.</li><li class="listitem">From a remote computer, use a Secure Shell tunnel (<code class="literal">ssh</code>) to start an instance of <code class="literal">x11vnc</code> running on the Raspberry Pi. It will continue to run while the connection is open.<div class="informalexample"><pre class="programlisting">golden-macbook:~ A601012$ <span class="strong"><strong>ssh -t -L 5900:localhost:5900 pi@192.168.2.13 
'x11vnc -q -localhost -display :0 -passwd pass1234'</strong></span>

pi@192.168.2.13's password: 
The VNC desktop is: localhost:0
PORT=5900</pre></div></li><li class="listitem">Use <a class="indexterm" id="id403"/>a VNC<span class="strong"><strong> </strong></span>client (such as TightVNC) to connect to the remote Raspberry Pi from the local machine (<span class="strong"><strong>127.0.0.1</strong></span>) using the ssh tunnel.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_05.jpg"/></div><p>The preceding screenshot shows how to connect to the Raspberry Pi using TightVNC. The <span class="strong"><strong>Remote Host</strong></span> is actually the local host (<span class="strong"><strong>127.0.0.1</strong></span>) because of the <code class="literal">ssh</code> tunnel. The <span class="strong"><strong>Port</strong></span> is the default VNC port (<span class="strong"><strong>5900</strong></span>).</p><div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_06.jpg"/></div><p>In the <a class="indexterm" id="id404"/>preceding screenshot, the TightVNC client asks for the user to enter the authentication password. Enter the password that was specified in the previous step (<span class="strong"><strong>pass1234</strong></span>).</p></li><li class="listitem">Once connected, TightVNC displays what is on the monitor.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_07.jpg"/></div><p>The preceding screenshot shows a remote connection to the Raspberry Pi desktop via a TightVNC client (client resolution is at 50 percent).</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec174"/>How it works...</h2></div></div></div><p>After logging in to the Raspberry Pi, the <code class="literal">apt-get install</code> command is used to download and install the <code class="literal">x11vnc</code> software package. </p><p>After installation is complete, the <code class="literal">x11vnc</code> server is started from a remote machine using a Secure Shell tunnel (ssh). </p><p>The ssh<a class="indexterm" id="id405"/> tunnel starts the <code class="literal">x11vnc</code> server and forwards the VNC connection on the remote Raspberry Pi to the same port on the local host (<span class="strong"><strong>-L 5900:localhost:5900</strong></span>). </p><p>The <code class="literal">x11vnc</code> server is started quietly (<span class="strong"><strong>-q</strong></span>) using the desktop session that is displayed on the monitor (<span class="strong"><strong>-display :0</strong></span>). The server only allows local connections (<span class="strong"><strong>-localhost</strong></span>). The authentication password is set (<span class="strong"><strong>-passwd pass1234</strong></span>).</p><p>The <code class="literal">x11vnc</code> server remains running so long as there is a client connection.</p><p>The recipe then uses the TightVNC Java client to connect to the Raspberry Pi. The TightVNC client prompts for the <span class="strong"><strong>Remote Host</strong></span> and <span class="strong"><strong>Port</strong></span>. Because the recipe is using an ssh tunnel, the IP address of the local host (<span class="strong"><strong>127.0.0.1</strong></span>) is entered to use the ssh tunnel.</p><p>Before the Raspberry Pi desktop is displayed, the VNC client requests the <span class="strong"><strong>VNC Authentication</strong></span> password that was specified when starting the server (<span class="strong"><strong>pass1234</strong></span>).</p><p>Once the password has been entered correctly, the VNC client also displays the desktop session displayed on the Raspberry Pi's monitor. </p><p>So long as the remote desktop session is connected, the <code class="literal">x11vnc</code> server continues to run. As soon as the remote connection is closed, the <code class="literal">x11vnc</code> server quits.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec175"/>There's more...</h2></div></div></div><p>The VNC client displays the same desktop session that is being displayed on the Raspberry Pi's monitor. However, there are some exceptions. </p><div class="section" title="No streaming video (or Minecraft)"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec48"/>No streaming video (or Minecraft)</h3></div></div></div><p>Applications<a class="indexterm" id="id406"/> that write directly to the video frame buffer (for example, video streaming and Minecraft) are still not displayed over VNC (see the previous recipe for more info).</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec176"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Virtual Network Computing</strong></span> (<a class="ulink" href="http://en.wikipedia.org/wiki/Vnc">http://en.wikipedia.org/wiki/Vnc</a>): This Wikipedia article about Virtual <a class="indexterm" id="id407"/>Network Computing (VNC) describes the history and capabilities of the VNC protocol.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>x11vnc</strong></span> (<a class="ulink" href="https://en.wikipedia.org/wiki/X11vnc">https://en.wikipedia.org/wiki/X11vnc</a>): This Wikipedia article <a class="indexterm" id="id408"/>about x11vnc describes its use and configuration.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>x11vnc – </strong></span>allow<a class="indexterm" id="id409"/> VNC connections to real X11 displays (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=x11vnc">http://manpages.debian.net/cgi-bin/man.cgi?query=x11vnc</a>): The Debian manpage for <code class="literal">x11nvc</code> describes the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>TightVNC Software </strong></span>(<a class="ulink" href="http://tightvnc.com/">http://tightvnc.com/</a>): The TightVNC Software website<a class="indexterm" id="id410"/> has instructions on how to download and install a client.</li></ul></div></div></div>
<div class="section" title="Installing a web server (Apache, lighttpd, Nginx)"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec49"/>Installing a web server (Apache, lighttpd, Nginx)</h1></div></div></div><p>This <a class="indexterm" id="id411"/>recipe installs the Apache HTTP web server. Installation differences for the lighttpd and Nginx web servers are found at the end of this recipe.</p><p>The Apache web server is one of the most commonly used web servers on GNU Linux platforms like the Raspbian Linux distribution used by the Raspberry Pi. Apache is a mature, extensible web server that can be used to host a variety of applications; proxy access to websites internal and external; as well as host static web pages and images.</p><p>After completing this recipe, the Raspberry Pi will able to serve static and dynamic web pages from the SD card boot disk and from an external disk.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec177"/>Getting ready </h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>This recipe does not require the desktop GUI and could either be run from the text-based console or from within an <code class="literal">LXTerminal</code>.</p><p>If the Raspberry Pi's Secure Shell server is running, this recipe can be completed remotely using a Secure Shell client.</p><p>The examples in this recipe also use an external hard disk mounted at <code class="literal">/media/bigdisk</code> (see <a class="link" href="ch04.html" title="Chapter 4. File Sharing">Chapter 4</a>, <span class="emphasis"><em>File Sharing</em></span> for more information).</p><p>The steps for installing the Apache web server are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely.</li><li class="listitem">Use the <code class="literal">apt-get install</code> command to download and install the Apache HTTP web server (<code class="literal">apache2</code>). <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y apache2</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following extra packages will be installed:
  apache2-mpm-worker apache2-utils apache2.2-bin apache2.2-common libapr1
  libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap ssl-cert

...

Setting up apache2.2-common (2.2.22-13+deb7u5) ...
Enabling site default.
Enabling module alias.
Enabling module autoindex.
Enabling module dir.
Enabling module env.
Enabling module mime.
Enabling module negotiation.
Enabling module setenvif.
Enabling module status.
Enabling module auth_basic.
Enabling module deflate.
Enabling module authz_default.
Enabling module authz_user.
Enabling module authz_groupfile.
Enabling module authn_file.
Enabling module authz_host.
Enabling module reqtimeout.
Setting up apache2-mpm-worker (2.2.22-13+deb7u5) ...
[....] Starting web server: apache2apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1 for ServerName
. ok 
Setting up apache2 (2.2.22-13+deb7u5) ...
Setting up ssl-cert (1.0.32) ...

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The <code class="literal">apt-get install </code>command downloads and installs <code class="literal">apache2</code>.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>If <a class="indexterm" id="id412"/>the <code class="literal">ufw</code> firewall has been installed (see the preceding <span class="emphasis"><em>Creating a firewall</em></span> recipe), use the<code class="literal"> ufw allow http</code> command to create a rule that allows the HTTP (web server) protocol through the firewall.</p></div></div><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ufw allow http</strong></span>
Rules updated

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Use the web browser on another computer (or device) to test the HTTP connection to the Raspberry Pi. <div class="mediaobject"><img alt="Getting ready" src="graphics/B04745_05_08.jpg"/></div><p>In the <a class="indexterm" id="id413"/>preceding image, a web browser on another computer is used to access the default web page of the Apache web server running on the Raspberry Pi. The web server works!</p></li><li class="listitem">Use the command <code class="literal">ls –l </code>to list the contents of the web server's root directory,<code class="literal"> /var/www</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>ls -l /var/www</strong></span>
total 4
-rw-r--r-- 1 root root 177 Aug 12 20:11 index.html

pi@raspberrypi ~ $ </pre></div><p>There is one file in the web server's root directory, <span class="strong"><strong>index.html</strong></span>.</p></li><li class="listitem">Use the command <code class="literal">ls –l </code>to list the contents of a website stored on an external disk,<code class="literal"> /media/bigdisk/MyWebsite/</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>ls -l /media/bigdisk/MyWebsite/</strong></span>
total 4
-rw-r--r-- 1 root root 92 Aug 11 20:13 hello.html

pi@raspberrypi ~ $ </pre></div><p>There is one file in the directory on the external disk, <code class="literal">hello.html</code>.</p></li><li class="listitem">Use the command <code class="literal">ln –s</code> to create a symbolic link from the external disk directory (<code class="literal">/media/bigdisk/MyWebsite</code>) to the web server's root directory (<code class="literal">/var/www/</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>ln –s /media/bigdisk/MyWebsite /var/www/MyWebsite</strong></span>

pi@raspberrypi ~ $ <span class="strong"><strong>ls –l /var/www</strong></span>
total 4
-rw-r--r-- 1 root root 177 Aug 12 20:11 index.html
-rw-r--r-- 1 root root  24 Aug 12 20:48 MyWebsite -&gt; /media/bigdisk/MyWebsite

pi@raspberrypi ~ $ <span class="strong"><strong>ls –l /var/www/MyWebiste/</strong></span>
total 4
-rw-r--r-- 1 root root 92 Aug 11 20:13 hello.html

pi@raspberrypi ~ $</pre></div><p>The web<a class="indexterm" id="id414"/> server's root directory <code class="literal">(/var/www</code>) now has a symbolic link to the website stored on the external disk <code class="literal">(/media/bigdisk/MyWebsite</code>).</p></li><li class="listitem">Use the web browser on another computer (or device) to test the HTTP connection to the Raspberry Pi. The website on the external disk is now accessible!<div class="mediaobject"><img alt="Getting ready" src="graphics/B04745_05_09.jpg"/></div><p>The preceding image shows how a web browser on another computer is used to access a web page stored on an external disk attached to the Raspberry Pi.</p></li><li class="listitem">Use the <code class="literal">vi</code> command to create a dynamic web page (<code class="literal">timestamp</code>) in the <code class="literal">/usr/lib/cgi-bin</code> directory.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /usr/lib/cgi-bin/timestamp</strong></span></pre></div></li><li class="listitem">Add the following lines to the new dynamic web page: <div class="informalexample"><pre class="programlisting">#!/bin/sh

echo "Content-Type: text/plain"
echo ""
echo $(date)</pre></div></li><li class="listitem">Save the file and exit (<code class="literal">:wq</code>).</li><li class="listitem">Use the command <code class="literal">chmod a+rx</code> to make the dynamic web page <code class="literal">/usr/lib/cgi-bin/timestamp</code> executable.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo chmod a+rx /usr/lib/cgi-bin/timestamp</strong></span> 

pi@raspberrypi ~ $ <span class="strong"><strong>ls -l /usr/lib/cgi-bin</strong></span>
total 4
-rwxr-xr-x 1 root root 68 Aug 12 21:2<span class="strong"><strong>1 timestamp</strong></span>

pi@raspberrypi ~ $ </pre></div><p>The dynamic web page <code class="literal">/usr/lib/cgi-bin/timestamp</code> is now executable. </p></li><li class="listitem">Use a<a class="indexterm" id="id415"/> web browser on another computer to display the dynamic web page (<code class="literal">http://192.168.2.13/cgi-bin/timestamp</code>). The dynamic web page displays the current time with each page refresh!<div class="mediaobject"><img alt="Getting ready" src="graphics/B04745_05_10.jpg"/></div><p>The preceding image shows the dynamic web page in action – with every page refresh, the timestamp is updated to the current time. The Raspberry Pi now displays dynamic pages!</p></li><li class="listitem">Use the <code class="literal">ls -l</code> command to display the contents of the web server's log files directory (<code class="literal">/var/log/apache2/</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>ls -l /var/log/apache2/</strong></span>
total 8
-rw-r----- 1 root adm  1483 Aug 12 21:30 access.log
-rw-r----- 1 root adm   325 Aug 12 21:01 error.log
-rw-r--r-- 1 root root    0 Aug 12 20:11 other_vhosts_access.log
pi@raspberrypi ~ $ </pre></div><p>The preceding example shows how the <code class="literal">ls -l</code> command is used to display the contents of the Apache web server's log files directory.</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec178"/>How it works...</h2></div></div></div><p>After logging in to the Raspberry Pi, this recipe begins by using the <span class="strong"><strong>apt-get install</strong></span> command to download and install the Apache HTTP server software distribution meta package, <code class="literal">apache2</code>. The <code class="literal">apache2</code> software distribution includes the Apache HTTP server and supporting utilities. </p><p>The Apache HTTP server is started as soon as it is installed. However, if the Raspberry Pi has been protected with a firewall (see the <span class="emphasis"><em>Creating a firewall</em></span> recipe in this chapter), the firewall will need to be configured to allow HTTP connections. The <span class="strong"><strong>ufw allow http</strong></span> command adds a firewall rule that allows connections from other computers using the HTTP protocol.</p><p>After the<a class="indexterm" id="id416"/> firewall has been configured, a web browser on another computer is used to connect to the Raspberry Pi using the Raspberry Pi's IP address (<code class="literal">192.168.2.13</code>).</p><p>The easiest way to add files from an external disk to the web server, is to first mount the external disk in the <code class="literal">/media</code> directory (see <a class="link" href="ch04.html" title="Chapter 4. File Sharing">Chapter 4</a>, <span class="emphasis"><em>File Sharing</em></span>) and then create a symbolic link to the external disk in the root directory of the web server <code class="literal">(/var/www</code>). A symbolic link does not copy files, it just points to where files are located. </p><p>In the example, a website directory on the external disk <code class="literal">(/media/bigdisk/MyWebsite</code>) is symbolically linked (<span class="strong"><strong>ln –s</strong></span>) to the web server's root directory at <code class="literal">/var/www/MyWebsite</code>. The example website has only one file that is physically located on the external disk at <code class="literal">/media/bigdisk/MyWebsite/hello.html</code>. After the symbolic link is made, that file is also located symbolically at <code class="literal">/var/www/MyWebsite/hello.html</code> and can be reached from a web browser at the URL <code class="literal">http://192.168.2.13/MyWebsite/hello.html</code>.</p><p>The recipe continues by creating a simple dynamic web page that displays the current time. The <span class="strong"><strong>vi</strong></span> editor is used to create the file <code class="literal">timestamp</code> in the <code class="literal">/usr/lib/cgi-bin/ </code>directory. The directory is protected so the <code class="literal">sudo</code> command is used as a prefix to temporarily grant the user the privilege of creating and editing the file.</p><p>The <code class="literal">timestamp</code> dynamic web page uses the Bash scripting language <code class="literal">(#!/bin/bash</code>). The web page first outputs a header describing the content of the web page as plain text (<span class="strong"><strong>echo "Content-Type: text/plain"</strong></span>) followed by a blank line (<code class="literal">echo ""</code>) to separate the HTTP response header from the content of the web page. The only line of the web page displays the current time by executing the GNU <code class="literal">date</code> utility (<code class="literal">echo "$(date)"</code>). </p><p>In order for the script to be called dynamically, the execution bit of the file's mode needs to be set with the <code class="literal">chmod</code> command <code class="literal">(chmod a+rx</code>). The file is located in a protected directory, so the <code class="literal">sudo</code> command is used again to temporarily grant privileges.</p><p>Viewing the dynamic web page (<code class="literal">http://192.168.2.13/cgi-bin/timestamp</code>) in the browser on another computer shows that the page is dynamic with each refresh of the browser. </p><p>Finally, the contents of the web server's log file directory (<code class="literal">/var/log/apache2/</code>) are displayed. Each request sent to the Apache HTTP web server is logged in the <code class="literal">access.log</code> file – one line per request. Error messages are appended to the end of the <code class="literal">error.log</code> file. If a dynamic web page does not display – or does not display properly, look at the end of the error log for a message describing the cause. All of the log files in this directory should be deleted (or archived) on a regular basis to free up disk space.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec179"/>There's more...</h2></div></div></div><div class="section" title="Configuration files, static content, and dynamic pages"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec49"/>Configuration files, static content, and dynamic pages</h3></div></div></div><p>The<a class="indexterm" id="id417"/> configuration files for the server are located in the <code class="literal">/etc/apache</code> directory. However, there is no need to change the configuration as the default<a class="indexterm" id="id418"/> configuration is sufficient for serving static web pages <a class="indexterm" id="id419"/>from the <code class="literal">/var/www</code> directory and CGI-based dynamic web pages from the <code class="literal">/usr/lib/cgi-bin</code> directory.</p><p>The directory <code class="literal">/var/www</code> is the default location of static web pages, as well as static content like images, fonts, video, and sounds. Any file located under this directory can be displayed in a web browser using the URL of the Raspberry Pi plus the name of the file (or path to the file). Initially, there is only one file in this directory, <code class="literal">index.html</code>. In the example, it has the URL <code class="literal">http://192.168.2.13/index.html</code>. The <code class="literal">/var/www</code> directory is protected, so use the <code class="literal">sudo</code> command to add, modify, or delete files in this directory.</p><p>In the default Apache HTTP web server configuration, dynamic web pages use the Common Gate Interface (CGI) and are located in the <code class="literal">/usr/lib/cgi-bin</code> directory.</p></div><div class="section" title="Other servers"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec50"/>Other servers</h3></div></div></div><p>The <a class="indexterm" id="id420"/>Apache HTTP web server is not the only web server that runs on the Raspberry Pi; however, it is perhaps the most famous and full-featured open source web server available today. Since 2009, more than 100 million websites have been hosted by Apache HTTP web servers. Although robust and complete, the Apache HTTP web server can also be resource heavy, consuming more memory and compute power than other servers.</p><div class="section" title="lighttpd"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec04"/><span class="strong"><strong>lighttpd</strong></span></h4></div></div></div><p>The <a class="indexterm" id="id421"/>lighttpd web server is lighter on resources than Apache, and has the potential to scale to a higher number of requests per second. </p><p>Originally designed as a proof-of-concept to handle 10,000 parallel connections on one server, lighttpd has since become a popular web server. </p><p>The lighttpd web server can be installed with the command <code class="literal">apt-get install lighttpd</code>.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y lighttpd</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following extra packages will be installed:
  libfam0 libterm-readkey-perl libterm-readline-perl-perl spawn-fcgi

...</pre></div><p>Although lighttpd does use <code class="literal">/var/www</code> as the root directory of the web server, it does not run CGI dynamic web pages by default. </p><p>The command <code class="literal">lighty-enable-mod cgi</code> is used to enable the lighttpd CGI module. </p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo lightly-enable-mod cgi</strong></span>
Enabling cgi: ok
Run /etc/init.d/lighttd force-reload to enable changes

pi@raspberrypi ~ $ <span class="strong"><strong>sudo /etc/init.d/lighttd force-reload</strong></span>
[ ok ] Reloading web server configuration: lighttpd.

pi@raspberrypi ~ $ </pre></div><p>The <a class="indexterm" id="id422"/>preceding example shows how to use the command <code class="literal">lighty-enable-mod</code> to enable CGI dynamic web pages.</p><p>The lighttpd CGI module expects the <code class="literal">cgi-bin</code> directory to be located in the root directory of the web server instead of in the <code class="literal">/usr/lib</code> directory. The command <code class="literal">ln –s</code> can be used to create a symbolic link from the web server's root directory to the default location for dynamic web pages (<code class="literal">/usr/lib/cgi-bin</code>).</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ln –s /usr/lib/cgi-bin /var/www/cgi-bin</strong></span>

pi@raspberrypi ~ $ </pre></div><p>The lighthttp web server's configuration files are stored in the <code class="literal">/etc/lighttpd</code> directory, and its log files are written to the <code class="literal">/var/log/lighttpd</code> directory.</p></div><div class="section" title="Nginx"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec05"/><span class="strong"><strong>Nginx</strong></span></h4></div></div></div><p>Another popular modern web server is Nginx. </p><p>Using an <a class="indexterm" id="id423"/>event-driven approach to handling requests, Nginx can provide more predictable performance under high loads than the Apache web server. Nginx also has a number of options for deploying web applications including modular support for the popular web framework Ruby on Rails.</p><p>The Nginx web server can be installed with the command <code class="literal">apt-get install nginx</code>. </p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y nginx</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following extra packages will be installed:
  nginx-common nginx-full

...</pre></div><p>The Nginx web server does not by default use the same root directory as the Apache HTTP or lighttpd web servers; instead, static web pages are by default stored in the <code class="literal">/usr/share/ngix/www</code> directory. The Nginx web server also does not support CGI; however, the Nginx web server can also produce dynamic web pages using FastCGI or Ruby Passenger.</p><p>The Nginx<a class="indexterm" id="id424"/> web server's configuration files are stored in the <code class="literal">/etc/nginx</code> directory, and its log files are written to the <code class="literal">/var/log/nginx</code> directory.</p><p>In addition to Apache, lighttpd, and Nginx, the Raspberry Pi can also run a number of lesser-known web servers including the AOL web server, monkey, and yaws. </p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>apt-cache search httpd |grep -i server |grep -v '^lib'</strong></span>
aolserver4-core - AOL web server version 4 - core libraries
aolserver4-daemon - AOL web server version 4 - program files
apache2-mpm-event - Apache HTTP Server - event driven model
apache2-mpm-prefork - Apache HTTP Server - traditional non-threaded model
apache2-mpm-worker - Apache HTTP Server - high speed threaded model
boa - Lightweight and high performance web server
bozohttpd - Bozotic HTTP server
ebhttpd - specialized HTTP server to access CD-ROM books
lighttpd - fast webserver with minimal memory footprint
mathopd - Very small, yet very fast HTTP server
micro-httpd - really small HTTP server
mini-httpd - a small HTTP server
monkey - fast, efficient, small and easy to configure web server
mono-fastcgi-server - ASP.NET backend for FastCGI webservers - default version
mono-fastcgi-server2 - ASP.NET 2.0 backend for FastCGI webservers
mono-fastcgi-server4 - ASP.NET 4.0 backend for FastCGI webservers
nginx-extras - nginx web/proxy server (extended version)
nginx-full - nginx web/proxy server (standard version)
nginx-light - nginx web/proxy server (basic version)
nginx-naxsi - nginx web/proxy server (version with naxsi)
nginx-naxsi-ui - nginx web/proxy server - naxsi configuration front-end
ocsigen - web server and programming framework in OCaml
ocsigenserver - web server of the Ocsigen project
php5-cgi - server-side, HTML-embedded scripting language (CGI binary)
tntnet - modular, multithreaded web application server for C++
webfs - lightweight HTTP server for static content
yaws - High performance HTTP 1.1 webserver written in Erlang

pi@raspberrypi ~ $ </pre></div><p>In the preceding example, <code class="literal">apt-cache search</code> and <code class="literal">grep</code> are used to display a list of available HTTP web servers. Any of the listed web servers can be installed by using the <code class="literal">apt-get install</code> command (for example, <code class="literal">apt-get install monkey</code>).</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec180"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache HTTP Server Project</strong></span> (<a class="ulink" href="http://httpd.apache.org">http://httpd.apache.org</a>): The Apache <a class="indexterm" id="id425"/>web server website is the complete reference for the web server.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>lighttpd – fly light</strong></span> (<a class="ulink" href="http://www.lighttpd.net/">http://www.lighttpd.net/</a>): The lighttpd website has <a class="indexterm" id="id426"/>detailed documentation for the web server.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Nginx</strong></span> (<a class="ulink" href="http://nginx.org/en">http://nginx.org/en</a>): The<a class="indexterm" id="id427"/> Nginx website has more information for the web server.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>bash – GNU Bourne-Again SHell</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=bash">http://manpages.debian.net/cgi-bin/man.cgi?query=bash</a>): The Debian<a class="indexterm" id="id428"/> manpage for <code class="literal">bash </code>is a reference for the Bash command language.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>chmod – change file mode bits</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=chmod">http://manpages.debian.net/cgi-bin/man.cgi?query=chmod</a>): The Debian manpage for <code class="literal">chmod</code> details the command <a class="indexterm" id="id429"/>and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>date – print or set the system date and time</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=date">http://manpages.debian.net/cgi-bin/man.cgi?query=date</a>): The Debian <a class="indexterm" id="id430"/>manpage for <code class="literal">date</code> details the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>grep – print lines matching a pattern</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=grep">http://manpages.debian.net/cgi-bin/man.cgi?query=grep</a>): The Debian <a class="indexterm" id="id431"/>manpage for <code class="literal">grep</code> details the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ln -s – make links between files</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=ln">http://manpages.debian.net/cgi-bin/man.cgi?query=ln</a>): The<a class="indexterm" id="id432"/> Debian manpage for <code class="literal">ln -s</code> details the command <a class="indexterm" id="id433"/>and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>AOL web server</strong></span> (<a class="ulink" href="http://www.aolserver.com">http://www.aolserver.com</a>): The <a class="indexterm" id="id434"/>AOL web server website.</li></ul></div></div></div>
<div class="section" title="Installing a wiki (mediawiki)"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec50"/>Installing a wiki (mediawiki)</h1></div></div></div><p>This recipe installs and sets up the same wiki used by Wikipedia (MediaWiki). </p><p>Wikis <a class="indexterm" id="id435"/>are useful collaborative environments for<a class="indexterm" id="id436"/> teams that share a continuously evolving set of documentation. Each team member can contribute to the creation and editing of pages within the wiki. The resulting pages of documentation stored in the wiki are the result of a group effort and reflect the team's combined knowledge.</p><p>This recipe is used to install the MediaWiki. This is the same wiki software used by Wikipedia. The Wikipedia website is hosted by a cluster of high-powered servers so that it can continuously serve millions of users. This recipe uses a single Raspberry Pi that has more than enough power to manage a wiki for a team or small office of collaborators.</p><p>After completing this recipe, you will have a wiki that is ready for collaboration.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec181"/>Getting ready</h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>This recipe does not require the desktop GUI and could either be run from the text-based console or from within an <code class="literal">LXTerminal</code>.</p><p>If the<a class="indexterm" id="id437"/> Raspberry Pi's Secure Shell server is running, this<a class="indexterm" id="id438"/> recipe can be completed remotely using a Secure Shell client.</p><p>Once installed, the MediaWiki is accessed and configured from a web browser. Configuration does not need to be completed on the Raspberry Pi; it can be completed remotely from another computer on the same network as the Raspberry Pi.</p><p>For better performance, the video memory of the Raspberry Pi should be set as low as possible, so that there is more memory available for MediaWiki (see the recipe Configuring memory usage in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration </em></span>for more information).</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec182"/>How to do it...</h2></div></div></div><p>The steps for installing the MediaWiki wiki server are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely.</li><li class="listitem">Use the <code class="literal">apt-get install</code> command to install the <code class="literal">mediawiki</code> software package.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y mediawiki</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following extra packages will be installed:
  apache2 apache2-mpm-prefork apache2-utils apache2.2-bin apache2.2-common
  heirloom-mailx javascript-common libaio1 libapache2-mod-php5 libapr1
  libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libdbd-mysql-perl
  libdbi-perl libhtml-template-perl libjs-jquery libjs-jquery-cookie
  libjs-jquery-form libjs-jquery-tipsy libmysqlclient16 libmysqlclient18
  libonig2 libqdbm14 lsof mediawiki-extensions-base mysql-client-5.5
  mysql-common mysql-server mysql-server-5.5 mysql-server-core-5.5
  php-wikidiff2 php5 php5-cli php5-common php5-mysql ssl-cert wwwconfig-common

...</pre></div></li><li class="listitem">The <code class="literal">apt-get</code> <code class="literal">install</code> command downloads and installs MediaWiki.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>The installation of <code class="literal">mediawiki</code> includes <code class="literal">apache2</code>, <code class="literal">mysql</code>, and <code class="literal">php5</code>.</p><p>The complete installation time will be at least 15 to 30 minutes.</p></div></div></li><li class="listitem">During install, the <code class="literal">mysql</code> package will prompt for a new root password that should be used when managing the database. Enter a root password and repeat it on the next screen.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_11.jpg"/></div></li><li class="listitem">After <a class="indexterm" id="id439"/>accepting the root password<a class="indexterm" id="id440"/> for the <code class="literal">mysql</code> database (twice), the installation of <code class="literal">mediawiki</code> completes.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use the vi editor to edit the MediaWiki website configuration file <code class="literal">(/etc/mediawiki/apache.conf</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/mediawiki/apache.conf</strong></span></pre></div></li></ul></div></li><li class="listitem">The <code class="literal">vi</code> editor displays the contents of the configuration file. Instructions for using the editor can be found in the <code class="literal">vi</code> manpages (see the recipe <span class="emphasis"><em>Reading the built-in documentation</em></span> in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span>).<div class="informalexample"><pre class="programlisting"># Uncomment this to add an alias.	
# This does not work properly with virtual hosts..
#Alias /mediawiki /var/lib/mediawiki

"/etc/mediawiki/apache.conf" 33 lines, 800 characters</pre></div></li><li class="listitem">Uncomment the <code class="literal">Alias</code> for the MediaWiki website by removing the <code class="literal">#</code> from the beginning of the line. <div class="informalexample"><pre class="programlisting">Alias /mediawiki /var/lib/mediawiki</pre></div></li><li class="listitem">Save and close the file (<code class="literal">:wq</code>).</li><li class="listitem">Use the <code class="literal">apachectl restart</code> command to restart the web server.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apachectl restart</strong></span>
apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1 for ServerName

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Once the Apache web server has restarted, the configuration of MediaWiki continues in the web browser.</li><li class="listitem">Open<a class="indexterm" id="id441"/> a web<a class="indexterm" id="id442"/> browser (possibly on another computer) and browse to <a class="indexterm" id="id443"/>the URL of the MediaWiki, (<code class="literal">http://192.168.2.13/mediawiki/</code>).<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>The IP address (<code class="literal">192.168.2.13</code>) of your Raspberry Pi will be different. The <code class="literal">hostname -I</code> command can be used to display the IP address of the Raspberry Pi – see the <span class="emphasis"><em>Remote access</em></span> recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for an example of using the <code class="literal">hostname -I</code> command.</p></div></div><div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_12.jpg"/></div></li><li class="listitem">The MediaWiki initial configuration page is displayed in the browser. Click the set up the wiki link to continue.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_13.jpg"/></div></li><li class="listitem">Choose <a class="indexterm" id="id444"/>the language to be used by<a class="indexterm" id="id445"/> MediaWiki. Click <span class="strong"><strong>Continue -&gt;</strong></span> for the next configuration page.</li><li class="listitem">Once the language has been set, MediaWiki runs a number of tests to determine if (and how) it can be set up on the Raspberry Pi.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_14.jpg"/></div><p>The<a class="indexterm" id="id446"/> preceding image shows a web page verifying<a class="indexterm" id="id447"/> that the Raspberry Pi is ready for MediaWiki.</p></li><li class="listitem">The message "<span class="strong"><strong>The environment has been checked. You can install MediaWiki</strong></span><code class="literal">.</code>" indicates MediaWiki is ready to be installed. (If you do not see this green message, click <span class="strong"><strong>Restart installation</strong></span>.)</li><li class="listitem">Scroll to the bottom of the page. Click <span class="strong"><strong>Continue -&gt;</strong></span> to accept the license and continue the installation.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_15.jpg"/></div><p>The screenshot <a class="indexterm" id="id448"/>shows the copyright agreement <a class="indexterm" id="id449"/>that must be accepted to continue.</p></li><li class="listitem">Once the license agreement has been accepted, configuration continues with the MySQL settings. </li><li class="listitem">Enter the password for the MySQL root user from Step 4.</li><li class="listitem">After the database name and root password for MySQL have been entered, configuration continues with some additional database settings for web access.</li><li class="listitem">Accept the defaults by clicking <span class="strong"><strong>Continue -&gt;</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_16.jpg"/></div><p>The <a class="indexterm" id="id450"/>preceding <a class="indexterm" id="id451"/>screenshot shows how the MySQL database settings are entered.</p><div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_17.jpg"/></div><p>The <a class="indexterm" id="id452"/>preceding screenshot accepts the default database <a class="indexterm" id="id453"/>settings.</p></li><li class="listitem">After the default database settings have been accepted, configuration continues by entering the name of the wiki and the username and password for the Administrator Account.</li><li class="listitem">Enter a Name for the wiki. Enter a username and password for the MediaWiki Administrator Account. Click <span class="strong"><strong>Continue -&gt;</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_18.jpg"/></div><p>The <a class="indexterm" id="id454"/>preceding screenshot shows the web page used<a class="indexterm" id="id455"/> to enter the Name of the wiki and the username and password for the Administrator Account.</p></li><li class="listitem">After the wiki Name and the MediaWiki Administrator username and password have been entered, scroll to the bottom of the page.</li><li class="listitem">Choose <span class="strong"><strong>I'm bored already, just install the wiki</strong></span><code class="literal">.</code> and click <span class="strong"><strong>Continue -&gt;</strong></span>.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_19.jpg"/></div><p>The screenshot shows how to skip the optional configuration settings.</p></li><li class="listitem">MediaWiki uses the<a class="indexterm" id="id456"/> supplied configuration <a class="indexterm" id="id457"/>parameters to set up the database displaying a web page listing the completed installation steps.</li><li class="listitem">Click <span class="strong"><strong>Continue -&gt;</strong></span>. This step requires time to set up the database.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_20.jpg"/></div><p>This screenshot shows the list of completed installation steps.</p></li><li class="listitem">After the displayed installation list has been accepted, a congratulation page is displayed saying that the installation is complete. However, the <code class="literal">LocalSettings.php</code> file still needs to be downloaded and installed.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Download the <code class="literal">LocalSettings.php</code> file.</li></ul></div><div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_21.jpg"/></div><p>The <a class="indexterm" id="id458"/>screenshot shows the configuration file, <span class="strong"><strong>LocalSettings.php</strong></span>, is complete.</p></li><li class="listitem">Once<a class="indexterm" id="id459"/> the <code class="literal">LocalSettings.php</code> file has been downloaded, it needs to be moved to the root of the MediaWiki installation.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note27"/>Note</h3><p>If the browser used for configuration was on another computer, the <code class="literal">LocalSettings.php</code> file will need to be copied to the Raspberry Pi.</p></div></div><div class="informalexample"><pre class="programlisting">golden-macbook:~ user$ <span class="strong"><strong>scp ~/Downloads/LocalSettings.php pi@192.168.2.13:.</strong></span>
pi@192.168.2.13's password: 
LocalSettings.php                             100% 4689     4.6KB/s   00:00    

golden-macbook:~ user$ <span class="strong"><strong>ssh pi@192.168.2.13</strong></span>
pi@192.168.2.13's password: 
Linux raspberrypi 3.18.11-v7+ #781 SMP PREEMPT Tue Apr 21 18:07:59 BST 2015 armv7l
Last login: Wed Aug 12 19:29:52 2015 from golden-macbook.local

pi@raspberrypi ~ $ <span class="strong"><strong>sudo mv LocalSettings.php /var/lib/mediawiki/</strong></span>

pi@raspberrypi ~ $ <span class="strong"><strong>sudo chmod a+r /var/lib/mediawiki/LocalSettings.php</strong></span></pre></div><p>In the preceding example, the <code class="literal">LocalSettings.php</code> file is copied from another computer (<code class="literal">golden-macbook</code>) to the MediaWiki directory <code class="literal">(/var/lib/mediawiki/</code>) on the Raspberry Pi and the file permissions are changed (<code class="literal">chmod a+r</code>) so that the MediaWiki can read the settings file.</p></li><li class="listitem">After<a class="indexterm" id="id460"/> the <code class="literal">LocalSettings.php</code> file <a class="indexterm" id="id461"/>has been moved to the root of the MediaWiki installation, the MediaWiki is ready to use!</li><li class="listitem">Browse <a class="indexterm" id="id462"/>to the MediaWiki URL on the Raspberry Pi: (<code class="literal">http://192.168.2.2/mediawiki/</code>)<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_22.jpg"/></div></li><li class="listitem">The MediaWiki is set up and running; however, it still needs to be customized for your team (by adding a custom team logo, fonts, and styles). Follow the <code class="literal">User's Guide</code> link for more information on customizing your installation and detailed instructions on how to use the MediaWiki.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec183"/>How it works...</h2></div></div></div><p>At the beginning of this recipe, the MediaWiki software distribution package (<code class="literal">mediawiki</code>) is downloaded and installed using <code class="literal">apt-get install</code>. The MediaWiki installation includes the installation of Apache2, MySQL, and PHP5. Each of these packages can also be installed separately to provide a web server (Apache2), a database (MySQL), or a web scripting language (PHP5). </p><p>The MediaWiki installation begins by installing Apache2, MySQL, and PHP5. Neither the Apache2 installation nor the PHP5 installation requires any user input to complete successfully. However, the MySQL installation requires a password for the <code class="literal">root</code> user of the database.</p><p>The <a class="indexterm" id="id463"/>MySQL administrative <code class="literal">root</code> password is for the <a class="indexterm" id="id464"/>setup and configuration of the MySQL database management server. It is not the same password used by the user <code class="literal">pi</code>. The security of the Raspberry Pi is improved, if the password for the user pi and the password for the database are different.</p><p>After the MySQL <code class="literal">root</code> password has been entered, the installation continues. The MySQL database is installed. The MediaWiki application files are installed. The Apache2 web server is installed and started. However, the Apache2 web server is not yet configured to host the MediaWiki.</p><p>The <code class="literal">vi</code> editor is used to edit the <code class="literal">apache.conf</code> configuration file and assign the MediaWiki a website. The configuration file is located in the MediaWiki configuration directory, <code class="literal">/etc/mediawiki/</code>, and is also linked to the web server configuration directory, <code class="literal">/etc/apache2/conf.d/</code>. </p><p>The only line that needs to be changed in the Apache2 configuration file is the line that begins <code class="literal">#Alias</code>. The <code class="literal">#</code> at the beginning of the line turns the line into a comment. Comment lines are ignored when the Apache web server reads the configuration file. Removing the <code class="literal">#</code> from the beginning of the line will activate the MediaWiki the next time the web server is started.</p><p>The Alias statement has two parameters: the website's URL prefix <code class="literal">(/mediawiki</code>) and the location of the website's application files <code class="literal">(/var/lib/mediawiki</code>). The URL prefix becomes part of the wiki's URL (<code class="literal">http://192.168.2.13/mediawiki/</code>). Changing the URL prefix would also change the URL used to access the wiki. Changing the prefix to <code class="literal">/TeamWiki</code> would change the wiki's URL to <code class="literal">http://192.168.2.2/TeamWiki/</code>.</p><p>After the web server configuration file has been edited and the Alias line has been uncommented, the Apache web server is restarted with the <code class="literal">apachectl restart</code> command. This privileged command is used to restart the Apache web server.</p><p>Restarting the web server forces it to reload its configuration files, including the MediaWiki's web server configuration file. Now that MediaWiki's alias has been uncommented, the MediaWiki website is available; however, the wiki's database still needs to be set up.</p><p>Once the MediaWiki website is running, a web browser (possibly on another computer) can be used to complete the wiki's database setup. The example URL is <code class="literal">http://192.168.2.13/mediawiki/</code>. The IP address of your Raspberry Pi will most likely be different. </p><p>The first page displayed by the MediaWiki says the <code class="literal">LocalSettings.php</code> file cannot be found. The link labeled <span class="strong"><strong>setup the wiki</strong></span> leads to the web pages that are used to complete the setup of the wiki.</p><p>The first<a class="indexterm" id="id465"/> setup page is used to define the language used by the wiki administrator (<span class="strong"><strong>Your language</strong></span>) and the language used by other wiki users (<span class="strong"><strong>Wiki language</strong></span>). </p><p>The next <a class="indexterm" id="id466"/>setup page shows the results of a system configuration examination and a license that must be accepted to complete the installation of MediaWiki. </p><p>Then, the database settings are entered on the next page. The password entered earlier for the MySQL administrative <code class="literal">root</code> user should be entered here. </p><p>Some additional database settings appear on the next page. Accept the defaults. </p><p>Finally, there is a setup page that asks for the wiki name and a username and password for the MediaWiki administrator. This new password is only used for configuring the wiki and is neither the MySQL administrative <code class="literal">root</code> password nor the password of the user <code class="literal">pi</code>. </p><p>At the bottom of the page is an opportunity to enter more configuration data. The example in the recipe chose <span class="strong"><strong>I'm bored already, just install the wiki.</strong></span> and clicked <span class="strong"><strong>Continue -&gt;</strong></span> to complete the database installation. </p><p>After a status page is displayed, the last page of the setup triggers the download of the <code class="literal">LocalSettings.php</code> file, which is used to complete the installation of the wiki. If the file was downloaded on another computer, the <code class="literal">scp</code> command can be used to copy the file to the Raspberry Pi as shown in the example.</p><p>The <code class="literal">LocalSettings.php</code> file is a summary of the configuration parameters that were entered into the MediaWiki's setup pages. This file needs to be moved to the MediaWiki installation directory (<code class="literal">/var/lib/mediawiki/</code>) to complete the setup of the wiki.</p><p>After the <code class="literal">LocalSettings.php</code> file has been moved to the MediaWiki installation directory, setup is complete and the MediaWiki <span class="strong"><strong>Main Page</strong></span> is now displayed at the configured URL (<code class="literal">http://192.168.2.13/mediawiki/</code>). The wiki is up and running! </p><p>Click the <span class="strong"><strong>[edit]</strong></span> link to change the content of the <span class="strong"><strong>Main Page</strong></span>. </p><p>Some customization could still be done to personalize the wiki (for example, change the wiki logo); however, the general setup is complete and the wiki can now be used for collaboration. </p><p>More information on using and customizing MediaWiki can be found by following the <span class="strong"><strong>User's Guide</strong></span> link on the <span class="strong"><strong>Main Page</strong></span> of the wiki.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec184"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>MediaWiki </strong></span>(<a class="ulink" href="http://en.wikipedia.org/wiki/Mediawiki">http://en.wikipedia.org/wiki/Mediawiki</a>): This Wikipedia <a class="indexterm" id="id467"/>article is about the MediaWiki wiki server.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>apachectl – Apache HTTP server control interface </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=apachectl">http://manpages.debian.net/cgi-bin/man.cgi?query=apachectl</a>): The Debian manpage for <code class="literal">apachectl</code> has more <a class="indexterm" id="id468"/>about the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>scp – secure copy (remote file copy program)</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=scp">http://manpages.debian.net/cgi-bin/man.cgi?query=scp</a>): The Debian <a class="indexterm" id="id469"/>manpage for <code class="literal">scp</code> has more details about the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>mv – move (rename) files</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=mv">http://manpages.debian.net/cgi-bin/man.cgi?query=mv</a>): The Debian manpage for <code class="literal">mv</code> has more details about <a class="indexterm" id="id470"/>the command and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>chmod – change file mode bits </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=chmod">http://manpages.debian.net/cgi-bin/man.cgi?query=chmod</a>): The Debian manpage for <code class="literal">chmod</code> has more details<a class="indexterm" id="id471"/> about the command and its options.</li></ul></div></div></div>
<div class="section" title="Creating a wireless access point with hostapd"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec51"/>Creating a wireless access point with hostapd</h1></div></div></div><p>This<a class="indexterm" id="id472"/> recipe sets up the Raspberry Pi as a<a class="indexterm" id="id473"/> wireless access point – as a hub that other wireless devices can use to connect to the local network – or to services that are running on the Raspberry Pi.</p><p>Out of the box, the Raspbian Linux distribution supports connecting the Raspberry Pi to an existing wireless network using a wireless USB adapter. This recipe goes beyond using the Raspberry Pi as a network client and instead configures the Raspberry Pi as a network hub for other wireless devices. If the Raspberry Pi is also connected to a local network via a TCP cable, the Raspberry Pi acts as wireless network router enabling other devices to connect to the local network through the Raspberry Pi.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note28"/>Note</h3><p>Not all wireless USB adapters support Access Point (AP) mode. </p><p>The recipe will test the wireless adapter to ensure that it supports AP mode.</p></div></div><p>After completing this recipe, you will be able to create a wireless network with the Raspberry Pi acting as a network hub.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec185"/>Getting ready </h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A supported wireless USB adapter.</li></ul></div><p>This<a class="indexterm" id="id474"/> recipe does not require the desktop <a class="indexterm" id="id475"/>GUI and could either be run from the text-based console or from within an <code class="literal">LXTerminal</code>.</p><p>If the Raspberry Pi's Secure Shell server is running and the Raspberry Pi is connected to the local network via a wired network connection, this recipe can be completed remotely using a Secure Shell client.</p><p>The wireless connection will be reset during this recipe, so it is not recommended to log in remotely over a wireless connection during setup.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec186"/>How to do it...</h2></div></div></div><p>The steps for configuring the Raspberry Pi as a wireless access point are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely.</li><li class="listitem">Use the <code class="literal">apt-get install</code> command to install the software packages <code class="literal">hostapd</code>, <code class="literal">udhcpd</code>, and <code class="literal">iw</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y hostapd udhcpd iw</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done

The following extra packages will be installed:
  crda wireless-regdb
The following NEW packages will be installed:
  crda hostapd iw udhcpd wireless-regdb
0 upgraded, 5 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/509 kB of archives.
After this operation, 1,188 kB of additional disk space will be used.
Selecting previously unselected package wireless-regdb.
(Reading database ... 88434 files and directories currently installed.)
Unpacking wireless-regdb (from .../wireless-regdb_2014.10.07-1~deb7u1_all.deb) ...
Selecting previously unselected package crda.
Unpacking crda (from .../crda_1.1.2-1_armhf.deb) ...
Selecting previously unselected package hostapd.
Unpacking hostapd (from .../hostapd_1%3a1.0-3+deb7u2_armhf.deb) ...
Selecting previously unselected package iw.
Unpacking iw (from .../archives/iw_3.4-1_armhf.deb) ...
Selecting previously unselected package udhcpd.
Unpacking udhcpd (from .../udhcpd_1%3a1.20.0-7_armhf.deb) ...
Processing triggers for man-db ...
Setting up wireless-regdb (2014.10.07-1~deb7u1) ...
Setting up crda (1.1.2-1) ...
Setting up hostapd (1:1.0-3+deb7u2) ...
Setting up iw (3.4-1) ...
Setting up udhcpd (1:1.20.0-7) ...
udhcpd: Disabled. Edit /etc/default/udhcpd to enable it.

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The <code class="literal">apt-get install</code> command downloads and installs the software packages <code class="literal">hostapd</code>, <code class="literal">udhcpd</code>, and <code class="literal">iw</code>.</li><li class="listitem">Check<a class="indexterm" id="id476"/> the wireless USB adapter.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note29"/>Note</h3><p>Check your wireless USB adapter for AP mode with this command:</p><p><code class="literal">sudo iw list | grep '* AP'</code></p><p>If no lines are returned, the wireless adapter does not have AP mode.</p></div></div></li><li class="listitem">Use <a class="indexterm" id="id477"/>the <code class="literal">iw list</code> command (filtered with <code class="literal">grep</code>) to see if the wireless adapter supports Access Point (AP) mode.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo iw list | grep '^[[:blank:]]*\* A'</strong></span>
		 * AP
		 * AP/VLAN
		 * AP/VLAN
		 * AP: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 
		 * AP/VLAN: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 
		 * AP: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0
		 * AP/VLAN: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0
pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Display the nameserver address.</li><li class="listitem">Use the <code class="literal">cat </code>command to display the nameserver address stored in <code class="literal">/etc/resolve.conf</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>cat /etc/resolv.conf</strong></span>
# Generated by resolvconf
nameserver 192.168.2.1

pi@raspberrypi ~ $ </pre></div><p>The DNS <code class="literal">nameserver</code> used by the Raspberry Pi is <span class="strong"><strong>192.168.2.1</strong></span>.</p></li><li class="listitem">Configure the <code class="literal">udhcpd</code> server.</li><li class="listitem">Use <a class="indexterm" id="id478"/>the <code class="literal">vi</code> editor to edit the <code class="literal">udhcpd</code> configuration file <code class="literal">/etc/udhcpd.conf</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/udhcpd.conf</strong></span></pre></div></li><li class="listitem">The <code class="literal">vi</code> editor displays the contents of the configuration file. Instructions for using the editor can be found in the <code class="literal">vi</code> manpages (see the recipe <span class="emphasis"><em>Reading the built-in documentation</em></span> in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>,<span class="emphasis"><em>Administration</em></span>).<div class="informalexample"><pre class="programlisting"># Sample udhcpd configuration file (/etc/udhcpd.conf)

# The start and end of the IP lease block

start           192.168.0.20    #default: 192.168.0.20
end             192.168.0.254   #default: 192.168.0.254


# The interface that udhcpd will use

interface       eth0            #default: eth0

"/etc/udhcpd.conf" 123 lines, 3054 characters</pre></div></li><li class="listitem">Change<a class="indexterm" id="id479"/> the network interface used by <code class="literal">udhcpd</code> by changing the line beginning with <code class="literal">interface</code> to read <code class="literal">interface wlan0</code>.<div class="informalexample"><pre class="programlisting"># The interface that udhcpd will use

interface       <span class="strong"><strong>wlan0</strong></span></pre></div></li><li class="listitem">Change the example configuration of <code class="literal">udhcpd</code> by changing the section beginning with <code class="literal">#Examples</code> at the bottom of the file. Replace the example DNS address with the <code class="literal">nameserver</code> address used by your Raspberry Pi (<code class="literal">192.168.2.1,</code> from Step 5).<div class="informalexample"><pre class="programlisting">#Examples
opt     dns     192.168.2.1
option  subnet  255.255.255.0
opt     router  192.168.0.1
option  domain  local
option  lease   864000</pre></div></li><li class="listitem">Save the file and exit the editor (<code class="literal">:wq</code>).</li><li class="listitem">Enable the udhcpd server.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/default/udhcpd</strong></span></pre></div></li><li class="listitem">Use the <code class="literal">vi</code> editor to edit the <code class="literal">udhcpd</code> configuration file, <code class="literal">/etc/default/udhcpd</code>.</li><li class="listitem">The <code class="literal">vi</code> editor displays the contents of the configuration file. <div class="informalexample"><pre class="programlisting"># Comment the following line to enable
DHCPD_ENABLED="no"

# Options to pass to busybox' udhcpd.
#
# -S    Log to syslog
# -f    run in foreground

DHCPD_OPTS="-S"
~                                                                                                                       
~                                                                                                                       
"/etc/default/udhcpd" 9 lines, 164 characters</pre></div></li><li class="listitem">Enable<a class="indexterm" id="id480"/> the udhcpd server <a class="indexterm" id="id481"/>by commenting out the line <code class="literal">DHCP_ENABLED="no"</code>. To comment out the line, place a <code class="literal">#</code> at the beginning of the line. <div class="informalexample"><pre class="programlisting"># Comment the following line to enable
#DHCPD_ENABLED="no"</pre></div></li><li class="listitem">Save the file and exit the editor (<code class="literal">:wq</code>).</li><li class="listitem">Configure the hostapd server. Use the <code class="literal">vi</code> editor to create a new <code class="literal">hostapd</code> configuration file, <code class="literal">/etc/hostapd/hostapd.conf</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/hostapd/hostapd.conf</strong></span></pre></div></li><li class="listitem">The <code class="literal">vi</code> editor displays the empty configuration file.</li><li class="listitem">Add the following parameters to the hostapd configuration file:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>interface=wlan0
ssid=Raspi_AP
wpa_passphrase=Pr0t3ct3d
driver=nl80211
hw_mode=g
channel=6
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP</strong></span></pre></div></li><li class="listitem">Save the file and exit the editor (<code class="literal">:wq</code>).</li><li class="listitem">Enable the hostapd server. Use the <code class="literal">vi</code> editor to enable the <code class="literal">hostapd</code> service by editing the service default file (<code class="literal">/etc/default/hostapd</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/default/hostapd</strong></span></pre></div></li><li class="listitem">The <code class="literal">vi</code> editor displays the contents of the configuration file.<div class="informalexample"><pre class="programlisting"># Defaults for hostapd initscript
#
# See /usr/share/doc/hostapd/README.Debian for information about alternative
# methods of managing hostapd.
#
# Uncomment and set DAEMON_CONF to the absolute path of a hostapd configuration
# file and hostapd will be started during system boot. An example configuration
# file can be found at /usr/share/doc/hostapd/examples/hostapd.conf.gz
#
#DAEMON_CONF=""

# Additional daemon options to be appended to hostapd command:-
#       -d   show more debug messages (-dd for even more)
#       -K   include key data in debug messages
#       -t   include timestamps in some debug messages
#
# Note that -B (daemon mode) and -P (pidfile) options are automatically
# configured by the init.d script and must not be added to DAEMON_OPTS.
#
#DAEMON_OPTS=""
~                                                                                                                       
"/etc/default/hostapd" 20 lines, 770 characters</pre></div></li><li class="listitem">Replace the line beginning with #<code class="literal">DAEMON_CONF</code> with the line <code class="literal">DAEMON_CONF="/etc/hostapd/hostapd.conf".</code><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>DAEMON_CONF="/etc/hostapd/hostapd.conf"</strong></span></pre></div></li><li class="listitem">Save<a class="indexterm" id="id482"/> the file and exit the editor (<code class="literal">:wq</code>).</li><li class="listitem">Configure <a class="indexterm" id="id483"/>IP forwarding. Use the <code class="literal">vi</code> editor to enable IP forwarding by editing the kernel parameters file,<code class="literal"> /etc/sysctl.conf</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/sysctl.conf</strong></span></pre></div></li><li class="listitem">The <code class="literal">vi</code> editor displays the contents of the configuration file.<div class="informalexample"><pre class="programlisting">#
# /etc/sysctl.conf - Configuration file for setting system variables
# See /etc/sysctl.d/ for additonal system variables
# See sysctl.conf (5) for information.
#

"/etc/sysctl.conf" 64 lines, 2137 characters</pre></div></li><li class="listitem">The <code class="literal">vi</code> editor opens the kernel parameters file (<code class="literal">/etc/sysctl.conf</code>).</li><li class="listitem">Uncomment the line beginning with <code class="literal">net.ipv4.ip_forward</code> by removing the <code class="literal">#</code> from the beginning of the line. <div class="informalexample"><pre class="programlisting"># Uncomment the next line to enable packet forwarding for IPv4
net.ipv4.ip_forward=1</pre></div></li><li class="listitem">Save the file and exit the editor (<code class="literal">:wq</code>).</li><li class="listitem">Enable IP forwarding. Enable post forwarding by using the <code class="literal">echo</code> command to set the kernel parameter <code class="literal">/proc/sys/net/ipv4/ip_forward</code> to the value <code class="literal">"1"</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo bash -c 'echo "1" &gt; /proc/sys/net/ipv4/ip_forward'</strong></span>
pi@raspberrypi ~ $</pre></div></li><li class="listitem">Use the <code class="literal">iptables</code> command to set up IP forwarding rules for network address translation and port forwarding. <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo iptables -t nat -A POSTROUTING –o eth0 –j MASQUERADE</strong></span>

pi@raspberrypi ~ $ <span class="strong"><strong>sudo iptables -A FORWARD –i eth0 –o wlan0 -m state --state RELATED,ESTABLISHED –j ACCEPT</strong></span>

pi@raspberrypi ~ $ <span class="strong"><strong>sudo iptables -A FORWARD –i wlan0 –o eth0 –j ACCEPT</strong></span></pre></div></li><li class="listitem">Save the iptables configuration (<code class="literal">iptables-save</code>) and move the output file (<code class="literal">iptables.ipv4.net</code>) to the <code class="literal">/etc</code> configuration directory for use during system boot.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo iptables-save &gt; iptables.ipv4.nat</strong></span>
pi@raspberrypi ~ $ <span class="strong"><strong>sudo mv iptables.ipv4.nat /etc</strong></span>

pi@raspberrypi ~ $ <span class="strong"><strong>sudo chown root:root /etc/iptables.ipv4.nat </strong></span>

pi@raspberrypi ~ $ <span class="strong"><strong>ls -l /etc/iptables.ipv4.nat</strong></span> 
-rw-r--r-- 1 root root 566 Aug 13 19:30 /etc/iptables.ipv4.nat

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Give<a class="indexterm" id="id484"/> the wireless interface <a class="indexterm" id="id485"/>a static IP address. Use the <code class="literal">ifconfig</code> command to give the wireless network interface (<code class="literal">wlan0)</code> a static IP address (<code class="literal">192.169.0.1</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo ifconfig wlan0 192.168.0.1</strong></span>

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Configure the network interface boot parameters. Use the vi editor to edit the network interface configuration file (<code class="literal">/etc/network/interfaces</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/network/interfaces</strong></span></pre></div></li><li class="listitem">The <code class="literal">vi</code> editor opens the network interface configuration file (<code class="literal">/etc/network/interfaces</code>).</li><li class="listitem">Change the file so that it only contains the following<code class="literal">:</code><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>auto lo
iface lo inet loopback

auto eth0
allow-hotplug eth0
iface eth0 inet manual

auto wlan0
iface wlan0 inet static
    address 192.68.0.1
    netmask 255.255.255.0

up iptables-restore &lt; /etc/iptables.ipv4.nat</strong></span></pre></div></li><li class="listitem">Save the file and exit the editor (:wq).</li><li class="listitem">Enable the wireless access point. Use the <code class="literal">update-rc.d</code> command to enable the <code class="literal">hostapd</code> and <code class="literal">udhcpd</code> services. <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo update-rc.d hostapd enable</strong></span>
update-rc.d: using dependency based boot sequencing

pi@raspberrypi ~ $ <span class="strong"><strong>sudo update-rc.d udhcpd enable</strong></span>
update-rc.d: using dependency based boot sequencing

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The <a class="indexterm" id="id486"/>Raspberry Pi is now <a class="indexterm" id="id487"/>configured to start the <code class="literal">hostapd</code> and <code class="literal">udhcpd</code> services during system boot. </li><li class="listitem">Disable wpa_supplicant. Use the <code class="literal">mv</code> command to move the service definition file for WPA Supplicant (<code class="literal">fi.epitest.hostap.WPASupplicant.service</code>) out of the services directory (<code class="literal">/usr/share/dbus-1/system-services</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>mv /usr/share/dbus-1/system-services/ fi.epitest.hostap.WPASupplicant.service ~/</strong></span>

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Reboot: Reboot the system and the Raspberry Pi is a wireless access point! Look for the <code class="literal">Raspi_AP</code> network SSID and connect using the password (<code class="literal">Pr0t3ct3d</code>) that was defined in the hostapd configuration file (<code class="literal">/etc/hostapd/hostapd.conf</code>).</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec187"/>How it works...</h2></div></div></div><p>The recipe starts by downloading and installing a wireless interface toolkit (<code class="literal">iw</code>), as well as two servers: a Wireless Access Point server (<code class="literal">hostapd</code>) and a DHCP server (<code class="literal">udhcpd</code>).</p><p>Before configuration begins, the wireless USB adapter is tested for compatibility.</p><div class="section" title="Check the wireless USB adapter"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec51"/>Check the wireless USB adapter</h3></div></div></div><p>Not all <a class="indexterm" id="id488"/>wireless USB adapters support Access Point (AP) mode. The <code class="literal">iw list</code> command is used to list the wireless capabilities of any attached wireless devices. If AP mode is supported, it will be listed in the section <code class="literal">Supported interface modes</code>. </p><p>The output of the <code class="literal">iw list</code> command is quite long. The <code class="literal">grep</code> command is used to filter the output of the <code class="literal">iw list</code> command. A pipe (<code class="literal">|</code>) is used to connect the output of the <code class="literal">iw list</code> command<a class="indexterm" id="id489"/> to the input of the <code class="literal">grep</code> command. The <code class="literal">grep</code> command limits the output of other commands using a regular expression filter (<span class="strong"><strong>'^[[:blank:]]*\* A' </strong></span>– from the beginning of the line <span class="strong"><strong>^</strong></span> any number of blanks <span class="strong"><strong>[[:blank:]]*</strong></span> followed by an asterisk <span class="strong"><strong>\*</strong></span> followed by a space and the capital letter <span class="strong"><strong>A</strong></span>).</p><p>If the wireless adapter is not compatible with <code class="literal">hostapd</code>, the <code class="literal">iw list</code> command will display the message "<code class="literal">nl80211 not found.</code>" There may still be a chance for the adapter to work with <code class="literal">hostapd</code>; however, it requires recompiling <code class="literal">hostapd</code> with another driver (see references at the end of the chapter).</p><p>Once the wireless adapter has been tested and shown to support AP mode, configuration of the Raspberry Pi continues.</p></div><div class="section" title="Configure the DHCP server by using udhcpd"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec52"/>Configure the DHCP server by using udhcpd</h3></div></div></div><p>The <a class="indexterm" id="id490"/>Dynamic Host Configuration Protocol (DHCP) server (udhcpd) assigns client computers network configuration information; such<a class="indexterm" id="id491"/> as the address of a DNS nameserver, an IP address, and a default route (or gateway). When this recipe is complete, the Raspberry Pi will configure its wireless clients using DCHP.</p><p>Three changes are made to the DHCP configuration file <code class="literal">(/etc/udhcpd.conf</code>):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The wireless interface is selected (<span class="strong"><strong>wlan0</strong></span>)</li><li class="listitem" style="list-style-type: disc">The remaining flag is set to support embedded devices (for example, Raspberry Pi)</li><li class="listitem" style="list-style-type: disc">The default network parameters are defined for wireless clients</li></ul></div><p>The default network parameters are:</p><p><span class="strong"><strong>dns</strong></span> – the DNS nameserver to use. The system DNS nameserver is defined in <span class="strong"><strong>/etc/resolv.conf</strong></span> and is displayed in Step 5.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>subnet</strong></span><code class="literal"> </code>– how many IP addresses are part of the same network subnet. The value <span class="strong"><strong>255.255.255.0</strong></span> is a net mask that matches computers with the same numbers in the first three bytes of the IP address. </li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>router</strong></span> – the static IP address of the Raspberry Pi's wireless interface (<span class="strong"><strong>192.168.0.1</strong></span>).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>domain</strong></span><code class="literal"> </code>– the name of the network (<span class="strong"><strong>local</strong></span>).</li><li class="listitem" style="list-style-type: disc"><code class="literal">lease </code>– how long a network address will be assigned to a specific computer (<span class="strong"><strong>864000</strong></span> seconds or 10 days).</li></ul></div><p>The <span class="strong"><strong>start</strong></span> and <span class="strong"><strong>end</strong></span> parameters at the top of the configuration file by default are set to the range of IP values from <span class="strong"><strong>192.168.0.20</strong></span>
<code class="literal"> </code>to <span class="strong"><strong>192.168.0.254</strong></span>.</p><p>If the Raspberry Pi will always be attached to a wired network that has a network timeserver, the remaining time flag does not need to be set.</p><p>After<a class="indexterm" id="id492"/> udhcpd has been configured, its boot script <a class="indexterm" id="id493"/>parameter file <code class="literal">(/etc/default/udhcpd</code>) also needs to be changed. The parameter <span class="strong"><strong>DHCP_ENABLED="no"</strong></span> needs to be commented out (by placing a <code class="literal">#</code> at the beginning of the line), so that the DHCP server (<code class="literal">udhcpd</code>) is enabled.</p></div><div class="section" title="Configure the Wireless Access Point server by using hostapd"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec53"/>Configure the Wireless Access Point server by using hostapd</h3></div></div></div><p>The <a class="indexterm" id="id494"/>Wireless Access Point <a class="indexterm" id="id495"/>server (<code class="literal">hostapd</code>) manages the wireless connection between other wireless devices and the Raspberry Pi. This includes establishing a secure connection using an encryption protocol like Wi-Fi Protect Access (WPA); and setting the Service Set ID (SSID) and the pre-shared key (PSK).</p><p>The created <span class="strong"><strong>hostapd</strong></span> configuration parameter file includes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>interface</strong></span> – the wireless interface (<span class="strong"><strong>wlan0</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ssid</strong></span> – the network ID (<span class="strong"><strong>Raspi_AP</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>wpa_passphrase</strong></span> – the passphrase or pre-shared key (<code class="literal">Pr0t3ct3d</code>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>driver</strong></span> – the wireless device driver (<span class="strong"><strong>nl80211</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>hw_mode</strong></span> – the hardware mode (<span class="strong"><strong>g</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>channel</strong></span> – the radio frequency channel (<span class="strong"><strong>6</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>macaddr_acl</strong></span> – access control list (<span class="strong"><strong>0</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>auth_algs</strong></span> – the authorization algorithm to use (<span class="strong"><strong>1</strong></span> – open auth)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ignore_broadcast_ssid</strong></span> – enable broadcasting the network ID (<span class="strong"><strong>0</strong></span> – don't ignore broadcasting)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>wpa</strong></span> – which version of WPA (<span class="strong"><strong>2</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>wpa_key_mgmt</strong></span> – which key manages algorithm (<span class="strong"><strong>WPA-PSK</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>wpa_pairwise</strong></span> – WPA v1 data encryption (<span class="strong"><strong>TKIP</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>rsn_pairwise</strong></span> – WPA v2 data encryption (<span class="strong"><strong>CCMP</strong></span>)</li></ul></div><p>After <span class="strong"><strong>hostapd</strong></span> has been configured, its boot script parameter file (<code class="literal">/etc/default/hostapd</code>) also needs to be changed. The parameter <span class="strong"><strong>DAEMON_CONF</strong></span> needs to be set to the location of the <code class="literal">hostapd</code> configuration file <code class="literal">(/etc/hostapd/hostapd.conf</code>), so that the Wireless <a class="indexterm" id="id496"/>Access Point server<a class="indexterm" id="id497"/> is enabled.</p></div><div class="section" title="Set up IP Forwarding"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec54"/>Set up IP Forwarding</h3></div></div></div><p>IP Forwarding is<a class="indexterm" id="id498"/> used to pass (forward) network traffic between network interfaces. In this recipe, IP Forwarding is used to pass network traffic between the wireless network and the wired network. Using IP Forwarding, the Raspberry Pi connects the clients of the wireless network to the wired network.</p><p>The first configuration step is to enable IP Forwarding in the Raspberry Pi's Linux kernel. The kernel parameters file <code class="literal">(/etc/sysctl.conf</code>) has an IP Forwarding entry (<span class="strong"><strong>net.ipv4.ip_forward=1</strong></span>) that is by default commented out. Uncommenting this entry, by removing the <span class="strong"><strong>#</strong></span> at the beginning of the line, enables IP Forwarding in the Linux kernel.</p><p>After IP Forwarding is enabled, the <code class="literal">iptables</code> command is used to define the net filter rules that determine which network packets are allowed to cross the Linux kernel's internal firewall. The Linux kernel's firewall organizes its rules into tables that define how network packets pass through the kernel. The <code class="literal">iptables</code> command is used to manage the rules stored in these tables.</p><p>The first Linux kernel firewall rule define in this step is appended to the postprocessing rules (<span class="strong"><strong>-A POSTROUTING</strong></span>) of the network address translation table (<span class="strong"><strong>-t nat</strong></span>). This rule masquerades network packets (<span class="strong"><strong>MASQUERADE</strong></span>) as they are passed to the wired network (<span class="strong"><strong>-o eth0</strong></span>). The IP addresses of wireless network clients are translated into the IP address of the Raspberry Pi's wired network connection as they are passed to the wired network. This is how the network packets from multiple wireless network clients are translated so they can pass through the Raspberry Pi's single wired network connection.</p><p>The second rule is appended to the packet forwarding rules (<span class="strong"><strong>-A FORWARD</strong></span>) of the filter table (the default table). This rule allows (<span class="strong"><strong>-j ACCEPT</strong></span>) network packets to be forwarded (<span class="strong"><strong>-A FORWARDED</strong></span>) from the wired network (<span class="strong"><strong>-i eth0</strong></span>) to the wireless network (<span class="strong"><strong>-o wlan0</strong></span>) when they are related to an established connection (<span class="strong"><strong>-m state –state RELATED,ESTABLISHED</strong></span>).</p><p>The last <code class="literal">iptables</code> command rule in this step is appended to the forwarding rules of the filter table (<span class="strong"><strong>-A FORWARD</strong></span>). This rule allows packets to pass from the wireless network (<span class="strong"><strong>-i wlan0</strong></span>) to the wired network (<span class="strong"><strong>-o eth0</strong></span>).</p><p>The next command, <code class="literal">ifconfig wlan0</code>, sets the IP address of the Raspberry Pi's wireless network connection to <span class="strong"><strong>192.168.0.1</strong></span>.</p><p>Finally, the <code class="literal">iptables-save</code> command is used to save a copy of these rules in a configuration file <code class="literal">(/etc/iptables.ipv4.nat</code>) that can be used during boot. </p><p>After this step is complete, the IP Forwarding rules have been defined and saved in a configuration<a class="indexterm" id="id499"/> file. The IP Forwarding rules are also active.</p></div><div class="section" title="Configure the boot parameters"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec55"/>Configure the boot parameters</h3></div></div></div><p>The network<a class="indexterm" id="id500"/> interfaces definitions used during boot are stored in a configuration file <code class="literal">(/etc/network/interfaces</code>). The file defines the network address, network mask, and the default route for each network interface.</p><p>The configuration file used in this recipe defines three network interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>lo</strong></span> – the loopback network</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>eth0</strong></span><code class="literal"> </code>– the wired network</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>wlan0</strong></span> – the wireless network</li><li class="listitem" style="list-style-type: disc">The loopback interface (<span class="strong"><strong>lo</strong></span>) is loaded automatically (<span class="strong"><strong>auto</strong></span>).</li><li class="listitem" style="list-style-type: disc">The wired interface interface's (<span class="strong"><strong>eth0</strong></span>) is configured dynamically using the DHCP protocol.</li></ul></div><p>The wireless interface (<span class="strong"><strong>wlan0</strong></span>) has a static definition (<span class="strong"><strong>static</strong></span>) –  it is in this file. The wireless interface's IP <span class="strong"><strong>address</strong></span> is defined to be <span class="strong"><strong>192.168.0.1</strong></span>. The interface's defined network mask (<span class="strong"><strong>255.255.255.0</strong></span>) is big enough to support 256 unique addresses on the same subnet.</p><p>After the network interfaces are brought up (<span class="strong"><strong>up</strong></span>), the IP Forwarding definitions <code class="literal">(/etc/iptables.ipv4.nat</code>) are restored (<span class="strong"><strong>iptables-restore</strong></span>) that were saved earlier in this recipe (using <span class="strong"><strong>iptables-save</strong></span>).</p><p>Once the network interface definitions have been saved, the network can be started.</p></div><div class="section" title="Start the wireless access point"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec56"/><span class="strong"><strong>Start the wireless access point</strong></span></h3></div></div></div><p>Now <a class="indexterm" id="id501"/>that the configuration files have been updated:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">wireless access point <code class="literal">(/etc/hostapd/hostapd.conf</code>)</li><li class="listitem" style="list-style-type: disc">dynamic host configuration protocol <code class="literal">(/etc/udhcpd.conf</code>) </li><li class="listitem" style="list-style-type: disc">network interfaces <code class="literal">(/etc/network/interfaces</code>) </li><li class="listitem" style="list-style-type: disc">IP Forwarding definitions <code class="literal">(/etc/iptables.ipv4.nat)</code></li></ul></div><p>The boot scripts for the wireless access point daemon (<span class="strong"><strong>hostapd</strong></span>) and the dynamic host configuration protocol daemon (<code class="literal">udhcp</code>) can be enabled (<code class="literal">update-rc.d enable</code>). </p><p>The Raspberry Pi will now become a wireless access point every time it boots!</p><p>After the Raspberry Pi reboots, the wireless access point is ready to use! Wireless devices can <a class="indexterm" id="id502"/>now connect to the Raspberry Pi using your chosen SSID (<code class="literal">Raspi_AP</code>) and passphrase (<code class="literal">Pr0t3ct3d</code>).</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec188"/>There's more…</h2></div></div></div><div class="section" title="Not all USB wireless adapters support AP mode"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec57"/>Not all USB wireless adapters support AP mode</h3></div></div></div><p>There<a class="indexterm" id="id503"/> are a limited number of wireless USB adapters that can work with the Raspberry Pi and can also be configured as wireless access points. The links at the end of this chapter can be used to find current wireless USB adapters that can be used together with the Raspberry Pi to create a wireless access point (see <span class="emphasis"><em>Other Resources</em></span>).</p><p>Some wireless USB adapters consume more power than the Raspberry Pi can support consistently on a continual basis. Connecting the wireless USB adapter to the Raspberry Pi indirectly via a USB hub will lead to better performance and reduce the likelihood that other USB devices (like the onboard network card!) will be starved for power.</p></div><div class="section" title="Wireless firewall, file server, or web server"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec58"/>Wireless firewall, file server, or web server</h3></div></div></div><p>This<a class="indexterm" id="id504"/> recipe works well when combined with other recipes in this book. </p><p>Together <a class="indexterm" id="id505"/>with the file-sharing recipes in <a class="link" href="ch04.html" title="Chapter 4. File Sharing">Chapter 4</a>, <span class="emphasis"><em>File Sharing</em></span>, the <a class="indexterm" id="id506"/>Raspberry Pi could become a file server for both wired and wireless devices connected to the local network – for exchanging document and media files; or for backup and storage.</p><p>When combined with other advanced networking recipes in this chapter, the Raspberry Pi could become a network firewall, protecting wireless access to a wired network; a teaching or support tool with remote access to desktop devices; a communication tool that serves web pages; or a collaboration tool that hosts wiki pages.</p><p>Within the Raspberry Pi and open source GNU Linux community, there are numerous other tools and applications that could be combined with this recipe to turn the Raspberry Pi into a dynamic network hub for wireless devices. </p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec189"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>hostapd </strong></span>(<a class="ulink" href="http://en.wikipedia.org/wiki/Hostapd">http://en.wikipedia.org/wiki/Hostapd</a>): This Wikipedia article <a class="indexterm" id="id507"/>about hostapd describes the service in more detail.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>hostapd: IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator</strong></span> (<a class="ulink" href="http://w1.fi/hostapd/">http://w1.fi/hostapd/</a>): The <code class="literal">hostapd</code> website is a complete<a class="indexterm" id="id508"/> reference for the server.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Debian Linux Kernel Handbook </strong></span>(<a class="ulink" href="http://kernel-handbook.alioth.debian.org/">http://kernel-handbook.alioth.debian.org/</a>): The Debian Linux Kernel Handbook has<a class="indexterm" id="id509"/> more information about how iptables work.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Linux wireless </strong></span>(<a class="ulink" href="http://linuxwireless.org/">http://linuxwireless.org/</a>): The Linux Wireless website <a class="indexterm" id="id510"/>has more information on using wireless devices with Linux.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>RPI-Wireless-Hotspot </strong></span>(<a class="ulink" href="http://elinux.org/RPI-Wireless-Hotspot">http://elinux.org/RPI-Wireless-Hotspot</a>): This<a class="indexterm" id="id511"/> is an article about wireless hotspots on the Embedded Linux website.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>USB Wi-Fi Adapters </strong></span>(<a class="ulink" href="http://elinux.org/RPi_VerifiedPeripherals#USB_Wi-Fi_Adapters">http://elinux.org/RPi_VerifiedPeripherals#USB_Wi-Fi_Adapters</a>): This<a class="indexterm" id="id512"/> is an article about Wi-Fi adapters on the Embedded Linux Wiki.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Raspberry Pi Wi-Fi adapter testing </strong></span>(<a class="ulink" href="http://www.element14.com/community/docs/DOC-44703/l/raspberry-pi-wifi-adapter-testing">http://www.element14.com/community/docs/DOC-44703/l/raspberry-pi-wifi-adapter-testing</a>): This is an article about<a class="indexterm" id="id513"/> tested wireless adapters on the Element14 Community website.</li></ul></div></div></div>
<div class="section" title="Installing a network trace utility"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec52"/>Installing a network trace utility</h1></div></div></div><p>This recipe<a class="indexterm" id="id514"/> installs the network trace utility My traceroute (<code class="literal">mtr</code>). </p><p>The <code class="literal">mtr</code> utility is often used for network troubleshooting. The utility displays the route that network packets take between the Raspberry Pi and another computer. The display is refreshed continuously displaying the time it takes network packets to travel between each device along the route between the two computers. By use <code class="literal">mrt</code>, you can see which devices along the network route are the slowest.</p><p>After completing this recipe, you will be able to trace network packets with <code class="literal">mrt</code>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec190"/>Getting ready </h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>This recipe does not require the desktop GUI and could either be run from the text-based console or from within an <code class="literal">LXTerminal</code>.</p><p>If the Raspberry Pi's Secure Shell server is running, this recipe can be completed remotely using a Secure Shell client.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec191"/>How to do it...</h2></div></div></div><p>The<a class="indexterm" id="id515"/> steps to installing a network trace utility are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely.</li><li class="listitem">Use the <code class="literal">apt-get install </code>command to install the <code class="literal">mtr</code> package. <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install mtr</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  mtr
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 59.2 kB of archives.
After this operation, 142 kB of additional disk space will be used.
Get:1 http://mirrordirector.raspbian.org/raspbian/ wheezy/main mtr armhf 0.82-3 [59.2 kB]
Fetched 59.2 kB in 0s (66.3 kB/s)
Selecting previously unselected package mtr.
(Reading database ... 88583 files and directories currently installed.)
Unpacking mtr (from .../archives/mtr_0.82-3_armhf.deb) ...
Processing triggers for menu ...
Processing triggers for man-db ...
Setting up mtr (0.82-3) ...
Processing triggers for menu ...

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The <code class="literal">apt-get install</code> command installs the software package <code class="literal">mrt</code>.</li><li class="listitem">Use the <code class="literal">mrt</code> command to trace the network route between your Raspberry Pi and the Raspberry Pi Foundation website.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo mtr raspberrypi.org</strong></span></pre></div></li><li class="listitem">The <code class="literal">mrt</code> command displays the route.<div class="informalexample"><pre class="programlisting">                             My traceroute  [v0.82]
raspberrypi (0.0.0.0)                                  Sat Aug 29 16:44:37 2015
Keys:  Help   Display mode   Restart statistics   Order of fields   quit
                                       Packets               Pings
 Host                                Loss%   Snt   Last   Avg  Best  Wrst StDev
 1. 192.168.2.1                       0.0%    29    2.6   0.9   0.5   3.1   0.8
 2. 10.0.0.1                          3.4%    29    3.8   4.2   2.7   6.8   1.1
 3. c-24-5-176-1.hsd1.ca.comcast.net  0.0%    29   20.0  18.3  13.1  49.7   6.9
 4. te-0-6-0-14-sur03.sanmateo.ca.sf  0.0%    29   16.1  18.0  12.5  26.9   4.2
 5. he-0-13-0-0-ar01.santaclara.ca.s  0.0%    29   32.5  21.4  12.6  36.9   6.3
    he-0-13-0-1-ar01.santaclara.ca.sfba.comcast.net
 6. ???
 7. he-0-11-0-1-pe02.529bryant.ca.ib  0.0%    28   12.7  23.0  12.7  97.3  15.5
 8. 50.248.118.238                    0.0%    28   22.6  20.8  14.8  44.7   5.4
 9. be2016.ccr22.sfo01.atlas.cogentc  0.0%    28   23.7  21.6  13.7  29.0   3.2
10. be2133.ccr22.mci01.atlas.cogentc  0.0%    28   59.7  64.6  57.5 120.8  11.7
11. be2157.ccr42.ord01.atlas.cogentc  0.0%    28   69.2  72.7  64.3 126.5  11.8
12. be2185.ccr22.cle04.atlas.cogentc  0.0%    28   75.2  78.4  71.1 108.7   8.8
13. be2483.ccr42.jfk02.atlas.cogentc  0.0%    28   90.6  90.8  82.7 106.7   4.5
14. be2490.ccr42.lon13.atlas.cogentc  0.0%    28  155.8 159.9 153.5 171.7   4.0
15. be2494.ccr22.lon01.atlas.cogentc  0.0%    28  160.9 161.8 157.4 178.6   4.6
16. be2352.rcr21.b015534-1.lon01.atl  0.0%    28  176.2 163.5 156.9 222.6  12.6
17. 149.11.4.86                       0.0%    28  163.9 161.9 153.9 188.4   6.6
18. mythic10g-private.orochi.mythic-  0.0%    28  157.6 160.4 155.9 169.7   3.4
19. 93.93.128.230                     0.0%    28  172.9 182.7 172.9 252.8  14.9</pre></div></li></ol></div><p>The<a class="indexterm" id="id516"/> display continuously refreshes until you press <span class="strong"><strong>q</strong></span>.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec192"/>How it works...</h2></div></div></div><p>After logging in to the Raspberry Pi, this recipe installs the My traceroute software package (<code class="literal">mtr</code>).</p><p>Then the newly installed <code class="literal">mtr</code> command is used to trace the network route between the author's Raspberry Pi located in San Mateo, California and the Raspberry Pi Foundation website that is hosted by Mythic-Beasts located in London, England.</p><p>The <span class="emphasis"><em>q</em></span> key is pressed to exit the command.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec193"/>There's more...</h2></div></div></div><p>The <code class="literal">mtr</code> dynamically updates network statistics collected from devices along the route between a remote machine and the Raspberry Pi. In addition to displaying a list of devices along the route (<span class="strong"><strong>Host</strong></span>), <code class="literal">mtr</code> also displays stats for <span class="strong"><strong>Packets</strong></span> and <span class="strong"><strong>Pings</strong></span>. </p><p>The <span class="strong"><strong>Packets</strong></span> stats show how many packets were sent (<span class="strong"><strong>Snt</strong></span>) and how many packets were lost along the way (<span class="strong"><strong>Loss%</strong></span>). </p><p>The <span class="strong"><strong>Pings</strong></span> stats show how long it takes a network packet to travel from the Raspberry Pi to each device along the route. The average (<span class="strong"><strong>Avg</strong></span>), best (<span class="strong"><strong>Best</strong></span>), and worst (<span class="strong"><strong>Wrst</strong></span>) time are also shown along with the standard deviation (<span class="strong"><strong>StDev</strong></span>).</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec194"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>MTR (My traceroute)</strong></span> (<a class="ulink" href="https://en.wikipedia.org/wiki/MTR_(software)">https://en.wikipedia.org/wiki/MTR_(software)</a>): This Wikipedia article <a class="indexterm" id="id517"/>has more information about <code class="literal">mtr</code>, its history, and how it works.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>MTR</strong></span> (<a class="ulink" href="https://www.bitwizard.nl/mtr/">https://www.bitwizard.nl/mtr/</a>): The homepage for MTR – My<a class="indexterm" id="id518"/> traceroute.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>mtr – a network diagnostic tool</strong></span> (<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=mtr">http://manpages.debian.net/cgi-bin/man.cgi?query=mtr</a>): The Debian manpage for <code class="literal">mtr</code> describes the command<a class="indexterm" id="id519"/> and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>mythic beasts – infrastructure</strong></span> (<a class="ulink" href="https://www.mythic-beasts.com/article/infrastructure">https://www.mythic-beasts.com/article/infrastructure</a>): This web page describes the hosing<a class="indexterm" id="id520"/> infrastructure used by the Raspberry Pi Foundation, including the location of its data centers.</li></ul></div></div></div>
<div class="section" title="Installing a network protocol analyzer"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Installing a network protocol analyzer</h1></div></div></div><p>This recipe<a class="indexterm" id="id521"/> installs the network protocol analyzer Wireshark. </p><p>The Wireshark network protocol analyzer lets you examine the traffic on your network at a microscopic level. This network tool can be used for live capture or offline analysis. Wireshark has a Graphical User Interface (GUI) and a TTY-mode utility (<code class="literal">tshark</code>). </p><p>Live data can be read from Ethernet, IEEE 802.11 (Wi-Fi), PPP/HDLC, ATM, Bluetooth, USB, Token Ring, Frame Relay, FDDI, and other low-level protocols. Decryption is supported for a number of higher-level protocols including IPsec, ISAKMP, Kerberos, SNMPv3, SSL/TLS, WEP, and WPA/WPA2. Data can be read/written in many forms including tcpdump, Microsoft Network Monitor, Network General Sniffer, Sniffer Pro, NetXray, and many others.</p><p>After completing this recipe, you will be able to analyze your network with <code class="literal">wireshark</code>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note30"/>Note</h3><p>This recipe is only a starting point for exploring network protocol analysis. </p><p>Links to more detailed information can be found at the end of the recipe. </p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec195"/>Getting ready</h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have also logged in as the user <code class="literal">pi</code>.</p><p>This recipe requires the desktop GUI.</p><p>If the Raspberry Pi's VNC server is running, this recipe can be completed remotely using a VNC client (see the <span class="emphasis"><em>Remote access to the monitor</em></span> recipe earlier in this chapter).</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec196"/>How to do it...</h2></div></div></div><p>The steps to installing a network protocol analyzer are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi desktop GUI.</li><li class="listitem">Use the <code class="literal">apt-get install </code>command to install the <code class="literal">wireshark</code> package. <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y wireshark</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following extra packages will be installed:
  libc-ares2 libcap2-bin liblua5.1-0 libpam-cap libpcap0.8 libsmi2ldbl libwireshark-data
  libwireshark2 libwiretap2 libwsutil2 wireshark-common
Suggested packages:
  libcap-dev snmp-mibs-downloader wireshark-doc
The following NEW packages will be installed:
  libc-ares2 libcap2-bin liblua5.1-0 libpam-cap libpcap0.8 libsmi2ldbl libwireshark-data
  libwireshark2 libwiretap2 libwsutil2 wireshark wireshark-common
0 upgraded, 12 newly installed, 0 to remove and 0 not upgraded.
Need to get 14.0 MB of archives.
After this operation, 48.6 MB of additional disk space will be used.

...</pre></div></li><li class="listitem">The <code class="literal">apt-get install</code> command downloads and installs the <code class="literal">wireshark</code> software <a class="indexterm" id="id522"/>package.</li><li class="listitem">Use the <code class="literal">dpkg-reconfigure</code> command to modify the default configuration for <code class="literal">wireshark</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo dpkg-reconfigure wireshark-common</strong></span>

The dpkg-reconfigure command asks if non-superusers should be able to capture packets. 

 ┌─────────────────────┤ Configuring wireshark-common ├──────────────────────┐
 │                                                                           │ 
 │ Dumpcap can be installed in a way that allows members of the "wireshark"  │ 
 │ system group to capture packets. This is recommended over the             │ 
 │ alternative of running Wireshark/Tshark directly as root, because less    │ 
 │ of the code will run with elevated privileges.                            │ 
 │                                                                           │ 
 │ For more detailed information please see                                  │ 
 │ /usr/share/doc/wireshark-common/README.Debian.                            │ 
 │                                                                           │ 
 │ Enabling this feature may be a security risk, so it is disabled by        │ 
 │ default. If in doubt, it is suggested to leave it disabled.               │ 
 │                                                                           │ 
 │ Should non-superusers be able to capture packets?                         │ 
 │                                                                           │ 
 │                    &lt;Yes&gt;                       &lt;No&gt;                       │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ </pre></div></li><li class="listitem">Use the <span class="strong"><strong>&lt;tab&gt;</strong></span> key to select the answer <span class="strong"><strong>&lt;Yes&gt;</strong></span> and then press the <span class="strong"><strong>&lt;enter&gt;</strong></span> key to update the package configuration.</li><li class="listitem">Use the <code class="literal">usermod</code> command to add (<code class="literal">-a</code>) the user <code class="literal">pi</code> to the <code class="literal">wireshark</code> system group (<code class="literal">-G wireshark</code>). <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo usermod -a -G wireshark pi</strong></span>

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">Use the Desktop GUI menu to start the Wireshark application. <div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_23.jpg"/></div></li><li class="listitem">The <a class="indexterm" id="id523"/>Wireshark application is started.<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_24.jpg"/></div></li><li class="listitem">Choose <a class="indexterm" id="id524"/>an interface from the menu and click <span class="strong"><strong>Start</strong></span> to begin sniffing network packets.</li><li class="listitem">The Wireshark application displays detailed information about each network packet as they are captured (sniffed).<div class="mediaobject"><img alt="How to do it..." src="graphics/B04745_05_25.jpg"/></div></li><li class="listitem">Use the <span class="strong"><strong>File</strong></span> menu or <span class="emphasis"><em>Ctrl</em></span>+<span class="emphasis"><em>Q</em></span> to quit.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec197"/>How it works...</h2></div></div></div><p>After <a class="indexterm" id="id525"/>logging in to the Raspberry Pi, this recipe uses the <code class="literal">apt-get install</code> command to install the Wireshark network protocol analyzer (network packet sniffer).</p><p>After the Wireshark application is installed, the <code class="literal">dpkg-reconfigure</code> command is used to change the default application configuration (<span class="strong"><strong>wireshark-common</strong></span>) to allow non-superusers to capture network packets. By default, only superusers are allowed to capture network packets. </p><p>After the configuration change is accepted (<span class="strong"><strong>&lt;Yes&gt;</strong></span>), members of the<span class="strong"><strong> wireshark</strong></span> system group may also capture network packets.</p><p>Before the application is started, the user <span class="strong"><strong>pi</strong></span> is added (<span class="strong"><strong>-a</strong></span>) to the <span class="strong"><strong>wireshark</strong></span> user group using the <span class="strong"><strong>usermod</strong></span> command.</p><p>The Wireshark command is started by selecting <span class="strong"><strong>Menu &gt; Internet &gt; Wireshark</strong></span> from the Raspberry Pi desktop.</p><p>When the application is started, the Wireshark application main page is displayed.</p><p>From<a class="indexterm" id="id526"/> the main page, it is possible to select which network interfaces will be sniffed (monitored for incoming/outgoing network packets). After the <span class="strong"><strong>Start</strong></span> command is clicked, Wireshark starts capturing and displaying network packets.</p><p>The Wireshark application can be exited by selecting <span class="strong"><strong>File &gt; Quit</strong></span> from the menu bar, or by pressing <span class="strong"><strong>Control-Q</strong></span>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec198"/>There's more...</h2></div></div></div><p>The Wireshark application is a free and open source network protocol analyzer popular for network troubleshooting, analysis, and education.</p><div class="section" title="Promiscuous mode"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec59"/>Promiscuous mode</h3></div></div></div><p>Wireshark<a class="indexterm" id="id527"/> puts the selected network interface(s) into promiscuous mode. In promiscuous mode, the interface listens for all network packets, including packets that are not destined for the Raspberry Pi. Wireshark can see all the network traffic on the network interface.</p></div><div class="section" title="Terminal-based user interface"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec60"/>Terminal-based user interface</h3></div></div></div><p>Wireshark<a class="indexterm" id="id528"/> also has a command-line utility, <code class="literal">tshark</code>, that outputs the packets it sniffs directly to the console. The <code class="literal">tshark</code> command is installed separately from Wireshark.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo apt-get install -y tshark</strong></span>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  tshark
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 173 kB of archives.
After this operation, 314 kB of additional disk space will be used.
Get:1 http://mirrordirector.raspbian.org/raspbian/ wheezy/main tshark armhf 1.8.2-5wheezy16 [173 kB]
Fetched 173 kB in 1s (149 kB/s)
Selecting previously unselected package tshark.
(Reading database ... 88953 files and directories currently installed.)
Unpacking tshark (from .../tshark_1.8.2-5wheezy16_armhf.deb) ...
Processing triggers for man-db ...
Setting up tshark (1.8.2-5wheezy16) ...

pi@raspberrypi ~ $ </pre></div><p>When entered on the command line without options, tshark starts capturing the packets it can sniff on the default network interface (eth0).</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>tshark</strong></span>
Capturing on eth0
7.169256 93.93.130.39 -&gt; 192.168.2.11 TCP 74 http &gt; 47593 [SYN, ACK] Seq=0 Ack=1 Win=14480 Len=0 MSS=1460 SACK_PERM=1 TSval=3829221233 TSecr=2254282 WS=128
  7.169418 192.168.2.11 -&gt; 93.93.130.39 TCP 66 47593 &gt; http [ACK] Seq=1 Ack=1 Win=29312 Len=0 TSval=2254310 TSecr=3829221233
  7.170328 192.168.2.11 -&gt; 93.93.130.39 HTTP 399 GET / HTTP/1.1 
  7.332273 93.93.130.39 -&gt; 192.168.2.11 TCP 66 http &gt; 47593 [ACK] Seq=1 Ack=334 Win=15616 Len=0 TSval=3829221302 TSecr=2254310
  7.333431 93.93.130.39 -&gt; 192.168.2.11 HTTP 324 HTTP/1.0 302 Found  (text/html)
  7.333558 192.168.2.11 -&gt; 93.93.130.39 TCP 66 47593 &gt; http [ACK] Seq=334 Ack=259 Win=30336 Len=0 TSval=2254326 TSecr=3829221302
  7.339590 192.168.2.11 -&gt; 93.93.130.39 TCP 66 47593 &gt; http [FIN, ACK] Seq=334 Ack=259 Win=30336 Len=0 TSval=2254327 TSecr=3829221302
  7.342519 192.168.2.11 -&gt; 192.168.2.1  DNS 64 Standard query 0x32c4  A wpad
  7.343102  192.168.2.1 -&gt; 192.168.2.11 DNS 139 Standard query response 0x32c4 No such name
  7.344034 192.168.2.11 -&gt; 192.168.2.1  DNS 79 Standard query 0x5959  A www.raspberrypi.org
  7.371312  192.168.2.1 -&gt; 192.168.2.11 DNS 160 Standard query response 0x5959  CNAME lb.raspberrypi.org A 93.93.128.211 A 93.93.128.230 A 93.93.130.39 A 93.93.130.214</pre></div><p>The <a class="indexterm" id="id529"/>preceding example output from <code class="literal">tshark</code> shows some of the network packets captured when browsing the website <a class="ulink" href="https://www.raspberrypi.org">https://www.raspberrypi.org</a>.</p></div><div class="section" title="Capture filters"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec61"/>Capture filters</h3></div></div></div><p>Not all <a class="indexterm" id="id530"/>of the network packets passing across the Raspberry Pi's network interface are interesting. Both Wireshark and <code class="literal">tshark</code> can use capture filters to limit the number of packets that are captured and displayed.</p><p>In this example, the capture filter limits the display to SSL traffic.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>tshark -R 'ssl'</strong></span>
Capturing on eth0
  1.080068 192.168.2.11 -&gt; 216.58.209.227 TLSv1.2 135 Encrypted Alert
  1.081229 192.168.2.11 -&gt; 74.125.224.145 TLSv1.2 135 Encrypted Alert
  1.082105 192.168.2.11 -&gt; 74.125.224.145 TLSv1.2 135 Encrypted Alert
  1.082913 192.168.2.11 -&gt; 216.58.192.35 TLSv1.2 135 Encrypted Alert
  1.083782 192.168.2.11 -&gt; 74.125.20.95 TLSv1.2 135 Encrypted Alert
  1.084541 192.168.2.11 -&gt; 74.125.224.9 TLSv1.2 135 Encrypted Alert
  1.085294 192.168.2.11 -&gt; 74.125.20.95 TLSv1.2 135 Encrypted Alert
  1.239064 192.168.2.11 -&gt; 173.194.202.105 SSL 206 Client Hello
  1.345864 173.194.202.105 -&gt; 192.168.2.11 SSL 1484 [TCP Previous segment not captured] Continuation Data
  1.345865 173.194.202.105 -&gt; 192.168.2.11 SSL 405 Continuation Data

...</pre></div><p>The following example captures data from the wireless network (wlan0) and limits the display to HTTP traffic.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>tshark -i wlan0 -R http</strong></span>
Capturing on wlan0
  7.721824 192.168.0.75 -&gt; 199.27.79.133 HTTP 452 GET / HTTP/1.1 
  7.818987 199.27.79.133 -&gt; 192.168.0.75 HTTP 781 [TCP Previous segment not captured] Continuation or non-HTTP traffic
  7.831542 192.168.0.75 -&gt; 199.27.79.133 HTTP 511 GET /css/main.css HTTP/1.1 </pre></div><p>More examples of the use of capture filters, as well as more detail on the use of Wireshark <a class="indexterm" id="id531"/>and <code class="literal">tshark</code>, can be found in the following references.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec199"/>See also</h2></div></div></div><p><span class="strong"><strong>Wireshark </strong></span>(<a class="ulink" href="https://www.wireshark.org">https://www.wireshark.org</a>): The home page for the Wireshark application<a class="indexterm" id="id532"/> has detailed documentation on how Wireshark can be used effectively.</p><p><span class="strong"><strong>Wireshark</strong></span> (<a class="ulink" href="https://en.wikipedia.org/wiki/Wireshark">https://en.wikipedia.org/wiki/Wireshark</a>): This Wikipedia article has more information about Wireshark, its history, and how it works.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>wireshark - interactively dump and analyze network traffic </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=wireshark">http://manpages.debian.net/cgi-bin/man.cgi?query=wireshark</a>): The Debian manpage for wireshark describes the command, its configuration, and its options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>tshark - dump and analyze network traffic </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=tshark">http://manpages.debian.net/cgi-bin/man.cgi?query=tshark</a>): The<a class="indexterm" id="id533"/> Debian manpage for <code class="literal">tshark</code> describes the command, its configuration, and options.</li></ul></div><p><span class="strong"><strong>wireshark-filter - Wireshark filter syntax and reference </strong></span>(<a class="ulink" href="http://manpages.debian.org/cgi-bin/man.cgi?query=wireshark-filter">http://manpages.debian.org/cgi-bin/man.cgi?query=wireshark-filter</a>): This <a class="indexterm" id="id534"/>Debian manpage describes Wireshark's capture filters in detail.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>CaptureFilters </strong></span>(<a class="ulink" href="https://wiki.wireshark.org/CaptureFilters">https://wiki.wireshark.org/CaptureFilters</a>): This website <a class="indexterm" id="id535"/>has a number of useful capture filter examples.</li></ul></div><p><span class="strong"><strong>Introduction to Wireshark </strong></span>(<a class="ulink" href="https://www.wireshark.org/video/wireshark/introduction-to-wireshark/">https://www.wireshark.org/video/wireshark/introduction-to-wireshark/</a>): This <a class="indexterm" id="id536"/>video<a class="indexterm" id="id537"/> is an excellent introduction to packet sniffing with Wireshark.</p></div></div>
<div class="section" title="Enabling the IPv6 network protocol"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Enabling the IPv6 network protocol</h1></div></div></div><p>This <a class="indexterm" id="id538"/>recipe configures your Raspberry Pi to support IPv6.</p><p>The Internet Protocol's sixth version, IPv6, is intended to replace the current IPv4 protocol. IPv6 provides 8x10^28 more IP address than IPv4. It is also a more stable, efficient, and secure protocol. </p><p>The majority of modern home network routers support both IPv4 and IPv6; however, not all of the older routers still in service support IPv6. So, IPv6 is not enabled by default on the Raspberry Pi, which saves a bit of memory and processing power. To take full advantage of modern networking services, you can enable IPv6 on your Raspberry Pi.</p><p>After completing this recipe, your Raspberry Pi will have IPv6 enabled.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec200"/>Getting ready</h2></div></div></div><p>Ingredients:</p><p>An Initial Setup or Basic Networking setup for the Raspberry Pi that has been powered on. You have <a class="indexterm" id="id539"/>also logged in as the user <code class="literal">pi</code> (see the recipes in <a class="link" href="ch01.html" title="Chapter 1. Installation and Setup">Chapter 1</a>, <span class="emphasis"><em>Installation and Setup</em></span> for how to boot and log in and the recipes in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span> for how to log in remotely).</p><p>This recipe does not require the desktop GUI and could either be run from the text-based console or from within an <code class="literal">LXTerminal</code>.</p><p>If the Raspberry Pi's Secure Shell server is running, this recipe can be completed remotely using a Secure Shell client.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec201"/>How to do it...</h2></div></div></div><p>The steps to installing a mesh network are:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Raspberry Pi either directly or remotely.</li><li class="listitem">Use the <code class="literal">modprobe </code>command to enable the <code class="literal">ipv6</code> protocol. <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo modprobe ipv6</strong></span></pre></div></li><li class="listitem">Use the <code class="literal">ifconfig</code> command to validate that all of the network interfaces now have IPv6 enabled (look for the <code class="literal">inet6 addr</code>).<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>ifconfig</strong></span>
eth0      Link encap:Ethernet  HWaddr b8:27:eb:3f:aa:0c  
          inet addr:192.168.2.11  Bcast:192.168.2.255  Mask:255.255.255.0
          inet6 addr: fe80::ba27:ebff:fe3f:aa0c/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:978305 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1786420 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:100780981 (96.1 MiB)  TX bytes:2430911170 (2.2 GiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:45 errors:0 dropped:0 overruns:0 frame:0
          TX packets:45 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:3420 (3.3 KiB)  TX bytes:3420 (3.3 KiB)

wlan0     Link encap:Ethernet  HWaddr 00:0f:55:bb:aa:b5  
          inet addr:192.168.0.1  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::20f:55ff:febb:aab5/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1628703 errors:0 dropped:50 overruns:0 frame:0
          TX packets:803167 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:2395688238 (2.2 GiB)  TX bytes:94274367 (89.9 MiB)

pi@raspberrypi ~ $ </pre></div></li><li class="listitem">The <a class="indexterm" id="id540"/>Raspberry Pi is now using IPv6! However, the <code class="literal">ipv6</code> module will not be automatically loaded at the next boot. Use the following steps to configure the module to load automatically.</li><li class="listitem">Add the <code class="literal">ipv6</code> module to the bottom of the kernel's module configuration file, <code class="literal">/etc/modules</code>.<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo sh -c 'echo ipv6 &gt;&gt;/etc/modules'</strong></span></pre></div></li><li class="listitem">Use the <code class="literal">vi</code> command to edit the kernel module configuration file <code class="literal">/etc/modprobe.d/ipv6.conf</code>. <div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo vi /etc/modprobe.d/ipv6.conf</strong></span></pre></div></li><li class="listitem">The <code class="literal">vi</code> editor displays the contents of the configuration file. Instructions for using the editor can be found in the <code class="literal">vi</code> manpages (see the recipe <span class="emphasis"><em>Reading the built-in documentation</em></span> in <a class="link" href="ch02.html" title="Chapter 2. Administration">Chapter 2</a>, <span class="emphasis"><em>Administration</em></span>).<div class="informalexample"><pre class="programlisting"># Don't load ipv6 by default
alias net-pf-10 off
#alias ipv6 off
~                                                                               
~                                                                               
"/etc/modprobe.d/ipv6.conf" 3 lines, 65 characters</pre></div></li><li class="listitem">Change the word <span class="strong"><strong>off</strong></span> at the end of the <span class="strong"><strong>alias net-pf-10</strong></span> line to <span class="strong"><strong>on</strong></span>, and delete the <span class="strong"><strong>alias ipv6</strong></span> line as it is no longer true.<div class="informalexample"><pre class="programlisting"># ipv6 is loaded by default
alias net-pf-10 ipv6
~                                                                               
~                                                                               
"/etc/modprobe.d/ipv6.conf" 3 lines, 59 characters</pre></div></li><li class="listitem">Save the file and exit the editor (<code class="literal">:wq</code>).</li><li class="listitem">Finally, reboot the Raspberry Pi to use the new IPv6 configuration!<div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo reboot</strong></span>

Broadcast message from root@raspberrypi (pts/0) (Sun Aug 30 13:01:44 2015):
The system is going down for reboot NOW!
pi@raspberrypi ~ $ Connection to 192.168.2.13 closed by remote host.
Connection to 192.168.2.13 closed.</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec202"/>How it works...</h2></div></div></div><p>After logging in to the Raspberry Pi, this recipe uses the modprobe command to load the <code class="literal">ipv6</code> module. Simply loading the module enables IPv6 networking; however, the <code class="literal">ipv6</code> module will not be automatically loaded on the next reboot. The kernel's module configuration<a class="indexterm" id="id541"/> needs to be updated to enable an automatic load at boot.</p><p>The recipe uses the <code class="literal">echo</code> command running in a subshell (<code class="literal">sh –c</code>) to append (<code class="literal">&gt;&gt;</code>) the module name, <code class="literal">ipv6</code>, to the bottom of the <code class="literal">/etc/modules</code> configuration file. Adding the module name to the module configuration ensures that the module will be loaded at boot.</p><p>The recipe also uses the <code class="literal">vi</code> command to update the <code class="literal">/etc/modprobe/ipv6.conf</code> file, explicitly enabling (<span class="strong"><strong>on</strong></span>) the complete IPv6 network protocol family (<code class="literal">net-pf-10</code>).</p><p>After the configuration is updated, the Raspberry Pi is rebooted.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec203"/>There's more...</h2></div></div></div><p>Internet Protocol version 6 not only has a larger address space but also more features.</p><div class="section" title="Privacy extensions"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec62"/>Privacy extensions</h3></div></div></div><p>IPv6 has<a class="indexterm" id="id542"/> two interesting privacy extensions: one that creates a new random address each time it's rebooted, and another that continuously randomizes the address.</p><p>To enable the generation of a temporary random IPv6 address with each new boot, add the <code class="literal">net.ipv6.conf.iface.use_tempadd</code> Linux kernel parameter to the bottom of the <code class="literal">/etc/sysctl.conf</code> kernel configuration file.</p><p>To enable a continual refresh of the random IP address, add the kernel parameter <code class="literal">net.ipv6.conf.iface.temp_prefered_lft</code> to the bottom of the same file.</p><p>The following example uses the <code class="literal">echo</code> command to append (<code class="literal">&gt;&gt;</code>) the two kernel configuration parameters to the bottom of the kernel configuration file, <code class="literal">/etc/sysctl.conf</code>. The IPv6 kernel parameter (<code class="literal">net.ipv6.conf</code>) for generating a temporary address (<code class="literal">use_tempadd</code>) is enabled (<span class="strong"><strong>2</strong></span>) and the parameter for refreshing it (<code class="literal">temp_prefered_lft</code>) every two hours (<span class="strong"><strong>7200</strong></span> seconds) is set for all interfaces. First, the <code class="literal">sudo sh</code> command is use to create a subshell with superuser privileges. After the kernel parameters are added, the subshell is exited (<span class="strong"><strong>exit</strong></span>) and the superuser privileges are discarded.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo sh

# echo "net.ipv6.conf.all.use_tempaddr = 2" &gt;&gt; /etc/sysctl.conf

# echo "net.ipv6.conf.default.use_tempaddr = 2" &gt;&gt; /etc/sysctl.conf

# echo "net.ipv6.conf.all.temp_prefered_lft = 7200" &gt;&gt; /etc/sysctl.conf

# echo "net.ipv6.conf.default.temp_prefered_lft = 7200" &gt;&gt; /etc/sysctl.conf

# exit</strong></span>

pi@raspberrypi ~ $</pre></div><p>Reboot<a class="indexterm" id="id543"/> the Raspberry Pi and the changes will be applied.</p></div><div class="section" title="Use sysctl to change kernel parameters at runtime"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec63"/>Use sysctl to change kernel parameters at runtime</h3></div></div></div><p>The <a class="indexterm" id="id544"/>following example uses the <code class="literal">systctl</code> command to configure the extensions at runtime specifically for the interface <code class="literal">eth0</code>. However, the <code class="literal">/etc/sysctl.conf</code> will still need to be updated to automatically use them at boot.</p><div class="informalexample"><pre class="programlisting">pi@raspberrypi ~ $ <span class="strong"><strong>sudo sh

# sysctl -a --pattern 'net.ipv6.conf.eth0.use_tempaddr'</strong></span>
net.ipv6.conf.eth0.use_tempaddr = 0

<span class="strong"><strong># sysctl net.ipv6.conf.eth0.use_tempaddr=2  </strong></span>                    
net.ipv6.conf.eth0.use_tempaddr = 2

<span class="strong"><strong># sysctl -a --pattern 'net.ipv6.conf.eth0.temp_prefered_lft'</strong></span>
net.ipv6.conf.eth0.temp_prefered_lft = 86400

<span class="strong"><strong># sysctl net.ipv6.conf.eth0.temp_prefered_lft=7200</strong></span>
net.ipv6.conf.eth0.temp_prefered_lft = 7200

<span class="strong"><strong># exit</strong></span>

pi@raspberrypi ~ $</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec204"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>IPv6 </strong></span>(<a class="ulink" href="https://en.wikipedia.org/wiki/IPv6">https://en.wikipedia.org/wiki/IPv6</a>): This Wikipedia article has <a class="indexterm" id="id545"/>more information about Internet Protocol version 6.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>sysctl.conf – configure kernel parameters at runtime </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl">http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl</a>): The Debian manpage for <code class="literal">sysctl</code> has limited<a class="indexterm" id="id546"/> information on the command.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>sysctl.conf – sysctl preload/configuration file </strong></span>(<a class="ulink" href="http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl.conf">http://manpages.debian.net/cgi-bin/man.cgi?query=sysctl.conf</a>): The Debian manpage for <code class="literal">sysctl.conf</code> has<a class="indexterm" id="id547"/> limited information on the file format.</li></ul></div></div></div></body></html>