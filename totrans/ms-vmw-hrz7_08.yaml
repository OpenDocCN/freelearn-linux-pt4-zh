- en: Securing Horizon View with SSL Certificates
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: n this chapter, we will discuss the security aspect of VMware Horizon View 7,
    and in particular, how we deliver secure communication not only with the end user
    client but also between the different View infrastructure components in the data
    center. We are going to look at two ways to deliver this secure communication.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: We will start with **Secure Sockets Layer** (**SSL**) certificates and get an
    overview of SSL, before learning how to create/issue a certificate and configure
    Horizon View to use it. The second option that will be covered in this chapter
    is **True SSO**. True SSO provides users with a way to authenticate to their virtual
    desktops that keeps all of their usual domain privileges but doesn't require them
    to provide their Active Directory credentials. You will more than likely have
    SSL certificates already set up in your environment, but for this chapter, we're
    going to set up a test environment using a server in the example lab.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: Horizon View and SSL certificates
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing SSL cerificates for Horizon View
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Horizon View True SSO
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Horizon View and SSL certificates
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's start by defining SSL. SSL is an encryption technology developed by Netscape.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: It is used to create an encrypted connection between a web server and the web
    browser in which you will view web pages. By using SSL, you can securely view
    the information sent to your browser, knowing that nobody else can access it.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: SSL works by means of an SSL certificate that is installed on a server and is
    used to identify you. So the question is, how do you know whether you are using
    a secure connection to connect to the server? If you have a secure connection,
    you will see a padlock icon in your browser or the address bar will be colored
    green.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: To ensure you have a secure connection, you can also access the site using `https://`
    in your browser rather than the usual `http://`.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: SSL certificates are provided by **Certificate Authorities** (**CAs**).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: What is a CA?
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A **CA** is a service that issues digital certificates to organizations or people
    after validating them. CAs keep detailed records of the certificates that have
    been issued and any other information that was used when the certificate was issued.
    These are regularly audited to ensure compliance.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: You can obtain a CA from different organizations, or you can create your own
    from a root CA.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: Why do I need SSL certificates for Horizon View?
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you are transmitting sensitive information from a website to an endpoint
    device, you need to secure the information with encryption; otherwise, data could
    be compromised.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: As Horizon View is essentially like a web service to which end users connect
    from their endpoint device to the View Connection Server, you need to ensure that
    this connection is secured. In this case, SSL is used to establish a secured link
    between the client device and the virtual desktop machine. Although, with Horizon
    View, no actual data is transmitted, the pixels from your virtual desktop machine
    are transmitted, and if a third party intercepts this transmission, they could
    potentially see your screen by redrawing these pixels. SSL is also used for communication
    between Horizon View components, such as Connection Servers and Replica Servers.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: Having an SSL certificate installed is a requirement for Horizon View.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: By default, Horizon View comes with self-signed certificates that are fine for
    a proof of concept or a small-scale pilot, but for a production environment, you
    will need to have enterprise-class certificates.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: The use of certificates became a requirement with View 5.1, where they were
    used for the Horizon View components to communicate, such as the Connection Server,
    Replica Server, and View Composer, as well as the underlying infrastructure of
    the ESXi hosts and Virtual Center Servers. Each of these components needs to have
    a certificate installed, along with the client device that is connecting to it.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: Installing SSL certificates for Horizon View
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the next sections of this chapter, we will briefly cover how to set up certificates
    by installing a root CA in our example test environment to get you started with
    Horizon View. However, we strongly recommend that you engage with your security
    team to deploy the correct type of certificate for your organization and environment.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: Installing a root CA
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we are going to walk through the process of setting up a server
    that will act as our root CA in the example lab. A server has already been built
    called **HZN7-CERTS**, which we will use for this role.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: 'To configure the root CA, follow these steps:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: Open a console to the **HZN7-CERTS** server, and launch the Server Manager.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click on Add roles and features (**1**), as shown in the following screenshot:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5918da65-7cbc-44a2-b9dd-5873b987ea99.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
- en: You will now see the Add Roles and Features Wizard and the Before You Begin
    screen. Click on the Next > button to continue.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next, you will see the Installation Type screen. Click the radio button for
    Role-based or feature-based installation (**2**), as shown in the following screenshot:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/15cb8bc9-390d-4fc8-93a3-40f2f1f59931.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
- en: Click on the Next > button to continue.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Server Selection screen, as shown in the following screenshot:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/cd1d156f-e385-4f1e-9c93-ea9e3678362d.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
- en: Click on the radio button for Select a server from the server pool (**3**),
    and then highlight the `hzn7-certs.pvolab.com` server from the list (**4**).
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Click the Next > button to continue. You will now see the Server Roles screen,
    as shown in the following screenshot:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/460d7895-48e3-4de5-8020-a43e13c66178.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
- en: Check the box for Active Directory Certificate Services (**5**) and then, in
    the pop-up box for Add features that are required for Active Directory Certificate
    Services, click on the Add Features button (**6**).
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will now return to the Server Roles screen, which will show that Active
    Directory Certificate Services is now checked. Click on the Next > button to continue.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, you will see the Features configuration screen. Click on the Next > button
    to continue.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The next part of the Add Roles and Features Wizard screen is the Active Directory
    Certificate Services screen, as shown in the following screenshot:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0113abaf-24a6-409f-a2a4-112ddd3674e6.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
- en: 'Click the Next > button to continue. You will now see the Select role services
    screen, as shown in the following screenshot:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/ee033b07-ca4c-4d86-b64a-41c62ed0e026.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
- en: Under Role services, check the box for Certification Authority (**7**), and
    then click on the Next > button to continue.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the Confirm installation selections screen, check the box for Restart the
    destination server automatically (**8**), and then click on the Install button.
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The certificate services feature has now been installed. There are now some
    post-deployment configuration to be completed.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: Root CA post-deployment configuration tasks
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'With the core root CA components installed, you can now complete the post-deployment
    configuration tasks:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: 'From the menu bar along the top of the Server Manager Dashboard, click the
    warning yellow triangle warning box, and from the options that pop up, click the
    Configure Active Directory Certificate Services entry (**1**), as shown in the
    following screenshot:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/27c3f26a-1c6b-4813-a0b0-199c05d0b3f1.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
- en: 'You will now see the AD CS Configuration screen and the Credentials configuration
    section:'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/100e2472-a764-487b-a90d-ac5446030365.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
- en: 'Click on the Next > button to continue. You will now see the Role Services
    configuration screen, as shown in the following screenshot:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e8a6419c-f4d6-4c9d-94c9-fdbaeeada507.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
- en: Check the Certification Authority box (**2**), and then click on the Next >
    button to continue.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Setup Type configuration screen, as shown in the following
    screenshot:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/3aff0e51-1213-42be-8a97-0d3adb5417b2.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
- en: 'Click on the radio button to select the Enterprise CA option (**3**), and then
    click on the Next > button to continue. You will now see the CA Type configuration
    screen:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/33ddf5a9-b9d1-4c7f-a473-373b9737e750.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
- en: Next, click on the radio button to select the Root CA option (**4**), and then
    click on the Next > button to continue.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Private Key configuration screen, as shown in the following
    screenshot:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8f27f9e1-b2d7-463f-b5b0-2269950e042d.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
- en: 'Click on the radio button to select the Create a new private key option (**5**),
    and then click on the Next > button to continue. You will now see the Cryptography
    for CA configuration screen:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/abd08213-0167-43be-a711-3d8c0572c0b1.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
- en: Accept the default settings and click the Next > button to continue.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the CA Name configuration screen, where you can specify the
    name of the CA, as shown in the following screenshot:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a6890240-3100-4ff1-87f7-533f6c6a0378.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
- en: Accept the default settings and click on the Next > button to continue.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Validity Period configuration screen, as shown in the
    following screenshot:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/71556989-b263-450a-aadf-8b98d0ea86fe.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
- en: Accept the default settings and click on the Next > button to continue.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the CA Database configuration screen, as shown in the following
    screenshot:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/d4c8d40d-dd60-413c-9030-93105d75e04e.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
- en: 'Accept the default settings and click on the Next > button to continue. You
    will now see the Confirmation screen, as shown in the following screenshot:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/dec50905-4ba3-4904-b95c-f7fbee170783.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
- en: 'Click on the Configure button at the bottom of the screen to complete the configuration.
    Once the configuration has successfully completed, you will see the following
    message pop up:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/fccc4f60-d819-44f8-b399-51b75859ae4f.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
- en: Click on the Close button to close the Server Manager.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now that we have our certificate server set up and running, we can start configuring
    the Horizon View software infrastructure components and clients to use it.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: We will start by installing the certificate on the Horizon View Connection Server
    first.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: Installing an SSL certificate on the View Connection Server
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'With the certificate server installed and configured, we are now going to install
    the newly created certificate on the View Connection Server:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a remote console session to the View Connection Server named **HZN7-CS1**,
    and then open a Run command box. In the Run box, type `mmc`, and then click on
    OK to launch the **Microsoft Management Console** (**MMC**), as shown in the following
    screenshot:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e4396ff0-10b3-4773-b849-c805a50bdc5c.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
- en: 'You will now see the MMC console screen, as shown in the following screenshot:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/86cfc8f9-b21b-4d6a-acde-85afdf4a9d05.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
- en: On the MMC console screen, click on File (**1**), and then click on the option
    for Add/Remove Snap-in… (**2**).
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Add or Remove Snap-ins screen:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b0923fe7-1c32-4eee-a77b-aa88ccd9d4b8.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
- en: From the Available snap-ins section on the left, click to highlight the Certificates
    entry (**3**), and then click, the Add > button (**4**), as shown in the previous
    screenshot.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Certificates snap-in box appear, as shown in the following
    screenshot:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0fc615c9-bb30-4f41-9cd9-0f91a65e1e44.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
- en: 'Click on the radio button for Computer account (**5**), and then click the
    Next > button to continue. You will now see the Select Computer configuration
    box:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/41e387a5-f645-49f8-a5f0-a916a1931733.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
- en: Click on the radio button for Local computer (6), and then click on the Finish
    button. You will return to the Add or Remove Snap-ins screen, which now shows
    the certificates snap-in as being selected.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on OK to close the Add or Remove Snap-ins screen.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You have now successfully added Certificates to the management console as an
    option for configuration, as shown in the following screenshot:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1a3de15f-d203-4ceb-90e6-e1f66b8a97aa.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
- en: 'Now you have the certificates available to manage and configure from the management
    console, the next task is to request a certificate from the root CA:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: 'From the `Console Root`, expand the `Certificates (Local Computer)` folder,
    and then right-click on the `Personal` folder (**1**). From the contextual menu,
    navigate to All Tasks (2) and then select Request New Certificate... (**3**):'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b1492f38-7064-4e77-9c0e-40e4576166c8.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
- en: You will now see the Before You Begin section on Certificate Enrollment screen.
    Click on the Next button to continue.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now the Select Certificate Enrollment Policy screen is displayed, as shown
    in the following screenshot:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9a6a1aab-0404-4751-b142-68e92eaf5f02.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
- en: 'Click on the Next button to continue. You will now see the Certificate Enrollment
    Request Certificates screen:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c8d5c7b9-8b81-4d36-96dc-fb8eeeccf407.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
- en: In the Active Directory Enrollment Policy box, check the box for Computer (**4**).
    We will use this policy template for our certificate; however, you can create
    your own template on the root CA server.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now click on the arrow next to Details (**5**), and then click on the Properties
    box (**6**) so that we can configure the properties of the certificate. You will
    now see the Certificate Properties configuration box, as shown in the following
    screenshot:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c1ce95e0-92b2-4161-a793-84ab6fc41741.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
- en: 'Click on the General tab (**7**), and then in the Friendly name: box (**8**),
    type in a friendly name for this certificate. In the example lab, we will call
    this `vdm`. Optionally, you can enter a Description as well.'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next, from the Certificate Properties box again, click on the Private Key tab,
    as shown in the following screenshot:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7818e064-036e-4951-9dd3-506e730856d9.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
- en: Click on the down arrow for Key options (**10**) to expand the configuration
    options, and check the box for Make private key exportable (**11**).
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Finally, click on the **Certification Authority** tab (**12**), as shown in
    the following screenshot:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/8696f61c-bf02-4ebd-953d-3c4886215911.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
- en: 'Check the box to select the pvolab-HZN7-CERTS-CA (**13**) enrollment server.
    Now click on the OK button. You will return to the Request Certificates screen,
    as shown in the following screenshot:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/66c5d495-4c8c-4639-8622-c7a7d3da38f1.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
- en: 'Click on the Enroll button (**14**) to continue and enroll the Connection Server.
    If the enrollment is successful, then you will see the following screenshot:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/981f9d4d-44fa-4ba9-860f-612edc1207ce.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
- en: Click the Finish button to complete the certificate enrollment process.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“完成”按钮以完成证书注册过程。
- en: Don't forget that you need to complete the certificate enrollment process on
    all of the Horizon View components, so if you have additional servers such as
    Replica Servers and View Composer Servers then these will all need a certificate
    to be installed on each and every one of them.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 别忘了你需要在所有Horizon View组件上完成证书注册过程，因此，如果你有其他服务器，比如副本服务器和View Composer服务器，那么这些服务器上也需要安装证书。
- en: In the next section, we will take a look at what to do now that we have our
    root CA certificate server and the certificate is installed on our Connection
    Servers.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一部分，我们将看看现在已经有了根CA证书服务器并且证书已安装在我们的连接服务器上，我们接下来该做些什么。
- en: Post-certificate enrollment configuration tasks
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 证书注册后的配置任务
- en: Even though you have installed a certificate server and installed a valid certificate
    on the Connection Server, there are still a few things to configure.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 即使你已经安装了证书服务器并且在连接服务器上安装了有效的证书，仍然有一些事情需要配置。
- en: 'If you were to try and connect to the View Administrator using your browser,
    you will still see an error message saying there is a problem with the website''s
    security certificate. A typical message would look something like the following:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你尝试使用浏览器连接到View Administrator，你仍然会看到一条错误信息，表示网站的安全证书存在问题。典型的信息大概会是如下所示：
- en: '![](img/b92e1c76-46c8-40c5-891f-ff74777b20ed.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b92e1c76-46c8-40c5-891f-ff74777b20ed.png)'
- en: 'If you remember from the beginning of this chapter, we also discussed accessing
    web pages using `http://` or `https://` for secure web pages. If the address bar
    in your browser is red, as shown in the following screenshot, then the connection
    is not secure and there are no certificates installed:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你还记得本章开始时，我们还讨论了使用`http://`或`https://`来访问安全网页。如果浏览器中的地址栏是红色的，如下图所示，那么连接不安全，且没有安装证书：
- en: '![](img/0a1330cc-1bd6-454e-8b05-9cf5fccb2208.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0a1330cc-1bd6-454e-8b05-9cf5fccb2208.png)'
- en: You can of course ignore these errors and just click Continue to this website
    (not recommended), which allows you to continue past the warning and log on to
    View Administrator.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，你可以忽略这些错误，直接点击“继续访问此网站”（不推荐），这样你可以绕过警告并登录到View Administrator。
- en: 'However, when you log on, you will see that, in the System Health section of
    the View Administrator dashboard, there is also a red warning box. As far as View
    is concerned, if you don''t have a valid certificate installed, the health warning
    tells you that the connections will be untrusted and therefore that''s a bad thing!
    An example of this is shown in the following screenshot:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，当你登录后，你会看到在View Administrator仪表板的系统健康状态部分也有一个红色警告框。对于View来说，如果没有安装有效的证书，健康警告会告诉你连接是不受信任的，因此这是一件坏事！以下截图展示了这一点：
- en: '![](img/931bcbfb-0549-48aa-8454-601e146aeab9.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/931bcbfb-0549-48aa-8454-601e146aeab9.png)'
- en: If you click on the Horizon 7 Administrator dashboard, and under System Health
    on the Dashboard view, select one of the Connection Servers displaying a red warning
    box. You can see in the server details box that opens that there is a yellow warning
    sign telling you that there is an untrusted certificate on this particular server.
    In the example lab environment, we are going to continue using the Horizon View
    Manager rather than the newer Horizon Console web-based management console. The
    reason is that at the time of writing, not all of the features we are going to
    cover can be accessed using the Horizon console.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 如果点击Horizon 7管理员仪表板，在仪表板视图中的系统健康状态下，选择显示红色警告框的某个连接服务器。你可以看到在打开的服务器详细信息框中，出现了一个黄色警告标志，提示该服务器上有一个不受信任的证书。在这个示例实验环境中，我们将继续使用Horizon
    View管理器，而不是更新的Horizon Console基于Web的管理控制台。原因是在编写本书时，并不是所有我们将讨论的功能都可以通过Horizon控制台访问。
- en: 'It''s the same thing from the end user perspective. If they try to log on via
    the Horizon Client, they will see the following:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 从最终用户的角度来看，这是一回事。如果他们尝试通过Horizon客户端登录，他们会看到以下内容：
- en: '![](img/3f68f114-f74a-4469-b1c9-250c293bf26b.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3f68f114-f74a-4469-b1c9-250c293bf26b.png)'
- en: 'You can see in the Server: box highlighted in the preceding screenshot, that
    the `https://` address of the Connection Server is colored red, has been crossed
    out, and a warning symbol is displayed on the padlock, all indicating that there
    is no trusted certificate installed.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that we have created and installed a certificate on the Connection Server,
    in order for Horizon View to pick up the installed certificate, you need to restart
    the View Connection Server service in Windows services. To do this, follow these
    steps:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a Run dialog box, and in the Run dialog box, type `services.msc` to open
    the Services (Local) screen. Scroll down to the entry for VMware Horizon View
    Connection Server (**1**), as shown in the following screenshot:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/2acd9410-c387-40ac-84ec-4c6e61374b6c.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
- en: Select the option for VMware Horizon View Connection Server, right-click, and
    then from the contextual menu, click on Restart (**2**). Once the VMware Horizon
    View Connection Server service has restarted, you can log in to the View Administrator
    again, and check the certificate has been applied.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To do this, once you have logged in, from the Dashboard, and under System Health,
    click on Connection Servers to expand this section, and then click on the Connection
    Server HZN7-CS1 (**3**), or the server onto which you have just installed the
    certificate. In the Connection Server Details box that pops up, you will now see
    that the SSL certificate is shown as Valid (**4**) and that the error boxes have
    now changed from red to green:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/787d87ad-06cb-4c2b-ab26-bad235e2916b.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
- en: Finally, click on OK to close the dialog box for the Connection Server Details
    and then log out of the View Administrator.
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You have now successfully created and installed a certificate for Horizon View.
    Don't forget that you need to install a certificate on all of the Horizon View
    components, such as any Replica Servers or View Composer servers.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: Horizon View True SSO
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In [Chapter 2](5d942e5b-dda5-4e5a-8278-62a64210aeef.xhtml), *Understanding Horizon
    7 Architecture and Components*, we introduced you to the True SSO feature and
    its architecture. In this section, we are going to look at how to configure True
    SSO.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: To set up True SSO, you first need to configure a CA, which we have already
    configured earlier on in this chapter in the *Installing a root CA* section. There
    are then a number of configuration steps to complete in preparation for installing
    True SSO.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: Preparing AD for True SSO
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The first step is to create an **Active Directory** (**AD**) group for the
    Enrollment Server. To do this, follow these steps:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a console to your Domain Controller. In the example lab, this is the machine
    called `dc.pvolab.com`. Launch the Active Directory Users and Computers configuration
    screen, as shown in the following screenshot:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c5a182cf-6fe5-462e-8561-904894c7975a.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
- en: 'Click on and select `Users` (**1**), and then right-click. From the contextual
    menu, click on New (**2**), and then from the expanded options, select Group (**3**).
    You will now see the New Object – Group dialog box, as shown in the following
    screenshot:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5ffe91a1-e4f8-43ad-8b0c-76a249018380.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
- en: In the Group name box (**4**), type in a name for the new group. In the example
    lab, this is called `Enrollment Servers`. In the Group scope box, click on the
    radio button for Universal (**5**), and in the Group type box, click on the radio
    button for Security (**6**). Once configured, click on the OK button. Next, you
    need to add the Enrollment Server into this newly created group.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the Active Directory Users and Computers configuration screen, click on
    `Computers` (**7**), and then double-click on the Enrollment Server. In the example
    lab, this is the computer called HZN7-ENROL, as shown in the following screenshot:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/aac056d1-95fa-4362-b3b9-4799dfa8506c.png)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
- en: 'You will now see the HZN7-ENROL Properties dialog box, as shown in the following
    screenshot:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/201b0c21-0e30-4080-bb73-82abd1432120.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
- en: 'Click on the Member Of tab (**9**), and then click on the Add… button (**10**).
    You will now see the Select Groups dialog box:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/22c1dffa-781d-4f1d-a72b-236ba6e65796.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
- en: In the Enter the object names to select box (**11**), type in the name of the
    group you created for the `Enrollment Servers`. You can just type the first part
    of the name and then click the Check Names button (**12**). This will find any
    names that match the first part of what you type in. In this example, it will
    find the Enrollment Servers group. With the correct group name selected, click
    on the OK button to continue.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will return to the HZN7-ENROL Properties dialog box, which now shows that
    the Enrollment Server called HZN7-ENROL is a member of the Enrollment Servers
    group. This is shown in the following screenshot:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7d5a4ab4-811e-4743-9fb3-31716746a161.png)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
- en: With the Domain Controller elements now configured, the next step is to create
    a new certificate template.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: Creating a certificate template for TrueSSO
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The next step is to create a certificate template. To do this, we are going
    to work through the following steps:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a console to the certificate server and launch the Certificate Management
    Console. In the example lab, this is the server called HZN7-CERTS. This is shown
    in the following screenshot:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/08b65d1d-3ded-4222-ac21-eb3eedb507c2.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
- en: 'Click on the `Certificate Templates` folder (**1**), and then right-click.
    From the contextual menu now displayed, click on Manage (**2**). You will now
    see the Certificate Templates Console, as shown in the following screenshot:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9bec6377-b996-4ea2-a82d-2772da8644aa.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
- en: 'Scroll down the Template Display Name pane until you find the template for
    Smartcard Logon (**3**), and click to highlight it. Now right-click, and then
    from the contextual menu now displayed, click on Duplicate Template. You will
    now see the Properties of New Template configuration box, as shown in the following
    screenshot:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/dd40959e-cead-47bd-a3d2-6a2daf1f2b44.png)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
- en: Click on the Compatibility tab (**5**). In the Compatibility Settings section,
    from the drop-down menu for Certification Authority (**6**), select the appropriate
    setting for the server version that is running as the CA. In the example lab,
    the CA server is running Windows Server 2012 R2.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, from the drop-down menu for Certificate recipient (**7**), select the
    appropriate setting for the machines that will be in receipt of this certificate.
    In the example lab, we will set this to Windows 7 / Server 2008 R2.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When changing these settings, you will see a dialog box appear warning you about
    compatibility changes, and changes to the template that you are about to make.
    Click OK to accept these messages and to continue.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: 'Now click on the General tab (**8**) box as shown in the following screenshot:'
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4011529f-b73d-4620-bf80-43443fdea4bf.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
- en: In the Template display name box (**9**), type in a name for the new certificate
    template. In the example lab, this is called `Horizon TrueSSO`.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, you need to configure a validity time. From the drop-down menu under Validity
    period (**10**), select the option for hours. You will then see the Certificate
    Templates warning box (**11**).
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on OK to accept. Accepting the warning will automatically set the Renewal
    period to `0` hours (**12**).
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now click on the Request Handling tab (**13**) box, as shown in the following
    screenshot:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/6ea04ebe-5216-46fd-a36d-9d789aeaac5a.png)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
- en: In the drop-down box next to Purpose (**14**), select the option for **S**ignature
    and smartcard logon. You will then see the Certificate Templates warning box (**15**),
    which warns you that you are about to change the purpose of the certificate. Click
    Yes to accept the warning message and close the dialog box.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, on this screen, check the box for Allow private key to be exported
    (**16**), and check the box for For automatic renewal of smartcard certificates
    (**17**).
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next, click the Cryptography tab (**18**), as shown in the following screenshot:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a23428f7-8dd3-4e25-a372-b91b29ca3405.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
- en: In the Provider Category box, click on the drop-down arrow (**19**) and select
    the option for Key Storage Provider. Then, click on the radio button for Requests
    can use any provider available on the subject's computer (**20**), and then in
    the Request hash box, click on the drop-down arrow (**21**) and select the option
    for SHA256.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The next tab to configure is the Subject Name tab (**22**), as shown in the
    following screenshot:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1c140d73-e168-4de9-b17c-d552fac48231.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
- en: Click on the radio button for Build from this Active Directory information (**23**),
    and then check the box for User principal name (UPN) (**24**).
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The next tab to configure is the Server tab (**25**), as shown in the following
    screenshot:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/b9ece1bd-cb86-4e55-a250-0d27a7f187f2.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
- en: 'Check the Do not store certificates and requests in the CA database box (**26**).
    Now click on the Issuance Requirements tab (**27**), as shown in the following
    screenshot:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/09491c1d-faed-4165-86b0-7b10c0a80240.png)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
- en: Check the box for This number of authorized signatures (**28**), and ensure
    the value for this option is set to `1`.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From the Application policy box, click on the drop-down arrow (**29**) and select
    the option for Certificate Request Agent. Finally, on this tab, click on the radio
    button for Valid existing certificate (**30**).
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'For the final part of the Properties of New Template configuration, click on
    the Security tab (**31**) as shown in the following screenshot:'
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0c03f06c-71d0-4795-8211-175c716b3652.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
- en: Click to select the Enrollment Servers group (**32**), and then click on the
    Add… button (**33**).
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will now see the Select Users, Computers, Service Accounts or Groups dialog
    box pop up. In the Enter the object names to select box (**34**), type in the
    name of the `Enrollment Servers` group. You can just type the first few letters
    of the group name and then click on the Check Names button (**35**) to find any
    matches. You will now see the Enrollment Servers group (**34**).
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, in the Permissions for Enrollment Servers section, check the box under
    the Allow heading for Read (**36**) and Enroll (**37**).
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This step is now complete so click on the OK button to finish the configuration
    and close the dialog box.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the next section, we are going to issue the newly created certificate template.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
- en: Issuing the TrueSSO certificate template
  id: totrans-205
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now that the certificate template has been created, the next task is to issue
    it. To do this, follow the steps as described:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
- en: 'From the Certificate Management Console screen, click on the `Certificate Templates`
    folder (**1**), right-click, and then from the contextual menu that is displayed
    click on New (**2**), and then select the option for Certificate Template to Issue
    (**3**). This is shown in the following screenshot:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1c2f5101-dd87-4dd0-b300-3ae417ce16de.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
- en: 'You will now see the Enable Certificate Templates dialog box, as shown in the
    following screenshot:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/1af47c08-80eb-4108-b2dd-2bb506dd4435.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
- en: Click on **Horizon True SSO** (**4**), and then click on the OK button.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now go back to the Enable Certificate Templates dialog box, as shown
    in the following screenshot:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7953326e-1130-45fa-876e-146fa9d43f0a.png)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
- en: 'Next, we need to enable the Enrollment Agent. As in the previous step, from
    the Certificate Management Console screen, click on the `Certificate Templates`
    folder (**5**), right-click, and then from the contextual menu that is displayed,
    click on New (**6**), and then select the option for Certificate Template to Issue
    (**7**). You will now see the Enable Certificate Templates dialog box, as shown
    in the following screenshot:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0704c05e-504d-4fb8-94f3-be1cf3ef31f4.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
- en: Click on and select the option for Enrollment Agent (Computer) (**8**). Now
    click on the OK button. You will return to the Enable Certificate Templates dialog
    box. You can now exit the Certificate Management Console.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You need to check that the Enrollment Agent (Computer) template has the same
    security settings as the template for `TrueSSO` template was configured with.
    This means it has been added to the Enrollment Servers Security group and has
    been granted read and enroll permissions.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
- en: The final few configuration tasks are command-line-based, so from the desktop
    of the certificate server, launch a Run dialog box. In the Run dialog box, type
    `cmd` to open a Command Prompt box.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
- en: 'The first thing you need to do is to configure the CA for non-persistent certificate
    processing. To do this, at Command Prompt, type the following command:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The output from running this command is shown in the following screenshot:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1f88729a-c579-4ded-93ee-e832ab3ef54e.png)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
- en: 'The second thing you need to do it to configure the CA to ignore offline **Certificate
    Revocation Lists** (**CRL**) errors. To do this, at Command Prompt, type the following
    command:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The following screenshot shows the command successfully executing:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c68321ee-5231-4b07-a01b-29e9a6211372.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
- en: 'Finally, as it states in Command Prompt, you need to restart the certificate
    service. To do this at Command Prompt, run the following two commands, one after
    the other:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'You should see something similar to the following screenshot, which shows that
    the certification service was successfully stopped and then started again:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fa2b125a-ea30-45a1-bb3b-9539499a684f.png)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
- en: The next step in the process is to deploy the certificates on the Enrollment
    Server and the Connection Server.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
- en: Certificate deployment
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The next task to perform is to deploy the **Enrollment Agent (Computer)** certificate
    on to the Enrollment Server.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: By deploying the Enrollment Agent (Computer) certificate onto this server, you
    are authorizing this Enrollment Server to act as an Enrollment Agent and generate
    to be able to generate certificates on behalf of the end users.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
- en: 'If you are following the example lab, then in [Chapter 4](a85150f1-1f32-4c91-87f0-1e8c700b9b96.xhtml),
    *Installing and Configuring Horizon 7 - Part 1*, you will already have an Enrollment
    Server called **HZN7-ENROL**, onto which we will deploy the certificate. The first
    thing to do is to open a remote console to this server:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
- en: 'Launch a Run command box and type `mmc` into the Open box (**1**) to launch
    the Microsoft Management Console, as shown in the following screenshot:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/567be70e-8201-4d85-aaf6-18c5202b5398.png)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
- en: On the MMC console screen, click on File (**2**) and then Add/Remove Snap-in…
    (**3**).
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Add or Remove Snap-ins screen, as shown in the following
    screenshot:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/e137c61c-4409-46d4-af86-772a0f5504de.png)'
  id: totrans-240
  prefs: []
  type: TYPE_IMG
- en: 'From the Available snap-ins section on the left, click to highlight and select
    the Certificates entry (**4**), and then click on the Add > button (**5**). You
    will now see the Certificates snap-in box appear, as shown in the following screenshot:'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a402e774-84bb-402e-863f-1192df399f0d.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
- en: 'Click on the radio button for the Computer account (**6**), and then click
    on the Next > button to continue. You will now see the Select Computer configuration
    box:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/57b642ca-e24f-4a69-ac87-b599b7dd4534.png)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
- en: Click on the radio button for Local computer (**7**), and then click on the
    Finish button. You will now return to the Add or Remove Snap-ins screen, which
    now shows the certificates snap-in as being selected.
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on OK to close the Add or Remove Snap-ins screen.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now you have the certificates option available in the management console, as
    shown in the following screenshot:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b1a2d5a2-555f-4dd3-a8cc-289a3216defb.png)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
- en: 'The next task is to request the Enrollment Agent (Computer) certificate:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: 'From the Console Root, expand the `Certificates (Local Computer)` folder, and
    then select and right-click on the `Personal` folder (**1**). From the contextual
    menu, navigate to All Tasks (**2**) and then select Request New Certificate...
    (**3**), as shown in the following screenshot:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/a8e5d327-3632-4fc3-b56c-2f2ac64887e6.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
- en: You will now see the Before You Begin section on Certificate Enrollment screen.
    Click on the Next button to continue.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next, you will see the Select Certificate Enrollment Policy screen. Click on
    the Next button to continue. The next screen you will see is the **C**ertificate
    Enrollment Request Certificates screen, as shown in the following screenshot:'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/53f98673-bb9e-40b3-8893-3273781fed3b.png)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
- en: 'Check the box to select the Enrollment Agent (Computer) option (**4**), and
    then click on the Enroll button to request the certificate. You should then see
    that the certificate has successfully been enrolled:'
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/ec26afb1-473b-41d0-a9f9-d67f85ee31ed.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
- en: Finally, click on the Finish button to complete the configuration, close the
    Certificate Enrollment dialog box, and then close the Certificate Management console.
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The next task is to import the Enrollment Service Client Certificate, which
    you need to first export from the Connection Server before importing it onto the
    Enrollment Server.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
- en: Deploying the Enrollment Service Client Certificate from the Connection Server
    pairs the Connection Server with the Enrollment Server. If you don't do this,
    then any connection request that is made to the Enrollment Server will be rejected
    and the result is that no certificate will be generated. The Enrollment Service
    Client Certificate is automatically generated on the Connection Server when the
    Connection Server service starts up.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s start by exporting the certificate from the Connection Server:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a console to the Connection Server. In the example lab, this is the server
    called **HZN7-CS1**. Launch the MMC console and add the Certificates snap-in as
    we have covered in previous sections, and then launch the Certificates Management
    Console, as shown in the following screenshot:'
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5660b24d-37c2-4001-a69a-f14f486adbd9.png)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
- en: From the Console Root section in the left-hand pane, navigate to the `VMware
    Horizon View Certificates` folder, expand it by clicking the arrow, and then click
    on the `Certificates` folder (**1**).
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on and select the certificate that contains the friendly name `vdm.ec`
    (**2**), right-click, and then from the contextual menu click on All Tasks (**3**),
    and then select the option for Export… (**4**). You will now see the Welcome to
    the Certificate Export Wizard screen. Click on the Next button to continue.
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Export Private Key dialog box, as shown in the following
    screenshot:'
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/7b17fc2d-b948-44dc-9c4c-3a92f889a175.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
- en: Click on the radio button for the No, do not export the private key (**5**),
    and then click on the Next button.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the Export File Format dialog box, accept the default selected format option
    and then click on the Next button to continue.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the File to Export dialog box, as shown in the following screenshot:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/26d69c9a-bcbc-4f4d-b363-07a5c736abd1.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
- en: In the File name box (**6**), type in a filename for the certificate. In the
    example lab, this has been called `cs-cert` and for easy access has been saved
    in a shared folder called `cert` on the Domain Controller because it needs to
    be accessible from the Enrollment Server when we come to import it.
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the Next button to continue.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Completing the Certificate Export Wizard dialog box, as
    shown in the following screenshot:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/08ba3df7-5ebd-4a04-b8a9-c51456833314.png)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
- en: Finally, click on the Finish button to complete the certificate export process.
    You will see a message saying the export was successful.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The next task is to import the certificate into the Enrollment Server:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a remote console to the Enrollment Server. In the example lab, this is
    the server called **HZN7-ENROL**. Launch the MMC console and add the Certificates
    snap-in as we covered previously, and then launch the Certificates Management
    Console, as shown in the following screenshot:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/0e529363-6833-43e1-9345-df99cea1f7bd.png)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
- en: From the Console Root section in the left-hand pane, navigate to the `VMware
    Horizon View Enrollment Server Trusted Roots` folder (**1**), click and select
    to highlight it and then right-click. From the contextual menu that is now displayed,
    click on All Tasks (**2**), and select the option for Import… (**3**).
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Welcome to the Certificate Import Wizard screen. Click
    on the Next button to continue. You will now see the File to Import dialog box,
    as shown in the following screenshot:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/9055c446-de8d-4d22-97df-df1d815d9fe9.png)'
  id: totrans-281
  prefs: []
  type: TYPE_IMG
- en: Type in the filename for the certificate that you are going to import in the
    File name box (**4**). In the example lab, this was the file called `cs-cert`
    that was saved to the shared folder on the domain controller. Click on the Next
    button to continue.
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'In the next screen, Certificate Store, you need to select the store in which
    the certificate will be stored:'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/5c20a9c3-b981-4ed3-97e6-20696ea8b5ed.png)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
- en: In the Certificate Store dialog box, click on the radio button for Place all
    certificates in the following store (**5**), and then ensure that the Certificate
    store is set to `VMware Horizon View Enrollment Server Trusted Roots`.
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the Next button to continue.
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will now see the Completing the Certificate Import Wizard dialog box, as
    shown in the following screenshot:'
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/c83ff4f6-fb9e-4747-8c66-034e9a927fdb.png)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
- en: Finally, click on the Finish button to import the certificate. You should see
    a message stating that the import was successful.
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Once imported, you will see the certificate in the Certificate Management Console,
    as shown in the following screenshot:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fa580a7c-cab4-4bb1-81a8-f8a65e7ca1a0.png)'
  id: totrans-291
  prefs: []
  type: TYPE_IMG
- en: Having successfully imported the certificate, you can now close the Certificate
    Management Console. In the next step, we are going to configure True SSO on the
    Connection Server.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
- en: Configuring True SSO on the Connection Server
  id: totrans-293
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that you have all of the necessary certificates in place, the next step
    is to set up the True SSO feature on the Connection Server.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
- en: This setup process is command-line-driven and uses the `vdmUtil` command, so
    the first step is to open a Command Prompt window on the Connection Server.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
- en: 'The first command you need to run adds the Enrollment Server to the Horizon
    View environment. This allows you to query the Enrollment Server and gather information
    about the domain and other useful information such as available templates and
    CA name:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
- en: 'From the Connection Server, open a command-line dialog box and type in the
    following command:'
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-298
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: You will need this information during the configuration process, so make sure
    you make a note of it.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
- en: 'You will see that the Enrollment Server has now been successfully added to
    the environment:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3ffefba9-414e-4c81-9259-c996cbb8a46d.png)'
  id: totrans-301
  prefs: []
  type: TYPE_IMG
- en: The next command provides you with detailed information about the various Horizon
    components in your environment. This will help with the configuration of True
    SSO.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: 'From the command line, type the following command:'
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'You will see the following output:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fe28a04f-9cc5-4fb9-a0f8-bd431989aa5c.png)'
  id: totrans-306
  prefs: []
  type: TYPE_IMG
- en: We can now use this information to create a True SSO connector. A True SSO Connector
    specifies the details of enrollment servers, CAs, and certificate templates to
    be used. When a Connection Server receives a request to launch a desktop for an
    end user, it will look up the True SSO Connector for the domain the user belongs
    to and uses the components that you configure to obtain the Certificate.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
- en: 'From the command line, type the following command:'
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'You will now see that the connector has been successfully created and enabled,
    as shown in the following screenshot:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6b0626ac-4bec-4505-9641-3d3506ec828b.png)'
  id: totrans-311
  prefs: []
  type: TYPE_IMG
- en: 'Next, we are going to check that True SSO is installed and is working by following
    these steps:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
- en: Log in to the Horizon View Administrator console.
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From the Dashboard screen, under the System Health section, click on the arrow
    to expand the True SSO section (**21**), and then click on the link for `pvolab.com`
    (**22**)
  id: totrans-314
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will see the True SSO Domain Details box, as shown in the following screenshot:'
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](img/4c2fe0e4-0ad8-4e23-9b0e-712fa1f9e9f8.png)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
- en: Click on the OK button to close the box and then log out of the View Administrator.
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You have now successfully configured the View elements for True SSO. The real
    benefit of the True SSO feature is when used in conjunction with vIDM, allowing
    a user to single sign-on to their virtual desktop machine or applications from
    the vIDM portal.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-319
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we discussed some of the security aspects of deploying Horizon
    View. We started off by describing what an SSL certificate is and why Horizon
    View uses them, before going on to show this practically by installing and configuring
    a Root CA server and then configuring the View components in the example lab to
    use these certificates.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
- en: The second part of this chapter explored the True SSO feature of Horizon View.
    Again, we demonstrated this practically by configuring the certificates server
    to use this feature and then configuring the Horizon View Enrollment Server and
    Connection Server so that they "trusted" each other with the user login process.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we are going to turn our attention to virtual desktops
    and start to build virtual desktop images.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
