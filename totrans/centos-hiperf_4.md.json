["```\n    rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\n    rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm\n    ```", "```\n    yum repolist | grep elrepo\n    ```", "```\n    cp /etc/yum.repos.d/elrepo.repo /etc/yum.repos.d/elrepo.repo.ORG \n    sed -i \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/elrepo.repo\n    yum --enablerepo elrepo update\n    yum --enablerepo elrepo install -y drbd84-utils kmod-drbd84\n    ```", "```\n    yum update && yum install drbd84-utils kmod-drbd84\n    ```", "```\n    lsmod | grep -i drbd\n    ```", "```\n    modprobe drbd\n    ```", "```\necho drbd >/etc/modules-load.d/drbd.conf\n```", "```\nls -l /dev | grep -Ei sd[a-z]\n```", "```\ndmesg | grep sdb\n```", "```\n[root@node02 ~]# dmesg | grep sdb\n[  2.484257] sd 3:0:0:0: [sdb] 4194304 512-byte logical blocks: (2.14 GB/2.00 GiB)\n[  2.484258] sd 3:0:0:0: [sdb] Write Protect is off\n[  2.484258] sd 3:0:0:0: [sdb] Mode Sense: 00 3a 00 00\n[  2.484258] sd 3:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA\n[  2.487361]  sdb: unknown partition table\n[  2.498564] sd 3:0:0:0: [sdb] Attached SCSI disk\n[root@node02 ~]#\n```", "```\nparted /dev/sdb mklabel msdos\nparted /dev/sdb mkpart p 0% 100%\npvcreate /dev/sdb1\nvgcreate drbd_vg /dev/sdb1\nlvcreate -n drbd_vol -l 100%FREE drbd_vg\n```", "```\ninclude \"drbd.d/global_common.conf\";\ninclude \"drbd.d/*.res\";\n```", "```\nmv /etc/drbd.d/global_common.conf /etc/drbd.d/global_common.conf.orig\n```", "```\nglobal {\n usage-count no;\n}\ncommon {\n net {\n  protocol C;\n }\n}\n```", "```\nssh node02 mv /etc/drbd.d/global_common.conf /etc/drbd.d/global_common.conf.orig\nscp /etc/drbd.d/global_common.conf node02:/etc/drbd.d/\n```", "```\nresource drbd0 {\n     disk /dev/drbd_vg/drbd_vol;\n     device /dev/drbd0;\n     meta-disk internal;\n     on node01 {\n             address 192.168.0.2:7789;\n     }\n     on node02 {\n             address 192.168.0.3:7789;\n     }\n}\n```", "```\niptables -I INPUT -p tcp -m state --state NEW -m tcp --dport 7789 -j ACCEPT\nservice iptables save\n```", "```\nscp /etc/drbd.d/drbd0.res node02:/etc/drbd.d/\n```", "```\nmkdir /var/lib/drbd\ndrbdadm create-md drbd0\n```", "```\ndrbdadm up drbd0\n```", "```\ncat /proc/drbd\n```", "```\ndrbdadm primary --force drbd0\n```", "```\n0:drbd0/0  Connected Primary/Secondary UpToDate/UpToDate\n```", "```\n0:drbd0/0  Connected Secondary/Primary UpToDate/UpToDate\n```", "```\nmkfs.ext4 /dev/drbd0\n```", "```\npcs cluster start --all\n```", "```\npcs cluster cib drbd0_conf\n```", "```\npcs -f drbd0_conf resource create web_drbd ocf:linbit:drbd drbd_resource=drbd0 op monitor interval=60s\n```", "```\npcs -f drbd0_conf resource master web_drbd_clone web_drbd master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true\n```", "```\npcs status\npcs cluster cib-push drbd0_conf\n```", "```\nCIB updated\n```", "```\npcs status\n```", "```\ntype=AVC msg=audit(1429116572.153:295): avc:  denied  { read write } for  pid=24192 comm=\"drbdsetup-84\" name=\"drbd-147-0\" dev=\"tmpfs\" ino=20373 scontext=system_u:system_r:drbd_t:s0 tcontext=unconfined_u:object_r:var_lock_t:s0 tclass=file\n```", "```\ntype=SYSCALL msg=audit(1429116572.153:295): arch=c000003e syscall=2 success=no exit=-13 a0=125e080 a1=42 a2=180 a3=7fff42b39f80 items=0 ppid=24191 pid=24192 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=\"drbdsetup-84\" exe=\"/usr/lib/drbd/drbdsetup-84\" subj=system_u:system_r:drbd_t:s0 key=(null)\n```", "```\nyum update && yum install policycoreutils-python\n```", "```\ncat /var/log/audit/audit.log | grep AVC | tail -1 | audit2allow -w -a\n```", "```\ncat /var/log/audit/audit.log | grep AVC | tail -1 | audit2allow -a -M drbd0_access_0\n```", "```\nsemodule -i drbd0_access_0.pp\n```", "```\nscp drbd0_access_0.pp node02:~\n```", "```\nsemodule -i drbd0_access_0.pp\n```", "```\nssh node02 semodule -i drbd0_access_0.pp\n```", "```\nsetsebool -P daemons_enable_cluster_mode 1\n```", "```\nyum update && yum install httpd mariadb mariadb-server php\n```", "```\nsystemctl enable httpd\nsystemctl start httpd\n```", "```\nsystemctl status httpd\n```", "```\niptables -I INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT\nservice iptables save\n```", "```\nsystemctl disable httpd\nsystemctl stop httpd\n```", "```\n# Listen: Allows you to bind Apache to specific IP addresses and/or\n# ports, instead of the default. See also the <VirtualHost>\n# directive.\n#\n# Change this to Listen on specific IP addresses as shown below to\n# prevent Apache from glomming onto all bound IP addresses.\n#\n#Listen 12.34.56.78:80\nListen 192.168.0.4:80\nListen 127.0.0.1\n```", "```\nsystemctl restart httpd\n```", "```\npcs status | grep virtual_ip\n```", "```\npcs resource show virtual_ip\n```", "```\n<Location /server-status>\n  SetHandler server-status\n  Order deny,allow\n  Deny from all\n  Allow from 127.0.0.1\n</Location>\n```", "```\npcs resource create webserver ocf:heartbeat:apache configfile=/etc/httpd/conf/httpd.conf statusurl=\"http://localhost/server-status\" op monitor interval=1min\n```", "```\npcs constraint colocation add webserver with virtual_ip INFINITY\npcs constraint order virtual_ip then webserver\n```", "```\nAdding virtual_ip webserver (kind: Mandatory) (Options: first-action=start then-action=start)\n```", "```\npcs cluster stop\n```", "```\ndmesg | grep -i brain \n```", "```\ndrbdadm secondary [resource name] \ndrbdadm connect --discard-my-data [resource name] \n```", "```\ndrbdadm connect [resource name]\n```", "```\ndrbdadm up drbd0\ndrbdadm down drbd0\ndrbd-overview\nssh node02 drbdadm up drbd0\nssh node02 drbdadm down drbd0\nssh node02 drbd-overview\n```", "```\npcs cluster cib fs_drbd0_cfg\n```", "```\npcs -f fs_drbd0_cfg resource create web_fs Filesystem device=\"/dev/drbd0\" directory=\"/var/www/html\" fstype=\"ext4\"\n```", "```\npcs -f fs_drbd0_cfg constraint colocation add web_fs with web_drbd_clone INFINITY with-rsc-role=Master\n```", "```\npcs -f fs_drbd0_cfg constraint order promote web_drbd_clone then start web_fs\n```", "```\npcs -f fs_drbd0_cfg constraint colocation add webserver with web_fs INFINITY\npcs -f fs_drbd0_cfg constraint order web_fs then webserver \n```", "```\npcs -f fs_drbd0_cfg constraint\n```", "```\npcs cluster cib-push fs_drbd0_cfg \n```", "```\nmount | grep drbd0\n```", "```\n<?php\nphpinfo();\n?>\n```", "```\npcs cluster unstandby node01\n```", "```\n    parted /dev/sdc mklabel msdos\n    parted /dev/sdc mkpart p 0% 100%\n    pvcreate /dev/sdc1\n    vgcreate drbd_db_vg /dev/sdc1\n    lvcreate -n drbd_db_vol -l 100%FREE drbd_db_vg\n    ```", "```\n    resource drbd1 {\n     disk /dev/drbd_db_vg/drbd_db_vol;\n     device /dev/drbd1;\n     meta-disk internal;\n     on node01 {\n     address 192.168.0.2:7790;\n     }\n     on node02 {\n     address 192.168.0.3:7790;\n     }\n    }\n    ```", "```\n    iptables -I INPUT -p tcp -m state --state NEW -m tcp --dport 7790 -j ACCEPT\n    service iptables save\n    ```", "```\n    drbdadm create-md dbrd1\n    ```", "```\n    drbdadm up drbd1\n    ```", "```\n    drbdadm primary --force drbd1\n    ```", "```\n    mkdir -p /var/lib/mariadb_drbd1/data\n    pcs cluster cib drbd1_conf\n    pcs -f drbd1_conf resource create db_drbd ocf:linbit:drbd drbd_resource=drbd1 op monitor interval=60s\n    pcs -f drbd1_conf resource master db_drbd_clone db_drbd master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true\n    pcs -f fs_drbd1_cfg resource create db_fs Filesystem device=\"/dev/drbd1\" directory=\"/var/lib/mariadb_drbd1\" fstype=\"ext4\"\n    pcs cluster cib-push drbd1_conf\n    ```", "```\n[root@node01 ~]# cat /proc/drbd\nversion: 8.4.6 (api:1/proto:86-101)\nGIT-hash: 833d830e0152d1e457fa7856e71e11248ccf3f70 build by phil@Build64R7, 2015-04-10 05:13:52\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n ns:98324 nr:0 dw:32888 dr:66457 al:11 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0\n 1: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n ns:2092956 nr:0 dw:33996 dr:2094412 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0\n[root@node01 ~]# drbd-overview\n 0:drbd0/0  Connected Primary/Secondary UpToDate/UpToDate /var/www/html ext4 2.0G 6.1M 1.9G 1%\n 1:drbd1/0  Connected Primary/Secondary UpToDate/UpToDate\n[root@node01 ~]#\n```", "```\npcs resource create dbserver ocf:heartbeat:mysql config=\"/var/lib/mariadb_drbd1/my.cnf\" datadir=\"/var/lib/mariadb_drbd1/data\" op monitor interval=\"30s\" op start interval=\"0\" timeout=\"60s\" op stop interval=\"0\" timeout=\"60s\"\n```", "```\npcs constraint colocation add dbserver with virtual_ip INFINITY\npcs constraint order virtual_ip then dbserver\npcs constraint colocation add db_drbd_clone with virtual_ip INFINITY\npcs constraint order virtual_ip then db_drbd_clone\n```", "```\niptables -I INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT\nservice iptables save\n```", "```\nmkfs.ext4 /dev/drbd1\nmount /dev/drbd1 /var/lib/mariadb_drbd1\n```", "```\nmv /etc/my.cnf /var/lib/mariadb_drbd1/my.cnf\n```", "```\ndatadir=/var/lib/mariadb_drbd1/data\nbind-address=192.168.0.4\n```", "```\nmysql_install_db --no-defaults --datadir=/var/lib/mariadb_drbd1/data\n```", "```\nmysql –h 192.168.0.4 –u root –p\n```", "```\nGRANT ALL ON *.* TO 'root'@'%' IDENTIFIED BY 'MyDBpassword'; \nFLUSH PRIVILEGES;\n```", "```\nCREATE DATABASE cluster_db;\n```", "```\nchown -R mysql:mysql /var/lib/mariadb_drbd1/\n```", "```\npcs resource cleanup [resource name]\n```", "```\n[root@node01 ~]# pcs status\nCluster name: MyCluster\nLast updated: Tue May 12 17:07:04 2015\nLast change: Tue May 12 16:54:03 2015\nStack: corosync\nCurrent DC: node01 (1) - partition with quorum\nVersion: 1.1.12-a14efad\n2 nodes configured\n9 resources configured\n\nOnline: [ node01 node02 ]\n\nFull list of resources:\n\n virtual_ip  (ocf::heartbeat:IPaddr2):  Started node02 \n Master/Slave Set: web_drbd_clone [web_drbd]\n Masters: [ node01 ]\n Slaves: [ node02 ]\n webserver  (ocf::heartbeat:apache):  Stopped \n web_fs  (ocf::heartbeat:Filesystem):  Started node01 \n dbserver  (ocf::heartbeat:mysql):  Stopped \n Master/Slave Set: db_drbd_clone [db_drbd]\n Masters: [ node02 ]\n Stopped: [ node01 ]\n db_fs  (ocf::heartbeat:Filesystem):  Stopped \n\nFailed actions:\n dbserver_start_0 on node01 'not installed' (5): call=36, status=complete, exit-reason='Config /var/lib/mariadb_drbd1/my.cnf doesn't exist', last-rc-change='Tue May 12 17:01:09 2015', queued=0ms, exec=66ms\n db_fs_start_0 on node01 'not installed' (5): call=41, status=complete, exit-reason='Couldn't find device [/dev/drbd1]. Expected /dev/??? to exist', last-rc-change='Tue May 12 17:01:09 2015', queued=0ms, exec=38ms\n dbserver_start_0 on node02 'not installed' (5): call=41, status=complete, exit-reason='Config /var/lib/mariadb_drbd1/my.cnf doesn't exist', last-rc-change='Tue May 12 17:01:09 2015', queued=0ms, exec=91ms\n db_fs_start_0 on node02 'not installed' (5): call=32, status=complete, exit-reason='Couldn't find device [/dev/drbd1]. Expected /dev/??? to exist', last-rc-change='Tue May 12 17:01:08 2015', queued=0ms, exec=39ms\n\nPCSD Status:\n node01: Online\n node02: Online\n\nDaemon Status:\n corosync: active/enabled\n pacemaker: active/enabled\n pcsd: active/enabled\n[root@node01 ~]# \n```"]