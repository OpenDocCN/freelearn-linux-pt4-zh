- en: Chapter 7. Troubleshooting Security Issues
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章：故障排除安全问题
- en: In this chapter, we will discuss the issues related to the security of CentOS
    7\. However, instead of taking a traditional tour relating to hardening a server,
    we will take a more pragmatic approach by reviewing SSH, `SELinux`, HIDS, and
    Firewalld in an alternate fashion in order to encourage you to discover more about
    the system in general.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论 CentOS 7 的安全问题。然而，我们不会采用传统的服务器加固方法，而是通过以另一种方式回顾 SSH、`SELinux`、HIDS
    和 Firewalld，鼓励你更全面地探索系统。
- en: 'In this chapter, we will:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将：
- en: Discover how to use `aureport` to generate audit reports and audit `SELinux`
    with `setroubleshoot`
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解如何使用 `aureport` 生成审计报告并使用 `setroubleshoot` 审计 `SELinux`
- en: Learn how to add and manage `SSH` banners and use `FIGlet` to create custom
    banners
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 学习如何添加和管理 `SSH` 横幅，并使用 `FIGlet` 创建自定义横幅
- en: Discover more about the rudiments of tuning the `SSH` service
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解更多关于调整 `SSH` 服务的基本知识
- en: Learn how to install `Tripwire` and provide your system with an intrusion detection
    system
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 学习如何安装 `Tripwire` 并为系统提供入侵检测系统
- en: Discover more about Firewalld, zone management, and how to add/remove interfaces,
    ports, and masquerade your infrastructure
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解更多关于 Firewalld、区域管理以及如何添加/删除接口、端口和伪装基础设施的内容
- en: Learn how to remove Firewalld and return to iptables
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 学习如何移除 Firewalld 并返回到 iptables
- en: Auditing SELinux with aureport and setroubleshoot
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 aureport 和 setroubleshoot 审计 SELinux
- en: 'Disabling `SELinux` is something that happens quite regularly. It is a common
    occurrence when hosted control panels are used, or when one or more specific applications
    seem to be experiencing such difficulties that they will not run with `SELinux`
    enabled. In these instances, the act of disabling `SELinux` is a tried-and-tested
    technique that can save the system''s administrator an immense amount of time.
    For many, this is an automatic response, while others will argue that the tools
    associated with `SELinux` are probably more at home on the desktop, workstation,
    on servers with a GUI, or in a controlled network environment. However, the fact
    is simple, the act of disabling `SELinux` will remove a key component of security
    and leave the system exposed. I agree, `SELinux` is a complex system, and for
    those of us who wish to enjoy the protection it offers, our lives can be made
    simpler through the option of running `aureport` like this:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 禁用 `SELinux` 是一个相当常见的操作。通常在使用托管控制面板时，或者当某些特定应用程序似乎因 `SELinux` 启用而无法运行时，禁用 `SELinux`
    是一个常见的做法。在这种情况下，禁用 `SELinux` 是一种经过验证的技术，能够为系统管理员节省大量时间。对于许多人来说，这是一个自动反应，而其他人则认为与
    `SELinux` 相关的工具更适合用于桌面、工作站、带有 GUI 的服务器或受控网络环境。然而，事实很简单，禁用 `SELinux` 会移除一个关键的安全组件，从而使系统暴露。我同意，`SELinux`
    是一个复杂的系统，对于那些希望享受它所提供保护的人来说，通过像这样运行 `aureport` 选项，生活可以变得更简单：
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This will provide a list of `avc` messages, the output of which may look like
    this:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 这将提供一个 `avc` 消息的列表，其输出可能类似于以下内容：
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The `aureport` utility is designed to create column-based reports that show
    the events recorded in the audit log files, and by taking this one step further,
    you can also use this same utility to create a list of executable files with the
    following variation:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '`aureport` 工具旨在创建基于列的报告，显示审计日志文件中记录的事件，进一步来说，你还可以使用相同的工具创建一个可执行文件的列表，具体变化如下：'
- en: '[PRE2]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The output of which, depending on the nature of your system, could look like
    this:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 其输出结果根据你系统的不同，可能会类似于以下内容：
- en: '[PRE3]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Others may want to use this utility in order to generate a full authentication
    report by using the following syntax:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 其他人可能希望使用这个工具来生成完整的身份验证报告，方法如下：
- en: '[PRE4]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The output of which would look similar to this:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 其输出结果类似于以下内容：
- en: '[PRE5]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'To generate a summary report of failed authentication events, use the following
    command:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成失败身份验证事件的摘要报告，请使用以下命令：
- en: '[PRE6]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You can create an opposing summary report of successful authentication events
    with the following syntax:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用以下语法创建一个成功身份验证事件的相对摘要报告：
- en: '[PRE7]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: So, given the depth of reporting at your disposal, when you are dealing with
    a system that runs `SELinux`, your first point of call as a troubleshooter is
    to consider the benefits of `aureport` when auditing the system. However, as an
    addition, you will also want to consider a tool called `setroubleshoot`.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，鉴于您可以获得的报告深度，当您处理运行`SELinux`的系统时，作为故障排除者，您的首要任务是考虑在审计系统时`aureport`的好处。作为补充，您还需要考虑一个名为`setroubleshoot`的工具。
- en: 'The `setroubleshoot` tool can be installed with the following syntax:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '`setroubleshoot`工具可以通过以下语法安装：'
- en: '[PRE8]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Having done this, you have now equipped the system with a tool that will actively
    return announcements from the log file found at `/var/log/audit/audit.log` and
    translate them into something far more "human-friendly". This tool is called `sealert`
    and its purpose is to issue reports and resolutions regarding any issues related
    to `SELinux`.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，您现在已经为系统配备了一个工具，它将主动从位于`/var/log/audit/audit.log`的日志文件中返回公告，并将其转化为更“人性化”的形式。这个工具叫做`sealert`，其目的是发布关于与`SELinux`相关的任何问题的报告和解决方案。
- en: 'A process can be started by invoking the following command:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 通过调用以下命令，可以启动一个进程：
- en: '[PRE9]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'However, if you''re expecting a large return of data, then the following variation
    may be more applicable to your needs:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果您预计会返回大量数据，那么以下变体可能更适合您的需求：
- en: '[PRE10]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: However, before we exit our discussion on auditing `SELinux`, for those of you
    who are running headless and would like to receive e-mail alerts, a final configuration
    change may be necessary.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在我们结束关于审计`SELinux`的讨论之前，对于那些运行无头服务器并希望接收电子邮件警报的用户，可能需要进行最终的配置更改。
- en: 'To do this, we will open the following file in our favorite text editor:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，我们将打开我们喜欢的文本编辑器中的以下文件：
- en: '[PRE11]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Scroll down this file to find the `[email]` section and add your e-mail address
    to the following line by replacing the relevant text:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 向下滚动该文件，找到`[email]`部分，并通过替换相关文本来添加您的电子邮件地址：
- en: '[PRE12]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Now, create the relevant list of recipients by customizing the following command:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，通过自定义以下命令，创建相关的收件人列表：
- en: '[PRE13]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The `setroubleshoot` command may not be the perfect solution for everyone and
    every environment, but the effect of using this package is to realize that regardless
    of whether you are running a headless server, a server with a GUI, or even a desktop
    workstation, `SELinux Alert` is a solution that will enable you to keep using
    and enjoying the benefits of `SELinux` without sacrificing your security.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '`setroubleshoot`命令可能并不是适合每个人和每个环境的完美解决方案，但使用此包的效果是，无论您是运行无头服务器、带GUI的服务器，还是桌面工作站，`SELinux
    Alert`都是一种解决方案，使您能够继续使用并享受`SELinux`的好处，而不会牺牲您的安全性。'
- en: Given the weight of this subject, further reading regarding `SELinux` and `setroubleshoot`
    is available at the end of this chapter.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于此主题的重要性，关于`SELinux`和`setroubleshoot`的进一步阅读可以在本章末尾找到。
- en: SSH banners
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SSH横幅
- en: Using SSH banners is not exactly troubleshooting in its purest form (and yes,
    we are dipping into the subject of hardening). However, as it is often considered
    to be a good idea that all servers carry some form of legal banner, notice, or
    security warning that should be displayed to a user before and after the SSH authentication
    process is started and finished, it is an area we should explore. Troubleshooters
    do not build systems, but they do fix them and, for this reason, it is something
    you will be expected to know. Moreover, as this provides an entry into the world
    of SSH, learning how to develop your very own (and unique) SSH login banners will
    be a nice place to start.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 使用SSH横幅并不完全是纯粹的故障排除（是的，我们确实涉及了硬化的主题）。然而，由于通常认为所有服务器应该携带某种形式的法律横幅、通知或安全警告，这些内容应在SSH认证过程开始和结束之前展示给用户，因此这是我们应当探索的一个领域。故障排除者并不负责构建系统，但他们负责修复系统，因此这是您需要了解的内容。而且，作为进入SSH世界的一个入口，学习如何开发您自己的（并且独特的）SSH登录横幅将是一个不错的起点。
- en: 'To display a banner prior to SSH authentication, you should open the following
    file in your favorite editor:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 要在SSH认证之前显示一个横幅，您需要在您喜欢的编辑器中打开以下文件：
- en: '[PRE14]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Now, add the desired message, notice, or security notice as required, but remember,
    try to keep it short and simple.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，按照需要添加所需的消息、通知或安全警告，但请记住，尽量保持简短和简洁。
- en: 'For example, you may want to say:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，您可能想说：
- en: '[PRE15]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Having done this and saved the file, you should now open the master configuration
    file for SSH in your favorite text editor like this:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作并保存文件后，你应该像这样在你最喜欢的文本编辑器中打开 SSH 的主配置文件：
- en: '[PRE16]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Then scroll down until you find the following line:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 然后向下滚动，直到找到以下这一行：
- en: '[PRE17]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Uncomment it and add the correct path to `issue.net` like this:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 取消注释并将正确的路径添加到 `issue.net`，如下所示：
- en: '[PRE18]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Now save and close the file before restarting the SSH service in the following
    way:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 现在保存并关闭文件，然后按照以下方式重启 SSH 服务：
- en: '[PRE19]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'At this point, you should check the status of the SSH service at any time by
    typing this:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，你应该随时通过输入以下命令检查 SSH 服务的状态：
- en: '[PRE20]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You can qualify the banner settings used by SSH with:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过以下方式限定 SSH 使用的横幅设置：
- en: '[PRE21]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: However, let's say you wanted to provide a unique message by converting plain
    text to a large ASCII banner.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，假设你想提供一条独特的消息，将纯文本转换为一个大型 ASCII 横幅。
- en: 'To do this, we will need to install a small utility called `FIGlet`:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，我们需要安装一个名为 `FIGlet` 的小工具：
- en: '[PRE22]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'To use `FIGlet`, you simply need to use the following syntax:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 `FIGlet`，你只需使用以下语法：
- en: '[PRE23]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'However, for the purposes of our SSH banner, we will want to create a message
    that is stored on a local file like this:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，出于 SSH 横幅的目的，我们希望创建一个存储在本地文件中的消息，如下所示：
- en: '[PRE24]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Having done this, simply return to the following file:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，只需返回以下文件：
- en: '[PRE25]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Now find where you previously uncommented this line:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 现在找到你之前取消注释的这一行：
- en: '[PRE26]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Replace the target path with the path to your new banner file created with
    `FIGlet`:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 用 `FIGlet` 创建的新横幅文件的目标路径替换成以下路径：
- en: '[PRE27]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'To finish, save and close the file, and then restart the SSH service like this:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，保存并关闭文件，然后像这样重启 SSH 服务：
- en: '[PRE28]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'You could say that was it, but if you wish to provide an additional post-login
    message, then this can be achieved by editing the following file:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以说到此为止，但如果你希望提供一个额外的登录后消息，可以通过编辑以下文件来实现：
- en: '[PRE29]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Again, simply add the desired message before saving and closing the file in
    the usual way. After you have completed these steps, the next time a user completes
    SSH authentication they will not only be greeted by a server message, but they
    will also be welcomed by a secondary message, thereby giving you plenty of opportunities
    to provide system users with suitable instruction and reports where required.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，简单地在保存并关闭文件之前添加所需的消息。完成这些步骤后，下次用户完成 SSH 身份验证时，他们将不仅看到服务器消息，还会看到一个附加的消息，从而为你提供充足的机会，在需要时向系统用户提供适当的指示和报告。
- en: Remember, login banners can be useful for two main reasons. They not only provide
    a small message to users before accessing the system, but also serve to warn against
    unauthorized access while delivering important information to system administrators
    without their needing to request it.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，登录横幅对于两个主要原因非常有用。它们不仅在用户访问系统之前提供一条小消息，还可以警告未授权访问，同时向系统管理员提供重要信息，而无需他们主动请求。
- en: Tuning SSH
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调整 SSH
- en: SSH is the definitive way of communicating with your system. It is a vital service
    to the lifeblood of your system and it maintains a single, system-wide configuration
    file that enables the system administrator to modify the operation of the daemon.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 是与系统通信的最终方式。它是系统生命线中的一个重要服务，并且它维护着一个系统范围的配置文件，使得系统管理员能够修改守护进程的操作。
- en: 'SSH access is generally given using the following syntax:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 访问通常使用以下语法：
- en: '[PRE30]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'However, if things are particularly slow, the first step in troubleshooting
    your system is to use the alternative debug mode like this:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果系统特别慢，排查问题的第一步是使用替代的调试模式，如下所示：
- en: '[PRE31]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: So with this in mind, let's take a closer look at this file to assist you in
    the process of troubleshooting the `sshd` daemon as a whole.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 既然如此，让我们更仔细地查看这个文件，以帮助你排查 `sshd` 守护进程的整体问题。
- en: 'We will begin by opening the following file in our favorite text editor:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将开始打开以下文件，在我们最喜欢的文本编辑器中：
- en: '[PRE32]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Seen as a good practice when dealing with dictionary attacks, scanners, or bots,
    you can change the SSH port by simply replacing the value `#Port 22` with something
    completely different, such as `Port 2222`.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 当处理字典攻击、扫描器或机器人时，作为一种良好的实践，你可以通过简单地将 `#Port 22` 替换为完全不同的值，例如 `Port 2222` 来更改
    SSH 端口。
- en: 'You can also restrict the root login (this is always recommended) by updating
    the following value to read as follows:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以通过更新以下值来限制 root 登录（这总是被推荐的）：
- en: '[PRE33]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'To disable tunneled clear passwords, you should uncomment the following line:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 要禁用隧道式明文密码，您应该取消注释以下行：
- en: '[PRE34]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'SSH logs can be difficult at times, so before we end this brief review of SSH,
    if it is felt that the system is going through a stage difficult to diagnose,
    it is often a good idea to simply uncomment and update the logging parameters
    like this:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 日志有时可能会很难解读，因此，在我们结束对 SSH 的简要回顾之前，如果系统正处于一个难以诊断的阶段，通常可以通过简单地取消注释并更新日志记录参数来解决，方法如下：
- en: '[PRE35]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Modify this to read:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 修改为：
- en: '[PRE36]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Otherwise, if necessary, higher levels of logging can be achieved with:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，如有必要，可以通过以下方式启用更高级别的日志记录：
- en: '[PRE37]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Now, the final modification may not prevent an attack, but by requiring SSH
    to look up, the remote hostname through forward and reverse DNS will generate
    the appropriate warnings in the system log files. To do this, simply find the
    following line:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，最后的修改可能无法防止攻击，但通过要求 SSH 通过正向和反向 DNS 查找远程主机名，将在系统日志文件中生成适当的警告。为此，只需找到以下行：
- en: '[PRE38]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Update this line to read:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 更新此行使其读取：
- en: '[PRE39]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'However, if SSH is still acting rather sluggish, then ensuring that SSH does
    not require a reverse DNS lookup can improve the situation immensely. To do this,
    simply change the preceding line to read:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果 SSH 仍然有些迟缓，那么确保 SSH 不需要进行反向 DNS 查找可以大大改善这个情况。为此，只需将前面一行更改为：
- en: '[PRE40]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Moreover, it is also possible that a difficulty may arise from the use of `GSSAPI`
    authentication. This is not common as it is a feature of SSH that is called upon
    when a `GSSAPI` server is required to validate the relevant user credentials.
    To avoid this, you should add or edit the following line to read:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，也有可能由于使用了`GSSAPI`认证而引发问题。这种情况并不常见，因为这是 SSH 的一项功能，当需要`GSSAPI`服务器验证相关用户凭据时才会调用。为了避免这种情况，您应添加或编辑以下行，使其读取：
- en: '[PRE41]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Further to this, you may also want to consider the subject of timeouts. This
    common problem can be managed by configuring the correct `ServerAliveInterval`,
    `ServerAliveCountMax`, and `TCPKeepAlive` values. I have made a simple recommendation
    here, but you should remember to ensure that these values are appropriate to your
    needs.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您还可能希望考虑超时的问题。这个常见问题可以通过配置正确的`ServerAliveInterval`、`ServerAliveCountMax`和`TCPKeepAlive`值来解决。我在这里给出一个简单的建议，但您应该记得确保这些值适合您的需求。
- en: 'For example, the following rules imply that a packet will be issued every 60
    seconds:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下规则表示每 60 秒会发送一个数据包：
- en: '[PRE42]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Adjusting the following values can serve to provide a more sustainable connection:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 调整以下值可以提供更稳定的连接：
- en: '[PRE43]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Finally, to make the SSH service just a little bit more secure, scroll down
    to the bottom of the main configuration file and add the following line in order
    to maintain a list of usernames that will be allowed to undertake the SSH authentication
    process:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了让 SSH 服务更安全一些，滚动到主配置文件的底部，添加以下行以维护一个允许进行 SSH 认证的用户名列表：
- en: '[PRE44]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Alternatively, instead of enabling access on a per-user basis, this process
    of managing identities can be simplified on a per-group basis like this:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，您也可以通过这种方式简化身份管理过程，而不是按用户逐个启用访问权限：
- en: '[PRE45]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Your job is nearly done, but having said all that, and depending on your reasons
    for troubleshooting the SSH daemon, you must remember to ensure that, when your
    work is finished, the SSH service must be secured against the possibility of an
    attack. So, always keep in mind that a successful troubleshooting session will
    not only fix the problem, it will also serve to ensure the continuation of a safe
    and secure server.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 您的工作几乎完成，但话说回来，根据您故障排除 SSH 守护进程的原因，您必须记住，完成工作后，SSH 服务必须确保不受到攻击的可能性。因此，请始终记住，一个成功的故障排除会话不仅会修复问题，还将确保服务器的安全和稳定运行。
- en: 'For example, for those of you who are not using `SELinux`, `fail2ban`, or other
    such security measures, you can always review the login records at any time by
    typing:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，对于那些没有使用`SELinux`、`fail2ban`或其他类似安全措施的用户，您可以随时通过输入以下命令来查看登录记录：
- en: '[PRE46]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'The output of which will look like this:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 输出将如下所示：
- en: '[PRE47]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'And, should you wish to view a list of failed attempts, you could try the following:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望查看失败的登录尝试列表，可以尝试以下方法：
- en: '[PRE48]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Accepted login attempts can be viewed with:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过以下方式查看接受的登录尝试：
- en: '[PRE49]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Intrusion detection with Tripwire
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Tripwire 进行入侵检测
- en: Tripwire is a **host-based intrusion detection system** (**HIDS**). It works
    by collecting configuration and filesystem details and uses this information to
    provide a reference point between the previous state of a system and its current
    state, a process that is achieved by monitoring which files or directories were
    added or modified recently, who changed them, what changes were made, and when
    the changes took place.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: Tripwire 是一个 **基于主机的入侵检测系统** (**HIDS**)。它通过收集配置和文件系统的详细信息，利用这些信息提供一个参考点，用于比较系统的先前状态和当前状态，这一过程通过监控哪些文件或目录最近被添加或修改，谁修改了它们，做了哪些更改，以及何时进行了更改来实现。
- en: 'As discussed in a previous chapter, you will need access to the EPEL repository
    in order to get Tripwire. When you are ready, it can be installed like this:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 如前一章所讨论的，你需要访问 EPEL 仓库才能获得 Tripwire。当你准备好时，可以像这样安装：
- en: '[PRE50]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'To begin using Tripwire, you will need to create the appropriate local and
    site keys with the following syntax:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用 Tripwire，你需要使用以下语法创建适当的本地和站点密钥：
- en: '[PRE51]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: When prompted, add a passphrase for both the site and local key file. Tripwire
    will advise you to use a combination of uppercase and lowercase letters, digits,
    and punctuation marks and, when complete, you will be asked to sign the configuration
    file with the previously created site passphrase.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 当提示时，为站点和本地密钥文件添加一个密码短语。Tripwire 会建议你使用大写字母、小写字母、数字和标点符号的组合，完成后，你将被要求使用先前创建的站点密码短语签署配置文件。
- en: 'Once this process is complete, you have the chance to customize Tripwire by
    making changes to the following file:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦此过程完成，你可以通过修改以下文件来自定义 Tripwire：
- en: '[PRE52]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Before you begin, it is advisable to read through `twpol.txt` as many of the
    default directories used will not necessarily be available to your system. These
    extra lines will not cause you any specific problems, but they should be commented
    out if you want to avoid meaningless error messages.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，建议你先阅读 `twpol.txt`，因为许多默认的目录未必在你的系统上可用。这些额外的行不会引发特定问题，但如果你希望避免无意义的错误消息，应将它们注释掉。
- en: 'You can achieve this by commenting the following lines:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过注释掉以下行来实现这一点：
- en: '[PRE53]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Further to this, you should also spend some time reviewing the following file
    in order to customize Tripwire for a suitable purpose:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你还应该花一些时间查看以下文件，以便为适当的用途定制 Tripwire：
- en: '[PRE54]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'So, having made the relevant changes, you should now update the Tripwire policy
    file in the following way:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，在做出相关更改后，你现在应该通过以下方式更新 Tripwire 策略文件：
- en: '[PRE55]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Tripwire will now step through various onscreen phases to reference your changes;
    when it has finished, you should now be able to initialize the Tripwire database
    like this:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: Tripwire 现在将通过各种屏幕阶段来引用你的更改；完成后，你现在应该能够像这样初始化 Tripwire 数据库：
- en: '[PRE56]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Tripwire will now begin to scan the system, but this may take some time depending
    on the overall size of the system in question:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: Tripwire 现在将开始扫描系统，但根据系统的整体大小，这可能需要一些时间：
- en: '[PRE57]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'When complete, you can run a Tripwire report with the following syntax:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，你可以使用以下语法运行 Tripwire 报告：
- en: '[PRE58]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: By running the preceding command, Tripwire will automatically open the report
    in `vi` and, from this point onwards, all subsequent reports will be made in the
    compare mode. So having done this, why not take this opportunity to create a few
    simple text files or directories in your home folder and rerun the report so that
    the findings of Tripwire become much more obvious.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行上述命令，Tripwire 将自动在 `vi` 中打开报告，从此以后，所有后续报告都将在比较模式下进行。因此，完成此操作后，何不利用这个机会在你的主文件夹中创建一些简单的文本文件或目录，然后重新运行报告，这样
    Tripwire 的发现会变得更加明显。
- en: Remember, if any changes to the filesystem are considered to be the result of
    a system intrusion, the administrator will be notified and they will need to restore
    the system with files and directories that can be trusted. For this reason, any
    system changes must be validated through Tripwire.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，如果对文件系统的任何更改被认为是系统入侵的结果，管理员将会收到通知，他们需要使用可以信任的文件和目录来恢复系统。因此，所有系统更改必须通过 Tripwire
    进行验证。
- en: 'You can validate your current policy file by running the following command:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过运行以下命令来验证当前的策略文件：
- en: '[PRE59]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'You can send Tripwire reports via e-mail with utilities such as `mutt` in the
    following way:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过像 `mutt` 这样的工具，通过电子邮件发送 Tripwire 报告，方法如下：
- en: '[PRE60]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Or by modifying the later part of the daily `cron` job:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 或者通过修改每日 `cron` 作业的后续部分：
- en: '[PRE61]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'By including the following line:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 通过添加以下行：
- en: '[PRE62]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Of course, in the space of a few short paragraphs, we have now managed to take
    a small but significant step towards building a comprehensive host-based intrusion
    system. It is not troubleshooting in the purest form of the word, but it will
    help you to diagnose an issue at some point in the future. Moreover, between now
    and then, you can read more about `Tripwire` by reviewing the manual like this:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，在短短的几段话中，我们已经迈出了构建全面主机入侵系统的一小步。它并不是纯粹意义上的故障排除，但在未来某个时刻，它将帮助您诊断问题。而且，从现在到那时，您可以通过查看手册来进一步了解`Tripwire`，例如这样：
- en: '[PRE63]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: However, and just before we finish, at this stage, I would suggest that you
    secure both the `twpol.txt` and `twcfg.txt` files. In the full knowledge that
    Tripwire's policy file is far more extensible than what has been suggested, in
    order to assist your ongoing learning I have provided a link to the project home
    page at the end of this chapter.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在我们结束之前，此时我建议您确保`twpol.txt`和`twcfg.txt`文件的安全。充分意识到Tripwire的策略文件比这里建议的要更加可扩展，为了帮助您持续学习，我在本章的结尾提供了该项目主页的链接。
- en: Firewalld – zone, service, and port management
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Firewalld – 区域、服务和端口管理
- en: The purpose of Firewalld is to replace the need for iptables and improve the
    management of security by enabling configuration changes without stopping the
    current connections. Firewalld runs as a daemon that allows for rules to be added
    and changed instantly and it uses network zones to define a level of trust for
    any and all associated network connections. For the troubleshooter, this does
    provide a range of flexible options but, more importantly, it is necessary to
    understand that, while a connection can only be a part of a single zone, a zone
    can be used across many network connections.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: Firewalld的目的是替代iptables，并通过允许配置更改而不停止当前连接来改善安全管理。Firewalld作为守护进程运行，允许规则即时添加和更改，并使用网络区域来定义与所有关联网络连接的信任级别。对于故障排除人员来说，这提供了多种灵活的选项，但更重要的是，必须理解，虽然一个连接只能属于单一的一个区域，但一个区域可以跨多个网络连接使用。
- en: 'To know whether Firewalld is currently running, you can type:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解Firewalld当前是否正在运行，您可以输入：
- en: '[PRE64]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'To list the predefined zones, you can use:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出预定义的区域，您可以使用：
- en: '[PRE65]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: Note
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'These zones can be defined as:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 这些区域可以定义为：
- en: '`drop`: In this zone, incoming network packets are dropped (with no reply),
    and only outgoing network connections are possible'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`drop`：在此区域，传入的网络数据包会被丢弃（没有回复），仅允许发起外出的网络连接'
- en: '`block`: In this zone, only network connections initiated within this system
    are possible as all incoming network connections are rejected with an `icmp-host-prohibited`
    message'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`block`：在此区域，只有在本系统内发起的网络连接才是可能的，因为所有传入的网络连接都会被以`icmp-host-prohibited`消息拒绝'
- en: '`public`: This zone is used in areas where you do not trust the other computers;
    only selected incoming connections are accepted'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public`：此区域用于您不信任其他计算机的区域；仅接受选定的传入连接'
- en: '`external`: This zone is used on external networks with masquerading enabled
    and only selected incoming connections are accepted'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`external`：此区域用于启用了伪装的外部网络，仅接受选定的传入连接'
- en: '`dmz`: This is the demilitarized zone'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dmz`：这是非军事区'
- en: '`work/home/internal`: This zone is used in environments where you mostly trust
    the other computers on the network; again, only selected incoming connections
    are accepted'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`work/home/internal`：此区域用于大多数信任网络中其他计算机的环境；同样，只有选定的传入连接被接受'
- en: '`trusted`: In this zone, all network connections are accepted'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`trusted`：此区域接受所有网络连接'
- en: 'However, by extending this command, we can also discover what the default zone
    is by typing:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，通过扩展此命令，我们还可以通过输入以下命令来发现默认区域：
- en: '[PRE66]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'The value of this can be updated with the following syntax:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 这个值可以使用以下语法进行更新：
- en: '[PRE67]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Taking this one step further, we can extend this command to provide not only
    a list of zones, but also network interface information like this:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 更进一步，我们可以扩展此命令，不仅提供区域的列表，还能提供类似以下的网络接口信息：
- en: '[PRE68]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'In this situation, network interfaces can be managed with the following syntax:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，网络接口可以使用以下语法进行管理：
- en: '[PRE69]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'We can change the assignment of network interfaces and bind them to different
    zones using the following command:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用以下命令更改网络接口的分配，并将其绑定到不同的区域：
- en: '[PRE70]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Finally, you can obtain all the relevant information about any particular zone
    by typing:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您可以通过输入以下命令获取关于任何特定区域的所有相关信息：
- en: '[PRE71]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'You can list all supported services with:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以列出所有支持的服务，使用：
- en: '[PRE72]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Then you can manage additional services within a zone using the following commands:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，你可以使用以下命令管理某一区域内的附加服务：
- en: '[PRE73]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'Otherwise, list all ports open in any particular zone with this:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，使用以下命令列出特定区域内的所有开放端口：
- en: '[PRE74]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'You can manage the addition or removal of TCP/UDP ports like this:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以像这样管理 TCP/UDP 端口的添加或移除：
- en: '[PRE75]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Finally, and without trying to over-complicate the array of commands available,
    you can configure masquerading in the following way:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在不试图使命令数组过于复杂的情况下，你可以按以下方式配置地址伪装：
- en: '[PRE76]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Then query it like this:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 然后像这样查询它：
- en: '[PRE77]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'You can manage port forwarding with these commands:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用这些命令管理端口转发：
- en: '[PRE78]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'For example, in a typical configuration, if you want to send all packets intended
    for port 22 to port 2222, you can use the following syntax:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在典型配置中，如果你想将所有面向端口 22 的数据包转发到端口 2222，你可以使用以下语法：
- en: '[PRE79]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: So, as you can see, Firewalld is comprehensive, but in the full knowledge that
    there are many more commands that can be discussed, the intention is to show that
    a troubleshooter has the ability to dynamically manage firewall architecture without
    ever needing to stop or restart the firewall service. This is something that cannot
    be achieved with iptables; in many respects, based on the associated learning
    curve and the plethora of new commands, it is a defining feature that may prove
    to be a great success.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，Firewalld 是全面的，但考虑到有许多命令可以讨论，本书的目的是展示故障排除人员能够动态管理防火墙架构，而无需停止或重启防火墙服务。这是
    iptables 无法实现的；在许多方面，基于相关的学习曲线和大量新命令，这一特性可能会成为一种划时代的成功。
- en: Further information about Firewalld can be found at the end of this chapter.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 Firewalld 的更多信息可以在本章的最后找到。
- en: Removing Firewalld and returning to iptables
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 移除 Firewalld 并回到 iptables
- en: Firewalld may not be to everyone's liking and you may prefer iptables. So, on
    a final note, if you ever find yourself in a situation where you do not want to
    use Firewalld, you can return to iptables easily.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: Firewalld 可能并不适合每个人，你可能更喜欢 iptables。所以，最后，如果你发现自己不想使用 Firewalld，你可以轻松地回到 iptables。
- en: 'To begin with, you should disable Firewalld like this:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你应该通过以下方式禁用 Firewalld：
- en: '[PRE80]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'You should then install and configure iptables by typing:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，你应该通过输入以下命令安装和配置 iptables：
- en: '[PRE81]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'Now, start the `iptables` service with the following commands:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，使用以下命令启动 `iptables` 服务：
- en: '[PRE82]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: From this point onwards, you now have `iptables` as your firewall service of
    choice. However, just before you go, it is probably a good idea to reboot your
    server in order for the kernel to account for the new configuration.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 从此以后，你将以 `iptables` 作为你首选的防火墙服务。然而，在离开之前，最好重启服务器，以便内核能处理新的配置。
- en: 'To do this, type:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，输入以下命令：
- en: '[PRE83]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: Summary
  id: totrans-218
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: From the more passive positioning of SSH banners and notices to the rigid approach
    involved in building a host-based intrusion detection system, in this chapter
    we covered a number of approaches intended to provide a way forward in troubleshooting
    security. We have not only talked about the release of Firewalld, and how it can
    be used to dynamically re-engineer the entire firewall environment without an
    interruption in service, but we have also discussed OpenSSH and shown you the
    way back to using iptables.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 从 SSH 横幅和通知的更被动的定位，到构建基于主机的入侵检测系统的严格方法，本章介绍了多种方法，旨在提供解决安全问题的前进方向。我们不仅讨论了 Firewalld
    的发布，以及它如何在不中断服务的情况下动态重新设计整个防火墙环境，还讨论了 OpenSSH，并展示了如何回归使用 iptables。
- en: I believe everyone would agree that security is a big subject and its methods
    and approaches are found throughout the pages in this book. However, having toured
    this chapter, I hope that this small stepping-stone will serve you well in the
    future before we take the next step with a discussion on troubleshooting database
    services.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 我相信大家都会同意，安全是一个大主题，其方法和途径贯穿了本书的每一页。然而，在浏览了本章之后，我希望这块小小的垫脚石能在未来为你提供帮助，接下来我们将讨论如何解决数据库服务的故障。
- en: References
  id: totrans-221
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考文献
- en: 'The Red Hat customer portal: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/)'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 红帽客户门户：[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/)
- en: 'The Fedora project – the SELinux troubleshooting tool (setroubleshoot): [https://fedorahosted.org/setroubleshoot/wiki/SETroubleShoot%20Overview](https://fedorahosted.org/setroubleshoot/wiki/SETroubleShoot%20Overview)'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Fedora 项目 – SELinux 故障排除工具 (setroubleshoot): [https://fedorahosted.org/setroubleshoot/wiki/SETroubleShoot%20Overview](https://fedorahosted.org/setroubleshoot/wiki/SETroubleShoot%20Overview)'
- en: 'Oracle – configuring and using SELinux: [http://docs.oracle.com/cd/E37670_01/E36387/html/ol_selinux_sec.html](http://docs.oracle.com/cd/E37670_01/E36387/html/ol_selinux_sec.html)'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Oracle – 配置和使用 SELinux: [http://docs.oracle.com/cd/E37670_01/E36387/html/ol_selinux_sec.html](http://docs.oracle.com/cd/E37670_01/E36387/html/ol_selinux_sec.html)'
- en: 'The Fedora project – Docs/Drafts/SELinux/SETroubleShoot/DeveloperFAQ: [http://fedoraproject.org/wiki/Docs/Drafts/SELinux/SETroubleShoot/DeveloperFAQ](http://fedoraproject.org/wiki/Docs/Drafts/SELinux/SETroubleShoot/DeveloperFAQ)'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Fedora 项目 – 文档/草稿/SELinux/SETroubleShoot/开发者常见问题: [http://fedoraproject.org/wiki/Docs/Drafts/SELinux/SETroubleShoot/DeveloperFAQ](http://fedoraproject.org/wiki/Docs/Drafts/SELinux/SETroubleShoot/DeveloperFAQ)'
- en: 'The FIGlet home page: [http://www.figlet.org](http://www.figlet.org)'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'FIGlet 主页: [http://www.figlet.org](http://www.figlet.org)'
- en: 'The Tripwire project home page: [http://sourceforge.net/projects/tripwire/](http://sourceforge.net/projects/tripwire/)'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Tripwire 项目主页: [http://sourceforge.net/projects/tripwire/](http://sourceforge.net/projects/tripwire/)'
- en: 'The SSH Wikipedia page: [http://en.wikipedia.org/wiki/Secure_Shell](http://en.wikipedia.org/wiki/Secure_Shell)'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'SSH 维基百科页面: [http://en.wikipedia.org/wiki/Secure_Shell](http://en.wikipedia.org/wiki/Secure_Shell)'
- en: 'The SSH project home page: [http://www.openssh.com](http://www.openssh.com)'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'SSH 项目主页: [http://www.openssh.com](http://www.openssh.com)'
- en: 'The FirewallD Fedora project: [https://fedoraproject.org/wiki/FirewallD](https://fedoraproject.org/wiki/FirewallD)'
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'FirewallD Fedora 项目: [https://fedoraproject.org/wiki/FirewallD](https://fedoraproject.org/wiki/FirewallD)'
- en: 'RHEL – using Firewalls: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html)'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'RHEL – 使用防火墙: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html)'
